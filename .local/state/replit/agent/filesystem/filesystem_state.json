{"file_contents":{"client/src/components/ui/advanced-date-picker.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport {\n  ChevronLeft,\n  ChevronRight,\n} from \"lucide-react\"\nimport { format, setYear, setMonth, setDate as setDay, getYear, getMonth, getDate, isValid, startOfMonth, endOfMonth, eachDayOfInterval, startOfWeek, endOfWeek, addMonths, subMonths, isSameDay, isSameMonth, addYears, subYears } from \"date-fns\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\n\ntype ViewMode = \"year\" | \"month\" | \"day\"\n\ninterface AdvancedDatePickerProps {\n  date?: Date\n  onSelect?: (date: Date) => void\n  className?: string\n}\n\nconst MONTH_NAMES = [\n  \"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\n  \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"\n]\n\nexport function AdvancedDatePicker({\n  date,\n  onSelect,\n  className,\n}: AdvancedDatePickerProps) {\n  const [view, setView] = React.useState<ViewMode>(\"year\")\n  const [currentDate, setCurrentDate] = React.useState<Date>(date || new Date())\n  const [selectedDate, setSelectedDate] = React.useState<Date | undefined>(date)\n  const [inputValue, setInputValue] = React.useState<string>(date ? format(date, \"dd/MM/yyyy\") : \"\")\n  \n  // Range for year view pagination\n  const [yearRangeStart, setYearRangeStart] = React.useState<number>(Math.floor(getYear(new Date()) / 12) * 12)\n\n  // Update internal state if prop changes\n  React.useEffect(() => {\n    if (date) {\n      setCurrentDate(date)\n      setSelectedDate(date)\n      setInputValue(format(date, \"dd/MM/yyyy\"))\n      setYearRangeStart(Math.floor(getYear(date) / 12) * 12)\n    }\n  }, [date])\n\n  const handleYearSelect = (year: number) => {\n    const newDate = setYear(currentDate, year)\n    setCurrentDate(newDate)\n    setView(\"month\")\n  }\n\n  const handleMonthSelect = (monthIndex: number) => {\n    const newDate = setMonth(currentDate, monthIndex)\n    setCurrentDate(newDate)\n    setView(\"day\")\n  }\n\n  const handleDaySelect = (dayDate: Date) => {\n    if (!isValid(dayDate)) return\n    \n    setSelectedDate(dayDate)\n    setCurrentDate(dayDate)\n    setInputValue(format(dayDate, \"dd/MM/yyyy\"))\n    \n    if (onSelect) {\n      onSelect(dayDate)\n    }\n  }\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value\n    // Allow only numbers and slashes\n    if (!/^[\\d/]*$/.test(value)) return\n    \n    setInputValue(value)\n\n    // Validate date format dd/MM/yyyy\n    if (/^\\d{2}\\/\\d{2}\\/\\d{4}$/.test(value)) {\n      const [day, month, year] = value.split('/').map(Number)\n      const parsedDate = new Date(year, month - 1, day)\n      \n      if (isValid(parsedDate) && parsedDate.getFullYear() === year && parsedDate.getMonth() === month - 1 && parsedDate.getDate() === day) {\n        setCurrentDate(parsedDate)\n        setSelectedDate(parsedDate)\n        setView(\"day\")\n        if (onSelect) onSelect(parsedDate)\n      }\n    }\n  }\n\n  const years = React.useMemo(() => {\n    const yearsList = []\n    for (let i = 0; i < 12; i++) {\n      yearsList.push(yearRangeStart + i)\n    }\n    return yearsList\n  }, [yearRangeStart])\n\n  const calendarDays = React.useMemo(() => {\n    const start = startOfWeek(startOfMonth(currentDate))\n    const end = endOfWeek(endOfMonth(currentDate))\n    return eachDayOfInterval({ start, end })\n  }, [currentDate])\n\n  const handlePrev = () => {\n    if (view === \"year\") {\n      setYearRangeStart(prev => prev - 12)\n    } else if (view === \"month\") {\n      setCurrentDate(setYear(currentDate, getYear(currentDate) - 1))\n    } else {\n      setCurrentDate(subMonths(currentDate, 1))\n    }\n  }\n\n  const handleNext = () => {\n    if (view === \"year\") {\n      setYearRangeStart(prev => prev + 12)\n    } else if (view === \"month\") {\n      setCurrentDate(setYear(currentDate, getYear(currentDate) + 1))\n    } else {\n      setCurrentDate(addMonths(currentDate, 1))\n    }\n  }\n\n  const getHeaderText = () => {\n    if (view === \"year\") return `${yearRangeStart} - ${yearRangeStart + 11}`\n    if (view === \"month\") return format(currentDate, \"yyyy\")\n    return format(currentDate, \"MMMM yyyy\")\n  }\n\n  return (\n    <div className={cn(\"w-[300px] sm:w-[320px] bg-card border border-border rounded-lg shadow-lg overflow-hidden flex flex-col\", className)}>\n      {/* Header */}\n      <div className=\"p-3 flex items-center justify-between border-b border-border bg-secondary/10 shrink-0\">\n        <Button variant=\"ghost\" size=\"icon\" onClick={handlePrev} className=\"h-8 w-8\">\n          <ChevronLeft className=\"h-4 w-4\" />\n        </Button>\n        \n        <Button \n          variant=\"ghost\" \n          size=\"sm\" \n          onClick={() => {\n            if (view === \"day\") setView(\"month\")\n            else if (view === \"month\") setView(\"year\")\n          }}\n          className=\"font-semibold text-sm hover:bg-secondary/50 px-2\"\n        >\n          {getHeaderText()}\n        </Button>\n\n        <Button variant=\"ghost\" size=\"icon\" onClick={handleNext} className=\"h-8 w-8\">\n          <ChevronRight className=\"h-4 w-4\" />\n        </Button>\n      </div>\n\n      {/* View Content */}\n      <div className=\"p-3 flex-1 min-h-[300px]\">\n        {view === \"year\" && (\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 h-full content-start animate-in fade-in zoom-in-95 duration-200\">\n            {years.map((year) => (\n              <Button\n                key={year}\n                variant={getYear(currentDate) === year ? \"default\" : \"ghost\"}\n                onClick={() => handleYearSelect(year)}\n                className={cn(\n                  \"h-12 text-sm w-full\", \n                  getYear(currentDate) === year && \"bg-primary text-primary-foreground shadow-md\"\n                )}\n              >\n                {year}\n              </Button>\n            ))}\n          </div>\n        )}\n\n        {view === \"month\" && (\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-3 h-full content-start animate-in fade-in zoom-in-95 duration-200\">\n            {MONTH_NAMES.map((month, index) => (\n              <Button\n                key={month}\n                variant={getMonth(currentDate) === index ? \"default\" : \"outline\"}\n                onClick={() => handleMonthSelect(index)}\n                className={cn(\n                  \"h-12 text-sm w-full font-medium\",\n                  getMonth(currentDate) === index && \"bg-primary text-primary-foreground shadow-md\"\n                )}\n              >\n                {month}\n              </Button>\n            ))}\n          </div>\n        )}\n\n        {view === \"day\" && (\n          <div className=\"space-y-2 animate-in fade-in zoom-in-95 duration-200\">\n            <div className=\"grid grid-cols-7 gap-1 text-center text-xs text-muted-foreground mb-2 font-medium\">\n              {['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'].map(day => (\n                <div key={day} className=\"flex items-center justify-center h-8\">{day}</div>\n              ))}\n            </div>\n            <div className=\"grid grid-cols-7 gap-1\">\n              {calendarDays.map((day, i) => {\n                const isCurrentMonth = isSameMonth(day, currentDate)\n                const isSelected = selectedDate && isSameDay(day, selectedDate)\n                const isToday = isSameDay(day, new Date())\n\n                return (\n                  <Button\n                    key={i}\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={() => handleDaySelect(day)}\n                    disabled={!isCurrentMonth} \n                    className={cn(\n                      \"h-9 w-full p-0 font-normal text-sm aria-selected:opacity-100 transition-all\",\n                      !isCurrentMonth && \"text-muted-foreground opacity-20 invisible pointer-events-none\", // Hide days from other months for cleaner look or disable them\n                      isSelected && \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground shadow-sm scale-105\",\n                      isToday && !isSelected && \"bg-accent text-accent-foreground font-bold border border-primary/20\",\n                    )}\n                  >\n                    {format(day, \"d\")}\n                  </Button>\n                )\n              })}\n            </div>\n          </div>\n        )}\n      </div>\n      \n      {/* Footer - Manual Input */}\n      <div className=\"p-3 border-t border-border bg-secondary/5 shrink-0\">\n        <div className=\"relative\">\n          <input \n            type=\"text\"\n            placeholder=\"DD/MM/YYYY\"\n            value={inputValue}\n            onChange={handleInputChange}\n            className=\"w-full h-10 rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring text-center tracking-widest font-mono uppercase placeholder:normal-case placeholder:tracking-normal\"\n          />\n          <div className=\"absolute right-3 top-1/2 -translate-y-1/2 text-[10px] text-muted-foreground pointer-events-none\">\n            NUMERIC\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","path":null,"size_bytes":9142,"size_tokens":null},"client/src/modules/items/api/index.ts":{"content":"import { apiClient } from '@/api';\nimport { endpoints } from '@/config';\nimport { Item, CreateItemDto, UpdateItemDto, ItemFilters } from '../types';\nimport { PaginatedResponse } from '@/shared/types';\n\nexport const itemsApi = {\n  getAll: async (page = 1, limit = 10, filters?: ItemFilters) => {\n    return apiClient.get<PaginatedResponse<Item>>(endpoints.items.base, {\n      params: { page, limit, ...filters },\n    });\n  },\n\n  getById: async (id: string) => {\n    return apiClient.get<Item>(endpoints.items.byId(id));\n  },\n\n  create: async (data: CreateItemDto) => {\n    return apiClient.post<Item>(endpoints.items.base, data);\n  },\n\n  update: async (id: string, data: UpdateItemDto) => {\n    return apiClient.put<Item>(endpoints.items.byId(id), data);\n  },\n\n  delete: async (id: string) => {\n    return apiClient.delete(endpoints.items.byId(id));\n  },\n};\n\nexport default itemsApi;\n","path":null,"size_bytes":883,"size_tokens":null},"client/src/pages/payments-made.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Plus, Search, Filter, CreditCard, MoreHorizontal, Trash2, X, Pencil, Mail, Printer, ChevronDown } from \"lucide-react\";\nimport { usePagination } from \"@/hooks/use-pagination\";\nimport { TablePagination } from \"@/components/table-pagination\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface BillPayment {\n  billId: string;\n  billNumber: string;\n  billDate: string;\n  billAmount: number;\n  paymentAmount: number;\n}\n\ninterface PaymentMade {\n  id: string;\n  paymentNumber: string;\n  vendorId: string;\n  vendorName: string;\n  vendorGstin?: string;\n  vendorAddress?: {\n    street?: string;\n    city?: string;\n    state?: string;\n    pincode?: string;\n    country?: string;\n  };\n  paymentAmount: number;\n  paymentDate: string;\n  paymentMode: string;\n  paidThrough?: string;\n  depositTo?: string;\n  paymentType: string;\n  status: string;\n  reference?: string;\n  billPayments?: Record<string, BillPayment> | BillPayment[];\n  sourceOfSupply?: string;\n  destinationOfSupply?: string;\n  notes?: string;\n  unusedAmount?: number;\n  createdAt: string;\n}\n\ninterface Vendor {\n  id: string;\n  vendorName: string;\n  companyName?: string;\n  gstin?: string;\n  address?: string;\n  city?: string;\n  state?: string;\n  pincode?: string;\n  country?: string;\n}\n\n// Convert number to words for Indian Rupees\nfunction numberToWords(num: number): string {\n  if (num === 0) return \"Zero Only\";\n\n  const ones = [\"\", \"One\", \"Two\", \"Three\", \"Four\", \"Five\", \"Six\", \"Seven\", \"Eight\", \"Nine\", \"Ten\",\n    \"Eleven\", \"Twelve\", \"Thirteen\", \"Fourteen\", \"Fifteen\", \"Sixteen\", \"Seventeen\", \"Eighteen\", \"Nineteen\"];\n  const tens = [\"\", \"\", \"Twenty\", \"Thirty\", \"Forty\", \"Fifty\", \"Sixty\", \"Seventy\", \"Eighty\", \"Ninety\"];\n\n  function convertLessThanOneThousand(n: number): string {\n    let result = \"\";\n    if (n >= 100) {\n      result += ones[Math.floor(n / 100)] + \" Hundred \";\n      n %= 100;\n    }\n    if (n >= 20) {\n      result += tens[Math.floor(n / 10)] + \" \";\n      n %= 10;\n    }\n    if (n > 0) {\n      result += ones[n] + \" \";\n    }\n    return result.trim();\n  }\n\n  const crore = Math.floor(num / 10000000);\n  num %= 10000000;\n  const lakh = Math.floor(num / 100000);\n  num %= 100000;\n  const thousand = Math.floor(num / 1000);\n  num %= 1000;\n  const remainder = Math.floor(num);\n  const paise = Math.round((num % 1) * 100);\n\n  let result = \"Indian Rupee \";\n  if (crore > 0) result += convertLessThanOneThousand(crore) + \" Crore \";\n  if (lakh > 0) result += convertLessThanOneThousand(lakh) + \" Lakh \";\n  if (thousand > 0) result += convertLessThanOneThousand(thousand) + \" Thousand \";\n  if (remainder > 0) result += convertLessThanOneThousand(remainder);\n\n  result += \" Only\";\n  return result.trim();\n}\n\n// Helper to safely get payment number as string (handles corrupted data)\nfunction getPaymentNumberString(paymentNumber: any): string {\n  if (typeof paymentNumber === 'string') {\n    return paymentNumber;\n  }\n  if (paymentNumber && typeof paymentNumber === 'object' && paymentNumber.nextNumber) {\n    return paymentNumber.nextNumber;\n  }\n  return '';\n}\n\nexport default function PaymentsMade() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [paymentToDelete, setPaymentToDelete] = useState<string | null>(null);\n  const [selectedPayment, setSelectedPayment] = useState<PaymentMade | null>(null);\n\n  const { data: paymentsData, isLoading, refetch } = useQuery<{ success: boolean; data: PaymentMade[] }>({\n    queryKey: ['/api/payments-made'],\n  });\n\n  const { data: vendorsData } = useQuery<{ success: boolean; data: Vendor[] }>({\n    queryKey: ['/api/vendors'],\n  });\n\n  const payments = paymentsData?.data || [];\n  const vendors = vendorsData?.data || [];\n\n  const filteredPayments = payments.filter(payment =>\n    getPaymentNumberString(payment.paymentNumber).toLowerCase().includes(searchQuery.toLowerCase()) ||\n    String(payment.vendorName || '').toLowerCase().includes(searchQuery.toLowerCase()) ||\n    String(payment.reference || '').toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  const { currentPage, totalPages, totalItems, itemsPerPage, paginatedItems, goToPage } = usePagination(filteredPayments, 10);\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('en-IN', {\n      style: 'currency',\n      currency: 'INR',\n      minimumFractionDigits: 2,\n    }).format(amount);\n  };\n\n  const formatDate = (dateString: string) => {\n    if (!dateString) return '-';\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-IN', { day: '2-digit', month: '2-digit', year: 'numeric' });\n  };\n\n  const handleDelete = (id: string) => {\n    setPaymentToDelete(id);\n    setDeleteDialogOpen(true);\n  };\n\n  const confirmDelete = async () => {\n    if (!paymentToDelete) return;\n    try {\n      const response = await fetch(`/api/payments-made/${paymentToDelete}`, { method: 'DELETE' });\n      if (response.ok) {\n        toast({ title: \"Payment deleted successfully\" });\n        if (selectedPayment?.id === paymentToDelete) {\n          setSelectedPayment(null);\n        }\n        refetch();\n      } else {\n        toast({ title: \"Failed to delete payment\", variant: \"destructive\" });\n      }\n    } catch (error) {\n      toast({ title: \"Failed to delete payment\", variant: \"destructive\" });\n    } finally {\n      setDeleteDialogOpen(false);\n      setPaymentToDelete(null);\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status?.toUpperCase()) {\n      case 'PAID':\n        return <span className=\"text-green-600 font-medium\">PAID</span>;\n      case 'DRAFT':\n        return <span className=\"text-slate-500\">Draft</span>;\n      case 'REFUNDED':\n        return <span className=\"text-red-600 font-medium\">REFUNDED</span>;\n      default:\n        return <span>{status}</span>;\n    }\n  };\n\n  const getBillNumbers = (payment: PaymentMade) => {\n    if (!payment.billPayments) return '-';\n\n    if (Array.isArray(payment.billPayments)) {\n      return payment.billPayments.map(bp => bp.billNumber).join(', ') || '-';\n    }\n\n    const billNums = Object.values(payment.billPayments).map(bp => bp.billNumber);\n    return billNums.length > 0 ? billNums.join(', ') : '-';\n  };\n\n  const getBillPaymentsArray = (payment: PaymentMade): BillPayment[] => {\n    if (!payment.billPayments) return [];\n    if (Array.isArray(payment.billPayments)) return payment.billPayments;\n    return Object.values(payment.billPayments);\n  };\n\n  const getVendorDetails = (payment: PaymentMade) => {\n    const vendor = vendors.find(v => v.id === payment.vendorId);\n    return vendor;\n  };\n\n  const getPaidThroughLabel = (value?: string) => {\n    const options: Record<string, string> = {\n      'petty_cash': 'Petty Cash',\n      'undeposited_funds': 'Undeposited Funds',\n      'cash_on_hand': 'Cash on Hand',\n      'bank_account': 'Bank Account',\n    };\n    return options[value || ''] || value || '-';\n  };\n\n  const getPaymentModeLabel = (value?: string) => {\n    const options: Record<string, string> = {\n      'cash': 'Cash',\n      'bank_transfer': 'Bank Transfer',\n      'cheque': 'Cheque',\n      'credit_card': 'Credit Card',\n      'upi': 'UPI',\n      'neft': 'NEFT',\n      'rtgs': 'RTGS',\n      'imps': 'IMPS',\n    };\n    return options[value || ''] || value || '-';\n  };\n\n  const handleRowClick = (payment: PaymentMade) => {\n    setSelectedPayment(payment);\n  };\n\n  const calculateUnusedAmount = (payment: PaymentMade) => {\n    if (payment.unusedAmount !== undefined) return payment.unusedAmount;\n    const billPayments = getBillPaymentsArray(payment);\n    const usedAmount = billPayments.reduce((sum, bp) => sum + (bp.paymentAmount || 0), 0);\n    return Math.max(0, payment.paymentAmount - usedAmount);\n  };\n\n  return (\n    <div className=\"flex h-full\">\n      {/* Main List View */}\n      <div className={`flex-1 transition-all duration-300 ${selectedPayment ? 'pr-0' : ''}`}>\n        <div className=\"max-w-full mx-auto space-y-6 animate-in fade-in duration-500 p-6\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n            <div className=\"flex items-center gap-2\">\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"ghost\" className=\"gap-1 text-xl font-semibold\">\n                    All Payments <ChevronDown className=\"h-4 w-4\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"start\">\n                  <DropdownMenuItem>All Payments</DropdownMenuItem>\n                  <DropdownMenuItem>Paid</DropdownMenuItem>\n                  <DropdownMenuItem>Refunded</DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Button\n                className=\"gap-2\"\n                onClick={() => setLocation('/payments-made/new')}\n                data-testid=\"button-record-payment\"\n              >\n                <Plus className=\"h-4 w-4\" /> New\n              </Button>\n              <Button variant=\"outline\" size=\"icon\">\n                <MoreHorizontal className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"flex flex-col sm:flex-row gap-4\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search payments...\"\n                className=\"pl-9\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                data-testid=\"input-search-payments\"\n              />\n            </div>\n            <Button variant=\"outline\" className=\"gap-2\">\n              <Filter className=\"h-4 w-4\" /> Filter\n            </Button>\n          </div>\n\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-16\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : payments.length === 0 ? (\n            <Card className=\"border-dashed\">\n              <CardContent className=\"flex flex-col items-center justify-center py-16 text-center\">\n                <div className=\"h-16 w-16 rounded-full bg-muted flex items-center justify-center mb-4\">\n                  <CreditCard className=\"h-8 w-8 text-muted-foreground\" />\n                </div>\n                <h3 className=\"text-lg font-semibold mb-2\" data-testid=\"text-payments-empty\">No payments recorded</h3>\n                <p className=\"text-muted-foreground mb-4 max-w-sm\">\n                  Record payments made to vendors to keep track of your accounts payable.\n                </p>\n                <Button\n                  className=\"gap-2\"\n                  onClick={() => setLocation('/payments-made/new')}\n                  data-testid=\"button-record-first-payment\"\n                >\n                  <Plus className=\"h-4 w-4\" /> Record Your First Payment\n                </Button>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"border rounded-lg overflow-hidden bg-white dark:bg-slate-900\">\n              <table className=\"w-full\">\n                <thead className=\"bg-slate-50 dark:bg-slate-800\">\n                  <tr>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">\n                      <Checkbox data-testid=\"checkbox-select-all\" />\n                    </th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Date</th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Payment #</th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Reference#</th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Vendor Name</th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Bill#</th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Mode</th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Status</th>\n                    <th className=\"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase\">Amount</th>\n                    <th className=\"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase\">Unused Amount</th>\n                    <th className=\"px-4 py-3 text-center text-xs font-medium text-slate-500 uppercase\">\n                      <Search className=\"h-4 w-4 mx-auto\" />\n                    </th>\n                  </tr>\n                </thead>\n                <tbody className=\"divide-y\">\n                  {paginatedItems.map((payment) => (\n                    <tr\n                      key={payment.id}\n                      className={`hover:bg-slate-50 dark:hover:bg-slate-800 cursor-pointer transition-colors ${selectedPayment?.id === payment.id ? 'bg-blue-50 dark:bg-blue-900/20' : ''}`}\n                      onClick={() => handleRowClick(payment)}\n                      data-testid={`row-payment-${payment.id}`}\n                    >\n                      <td className=\"px-4 py-3\" onClick={(e) => e.stopPropagation()}>\n                        <Checkbox data-testid={`checkbox-payment-${payment.id}`} />\n                      </td>\n                      <td className=\"px-4 py-3 text-sm\">{formatDate(payment.paymentDate)}</td>\n                      <td className=\"px-4 py-3 text-sm font-medium text-primary\">{getPaymentNumberString(payment.paymentNumber)}</td>\n                      <td className=\"px-4 py-3 text-sm\">{payment.reference || '-'}</td>\n                      <td className=\"px-4 py-3 text-sm\">{payment.vendorName}</td>\n                      <td className=\"px-4 py-3 text-sm\">{getBillNumbers(payment)}</td>\n                      <td className=\"px-4 py-3 text-sm capitalize\">{getPaymentModeLabel(payment.paymentMode)}</td>\n                      <td className=\"px-4 py-3 text-sm\">{getStatusBadge(payment.status)}</td>\n                      <td className=\"px-4 py-3 text-sm text-right font-medium\">\n                        {formatCurrency(payment.paymentAmount)}\n                      </td>\n                      <td className=\"px-4 py-3 text-sm text-right\">\n                        {formatCurrency(calculateUnusedAmount(payment))}\n                      </td>\n                      <td className=\"px-4 py-3 text-center\" onClick={(e) => e.stopPropagation()}>\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" data-testid={`button-payment-actions-${payment.id}`}>\n                              <MoreHorizontal className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem onClick={() => handleRowClick(payment)} data-testid={`action-view-${payment.id}`}>View</DropdownMenuItem>\n                            <DropdownMenuItem onClick={() => setLocation(`/payments-made/edit/${payment.id}`)} data-testid={`action-edit-${payment.id}`}>Edit</DropdownMenuItem>\n                            <DropdownMenuSeparator />\n                            <DropdownMenuItem\n                              className=\"text-destructive\"\n                              onClick={() => handleDelete(payment.id)}\n                              data-testid={`action-delete-${payment.id}`}\n                            >\n                              <Trash2 className=\"mr-2 h-4 w-4\" />\n                              Delete\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n              <TablePagination\n                currentPage={currentPage}\n                totalPages={totalPages}\n                totalItems={totalItems}\n                itemsPerPage={itemsPerPage}\n                onPageChange={goToPage}\n              />\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Detail Panel */}\n      {selectedPayment && (\n        <div className=\"w-[600px] border-l bg-white dark:bg-slate-900 flex flex-col h-full overflow-hidden\">\n          {/* Detail Header - Sidebar with List */}\n          {/* <div className=\"border-b\">\n            <div className=\"max-h-[200px] overflow-y-auto\">\n              {filteredPayments.map((payment) => (\n                <div\n                  key={payment.id}\n                  className={`p-3 border-b cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 ${selectedPayment.id === payment.id ? 'bg-blue-50 dark:bg-blue-900/20' : ''}`}\n                  onClick={() => setSelectedPayment(payment)}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      <Checkbox />\n                      <div>\n                        <div className=\"font-medium text-sm truncate max-w-[180px]\">{payment.vendorName}</div>\n                        <div className=\"text-xs text-muted-foreground\">{formatDate(payment.paymentDate)} - {getPaymentModeLabel(payment.paymentMode)}</div>\n                        <span className=\"text-xs text-green-600\">{payment.status}</span>\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <div className=\"font-semibold\">{formatCurrency(payment.paymentAmount)}</div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div> */}\n\n          {/* Detail Actions */}\n          <div className=\"flex items-center justify-between p-3 border-b bg-slate-50 dark:bg-slate-800\">\n            <div className=\"font-semibold\">{getPaymentNumberString(selectedPayment.paymentNumber)}</div>\n            <div className=\"flex items-center gap-2\">\n              <Button variant=\"outline\" size=\"sm\" className=\"gap-1\">\n                <Plus className=\"h-3 w-3\" />\n              </Button>\n              <Button variant=\"outline\" size=\"sm\" className=\"gap-1\" onClick={() => setLocation(`/payments-made/edit/${selectedPayment.id}`)}>\n                <Pencil className=\"h-3 w-3\" /> Edit\n              </Button>\n              <Button variant=\"outline\" size=\"sm\" className=\"gap-1\">\n                <Mail className=\"h-3 w-3\" /> Send Email\n              </Button>\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"outline\" size=\"sm\" className=\"gap-1\">\n                    <Printer className=\"h-3 w-3\" /> PDF/Print <ChevronDown className=\"h-3 w-3\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent>\n                  <DropdownMenuItem>Print</DropdownMenuItem>\n                  <DropdownMenuItem>Download PDF</DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n                <MoreHorizontal className=\"h-4 w-4\" />\n              </Button>\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={() => setSelectedPayment(null)}>\n                <X className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n\n          {/* Detail Content */}\n          <div className=\"flex-1 overflow-y-auto p-6\">\n            {/* Receipt Preview */}\n            <div className=\"bg-white dark:bg-slate-950 border rounded-lg shadow-sm\">\n              {/* Paid Badge */}\n              <div className=\"relative\">\n                <div className=\"absolute -top-3 -left-3 z-10\">\n                  <div className=\"bg-green-500 text-white px-4 py-2 text-sm font-bold transform -rotate-12 shadow-lg\">\n                    Paid\n                  </div>\n                </div>\n              </div>\n\n              {/* Company Header */}\n              <div className=\"p-6 border-b\">\n                <div className=\"flex justify-between items-start\">\n                  <div>\n                    <h2 className=\"text-xl font-bold\">SkilltonIT</h2>\n                    <p className=\"text-sm text-muted-foreground mt-1\">\n                      Hinjewadi - Wakad road<br />\n                      Hinjewadi<br />\n                      Pune Maharashtra 411057<br />\n                      India\n                    </p>\n                    <p className=\"text-sm text-muted-foreground mt-2\">\n                      GSTIN 27AZCPA5145K1ZH<br />\n                      Sales.SkilltonIT@skilltonit.com<br />\n                      www.skilltonit.com\n                    </p>\n                  </div>\n                  <div className=\"text-right\">\n                    <img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 30'%3E%3Ctext x='0' y='20' font-family='Arial' font-weight='bold' font-size='16' fill='%23333'%3ESKILLTONIT%3C/text%3E%3C/svg%3E\" alt=\"Logo\" className=\"h-8\" />\n                  </div>\n                </div>\n              </div>\n\n              {/* Payment Details */}\n              <div className=\"p-6\">\n                <h3 className=\"text-center text-lg font-bold mb-6\">PAYMENTS MADE</h3>\n\n                <div className=\"flex gap-8\">\n                  {/* Left Column - Details */}\n                  <div className=\"flex-1 space-y-4\">\n                    <div className=\"grid grid-cols-2 gap-2 text-sm\">\n                      <div className=\"text-muted-foreground\">Payment#</div>\n                      <div className=\"font-medium\">{getPaymentNumberString(selectedPayment.paymentNumber)}</div>\n\n                      <div className=\"text-muted-foreground\">Payment Date</div>\n                      <div>{formatDate(selectedPayment.paymentDate)}</div>\n\n                      <div className=\"text-muted-foreground\">Reference Number</div>\n                      <div>{selectedPayment.reference || '-'}</div>\n\n                      <div className=\"text-muted-foreground\">Paid To</div>\n                      <div className=\"text-primary font-medium\">{selectedPayment.vendorName}</div>\n\n                      <div className=\"text-muted-foreground\">Place Of Supply</div>\n                      <div>{selectedPayment.sourceOfSupply || '-'}</div>\n\n                      <div className=\"text-muted-foreground\">Payment Mode</div>\n                      <div className=\"font-medium\">{getPaymentModeLabel(selectedPayment.paymentMode)}</div>\n\n                      <div className=\"text-muted-foreground\">Paid Through</div>\n                      <div className=\"font-medium\">{getPaidThroughLabel(selectedPayment.paidThrough)}</div>\n\n                      <div className=\"text-muted-foreground\">Amount Paid In Words</div>\n                      <div className=\"text-primary font-medium\">{numberToWords(selectedPayment.paymentAmount)}</div>\n                    </div>\n                  </div>\n\n                  {/* Right Column - Amount Box */}\n                  <div className=\"w-40\">\n                    <div className=\"bg-green-500 text-white p-4 rounded-lg text-center\">\n                      <div className=\"text-sm\">Amount Paid</div>\n                      <div className=\"text-2xl font-bold\">{formatCurrency(selectedPayment.paymentAmount)}</div>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Paid To Section */}\n                <div className=\"mt-8 border-t pt-6\">\n                  <h4 className=\"font-semibold mb-2\">Paid To</h4>\n                  <div className=\"text-sm\">\n                    <p className=\"font-bold\">{selectedPayment.vendorName}</p>\n                    {(() => {\n                      const vendor = getVendorDetails(selectedPayment);\n                      if (vendor) {\n                        return (\n                          <>\n                            {vendor.address && <p>{vendor.address}</p>}\n                            {(vendor.city || vendor.state || vendor.pincode) && (\n                              <p>{[vendor.city, vendor.state, vendor.pincode].filter(Boolean).join(', ')}</p>\n                            )}\n                            {vendor.country && <p>{vendor.country}</p>}\n                            {vendor.gstin && <p className=\"mt-1\">GSTIN {vendor.gstin}</p>}\n                          </>\n                        );\n                      }\n                      return null;\n                    })()}\n                  </div>\n                </div>\n\n                {/* Payment for Section */}\n                {getBillPaymentsArray(selectedPayment).length > 0 && (\n                  <div className=\"mt-8 border-t pt-6\">\n                    <h4 className=\"font-semibold mb-4\">Payment for</h4>\n                    <table className=\"w-full text-sm\">\n                      <thead className=\"bg-slate-100 dark:bg-slate-800\">\n                        <tr>\n                          <th className=\"px-3 py-2 text-left\">Bill Number</th>\n                          <th className=\"px-3 py-2 text-left\">Bill Date</th>\n                          <th className=\"px-3 py-2 text-right\">Bill Amount</th>\n                          <th className=\"px-3 py-2 text-right\">Payment Amount</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        {getBillPaymentsArray(selectedPayment).map((bp, index) => (\n                          <tr key={index} className=\"border-b\">\n                            <td className=\"px-3 py-2 text-primary\">{bp.billNumber}</td>\n                            <td className=\"px-3 py-2\">{formatDate(bp.billDate)}</td>\n                            <td className=\"px-3 py-2 text-right\">{formatCurrency(bp.billAmount)}</td>\n                            <td className=\"px-3 py-2 text-right\">{formatCurrency(bp.paymentAmount)}</td>\n                          </tr>\n                        ))}\n                      </tbody>\n                    </table>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Journal Section */}\n            <div className=\"mt-6\">\n              <Tabs defaultValue=\"journal\">\n                <TabsList>\n                  <TabsTrigger value=\"journal\">Journal</TabsTrigger>\n                </TabsList>\n                <TabsContent value=\"journal\" className=\"mt-4\">\n                  <div className=\"border rounded-lg p-4 bg-slate-50 dark:bg-slate-800\">\n                    <div className=\"flex items-center justify-between mb-4\">\n                      <div className=\"text-sm text-muted-foreground\">\n                        Amount is displayed in your base currency <Badge variant=\"secondary\" className=\"ml-2\">INR</Badge>\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <Button variant=\"outline\" size=\"sm\">Accrual</Button>\n                        <Button variant=\"ghost\" size=\"sm\">Cash</Button>\n                      </div>\n                    </div>\n\n                    <div className=\"font-semibold mb-2\">Vendor Payment - {getPaymentNumberString(selectedPayment.paymentNumber)}</div>\n                    <table className=\"w-full text-sm\">\n                      <thead className=\"bg-slate-100 dark:bg-slate-700\">\n                        <tr>\n                          <th className=\"px-3 py-2 text-left\">ACCOUNT</th>\n                          <th className=\"px-3 py-2 text-right\">DEBIT</th>\n                          <th className=\"px-3 py-2 text-right\">CREDIT</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        <tr className=\"border-b\">\n                          <td className=\"px-3 py-2\">{getPaidThroughLabel(selectedPayment.paidThrough)}</td>\n                          <td className=\"px-3 py-2 text-right\">0.00</td>\n                          <td className=\"px-3 py-2 text-right\">{selectedPayment.paymentAmount.toFixed(2)}</td>\n                        </tr>\n                        <tr className=\"border-b\">\n                          <td className=\"px-3 py-2\">Prepaid Expenses</td>\n                          <td className=\"px-3 py-2 text-right\">{selectedPayment.paymentAmount.toFixed(2)}</td>\n                          <td className=\"px-3 py-2 text-right\">0.00</td>\n                        </tr>\n                        <tr className=\"font-bold bg-slate-100 dark:bg-slate-700\">\n                          <td className=\"px-3 py-2\"></td>\n                          <td className=\"px-3 py-2 text-right\">{selectedPayment.paymentAmount.toFixed(2)}</td>\n                          <td className=\"px-3 py-2 text-right\">{selectedPayment.paymentAmount.toFixed(2)}</td>\n                        </tr>\n                      </tbody>\n                    </table>\n\n                    {getBillPaymentsArray(selectedPayment).length > 0 && (\n                      <>\n                        <div className=\"font-semibold mb-2 mt-6\">Payments Made - {getBillNumbers(selectedPayment)}</div>\n                        <table className=\"w-full text-sm\">\n                          <thead className=\"bg-slate-100 dark:bg-slate-700\">\n                            <tr>\n                              <th className=\"px-3 py-2 text-left\">ACCOUNT</th>\n                              <th className=\"px-3 py-2 text-right\">DEBIT</th>\n                              <th className=\"px-3 py-2 text-right\">CREDIT</th>\n                            </tr>\n                          </thead>\n                          <tbody>\n                            <tr className=\"border-b\">\n                              <td className=\"px-3 py-2\">Prepaid Expenses</td>\n                              <td className=\"px-3 py-2 text-right\">0.00</td>\n                              <td className=\"px-3 py-2 text-right\">{selectedPayment.paymentAmount.toFixed(2)}</td>\n                            </tr>\n                            <tr className=\"border-b\">\n                              <td className=\"px-3 py-2\">Accounts Payable</td>\n                              <td className=\"px-3 py-2 text-right\">{selectedPayment.paymentAmount.toFixed(2)}</td>\n                              <td className=\"px-3 py-2 text-right\">0.00</td>\n                            </tr>\n                            <tr className=\"font-bold bg-slate-100 dark:bg-slate-700\">\n                              <td className=\"px-3 py-2\"></td>\n                              <td className=\"px-3 py-2 text-right\">{selectedPayment.paymentAmount.toFixed(2)}</td>\n                              <td className=\"px-3 py-2 text-right\">{selectedPayment.paymentAmount.toFixed(2)}</td>\n                            </tr>\n                          </tbody>\n                        </table>\n                      </>\n                    )}\n                  </div>\n                </TabsContent>\n              </Tabs>\n            </div>\n          </div>\n        </div>\n      )}\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Payment</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete this payment? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={confirmDelete} className=\"bg-red-600 hover:bg-red-700\">\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":32872,"size_tokens":null},"client/src/store/authStore.ts":{"content":"import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\ninterface User {\n  id: string;\n  email: string;\n  name: string;\n  role: string;\n  permissions?: string[];\n  avatar?: string;\n}\n\ninterface AuthState {\n  user: User | null;\n  token: string | null;\n  isAuthenticated: boolean;\n  isLoading: boolean;\n  login: (user: User, token: string) => void;\n  logout: () => void;\n  setLoading: (loading: boolean) => void;\n  updateUser: (user: Partial<User>) => void;\n}\n\nexport const useAuthStore = create<AuthState>()(\n  persist(\n    (set) => ({\n      user: null,\n      token: null,\n      isAuthenticated: false,\n      isLoading: false,\n      login: (user, token) =>\n        set({ user, token, isAuthenticated: true, isLoading: false }),\n      logout: () =>\n        set({ user: null, token: null, isAuthenticated: false }),\n      setLoading: (loading) => set({ isLoading: loading }),\n      updateUser: (userData) =>\n        set((state) => ({\n          user: state.user ? { ...state.user, ...userData } : null,\n        })),\n    }),\n    {\n      name: 'auth-storage',\n      partialize: (state) => ({\n        user: state.user,\n        token: state.token,\n        isAuthenticated: state.isAuthenticated,\n      }),\n    }\n  )\n);\n","path":null,"size_bytes":1236,"size_tokens":null},"server/src/config/env.ts":{"content":"export const env = {\n  NODE_ENV: process.env.NODE_ENV || 'development',\n  PORT: parseInt(process.env.PORT || '5000', 10),\n  DATABASE_URL: process.env.DATABASE_URL,\n  SESSION_SECRET: process.env.SESSION_SECRET || 'default-secret-change-in-production',\n  JWT_SECRET: process.env.JWT_SECRET || 'jwt-secret-change-in-production',\n  JWT_EXPIRES_IN: process.env.JWT_EXPIRES_IN || '7d',\n  CORS_ORIGIN: process.env.CORS_ORIGIN || '*',\n  LOG_LEVEL: process.env.LOG_LEVEL || 'info',\n} as const;\n\nexport const isDev = env.NODE_ENV === 'development';\nexport const isProd = env.NODE_ENV === 'production';\nexport const isTest = env.NODE_ENV === 'test';\n\nexport default env;\n","path":null,"size_bytes":660,"size_tokens":null},"server/src/modules/vendors/routes/index.ts":{"content":"import { Router } from 'express';\n\nexport const vendorsRouter = Router();\n\nvendorsRouter.get('/', (req, res) => {\n  res.json({ success: true, data: [], message: 'Vendors endpoint' });\n});\n\nvendorsRouter.get('/:id', (req, res) => {\n  res.json({ success: true, data: { id: req.params.id }, message: 'Vendor detail endpoint' });\n});\n\nvendorsRouter.post('/', (req, res) => {\n  res.json({ success: true, data: req.body, message: 'Vendor created' });\n});\n\nexport default vendorsRouter;\n","path":null,"size_bytes":480,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n});\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  password: true,\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n","path":null,"size_bytes":584,"size_tokens":null},"server/src/common/responses/index.ts":{"content":"import { Response } from 'express';\n\nexport interface ApiResponse<T = any> {\n  success: boolean;\n  message?: string;\n  data?: T;\n  meta?: {\n    page?: number;\n    limit?: number;\n    total?: number;\n    totalPages?: number;\n  };\n}\n\nexport const sendSuccess = <T>(\n  res: Response,\n  data?: T,\n  message?: string,\n  statusCode: number = 200\n): Response => {\n  return res.status(statusCode).json({\n    success: true,\n    message,\n    data,\n  });\n};\n\nexport const sendCreated = <T>(\n  res: Response,\n  data?: T,\n  message: string = 'Created successfully'\n): Response => {\n  return sendSuccess(res, data, message, 201);\n};\n\nexport const sendPaginated = <T>(\n  res: Response,\n  data: T[],\n  page: number,\n  limit: number,\n  total: number,\n  message?: string\n): Response => {\n  return res.status(200).json({\n    success: true,\n    message,\n    data,\n    meta: {\n      page,\n      limit,\n      total,\n      totalPages: Math.ceil(total / limit),\n    },\n  });\n};\n\nexport const sendNoContent = (res: Response): Response => {\n  return res.status(204).send();\n};\n\nexport const sendError = (\n  res: Response,\n  message: string,\n  statusCode: number = 400,\n  code?: string,\n  errors?: Record<string, string[]>\n): Response => {\n  const response: any = {\n    success: false,\n    message,\n    code,\n  };\n\n  if (errors) {\n    response.errors = errors;\n  }\n\n  return res.status(statusCode).json(response);\n};\n","path":null,"size_bytes":1390,"size_tokens":null},"client/src/modules/dashboard/pages/DashboardPage.tsx":{"content":"export { default } from '@/pages/dashboard';\n","path":null,"size_bytes":45,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport {\n  ChevronDownIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon,\n} from \"lucide-react\"\nimport { DayButton, DayPicker, getDefaultClassNames } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button, buttonVariants } from \"@/components/ui/button\"\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  captionLayout = \"label\",\n  buttonVariant = \"ghost\",\n  formatters,\n  components,\n  ...props\n}: React.ComponentProps<typeof DayPicker> & {\n  buttonVariant?: React.ComponentProps<typeof Button>[\"variant\"]\n}) {\n  const defaultClassNames = getDefaultClassNames()\n\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\n        \"bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent\",\n        String.raw`rtl:**:[.rdp-button\\_next>svg]:rotate-180`,\n        String.raw`rtl:**:[.rdp-button\\_previous>svg]:rotate-180`,\n        className\n      )}\n      captionLayout={captionLayout}\n      formatters={{\n        formatMonthDropdown: (date) =>\n          date.toLocaleString(\"default\", { month: \"short\" }),\n        ...formatters,\n      }}\n      classNames={{\n        root: cn(\"w-fit\", defaultClassNames.root),\n        months: cn(\n          \"relative flex flex-col gap-4 md:flex-row\",\n          defaultClassNames.months\n        ),\n        month: cn(\"flex w-full flex-col gap-4\", defaultClassNames.month),\n        nav: cn(\n          \"absolute inset-x-0 top-0 flex w-full items-center justify-between gap-1\",\n          defaultClassNames.nav\n        ),\n        button_previous: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_previous\n        ),\n        button_next: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_next\n        ),\n        month_caption: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center px-[--cell-size]\",\n          defaultClassNames.month_caption\n        ),\n        dropdowns: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center gap-1.5 text-sm font-medium\",\n          defaultClassNames.dropdowns\n        ),\n        dropdown_root: cn(\n          \"has-focus:border-ring border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] relative rounded-md border\",\n          defaultClassNames.dropdown_root\n        ),\n        dropdown: cn(\n          \"bg-popover absolute inset-0 opacity-0\",\n          defaultClassNames.dropdown\n        ),\n        caption_label: cn(\n          \"select-none font-medium\",\n          captionLayout === \"label\"\n            ? \"text-sm\"\n            : \"[&>svg]:text-muted-foreground flex h-8 items-center gap-1 rounded-md pl-2 pr-1 text-sm [&>svg]:size-3.5\",\n          defaultClassNames.caption_label\n        ),\n        table: \"w-full border-collapse\",\n        weekdays: cn(\"flex\", defaultClassNames.weekdays),\n        weekday: cn(\n          \"text-muted-foreground flex-1 select-none rounded-md text-[0.8rem] font-normal\",\n          defaultClassNames.weekday\n        ),\n        week: cn(\"mt-2 flex w-full\", defaultClassNames.week),\n        week_number_header: cn(\n          \"w-[--cell-size] select-none\",\n          defaultClassNames.week_number_header\n        ),\n        week_number: cn(\n          \"text-muted-foreground select-none text-[0.8rem]\",\n          defaultClassNames.week_number\n        ),\n        day: cn(\n          \"group/day relative aspect-square h-full w-full select-none p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md\",\n          defaultClassNames.day\n        ),\n        range_start: cn(\n          \"bg-accent rounded-l-md\",\n          defaultClassNames.range_start\n        ),\n        range_middle: cn(\"rounded-none\", defaultClassNames.range_middle),\n        range_end: cn(\"bg-accent rounded-r-md\", defaultClassNames.range_end),\n        today: cn(\n          \"bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none\",\n          defaultClassNames.today\n        ),\n        outside: cn(\n          \"text-muted-foreground aria-selected:text-muted-foreground\",\n          defaultClassNames.outside\n        ),\n        disabled: cn(\n          \"text-muted-foreground opacity-50\",\n          defaultClassNames.disabled\n        ),\n        hidden: cn(\"invisible\", defaultClassNames.hidden),\n        ...classNames,\n      }}\n      components={{\n        Root: ({ className, rootRef, ...props }) => {\n          return (\n            <div\n              data-slot=\"calendar\"\n              ref={rootRef}\n              className={cn(className)}\n              {...props}\n            />\n          )\n        },\n        Chevron: ({ className, orientation, ...props }) => {\n          if (orientation === \"left\") {\n            return (\n              <ChevronLeftIcon className={cn(\"size-4\", className)} {...props} />\n            )\n          }\n\n          if (orientation === \"right\") {\n            return (\n              <ChevronRightIcon\n                className={cn(\"size-4\", className)}\n                {...props}\n              />\n            )\n          }\n\n          return (\n            <ChevronDownIcon className={cn(\"size-4\", className)} {...props} />\n          )\n        },\n        DayButton: CalendarDayButton,\n        WeekNumber: ({ children, ...props }) => {\n          return (\n            <td {...props}>\n              <div className=\"flex size-[--cell-size] items-center justify-center text-center\">\n                {children}\n              </div>\n            </td>\n          )\n        },\n        ...components,\n      }}\n      {...props}\n    />\n  )\n}\n\nfunction CalendarDayButton({\n  className,\n  day,\n  modifiers,\n  ...props\n}: React.ComponentProps<typeof DayButton>) {\n  const defaultClassNames = getDefaultClassNames()\n\n  const ref = React.useRef<HTMLButtonElement>(null)\n  React.useEffect(() => {\n    if (modifiers.focused) ref.current?.focus()\n  }, [modifiers.focused])\n\n  return (\n    <Button\n      ref={ref}\n      variant=\"ghost\"\n      size=\"icon\"\n      data-day={day.date.toLocaleDateString()}\n      data-selected-single={\n        modifiers.selected &&\n        !modifiers.range_start &&\n        !modifiers.range_end &&\n        !modifiers.range_middle\n      }\n      data-range-start={modifiers.range_start}\n      data-range-end={modifiers.range_end}\n      data-range-middle={modifiers.range_middle}\n      className={cn(\n        \"data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 flex aspect-square h-auto w-full min-w-[--cell-size] flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70\",\n        defaultClassNames.day,\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Calendar, CalendarDayButton }\n","path":null,"size_bytes":7569,"size_tokens":null},"server/routes.ts":{"content":"import type { Express, Request, Response } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport * as fs from \"fs\";\nimport * as path from \"path\";\n\nconst DATA_DIR = path.join(import.meta.dirname, \"data\");\nconst ITEMS_FILE = path.join(DATA_DIR, \"items.json\");\nconst QUOTES_FILE = path.join(DATA_DIR, \"quotes.json\");\nconst CUSTOMERS_FILE = path.join(DATA_DIR, \"customers.json\");\nconst SALES_ORDERS_FILE = path.join(DATA_DIR, \"salesOrders.json\");\nconst INVOICES_FILE = path.join(DATA_DIR, \"invoices.json\");\nconst VENDORS_FILE = path.join(DATA_DIR, \"vendors.json\");\nconst DELIVERY_CHALLANS_FILE = path.join(DATA_DIR, \"deliveryChallans.json\");\nconst EXPENSES_FILE = path.join(DATA_DIR, \"expenses.json\");\nconst DASHBOARD_FILE = path.join(DATA_DIR, \"dashboard.json\");\nconst REPORTS_FILE = path.join(DATA_DIR, \"reports.json\");\nconst PURCHASE_ORDERS_FILE = path.join(DATA_DIR, \"purchaseOrders.json\");\nconst BILLS_FILE = path.join(DATA_DIR, \"bills.json\");\nconst SALESPERSONS_FILE = path.join(DATA_DIR, \"salespersons.json\");\nconst CREDIT_NOTES_FILE = path.join(DATA_DIR, \"creditNotes.json\");\nconst PAYMENTS_RECEIVED_FILE = path.join(DATA_DIR, \"paymentsReceived.json\");\nconst EWAY_BILLS_FILE = path.join(DATA_DIR, \"ewayBills.json\");\nconst UNITS_FILE = path.join(DATA_DIR, \"units.json\");\n\nfunction ensureDataDir() {\n  if (!fs.existsSync(DATA_DIR)) {\n    fs.mkdirSync(DATA_DIR, { recursive: true });\n  }\n}\n\nfunction readItems() {\n  ensureDataDir();\n  if (!fs.existsSync(ITEMS_FILE)) {\n    fs.writeFileSync(ITEMS_FILE, JSON.stringify({ items: [] }, null, 2));\n    return [];\n  }\n  const data = JSON.parse(fs.readFileSync(ITEMS_FILE, \"utf-8\"));\n  return data.items || [];\n}\n\nfunction writeItems(items: any[]) {\n  ensureDataDir();\n  fs.writeFileSync(ITEMS_FILE, JSON.stringify({ items }, null, 2));\n}\n\nconst DEFAULT_UNITS = [\n  { id: \"1\", name: \"box\", uqc: \"BOX\" },\n  { id: \"2\", name: \"cm\", uqc: \"CMS\" },\n  { id: \"3\", name: \"dz\", uqc: \"DOZ\" },\n  { id: \"4\", name: \"ft\", uqc: \"FTS\" },\n  { id: \"5\", name: \"g\", uqc: \"GMS\" },\n  { id: \"6\", name: \"in\", uqc: \"INC\" },\n  { id: \"7\", name: \"kg\", uqc: \"KGS\" },\n  { id: \"8\", name: \"km\", uqc: \"KME\" },\n  { id: \"9\", name: \"lb\", uqc: \"LBS\" },\n  { id: \"10\", name: \"mg\", uqc: \"MGS\" },\n  { id: \"11\", name: \"ml\", uqc: \"MLT\" },\n  { id: \"12\", name: \"m\", uqc: \"MTR\" },\n  { id: \"13\", name: \"pcs\", uqc: \"PCS\" },\n  { id: \"14\", name: \"ltr\", uqc: \"LTR\" },\n  { id: \"15\", name: \"ton\", uqc: \"TON\" },\n  { id: \"16\", name: \"pair\", uqc: \"PAR\" },\n  { id: \"17\", name: \"set\", uqc: \"SET\" },\n  { id: \"18\", name: \"sqm\", uqc: \"SQM\" },\n  { id: \"19\", name: \"sqft\", uqc: \"SQF\" }\n];\n\nconst DEFAULT_TAX_RATES = [\n  { id: \"1\", name: \"GST0\", rate: 0, label: \"GST0 [0%]\" },\n  { id: \"2\", name: \"GST5\", rate: 5, label: \"GST5 [5%]\" },\n  { id: \"3\", name: \"GST12\", rate: 12, label: \"GST12 [12%]\" },\n  { id: \"4\", name: \"GST18\", rate: 18, label: \"GST18 [18%]\" },\n  { id: \"5\", name: \"GST28\", rate: 28, label: \"GST28 [28%]\" },\n  { id: \"6\", name: \"IGST0\", rate: 0, label: \"IGST0 [0%]\" },\n  { id: \"7\", name: \"IGST5\", rate: 5, label: \"IGST5 [5%]\" },\n  { id: \"8\", name: \"IGST12\", rate: 12, label: \"IGST12 [12%]\" },\n  { id: \"9\", name: \"IGST18\", rate: 18, label: \"IGST18 [18%]\" },\n  { id: \"10\", name: \"IGST28\", rate: 28, label: \"IGST28 [28%]\" },\n  { id: \"11\", name: \"Exempt\", rate: 0, label: \"Exempt\" }\n];\n\nfunction readUnits() {\n  ensureDataDir();\n  if (!fs.existsSync(UNITS_FILE)) {\n    fs.writeFileSync(UNITS_FILE, JSON.stringify({ units: DEFAULT_UNITS }, null, 2));\n    return DEFAULT_UNITS;\n  }\n  const data = JSON.parse(fs.readFileSync(UNITS_FILE, \"utf-8\"));\n  return data.units || DEFAULT_UNITS;\n}\n\nfunction writeUnits(units: any[]) {\n  ensureDataDir();\n  fs.writeFileSync(UNITS_FILE, JSON.stringify({ units }, null, 2));\n}\n\nfunction readQuotesData() {\n  ensureDataDir();\n  if (!fs.existsSync(QUOTES_FILE)) {\n    const defaultData = { quotes: [], nextQuoteNumber: 1 };\n    fs.writeFileSync(QUOTES_FILE, JSON.stringify(defaultData, null, 2));\n    return defaultData;\n  }\n  return JSON.parse(fs.readFileSync(QUOTES_FILE, \"utf-8\"));\n}\n\nfunction writeQuotesData(data: any) {\n  ensureDataDir();\n  fs.writeFileSync(QUOTES_FILE, JSON.stringify(data, null, 2));\n}\n\nfunction readCustomersData() {\n  ensureDataDir();\n  if (!fs.existsSync(CUSTOMERS_FILE)) {\n    const defaultData = { customers: [], nextCustomerId: 1 };\n    fs.writeFileSync(CUSTOMERS_FILE, JSON.stringify(defaultData, null, 2));\n    return defaultData;\n  }\n  return JSON.parse(fs.readFileSync(CUSTOMERS_FILE, \"utf-8\"));\n}\n\nfunction writeCustomersData(data: any) {\n  ensureDataDir();\n  fs.writeFileSync(CUSTOMERS_FILE, JSON.stringify(data, null, 2));\n}\n\nfunction generateQuoteNumber(num: number): string {\n  return `QT-${String(num).padStart(6, '0')}`;\n}\n\nfunction readSalesOrdersData() {\n  ensureDataDir();\n  if (!fs.existsSync(SALES_ORDERS_FILE)) {\n    const defaultData = { salesOrders: [], nextSalesOrderNumber: 1, nextInvoiceNumber: 1 };\n    fs.writeFileSync(SALES_ORDERS_FILE, JSON.stringify(defaultData, null, 2));\n    return defaultData;\n  }\n  return JSON.parse(fs.readFileSync(SALES_ORDERS_FILE, \"utf-8\"));\n}\n\nfunction writeSalesOrdersData(data: any) {\n  ensureDataDir();\n  fs.writeFileSync(SALES_ORDERS_FILE, JSON.stringify(data, null, 2));\n}\n\nfunction generateSalesOrderNumber(num: number): string {\n  return `SO-${String(num).padStart(5, '0')}`;\n}\n\nfunction generateInvoiceNumber(num: number): string {\n  return `INV-${String(num).padStart(5, '0')}`;\n}\n\nfunction readInvoicesData() {\n  ensureDataDir();\n  if (!fs.existsSync(INVOICES_FILE)) {\n    const defaultData = { invoices: [], nextInvoiceNumber: 1 };\n    fs.writeFileSync(INVOICES_FILE, JSON.stringify(defaultData, null, 2));\n    return defaultData;\n  }\n  return JSON.parse(fs.readFileSync(INVOICES_FILE, \"utf-8\"));\n}\n\nfunction readSalespersonsData() {\n  ensureDataDir();\n  if (!fs.existsSync(SALESPERSONS_FILE)) {\n    const defaultData = { salespersons: [], nextSalespersonId: 1 };\n    fs.writeFileSync(SALESPERSONS_FILE, JSON.stringify(defaultData, null, 2));\n    return defaultData;\n  }\n  return JSON.parse(fs.readFileSync(SALESPERSONS_FILE, \"utf-8\"));\n}\n\nfunction writeSalespersonsData(data: any) {\n  ensureDataDir();\n  fs.writeFileSync(SALESPERSONS_FILE, JSON.stringify(data, null, 2));\n}\n\nfunction readPaymentsReceivedData() {\n  ensureDataDir();\n  if (!fs.existsSync(PAYMENTS_RECEIVED_FILE)) {\n    const defaultData = { paymentsReceived: [], nextPaymentNumber: 1 };\n    fs.writeFileSync(PAYMENTS_RECEIVED_FILE, JSON.stringify(defaultData, null, 2));\n    return defaultData;\n  }\n  return JSON.parse(fs.readFileSync(PAYMENTS_RECEIVED_FILE, \"utf-8\"));\n}\n\nfunction writePaymentsReceivedData(data: any) {\n  ensureDataDir();\n  fs.writeFileSync(PAYMENTS_RECEIVED_FILE, JSON.stringify(data, null, 2));\n}\n\nfunction generatePaymentNumber(num: number): string {\n  return String(num);\n}\n\nfunction readEWayBillsData() {\n  ensureDataDir();\n  if (!fs.existsSync(EWAY_BILLS_FILE)) {\n    const defaultData = { ewayBills: [], nextEWayBillNumber: 1 };\n    fs.writeFileSync(EWAY_BILLS_FILE, JSON.stringify(defaultData, null, 2));\n    return defaultData;\n  }\n  return JSON.parse(fs.readFileSync(EWAY_BILLS_FILE, \"utf-8\"));\n}\n\nfunction writeEWayBillsData(data: any) {\n  ensureDataDir();\n  fs.writeFileSync(EWAY_BILLS_FILE, JSON.stringify(data, null, 2));\n}\n\nfunction generateEWayBillNumber(num: number): string {\n  return `EWB-${String(num).padStart(6, '0')}`;\n}\n\n// Helper function for currency formatting on server\nfunction formatCurrencyServer(amount: number): string {\n  return new Intl.NumberFormat('en-IN', {\n    style: 'currency',\n    currency: 'INR',\n    minimumFractionDigits: 2\n  }).format(amount);\n}\n\nfunction numberToWords(num: number): string {\n  const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine',\n    'Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];\n  const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];\n\n  if (num === 0) return 'Zero';\n\n  const convertLessThanThousand = (n: number): string => {\n    if (n === 0) return '';\n    if (n < 20) return ones[n];\n    if (n < 100) return tens[Math.floor(n / 10)] + (n % 10 !== 0 ? ' ' + ones[n % 10] : '');\n    return ones[Math.floor(n / 100)] + ' Hundred' + (n % 100 !== 0 ? ' ' + convertLessThanThousand(n % 100) : '');\n  };\n\n  const intPart = Math.floor(num);\n  const rupees = intPart;\n\n  if (rupees >= 10000000) {\n    const crores = Math.floor(rupees / 10000000);\n    const remaining = rupees % 10000000;\n    let result = convertLessThanThousand(crores) + ' Crore';\n    if (remaining > 0) result += ' ' + numberToWords(remaining).replace('Indian Rupee ', '').replace(' Only', '');\n    return 'Indian Rupee ' + result + ' Only';\n  }\n  if (rupees >= 100000) {\n    const lakhs = Math.floor(rupees / 100000);\n    const remaining = rupees % 100000;\n    let result = convertLessThanThousand(lakhs) + ' Lakh';\n    if (remaining > 0) result += ' ' + numberToWords(remaining).replace('Indian Rupee ', '').replace(' Only', '');\n    return 'Indian Rupee ' + result + ' Only';\n  }\n  if (rupees >= 1000) {\n    const thousands = Math.floor(rupees / 1000);\n    const remaining = rupees % 1000;\n    let result = convertLessThanThousand(thousands) + ' Thousand';\n    if (remaining > 0) result += ' ' + convertLessThanThousand(remaining);\n    return 'Indian Rupee ' + result + ' Only';\n  }\n  return 'Indian Rupee ' + convertLessThanThousand(rupees) + ' Only';\n}\n\nfunction readCreditNotesData() {\n  ensureDataDir();\n  if (!fs.existsSync(CREDIT_NOTES_FILE)) {\n    const defaultData = { creditNotes: [], nextCreditNoteNumber: 1 };\n    fs.writeFileSync(CREDIT_NOTES_FILE, JSON.stringify(defaultData, null, 2));\n    return defaultData;\n  }\n  return JSON.parse(fs.readFileSync(CREDIT_NOTES_FILE, \"utf-8\"));\n}\n\nfunction writeCreditNotesData(data: any) {\n  ensureDataDir();\n  fs.writeFileSync(CREDIT_NOTES_FILE, JSON.stringify(data, null, 2));\n}\n\nfunction generateCreditNoteNumber(num: number): string {\n  return `CN-${String(num).padStart(5, '0')}`;\n}\n\n\nfunction writeInvoicesData(data: any) {\n  ensureDataDir();\n  fs.writeFileSync(INVOICES_FILE, JSON.stringify(data, null, 2));\n}\n\nfunction readVendorsData() {\n  ensureDataDir();\n  if (!fs.existsSync(VENDORS_FILE)) {\n    const defaultData = { vendors: [], nextVendorId: 1 };\n    fs.writeFileSync(VENDORS_FILE, JSON.stringify(defaultData, null, 2));\n    return defaultData;\n  }\n  return JSON.parse(fs.readFileSync(VENDORS_FILE, \"utf-8\"));\n}\n\nfunction writeVendorsData(data: any) {\n  ensureDataDir();\n  fs.writeFileSync(VENDORS_FILE, JSON.stringify(data, null, 2));\n}\n\nfunction readDeliveryChallansData() {\n  ensureDataDir();\n  if (!fs.existsSync(DELIVERY_CHALLANS_FILE)) {\n    const defaultData = { deliveryChallans: [], nextChallanNumber: 1 };\n    fs.writeFileSync(DELIVERY_CHALLANS_FILE, JSON.stringify(defaultData, null, 2));\n    return defaultData;\n  }\n  return JSON.parse(fs.readFileSync(DELIVERY_CHALLANS_FILE, \"utf-8\"));\n}\n\nfunction writeDeliveryChallansData(data: any) {\n  ensureDataDir();\n  fs.writeFileSync(DELIVERY_CHALLANS_FILE, JSON.stringify(data, null, 2));\n}\n\nfunction generateChallanNumber(num: number): string {\n  return `DC-${String(num).padStart(5, '0')}`;\n}\n\nfunction readExpensesData() {\n  ensureDataDir();\n  if (!fs.existsSync(EXPENSES_FILE)) {\n    const defaultData = {\n      expenses: [],\n      mileageRecords: [],\n      mileageSettings: {\n        associateEmployeesToExpenses: false,\n        defaultMileageCategory: \"Fuel/Mileage Expense\",\n        defaultUnit: \"km\",\n        mileageRates: []\n      },\n      nextExpenseId: 1,\n      nextMileageId: 1\n    };\n    fs.writeFileSync(EXPENSES_FILE, JSON.stringify(defaultData, null, 2));\n    return defaultData;\n  }\n  return JSON.parse(fs.readFileSync(EXPENSES_FILE, \"utf-8\"));\n}\n\nfunction writeExpensesData(data: any) {\n  ensureDataDir();\n  fs.writeFileSync(EXPENSES_FILE, JSON.stringify(data, null, 2));\n}\n\nfunction generateExpenseNumber(num: number): string {\n  return `EXP-${String(num).padStart(5, '0')}`;\n}\n\nfunction readDashboardData() {\n  ensureDataDir();\n  if (!fs.existsSync(DASHBOARD_FILE)) {\n    const defaultData = {\n      summary: { totalReceivables: { totalUnpaid: 0, current: 0, overdue: 0 }, totalPayables: { totalUnpaid: 0, current: 0, overdue: 0 } },\n      cashFlow: [],\n      incomeExpense: [],\n      topExpenses: []\n    };\n    fs.writeFileSync(DASHBOARD_FILE, JSON.stringify(defaultData, null, 2));\n    return defaultData;\n  }\n  return JSON.parse(fs.readFileSync(DASHBOARD_FILE, \"utf-8\"));\n}\n\nfunction writeDashboardData(data: any) {\n  ensureDataDir();\n  fs.writeFileSync(DASHBOARD_FILE, JSON.stringify(data, null, 2));\n}\n\nfunction readReportsData() {\n  ensureDataDir();\n  if (!fs.existsSync(REPORTS_FILE)) {\n    const defaultData = {\n      profitAndLoss: { totalIncome: 0, totalExpenses: 0, netProfit: 0, monthlyData: [] },\n      salesByCustomer: [],\n      expenseBreakdown: []\n    };\n    fs.writeFileSync(REPORTS_FILE, JSON.stringify(defaultData, null, 2));\n    return defaultData;\n  }\n  return JSON.parse(fs.readFileSync(REPORTS_FILE, \"utf-8\"));\n}\n\nfunction writeReportsData(data: any) {\n  ensureDataDir();\n  fs.writeFileSync(REPORTS_FILE, JSON.stringify(data, null, 2));\n}\n\nfunction readPurchaseOrdersData() {\n  ensureDataDir();\n  if (!fs.existsSync(PURCHASE_ORDERS_FILE)) {\n    const defaultData = { purchaseOrders: [], nextPurchaseOrderNumber: 1 };\n    fs.writeFileSync(PURCHASE_ORDERS_FILE, JSON.stringify(defaultData, null, 2));\n    return defaultData;\n  }\n  return JSON.parse(fs.readFileSync(PURCHASE_ORDERS_FILE, \"utf-8\"));\n}\n\nfunction writePurchaseOrdersData(data: any) {\n  ensureDataDir();\n  fs.writeFileSync(PURCHASE_ORDERS_FILE, JSON.stringify(data, null, 2));\n}\n\nfunction generatePurchaseOrderNumber(num: number): string {\n  return `PO-2025-${String(num).padStart(4, '0')}`;\n}\n\nfunction readBillsData() {\n  ensureDataDir();\n  if (!fs.existsSync(BILLS_FILE)) {\n    const defaultData = {\n      bills: [],\n      nextBillNumber: 1,\n      accounts: [\n        { id: '1', name: 'Cost of Goods Sold', type: 'expense' },\n        { id: '2', name: 'Office Supplies', type: 'expense' },\n        { id: '3', name: 'Software', type: 'expense' },\n        { id: '4', name: 'Professional Services', type: 'expense' },\n        { id: '5', name: 'Utilities', type: 'expense' },\n        { id: '6', name: 'Rent', type: 'expense' },\n        { id: '7', name: 'Travel Expense', type: 'expense' },\n        { id: '8', name: 'Marketing', type: 'expense' }\n      ],\n      taxes: [\n        { id: '1', name: 'IGST18', rate: 18 },\n        { id: '2', name: 'CGST9', rate: 9 },\n        { id: '3', name: 'SGST9', rate: 9 },\n        { id: '4', name: 'GST5', rate: 5 },\n        { id: '5', name: 'GST12', rate: 12 },\n        { id: '6', name: 'GST28', rate: 28 }\n      ]\n    };\n    fs.writeFileSync(BILLS_FILE, JSON.stringify(defaultData, null, 2));\n    return defaultData;\n  }\n  return JSON.parse(fs.readFileSync(BILLS_FILE, \"utf-8\"));\n}\n\nfunction writeBillsData(data: any) {\n  ensureDataDir();\n  fs.writeFileSync(BILLS_FILE, JSON.stringify(data, null, 2));\n}\n\nfunction generateBillNumber(num: number): string {\n  return String(num);\n}\n\n// Payments Made Helper Functions (defined early for use in bills record-payment)\nconst PAYMENTS_MADE_FILE_PATH = path.join(DATA_DIR, \"paymentsMade.json\");\n\nfunction readPaymentsMadeDataGlobal() {\n  ensureDataDir();\n  if (!fs.existsSync(PAYMENTS_MADE_FILE_PATH)) {\n    const defaultData = { paymentsMade: [], nextPaymentNumber: 1 };\n    fs.writeFileSync(PAYMENTS_MADE_FILE_PATH, JSON.stringify(defaultData, null, 2));\n    return defaultData;\n  }\n  return JSON.parse(fs.readFileSync(PAYMENTS_MADE_FILE_PATH, \"utf-8\"));\n}\n\nfunction writePaymentsMadeDataGlobal(data: any) {\n  ensureDataDir();\n  fs.writeFileSync(PAYMENTS_MADE_FILE_PATH, JSON.stringify(data, null, 2));\n}\n\nfunction generatePaymentMadeNumberGlobal(num: number): string {\n  return `PM-${String(num).padStart(5, '0')}`;\n}\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n\n  // Units API\n  app.get(\"/api/units\", (req: Request, res: Response) => {\n    try {\n      const units = readUnits();\n      res.json({ success: true, data: units });\n    } catch (error) {\n      res.status(500).json({ success: false, error: \"Failed to read units\" });\n    }\n  });\n\n  app.post(\"/api/units\", (req: Request, res: Response) => {\n    try {\n      const units = readUnits();\n      const { name, uqc } = req.body;\n\n      // Validate required fields\n      if (!name || !uqc) {\n        return res.status(400).json({ success: false, error: \"Unit name and UQC are required\" });\n      }\n\n      // Check for duplicate unit name\n      const existingUnit = units.find((u: any) => u.name.toLowerCase() === name.toLowerCase());\n      if (existingUnit) {\n        return res.status(400).json({ success: false, error: \"Unit name already exists\" });\n      }\n\n      // Check for duplicate UQC\n      const existingUqc = units.find((u: any) => u.uqc.toUpperCase() === uqc.toUpperCase());\n      if (existingUqc) {\n        return res.status(400).json({ success: false, error: \"UQC code already exists\" });\n      }\n\n      const newUnit = {\n        id: Date.now().toString(),\n        name: name.toLowerCase(),\n        uqc: uqc.toUpperCase()\n      };\n      units.push(newUnit);\n      writeUnits(units);\n      res.status(201).json({ success: true, data: newUnit });\n    } catch (error) {\n      res.status(500).json({ success: false, error: \"Failed to create unit\" });\n    }\n  });\n\n  app.put(\"/api/units/:id\", (req: Request, res: Response) => {\n    try {\n      const units = readUnits();\n      const index = units.findIndex((u: any) => u.id === req.params.id);\n      if (index === -1) {\n        return res.status(404).json({ success: false, error: \"Unit not found\" });\n      }\n\n      const { name, uqc } = req.body;\n\n      // Check for duplicate unit name (excluding current unit)\n      const existingUnit = units.find((u: any, i: number) =>\n        i !== index && u.name.toLowerCase() === name.toLowerCase()\n      );\n      if (existingUnit) {\n        return res.status(400).json({ success: false, error: \"Unit name already exists\" });\n      }\n\n      // Check for duplicate UQC (excluding current unit)\n      const existingUqc = units.find((u: any, i: number) =>\n        i !== index && u.uqc.toUpperCase() === uqc.toUpperCase()\n      );\n      if (existingUqc) {\n        return res.status(400).json({ success: false, error: \"UQC code already exists\" });\n      }\n\n      units[index] = {\n        ...units[index],\n        name: name.toLowerCase(),\n        uqc: uqc.toUpperCase()\n      };\n      writeUnits(units);\n      res.json({ success: true, data: units[index] });\n    } catch (error) {\n      res.status(500).json({ success: false, error: \"Failed to update unit\" });\n    }\n  });\n\n  app.delete(\"/api/units/:id\", (req: Request, res: Response) => {\n    try {\n      const units = readUnits();\n      const index = units.findIndex((u: any) => u.id === req.params.id);\n      if (index === -1) {\n        return res.status(404).json({ success: false, error: \"Unit not found\" });\n      }\n      units.splice(index, 1);\n      writeUnits(units);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ success: false, error: \"Failed to delete unit\" });\n    }\n  });\n\n  // Tax Rates API\n  app.get(\"/api/taxRates\", (req: Request, res: Response) => {\n    try {\n      res.json({ success: true, data: DEFAULT_TAX_RATES });\n    } catch (error) {\n      res.status(500).json({ success: false, error: \"Failed to read tax rates\" });\n    }\n  });\n\n  // Items API\n  app.get(\"/api/items\", (req: Request, res: Response) => {\n    try {\n      let items = readItems();\n      const page = parseInt(req.query.page as string) || 1;\n      const limit = parseInt(req.query.limit as string) || 1000;\n      const status = req.query.status as string;\n\n      // Filter by status\n      if (status === 'active') {\n        items = items.filter((item: any) => item.isActive === true);\n      } else if (status === 'inactive') {\n        items = items.filter((item: any) => item.isActive === false);\n      }\n      // 'all' or no status returns all items\n\n      const offset = (page - 1) * limit;\n      const paginatedItems = items.slice(offset, offset + limit);\n\n      res.json({\n        success: true,\n        data: paginatedItems,\n        meta: {\n          page,\n          limit,\n          total: items.length,\n          totalPages: Math.ceil(items.length / limit)\n        }\n      });\n    } catch (error) {\n      res.status(500).json({ success: false, error: \"Failed to read items\" });\n    }\n  });\n\n  app.get(\"/api/items/:id\", (req: Request, res: Response) => {\n    try {\n      const items = readItems();\n      const item = items.find((i: any) => i.id === req.params.id);\n      if (!item) {\n        return res.status(404).json({ error: \"Item not found\" });\n      }\n      res.json(item);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to read item\" });\n    }\n  });\n\n  app.post(\"/api/items\", (req: Request, res: Response) => {\n    try {\n      const items = readItems();\n      const newItem = {\n        id: Date.now().toString(),\n        ...req.body,\n        isActive: true,\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString()\n      };\n      items.push(newItem);\n      writeItems(items);\n      res.status(201).json(newItem);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create item\" });\n    }\n  });\n\n  app.put(\"/api/items/:id\", (req: Request, res: Response) => {\n    try {\n      const items = readItems();\n      const index = items.findIndex((i: any) => i.id === req.params.id);\n      if (index === -1) {\n        return res.status(404).json({ error: \"Item not found\" });\n      }\n      items[index] = {\n        ...items[index],\n        ...req.body,\n        updatedAt: new Date().toISOString()\n      };\n      writeItems(items);\n      res.json(items[index]);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update item\" });\n    }\n  });\n\n  app.delete(\"/api/items/:id\", (req: Request, res: Response) => {\n    try {\n      const items = readItems();\n      const index = items.findIndex((i: any) => i.id === req.params.id);\n      if (index === -1) {\n        return res.status(404).json({ error: \"Item not found\" });\n      }\n      items.splice(index, 1);\n      writeItems(items);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete item\" });\n    }\n  });\n\n  // Clone an item\n  app.post(\"/api/items/:id/clone\", (req: Request, res: Response) => {\n    try {\n      const items = readItems();\n      const item = items.find((i: any) => i.id === req.params.id);\n      if (!item) {\n        return res.status(404).json({ error: \"Item not found\" });\n      }\n      const clonedItem = {\n        ...item,\n        id: Date.now().toString(),\n        name: `${item.name} (Copy)`,\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString()\n      };\n      items.push(clonedItem);\n      writeItems(items);\n      res.status(201).json(clonedItem);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to clone item\" });\n    }\n  });\n\n  // Toggle item active status\n  app.patch(\"/api/items/:id/status\", (req: Request, res: Response) => {\n    try {\n      const items = readItems();\n      const index = items.findIndex((i: any) => i.id === req.params.id);\n      if (index === -1) {\n        return res.status(404).json({ error: \"Item not found\" });\n      }\n      items[index] = {\n        ...items[index],\n        isActive: req.body.isActive,\n        updatedAt: new Date().toISOString()\n      };\n      writeItems(items);\n      res.json(items[index]);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update item status\" });\n    }\n  });\n\n  // Customers API\n  app.get(\"/api/customers\", (req: Request, res: Response) => {\n    try {\n      const data = readCustomersData();\n      res.json({ success: true, data: data.customers });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch customers\" });\n    }\n  });\n\n  app.get(\"/api/customers/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readCustomersData();\n      const customer = data.customers.find((c: any) => c.id === req.params.id);\n      if (!customer) {\n        return res.status(404).json({ success: false, message: \"Customer not found\" });\n      }\n      res.json({ success: true, data: customer });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch customer\" });\n    }\n  });\n\n  app.post(\"/api/customers\", (req: Request, res: Response) => {\n    try {\n      const data = readCustomersData();\n      const newCustomer = {\n        id: String(data.nextCustomerId),\n        ...req.body,\n        status: req.body.status || \"active\",\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString()\n      };\n      data.customers.push(newCustomer);\n      data.nextCustomerId += 1;\n      writeCustomersData(data);\n      res.status(201).json({ success: true, data: newCustomer });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to create customer\" });\n    }\n  });\n\n  app.put(\"/api/customers/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readCustomersData();\n      const index = data.customers.findIndex((c: any) => c.id === req.params.id);\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Customer not found\" });\n      }\n      data.customers[index] = {\n        ...data.customers[index],\n        ...req.body,\n        updatedAt: new Date().toISOString()\n      };\n      writeCustomersData(data);\n      res.json({ success: true, data: data.customers[index] });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to update customer\" });\n    }\n  });\n\n  app.delete(\"/api/customers/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readCustomersData();\n      const index = data.customers.findIndex((c: any) => c.id === req.params.id);\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Customer not found\" });\n      }\n      data.customers.splice(index, 1);\n      writeCustomersData(data);\n      res.json({ success: true, message: \"Customer deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to delete customer\" });\n    }\n  });\n\n  app.post(\"/api/customers/:id/clone\", (req: Request, res: Response) => {\n    try {\n      const data = readCustomersData();\n      const customer = data.customers.find((c: any) => c.id === req.params.id);\n      if (!customer) {\n        return res.status(404).json({ success: false, message: \"Customer not found\" });\n      }\n      const clonedCustomer = {\n        ...customer,\n        id: String(data.nextCustomerId),\n        name: `${customer.name} (Copy)`,\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString()\n      };\n      data.customers.push(clonedCustomer);\n      data.nextCustomerId += 1;\n      writeCustomersData(data);\n      res.status(201).json({ success: true, data: clonedCustomer });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to clone customer\" });\n    }\n  });\n\n  app.patch(\"/api/customers/:id/status\", (req: Request, res: Response) => {\n    try {\n      const data = readCustomersData();\n      const index = data.customers.findIndex((c: any) => c.id === req.params.id);\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Customer not found\" });\n      }\n      data.customers[index] = {\n        ...data.customers[index],\n        status: req.body.status,\n        updatedAt: new Date().toISOString()\n      };\n      writeCustomersData(data);\n      res.json({ success: true, data: data.customers[index] });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to update customer status\" });\n    }\n  });\n\n  // Customer Comments API\n  app.get(\"/api/customers/:id/comments\", (req: Request, res: Response) => {\n    try {\n      const data = readCustomersData();\n      const customer = data.customers.find((c: any) => c.id === req.params.id);\n      if (!customer) {\n        return res.status(404).json({ success: false, message: \"Customer not found\" });\n      }\n      res.json({ success: true, data: customer.comments || [] });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch comments\" });\n    }\n  });\n\n  app.post(\"/api/customers/:id/comments\", (req: Request, res: Response) => {\n    try {\n      const data = readCustomersData();\n      const index = data.customers.findIndex((c: any) => c.id === req.params.id);\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Customer not found\" });\n      }\n      const newComment = {\n        id: String(Date.now()),\n        text: req.body.text,\n        author: req.body.author || \"Admin User\",\n        createdAt: new Date().toISOString()\n      };\n      if (!data.customers[index].comments) {\n        data.customers[index].comments = [];\n      }\n      data.customers[index].comments.push(newComment);\n      writeCustomersData(data);\n      res.status(201).json({ success: true, data: newComment });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to add comment\" });\n    }\n  });\n\n  // Customer Transactions API\n  app.get(\"/api/customers/:id/transactions\", (req: Request, res: Response) => {\n    try {\n      const customerId = req.params.id;\n      const invoicesData = readInvoicesData();\n      const quotesData = readQuotesData();\n      const salesOrdersData = readSalesOrdersData();\n      const paymentsData = readPaymentsReceivedData();\n\n      const customerInvoices = (invoicesData.invoices || []).filter((inv: any) => inv.customerId === customerId);\n      const customerQuotes = (quotesData.quotes || []).filter((q: any) => q.customerId === customerId);\n      const customerSalesOrders = (salesOrdersData.salesOrders || []).filter((so: any) => so.customerId === customerId);\n      const customerPayments = (paymentsData.paymentsReceived || []).filter((payment: any) => payment.customerId === customerId);\n\n      res.json({\n        success: true,\n        data: {\n          invoices: customerInvoices.map((inv: any) => ({\n            id: inv.id,\n            type: 'invoice',\n            date: inv.date || inv.invoiceDate,\n            number: inv.invoiceNumber,\n            orderNumber: inv.salesOrderNumber || '',\n            amount: inv.total || 0,\n            balance: inv.balanceDue || inv.total || 0,\n            status: inv.status || 'Draft'\n          })),\n          customerPayments: customerPayments.map((payment: any) => ({\n            id: payment.id,\n            type: 'payment',\n            date: payment.date,\n            number: payment.paymentNumber,\n            referenceNumber: payment.referenceNumber || '',\n            amount: payment.amount || 0,\n            unusedCredits: payment.unusedAmount || 0,\n            mode: payment.mode || 'Cash',\n            status: payment.status || 'Received'\n          })),\n          quotes: customerQuotes.map((q: any) => ({\n            id: q.id,\n            type: 'quote',\n            date: q.date,\n            number: q.quoteNumber,\n            orderNumber: q.referenceNumber || '',\n            amount: q.total || 0,\n            balance: 0,\n            status: q.status || 'Draft'\n          })),\n          salesOrders: customerSalesOrders.map((so: any) => ({\n            id: so.id,\n            type: 'salesOrder',\n            date: so.date || so.salesOrderDate,\n            number: so.salesOrderNumber,\n            orderNumber: so.referenceNumber || '',\n            amount: so.total || 0,\n            balance: 0,\n            status: so.status || 'Draft'\n          })),\n          deliveryChallans: [],\n          recurringInvoices: [],\n          expenses: [],\n          projects: [],\n          journals: [],\n          bills: [],\n          creditNotes: []\n        }\n      });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch transactions\" });\n    }\n  });\n\n  // Customer Mails API\n  app.get(\"/api/customers/:id/mails\", (req: Request, res: Response) => {\n    try {\n      const data = readCustomersData();\n      const customer = data.customers.find((c: any) => c.id === req.params.id);\n      if (!customer) {\n        return res.status(404).json({ success: false, message: \"Customer not found\" });\n      }\n      res.json({ success: true, data: customer.mails || [] });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch mails\" });\n    }\n  });\n\n  // Customer Activities API\n  app.get(\"/api/customers/:id/activities\", (req: Request, res: Response) => {\n    try {\n      const data = readCustomersData();\n      const customer = data.customers.find((c: any) => c.id === req.params.id);\n      if (!customer) {\n        return res.status(404).json({ success: false, message: \"Customer not found\" });\n      }\n\n      // Generate activities from transactions\n      const activities: any[] = [];\n      const customerId = req.params.id;\n\n      // Get invoices for this customer\n      try {\n        const invoicesData = readInvoicesData();\n        const customerInvoices = invoicesData.invoices.filter((inv: any) => inv.customerId === customerId);\n        customerInvoices.forEach((inv: any) => {\n          activities.push({\n            id: `activity-inv-${inv.id}`,\n            type: 'invoice',\n            title: `Invoice ${inv.invoiceNumber} Created`,\n            description: `Invoice created for ${formatCurrencyServer(inv.total || 0)}`,\n            user: 'System',\n            date: inv.createdAt || inv.date,\n            time: new Date(inv.createdAt || inv.date).toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' })\n          });\n        });\n      } catch (e) { /* ignore */ }\n\n      // Get payments for this customer\n      try {\n        const paymentsData = readPaymentsReceivedData();\n        const customerPayments = paymentsData.paymentsReceived.filter((p: any) => p.customerId === customerId);\n        customerPayments.forEach((payment: any) => {\n          activities.push({\n            id: `activity-pay-${payment.id}`,\n            type: 'payment',\n            title: `Payment ${payment.paymentNumber} Received`,\n            description: `Payment of ${formatCurrencyServer(payment.amount || 0)} received`,\n            user: 'System',\n            date: payment.createdAt || payment.date,\n            time: new Date(payment.createdAt || payment.date).toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' })\n          });\n        });\n      } catch (e) { /* ignore */ }\n\n      // Get quotes for this customer\n      try {\n        const quotesData = readQuotesData();\n        const customerQuotes = quotesData.quotes.filter((q: any) => q.customerId === customerId);\n        customerQuotes.forEach((quote: any) => {\n          activities.push({\n            id: `activity-quote-${quote.id}`,\n            type: 'quote',\n            title: `Quote ${quote.quoteNumber} Created`,\n            description: `Quote created for ${formatCurrencyServer(quote.total || 0)}`,\n            user: 'System',\n            date: quote.createdAt || quote.date,\n            time: new Date(quote.createdAt || quote.date).toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' })\n          });\n        });\n      } catch (e) { /* ignore */ }\n\n      // Get sales orders for this customer\n      try {\n        const salesOrdersData = readSalesOrdersData();\n        const customerSalesOrders = salesOrdersData.salesOrders.filter((so: any) => so.customerId === customerId);\n        customerSalesOrders.forEach((so: any) => {\n          activities.push({\n            id: `activity-so-${so.id}`,\n            type: 'sales_order',\n            title: `Sales Order ${so.salesOrderNumber} Created`,\n            description: `Sales order created for ${formatCurrencyServer(so.total || 0)}`,\n            user: 'System',\n            date: so.createdAt || so.date,\n            time: new Date(so.createdAt || so.date).toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' })\n          });\n        });\n      } catch (e) { /* ignore */ }\n\n      // Get credit notes for this customer\n      try {\n        const creditNotesData = readCreditNotesData();\n        const customerCreditNotes = creditNotesData.creditNotes.filter((cn: any) => cn.customerId === customerId);\n        customerCreditNotes.forEach((cn: any) => {\n          activities.push({\n            id: `activity-cn-${cn.id}`,\n            type: 'credit_note',\n            title: `Credit Note ${cn.creditNoteNumber} Created`,\n            description: `Credit note for ${formatCurrencyServer(cn.total || 0)}`,\n            user: 'System',\n            date: cn.createdAt || cn.date,\n            time: new Date(cn.createdAt || cn.date).toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' })\n          });\n        });\n      } catch (e) { /* ignore */ }\n\n      // Add customer creation activity\n      if (customer.createdAt) {\n        activities.push({\n          id: `activity-customer-created-${customer.id}`,\n          type: 'customer',\n          title: 'Customer Created',\n          description: `Customer ${customer.displayName || customer.name} was created`,\n          user: 'System',\n          date: customer.createdAt,\n          time: new Date(customer.createdAt).toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' })\n        });\n      }\n\n      // Sort by date (most recent first)\n      activities.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\n\n      res.json({ success: true, data: activities });\n    } catch (error) {\n      console.error('Error fetching activities:', error);\n      res.status(500).json({ success: false, message: \"Failed to fetch activities\" });\n    }\n  });\n\n  // Customer Purchased Items API\n  app.get(\"/api/customers/:id/purchased-items\", (req: Request, res: Response) => {\n    try {\n      const invoicesData = readInvoicesData();\n      const customerId = req.params.id;\n\n      // Get all invoices for this customer\n      const customerInvoices = invoicesData.invoices.filter((invoice: any) => invoice.customerId === customerId);\n\n      // Extract all unique items from these invoices\n      const purchasedItems = new Map();\n\n      customerInvoices.forEach((invoice: any) => {\n        if (invoice.items && Array.isArray(invoice.items)) {\n          invoice.items.forEach((item: any) => {\n            const itemKey = item.itemId || item.name; // Use itemId if available, otherwise name\n            if (purchasedItems.has(itemKey)) {\n              // Update quantity and last purchase date\n              const existing = purchasedItems.get(itemKey);\n              existing.totalQuantity += item.quantity || 0;\n              existing.lastPurchaseDate = invoice.date > existing.lastPurchaseDate ? invoice.date : existing.lastPurchaseDate;\n              existing.totalAmount += item.amount || 0;\n              existing.purchaseCount += 1;\n            } else {\n              // Add new item\n              purchasedItems.set(itemKey, {\n                id: item.itemId || `${item.name}-${Math.random().toString(36).substr(2, 9)}`,\n                itemId: item.itemId,\n                name: item.name,\n                description: item.description || '',\n                unit: item.unit || 'pcs',\n                lastRate: item.rate || 0,\n                totalQuantity: item.quantity || 0,\n                lastPurchaseDate: invoice.date,\n                totalAmount: item.amount || 0,\n                purchaseCount: 1,\n                tax: item.tax || 0,\n                taxName: item.taxName || 'none'\n              });\n            }\n          });\n        }\n      });\n\n      // Convert Map to Array and sort by last purchase date (most recent first)\n      const itemsArray = Array.from(purchasedItems.values()).sort((a, b) =>\n        new Date(b.lastPurchaseDate).getTime() - new Date(a.lastPurchaseDate).getTime()\n      );\n\n      res.json({ success: true, data: itemsArray });\n    } catch (error) {\n      console.error('Error fetching customer purchased items:', error);\n      res.status(500).json({ success: false, message: \"Failed to fetch customer purchased items\" });\n    }\n  });\n\n  // Quotes API\n  app.get(\"/api/quotes/next-number\", (req: Request, res: Response) => {\n    try {\n      const data = readQuotesData();\n      const nextNumber = generateQuoteNumber(data.nextQuoteNumber);\n      res.json({ success: true, data: { quoteNumber: nextNumber } });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to get next quote number\" });\n    }\n  });\n\n  app.get(\"/api/quotes\", (req: Request, res: Response) => {\n    try {\n      const data = readQuotesData();\n      const quotes = data.quotes.map((quote: any) => ({\n        id: quote.id,\n        date: quote.date,\n        quoteNumber: quote.quoteNumber,\n        referenceNumber: quote.referenceNumber,\n        customerName: quote.customerName,\n        status: quote.status,\n        convertedTo: quote.convertedTo,\n        total: quote.total\n      }));\n      res.json({ success: true, data: quotes });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch quotes\" });\n    }\n  });\n\n  app.get(\"/api/quotes/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readQuotesData();\n      const quote = data.quotes.find((q: any) => q.id === req.params.id);\n      if (!quote) {\n        return res.status(404).json({ success: false, message: \"Quote not found\" });\n      }\n      res.json({ success: true, data: quote });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch quote\" });\n    }\n  });\n\n  app.post(\"/api/quotes\", (req: Request, res: Response) => {\n    try {\n      const data = readQuotesData();\n      const quoteNumber = generateQuoteNumber(data.nextQuoteNumber);\n      const now = new Date().toISOString();\n\n      const newQuote = {\n        id: String(Date.now()),\n        quoteNumber,\n        referenceNumber: req.body.referenceNumber || '',\n        date: req.body.date || new Date().toISOString().split('T')[0],\n        expiryDate: req.body.expiryDate || '',\n        customerId: req.body.customerId || '',\n        customerName: req.body.customerName || '',\n        billingAddress: req.body.billingAddress || { street: '', city: '', state: '', country: 'India', pincode: '' },\n        shippingAddress: req.body.shippingAddress || { street: '', city: '', state: '', country: 'India', pincode: '' },\n        salesperson: req.body.salesperson || '',\n        projectName: req.body.projectName || '',\n        subject: req.body.subject || '',\n        placeOfSupply: req.body.placeOfSupply || '',\n        pdfTemplate: req.body.pdfTemplate || 'Standard Template',\n        items: req.body.items || [],\n        subTotal: req.body.subTotal || 0,\n        shippingCharges: req.body.shippingCharges || 0,\n        tdsType: req.body.tdsType || '',\n        tdsAmount: req.body.tdsAmount || 0,\n        cgst: req.body.cgst || 0,\n        sgst: req.body.sgst || 0,\n        igst: req.body.igst || 0,\n        adjustment: req.body.adjustment || 0,\n        total: req.body.total || 0,\n        customerNotes: req.body.customerNotes || 'Looking forward for your business.',\n        termsAndConditions: req.body.termsAndConditions || '',\n        status: req.body.status || 'DRAFT',\n        emailRecipients: req.body.emailRecipients || [],\n        createdAt: now,\n        updatedAt: now,\n        createdBy: req.body.createdBy || 'Admin User',\n        activityLogs: [\n          {\n            id: '1',\n            timestamp: now,\n            action: 'created',\n            description: `Quote created for ${req.body.total?.toLocaleString('en-IN') || '0.00'}`,\n            user: req.body.createdBy || 'Admin User'\n          }\n        ]\n      };\n\n      data.quotes.unshift(newQuote);\n      data.nextQuoteNumber += 1;\n      writeQuotesData(data);\n\n      res.status(201).json({ success: true, data: newQuote });\n    } catch (error) {\n      console.error('Error creating quote:', error);\n      res.status(500).json({ success: false, message: 'Failed to create quote' });\n    }\n  });\n\n  app.put(\"/api/quotes/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readQuotesData();\n      const quoteIndex = data.quotes.findIndex((q: any) => q.id === req.params.id);\n\n      if (quoteIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Quote not found' });\n      }\n\n      const now = new Date().toISOString();\n      const existingQuote = data.quotes[quoteIndex];\n\n      const updatedQuote = {\n        ...existingQuote,\n        ...req.body,\n        id: existingQuote.id,\n        quoteNumber: existingQuote.quoteNumber,\n        createdAt: existingQuote.createdAt,\n        updatedAt: now,\n        activityLogs: [\n          ...existingQuote.activityLogs,\n          {\n            id: String(existingQuote.activityLogs.length + 1),\n            timestamp: now,\n            action: 'updated',\n            description: 'Quote has been updated',\n            user: req.body.updatedBy || 'Admin User'\n          }\n        ]\n      };\n\n      data.quotes[quoteIndex] = updatedQuote;\n      writeQuotesData(data);\n\n      res.json({ success: true, data: updatedQuote });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to update quote' });\n    }\n  });\n\n  app.patch(\"/api/quotes/:id/status\", (req: Request, res: Response) => {\n    try {\n      const data = readQuotesData();\n      const quoteIndex = data.quotes.findIndex((q: any) => q.id === req.params.id);\n\n      if (quoteIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Quote not found' });\n      }\n\n      const now = new Date().toISOString();\n      const existingQuote = data.quotes[quoteIndex];\n      const newStatus = req.body.status;\n\n      let actionDescription = '';\n      switch (newStatus) {\n        case 'SENT':\n          actionDescription = 'Quote has been sent';\n          break;\n        case 'ACCEPTED':\n          actionDescription = 'Quote marked as accepted';\n          break;\n        case 'DECLINED':\n          actionDescription = 'Quote marked as declined';\n          break;\n        default:\n          actionDescription = `Quote status changed to ${newStatus}`;\n      }\n\n      existingQuote.status = newStatus;\n      existingQuote.updatedAt = now;\n      existingQuote.activityLogs.push({\n        id: String(existingQuote.activityLogs.length + 1),\n        timestamp: now,\n        action: newStatus.toLowerCase(),\n        description: actionDescription,\n        user: req.body.updatedBy || 'Admin User'\n      });\n\n      data.quotes[quoteIndex] = existingQuote;\n      writeQuotesData(data);\n\n      res.json({ success: true, data: existingQuote });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to update quote status' });\n    }\n  });\n\n  app.delete(\"/api/quotes/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readQuotesData();\n      const quoteIndex = data.quotes.findIndex((q: any) => q.id === req.params.id);\n\n      if (quoteIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Quote not found' });\n      }\n\n      data.quotes.splice(quoteIndex, 1);\n      writeQuotesData(data);\n\n      res.json({ success: true, message: 'Quote deleted successfully' });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to delete quote' });\n    }\n  });\n\n  // Sales Orders API\n  app.get(\"/api/sales-orders/next-number\", (req: Request, res: Response) => {\n    try {\n      const data = readSalesOrdersData();\n      const nextNumber = generateSalesOrderNumber(data.nextSalesOrderNumber);\n      res.json({ success: true, data: { salesOrderNumber: nextNumber } });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to get next sales order number\" });\n    }\n  });\n\n  app.get(\"/api/sales-orders\", (req: Request, res: Response) => {\n    try {\n      const data = readSalesOrdersData();\n      const salesOrders = data.salesOrders.map((order: any) => ({\n        id: order.id,\n        date: order.date,\n        salesOrderNumber: order.salesOrderNumber,\n        referenceNumber: order.referenceNumber,\n        customerName: order.customerName,\n        orderStatus: order.orderStatus,\n        invoiceStatus: order.invoiceStatus,\n        paymentStatus: order.paymentStatus,\n        total: order.total,\n        expectedShipmentDate: order.expectedShipmentDate\n      }));\n      res.json({ success: true, data: salesOrders });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch sales orders\" });\n    }\n  });\n\n  app.get(\"/api/sales-orders/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readSalesOrdersData();\n      const salesOrder = data.salesOrders.find((o: any) => o.id === req.params.id);\n      if (!salesOrder) {\n        return res.status(404).json({ success: false, message: \"Sales order not found\" });\n      }\n      res.json({ success: true, data: salesOrder });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch sales order\" });\n    }\n  });\n\n  app.post(\"/api/sales-orders\", (req: Request, res: Response) => {\n    try {\n      const data = readSalesOrdersData();\n      const salesOrderNumber = generateSalesOrderNumber(data.nextSalesOrderNumber);\n      const now = new Date().toISOString();\n\n      const newSalesOrder = {\n        id: String(Date.now()),\n        salesOrderNumber,\n        referenceNumber: req.body.referenceNumber || '',\n        date: req.body.date || new Date().toISOString().split('T')[0],\n        expectedShipmentDate: req.body.expectedShipmentDate || '',\n        customerId: req.body.customerId || '',\n        customerName: req.body.customerName || '',\n        billingAddress: req.body.billingAddress || { street: '', city: '', state: '', country: 'India', pincode: '' },\n        shippingAddress: req.body.shippingAddress || { street: '', city: '', state: '', country: 'India', pincode: '' },\n        paymentTerms: req.body.paymentTerms || 'Due on Receipt',\n        deliveryMethod: req.body.deliveryMethod || '',\n        salesperson: req.body.salesperson || '',\n        placeOfSupply: req.body.placeOfSupply || '',\n        items: req.body.items || [],\n        subTotal: req.body.subTotal || 0,\n        shippingCharges: req.body.shippingCharges || 0,\n        tdsType: req.body.tdsType || '',\n        tdsAmount: req.body.tdsAmount || 0,\n        cgst: req.body.cgst || 0,\n        sgst: req.body.sgst || 0,\n        igst: req.body.igst || 0,\n        adjustment: req.body.adjustment || 0,\n        total: req.body.total || 0,\n        customerNotes: req.body.customerNotes || 'Thanks for your business.',\n        termsAndConditions: req.body.termsAndConditions || '',\n        orderStatus: req.body.orderStatus || 'DRAFT',\n        invoiceStatus: 'Not Invoiced',\n        paymentStatus: 'Unpaid',\n        shipmentStatus: 'Pending',\n        invoices: [],\n        pdfTemplate: req.body.pdfTemplate || 'Standard Template',\n        createdAt: now,\n        updatedAt: now,\n        createdBy: req.body.createdBy || 'Admin User',\n        activityLogs: [\n          {\n            id: '1',\n            timestamp: now,\n            action: 'created',\n            description: `Sales Order created for ${req.body.total?.toLocaleString('en-IN') || '0.00'}`,\n            user: req.body.createdBy || 'Admin User'\n          }\n        ]\n      };\n\n      data.salesOrders.unshift(newSalesOrder);\n      data.nextSalesOrderNumber += 1;\n      writeSalesOrdersData(data);\n\n      res.status(201).json({ success: true, data: newSalesOrder });\n    } catch (error) {\n      console.error('Error creating sales order:', error);\n      res.status(500).json({ success: false, message: 'Failed to create sales order' });\n    }\n  });\n\n  app.put(\"/api/sales-orders/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readSalesOrdersData();\n      const orderIndex = data.salesOrders.findIndex((o: any) => o.id === req.params.id);\n\n      if (orderIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Sales order not found' });\n      }\n\n      const now = new Date().toISOString();\n      const existingOrder = data.salesOrders[orderIndex];\n\n      const updatedOrder = {\n        ...existingOrder,\n        ...req.body,\n        id: existingOrder.id,\n        salesOrderNumber: existingOrder.salesOrderNumber,\n        createdAt: existingOrder.createdAt,\n        updatedAt: now,\n        activityLogs: [\n          ...existingOrder.activityLogs,\n          {\n            id: String(existingOrder.activityLogs.length + 1),\n            timestamp: now,\n            action: 'updated',\n            description: 'Sales Order has been updated',\n            user: req.body.updatedBy || 'Admin User'\n          }\n        ]\n      };\n\n      data.salesOrders[orderIndex] = updatedOrder;\n      writeSalesOrdersData(data);\n\n      res.json({ success: true, data: updatedOrder });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to update sales order' });\n    }\n  });\n\n  app.patch(\"/api/sales-orders/:id/status\", (req: Request, res: Response) => {\n    try {\n      const data = readSalesOrdersData();\n      const orderIndex = data.salesOrders.findIndex((o: any) => o.id === req.params.id);\n\n      if (orderIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Sales order not found' });\n      }\n\n      const now = new Date().toISOString();\n      const existingOrder = data.salesOrders[orderIndex];\n      const newStatus = req.body.orderStatus;\n\n      let actionDescription = `Status changed to ${newStatus}`;\n\n      existingOrder.orderStatus = newStatus;\n      existingOrder.updatedAt = now;\n      existingOrder.activityLogs.push({\n        id: String(existingOrder.activityLogs.length + 1),\n        timestamp: now,\n        action: newStatus.toLowerCase(),\n        description: actionDescription,\n        user: req.body.updatedBy || 'Admin User'\n      });\n\n      data.salesOrders[orderIndex] = existingOrder;\n      writeSalesOrdersData(data);\n\n      res.json({ success: true, data: existingOrder });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to update sales order status' });\n    }\n  });\n\n  app.post(\"/api/sales-orders/:id/convert-to-invoice\", (req: Request, res: Response) => {\n    try {\n      const data = readSalesOrdersData();\n      const orderIndex = data.salesOrders.findIndex((o: any) => o.id === req.params.id);\n\n      if (orderIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Sales order not found' });\n      }\n\n      const now = new Date().toISOString();\n      const existingOrder = data.salesOrders[orderIndex];\n      const invoiceNumber = generateInvoiceNumber(data.nextInvoiceNumber);\n\n      const newInvoice = {\n        id: invoiceNumber,\n        invoiceNumber: invoiceNumber,\n        date: new Date().toISOString().split('T')[0],\n        dueDate: new Date().toISOString().split('T')[0],\n        status: 'DRAFT',\n        amount: existingOrder.total,\n        balanceDue: existingOrder.total\n      };\n\n      existingOrder.invoices.push(newInvoice);\n      existingOrder.invoiceStatus = 'Invoiced';\n      existingOrder.orderStatus = 'CLOSED';\n      existingOrder.updatedAt = now;\n\n      existingOrder.items = existingOrder.items.map((item: any) => ({\n        ...item,\n        invoicedQty: item.quantity,\n        invoiceStatus: 'Invoiced'\n      }));\n\n      existingOrder.activityLogs.push({\n        id: String(existingOrder.activityLogs.length + 1),\n        timestamp: now,\n        action: 'invoiced',\n        description: `Invoice ${invoiceNumber} created`,\n        user: req.body.createdBy || 'Admin User'\n      });\n\n      data.salesOrders[orderIndex] = existingOrder;\n      data.nextInvoiceNumber += 1;\n      writeSalesOrdersData(data);\n\n      res.json({ success: true, data: { salesOrder: existingOrder, invoice: newInvoice } });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to convert to invoice' });\n    }\n  });\n\n  app.delete(\"/api/sales-orders/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readSalesOrdersData();\n      const orderIndex = data.salesOrders.findIndex((o: any) => o.id === req.params.id);\n\n      if (orderIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Sales order not found' });\n      }\n\n      data.salesOrders.splice(orderIndex, 1);\n      writeSalesOrdersData(data);\n\n      res.json({ success: true, message: 'Sales order deleted successfully' });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to delete sales order' });\n    }\n  });\n\n  // Invoices API\n  app.get(\"/api/invoices/next-number\", (req: Request, res: Response) => {\n    try {\n      const data = readInvoicesData();\n      const nextNumber = generateInvoiceNumber(data.nextInvoiceNumber);\n      res.json({ success: true, data: { invoiceNumber: nextNumber } });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to get next invoice number\" });\n    }\n  });\n\n  app.get(\"/api/invoices\", (req: Request, res: Response) => {\n    try {\n      const data = readInvoicesData();\n      const { customerId } = req.query;\n\n      let invoices = data.invoices.map((invoice: any) => ({\n        id: invoice.id,\n        invoiceNumber: invoice.invoiceNumber,\n        customerName: invoice.customerName,\n        customerId: invoice.customerId,\n        date: invoice.date,\n        dueDate: invoice.dueDate,\n        amount: invoice.total || invoice.amount || 0,\n        status: invoice.status || 'DRAFT',\n        terms: invoice.paymentTerms || 'Due on Receipt',\n        balanceDue: invoice.balanceDue || invoice.total || invoice.amount || 0\n      }));\n\n      // Filter by customerId if provided\n      if (customerId) {\n        invoices = invoices.filter((invoice: any) => invoice.customerId === customerId);\n      }\n\n      res.json({ success: true, data: invoices });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch invoices\" });\n    }\n  });\n\n  app.get(\"/api/invoices/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readInvoicesData();\n      const invoice = data.invoices.find((i: any) => i.id === req.params.id);\n      if (!invoice) {\n        return res.status(404).json({ success: false, message: \"Invoice not found\" });\n      }\n      res.json({ success: true, data: invoice });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch invoice\" });\n    }\n  });\n\n  app.post(\"/api/invoices\", (req: Request, res: Response) => {\n    try {\n      const data = readInvoicesData();\n      const invoiceNumber = generateInvoiceNumber(data.nextInvoiceNumber);\n      const now = new Date().toISOString();\n\n      const newInvoice = {\n        id: String(Date.now()),\n        invoiceNumber,\n        referenceNumber: req.body.referenceNumber || '',\n        date: req.body.date || new Date().toISOString().split('T')[0],\n        dueDate: req.body.dueDate || new Date().toISOString().split('T')[0],\n        customerId: req.body.customerId || '',\n        customerName: req.body.customerName || '',\n        billingAddress: req.body.billingAddress || { street: '', city: '', state: '', country: 'India', pincode: '' },\n        shippingAddress: req.body.shippingAddress || { street: '', city: '', state: '', country: 'India', pincode: '' },\n        salesperson: req.body.salesperson || '',\n        placeOfSupply: req.body.placeOfSupply || '',\n        paymentTerms: req.body.paymentTerms || 'Due on Receipt',\n        items: req.body.items || [],\n        subTotal: req.body.subTotal || 0,\n        shippingCharges: req.body.shippingCharges || 0,\n        cgst: req.body.cgst || 0,\n        sgst: req.body.sgst || 0,\n        igst: req.body.igst || 0,\n        adjustment: req.body.adjustment || 0,\n        total: req.body.total || 0,\n        amountPaid: req.body.amountPaid || 0,\n        balanceDue: req.body.total || 0,\n        customerNotes: req.body.customerNotes || '',\n        termsAndConditions: req.body.termsAndConditions || '',\n        status: req.body.status || 'PENDING',\n        sourceType: req.body.sourceType || null,\n        sourceId: req.body.sourceId || null,\n        sourceNumber: req.body.sourceNumber || null,\n        pdfTemplate: req.body.pdfTemplate || 'Standard Template',\n        createdAt: now,\n        updatedAt: now,\n        createdBy: req.body.createdBy || 'Admin User',\n        payments: [],\n        activityLogs: [\n          {\n            id: '1',\n            timestamp: now,\n            action: 'created',\n            description: `Invoice created for ${req.body.total?.toLocaleString('en-IN') || '0.00'}`,\n            user: req.body.createdBy || 'Admin User'\n          }\n        ]\n      };\n\n      data.invoices.unshift(newInvoice);\n      data.nextInvoiceNumber += 1;\n      writeInvoicesData(data);\n\n      res.status(201).json({ success: true, data: newInvoice });\n    } catch (error) {\n      console.error('Error creating invoice:', error);\n      res.status(500).json({ success: false, message: 'Failed to create invoice' });\n    }\n  });\n\n  app.put(\"/api/invoices/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readInvoicesData();\n      const invoiceIndex = data.invoices.findIndex((i: any) => i.id === req.params.id);\n\n      if (invoiceIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Invoice not found' });\n      }\n\n      const now = new Date().toISOString();\n      const existingInvoice = data.invoices[invoiceIndex];\n\n      const updatedInvoice = {\n        ...existingInvoice,\n        ...req.body,\n        id: existingInvoice.id,\n        invoiceNumber: existingInvoice.invoiceNumber,\n        createdAt: existingInvoice.createdAt,\n        updatedAt: now,\n        activityLogs: [\n          ...existingInvoice.activityLogs,\n          {\n            id: String(existingInvoice.activityLogs.length + 1),\n            timestamp: now,\n            action: 'updated',\n            description: 'Invoice has been updated',\n            user: req.body.updatedBy || 'Admin User'\n          }\n        ]\n      };\n\n      data.invoices[invoiceIndex] = updatedInvoice;\n      writeInvoicesData(data);\n\n      res.json({ success: true, data: updatedInvoice });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to update invoice' });\n    }\n  });\n\n  app.patch(\"/api/invoices/:id/status\", (req: Request, res: Response) => {\n    try {\n      const data = readInvoicesData();\n      const invoiceIndex = data.invoices.findIndex((i: any) => i.id === req.params.id);\n\n      if (invoiceIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Invoice not found' });\n      }\n\n      const now = new Date().toISOString();\n      const existingInvoice = data.invoices[invoiceIndex];\n      const newStatus = req.body.status;\n\n      let actionDescription = `Status changed to ${newStatus}`;\n      if (newStatus === 'SENT') actionDescription = 'Invoice has been sent';\n      if (newStatus === 'PAID') actionDescription = 'Invoice marked as paid';\n\n      existingInvoice.status = newStatus;\n      existingInvoice.updatedAt = now;\n      existingInvoice.activityLogs.push({\n        id: String(existingInvoice.activityLogs.length + 1),\n        timestamp: now,\n        action: newStatus.toLowerCase(),\n        description: actionDescription,\n        user: req.body.updatedBy || 'Admin User'\n      });\n\n      data.invoices[invoiceIndex] = existingInvoice;\n      writeInvoicesData(data);\n\n      res.json({ success: true, data: existingInvoice });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to update invoice status' });\n    }\n  });\n\n  app.post(\"/api/invoices/:id/record-payment\", (req: Request, res: Response) => {\n    try {\n      const data = readInvoicesData();\n      const invoiceIndex = data.invoices.findIndex((i: any) => i.id === req.params.id);\n\n      if (invoiceIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Invoice not found' });\n      }\n\n      const now = new Date().toISOString();\n      const existingInvoice = data.invoices[invoiceIndex];\n      const paymentAmount = req.body.amount || 0;\n      const paymentDate = req.body.date || new Date().toISOString();\n\n      const payment = {\n        id: String(Date.now()),\n        date: paymentDate,\n        amount: paymentAmount,\n        paymentMode: req.body.paymentMode || 'Cash',\n        reference: req.body.reference || '',\n        notes: req.body.notes || ''\n      };\n\n      existingInvoice.payments.push(payment);\n      existingInvoice.amountPaid = (existingInvoice.amountPaid || 0) + paymentAmount;\n      existingInvoice.balanceDue = existingInvoice.total - existingInvoice.amountPaid;\n\n      if (existingInvoice.balanceDue <= 0) {\n        existingInvoice.status = 'PAID';\n        existingInvoice.balanceDue = 0;\n      } else {\n        existingInvoice.status = 'PARTIALLY_PAID';\n      }\n\n      existingInvoice.updatedAt = now;\n      existingInvoice.activityLogs.push({\n        id: String(existingInvoice.activityLogs.length + 1),\n        timestamp: now,\n        action: 'payment_recorded',\n        description: `Payment of ${paymentAmount.toLocaleString('en-IN')} recorded`,\n        user: req.body.recordedBy || 'Admin User'\n      });\n\n      data.invoices[invoiceIndex] = existingInvoice;\n      writeInvoicesData(data);\n\n      // Also create a record in Payments Received\n      const paymentsData = readPaymentsReceivedData();\n      const paymentNumber = generatePaymentNumber(paymentsData.nextPaymentNumber);\n\n      const newPaymentReceived = {\n        id: `pr-${Date.now()}`,\n        paymentNumber,\n        date: paymentDate.split('T')[0],\n        referenceNumber: req.body.reference || '',\n        customerId: existingInvoice.customerId || '',\n        customerName: existingInvoice.customerName || '',\n        customerEmail: existingInvoice.customerEmail || '',\n        invoices: [{\n          invoiceId: existingInvoice.id,\n          invoiceNumber: existingInvoice.invoiceNumber,\n          invoiceDate: existingInvoice.date,\n          invoiceAmount: existingInvoice.total,\n          amountDue: existingInvoice.balanceDue,\n          paymentAmount: paymentAmount\n        }],\n        mode: req.body.paymentMode || 'Cash',\n        depositTo: 'Petty Cash',\n        amount: paymentAmount,\n        unusedAmount: 0,\n        bankCharges: 0,\n        tax: '',\n        taxAmount: 0,\n        notes: req.body.notes || `Payment for ${existingInvoice.invoiceNumber}`,\n        attachments: [],\n        sendThankYou: false,\n        status: 'PAID',\n        paymentType: 'invoice_payment',\n        placeOfSupply: existingInvoice.placeOfSupply || '',\n        descriptionOfSupply: '',\n        amountInWords: numberToWords(paymentAmount),\n        journalEntries: [],\n        createdAt: now\n      };\n\n      paymentsData.paymentsReceived.push(newPaymentReceived);\n      paymentsData.nextPaymentNumber++;\n      writePaymentsReceivedData(paymentsData);\n\n      res.json({ success: true, data: existingInvoice, paymentReceived: newPaymentReceived });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to record payment' });\n    }\n  });\n\n  app.delete(\"/api/invoices/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readInvoicesData();\n      const invoiceIndex = data.invoices.findIndex((i: any) => i.id === req.params.id);\n\n      if (invoiceIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Invoice not found' });\n      }\n\n      data.invoices.splice(invoiceIndex, 1);\n      writeInvoicesData(data);\n\n      res.json({ success: true, message: 'Invoice deleted successfully' });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to delete invoice' });\n    }\n  });\n\n  // Quote to Invoice/Sales Order conversion\n  app.post(\"/api/quotes/:id/convert-to-invoice\", (req: Request, res: Response) => {\n    try {\n      const quotesData = readQuotesData();\n      const quoteIndex = quotesData.quotes.findIndex((q: any) => q.id === req.params.id);\n\n      if (quoteIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Quote not found' });\n      }\n\n      const quote = quotesData.quotes[quoteIndex];\n      const invoicesData = readInvoicesData();\n      const now = new Date().toISOString();\n      const invoiceNumber = generateInvoiceNumber(invoicesData.nextInvoiceNumber);\n\n      const newInvoice = {\n        id: String(Date.now()),\n        invoiceNumber,\n        referenceNumber: quote.referenceNumber || '',\n        date: new Date().toISOString().split('T')[0],\n        dueDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\n        customerId: quote.customerId,\n        customerName: quote.customerName,\n        billingAddress: quote.billingAddress,\n        shippingAddress: quote.shippingAddress,\n        salesperson: quote.salesperson,\n        placeOfSupply: quote.placeOfSupply,\n        paymentTerms: 'Net 30',\n        items: quote.items,\n        subTotal: quote.subTotal,\n        shippingCharges: quote.shippingCharges,\n        cgst: quote.cgst,\n        sgst: quote.sgst,\n        igst: quote.igst,\n        adjustment: quote.adjustment,\n        total: quote.total,\n        amountPaid: 0,\n        balanceDue: quote.total,\n        customerNotes: quote.customerNotes,\n        termsAndConditions: quote.termsAndConditions,\n        status: 'PENDING',\n        sourceType: 'quote',\n        sourceId: quote.id,\n        sourceNumber: quote.quoteNumber,\n        pdfTemplate: quote.pdfTemplate,\n        createdAt: now,\n        updatedAt: now,\n        createdBy: req.body.createdBy || 'Admin User',\n        payments: [],\n        activityLogs: [\n          {\n            id: '1',\n            timestamp: now,\n            action: 'created',\n            description: `Invoice created from Quote ${quote.quoteNumber}`,\n            user: req.body.createdBy || 'Admin User'\n          }\n        ]\n      };\n\n      invoicesData.invoices.unshift(newInvoice);\n      invoicesData.nextInvoiceNumber += 1;\n      writeInvoicesData(invoicesData);\n\n      // Update quote status\n      quote.status = 'CONVERTED';\n      quote.convertedTo = 'invoice';\n      quote.updatedAt = now;\n      quote.activityLogs.push({\n        id: String(quote.activityLogs.length + 1),\n        timestamp: now,\n        action: 'converted',\n        description: `Converted to Invoice ${invoiceNumber}`,\n        user: req.body.createdBy || 'Admin User',\n        link: `/invoices/${newInvoice.id}`\n      });\n      quotesData.quotes[quoteIndex] = quote;\n      writeQuotesData(quotesData);\n\n      res.status(201).json({ success: true, data: { quote, invoice: newInvoice } });\n    } catch (error) {\n      console.error('Error converting quote to invoice:', error);\n      res.status(500).json({ success: false, message: 'Failed to convert quote to invoice' });\n    }\n  });\n\n  app.post(\"/api/quotes/:id/convert-to-sales-order\", (req: Request, res: Response) => {\n    try {\n      const quotesData = readQuotesData();\n      const quoteIndex = quotesData.quotes.findIndex((q: any) => q.id === req.params.id);\n\n      if (quoteIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Quote not found' });\n      }\n\n      const quote = quotesData.quotes[quoteIndex];\n      const salesOrdersData = readSalesOrdersData();\n      const now = new Date().toISOString();\n      const salesOrderNumber = generateSalesOrderNumber(salesOrdersData.nextSalesOrderNumber);\n\n      const newSalesOrder = {\n        id: String(Date.now()),\n        salesOrderNumber,\n        referenceNumber: quote.referenceNumber || '',\n        date: new Date().toISOString().split('T')[0],\n        expectedShipmentDate: '',\n        customerId: quote.customerId,\n        customerName: quote.customerName,\n        billingAddress: quote.billingAddress,\n        shippingAddress: quote.shippingAddress,\n        paymentTerms: 'Due on Receipt',\n        deliveryMethod: '',\n        salesperson: quote.salesperson,\n        placeOfSupply: quote.placeOfSupply,\n        items: quote.items.map((item: any) => ({\n          ...item,\n          invoicedQty: 0,\n          invoiceStatus: 'Not Invoiced'\n        })),\n        subTotal: quote.subTotal,\n        shippingCharges: quote.shippingCharges,\n        cgst: quote.cgst,\n        sgst: quote.sgst,\n        igst: quote.igst,\n        adjustment: quote.adjustment,\n        total: quote.total,\n        customerNotes: quote.customerNotes,\n        termsAndConditions: quote.termsAndConditions,\n        orderStatus: 'CONFIRMED',\n        invoiceStatus: 'Not Invoiced',\n        paymentStatus: 'Unpaid',\n        shipmentStatus: 'Pending',\n        invoices: [],\n        sourceType: 'quote',\n        sourceId: quote.id,\n        sourceNumber: quote.quoteNumber,\n        pdfTemplate: quote.pdfTemplate,\n        createdAt: now,\n        updatedAt: now,\n        createdBy: req.body.createdBy || 'Admin User',\n        activityLogs: [\n          {\n            id: '1',\n            timestamp: now,\n            action: 'created',\n            description: `Sales Order created from Quote ${quote.quoteNumber}`,\n            user: req.body.createdBy || 'Admin User'\n          }\n        ]\n      };\n\n      salesOrdersData.salesOrders.unshift(newSalesOrder);\n      salesOrdersData.nextSalesOrderNumber += 1;\n      writeSalesOrdersData(salesOrdersData);\n\n      // Update quote status\n      quote.status = 'CONVERTED';\n      quote.convertedTo = 'sales-order';\n      quote.updatedAt = now;\n      quote.activityLogs.push({\n        id: String(quote.activityLogs.length + 1),\n        timestamp: now,\n        action: 'converted',\n        description: `Converted to Sales Order ${salesOrderNumber}`,\n        user: req.body.createdBy || 'Admin User',\n        link: `/sales-orders/${newSalesOrder.id}`\n      });\n      quotesData.quotes[quoteIndex] = quote;\n      writeQuotesData(quotesData);\n\n      res.status(201).json({ success: true, data: { quote, salesOrder: newSalesOrder } });\n    } catch (error) {\n      console.error('Error converting quote to sales order:', error);\n      res.status(500).json({ success: false, message: 'Failed to convert quote to sales order' });\n    }\n  });\n\n  app.patch(\"/api/quotes/:id/send\", (req: Request, res: Response) => {\n    try {\n      const data = readQuotesData();\n      const quoteIndex = data.quotes.findIndex((q: any) => q.id === req.params.id);\n\n      if (quoteIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Quote not found' });\n      }\n\n      const now = new Date().toISOString();\n      const quote = data.quotes[quoteIndex];\n\n      quote.status = 'SENT';\n      quote.updatedAt = now;\n      quote.activityLogs.push({\n        id: String(quote.activityLogs.length + 1),\n        timestamp: now,\n        action: 'sent',\n        description: 'Quote has been sent to customer',\n        user: req.body.sentBy || 'Admin User'\n      });\n\n      data.quotes[quoteIndex] = quote;\n      writeQuotesData(data);\n\n      res.json({ success: true, data: quote });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to send quote' });\n    }\n  });\n\n  // Vendors API\n  app.get(\"/api/vendors\", (req: Request, res: Response) => {\n    try {\n      const data = readVendorsData();\n      res.json({ success: true, data: data.vendors });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch vendors\" });\n    }\n  });\n\n  app.get(\"/api/vendors/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readVendorsData();\n      const vendor = data.vendors.find((v: any) => v.id === req.params.id);\n      if (!vendor) {\n        return res.status(404).json({ success: false, message: \"Vendor not found\" });\n      }\n      res.json({ success: true, data: vendor });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch vendor\" });\n    }\n  });\n\n  app.post(\"/api/vendors\", (req: Request, res: Response) => {\n    try {\n      const data = readVendorsData();\n      const newVendor = {\n        id: String(data.nextVendorId),\n        ...req.body,\n        status: req.body.status || \"active\",\n        payables: 0,\n        unusedCredits: 0,\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString()\n      };\n      data.vendors.push(newVendor);\n      data.nextVendorId += 1;\n      writeVendorsData(data);\n      res.status(201).json({ success: true, data: newVendor });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to create vendor\" });\n    }\n  });\n\n  app.put(\"/api/vendors/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readVendorsData();\n      const index = data.vendors.findIndex((v: any) => v.id === req.params.id);\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Vendor not found\" });\n      }\n      data.vendors[index] = {\n        ...data.vendors[index],\n        ...req.body,\n        updatedAt: new Date().toISOString()\n      };\n      writeVendorsData(data);\n      res.json({ success: true, data: data.vendors[index] });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to update vendor\" });\n    }\n  });\n\n  app.delete(\"/api/vendors/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readVendorsData();\n      const index = data.vendors.findIndex((v: any) => v.id === req.params.id);\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Vendor not found\" });\n      }\n      data.vendors.splice(index, 1);\n      writeVendorsData(data);\n      res.json({ success: true, message: \"Vendor deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to delete vendor\" });\n    }\n  });\n\n  app.post(\"/api/vendors/:id/clone\", (req: Request, res: Response) => {\n    try {\n      const data = readVendorsData();\n      const vendor = data.vendors.find((v: any) => v.id === req.params.id);\n      if (!vendor) {\n        return res.status(404).json({ success: false, message: \"Vendor not found\" });\n      }\n      const clonedVendor = {\n        ...vendor,\n        id: String(data.nextVendorId),\n        displayName: `${vendor.displayName} (Copy)`,\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString()\n      };\n      data.vendors.push(clonedVendor);\n      data.nextVendorId += 1;\n      writeVendorsData(data);\n      res.status(201).json({ success: true, data: clonedVendor });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to clone vendor\" });\n    }\n  });\n\n  app.patch(\"/api/vendors/:id/status\", (req: Request, res: Response) => {\n    try {\n      const data = readVendorsData();\n      const index = data.vendors.findIndex((v: any) => v.id === req.params.id);\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Vendor not found\" });\n      }\n      data.vendors[index] = {\n        ...data.vendors[index],\n        status: req.body.status,\n        updatedAt: new Date().toISOString()\n      };\n      writeVendorsData(data);\n      res.json({ success: true, data: data.vendors[index] });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to update vendor status\" });\n    }\n  });\n\n  // Vendor Comments API\n  app.get(\"/api/vendors/:id/comments\", (req: Request, res: Response) => {\n    try {\n      const data = readVendorsData();\n      const vendor = data.vendors.find((v: any) => v.id === req.params.id);\n      if (!vendor) {\n        return res.status(404).json({ success: false, message: \"Vendor not found\" });\n      }\n      res.json({ success: true, data: vendor.comments || [] });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch comments\" });\n    }\n  });\n\n  app.post(\"/api/vendors/:id/comments\", (req: Request, res: Response) => {\n    try {\n      const data = readVendorsData();\n      const index = data.vendors.findIndex((v: any) => v.id === req.params.id);\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Vendor not found\" });\n      }\n      const newComment = {\n        id: String(Date.now()),\n        text: req.body.text,\n        author: req.body.author || \"Admin User\",\n        createdAt: new Date().toISOString()\n      };\n      if (!data.vendors[index].comments) {\n        data.vendors[index].comments = [];\n      }\n      data.vendors[index].comments.push(newComment);\n      writeVendorsData(data);\n      res.status(201).json({ success: true, data: newComment });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to add comment\" });\n    }\n  });\n\n  // Vendor Transactions API\n  app.get(\"/api/vendors/:id/transactions\", (req: Request, res: Response) => {\n    try {\n      const vendorId = req.params.id;\n      const billsData = readBillsData();\n      const purchaseOrdersData = readPurchaseOrdersData();\n      const expensesData = readExpensesData();\n\n      const vendorBills = (billsData.bills || []).filter((b: any) => b.vendorId === vendorId);\n      const vendorPurchaseOrders = (purchaseOrdersData.purchaseOrders || []).filter((po: any) => po.vendorId === vendorId);\n      const vendorExpenses = (expensesData.expenses || []).filter((e: any) => e.vendorId === vendorId);\n\n      res.json({\n        success: true,\n        data: {\n          bills: vendorBills.map((b: any) => ({\n            id: b.id,\n            type: 'bill',\n            date: b.billDate || b.date,\n            number: b.billNumber,\n            orderNumber: b.orderNumber || '',\n            vendor: b.vendorName || '',\n            amount: b.total || 0,\n            balance: b.balanceDue || b.total || 0,\n            status: b.status || 'Draft'\n          })),\n          billPayments: [],\n          expenses: vendorExpenses.map((e: any) => ({\n            id: e.id,\n            type: 'expense',\n            date: e.date,\n            number: e.expenseNumber || '',\n            invoiceNumber: e.invoiceNumber || '',\n            vendor: e.vendorName || '',\n            paidThrough: e.paidThrough || '',\n            customer: e.customerName || '',\n            amount: e.amount || 0,\n            balance: 0,\n            status: e.status || 'Unbilled'\n          })),\n          purchaseOrders: vendorPurchaseOrders.map((po: any) => ({\n            id: po.id,\n            type: 'purchaseOrder',\n            date: po.date || po.purchaseOrderDate,\n            number: po.purchaseOrderNumber,\n            referenceNumber: po.referenceNumber || '',\n            deliveryDate: po.expectedDeliveryDate || '',\n            amount: po.total || 0,\n            balance: 0,\n            status: po.status || 'Draft'\n          })),\n          vendorCredits: [],\n          journals: []\n        }\n      });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch transactions\" });\n    }\n  });\n\n  // Vendor Mails API\n  app.get(\"/api/vendors/:id/mails\", (req: Request, res: Response) => {\n    try {\n      const data = readVendorsData();\n      const vendor = data.vendors.find((v: any) => v.id === req.params.id);\n      if (!vendor) {\n        return res.status(404).json({ success: false, message: \"Vendor not found\" });\n      }\n      res.json({ success: true, data: vendor.mails || [] });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch mails\" });\n    }\n  });\n\n  // Vendor Activities API\n  app.get(\"/api/vendors/:id/activities\", (req: Request, res: Response) => {\n    try {\n      const data = readVendorsData();\n      const vendor = data.vendors.find((v: any) => v.id === req.params.id);\n      if (!vendor) {\n        return res.status(404).json({ success: false, message: \"Vendor not found\" });\n      }\n      res.json({ success: true, data: vendor.activities || [] });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch activities\" });\n    }\n  });\n\n  // Vendor Attachments API\n  app.post(\"/api/vendors/:id/attachments\", (req: Request, res: Response) => {\n    try {\n      const data = readVendorsData();\n      const vendorIndex = data.vendors.findIndex((v: any) => v.id === req.params.id);\n      if (vendorIndex === -1) {\n        return res.status(404).json({ success: false, message: \"Vendor not found\" });\n      }\n\n      if (!data.vendors[vendorIndex].attachments) {\n        data.vendors[vendorIndex].attachments = [];\n      }\n\n      const files = req.files as any[] || [];\n      const newAttachments = files.map((file: any) => ({\n        id: `att-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n        name: file.originalname || file.name || 'file',\n        size: file.size || 0,\n        type: file.mimetype || file.type || 'application/octet-stream',\n        uploadedAt: new Date().toISOString()\n      }));\n\n      data.vendors[vendorIndex].attachments.push(...newAttachments);\n      data.vendors[vendorIndex].updatedAt = new Date().toISOString();\n      writeVendorsData(data);\n\n      res.status(201).json({ success: true, data: newAttachments });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to upload attachments\" });\n    }\n  });\n\n  app.delete(\"/api/vendors/:id/attachments/:attachmentId\", (req: Request, res: Response) => {\n    try {\n      const data = readVendorsData();\n      const vendorIndex = data.vendors.findIndex((v: any) => v.id === req.params.id);\n      if (vendorIndex === -1) {\n        return res.status(404).json({ success: false, message: \"Vendor not found\" });\n      }\n\n      if (!data.vendors[vendorIndex].attachments) {\n        return res.status(404).json({ success: false, message: \"Attachment not found\" });\n      }\n\n      const attachmentIndex = data.vendors[vendorIndex].attachments.findIndex(\n        (a: any) => a.id === req.params.attachmentId\n      );\n\n      if (attachmentIndex === -1) {\n        return res.status(404).json({ success: false, message: \"Attachment not found\" });\n      }\n\n      data.vendors[vendorIndex].attachments.splice(attachmentIndex, 1);\n      data.vendors[vendorIndex].updatedAt = new Date().toISOString();\n      writeVendorsData(data);\n\n      res.json({ success: true, message: \"Attachment deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to delete attachment\" });\n    }\n  });\n\n  // Delivery Challans API\n  app.get(\"/api/delivery-challans/next-number\", (req: Request, res: Response) => {\n    try {\n      const data = readDeliveryChallansData();\n      const nextNumber = generateChallanNumber(data.nextChallanNumber);\n      res.json({ success: true, data: { challanNumber: nextNumber } });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to get next challan number\" });\n    }\n  });\n\n  app.get(\"/api/delivery-challans\", (req: Request, res: Response) => {\n    try {\n      const data = readDeliveryChallansData();\n      const challans = data.deliveryChallans.map((challan: any) => ({\n        id: challan.id,\n        challanNumber: challan.challanNumber,\n        referenceNumber: challan.referenceNumber,\n        customerName: challan.customerName,\n        customerId: challan.customerId,\n        date: challan.date,\n        amount: challan.total,\n        status: challan.status,\n        invoiceStatus: challan.invoiceStatus || '',\n        challanType: challan.challanType\n      }));\n      res.json({ success: true, data: challans });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch delivery challans\" });\n    }\n  });\n\n  app.get(\"/api/delivery-challans/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readDeliveryChallansData();\n      const challan = data.deliveryChallans.find((c: any) => c.id === req.params.id);\n      if (!challan) {\n        return res.status(404).json({ success: false, message: \"Delivery challan not found\" });\n      }\n      res.json({ success: true, data: challan });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch delivery challan\" });\n    }\n  });\n\n  app.post(\"/api/delivery-challans\", (req: Request, res: Response) => {\n    try {\n      const data = readDeliveryChallansData();\n      const challanNumber = generateChallanNumber(data.nextChallanNumber);\n      const now = new Date().toISOString();\n\n      const newChallan = {\n        id: String(Date.now()),\n        challanNumber,\n        referenceNumber: req.body.referenceNumber || '',\n        date: req.body.date,\n        customerId: req.body.customerId,\n        customerName: req.body.customerName,\n        challanType: req.body.challanType,\n        billingAddress: req.body.billingAddress || {},\n        shippingAddress: req.body.shippingAddress || {},\n        placeOfSupply: req.body.placeOfSupply || '',\n        gstin: req.body.gstin || '',\n        items: req.body.items || [],\n        subTotal: req.body.subTotal || 0,\n        cgst: req.body.cgst || 0,\n        sgst: req.body.sgst || 0,\n        igst: req.body.igst || 0,\n        adjustment: req.body.adjustment || 0,\n        total: req.body.total || 0,\n        customerNotes: req.body.customerNotes || '',\n        termsAndConditions: req.body.termsAndConditions || '',\n        status: req.body.status || 'DRAFT',\n        invoiceStatus: '',\n        invoiceId: null,\n        createdAt: now,\n        updatedAt: now,\n        activityLogs: [{\n          id: '1',\n          timestamp: now,\n          action: 'created',\n          description: `Delivery challan ${challanNumber} created`,\n          user: req.body.createdBy || 'Admin User'\n        }]\n      };\n\n      data.deliveryChallans.push(newChallan);\n      data.nextChallanNumber += 1;\n      writeDeliveryChallansData(data);\n\n      res.status(201).json({ success: true, data: newChallan });\n    } catch (error) {\n      console.error('Error creating delivery challan:', error);\n      res.status(500).json({ success: false, message: \"Failed to create delivery challan\" });\n    }\n  });\n\n  app.put(\"/api/delivery-challans/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readDeliveryChallansData();\n      const index = data.deliveryChallans.findIndex((c: any) => c.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Delivery challan not found\" });\n      }\n\n      const existingChallan = data.deliveryChallans[index];\n      const now = new Date().toISOString();\n\n      const updatedChallan = {\n        ...existingChallan,\n        ...req.body,\n        id: existingChallan.id,\n        challanNumber: existingChallan.challanNumber,\n        updatedAt: now,\n        activityLogs: [\n          ...existingChallan.activityLogs,\n          {\n            id: String(existingChallan.activityLogs.length + 1),\n            timestamp: now,\n            action: 'updated',\n            description: 'Delivery challan updated',\n            user: req.body.updatedBy || 'Admin User'\n          }\n        ]\n      };\n\n      data.deliveryChallans[index] = updatedChallan;\n      writeDeliveryChallansData(data);\n\n      res.json({ success: true, data: updatedChallan });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to update delivery challan\" });\n    }\n  });\n\n  app.delete(\"/api/delivery-challans/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readDeliveryChallansData();\n      const index = data.deliveryChallans.findIndex((c: any) => c.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Delivery challan not found\" });\n      }\n\n      data.deliveryChallans.splice(index, 1);\n      writeDeliveryChallansData(data);\n\n      res.json({ success: true, message: \"Delivery challan deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to delete delivery challan\" });\n    }\n  });\n\n  app.post(\"/api/delivery-challans/:id/convert-to-invoice\", (req: Request, res: Response) => {\n    try {\n      const challansData = readDeliveryChallansData();\n      const challanIndex = challansData.deliveryChallans.findIndex((c: any) => c.id === req.params.id);\n\n      if (challanIndex === -1) {\n        return res.status(404).json({ success: false, message: \"Delivery challan not found\" });\n      }\n\n      const challan = challansData.deliveryChallans[challanIndex];\n      const invoicesData = readInvoicesData();\n      const invoiceNumber = generateInvoiceNumber(invoicesData.nextInvoiceNumber);\n      const now = new Date().toISOString();\n\n      const newInvoice = {\n        id: String(Date.now()),\n        invoiceNumber,\n        referenceNumber: challan.challanNumber,\n        date: new Date().toISOString().split('T')[0],\n        dueDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\n        customerId: challan.customerId,\n        customerName: challan.customerName,\n        billingAddress: challan.billingAddress,\n        shippingAddress: challan.shippingAddress,\n        salesperson: '',\n        placeOfSupply: challan.placeOfSupply,\n        paymentTerms: 'Net 30',\n        items: challan.items,\n        subTotal: challan.subTotal,\n        shippingCharges: 0,\n        cgst: challan.cgst,\n        sgst: challan.sgst,\n        igst: challan.igst,\n        adjustment: challan.adjustment,\n        total: challan.total,\n        amountPaid: 0,\n        balanceDue: challan.total,\n        customerNotes: challan.customerNotes,\n        termsAndConditions: challan.termsAndConditions,\n        status: 'PENDING',\n        sourceType: 'delivery_challan',\n        sourceId: challan.id,\n        sourceNumber: challan.challanNumber,\n        createdAt: now,\n        updatedAt: now,\n        activityLogs: [{\n          id: '1',\n          timestamp: now,\n          action: 'created',\n          description: `Invoice ${invoiceNumber} created from delivery challan ${challan.challanNumber}`,\n          user: req.body.createdBy || 'Admin User'\n        }]\n      };\n\n      invoicesData.invoices.push(newInvoice);\n      invoicesData.nextInvoiceNumber += 1;\n      writeInvoicesData(invoicesData);\n\n      challan.invoiceStatus = 'INVOICED';\n      challan.invoiceId = newInvoice.id;\n      challan.updatedAt = now;\n      challan.activityLogs.push({\n        id: String(challan.activityLogs.length + 1),\n        timestamp: now,\n        action: 'converted',\n        description: `Converted to invoice ${invoiceNumber}`,\n        user: req.body.createdBy || 'Admin User'\n      });\n\n      challansData.deliveryChallans[challanIndex] = challan;\n      writeDeliveryChallansData(challansData);\n\n      res.json({ success: true, data: { challan, invoice: newInvoice } });\n    } catch (error) {\n      console.error('Error converting to invoice:', error);\n      res.status(500).json({ success: false, message: \"Failed to convert to invoice\" });\n    }\n  });\n\n  app.patch(\"/api/delivery-challans/:id/status\", (req: Request, res: Response) => {\n    try {\n      const challansData = readDeliveryChallansData();\n      const challanIndex = challansData.deliveryChallans.findIndex((c: any) => c.id === req.params.id);\n\n      if (challanIndex === -1) {\n        return res.status(404).json({ success: false, message: \"Delivery challan not found\" });\n      }\n\n      const challan = challansData.deliveryChallans[challanIndex];\n      const now = new Date().toISOString();\n\n      challan.status = req.body.status;\n      challan.updatedAt = now;\n\n      if (!challan.activityLogs) challan.activityLogs = [];\n      challan.activityLogs.push({\n        id: String(challan.activityLogs.length + 1),\n        timestamp: now,\n        action: 'status_changed',\n        description: `Status changed to ${req.body.status}`,\n        user: req.body.user || 'Admin User'\n      });\n\n      challansData.deliveryChallans[challanIndex] = challan;\n      writeDeliveryChallansData(challansData);\n\n      res.json({ success: true, data: challan });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to update status\" });\n    }\n  });\n\n  app.post(\"/api/delivery-challans/:id/clone\", (req: Request, res: Response) => {\n    try {\n      const challansData = readDeliveryChallansData();\n      const originalChallan = challansData.deliveryChallans.find((c: any) => c.id === req.params.id);\n\n      if (!originalChallan) {\n        return res.status(404).json({ success: false, message: \"Delivery challan not found\" });\n      }\n\n      const now = new Date().toISOString();\n      const newChallanNumber = generateChallanNumber(challansData.nextChallanNumber);\n\n      const clonedChallan = {\n        ...originalChallan,\n        id: String(Date.now()),\n        challanNumber: newChallanNumber,\n        status: 'DRAFT',\n        invoiceStatus: null,\n        invoiceId: null,\n        createdAt: now,\n        updatedAt: now,\n        activityLogs: [{\n          id: '1',\n          timestamp: now,\n          action: 'created',\n          description: `Cloned from ${originalChallan.challanNumber}`,\n          user: req.body.user || 'Admin User'\n        }]\n      };\n\n      challansData.deliveryChallans.push(clonedChallan);\n      challansData.nextChallanNumber += 1;\n      writeDeliveryChallansData(challansData);\n\n      res.json({ success: true, data: clonedChallan });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to clone delivery challan\" });\n    }\n  });\n\n  // Expenses API\n  app.get(\"/api/expenses\", (req: Request, res: Response) => {\n    try {\n      const data = readExpensesData();\n      const sortBy = req.query.sortBy as string || 'createdTime';\n      const sortOrder = req.query.sortOrder as string || 'desc';\n\n      let expenses = [...data.expenses];\n\n      expenses.sort((a: any, b: any) => {\n        let aVal = a[sortBy];\n        let bVal = b[sortBy];\n        if (sortBy === 'amount') {\n          aVal = parseFloat(aVal) || 0;\n          bVal = parseFloat(bVal) || 0;\n        }\n        if (sortOrder === 'desc') {\n          return aVal > bVal ? -1 : 1;\n        }\n        return aVal > bVal ? 1 : -1;\n      });\n\n      res.json({ success: true, data: expenses });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch expenses\" });\n    }\n  });\n\n  app.get(\"/api/expenses/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readExpensesData();\n      const expense = data.expenses.find((e: any) => e.id === req.params.id);\n      if (!expense) {\n        return res.status(404).json({ success: false, message: \"Expense not found\" });\n      }\n      res.json({ success: true, data: expense });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch expense\" });\n    }\n  });\n\n  app.post(\"/api/expenses\", (req: Request, res: Response) => {\n    try {\n      const data = readExpensesData();\n      const now = new Date().toISOString();\n      const expenseNumber = generateExpenseNumber(data.nextExpenseId);\n\n      const newExpense = {\n        id: String(data.nextExpenseId),\n        expenseNumber,\n        date: req.body.date || new Date().toISOString().split('T')[0],\n        expenseAccount: req.body.expenseAccount || '',\n        amount: req.body.amount || 0,\n        currency: req.body.currency || 'INR',\n        paidThrough: req.body.paidThrough || '',\n        expenseType: req.body.expenseType || 'services',\n        sac: req.body.sac || '',\n        vendorId: req.body.vendorId || '',\n        vendorName: req.body.vendorName || '',\n        gstTreatment: req.body.gstTreatment || '',\n        sourceOfSupply: req.body.sourceOfSupply || '',\n        destinationOfSupply: req.body.destinationOfSupply || '',\n        reverseCharge: req.body.reverseCharge || false,\n        tax: req.body.tax || '',\n        taxAmount: req.body.taxAmount || 0,\n        amountIs: req.body.amountIs || 'tax_exclusive',\n        invoiceNumber: req.body.invoiceNumber || '',\n        notes: req.body.notes || '',\n        customerId: req.body.customerId || '',\n        customerName: req.body.customerName || '',\n        reportingTags: req.body.reportingTags || [],\n        isBillable: req.body.isBillable || false,\n        status: req.body.status || 'recorded',\n        attachments: req.body.attachments || [],\n        createdAt: now,\n        updatedAt: now,\n        createdTime: now\n      };\n\n      data.expenses.unshift(newExpense);\n      data.nextExpenseId += 1;\n      writeExpensesData(data);\n\n      res.status(201).json({ success: true, data: newExpense });\n    } catch (error) {\n      console.error('Error creating expense:', error);\n      res.status(500).json({ success: false, message: \"Failed to create expense\" });\n    }\n  });\n\n  app.put(\"/api/expenses/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readExpensesData();\n      const index = data.expenses.findIndex((e: any) => e.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Expense not found\" });\n      }\n\n      data.expenses[index] = {\n        ...data.expenses[index],\n        ...req.body,\n        id: data.expenses[index].id,\n        expenseNumber: data.expenses[index].expenseNumber,\n        createdAt: data.expenses[index].createdAt,\n        updatedAt: new Date().toISOString()\n      };\n\n      writeExpensesData(data);\n      res.json({ success: true, data: data.expenses[index] });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to update expense\" });\n    }\n  });\n\n  app.delete(\"/api/expenses/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readExpensesData();\n      const index = data.expenses.findIndex((e: any) => e.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Expense not found\" });\n      }\n\n      data.expenses.splice(index, 1);\n      writeExpensesData(data);\n\n      res.json({ success: true, message: \"Expense deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to delete expense\" });\n    }\n  });\n\n  // Mileage API\n  app.get(\"/api/mileage\", (req: Request, res: Response) => {\n    try {\n      const data = readExpensesData();\n      res.json({ success: true, data: data.mileageRecords });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch mileage records\" });\n    }\n  });\n\n  app.post(\"/api/mileage\", (req: Request, res: Response) => {\n    try {\n      const data = readExpensesData();\n      const now = new Date().toISOString();\n\n      const newMileage = {\n        id: String(data.nextMileageId),\n        date: req.body.date || new Date().toISOString().split('T')[0],\n        employee: req.body.employee || '',\n        calculationMethod: req.body.calculationMethod || 'distance_travelled',\n        distance: req.body.distance || 0,\n        unit: req.body.unit || 'km',\n        startOdometer: req.body.startOdometer || 0,\n        endOdometer: req.body.endOdometer || 0,\n        amount: req.body.amount || 0,\n        currency: req.body.currency || 'INR',\n        paidThrough: req.body.paidThrough || '',\n        vendorId: req.body.vendorId || '',\n        vendorName: req.body.vendorName || '',\n        invoiceNumber: req.body.invoiceNumber || '',\n        notes: req.body.notes || '',\n        customerId: req.body.customerId || '',\n        customerName: req.body.customerName || '',\n        reportingTags: req.body.reportingTags || [],\n        status: 'recorded',\n        createdAt: now,\n        updatedAt: now\n      };\n\n      data.mileageRecords.unshift(newMileage);\n      data.nextMileageId += 1;\n      writeExpensesData(data);\n\n      res.status(201).json({ success: true, data: newMileage });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to create mileage record\" });\n    }\n  });\n\n  app.delete(\"/api/mileage/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readExpensesData();\n      const index = data.mileageRecords.findIndex((m: any) => m.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Mileage record not found\" });\n      }\n\n      data.mileageRecords.splice(index, 1);\n      writeExpensesData(data);\n\n      res.json({ success: true, message: \"Mileage record deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to delete mileage record\" });\n    }\n  });\n\n  // Mileage Settings API\n  app.get(\"/api/mileage-settings\", (req: Request, res: Response) => {\n    try {\n      const data = readExpensesData();\n      res.json({ success: true, data: data.mileageSettings });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch mileage settings\" });\n    }\n  });\n\n  app.put(\"/api/mileage-settings\", (req: Request, res: Response) => {\n    try {\n      const data = readExpensesData();\n      data.mileageSettings = {\n        ...data.mileageSettings,\n        ...req.body\n      };\n      writeExpensesData(data);\n      res.json({ success: true, data: data.mileageSettings });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to update mileage settings\" });\n    }\n  });\n\n  app.post(\"/api/mileage-settings/rates\", (req: Request, res: Response) => {\n    try {\n      const data = readExpensesData();\n      const newRate = {\n        id: String(Date.now()),\n        startDate: req.body.startDate,\n        rate: req.body.rate,\n        currency: req.body.currency || 'INR'\n      };\n      data.mileageSettings.mileageRates.push(newRate);\n      writeExpensesData(data);\n      res.status(201).json({ success: true, data: newRate });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to add mileage rate\" });\n    }\n  });\n\n  app.delete(\"/api/mileage-settings/rates/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readExpensesData();\n      const index = data.mileageSettings.mileageRates.findIndex((r: any) => r.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Mileage rate not found\" });\n      }\n\n      data.mileageSettings.mileageRates.splice(index, 1);\n      writeExpensesData(data);\n\n      res.json({ success: true, message: \"Mileage rate deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to delete mileage rate\" });\n    }\n  });\n\n  // Bulk import expenses\n  app.post(\"/api/expenses/import\", (req: Request, res: Response) => {\n    try {\n      const data = readExpensesData();\n      const importedExpenses = req.body.expenses || [];\n      const now = new Date().toISOString();\n\n      const newExpenses = importedExpenses.map((expense: any, index: number) => ({\n        id: String(data.nextExpenseId + index),\n        expenseNumber: generateExpenseNumber(data.nextExpenseId + index),\n        ...expense,\n        status: 'recorded',\n        createdAt: now,\n        updatedAt: now,\n        createdTime: now\n      }));\n\n      data.expenses = [...newExpenses, ...data.expenses];\n      data.nextExpenseId += importedExpenses.length;\n      writeExpensesData(data);\n\n      res.status(201).json({ success: true, data: newExpenses, message: `${newExpenses.length} expenses imported successfully` });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to import expenses\" });\n    }\n  });\n\n  // Dashboard API\n  app.get(\"/api/dashboard\", (req: Request, res: Response) => {\n    try {\n      const data = readDashboardData();\n      res.json({ success: true, data });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch dashboard data\" });\n    }\n  });\n\n  app.get(\"/api/dashboard/summary\", (req: Request, res: Response) => {\n    try {\n      const data = readDashboardData();\n      res.json({ success: true, data: data.summary });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch summary\" });\n    }\n  });\n\n  app.get(\"/api/dashboard/cash-flow\", (req: Request, res: Response) => {\n    try {\n      const data = readDashboardData();\n      res.json({ success: true, data: data.cashFlow });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch cash flow\" });\n    }\n  });\n\n  app.get(\"/api/dashboard/income-expense\", (req: Request, res: Response) => {\n    try {\n      const data = readDashboardData();\n      res.json({ success: true, data: data.incomeExpense });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch income expense\" });\n    }\n  });\n\n  app.get(\"/api/dashboard/top-expenses\", (req: Request, res: Response) => {\n    try {\n      const data = readDashboardData();\n      res.json({ success: true, data: data.topExpenses });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch top expenses\" });\n    }\n  });\n\n  app.put(\"/api/dashboard\", (req: Request, res: Response) => {\n    try {\n      const data = req.body;\n      writeDashboardData(data);\n      res.json({ success: true, data });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to update dashboard data\" });\n    }\n  });\n\n  // Reports API\n  app.get(\"/api/reports\", (req: Request, res: Response) => {\n    try {\n      const data = readReportsData();\n      res.json({ success: true, data });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch reports data\" });\n    }\n  });\n\n  app.get(\"/api/reports/profit-loss\", (req: Request, res: Response) => {\n    try {\n      const data = readReportsData();\n      res.json({ success: true, data: data.profitAndLoss });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch profit and loss\" });\n    }\n  });\n\n  app.get(\"/api/reports/sales-by-customer\", (req: Request, res: Response) => {\n    try {\n      const data = readReportsData();\n      res.json({ success: true, data: data.salesByCustomer });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch sales by customer\" });\n    }\n  });\n\n  app.get(\"/api/reports/expense-breakdown\", (req: Request, res: Response) => {\n    try {\n      const data = readReportsData();\n      res.json({ success: true, data: data.expenseBreakdown });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch expense breakdown\" });\n    }\n  });\n\n  app.get(\"/api/reports/tax-summary\", (req: Request, res: Response) => {\n    try {\n      const data = readReportsData();\n      res.json({ success: true, data: data.taxSummary });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch tax summary\" });\n    }\n  });\n\n  app.get(\"/api/reports/receivables-aging\", (req: Request, res: Response) => {\n    try {\n      const data = readReportsData();\n      res.json({ success: true, data: data.receivablesAging });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch receivables aging\" });\n    }\n  });\n\n  app.get(\"/api/reports/payables-aging\", (req: Request, res: Response) => {\n    try {\n      const data = readReportsData();\n      res.json({ success: true, data: data.payablesAging });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch payables aging\" });\n    }\n  });\n\n  app.put(\"/api/reports\", (req: Request, res: Response) => {\n    try {\n      const data = req.body;\n      writeReportsData(data);\n      res.json({ success: true, data });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to update reports data\" });\n    }\n  });\n\n  // Purchase Orders API\n  app.get(\"/api/purchase-orders/next-number\", (req: Request, res: Response) => {\n    try {\n      const data = readPurchaseOrdersData();\n      const nextNumber = generatePurchaseOrderNumber(data.nextPurchaseOrderNumber);\n      res.json({ success: true, data: { purchaseOrderNumber: nextNumber } });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to get next purchase order number\" });\n    }\n  });\n\n  app.get(\"/api/purchase-orders\", (req: Request, res: Response) => {\n    try {\n      const data = readPurchaseOrdersData();\n      res.json({ success: true, data: data.purchaseOrders });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch purchase orders\" });\n    }\n  });\n\n  app.get(\"/api/purchase-orders/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readPurchaseOrdersData();\n      const purchaseOrder = data.purchaseOrders.find((po: any) => po.id === req.params.id);\n      if (!purchaseOrder) {\n        return res.status(404).json({ success: false, message: \"Purchase order not found\" });\n      }\n      res.json({ success: true, data: purchaseOrder });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch purchase order\" });\n    }\n  });\n\n  app.post(\"/api/purchase-orders\", (req: Request, res: Response) => {\n    try {\n      const data = readPurchaseOrdersData();\n      const purchaseOrderNumber = generatePurchaseOrderNumber(data.nextPurchaseOrderNumber);\n      const now = new Date().toISOString();\n\n      const newPurchaseOrder = {\n        id: String(Date.now()),\n        purchaseOrderNumber,\n        referenceNumber: req.body.referenceNumber || '',\n        date: req.body.date || new Date().toISOString().split('T')[0],\n        deliveryDate: req.body.deliveryDate || '',\n        vendorId: req.body.vendorId || '',\n        vendorName: req.body.vendorName || '',\n        vendorAddress: req.body.vendorAddress || {},\n        deliveryAddress: req.body.deliveryAddress || {},\n        deliveryAddressType: req.body.deliveryAddressType || 'organization',\n        paymentTerms: req.body.paymentTerms || 'Due on Receipt',\n        shipmentPreference: req.body.shipmentPreference || '',\n        reverseCharge: req.body.reverseCharge || false,\n        items: req.body.items || [],\n        subTotal: req.body.subTotal || 0,\n        discountType: req.body.discountType || 'percent',\n        discountValue: req.body.discountValue || 0,\n        discountAmount: req.body.discountAmount || 0,\n        taxType: req.body.taxType || 'TDS',\n        taxCategory: req.body.taxCategory || '',\n        taxAmount: req.body.taxAmount || 0,\n        adjustment: req.body.adjustment || 0,\n        adjustmentDescription: req.body.adjustmentDescription || '',\n        total: req.body.total || 0,\n        notes: req.body.notes || '',\n        termsAndConditions: req.body.termsAndConditions || '',\n        attachments: req.body.attachments || [],\n        status: req.body.status || 'ISSUED',\n        receiveStatus: req.body.receiveStatus || 'YET TO BE RECEIVED',\n        billedStatus: req.body.billedStatus || 'YET TO BE BILLED',\n        pdfTemplate: req.body.pdfTemplate || 'Standard Template',\n        createdAt: now,\n        updatedAt: now,\n        createdBy: req.body.createdBy || 'Admin User',\n        activityLogs: [\n          {\n            id: '1',\n            timestamp: now,\n            action: 'created',\n            description: `Purchase Order created for ${req.body.total?.toLocaleString('en-IN') || '0.00'}`,\n            user: req.body.createdBy || 'Admin User'\n          }\n        ]\n      };\n\n      data.purchaseOrders.unshift(newPurchaseOrder);\n      data.nextPurchaseOrderNumber += 1;\n      writePurchaseOrdersData(data);\n\n      res.status(201).json({ success: true, data: newPurchaseOrder });\n    } catch (error) {\n      console.error('Error creating purchase order:', error);\n      res.status(500).json({ success: false, message: 'Failed to create purchase order' });\n    }\n  });\n\n  app.put(\"/api/purchase-orders/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readPurchaseOrdersData();\n      const poIndex = data.purchaseOrders.findIndex((po: any) => po.id === req.params.id);\n\n      if (poIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Purchase order not found' });\n      }\n\n      const now = new Date().toISOString();\n      const existingPO = data.purchaseOrders[poIndex];\n\n      const updatedPO = {\n        ...existingPO,\n        ...req.body,\n        id: existingPO.id,\n        purchaseOrderNumber: existingPO.purchaseOrderNumber,\n        createdAt: existingPO.createdAt,\n        updatedAt: now,\n        activityLogs: [\n          ...existingPO.activityLogs,\n          {\n            id: String(existingPO.activityLogs.length + 1),\n            timestamp: now,\n            action: 'updated',\n            description: 'Purchase Order has been updated',\n            user: req.body.updatedBy || 'Admin User'\n          }\n        ]\n      };\n\n      data.purchaseOrders[poIndex] = updatedPO;\n      writePurchaseOrdersData(data);\n\n      res.json({ success: true, data: updatedPO });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to update purchase order' });\n    }\n  });\n\n  app.patch(\"/api/purchase-orders/:id/status\", (req: Request, res: Response) => {\n    try {\n      const data = readPurchaseOrdersData();\n      const poIndex = data.purchaseOrders.findIndex((po: any) => po.id === req.params.id);\n\n      if (poIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Purchase order not found' });\n      }\n\n      const now = new Date().toISOString();\n      const existingPO = data.purchaseOrders[poIndex];\n      const newStatus = req.body.status;\n\n      let actionDescription = `Status changed to ${newStatus}`;\n      if (newStatus === 'ISSUED') actionDescription = 'Purchase Order has been issued';\n      if (newStatus === 'CLOSED') actionDescription = 'Purchase Order has been closed';\n      if (newStatus === 'CANCELLED') actionDescription = 'Purchase Order has been cancelled';\n\n      existingPO.status = newStatus;\n      existingPO.updatedAt = now;\n      existingPO.activityLogs.push({\n        id: String(existingPO.activityLogs.length + 1),\n        timestamp: now,\n        action: newStatus.toLowerCase(),\n        description: actionDescription,\n        user: req.body.updatedBy || 'Admin User'\n      });\n\n      data.purchaseOrders[poIndex] = existingPO;\n      writePurchaseOrdersData(data);\n\n      res.json({ success: true, data: existingPO });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to update purchase order status' });\n    }\n  });\n\n  app.post(\"/api/purchase-orders/:id/convert-to-bill\", (req: Request, res: Response) => {\n    try {\n      const data = readPurchaseOrdersData();\n      const poIndex = data.purchaseOrders.findIndex((po: any) => po.id === req.params.id);\n\n      if (poIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Purchase order not found' });\n      }\n\n      const now = new Date().toISOString();\n      const purchaseOrder = data.purchaseOrders[poIndex];\n\n      purchaseOrder.billedStatus = 'BILLED';\n      purchaseOrder.updatedAt = now;\n      purchaseOrder.activityLogs.push({\n        id: String(purchaseOrder.activityLogs.length + 1),\n        timestamp: now,\n        action: 'converted_to_bill',\n        description: 'Purchase Order converted to Bill',\n        user: req.body.convertedBy || 'Admin User'\n      });\n\n      data.purchaseOrders[poIndex] = purchaseOrder;\n      writePurchaseOrdersData(data);\n\n      res.json({ success: true, data: purchaseOrder, message: 'Purchase Order converted to Bill' });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to convert to bill' });\n    }\n  });\n\n  app.delete(\"/api/purchase-orders/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readPurchaseOrdersData();\n      const poIndex = data.purchaseOrders.findIndex((po: any) => po.id === req.params.id);\n\n      if (poIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Purchase order not found' });\n      }\n\n      data.purchaseOrders.splice(poIndex, 1);\n      writePurchaseOrdersData(data);\n\n      res.json({ success: true, message: 'Purchase order deleted successfully' });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to delete purchase order' });\n    }\n  });\n\n  // Bills API\n  app.get(\"/api/bills/next-number\", (req: Request, res: Response) => {\n    try {\n      const data = readBillsData();\n      const nextNumber = generateBillNumber(data.nextBillNumber);\n      res.json({ success: true, data: { billNumber: nextNumber } });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to get next bill number\" });\n    }\n  });\n\n  app.get(\"/api/bills/accounts\", (req: Request, res: Response) => {\n    try {\n      const data = readBillsData();\n      res.json({ success: true, data: data.accounts || [] });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch accounts\" });\n    }\n  });\n\n  app.get(\"/api/bills/taxes\", (req: Request, res: Response) => {\n    try {\n      const data = readBillsData();\n      res.json({ success: true, data: data.taxes || [] });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch taxes\" });\n    }\n  });\n\n  app.get(\"/api/bills\", (req: Request, res: Response) => {\n    try {\n      const data = readBillsData();\n      res.json({ success: true, data: data.bills });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch bills\" });\n    }\n  });\n\n  app.get(\"/api/bills/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readBillsData();\n      const bill = data.bills.find((b: any) => b.id === req.params.id);\n      if (!bill) {\n        return res.status(404).json({ success: false, message: \"Bill not found\" });\n      }\n      res.json({ success: true, data: bill });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch bill\" });\n    }\n  });\n\n  app.post(\"/api/bills\", (req: Request, res: Response) => {\n    try {\n      const data = readBillsData();\n      const billNumber = req.body.billNumber || generateBillNumber(data.nextBillNumber);\n      const now = new Date().toISOString();\n\n      const newBill = {\n        id: String(Date.now()),\n        billNumber,\n        orderNumber: req.body.orderNumber || '',\n        vendorId: req.body.vendorId || '',\n        vendorName: req.body.vendorName || '',\n        vendorAddress: req.body.vendorAddress || {\n          street1: '',\n          street2: '',\n          city: '',\n          state: '',\n          pinCode: '',\n          country: 'India',\n          gstin: ''\n        },\n        billDate: req.body.billDate || new Date().toISOString().split('T')[0],\n        dueDate: req.body.dueDate || new Date().toISOString().split('T')[0],\n        paymentTerms: req.body.paymentTerms || 'Due on Receipt',\n        reverseCharge: req.body.reverseCharge || false,\n        subject: req.body.subject || '',\n        items: req.body.items || [],\n        subTotal: req.body.subTotal || 0,\n        discountType: req.body.discountType || 'percent',\n        discountValue: req.body.discountValue || 0,\n        discountAmount: req.body.discountAmount || 0,\n        taxType: req.body.taxType || 'TDS',\n        taxCategory: req.body.taxCategory || '',\n        taxAmount: req.body.taxAmount || 0,\n        adjustment: req.body.adjustment || 0,\n        adjustmentDescription: req.body.adjustmentDescription || '',\n        total: req.body.total || 0,\n        amountPaid: req.body.amountPaid || 0,\n        balanceDue: req.body.balanceDue || req.body.total || 0,\n        notes: req.body.notes || '',\n        attachments: req.body.attachments || [],\n        status: req.body.status || 'OPEN',\n        pdfTemplate: req.body.pdfTemplate || 'Standard Template',\n        journalEntries: req.body.journalEntries || [],\n        createdAt: now,\n        updatedAt: now,\n        createdBy: req.body.createdBy || 'Admin User',\n        activityLogs: [\n          {\n            id: '1',\n            timestamp: now,\n            action: 'created',\n            description: `Bill created for ${req.body.total?.toLocaleString('en-IN') || '0.00'}`,\n            user: req.body.createdBy || 'Admin User'\n          }\n        ]\n      };\n\n      data.bills.unshift(newBill);\n      data.nextBillNumber += 1;\n      writeBillsData(data);\n\n      res.status(201).json({ success: true, data: newBill });\n    } catch (error) {\n      console.error('Error creating bill:', error);\n      res.status(500).json({ success: false, message: 'Failed to create bill' });\n    }\n  });\n\n  app.put(\"/api/bills/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readBillsData();\n      const billIndex = data.bills.findIndex((b: any) => b.id === req.params.id);\n\n      if (billIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Bill not found' });\n      }\n\n      const now = new Date().toISOString();\n      const existingBill = data.bills[billIndex];\n\n      const updatedBill = {\n        ...existingBill,\n        ...req.body,\n        id: existingBill.id,\n        billNumber: existingBill.billNumber,\n        createdAt: existingBill.createdAt,\n        updatedAt: now,\n        activityLogs: [\n          ...(existingBill.activityLogs || []),\n          {\n            id: String((existingBill.activityLogs?.length || 0) + 1),\n            timestamp: now,\n            action: 'updated',\n            description: 'Bill has been updated',\n            user: req.body.updatedBy || 'Admin User'\n          }\n        ]\n      };\n\n      data.bills[billIndex] = updatedBill;\n      writeBillsData(data);\n\n      res.json({ success: true, data: updatedBill });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to update bill' });\n    }\n  });\n\n  app.patch(\"/api/bills/:id/status\", (req: Request, res: Response) => {\n    try {\n      const data = readBillsData();\n      const billIndex = data.bills.findIndex((b: any) => b.id === req.params.id);\n\n      if (billIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Bill not found' });\n      }\n\n      const now = new Date().toISOString();\n      const existingBill = data.bills[billIndex];\n      const newStatus = req.body.status;\n\n      let actionDescription = `Status changed to ${newStatus}`;\n      if (newStatus === 'PAID') actionDescription = 'Bill has been paid';\n      if (newStatus === 'OVERDUE') actionDescription = 'Bill is overdue';\n      if (newStatus === 'VOID') actionDescription = 'Bill has been voided';\n\n      existingBill.status = newStatus;\n      existingBill.updatedAt = now;\n      if (newStatus === 'PAID') {\n        existingBill.amountPaid = existingBill.total;\n        existingBill.balanceDue = 0;\n      }\n      existingBill.activityLogs = existingBill.activityLogs || [];\n      existingBill.activityLogs.push({\n        id: String(existingBill.activityLogs.length + 1),\n        timestamp: now,\n        action: newStatus.toLowerCase(),\n        description: actionDescription,\n        user: req.body.updatedBy || 'Admin User'\n      });\n\n      data.bills[billIndex] = existingBill;\n      writeBillsData(data);\n\n      res.json({ success: true, data: existingBill });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to update bill status' });\n    }\n  });\n\n  app.post(\"/api/bills/:id/record-payment\", (req: Request, res: Response) => {\n    try {\n      const data = readBillsData();\n      const billIndex = data.bills.findIndex((b: any) => b.id === req.params.id);\n\n      if (billIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Bill not found' });\n      }\n\n      const now = new Date().toISOString();\n      const bill = data.bills[billIndex];\n      const paymentAmount = req.body.amount || 0;\n\n      bill.amountPaid = (bill.amountPaid || 0) + paymentAmount;\n      bill.balanceDue = bill.total - bill.amountPaid;\n      bill.status = bill.balanceDue <= 0 ? 'PAID' : 'PARTIALLY_PAID';\n      bill.updatedAt = now;\n      bill.activityLogs = bill.activityLogs || [];\n      bill.activityLogs.push({\n        id: String(bill.activityLogs.length + 1),\n        timestamp: now,\n        action: 'payment',\n        description: `Payment of ${paymentAmount.toLocaleString('en-IN')} recorded`,\n        user: req.body.recordedBy || 'Admin User'\n      });\n\n      data.bills[billIndex] = bill;\n      writeBillsData(data);\n\n      // Also create a record in Payments Made\n      const paymentsMadeData = readPaymentsMadeDataGlobal();\n      const paymentNumber = generatePaymentMadeNumberGlobal(paymentsMadeData.nextPaymentNumber);\n\n      const newPayment = {\n        id: `pm-${Date.now()}`,\n        paymentNumber,\n        vendorId: bill.vendorId,\n        vendorName: bill.vendorName,\n        gstTreatment: bill.gstTreatment || '',\n        sourceOfSupply: bill.sourceOfSupply || '',\n        destinationOfSupply: bill.destinationOfSupply || '',\n        descriptionOfSupply: '',\n        paymentAmount: paymentAmount,\n        reverseCharge: bill.reverseCharge || false,\n        tds: '',\n        paymentDate: req.body.paymentDate || now.split('T')[0],\n        paymentMode: req.body.paymentMode || 'Cash',\n        paidThrough: req.body.paidThrough || 'Petty Cash',\n        depositTo: req.body.depositTo || 'prepaid_expenses',\n        reference: req.body.reference || '',\n        notes: req.body.notes || `Payment for Bill #${bill.billNumber}`,\n        billPayments: {\n          [bill.id]: {\n            billId: bill.id,\n            billNumber: bill.billNumber,\n            billAmount: bill.total,\n            amountPaid: paymentAmount\n          }\n        },\n        paymentType: 'bill_payment',\n        status: 'PAID',\n        createdAt: now,\n        updatedAt: now\n      };\n\n      paymentsMadeData.paymentsMade.push(newPayment);\n      paymentsMadeData.nextPaymentNumber++;\n      writePaymentsMadeDataGlobal(paymentsMadeData);\n\n      res.json({ success: true, data: bill, payment: newPayment });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to record payment' });\n    }\n  });\n\n  app.delete(\"/api/bills/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readBillsData();\n      const billIndex = data.bills.findIndex((b: any) => b.id === req.params.id);\n\n      if (billIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Bill not found' });\n      }\n\n      data.bills.splice(billIndex, 1);\n      writeBillsData(data);\n\n      res.json({ success: true, message: 'Bill deleted successfully' });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to delete bill' });\n    }\n  });\n\n  // Credit Notes API\n  app.get(\"/api/credit-notes\", (_req: Request, res: Response) => {\n    try {\n      const data = readCreditNotesData();\n      res.json({ success: true, data: data.creditNotes });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch credit notes\" });\n    }\n  });\n\n  app.get(\"/api/credit-notes/next-number\", (_req: Request, res: Response) => {\n    try {\n      const data = readCreditNotesData();\n      const nextNumber = generateCreditNoteNumber(data.nextCreditNoteNumber || 1);\n      res.json({ success: true, data: nextNumber });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to get next credit note number\" });\n    }\n  });\n\n  app.get(\"/api/credit-notes/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readCreditNotesData();\n      const creditNote = data.creditNotes.find((cn: any) => cn.id === req.params.id);\n      if (!creditNote) {\n        return res.status(404).json({ success: false, message: \"Credit note not found\" });\n      }\n      res.json({ success: true, data: creditNote });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch credit note\" });\n    }\n  });\n\n  app.post(\"/api/credit-notes\", (req: Request, res: Response) => {\n    try {\n      const data = readCreditNotesData();\n      const now = new Date().toISOString();\n      const creditNoteNumber = generateCreditNoteNumber(data.nextCreditNoteNumber || 1);\n\n      const newCreditNote = {\n        id: String(Date.now()),\n        creditNoteNumber,\n        referenceNumber: req.body.referenceNumber || \"\",\n        date: req.body.date || new Date().toISOString().split('T')[0],\n        customerId: req.body.customerId || \"\",\n        customerName: req.body.customerName || \"\",\n        invoiceId: req.body.invoiceId || \"\",\n        invoiceNumber: req.body.invoiceNumber || \"\",\n        reason: req.body.reason || \"\",\n        salesperson: req.body.salesperson || \"\",\n        subject: req.body.subject || \"\",\n        billingAddress: req.body.billingAddress || { street: \"\", city: \"\", state: \"\", country: \"India\", pincode: \"\" },\n        gstin: req.body.gstin || \"\",\n        placeOfSupply: req.body.placeOfSupply || \"\",\n        items: req.body.items || [],\n        subTotal: req.body.subTotal || 0,\n        shippingCharges: req.body.shippingCharges || 0,\n        tdsType: req.body.tdsType || \"\",\n        tdsAmount: req.body.tdsAmount || 0,\n        cgst: req.body.cgst || 0,\n        sgst: req.body.sgst || 0,\n        igst: req.body.igst || 0,\n        adjustment: req.body.adjustment || 0,\n        total: req.body.total || 0,\n        creditsRemaining: req.body.total || 0,\n        customerNotes: req.body.customerNotes || \"\",\n        termsAndConditions: req.body.termsAndConditions || \"\",\n        status: req.body.status || \"OPEN\",\n        pdfTemplate: req.body.pdfTemplate || \"Standard Template\",\n        createdAt: now,\n        updatedAt: now,\n        createdBy: req.body.createdBy || \"Admin User\",\n        activityLogs: [\n          {\n            id: \"1\",\n            timestamp: now,\n            action: \"created\",\n            description: `Credit Note created for ${(req.body.total || 0).toLocaleString('en-IN')}`,\n            user: req.body.createdBy || \"Admin User\"\n          }\n        ]\n      };\n\n      data.creditNotes.unshift(newCreditNote);\n      data.nextCreditNoteNumber = (data.nextCreditNoteNumber || 1) + 1;\n      writeCreditNotesData(data);\n\n      res.json({ success: true, data: newCreditNote });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to create credit note\" });\n    }\n  });\n\n  app.put(\"/api/credit-notes/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readCreditNotesData();\n      const index = data.creditNotes.findIndex((cn: any) => cn.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Credit note not found\" });\n      }\n\n      const now = new Date().toISOString();\n      const existingCreditNote = data.creditNotes[index];\n\n      const updatedCreditNote = {\n        ...existingCreditNote,\n        ...req.body,\n        id: existingCreditNote.id,\n        creditNoteNumber: existingCreditNote.creditNoteNumber,\n        createdAt: existingCreditNote.createdAt,\n        updatedAt: now\n      };\n\n      updatedCreditNote.activityLogs = existingCreditNote.activityLogs || [];\n      updatedCreditNote.activityLogs.push({\n        id: String(updatedCreditNote.activityLogs.length + 1),\n        timestamp: now,\n        action: \"updated\",\n        description: \"Credit Note has been updated\",\n        user: req.body.updatedBy || \"Admin User\"\n      });\n\n      data.creditNotes[index] = updatedCreditNote;\n      writeCreditNotesData(data);\n\n      res.json({ success: true, data: updatedCreditNote });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to update credit note\" });\n    }\n  });\n\n  app.patch(\"/api/credit-notes/:id/status\", (req: Request, res: Response) => {\n    try {\n      const data = readCreditNotesData();\n      const index = data.creditNotes.findIndex((cn: any) => cn.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Credit note not found\" });\n      }\n\n      const now = new Date().toISOString();\n      const creditNote = data.creditNotes[index];\n      const newStatus = req.body.status;\n\n      let actionDescription = `Status changed to ${newStatus}`;\n      if (newStatus === 'CLOSED') actionDescription = 'Credit Note has been closed';\n      if (newStatus === 'VOID') actionDescription = 'Credit Note has been voided';\n\n      creditNote.status = newStatus;\n      creditNote.updatedAt = now;\n      creditNote.activityLogs = creditNote.activityLogs || [];\n      creditNote.activityLogs.push({\n        id: String(creditNote.activityLogs.length + 1),\n        timestamp: now,\n        action: newStatus.toLowerCase(),\n        description: actionDescription,\n        user: req.body.updatedBy || \"Admin User\"\n      });\n\n      data.creditNotes[index] = creditNote;\n      writeCreditNotesData(data);\n\n      res.json({ success: true, data: creditNote });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to update credit note status\" });\n    }\n  });\n\n  app.delete(\"/api/credit-notes/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readCreditNotesData();\n      const index = data.creditNotes.findIndex((cn: any) => cn.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Credit note not found\" });\n      }\n\n      data.creditNotes.splice(index, 1);\n      writeCreditNotesData(data);\n\n      res.json({ success: true, message: \"Credit note deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to delete credit note\" });\n    }\n  });\n\n  // Salespersons API\n  app.get(\"/api/salespersons\", (_req, res) => {\n    try {\n      const data = readSalespersonsData();\n      res.json({ success: true, data: data.salespersons });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch salespersons\" });\n    }\n  });\n\n  app.post(\"/api/salespersons\", (req, res) => {\n    try {\n      const data = readSalespersonsData();\n      const newSalesperson = {\n        id: String(data.nextSalespersonId++),\n        ...req.body,\n        createdAt: new Date().toISOString()\n      };\n\n      data.salespersons.push(newSalesperson);\n      writeSalespersonsData(data);\n\n      res.json({ success: true, data: newSalesperson });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to create salesperson\" });\n    }\n  });\n\n  app.delete(\"/api/salespersons/:id\", (req, res) => {\n    try {\n      const data = readSalespersonsData();\n      const index = data.salespersons.findIndex((s: any) => s.id === req.params.id);\n\n      if (index !== -1) {\n        data.salespersons.splice(index, 1);\n        writeSalespersonsData(data);\n        res.json({ success: true, message: \"Salesperson deleted successfully\" });\n      } else {\n        res.status(404).json({ success: false, message: \"Salesperson not found\" });\n      }\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to delete salesperson\" });\n    }\n  });\n\n  // Payments Received API\n  app.get(\"/api/payments-received\", (req: Request, res: Response) => {\n    try {\n      const data = readPaymentsReceivedData();\n      const { customerId } = req.query;\n\n      let payments = data.paymentsReceived;\n\n      // Filter by customerId if provided\n      if (customerId) {\n        payments = payments.filter((payment: any) => payment.customerId === customerId);\n      }\n\n      res.json({ success: true, data: payments });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch payments received\" });\n    }\n  });\n\n  app.get(\"/api/payments-received/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readPaymentsReceivedData();\n      const payment = data.paymentsReceived.find((p: any) => p.id === req.params.id);\n\n      if (!payment) {\n        return res.status(404).json({ success: false, message: \"Payment not found\" });\n      }\n\n      res.json({ success: true, data: payment });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch payment\" });\n    }\n  });\n\n  app.post(\"/api/payments-received\", (req: Request, res: Response) => {\n    try {\n      const data = readPaymentsReceivedData();\n      const now = new Date().toISOString();\n      const paymentNumber = generatePaymentNumber(data.nextPaymentNumber);\n\n      const newPayment = {\n        id: `pr-${Date.now()}`,\n        paymentNumber,\n        ...req.body,\n        amountInWords: numberToWords(req.body.amount || 0),\n        createdAt: now,\n        status: req.body.status || 'PAID'\n      };\n\n      data.paymentsReceived.push(newPayment);\n      data.nextPaymentNumber++;\n      writePaymentsReceivedData(data);\n\n      // Update invoice balances if invoices are included in the payment\n      if (req.body.invoices && Array.isArray(req.body.invoices)) {\n        const invoicesData = readInvoicesData();\n        let invoicesUpdated = false;\n\n        req.body.invoices.forEach((paymentInvoice: any) => {\n          const invoiceIndex = invoicesData.invoices.findIndex((inv: any) => inv.id === paymentInvoice.invoiceId);\n          if (invoiceIndex !== -1) {\n            const invoice = invoicesData.invoices[invoiceIndex];\n            const currentBalance = invoice.balanceDue || invoice.total || 0;\n            const newBalance = Math.max(0, currentBalance - (paymentInvoice.paymentAmount || 0));\n\n            invoicesData.invoices[invoiceIndex] = {\n              ...invoice,\n              balanceDue: newBalance,\n              amountPaid: (invoice.amountPaid || 0) + (paymentInvoice.paymentAmount || 0),\n              status: newBalance === 0 ? 'PAID' : newBalance < (invoice.total || 0) ? 'PARTIALLY_PAID' : invoice.status,\n              updatedAt: now\n            };\n\n            // Add payment record to invoice\n            if (!invoice.payments) {\n              invoicesData.invoices[invoiceIndex].payments = [];\n            }\n            invoicesData.invoices[invoiceIndex].payments.push({\n              id: newPayment.id,\n              date: paymentInvoice.paymentReceivedDate || req.body.date,\n              amount: paymentInvoice.paymentAmount,\n              paymentMode: req.body.mode || 'Cash',\n              reference: req.body.referenceNumber || '',\n              notes: req.body.notes || ''\n            });\n\n            invoicesUpdated = true;\n          }\n        });\n\n        if (invoicesUpdated) {\n          writeInvoicesData(invoicesData);\n        }\n      }\n\n      res.json({ success: true, data: newPayment });\n    } catch (error) {\n      console.error('Error creating payment:', error);\n      res.status(500).json({ success: false, message: \"Failed to create payment\" });\n    }\n  });\n\n  app.put(\"/api/payments-received/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readPaymentsReceivedData();\n      const index = data.paymentsReceived.findIndex((p: any) => p.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Payment not found\" });\n      }\n\n      const updatedPayment = {\n        ...data.paymentsReceived[index],\n        ...req.body,\n        amountInWords: numberToWords(req.body.amount || data.paymentsReceived[index].amount),\n        updatedAt: new Date().toISOString()\n      };\n\n      data.paymentsReceived[index] = updatedPayment;\n      writePaymentsReceivedData(data);\n\n      res.json({ success: true, data: updatedPayment });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to update payment\" });\n    }\n  });\n\n  app.delete(\"/api/payments-received/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readPaymentsReceivedData();\n      const index = data.paymentsReceived.findIndex((p: any) => p.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Payment not found\" });\n      }\n\n      data.paymentsReceived.splice(index, 1);\n      writePaymentsReceivedData(data);\n\n      res.json({ success: true, message: \"Payment deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to delete payment\" });\n    }\n  });\n\n  app.patch(\"/api/payments-received/:id/refund\", (req: Request, res: Response) => {\n    try {\n      const data = readPaymentsReceivedData();\n      const index = data.paymentsReceived.findIndex((p: any) => p.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Payment not found\" });\n      }\n\n      const payment = data.paymentsReceived[index];\n      const refundAmount = req.body.refundAmount || payment.amount;\n      const now = new Date().toISOString();\n\n      payment.status = 'REFUNDED';\n      payment.refundedAt = now;\n      payment.refundAmount = refundAmount;\n\n      data.paymentsReceived[index] = payment;\n      writePaymentsReceivedData(data);\n\n      // Also update linked invoices if any\n      if (payment.invoices && payment.invoices.length > 0) {\n        const invoicesData = readInvoicesData();\n\n        payment.invoices.forEach((paymentInvoice: any) => {\n          const invoiceIndex = invoicesData.invoices.findIndex((inv: any) => inv.id === paymentInvoice.invoiceId);\n          if (invoiceIndex !== -1) {\n            const invoice = invoicesData.invoices[invoiceIndex];\n\n            // Initialize refunds array if not exists\n            if (!invoice.refunds) {\n              invoice.refunds = [];\n            }\n\n            // Add refund record\n            invoice.refunds.push({\n              id: `ref-${Date.now()}`,\n              paymentId: payment.id,\n              paymentNumber: payment.paymentNumber,\n              amount: paymentInvoice.paymentAmount || refundAmount,\n              date: now,\n              reason: req.body.reason || 'Payment refunded'\n            });\n\n            // Update amounts\n            invoice.amountRefunded = (invoice.amountRefunded || 0) + (paymentInvoice.paymentAmount || refundAmount);\n            invoice.amountPaid = Math.max(0, (invoice.amountPaid || 0) - (paymentInvoice.paymentAmount || refundAmount));\n            invoice.balanceDue = invoice.total - invoice.amountPaid;\n\n            // Update status\n            if (invoice.balanceDue >= invoice.total) {\n              invoice.status = 'SENT';\n            } else if (invoice.balanceDue > 0) {\n              invoice.status = 'PARTIALLY_PAID';\n            }\n\n            invoice.updatedAt = now;\n            invoice.activityLogs = invoice.activityLogs || [];\n            invoice.activityLogs.push({\n              id: String(invoice.activityLogs.length + 1),\n              timestamp: now,\n              action: 'refund_recorded',\n              description: `Refund of ${(paymentInvoice.paymentAmount || refundAmount).toLocaleString('en-IN')} recorded from Payment #${payment.paymentNumber}`,\n              user: req.body.refundedBy || 'Admin User'\n            });\n\n            invoicesData.invoices[invoiceIndex] = invoice;\n          }\n        });\n\n        writeInvoicesData(invoicesData);\n      }\n\n      res.json({ success: true, data: payment });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to refund payment\" });\n    }\n  });\n\n  // Refund from invoice - creates refund record and updates payment\n  app.post(\"/api/invoices/:id/refund\", (req: Request, res: Response) => {\n    try {\n      const invoicesData = readInvoicesData();\n      const invoiceIndex = invoicesData.invoices.findIndex((i: any) => i.id === req.params.id);\n\n      if (invoiceIndex === -1) {\n        return res.status(404).json({ success: false, message: 'Invoice not found' });\n      }\n\n      const invoice = invoicesData.invoices[invoiceIndex];\n      const refundAmount = req.body.amount || 0;\n      const now = new Date().toISOString();\n\n      // Validate refund amount\n      if (refundAmount <= 0) {\n        return res.status(400).json({ success: false, message: 'Refund amount must be greater than 0' });\n      }\n\n      if (refundAmount > (invoice.amountPaid || 0)) {\n        return res.status(400).json({ success: false, message: 'Refund amount cannot exceed amount paid' });\n      }\n\n      // Initialize refunds array if not exists\n      if (!invoice.refunds) {\n        invoice.refunds = [];\n      }\n\n      // Add refund record\n      const refundId = `ref-${Date.now()}`;\n      invoice.refunds.push({\n        id: refundId,\n        paymentId: req.body.paymentId || null,\n        paymentNumber: req.body.paymentNumber || null,\n        amount: refundAmount,\n        date: now,\n        reason: req.body.reason || 'Refund processed',\n        mode: req.body.mode || 'Cash'\n      });\n\n      // Update amounts\n      invoice.amountRefunded = (invoice.amountRefunded || 0) + refundAmount;\n      invoice.amountPaid = Math.max(0, (invoice.amountPaid || 0) - refundAmount);\n      invoice.balanceDue = invoice.total - invoice.amountPaid;\n\n      // Update status\n      if (invoice.balanceDue >= invoice.total) {\n        invoice.status = 'SENT';\n      } else if (invoice.balanceDue > 0) {\n        invoice.status = 'PARTIALLY_PAID';\n      }\n\n      invoice.updatedAt = now;\n      invoice.activityLogs = invoice.activityLogs || [];\n      invoice.activityLogs.push({\n        id: String(invoice.activityLogs.length + 1),\n        timestamp: now,\n        action: 'refund_recorded',\n        description: `Refund of ${refundAmount.toLocaleString('en-IN')} processed`,\n        user: req.body.refundedBy || 'Admin User'\n      });\n\n      invoicesData.invoices[invoiceIndex] = invoice;\n      writeInvoicesData(invoicesData);\n\n      // Also update linked payment if paymentId is provided\n      if (req.body.paymentId) {\n        const paymentsData = readPaymentsReceivedData();\n        const paymentIndex = paymentsData.paymentsReceived.findIndex((p: any) => p.id === req.body.paymentId);\n\n        if (paymentIndex !== -1) {\n          const payment = paymentsData.paymentsReceived[paymentIndex];\n          payment.status = 'REFUNDED';\n          payment.refundedAt = now;\n          payment.refundAmount = (payment.refundAmount || 0) + refundAmount;\n\n          paymentsData.paymentsReceived[paymentIndex] = payment;\n          writePaymentsReceivedData(paymentsData);\n        }\n      }\n\n      // Create a new payment record for the refund in Payments Received\n      const paymentsData = readPaymentsReceivedData();\n      const refundPayment = {\n        id: `pr-ref-${Date.now()}`,\n        paymentNumber: `REF-${generatePaymentNumber(paymentsData.nextPaymentNumber)}`,\n        date: now.split('T')[0],\n        referenceNumber: '',\n        customerId: invoice.customerId || '',\n        customerName: invoice.customerName || '',\n        customerEmail: invoice.customerEmail || '',\n        invoices: [{\n          invoiceId: invoice.id,\n          invoiceNumber: invoice.invoiceNumber,\n          invoiceDate: invoice.date,\n          invoiceAmount: invoice.total,\n          refundAmount: refundAmount\n        }],\n        mode: req.body.mode || 'Cash',\n        depositTo: 'Petty Cash',\n        amount: -refundAmount,\n        unusedAmount: 0,\n        bankCharges: 0,\n        tax: '',\n        taxAmount: 0,\n        notes: req.body.reason || `Refund for ${invoice.invoiceNumber}`,\n        attachments: [],\n        sendThankYou: false,\n        status: 'REFUNDED',\n        paymentType: 'refund',\n        placeOfSupply: invoice.placeOfSupply || '',\n        descriptionOfSupply: '',\n        amountInWords: `Refund: ${numberToWords(refundAmount)}`,\n        journalEntries: [],\n        createdAt: now,\n        isRefund: true,\n        originalInvoiceId: invoice.id\n      };\n\n      paymentsData.paymentsReceived.push(refundPayment);\n      paymentsData.nextPaymentNumber++;\n      writePaymentsReceivedData(paymentsData);\n\n      res.json({ success: true, data: invoice, refundPayment });\n    } catch (error) {\n      res.status(500).json({ success: false, message: 'Failed to process refund' });\n    }\n  });\n\n  // Get unpaid invoices for a customer\n  app.get(\"/api/customers/:customerId/unpaid-invoices\", (req: Request, res: Response) => {\n    try {\n      const invoicesData = readInvoicesData();\n      const unpaidInvoices = invoicesData.invoices\n        .filter((inv: any) =>\n          inv.customerId === req.params.customerId &&\n          inv.status !== 'PAID' &&\n          (inv.balanceDue > 0 || 0)\n        )\n        .map((inv: any) => ({\n          id: inv.id,\n          invoiceNumber: inv.invoiceNumber,\n          date: inv.date,\n          amount: inv.total || inv.amount || 0,\n          balanceDue: inv.balanceDue || inv.total || 0,\n          status: inv.status\n        }));\n\n      res.json({ success: true, data: unpaidInvoices });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch unpaid invoices\" });\n    }\n  });\n\n  // E-Way Bills Routes\n  app.get(\"/api/eway-bills\", (req: Request, res: Response) => {\n    try {\n      const data = readEWayBillsData();\n      const { transactionType, status, period } = req.query;\n\n      let filteredBills = data.ewayBills || [];\n\n      if (transactionType && transactionType !== 'all') {\n        filteredBills = filteredBills.filter((bill: any) => bill.documentType === transactionType);\n      }\n\n      if (status && status !== 'all') {\n        filteredBills = filteredBills.filter((bill: any) => bill.status === status);\n      }\n\n      if (period && period !== 'all') {\n        const now = new Date();\n        let startDate = new Date();\n\n        switch (period) {\n          case 'this_month':\n            startDate = new Date(now.getFullYear(), now.getMonth(), 1);\n            break;\n          case 'last_month':\n            startDate = new Date(now.getFullYear(), now.getMonth() - 1, 1);\n            break;\n          case 'this_year':\n            startDate = new Date(now.getFullYear(), 0, 1);\n            break;\n        }\n\n        filteredBills = filteredBills.filter((bill: any) =>\n          new Date(bill.date) >= startDate\n        );\n      }\n\n      res.json({ success: true, data: filteredBills });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch e-way bills\" });\n    }\n  });\n\n  app.get(\"/api/eway-bills/next-number\", (_req: Request, res: Response) => {\n    try {\n      const data = readEWayBillsData();\n      const nextNumber = generateEWayBillNumber(data.nextEWayBillNumber);\n      res.json({ success: true, data: { nextNumber } });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to get next e-way bill number\" });\n    }\n  });\n\n  app.get(\"/api/eway-bills/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readEWayBillsData();\n      const ewayBill = data.ewayBills.find((b: any) => b.id === req.params.id);\n\n      if (!ewayBill) {\n        return res.status(404).json({ success: false, message: \"E-Way Bill not found\" });\n      }\n\n      res.json({ success: true, data: ewayBill });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch e-way bill\" });\n    }\n  });\n\n  app.post(\"/api/eway-bills\", (req: Request, res: Response) => {\n    try {\n      const data = readEWayBillsData();\n      const now = new Date().toISOString();\n      const ewayBillNumber = generateEWayBillNumber(data.nextEWayBillNumber);\n\n      // Calculate expiry date (15 days from now for most cases)\n      const expiryDate = new Date();\n      expiryDate.setDate(expiryDate.getDate() + 15);\n\n      const newEWayBill = {\n        id: `ewb-${Date.now()}`,\n        ewayBillNumber,\n        documentType: req.body.documentType || 'invoices',\n        transactionSubType: req.body.transactionSubType || 'supply',\n        customerId: req.body.customerId,\n        customerName: req.body.customerName,\n        customerGstin: req.body.customerGstin || '',\n        documentNumber: req.body.documentNumber,\n        documentId: req.body.documentId,\n        date: req.body.date || now.split('T')[0],\n        expiryDate: expiryDate.toISOString().split('T')[0],\n        transactionType: req.body.transactionType || 'regular',\n        dispatchFrom: req.body.dispatchFrom || {},\n        billFrom: req.body.billFrom || {},\n        billTo: req.body.billTo || {},\n        shipTo: req.body.shipTo || {},\n        placeOfDelivery: req.body.placeOfDelivery || '',\n        transporter: req.body.transporter || '',\n        distance: req.body.distance || 0,\n        modeOfTransportation: req.body.modeOfTransportation || 'road',\n        vehicleType: req.body.vehicleType || 'regular',\n        vehicleNo: req.body.vehicleNo || '',\n        transporterDocNo: req.body.transporterDocNo || '',\n        transporterDocDate: req.body.transporterDocDate || '',\n        items: req.body.items || [],\n        total: req.body.total || 0,\n        status: req.body.status || 'NOT_GENERATED',\n        createdAt: now,\n        updatedAt: now\n      };\n\n      data.ewayBills.push(newEWayBill);\n      data.nextEWayBillNumber++;\n      writeEWayBillsData(data);\n\n      res.json({ success: true, data: newEWayBill });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to create e-way bill\" });\n    }\n  });\n\n  app.put(\"/api/eway-bills/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readEWayBillsData();\n      const index = data.ewayBills.findIndex((b: any) => b.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"E-Way Bill not found\" });\n      }\n\n      const updatedEWayBill = {\n        ...data.ewayBills[index],\n        ...req.body,\n        updatedAt: new Date().toISOString()\n      };\n\n      data.ewayBills[index] = updatedEWayBill;\n      writeEWayBillsData(data);\n\n      res.json({ success: true, data: updatedEWayBill });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to update e-way bill\" });\n    }\n  });\n\n  app.patch(\"/api/eway-bills/:id/generate\", (req: Request, res: Response) => {\n    try {\n      const data = readEWayBillsData();\n      const index = data.ewayBills.findIndex((b: any) => b.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"E-Way Bill not found\" });\n      }\n\n      const ewayBill = data.ewayBills[index];\n      ewayBill.status = 'GENERATED';\n      ewayBill.generatedAt = new Date().toISOString();\n\n      // Set expiry date to 15 days from now\n      const expiryDate = new Date();\n      expiryDate.setDate(expiryDate.getDate() + 15);\n      ewayBill.expiryDate = expiryDate.toISOString().split('T')[0];\n\n      data.ewayBills[index] = ewayBill;\n      writeEWayBillsData(data);\n\n      res.json({ success: true, data: ewayBill });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to generate e-way bill\" });\n    }\n  });\n\n  app.patch(\"/api/eway-bills/:id/cancel\", (req: Request, res: Response) => {\n    try {\n      const data = readEWayBillsData();\n      const index = data.ewayBills.findIndex((b: any) => b.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"E-Way Bill not found\" });\n      }\n\n      const ewayBill = data.ewayBills[index];\n      ewayBill.status = 'CANCELLED';\n      ewayBill.cancelledAt = new Date().toISOString();\n      ewayBill.cancelReason = req.body.reason || '';\n\n      data.ewayBills[index] = ewayBill;\n      writeEWayBillsData(data);\n\n      res.json({ success: true, data: ewayBill });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to cancel e-way bill\" });\n    }\n  });\n\n  app.delete(\"/api/eway-bills/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readEWayBillsData();\n      const index = data.ewayBills.findIndex((b: any) => b.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"E-Way Bill not found\" });\n      }\n\n      data.ewayBills.splice(index, 1);\n      writeEWayBillsData(data);\n\n      res.json({ success: true, message: \"E-Way Bill deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to delete e-way bill\" });\n    }\n  });\n\n  // Get pending invoices for e-way bill generation\n  app.get(\"/api/eway-bills/pending-invoices\", (_req: Request, res: Response) => {\n    try {\n      const invoicesData = readInvoicesData();\n      const ewayBillsData = readEWayBillsData();\n\n      // Get invoice IDs that already have e-way bills\n      const invoicesWithEWayBills = new Set(\n        ewayBillsData.ewayBills\n          .filter((b: any) => b.documentType === 'invoices')\n          .map((b: any) => b.documentId)\n      );\n\n      // Filter invoices that don't have e-way bills yet\n      const pendingInvoices = invoicesData.invoices.filter((inv: any) =>\n        !invoicesWithEWayBills.has(inv.id) &&\n        inv.status !== 'DRAFT' &&\n        inv.status !== 'CANCELLED'\n      );\n\n      res.json({ success: true, data: pendingInvoices });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch pending invoices\" });\n    }\n  });\n\n  // Get pending credit notes for e-way bill generation\n  app.get(\"/api/eway-bills/pending-credit-notes\", (_req: Request, res: Response) => {\n    try {\n      const creditNotesData = readCreditNotesData();\n      const ewayBillsData = readEWayBillsData();\n\n      // Get credit note IDs that already have e-way bills\n      const creditNotesWithEWayBills = new Set(\n        ewayBillsData.ewayBills\n          .filter((b: any) => b.documentType === 'credit_notes')\n          .map((b: any) => b.documentId)\n      );\n\n      // Filter credit notes that don't have e-way bills yet\n      const pendingCreditNotes = creditNotesData.creditNotes.filter((cn: any) =>\n        !creditNotesWithEWayBills.has(cn.id) &&\n        cn.status !== 'DRAFT' &&\n        cn.status !== 'CANCELLED'\n      );\n\n      res.json({ success: true, data: pendingCreditNotes });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch pending credit notes\" });\n    }\n  });\n\n  // Get pending delivery challans for e-way bill generation\n  app.get(\"/api/eway-bills/pending-delivery-challans\", (_req: Request, res: Response) => {\n    try {\n      const deliveryChallansData = readDeliveryChallansData();\n      const ewayBillsData = readEWayBillsData();\n\n      // Get delivery challan IDs that already have e-way bills\n      const challansWithEWayBills = new Set(\n        ewayBillsData.ewayBills\n          .filter((b: any) => b.documentType === 'delivery_challans')\n          .map((b: any) => b.documentId)\n      );\n\n      // Filter delivery challans that don't have e-way bills yet\n      const pendingChallans = deliveryChallansData.deliveryChallans.filter((dc: any) =>\n        !challansWithEWayBills.has(dc.id) &&\n        dc.status !== 'DRAFT' &&\n        dc.status !== 'CANCELLED'\n      );\n\n      res.json({ success: true, data: pendingChallans });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch pending delivery challans\" });\n    }\n  });\n\n  // ========== PAYMENTS MADE API ==========\n  const PAYMENTS_MADE_FILE = path.join(DATA_DIR, \"paymentsMade.json\");\n\n  function readPaymentsMadeData() {\n    ensureDataDir();\n    if (!fs.existsSync(PAYMENTS_MADE_FILE)) {\n      const defaultData = { paymentsMade: [], nextPaymentNumber: 1 };\n      fs.writeFileSync(PAYMENTS_MADE_FILE, JSON.stringify(defaultData, null, 2));\n      return defaultData;\n    }\n    return JSON.parse(fs.readFileSync(PAYMENTS_MADE_FILE, \"utf-8\"));\n  }\n\n  function writePaymentsMadeData(data: any) {\n    ensureDataDir();\n    fs.writeFileSync(PAYMENTS_MADE_FILE, JSON.stringify(data, null, 2));\n  }\n\n  function generatePaymentMadeNumber(num: number): string {\n    return `PM-${String(num).padStart(5, '0')}`;\n  }\n\n  app.get(\"/api/payments-made\", (_req: Request, res: Response) => {\n    try {\n      const data = readPaymentsMadeData();\n      res.json({ success: true, data: data.paymentsMade || [] });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch payments made\" });\n    }\n  });\n\n  app.get(\"/api/payments-made/next-number\", (_req: Request, res: Response) => {\n    try {\n      const data = readPaymentsMadeData();\n      const nextNumber = generatePaymentMadeNumber(data.nextPaymentNumber);\n      res.json({ success: true, data: { nextNumber } });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to get next payment number\" });\n    }\n  });\n\n  app.get(\"/api/payments-made/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readPaymentsMadeData();\n      const payment = data.paymentsMade.find((p: any) => p.id === req.params.id);\n\n      if (!payment) {\n        return res.status(404).json({ success: false, message: \"Payment not found\" });\n      }\n\n      res.json({ success: true, data: payment });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch payment\" });\n    }\n  });\n\n  app.post(\"/api/payments-made\", (req: Request, res: Response) => {\n    try {\n      const data = readPaymentsMadeData();\n      const now = new Date().toISOString();\n\n      // Always generate payment number server-side to avoid corrupted data\n      const paymentNumber = generatePaymentMadeNumber(data.nextPaymentNumber);\n\n      // Handle both 'amount' and 'paymentAmount' field names\n      const paymentAmount = req.body.paymentAmount || req.body.amount || 0;\n\n      const newPayment = {\n        id: `pm-${Date.now()}`,\n        paymentNumber,\n        vendorId: req.body.vendorId,\n        vendorName: req.body.vendorName,\n        gstTreatment: req.body.gstTreatment || '',\n        sourceOfSupply: req.body.sourceOfSupply || '',\n        destinationOfSupply: req.body.destinationOfSupply || '',\n        descriptionOfSupply: req.body.descriptionOfSupply || '',\n        paymentAmount: paymentAmount,\n        reverseCharge: req.body.reverseCharge || false,\n        tds: req.body.tds || '',\n        paymentDate: req.body.paymentDate || now.split('T')[0],\n        paymentMode: req.body.paymentMode || 'Cash',\n        paidThrough: req.body.paidThrough || 'Petty Cash',\n        depositTo: req.body.depositTo || 'prepaid_expenses',\n        reference: req.body.reference || '',\n        notes: req.body.notes || '',\n        billPayments: req.body.billPayments || {},\n        paymentType: req.body.paymentType || 'bill_payment',\n        status: req.body.status || 'PAID',\n        createdAt: now,\n        updatedAt: now\n      };\n\n      data.paymentsMade.push(newPayment);\n      data.nextPaymentNumber++;\n      writePaymentsMadeData(data);\n\n      res.json({ success: true, data: newPayment });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to create payment\" });\n    }\n  });\n\n  app.put(\"/api/payments-made/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readPaymentsMadeData();\n      const index = data.paymentsMade.findIndex((p: any) => p.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Payment not found\" });\n      }\n\n      const updatedPayment = {\n        ...data.paymentsMade[index],\n        ...req.body,\n        updatedAt: new Date().toISOString()\n      };\n\n      data.paymentsMade[index] = updatedPayment;\n      writePaymentsMadeData(data);\n\n      res.json({ success: true, data: updatedPayment });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to update payment\" });\n    }\n  });\n\n  app.delete(\"/api/payments-made/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readPaymentsMadeData();\n      const index = data.paymentsMade.findIndex((p: any) => p.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Payment not found\" });\n      }\n\n      data.paymentsMade.splice(index, 1);\n      writePaymentsMadeData(data);\n\n      res.json({ success: true, message: \"Payment deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to delete payment\" });\n    }\n  });\n\n  // ========== VENDOR CREDITS API ==========\n  const VENDOR_CREDITS_FILE = path.join(DATA_DIR, \"vendorCredits.json\");\n\n  function readVendorCreditsData() {\n    ensureDataDir();\n    if (!fs.existsSync(VENDOR_CREDITS_FILE)) {\n      const defaultData = { vendorCredits: [], nextCreditNumber: 1 };\n      fs.writeFileSync(VENDOR_CREDITS_FILE, JSON.stringify(defaultData, null, 2));\n      return defaultData;\n    }\n    return JSON.parse(fs.readFileSync(VENDOR_CREDITS_FILE, \"utf-8\"));\n  }\n\n  function writeVendorCreditsData(data: any) {\n    ensureDataDir();\n    fs.writeFileSync(VENDOR_CREDITS_FILE, JSON.stringify(data, null, 2));\n  }\n\n  function generateVendorCreditNumber(num: number): string {\n    return `VC-${String(num).padStart(5, '0')}`;\n  }\n\n  app.get(\"/api/vendor-credits\", (_req: Request, res: Response) => {\n    try {\n      const data = readVendorCreditsData();\n      res.json({ success: true, data: data.vendorCredits || [] });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch vendor credits\" });\n    }\n  });\n\n  app.get(\"/api/vendor-credits/next-number\", (_req: Request, res: Response) => {\n    try {\n      const data = readVendorCreditsData();\n      const nextNumber = generateVendorCreditNumber(data.nextCreditNumber);\n      res.json({ success: true, data: { nextNumber } });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to get next credit number\" });\n    }\n  });\n\n  app.get(\"/api/vendor-credits/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readVendorCreditsData();\n      const credit = data.vendorCredits.find((c: any) => c.id === req.params.id);\n\n      if (!credit) {\n        return res.status(404).json({ success: false, message: \"Vendor credit not found\" });\n      }\n\n      res.json({ success: true, data: credit });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to fetch vendor credit\" });\n    }\n  });\n\n  app.post(\"/api/vendor-credits\", (req: Request, res: Response) => {\n    try {\n      const data = readVendorCreditsData();\n      const now = new Date().toISOString();\n      const creditNumber = req.body.creditNoteNumber || generateVendorCreditNumber(data.nextCreditNumber);\n\n      const newCredit = {\n        id: `vc-${Date.now()}`,\n        creditNumber,\n        referenceNumber: req.body.orderNumber || req.body.referenceNumber || '',\n        vendorId: req.body.vendorId,\n        vendorName: req.body.vendorName,\n        orderNumber: req.body.orderNumber || '',\n        date: req.body.vendorCreditDate || now.split('T')[0],\n        subject: req.body.subject || '',\n        reverseCharge: req.body.reverseCharge || false,\n        taxType: req.body.taxType || 'tds',\n        tdsTcs: req.body.tdsTcs || '',\n        items: (req.body.items || []).map((item: any) => ({\n          ...item,\n          hsnSac: item.hsnSac || '',\n          rate: item.rate?.toString() || '0',\n        })),\n        subTotal: req.body.subTotal || 0,\n        discountType: req.body.discountType || 'percentage',\n        discountValue: req.body.discountValue || '',\n        discountAmount: req.body.discountAmount || 0,\n        cgst: req.body.cgst || 0,\n        sgst: req.body.sgst || 0,\n        igst: req.body.igst || 0,\n        tdsTcsAmount: req.body.tdsTcsAmount || 0,\n        adjustment: req.body.adjustment || 0,\n        amount: req.body.total || 0,\n        balance: req.body.total || 0,\n        notes: req.body.notes || '',\n        status: req.body.status || 'OPEN',\n        createdAt: now,\n        updatedAt: now\n      };\n\n      data.vendorCredits.push(newCredit);\n      data.nextCreditNumber++;\n      writeVendorCreditsData(data);\n\n      res.json({ success: true, data: newCredit });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to create vendor credit\" });\n    }\n  });\n\n  app.put(\"/api/vendor-credits/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readVendorCreditsData();\n      const index = data.vendorCredits.findIndex((c: any) => c.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Vendor credit not found\" });\n      }\n\n      const updatedCredit = {\n        ...data.vendorCredits[index],\n        ...req.body,\n        updatedAt: new Date().toISOString()\n      };\n\n      data.vendorCredits[index] = updatedCredit;\n      writeVendorCreditsData(data);\n\n      res.json({ success: true, data: updatedCredit });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to update vendor credit\" });\n    }\n  });\n\n  app.delete(\"/api/vendor-credits/:id\", (req: Request, res: Response) => {\n    try {\n      const data = readVendorCreditsData();\n      const index = data.vendorCredits.findIndex((c: any) => c.id === req.params.id);\n\n      if (index === -1) {\n        return res.status(404).json({ success: false, message: \"Vendor credit not found\" });\n      }\n\n      data.vendorCredits.splice(index, 1);\n      writeVendorCreditsData(data);\n\n      res.json({ success: true, message: \"Vendor credit deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ success: false, message: \"Failed to delete vendor credit\" });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":173890,"size_tokens":null},"client/src/shared/hooks/useDebounce.ts":{"content":"import { useState, useEffect } from 'react';\n\nexport function useDebounce<T>(value: T, delay: number = 500): T {\n  const [debouncedValue, setDebouncedValue] = useState<T>(value);\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setDebouncedValue(value);\n    }, delay);\n\n    return () => {\n      clearTimeout(timer);\n    };\n  }, [value, delay]);\n\n  return debouncedValue;\n}\n\nexport default useDebounce;\n","path":null,"size_bytes":417,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"import * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1237,"size_tokens":null},"client/src/components/layout/AppShell.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport {\n  Home,\n  Package,\n  ShoppingCart,\n  ShoppingBag,\n  Clock,\n  Building2,\n  FileCheck,\n  UserCog,\n  BarChart3,\n  FolderOpen,\n  ChevronRight,\n  Menu,\n  Settings as SettingsIcon,\n  CreditCard,\n  Star,\n  PanelLeftClose,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Sheet, SheetContent } from \"@/components/ui/sheet\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { useState } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\nexport default function AppShell({ children }: { children: React.ReactNode }) {\n  const [location] = useLocation();\n  const [isMobileOpen, setIsMobileOpen] = useState(false);\n  const [openMenu, setOpenMenu] = useState<string | null>(null);\n\n  const NavItem = ({\n    href,\n    icon: Icon,\n    label,\n    active,\n    indent = false\n  }: {\n    href: string;\n    icon?: any;\n    label: string;\n    active?: boolean;\n    indent?: boolean;\n  }) => {\n    const isActive = active || location === href || location.startsWith(href + \"/\");\n    return (\n      <Link href={href}>\n        <Button\n          variant=\"ghost\"\n          className={cn(\n            \"w-full justify-start gap-3 font-medium transition-all duration-200 h-10\",\n            indent ? \"pl-12\" : \"px-4\",\n            isActive\n              ? \"bg-indigo-50 text-indigo-700 font-semibold\"\n              : \"text-slate-600 hover:text-slate-900 hover:bg-slate-50\"\n          )}\n        >\n          {Icon && (\n            <Icon className={cn(\n              \"h-4 w-4\",\n              isActive ? \"text-indigo-600\" : \"text-slate-400\"\n            )} />\n          )}\n          {label}\n        </Button>\n      </Link>\n    );\n  };\n\n  const CollapsibleNavItem = ({\n    id,\n    icon: Icon,\n    label,\n    children\n  }: {\n    id: string;\n    icon: any;\n    label: string;\n    children: React.ReactNode;\n  }) => {\n    const isOpen = openMenu === id;\n\n    return (\n      <Collapsible open={isOpen} onOpenChange={(open) => setOpenMenu(open ? id : null)}>\n        <CollapsibleTrigger asChild>\n          <Button\n            variant=\"ghost\"\n            className={cn(\n              \"w-full justify-start gap-3 font-medium transition-all duration-200 px-4 h-10\",\n              isOpen\n                ? \"bg-indigo-50 text-indigo-700\"\n                : \"text-slate-600 hover:text-slate-900 hover:bg-slate-50\"\n            )}\n          >\n            <ChevronRight className={cn(\n              \"h-3 w-3 text-slate-400 transition-transform duration-200\",\n              isOpen && \"rotate-90\"\n            )} />\n            <Icon className={cn(\"h-4 w-4\", isOpen ? \"text-indigo-600\" : \"text-slate-400\")} />\n            {label}\n          </Button>\n        </CollapsibleTrigger>\n        <CollapsibleContent className=\"space-y-0.5 mt-0.5\">\n          {children}\n        </CollapsibleContent>\n      </Collapsible>\n    );\n  };\n\n  const SidebarContent = () => (\n    <div className=\"flex flex-col h-full bg-white border-r border-slate-200\">\n      <div className=\"p-4 flex items-center gap-3 border-b border-slate-100\">\n        <div className=\"h-9 w-9 rounded-lg bg-indigo-600 flex items-center justify-center overflow-hidden shadow-md ring-2 ring-indigo-100\">\n          <span className=\"font-display font-bold text-white text-xl\">B</span>\n        </div>\n        <div>\n          <h1 className=\"font-display font-bold text-lg leading-tight tracking-tight text-slate-900\">Billing</h1>\n          <p className=\"text-[10px] uppercase tracking-wider text-slate-500 font-semibold\">Accounting</p>\n        </div>\n      </div>\n\n      <ScrollArea className=\"flex-1 py-3\">\n        <div className=\"px-2 space-y-0.5\">\n          <NavItem href=\"/\" icon={Home} label=\"Home\" />\n\n          <CollapsibleNavItem id=\"items\" icon={Package} label=\"Items\">\n            <NavItem href=\"/items\" label=\"Items\" indent />\n          </CollapsibleNavItem>\n\n          <CollapsibleNavItem id=\"sales\" icon={ShoppingCart} label=\"Sales\">\n            <NavItem href=\"/customers\" label=\"Customers\" indent />\n            <NavItem href=\"/estimates\" label=\"Quotes\" indent />\n            <NavItem href=\"/sales-orders\" label=\"Sales Orders\" indent />\n            <NavItem href=\"/invoices\" label=\"Invoices\" indent />\n            <NavItem href=\"/delivery-challans\" label=\"Delivery Challans\" indent />\n            <NavItem href=\"/payments-received\" label=\"Payments Received\" indent />\n            <NavItem href=\"/credit-notes\" label=\"Credit Notes\" indent />\n            <NavItem href=\"/eway-bills\" label=\"e-Way Bills\" indent />\n          </CollapsibleNavItem>\n\n          <CollapsibleNavItem id=\"purchases\" icon={ShoppingBag} label=\"Purchases\">\n            <NavItem href=\"/vendors\" label=\"Vendors\" indent />\n            <NavItem href=\"/expenses\" label=\"Expenses\" indent />\n            <NavItem href=\"/purchase-orders\" label=\"Purchase Orders\" indent />\n            <NavItem href=\"/bills\" label=\"Bills\" indent />\n            <NavItem href=\"/payments-made\" label=\"Payments Made\" indent />\n            <NavItem href=\"/vendor-credits\" label=\"Vendor Credits\" indent />\n          </CollapsibleNavItem>\n\n          <NavItem href=\"/time-tracking\" icon={Clock} label=\"Time Tracking (TBD)\" />\n\n          <NavItem href=\"/banking\" icon={Building2} label=\"Banking (TBD)\" />\n\n          <CollapsibleNavItem id=\"filing\" icon={FileCheck} label=\"Filing & Compliance (TBD)\">\n            <NavItem href=\"/filing-compliance\" label=\"GST Filing\" indent />\n          </CollapsibleNavItem>\n\n          <CollapsibleNavItem id=\"accountant\" icon={UserCog} label=\"Accountant (TBD)\">\n            <NavItem href=\"/manual-journals\" label=\"Manual Journals\" indent />\n            <NavItem href=\"/bulk-update\" label=\"Bulk Update\" indent />\n            <NavItem href=\"/chart-of-accounts\" label=\"Chart of Accounts\" indent />\n            <NavItem href=\"/transaction-locking\" label=\"Transaction Locking\" indent />\n          </CollapsibleNavItem>\n\n          <NavItem href=\"/reports\" icon={BarChart3} label=\"Reports\" />\n\n          <NavItem href=\"/documents\" icon={FolderOpen} label=\"Documents (TBD)\" />\n        </div>\n      </ScrollArea>\n\n      <div className=\"p-3 border-t border-slate-100 bg-slate-50/50\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3 p-2 rounded-lg hover:bg-white hover:shadow-sm transition-all cursor-pointer border border-transparent hover:border-slate-200 flex-1\">\n            <Avatar className=\"h-8 w-8 border border-slate-200\">\n              <AvatarImage src=\"https://github.com/shadcn.png\" />\n              <AvatarFallback className=\"bg-indigo-100 text-indigo-700\">AD</AvatarFallback>\n            </Avatar>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-sm font-medium text-slate-900 truncate\">Admin User</p>\n              <p className=\"text-xs text-slate-500 truncate\">admin@Billing.com</p>\n            </div>\n            <SettingsIcon className=\"h-4 w-4 text-slate-400\" />\n          </div>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-slate-400 hover:text-slate-600\">\n            <PanelLeftClose className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\"min-h-screen bg-slate-50/50 flex font-sans text-slate-900\">\n      {/* Desktop Sidebar */}\n      <aside className=\"hidden md:block w-64 fixed inset-y-0 z-30 bg-white\">\n        <SidebarContent />\n      </aside>\n\n      {/* Mobile Sidebar */}\n      <Sheet open={isMobileOpen} onOpenChange={setIsMobileOpen}>\n        <SheetContent side=\"left\" className=\"p-0 w-72\">\n          <SidebarContent />\n        </SheetContent>\n      </Sheet>\n\n      <main className=\"flex-1 md:ml-64 min-h-screen flex flex-col transition-all duration-300 ease-in-out\">\n        {/* Mobile Menu Toggle */}\n        <div className=\"md:hidden sticky top-0 z-20 bg-white border-b border-slate-200 px-4 py-3\">\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => setIsMobileOpen(true)} className=\"-ml-2\">\n            <Menu className=\"h-5 w-5 text-slate-600\" />\n          </Button>\n        </div>\n\n        <div className=\"flex-1 overflow-auto p-4 lg:p-6\">\n          {children}\n        </div>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":8374,"size_tokens":null},"client/src/modules/accounting/pages/AccountantPage.tsx":{"content":"export { default } from '@/pages/accountant';\n","path":null,"size_bytes":46,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport tailwindcss from \"@tailwindcss/vite\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\nimport { metaImagesPlugin } from \"./vite-plugin-meta-images\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    tailwindcss(),\n    metaImagesPlugin(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  css: {\n    postcss: {\n      plugins: [],\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    host: \"0.0.0.0\",\n    allowedHosts: true,\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1330,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/lib/store.tsx":{"content":"import { createContext, useContext, useState, ReactNode } from \"react\";\n\nexport interface Invoice {\n  id: string;\n  invoiceNumber: string;\n  customerName: string;\n  date: string;\n  dueDate: string;\n  amount: number;\n  status: \"paid\" | \"pending\" | \"overdue\" | \"draft\";\n  salespersonId?: string;\n  terms?: string;\n  billingAddress?: string;\n}\n\nexport interface ContactPerson {\n  id: string;\n  customerId: string;\n  salutation?: string;\n  firstName: string;\n  lastName: string;\n  email?: string;\n  workPhone?: string;\n  mobile?: string;\n}\n\nexport interface Address {\n  street: string;\n  city: string;\n  state: string;\n  country: string;\n  pincode: string;\n}\n\nexport interface CustomerComment {\n  id: string;\n  text: string;\n  createdAt: string;\n  createdBy: string;\n}\n\nexport interface Customer {\n  id: string;\n  displayName: string;\n  companyName: string;\n  email: string;\n  workPhone: string;\n  mobile?: string;\n  gstTreatment: string;\n  receivables: string;\n  avatar: string;\n  gstin?: string;\n  pan?: string;\n  customerType?: \"business\" | \"individual\";\n  status?: \"active\" | \"inactive\";\n  billingAddress?: Address;\n  shippingAddress?: Address;\n  currency?: string;\n  paymentTerms?: string;\n  placeOfSupply?: string;\n  taxPreference?: \"taxable\" | \"tax_exempt\";\n  portalStatus?: \"enabled\" | \"disabled\";\n  source?: string;\n  comments?: CustomerComment[];\n  createdAt?: string;\n}\n\ninterface AppState {\n  invoices: Invoice[];\n  customers: Customer[];\n  contactPersons: ContactPerson[];\n  pendingCustomerId: string | null;\n  setPendingCustomerId: (id: string | null) => void;\n  addInvoice: (invoice: Omit<Invoice, \"id\">) => void;\n  addCustomer: (customer: Omit<Customer, \"id\">) => Customer;\n  deleteInvoice: (id: string) => void;\n  deleteCustomer: (id: string) => void;\n  updateInvoice: (id: string, updates: Partial<Invoice>) => void;\n  updateCustomer: (id: string, updates: Partial<Customer>) => void;\n  cloneCustomer: (id: string) => Customer | null;\n  toggleCustomerStatus: (id: string) => void;\n  addCustomerComment: (customerId: string, text: string) => void;\n  getCustomerById: (id: string) => Customer | undefined;\n  addContactPerson: (person: Omit<ContactPerson, \"id\">) => ContactPerson;\n  getContactPersonsByCustomer: (customerId: string) => ContactPerson[];\n  getAllSalespersons: () => ContactPerson[];\n}\n\nconst initialInvoices: Invoice[] = [\n  {\n    id: \"1\",\n    invoiceNumber: \"INV-00012\",\n    customerName: \"Acme Corp Inc.\",\n    date: \"04/12/2025\",\n    dueDate: \"03/01/2026\",\n    amount: 1699.20,\n    status: \"pending\",\n  },\n  {\n    id: \"2\",\n    invoiceNumber: \"INV-00011\",\n    customerName: \"Globex Corporation\",\n    date: \"01/12/2025\",\n    dueDate: \"31/12/2025\",\n    amount: 2450.00,\n    status: \"paid\",\n  },\n  {\n    id: \"3\",\n    invoiceNumber: \"INV-00010\",\n    customerName: \"Soylent Corp\",\n    date: \"28/11/2025\",\n    dueDate: \"28/12/2025\",\n    amount: 3200.50,\n    status: \"overdue\",\n  },\n  {\n    id: \"4\",\n    invoiceNumber: \"INV-00009\",\n    customerName: \"Initech LLC\",\n    date: \"25/11/2025\",\n    dueDate: \"25/12/2025\",\n    amount: 1850.00,\n    status: \"draft\",\n  },\n];\n\nconst initialCustomers: Customer[] = [\n  {\n    id: \"1\",\n    displayName: \"A SQUARE ARCHITECTS\",\n    companyName: \"A SQUARE ARCHITECTS\",\n    email: \"sushantbhosale238@gmail.com\",\n    workPhone: \"\",\n    gstTreatment: \"Registered Business - Regular\",\n    receivables: \"0.00\",\n    avatar: \"AS\",\n    customerType: \"business\",\n    status: \"active\",\n    billingAddress: { street: \"Pune\", city: \"Pune\", state: \"Maharashtra\", country: \"India\", pincode: \"411057\" },\n    shippingAddress: { street: \"Pune\", city: \"Pune\", state: \"Maharashtra\", country: \"India\", pincode: \"411057\" },\n    currency: \"INR\",\n    paymentTerms: \"Due on Receipt\",\n    placeOfSupply: \"Maharashtra\",\n    taxPreference: \"taxable\",\n    portalStatus: \"disabled\",\n    source: \"CSV\",\n    comments: [],\n    createdAt: \"2024-01-01T00:00:00.000Z\",\n  },\n  {\n    id: \"2\",\n    displayName: \"AABHA CONTRACEPTIVES PRIVATE LIMITED\",\n    companyName: \"AABHA CONTRACEPTIVES PRIVATE LIMITED\",\n    email: \"aabhacontraceptives@gmail.com\",\n    workPhone: \"\",\n    gstTreatment: \"Registered Business - Regular\",\n    receivables: \"0.00\",\n    avatar: \"AC\",\n    gstin: \"27AAGCA4900Q1ZE\",\n    pan: \"AAGCA4900Q\",\n    customerType: \"business\",\n    status: \"active\",\n    billingAddress: { street: \"Plot No G- 2 Katfal Baramati, Maharashtra Industrial Development Corporation Area, Baramati\", city: \"Pune\", state: \"Maharashtra 413133\", country: \"India\", pincode: \"413133\" },\n    shippingAddress: { street: \"Plot No G- 2 Katfal Baramati, Maharashtra Industrial Development Corporation Area, Baramati\", city: \"Pune\", state: \"Maharashtra 413133\", country: \"India\", pincode: \"413133\" },\n    currency: \"INR\",\n    paymentTerms: \"Due on Receipt\",\n    placeOfSupply: \"Maharashtra\",\n    taxPreference: \"taxable\",\n    portalStatus: \"disabled\",\n    source: \"CSV\",\n    comments: [],\n    createdAt: \"2024-01-01T00:00:00.000Z\",\n  },\n  {\n    id: \"3\",\n    displayName: \"Abhijit Patil\",\n    companyName: \"\",\n    email: \"\",\n    workPhone: \"\",\n    gstTreatment: \"Consumer\",\n    receivables: \"0.00\",\n    avatar: \"AP\",\n    customerType: \"individual\",\n    status: \"active\",\n    currency: \"INR\",\n    paymentTerms: \"Due on Receipt\",\n    comments: [],\n    createdAt: \"2024-01-01T00:00:00.000Z\",\n  },\n  {\n    id: \"4\",\n    displayName: \"ABN INTERARCH PRIVATE LIMITED\",\n    companyName: \"ABN INTERARCH PRIVATE LIMITED\",\n    email: \"admin@abninterarch.in\",\n    workPhone: \"\",\n    gstTreatment: \"Registered Business - Regular\",\n    receivables: \"0.00\",\n    avatar: \"AI\",\n    customerType: \"business\",\n    status: \"active\",\n    currency: \"INR\",\n    paymentTerms: \"Due on Receipt\",\n    placeOfSupply: \"Maharashtra\",\n    taxPreference: \"taxable\",\n    portalStatus: \"disabled\",\n    source: \"CSV\",\n    comments: [],\n    createdAt: \"2024-01-01T00:00:00.000Z\",\n  },\n  {\n    id: \"5\",\n    displayName: \"Abyssal TechEdge\",\n    companyName: \"Abyssal TechEdge\",\n    email: \"sksachin78@gmail.com\",\n    workPhone: \"\",\n    gstTreatment: \"Unregistered Business\",\n    receivables: \"0.00\",\n    avatar: \"AT\",\n    customerType: \"business\",\n    status: \"active\",\n    currency: \"INR\",\n    paymentTerms: \"Due on Receipt\",\n    comments: [],\n    createdAt: \"2024-01-01T00:00:00.000Z\",\n  },\n  {\n    id: \"6\",\n    displayName: \"Acumen Engineers\",\n    companyName: \"Acumen Engineers\",\n    email: \"manoj@acumenengineers.in\",\n    workPhone: \"\",\n    gstTreatment: \"Unregistered Business\",\n    receivables: \"0.00\",\n    avatar: \"AE\",\n    customerType: \"business\",\n    status: \"active\",\n    currency: \"INR\",\n    paymentTerms: \"Due on Receipt\",\n    comments: [],\n    createdAt: \"2024-01-01T00:00:00.000Z\",\n  },\n  {\n    id: \"7\",\n    displayName: \"Adore Art Interiors\",\n    companyName: \"Adore Art Interiors\",\n    email: \"saurabhpasricha@gmail.com\",\n    workPhone: \"99998 28462\",\n    gstTreatment: \"Unregistered Business\",\n    receivables: \"0.00\",\n    avatar: \"AA\",\n    customerType: \"business\",\n    status: \"active\",\n    currency: \"INR\",\n    paymentTerms: \"Due on Receipt\",\n    comments: [],\n    createdAt: \"2024-01-01T00:00:00.000Z\",\n  },\n  {\n    id: \"8\",\n    displayName: \"Akoya Motors Pvt Ltd\",\n    companyName: \"Akoya Motors Pvt Ltd\",\n    email: \"hr.mgr@akoyamotors.com\",\n    workPhone: \"8956212598\",\n    gstTreatment: \"Registered Business - Regular\",\n    receivables: \"0.00\",\n    avatar: \"AM\",\n    customerType: \"business\",\n    status: \"active\",\n    currency: \"INR\",\n    paymentTerms: \"Due on Receipt\",\n    placeOfSupply: \"Maharashtra\",\n    taxPreference: \"taxable\",\n    comments: [],\n    createdAt: \"2024-01-01T00:00:00.000Z\",\n  },\n];\n\nconst initialContactPersons: ContactPerson[] = [\n  {\n    id: \"cp1\",\n    customerId: \"1\",\n    salutation: \"Mr.\",\n    firstName: \"John\",\n    lastName: \"Smith\",\n    email: \"john.smith@acme.com\",\n    workPhone: \"+1 (555) 123-4568\",\n  },\n  {\n    id: \"cp2\",\n    customerId: \"1\",\n    salutation: \"Ms.\",\n    firstName: \"Sarah\",\n    lastName: \"Johnson\",\n    email: \"sarah.j@acme.com\",\n    workPhone: \"+1 (555) 123-4569\",\n  },\n  {\n    id: \"cp3\",\n    customerId: \"2\",\n    salutation: \"Mr.\",\n    firstName: \"Michael\",\n    lastName: \"Brown\",\n    email: \"m.brown@globex.com\",\n    workPhone: \"+1 (555) 987-6544\",\n  },\n  {\n    id: \"cp4\",\n    customerId: \"3\",\n    salutation: \"Mrs.\",\n    firstName: \"Emily\",\n    lastName: \"Davis\",\n    email: \"emily.d@soylent.com\",\n    workPhone: \"+1 (555) 456-7891\",\n  },\n  {\n    id: \"cp5\",\n    customerId: \"4\",\n    salutation: \"Mr.\",\n    firstName: \"Peter\",\n    lastName: \"Gibbons\",\n    email: \"peter@initech.com\",\n    workPhone: \"+1 (555) 111-2223\",\n  },\n];\n\nconst AppContext = createContext<AppState | undefined>(undefined);\n\nexport function AppProvider({ children }: { children: ReactNode }) {\n  const [invoices, setInvoices] = useState<Invoice[]>(initialInvoices);\n  const [customers, setCustomers] = useState<Customer[]>(initialCustomers);\n  const [contactPersons, setContactPersons] = useState<ContactPerson[]>(initialContactPersons);\n  const [pendingCustomerId, setPendingCustomerId] = useState<string | null>(null);\n\n  const addInvoice = (invoice: Omit<Invoice, \"id\">) => {\n    const newInvoice: Invoice = {\n      ...invoice,\n      id: String(Date.now()),\n    };\n    setInvoices((prev) => [newInvoice, ...prev]);\n  };\n\n  const addCustomer = (customer: Omit<Customer, \"id\">): Customer => {\n    const newCustomer: Customer = {\n      ...customer,\n      id: String(Date.now()),\n    };\n    setCustomers((prev) => [newCustomer, ...prev]);\n    return newCustomer;\n  };\n\n  const deleteInvoice = (id: string) => {\n    setInvoices((prev) => prev.filter((inv) => inv.id !== id));\n  };\n\n  const deleteCustomer = (id: string) => {\n    setCustomers((prev) => prev.filter((cust) => cust.id !== id));\n  };\n\n  const updateInvoice = (id: string, updates: Partial<Invoice>) => {\n    setInvoices((prev) =>\n      prev.map((inv) => (inv.id === id ? { ...inv, ...updates } : inv))\n    );\n  };\n\n  const updateCustomer = (id: string, updates: Partial<Customer>) => {\n    setCustomers((prev) =>\n      prev.map((cust) => (cust.id === id ? { ...cust, ...updates } : cust))\n    );\n  };\n\n  const cloneCustomer = (id: string): Customer | null => {\n    const customer = customers.find((c) => c.id === id);\n    if (!customer) return null;\n    const newCustomer: Customer = {\n      ...customer,\n      id: String(Date.now()),\n      displayName: `${customer.displayName} (Copy)`,\n      comments: [],\n      createdAt: new Date().toISOString(),\n    };\n    setCustomers((prev) => [newCustomer, ...prev]);\n    return newCustomer;\n  };\n\n  const toggleCustomerStatus = (id: string) => {\n    setCustomers((prev) =>\n      prev.map((cust) =>\n        cust.id === id\n          ? { ...cust, status: cust.status === \"active\" ? \"inactive\" : \"active\" }\n          : cust\n      )\n    );\n  };\n\n  const addCustomerComment = (customerId: string, text: string) => {\n    const newComment: CustomerComment = {\n      id: `comment_${Date.now()}`,\n      text,\n      createdAt: new Date().toISOString(),\n      createdBy: \"Admin User\",\n    };\n    setCustomers((prev) =>\n      prev.map((cust) =>\n        cust.id === customerId\n          ? { ...cust, comments: [...(cust.comments || []), newComment] }\n          : cust\n      )\n    );\n  };\n\n  const getCustomerById = (id: string): Customer | undefined => {\n    return customers.find((c) => c.id === id);\n  };\n\n  const addContactPerson = (person: Omit<ContactPerson, \"id\">): ContactPerson => {\n    const newPerson: ContactPerson = {\n      ...person,\n      id: `cp_${Date.now()}`,\n    };\n    setContactPersons((prev) => [...prev, newPerson]);\n    return newPerson;\n  };\n\n  const getContactPersonsByCustomer = (customerId: string): ContactPerson[] => {\n    return contactPersons.filter((cp) => cp.customerId === customerId);\n  };\n\n  const getAllSalespersons = (): ContactPerson[] => {\n    return contactPersons;\n  };\n\n  return (\n    <AppContext.Provider\n      value={{\n        invoices,\n        customers,\n        contactPersons,\n        pendingCustomerId,\n        setPendingCustomerId,\n        addInvoice,\n        addCustomer,\n        deleteInvoice,\n        deleteCustomer,\n        updateInvoice,\n        updateCustomer,\n        cloneCustomer,\n        toggleCustomerStatus,\n        addCustomerComment,\n        getCustomerById,\n        addContactPerson,\n        getContactPersonsByCustomer,\n        getAllSalespersons,\n      }}\n    >\n      {children}\n    </AppContext.Provider>\n  );\n}\n\nexport function useAppStore() {\n  const context = useContext(AppContext);\n  if (context === undefined) {\n    throw new Error(\"useAppStore must be used within an AppProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":12609,"size_tokens":null},"client/src/modules/dashboard/pages/index.ts":{"content":"export { default as DashboardPage } from './DashboardPage';\n","path":null,"size_bytes":60,"size_tokens":null},"server/src/modules/items/model/index.ts":{"content":"import { pgTable, text, numeric, boolean, timestamp, varchar } from 'drizzle-orm/pg-core';\nimport { createInsertSchema, createSelectSchema } from 'drizzle-zod';\n\nexport const items = pgTable('items', {\n  id: text('id').primaryKey(),\n  name: varchar('name', { length: 255 }).notNull(),\n  description: text('description'),\n  type: varchar('type', { length: 20 }).notNull().default('goods'),\n  sku: varchar('sku', { length: 50 }),\n  hsnSac: varchar('hsn_sac', { length: 20 }),\n  unit: varchar('unit', { length: 20 }),\n  sellingPrice: numeric('selling_price', { precision: 18, scale: 2 }).notNull().default('0'),\n  purchasePrice: numeric('purchase_price', { precision: 18, scale: 2 }).notNull().default('0'),\n  taxRate: numeric('tax_rate', { precision: 5, scale: 2 }),\n  isActive: boolean('is_active').notNull().default(true),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n});\n\nexport const insertItemSchema = createInsertSchema(items);\nexport const selectItemSchema = createSelectSchema(items);\n\nexport type Item = typeof items.$inferSelect;\nexport type NewItem = typeof items.$inferInsert;\n","path":null,"size_bytes":1164,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1598,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Plus,\n  ChevronDown,\n  TrendingUp,\n  TrendingDown,\n  CreditCard,\n  Folder,\n  Smartphone,\n  ExternalLink\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from \"@/components/ui/tabs\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  AreaChart,\n  Area,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  BarChart,\n  Bar,\n  Legend,\n  PieChart,\n  Pie,\n  Cell\n} from \"recharts\";\n\ninterface DashboardData {\n  summary: {\n    totalReceivables: { totalUnpaid: number; current: number; overdue: number };\n    totalPayables: { totalUnpaid: number; current: number; overdue: number };\n    cashOnHand: number;\n    bankBalance: number;\n    totalIncome: number;\n    totalExpenses: number;\n  };\n  cashFlow: Array<{ month: string; value: number; incoming: number; outgoing: number }>;\n  incomeExpense: Array<{ month: string; income: number; expense: number }>;\n  topExpenses: Array<{ category: string; amount: number; percentage: number }>;\n  projects: Array<{ id: string; name: string; client: string; progress: number; budget: number; spent: number }>;\n  bankAccounts: Array<{ id: string; name: string; balance: number; type: string }>;\n  accountWatchlist: Array<{ id: string; name: string; balance: number; change: number }>;\n}\n\nconst EXPENSE_COLORS = ['#4F46E5', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899', '#06B6D4', '#6B7280'];\n\nexport default function Dashboard() {\n  const [activeTab, setActiveTab] = useState(\"dashboard\");\n  const [incomeExpenseMode, setIncomeExpenseMode] = useState<\"accrual\" | \"cash\">(\"accrual\");\n  const [fiscalYear] = useState(\"This Fiscal Year\");\n\n  const { data: dashboardResponse, isLoading } = useQuery<{ success: boolean; data: DashboardData }>({\n    queryKey: ['/api/dashboard'],\n  });\n\n  const dashboard = dashboardResponse?.data;\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('en-IN', {\n      style: 'currency',\n      currency: 'INR',\n      minimumFractionDigits: 2\n    }).format(amount);\n  };\n\n  const totalIncoming = dashboard?.cashFlow?.reduce((sum, item) => sum + (item.incoming || 0), 0) || 0;\n  const totalOutgoing = dashboard?.cashFlow?.reduce((sum, item) => sum + (item.outgoing || 0), 0) || 0;\n  const totalIncome = dashboard?.incomeExpense?.reduce((sum, item) => sum + (item.income || 0), 0) || 0;\n  const totalExpenseAmount = dashboard?.incomeExpense?.reduce((sum, item) => sum + (item.expense || 0), 0) || 0;\n\n  if (isLoading) {\n    return (\n      <div className=\"max-w-7xl mx-auto flex items-center justify-center h-64\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-7xl mx-auto space-y-6 animate-in fade-in duration-500\">\n      <div className=\"flex items-center gap-4 mb-2\">\n        <div className=\"h-12 w-12 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center overflow-hidden\">\n          <span className=\"text-slate-500 dark:text-slate-300 text-lg font-medium\">AD</span>\n        </div>\n        <div>\n          <h1 className=\"text-xl font-semibold\" data-testid=\"text-greeting\">Hello, Admin</h1>\n          <p className=\"text-sm text-muted-foreground\" data-testid=\"text-company\">Billing Accounting</p>\n        </div>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n        <TabsList className=\"bg-transparent border-b w-full justify-start rounded-none h-auto p-0 gap-0\">\n          <TabsTrigger\n            value=\"dashboard\"\n            className=\"data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=active]:text-indigo-600 rounded-none px-4 py-3 font-medium text-muted-foreground data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n            data-testid=\"tab-dashboard\"\n          >\n            Dashboard\n          </TabsTrigger>\n          <TabsTrigger\n            value=\"getting-started\"\n            className=\"data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=active]:text-indigo-600 rounded-none px-4 py-3 font-medium text-muted-foreground data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n            data-testid=\"tab-getting-started\"\n          >\n            Getting Started\n          </TabsTrigger>\n          <TabsTrigger\n            value=\"recent-updates\"\n            className=\"data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=active]:text-indigo-600 rounded-none px-4 py-3 font-medium text-muted-foreground data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n            data-testid=\"tab-recent-updates\"\n          >\n            Recent Updates\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"dashboard\" className=\"mt-6 space-y-6\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-4 pb-2\">\n                <CardTitle className=\"text-lg font-semibold\">Total Receivables</CardTitle>\n                <Link href=\"/invoices/new\">\n                  <Button variant=\"ghost\" size=\"sm\" className=\"text-indigo-600 hover:text-indigo-700 hover:bg-indigo-50 dark:hover:bg-indigo-950 gap-1\">\n                    <Plus className=\"h-4 w-4\" /> New\n                  </Button>\n                </Link>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Total Unpaid Invoices <span className=\"font-medium\">{formatCurrency(dashboard?.summary?.totalReceivables?.totalUnpaid || 0)}</span>\n                  </p>\n                  <div className=\"w-full h-2 bg-muted rounded-full mt-2 overflow-hidden\">\n                    <div\n                      className=\"h-full bg-teal-500 rounded-full\"\n                      style={{\n                        width: `${((dashboard?.summary?.totalReceivables?.current || 0) / (dashboard?.summary?.totalReceivables?.totalUnpaid || 1)) * 100}%`\n                      }}\n                    />\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-2 gap-4 pt-2\">\n                  <div>\n                    <p className=\"text-xs font-medium text-teal-600 uppercase tracking-wide\">Current</p>\n                    <p className=\"text-xl font-semibold mt-1\" data-testid=\"value-receivables-current\">\n                      {formatCurrency(dashboard?.summary?.totalReceivables?.current || 0)}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-xs font-medium text-red-500 uppercase tracking-wide\">Overdue</p>\n                    <div className=\"flex items-center gap-1 mt-1\">\n                      <p className=\"text-xl font-semibold\" data-testid=\"value-receivables-overdue\">\n                        {formatCurrency(dashboard?.summary?.totalReceivables?.overdue || 0)}\n                      </p>\n                      <ChevronDown className=\"h-4 w-4 text-muted-foreground\" />\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-4 pb-2\">\n                <CardTitle className=\"text-lg font-semibold\">Total Payables</CardTitle>\n                <Link href=\"/bills\">\n                  <Button variant=\"ghost\" size=\"sm\" className=\"text-indigo-600 hover:text-indigo-700 hover:bg-indigo-50 dark:hover:bg-indigo-950 gap-1\">\n                    <Plus className=\"h-4 w-4\" /> New\n                  </Button>\n                </Link>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Total Unpaid Bills <span className=\"font-medium\">{formatCurrency(dashboard?.summary?.totalPayables?.totalUnpaid || 0)}</span>\n                  </p>\n                  <div className=\"w-full h-2 bg-muted rounded-full mt-2 overflow-hidden\">\n                    <div\n                      className=\"h-full bg-amber-500 rounded-full\"\n                      style={{\n                        width: `${((dashboard?.summary?.totalPayables?.current || 0) / (dashboard?.summary?.totalPayables?.totalUnpaid || 1)) * 100}%`\n                      }}\n                    />\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-2 gap-4 pt-2\">\n                  <div>\n                    <p className=\"text-xs font-medium text-teal-600 uppercase tracking-wide\">Current</p>\n                    <p className=\"text-xl font-semibold mt-1\" data-testid=\"value-payables-current\">\n                      {formatCurrency(dashboard?.summary?.totalPayables?.current || 0)}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-xs font-medium text-red-500 uppercase tracking-wide\">Overdue</p>\n                    <div className=\"flex items-center gap-1 mt-1\">\n                      <p className=\"text-xl font-semibold\" data-testid=\"value-payables-overdue\">\n                        {formatCurrency(dashboard?.summary?.totalPayables?.overdue || 0)}\n                      </p>\n                      <ChevronDown className=\"h-4 w-4 text-muted-foreground\" />\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-4\">\n              <CardTitle className=\"text-lg font-semibold\">Cash Flow</CardTitle>\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"ghost\" size=\"sm\" className=\"text-indigo-600 hover:text-indigo-700 hover:bg-indigo-50 dark:hover:bg-indigo-950 gap-1\">\n                    {fiscalYear} <ChevronDown className=\"h-4 w-4\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"end\">\n                  <DropdownMenuItem>This Fiscal Year</DropdownMenuItem>\n                  <DropdownMenuItem>Last Fiscal Year</DropdownMenuItem>\n                  <DropdownMenuItem>This Quarter</DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n                <div className=\"lg:col-span-2 h-64\">\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <AreaChart data={dashboard?.cashFlow || []}>\n                      <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                      <XAxis\n                        dataKey=\"month\"\n                        tick={{ fontSize: 11 }}\n                        tickFormatter={(value) => value.split(' ')[0]}\n                        className=\"fill-muted-foreground\"\n                      />\n                      <YAxis\n                        tick={{ fontSize: 11 }}\n                        tickFormatter={(value) => `${(value / 1000).toFixed(0)}K`}\n                        className=\"fill-muted-foreground\"\n                      />\n                      <Tooltip\n                        formatter={(value: number) => formatCurrency(value)}\n                        contentStyle={{ backgroundColor: 'var(--background)', border: '1px solid var(--border)' }}\n                      />\n                      <Area\n                        type=\"monotone\"\n                        dataKey=\"value\"\n                        stroke=\"#6366f1\"\n                        fill=\"#eef2ff\"\n                        strokeWidth={2}\n                      />\n                    </AreaChart>\n                  </ResponsiveContainer>\n                </div>\n                <div className=\"space-y-4\">\n                  <div className=\"text-right\">\n                    <p className=\"text-sm text-muted-foreground\">Cash as on 01/04/2025</p>\n                    <p className=\"text-2xl font-semibold\" data-testid=\"value-cash-start\">\n                      {formatCurrency(dashboard?.summary?.cashOnHand || 0)}\n                    </p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"text-sm text-teal-600\">Incoming</p>\n                    <p className=\"text-xl font-semibold text-teal-600 flex items-center justify-end gap-1\" data-testid=\"value-incoming\">\n                      {formatCurrency(totalIncoming)} <TrendingUp className=\"h-4 w-4\" />\n                    </p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"text-sm text-red-500\">Outgoing</p>\n                    <p className=\"text-xl font-semibold text-red-500 flex items-center justify-end gap-1\" data-testid=\"value-outgoing\">\n                      {formatCurrency(totalOutgoing)} <TrendingDown className=\"h-4 w-4\" />\n                    </p>\n                  </div>\n                  <div className=\"text-right pt-2 border-t\">\n                    <p className=\"text-sm text-muted-foreground\">Cash as on 31/03/2026</p>\n                    <p className=\"text-xl font-semibold\" data-testid=\"value-cash-end\">\n                      {formatCurrency((dashboard?.summary?.cashOnHand || 0) + totalIncoming - totalOutgoing)}\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-4\">\n                <CardTitle className=\"text-lg font-semibold\">Income and Expense</CardTitle>\n                <div className=\"flex items-center gap-2\">\n                  <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                      <Button variant=\"ghost\" size=\"sm\" className=\"text-indigo-600 hover:text-indigo-700 hover:bg-indigo-50 dark:hover:bg-indigo-950 gap-1\">\n                        {fiscalYear} <ChevronDown className=\"h-4 w-4\" />\n                      </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent align=\"end\">\n                      <DropdownMenuItem>This Fiscal Year</DropdownMenuItem>\n                      <DropdownMenuItem>Last Fiscal Year</DropdownMenuItem>\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"flex justify-end\">\n                  <div className=\"inline-flex rounded-md border overflow-hidden\">\n                    <button\n                      onClick={() => setIncomeExpenseMode(\"accrual\")}\n                      className={`px-3 py-1.5 text-sm font-medium transition-colors ${incomeExpenseMode === \"accrual\"\n                          ? \"bg-muted\"\n                          : \"bg-background hover:bg-muted/50\"\n                        }`}\n                      data-testid=\"button-accrual\"\n                    >\n                      Accrual\n                    </button>\n                    <button\n                      onClick={() => setIncomeExpenseMode(\"cash\")}\n                      className={`px-3 py-1.5 text-sm font-medium transition-colors ${incomeExpenseMode === \"cash\"\n                          ? \"bg-muted\"\n                          : \"bg-background hover:bg-muted/50\"\n                        }`}\n                      data-testid=\"button-cash\"\n                    >\n                      Cash\n                    </button>\n                  </div>\n                </div>\n                <div className=\"h-48\">\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <BarChart data={dashboard?.incomeExpense || []}>\n                      <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                      <XAxis\n                        dataKey=\"month\"\n                        tick={{ fontSize: 10 }}\n                        tickFormatter={(value) => value.split(' ')[0]}\n                        className=\"fill-muted-foreground\"\n                      />\n                      <YAxis\n                        tick={{ fontSize: 10 }}\n                        tickFormatter={(value) => `${(value / 1000).toFixed(0)}K`}\n                        className=\"fill-muted-foreground\"\n                      />\n                      <Tooltip\n                        formatter={(value: number) => formatCurrency(value)}\n                        contentStyle={{ backgroundColor: 'var(--background)', border: '1px solid var(--border)' }}\n                      />\n                      <Legend />\n                      <Bar dataKey=\"income\" name=\"Income\" fill=\"#22c55e\" radius={[2, 2, 0, 0]} />\n                      <Bar dataKey=\"expense\" name=\"Expense\" fill=\"#ef4444\" radius={[2, 2, 0, 0]} />\n                    </BarChart>\n                  </ResponsiveContainer>\n                </div>\n                <div className=\"flex items-center gap-6 pt-2 flex-wrap\">\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"w-4 h-1 bg-green-500 rounded\" />\n                    <span className=\"text-sm text-muted-foreground\">Income</span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"w-4 h-1 bg-red-500 rounded\" />\n                    <span className=\"text-sm text-muted-foreground\">Expense</span>\n                  </div>\n                  <div className=\"ml-auto flex items-center gap-6 text-sm flex-wrap\">\n                    <div>\n                      <span className=\"text-green-600 font-medium\">Total Income</span>\n                      <span className=\"ml-2 font-semibold\" data-testid=\"value-total-income\">{formatCurrency(totalIncome)}</span>\n                    </div>\n                    <div>\n                      <span className=\"text-red-500 font-medium\">Total Expenses</span>\n                      <span className=\"ml-2 font-semibold\" data-testid=\"value-total-expense\">{formatCurrency(totalExpenseAmount)}</span>\n                    </div>\n                  </div>\n                </div>\n                <p className=\"text-xs text-muted-foreground\">* Income and expense values displayed are exclusive of taxes.</p>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-4\">\n                <CardTitle className=\"text-lg font-semibold\">Top Expenses</CardTitle>\n                <DropdownMenu>\n                  <DropdownMenuTrigger asChild>\n                    <Button variant=\"ghost\" size=\"sm\" className=\"text-indigo-600 hover:text-indigo-700 hover:bg-indigo-50 dark:hover:bg-indigo-950 gap-1\">\n                      {fiscalYear} <ChevronDown className=\"h-4 w-4\" />\n                    </Button>\n                  </DropdownMenuTrigger>\n                  <DropdownMenuContent align=\"end\">\n                    <DropdownMenuItem>This Fiscal Year</DropdownMenuItem>\n                    <DropdownMenuItem>Last Fiscal Year</DropdownMenuItem>\n                  </DropdownMenuContent>\n                </DropdownMenu>\n              </CardHeader>\n              <CardContent>\n                {dashboard?.topExpenses && dashboard.topExpenses.length > 0 ? (\n                  <div className=\"flex gap-4\">\n                    <div className=\"w-40 h-40\">\n                      <ResponsiveContainer width=\"100%\" height=\"100%\">\n                        <PieChart>\n                          <Pie\n                            data={dashboard.topExpenses}\n                            dataKey=\"percentage\"\n                            nameKey=\"category\"\n                            cx=\"50%\"\n                            cy=\"50%\"\n                            innerRadius={30}\n                            outerRadius={60}\n                          >\n                            {dashboard.topExpenses.map((_, index) => (\n                              <Cell key={`cell-${index}`} fill={EXPENSE_COLORS[index % EXPENSE_COLORS.length]} />\n                            ))}\n                          </Pie>\n                          <Tooltip formatter={(value: number) => `${value.toFixed(1)}%`} />\n                        </PieChart>\n                      </ResponsiveContainer>\n                    </div>\n                    <div className=\"flex-1 space-y-2 max-h-48 overflow-y-auto\">\n                      {dashboard.topExpenses.slice(0, 5).map((expense, index) => (\n                        <div key={expense.category} className=\"flex items-center justify-between text-sm\">\n                          <div className=\"flex items-center gap-2\">\n                            <div\n                              className=\"w-3 h-3 rounded-full\"\n                              style={{ backgroundColor: EXPENSE_COLORS[index % EXPENSE_COLORS.length] }}\n                            />\n                            <span className=\"truncate max-w-32\">{expense.category}</span>\n                          </div>\n                          <span className=\"font-medium\">{formatCurrency(expense.amount)}</span>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                ) : (\n                  <div className=\"h-64 flex items-center justify-center\">\n                    <p className=\"text-muted-foreground text-sm\">No expenses recorded for this fiscal year</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg font-semibold\">Projects</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {dashboard?.projects && dashboard.projects.length > 0 ? (\n                  <div className=\"space-y-4\">\n                    {dashboard.projects.map((project) => (\n                      <div key={project.id} className=\"p-3 border rounded-lg\">\n                        <div className=\"flex items-center justify-between mb-2\">\n                          <span className=\"font-medium\">{project.name}</span>\n                          <span className=\"text-sm text-muted-foreground\">{project.client}</span>\n                        </div>\n                        <div className=\"w-full h-2 bg-muted rounded-full overflow-hidden\">\n                          <div\n                            className=\"h-full bg-indigo-500 rounded-full\"\n                            style={{ width: `${project.progress}%` }}\n                          />\n                        </div>\n                        <div className=\"flex justify-between text-xs text-muted-foreground mt-1\">\n                          <span>{project.progress}% Complete</span>\n                          <span>{formatCurrency(project.spent)} / {formatCurrency(project.budget)}</span>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"h-32 flex items-center justify-center\">\n                    <Link href=\"/time-tracking\" className=\"text-indigo-600 hover:text-indigo-700 text-sm hover:underline\">\n                      Add Project(s) to this watchlist\n                    </Link>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg font-semibold\">Bank and Credit Cards</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {dashboard?.bankAccounts && dashboard.bankAccounts.length > 0 ? (\n                  <div className=\"space-y-3\">\n                    {dashboard.bankAccounts.map((account) => (\n                      <div key={account.id} className=\"flex items-center justify-between p-3 border rounded-lg\">\n                        <div className=\"flex items-center gap-3\">\n                          <CreditCard className=\"h-5 w-5 text-muted-foreground\" />\n                          <div>\n                            <p className=\"font-medium text-sm\">{account.name}</p>\n                            <p className=\"text-xs text-muted-foreground capitalize\">{account.type}</p>\n                          </div>\n                        </div>\n                        <p className=\"font-semibold\">{formatCurrency(account.balance)}</p>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"h-32 flex flex-col items-center justify-center gap-2\">\n                    <CreditCard className=\"h-8 w-8 text-muted-foreground/50\" />\n                    <p className=\"text-sm text-muted-foreground\">Yet to add Bank and Credit Card details</p>\n                    <Link href=\"/banking\" className=\"text-indigo-600 hover:text-indigo-700 text-sm hover:underline\">\n                      Add Bank Account\n                    </Link>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-4\">\n              <CardTitle className=\"text-lg font-semibold\">Account Watchlist</CardTitle>\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"ghost\" size=\"sm\" className=\"text-muted-foreground hover:text-foreground gap-1\">\n                    Accrual <ChevronDown className=\"h-4 w-4\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"end\">\n                  <DropdownMenuItem>Accrual</DropdownMenuItem>\n                  <DropdownMenuItem>Cash</DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            </CardHeader>\n            <CardContent>\n              {dashboard?.accountWatchlist && dashboard.accountWatchlist.length > 0 ? (\n                <div className=\"space-y-3\">\n                  {dashboard.accountWatchlist.map((account) => (\n                    <div key={account.id} className=\"flex items-center justify-between p-3 border rounded-lg\">\n                      <span className=\"font-medium\">{account.name}</span>\n                      <div className=\"flex items-center gap-3\">\n                        <span className=\"font-semibold\">{formatCurrency(account.balance)}</span>\n                        <span className={`text-sm ${account.change >= 0 ? 'text-green-600' : 'text-red-500'}`}>\n                          {account.change >= 0 ? '+' : ''}{account.change}%\n                        </span>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"h-24 flex items-center justify-center border border-dashed rounded-lg\">\n                  <p className=\"text-muted-foreground text-sm\">No accounts in watchlist</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <div className=\"bg-muted/50 rounded-lg p-8 mt-8\">\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-8\">\n              <div className=\"text-center md:text-left\">\n                <h3 className=\"font-semibold mb-3\">Account on the go!</h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">\n                  Download the Billing app for Android and iOS to manage your finances from anywhere, anytime!\n                </p>\n                <div className=\"flex items-center justify-center md:justify-start gap-4\">\n                  <div className=\"flex items-center gap-2 text-sm text-indigo-600\">\n                    <Smartphone className=\"h-4 w-4\" />\n                    Learn More\n                    <ExternalLink className=\"h-3 w-3\" />\n                  </div>\n                </div>\n              </div>\n\n              <div>\n                <h4 className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-3\">OTHER APPS</h4>\n                <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                  <li className=\"hover:text-indigo-600 cursor-pointer\">Ecommerce Software</li>\n                  <li className=\"hover:text-indigo-600 cursor-pointer\">Expense Reporting</li>\n                  <li className=\"hover:text-indigo-600 cursor-pointer\">Subscription Billing</li>\n                  <li className=\"hover:text-indigo-600 cursor-pointer\">Inventory Management</li>\n                </ul>\n              </div>\n\n              <div>\n                <h4 className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-3\">HELP & SUPPORT</h4>\n                <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                  <li className=\"hover:text-indigo-600 cursor-pointer\">Contact Support</li>\n                  <li className=\"hover:text-indigo-600 cursor-pointer\">Knowledge Base</li>\n                  <li className=\"hover:text-indigo-600 cursor-pointer\">Help Documentation</li>\n                  <li className=\"hover:text-indigo-600 cursor-pointer\">Webinar</li>\n                </ul>\n              </div>\n\n              <div>\n                <h4 className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-3\">QUICK LINKS</h4>\n                <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                  <li className=\"hover:text-indigo-600 cursor-pointer\">Getting Started</li>\n                  <li className=\"hover:text-indigo-600 cursor-pointer\">Mobile apps</li>\n                  <li className=\"hover:text-indigo-600 cursor-pointer\">Add-ons</li>\n                  <li className=\"hover:text-indigo-600 cursor-pointer\">What's New?</li>\n                  <li className=\"hover:text-indigo-600 cursor-pointer\">Developers API</li>\n                </ul>\n              </div>\n            </div>\n\n            <div className=\"mt-8 pt-6 border-t text-center\">\n              <p className=\"text-xs text-muted-foreground\">2025, Billing Accounting. All Rights Reserved.</p>\n            </div>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"getting-started\" className=\"mt-6\">\n          <Card>\n            <CardContent className=\"p-12 text-center\">\n              <Folder className=\"h-12 w-12 text-muted-foreground/50 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">Getting Started Guide</h3>\n              <p className=\"text-muted-foreground mb-6\">Learn how to set up your accounting and start managing your business finances.</p>\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 max-w-2xl mx-auto\">\n                <div className=\"p-4 border rounded-lg hover:border-indigo-300 hover:bg-indigo-50/50 dark:hover:bg-indigo-950/50 transition-colors cursor-pointer\">\n                  <p className=\"font-medium\">1. Add Customers</p>\n                  <p className=\"text-sm text-muted-foreground mt-1\">Create your customer list</p>\n                </div>\n                <div className=\"p-4 border rounded-lg hover:border-indigo-300 hover:bg-indigo-50/50 dark:hover:bg-indigo-950/50 transition-colors cursor-pointer\">\n                  <p className=\"font-medium\">2. Create Invoice</p>\n                  <p className=\"text-sm text-muted-foreground mt-1\">Send your first invoice</p>\n                </div>\n                <div className=\"p-4 border rounded-lg hover:border-indigo-300 hover:bg-indigo-50/50 dark:hover:bg-indigo-950/50 transition-colors cursor-pointer\">\n                  <p className=\"font-medium\">3. Record Expense</p>\n                  <p className=\"text-sm text-muted-foreground mt-1\">Track your expenses</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"recent-updates\" className=\"mt-6\">\n          <Card>\n            <CardContent className=\"p-12 text-center\">\n              <Folder className=\"h-12 w-12 text-muted-foreground/50 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">Recent Updates</h3>\n              <p className=\"text-muted-foreground\">Stay updated with the latest features and improvements.</p>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":32995,"size_tokens":null},"server/src/middleware/validate.ts":{"content":"import { Request, Response, NextFunction } from 'express';\nimport { z, ZodSchema } from 'zod';\nimport { ValidationError } from './errorHandler';\n\ninterface ValidateSchemas {\n  body?: ZodSchema;\n  query?: ZodSchema;\n  params?: ZodSchema;\n}\n\nexport const validate = (schemas: ValidateSchemas) => {\n  return async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const errors: Record<string, string[]> = {};\n\n      if (schemas.body) {\n        const result = schemas.body.safeParse(req.body);\n        if (!result.success) {\n          result.error.errors.forEach(err => {\n            const path = `body.${err.path.join('.')}`;\n            if (!errors[path]) errors[path] = [];\n            errors[path].push(err.message);\n          });\n        } else {\n          req.body = result.data;\n        }\n      }\n\n      if (schemas.query) {\n        const result = schemas.query.safeParse(req.query);\n        if (!result.success) {\n          result.error.errors.forEach(err => {\n            const path = `query.${err.path.join('.')}`;\n            if (!errors[path]) errors[path] = [];\n            errors[path].push(err.message);\n          });\n        } else {\n          req.query = result.data;\n        }\n      }\n\n      if (schemas.params) {\n        const result = schemas.params.safeParse(req.params);\n        if (!result.success) {\n          result.error.errors.forEach(err => {\n            const path = `params.${err.path.join('.')}`;\n            if (!errors[path]) errors[path] = [];\n            errors[path].push(err.message);\n          });\n        } else {\n          req.params = result.data;\n        }\n      }\n\n      if (Object.keys(errors).length > 0) {\n        throw new ValidationError('Validation failed', errors);\n      }\n\n      next();\n    } catch (error) {\n      next(error);\n    }\n  };\n};\n\nexport default validate;\n","path":null,"size_bytes":1837,"size_tokens":null},"client/src/modules/items/hooks/useItems.ts":{"content":"import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { itemsApi } from '../api';\nimport { CreateItemDto, UpdateItemDto, ItemFilters } from '../types';\n\nexport const ITEMS_QUERY_KEY = 'items';\n\nexport const useItems = (page = 1, limit = 10, filters?: ItemFilters) => {\n  return useQuery({\n    queryKey: [ITEMS_QUERY_KEY, page, limit, filters],\n    queryFn: () => itemsApi.getAll(page, limit, filters),\n  });\n};\n\nexport const useItem = (id: string) => {\n  return useQuery({\n    queryKey: [ITEMS_QUERY_KEY, id],\n    queryFn: () => itemsApi.getById(id),\n    enabled: !!id,\n  });\n};\n\nexport const useCreateItem = () => {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: (data: CreateItemDto) => itemsApi.create(data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [ITEMS_QUERY_KEY] });\n    },\n  });\n};\n\nexport const useUpdateItem = () => {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: ({ id, data }: { id: string; data: UpdateItemDto }) =>\n      itemsApi.update(id, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [ITEMS_QUERY_KEY] });\n    },\n  });\n};\n\nexport const useDeleteItem = () => {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: (id: string) => itemsApi.delete(id),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [ITEMS_QUERY_KEY] });\n    },\n  });\n};\n","path":null,"size_bytes":1465,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-primary/20\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":792,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":2001,"size_tokens":null},"server/src/utils/pagination.ts":{"content":"import { PAGINATION } from '../common/constants';\n\nexport interface PaginationParams {\n  page?: number;\n  limit?: number;\n}\n\nexport interface PaginationResult {\n  page: number;\n  limit: number;\n  offset: number;\n}\n\nexport const parsePagination = (params: PaginationParams): PaginationResult => {\n  const page = Math.max(1, Number(params.page) || PAGINATION.DEFAULT_PAGE);\n  const limit = Math.min(\n    PAGINATION.MAX_LIMIT,\n    Math.max(1, Number(params.limit) || PAGINATION.DEFAULT_LIMIT)\n  );\n  const offset = (page - 1) * limit;\n\n  return { page, limit, offset };\n};\n\nexport const getPaginationMeta = (total: number, page: number, limit: number) => ({\n  page,\n  limit,\n  total,\n  totalPages: Math.ceil(total / limit),\n  hasNextPage: page * limit < total,\n  hasPrevPage: page > 1,\n});\n","path":null,"size_bytes":787,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1419,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogTrigger,\n  DialogClose,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3835,"size_tokens":null},"client/src/routes/index.tsx":{"content":"import { lazy, Suspense } from 'react';\nimport { Route, Switch } from 'wouter';\nimport { Spinner } from '@/components/ui/spinner';\n\nconst Dashboard = lazy(() => import('@/modules/dashboard/pages/DashboardPage'));\nconst Items = lazy(() => import('@/modules/items/pages/ItemsPage'));\nconst ItemCreate = lazy(() => import('@/modules/items/pages/ItemCreatePage'));\nconst Invoices = lazy(() => import('@/modules/sales/pages/InvoicesPage'));\nconst InvoiceCreate = lazy(() => import('@/modules/sales/pages/InvoiceCreatePage'));\nconst Estimates = lazy(() => import('@/modules/sales/pages/EstimatesPage'));\nconst Quotes = lazy(() => import('@/modules/sales/pages/QuotesPage'));\nconst QuoteCreate = lazy(() => import('@/modules/sales/pages/QuoteCreatePage'));\nconst Customers = lazy(() => import('@/modules/customers/pages/CustomersPage'));\nconst CustomerCreate = lazy(() => import('@/modules/customers/pages/CustomerCreatePage'));\nconst Vendors = lazy(() => import('@/modules/vendors/pages/VendorsPage'));\nconst PurchaseOrders = lazy(() => import('@/modules/purchases/pages/PurchaseOrdersPage'));\nconst Bills = lazy(() => import('@/modules/purchases/pages/BillsPage'));\nconst PaymentsMade = lazy(() => import('@/modules/purchases/pages/PaymentsMadePage'));\nconst VendorCredits = lazy(() => import('@/modules/purchases/pages/VendorCreditsPage'));\nconst Expenses = lazy(() => import('@/modules/expenses/pages/ExpensesPage'));\nconst Banking = lazy(() => import('@/modules/banking/pages/BankingPage'));\nconst Reports = lazy(() => import('@/modules/reports/pages/ReportsPage'));\nconst Documents = lazy(() => import('@/modules/documents/pages/DocumentsPage'));\nconst TimeTracking = lazy(() => import('@/modules/accounting/pages/TimeTrackingPage'));\nconst FilingCompliance = lazy(() => import('@/modules/accounting/pages/FilingCompliancePage'));\nconst Accountant = lazy(() => import('@/modules/accounting/pages/AccountantPage'));\nconst Settings = lazy(() => import('@/modules/settings/pages/SettingsPage'));\nconst Support = lazy(() => import('@/modules/settings/pages/SupportPage'));\nconst NotFound = lazy(() => import('@/pages/not-found'));\n\nconst PageLoader = () => (\n  <div className=\"flex items-center justify-center min-h-screen\">\n    <Spinner className=\"w-8 h-8\" />\n  </div>\n);\n\nexport const AppRoutes = () => {\n  return (\n    <Suspense fallback={<PageLoader />}>\n      <Switch>\n        <Route path=\"/\" component={Dashboard} />\n        <Route path=\"/dashboard\" component={Dashboard} />\n        \n        {/* Items Module */}\n        <Route path=\"/items\" component={Items} />\n        <Route path=\"/items/create\" component={ItemCreate} />\n        \n        {/* Sales Module */}\n        <Route path=\"/invoices\" component={Invoices} />\n        <Route path=\"/invoices/create\" component={InvoiceCreate} />\n        <Route path=\"/estimates\" component={Quotes} />\n        <Route path=\"/quotes\" component={Quotes} />\n        <Route path=\"/quotes/create\" component={QuoteCreate} />\n        \n        {/* Customers Module */}\n        <Route path=\"/customers\" component={Customers} />\n        <Route path=\"/customers/create\" component={CustomerCreate} />\n        \n        {/* Vendors Module */}\n        <Route path=\"/vendors\" component={Vendors} />\n        \n        {/* Purchases Module */}\n        <Route path=\"/purchase-orders\" component={PurchaseOrders} />\n        <Route path=\"/bills\" component={Bills} />\n        <Route path=\"/payments-made\" component={PaymentsMade} />\n        <Route path=\"/vendor-credits\" component={VendorCredits} />\n        \n        {/* Expenses Module */}\n        <Route path=\"/expenses\" component={Expenses} />\n        \n        {/* Banking Module */}\n        <Route path=\"/banking\" component={Banking} />\n        \n        {/* Reports Module */}\n        <Route path=\"/reports\" component={Reports} />\n        \n        {/* Documents Module */}\n        <Route path=\"/documents\" component={Documents} />\n        \n        {/* Accounting Module */}\n        <Route path=\"/time-tracking\" component={TimeTracking} />\n        <Route path=\"/filing-compliance\" component={FilingCompliance} />\n        <Route path=\"/accountant\" component={Accountant} />\n        \n        {/* Settings Module */}\n        <Route path=\"/settings\" component={Settings} />\n        <Route path=\"/support\" component={Support} />\n        \n        {/* 404 */}\n        <Route component={NotFound} />\n      </Switch>\n    </Suspense>\n  );\n};\n\nexport default AppRoutes;\n","path":null,"size_bytes":4428,"size_tokens":null},"client/src/modules/purchases/pages/PurchaseOrdersPage.tsx":{"content":"export { default } from '@/pages/purchase-orders';\n","path":null,"size_bytes":51,"size_tokens":null},"client/src/pages/support.tsx":{"content":"import { useState } from \"react\";\nimport { Search, Filter, RefreshCw, Plus, MoreVertical, CheckCircle2, Circle, Clock, AlertCircle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport MongoErrorPanel from \"@/components/MongoErrorPanel\";\n\nconst tickets = [\n  { id: \"#1024\", title: \"Invoice generation failed\", desc: \"System throws 500 error when generating PDF for customer #4592\", status: \"Open\", priority: \"High\", created: \"2h ago\", assignee: \"Alex\" },\n  { id: \"#1023\", title: \"GST calculation incorrect\", desc: \"Inter-state tax applied for intra-state transaction in Karnataka\", status: \"In Progress\", priority: \"Critical\", created: \"5h ago\", assignee: \"Sarah\" },\n  { id: \"#1022\", title: \"Update email template\", desc: \"Change the footer address in the default invoice email template\", status: \"Closed\", priority: \"Low\", created: \"1d ago\", assignee: \"Mike\" },\n  { id: \"#1021\", title: \"Add new user role\", desc: \"Need a read-only role for the auditor\", status: \"Open\", priority: \"Medium\", created: \"2d ago\", assignee: \"Unassigned\" },\n  { id: \"#1020\", title: \"Login timeout issue\", desc: \"Session expires too quickly even with 'Remember me' checked\", status: \"In Progress\", priority: \"High\", created: \"3d ago\", assignee: \"Sarah\" },\n];\n\nexport default function Support() {\n  return (\n    <div className=\"p-6 space-y-8 max-w-6xl mx-auto\">\n      <div className=\"flex items-center justify-between\">\n        <h1 className=\"text-2xl font-bold text-slate-900\">Support Tickets</h1>\n        <Button className=\"bg-blue-600 hover:bg-blue-700\">\n          <Plus className=\"h-4 w-4 mr-2\" /> New Ticket\n        </Button>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card className=\"bg-blue-50 border-blue-100\">\n           <CardContent className=\"p-6 flex items-center justify-between\">\n              <div>\n                 <p className=\"text-sm font-medium text-blue-600\">Total Tickets</p>\n                 <p className=\"text-3xl font-bold text-blue-900 mt-1\">24</p>\n              </div>\n              <div className=\"h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600\">\n                 <MoreVertical className=\"h-5 w-5\" />\n              </div>\n           </CardContent>\n        </Card>\n        <Card className=\"bg-red-50 border-red-100\">\n           <CardContent className=\"p-6 flex items-center justify-between\">\n              <div>\n                 <p className=\"text-sm font-medium text-red-600\">Open</p>\n                 <p className=\"text-3xl font-bold text-red-900 mt-1\">8</p>\n              </div>\n              <div className=\"h-10 w-10 bg-red-100 rounded-full flex items-center justify-center text-red-600\">\n                 <AlertCircle className=\"h-5 w-5\" />\n              </div>\n           </CardContent>\n        </Card>\n        <Card className=\"bg-yellow-50 border-yellow-100\">\n           <CardContent className=\"p-6 flex items-center justify-between\">\n              <div>\n                 <p className=\"text-sm font-medium text-yellow-600\">In Progress</p>\n                 <p className=\"text-3xl font-bold text-yellow-900 mt-1\">5</p>\n              </div>\n              <div className=\"h-10 w-10 bg-yellow-100 rounded-full flex items-center justify-center text-yellow-600\">\n                 <Clock className=\"h-5 w-5\" />\n              </div>\n           </CardContent>\n        </Card>\n        <Card className=\"bg-green-50 border-green-100\">\n           <CardContent className=\"p-6 flex items-center justify-between\">\n              <div>\n                 <p className=\"text-sm font-medium text-green-600\">Closed</p>\n                 <p className=\"text-3xl font-bold text-green-900 mt-1\">11</p>\n              </div>\n              <div className=\"h-10 w-10 bg-green-100 rounded-full flex items-center justify-center text-green-600\">\n                 <CheckCircle2 className=\"h-5 w-5\" />\n              </div>\n           </CardContent>\n        </Card>\n      </div>\n\n      {/* Filters & Search */}\n      <div className=\"flex flex-col md:flex-row gap-4 items-center bg-white p-4 rounded-lg border border-slate-200 shadow-sm\">\n        <div className=\"relative flex-1 w-full\">\n           <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400\" />\n           <Input placeholder=\"Search tickets by title, description, or ID...\" className=\"pl-9\" />\n        </div>\n        <div className=\"flex gap-2 w-full md:w-auto overflow-x-auto pb-2 md:pb-0\">\n           <Select>\n              <SelectTrigger className=\"w-[130px]\">\n                 <SelectValue placeholder=\"Status\" />\n              </SelectTrigger>\n              <SelectContent>\n                 <SelectItem value=\"open\">Open</SelectItem>\n                 <SelectItem value=\"in_progress\">In Progress</SelectItem>\n                 <SelectItem value=\"closed\">Closed</SelectItem>\n              </SelectContent>\n           </Select>\n           <Select>\n              <SelectTrigger className=\"w-[130px]\">\n                 <SelectValue placeholder=\"Priority\" />\n              </SelectTrigger>\n              <SelectContent>\n                 <SelectItem value=\"high\">High</SelectItem>\n                 <SelectItem value=\"medium\">Medium</SelectItem>\n                 <SelectItem value=\"low\">Low</SelectItem>\n              </SelectContent>\n           </Select>\n           <Select>\n              <SelectTrigger className=\"w-[130px]\">\n                 <SelectValue placeholder=\"Category\" />\n              </SelectTrigger>\n              <SelectContent>\n                 <SelectItem value=\"bug\">Bug</SelectItem>\n                 <SelectItem value=\"feature\">Feature</SelectItem>\n                 <SelectItem value=\"billing\">Billing</SelectItem>\n              </SelectContent>\n           </Select>\n           <Button variant=\"outline\" size=\"icon\">\n              <RefreshCw className=\"h-4 w-4 text-slate-500\" />\n           </Button>\n        </div>\n      </div>\n\n      {/* Ticket List */}\n      <div className=\"space-y-4\">\n         {tickets.map((ticket) => (\n            <div key={ticket.id} className=\"bg-white border border-slate-200 rounded-lg p-4 hover:shadow-md transition-shadow flex flex-col md:flex-row gap-4 md:items-center\">\n               <div className=\"flex items-start gap-4 flex-1\">\n                  <div className=\"h-10 w-10 rounded-full bg-slate-100 flex items-center justify-center flex-shrink-0 font-mono text-xs font-medium text-slate-600\">\n                     {ticket.id}\n                  </div>\n                  <div>\n                     <h3 className=\"font-semibold text-slate-900 hover:text-blue-600 cursor-pointer\">{ticket.title}</h3>\n                     <p className=\"text-sm text-slate-500 mt-1 line-clamp-2\">{ticket.desc}</p>\n                     <div className=\"flex items-center gap-2 mt-3\">\n                        <Badge variant=\"secondary\" className={\n                           ticket.status === 'Open' ? 'bg-red-100 text-red-700 hover:bg-red-100' :\n                           ticket.status === 'In Progress' ? 'bg-yellow-100 text-yellow-700 hover:bg-yellow-100' :\n                           'bg-green-100 text-green-700 hover:bg-green-100'\n                        }>\n                           {ticket.status}\n                        </Badge>\n                        <Badge variant=\"outline\" className=\"text-xs font-normal text-slate-500\">\n                           {ticket.priority} Priority\n                        </Badge>\n                        <span className=\"text-xs text-slate-400 ml-2\"> {ticket.created}</span>\n                     </div>\n                  </div>\n               </div>\n               <div className=\"flex items-center gap-4 pl-14 md:pl-0 border-t md:border-t-0 border-slate-100 pt-3 md:pt-0\">\n                  <div className=\"text-right hidden md:block\">\n                     <p className=\"text-xs text-slate-400\">Assigned to</p>\n                     <p className=\"text-sm font-medium text-slate-700\">{ticket.assignee}</p>\n                  </div>\n               </div>\n            </div>\n         ))}\n      </div>\n      \n      {/* Demo of MongoDB Error UI */}\n      <div className=\"mt-12 pt-12 border-t border-slate-200\">\n         <h2 className=\"text-lg font-semibold text-slate-500 mb-6 uppercase tracking-wider\">System Status (Simulation)</h2>\n         <MongoErrorPanel />\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":8622,"size_tokens":null},"client/src/pages/customer-edit.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useLocation, useParams } from \"wouter\";\nimport { ArrowLeft, Plus, X, Upload, FileText, Trash2, Info, Check, ChevronsUpDown, AlertTriangle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { cn } from \"@/lib/utils\";\n\nconst GST_TREATMENTS = [\n  {\n    value: \"registered_regular\",\n    label: \"Registered Business  Regular\",\n    description: \"Regular business registered under GST\"\n  },\n  {\n    value: \"registered_composition\",\n    label: \"Registered Business  Composition\",\n    description: \"Registered under GST Composition Scheme\"\n  },\n  {\n    value: \"unregistered_business\",\n    label: \"Unregistered Business\",\n    description: \"Business not registered under GST\"\n  },\n  {\n    value: \"consumer\",\n    label: \"Consumer\",\n    description: \"A normal consumer\"\n  },\n  {\n    value: \"overseas\",\n    label: \"Overseas\",\n    description: \"International import/export parties\"\n  },\n  {\n    value: \"sez_unit\",\n    label: \"Special Economic Zone (SEZ Unit)\",\n    description: \"Business operating inside SEZ\"\n  },\n  {\n    value: \"deemed_export\",\n    label: \"Deemed Export\",\n    description: \"Sales to EOU or EPCG license holders\"\n  },\n  {\n    value: \"tax_deductor\",\n    label: \"Tax Deductor\",\n    description: \"Govt agencies deducting TDS under GST\"\n  },\n  {\n    value: \"sez_developer\",\n    label: \"SEZ Developer\",\n    description: \"Owner/Developer of SEZ unit\"\n  },\n  {\n    value: \"isd\",\n    label: \"Input Service Distributor (ISD)\",\n    description: \"Head office distributing GST credits internally\"\n  }\n];\n\nconst INDIAN_STATES = [\n  { code: \"01\", name: \"Jammu and Kashmir\" },\n  { code: \"02\", name: \"Himachal Pradesh\" },\n  { code: \"03\", name: \"Punjab\" },\n  { code: \"04\", name: \"Chandigarh\" },\n  { code: \"05\", name: \"Uttarakhand\" },\n  { code: \"06\", name: \"Haryana\" },\n  { code: \"07\", name: \"Delhi\" },\n  { code: \"08\", name: \"Rajasthan\" },\n  { code: \"09\", name: \"Uttar Pradesh\" },\n  { code: \"10\", name: \"Bihar\" },\n  { code: \"11\", name: \"Sikkim\" },\n  { code: \"12\", name: \"Arunachal Pradesh\" },\n  { code: \"13\", name: \"Nagaland\" },\n  { code: \"14\", name: \"Manipur\" },\n  { code: \"15\", name: \"Mizoram\" },\n  { code: \"16\", name: \"Tripura\" },\n  { code: \"17\", name: \"Meghalaya\" },\n  { code: \"18\", name: \"Assam\" },\n  { code: \"19\", name: \"West Bengal\" },\n  { code: \"20\", name: \"Jharkhand\" },\n  { code: \"21\", name: \"Odisha\" },\n  { code: \"22\", name: \"Chhattisgarh\" },\n  { code: \"23\", name: \"Madhya Pradesh\" },\n  { code: \"24\", name: \"Gujarat\" },\n  { code: \"25\", name: \"Daman and Diu (Old)\" },\n  { code: \"26\", name: \"Dadra and Nagar Haveli and Daman and Diu\" },\n  { code: \"27\", name: \"Maharashtra\" },\n  { code: \"28\", name: \"Andhra Pradesh (Old)\" },\n  { code: \"29\", name: \"Karnataka\" },\n  { code: \"30\", name: \"Goa\" },\n  { code: \"31\", name: \"Lakshadweep\" },\n  { code: \"32\", name: \"Kerala\" },\n  { code: \"33\", name: \"Tamil Nadu\" },\n  { code: \"34\", name: \"Puducherry\" },\n  { code: \"35\", name: \"Andaman and Nicobar Islands\" },\n  { code: \"36\", name: \"Telangana\" },\n  { code: \"37\", name: \"Andhra Pradesh\" },\n  { code: \"38\", name: \"Ladakh\" },\n  { code: \"97\", name: \"Other Territory\" },\n];\n\nconst EXEMPTION_REASONS = [\n  \"Exempt supply under GST\",\n  \"Export without payment of tax\",\n  \"SEZ supply\",\n  \"Deemed export\",\n  \"Zero-rated supply\",\n  \"Supply to EOU/STP/EHTP\",\n  \"Government entity\",\n  \"Charitable organization\",\n  \"Educational institution\",\n  \"Healthcare services\",\n];\n\nconst PAYMENT_TERMS_OPTIONS = [\n  { value: \"due_on_receipt\", label: \"Due on Receipt\" },\n  { value: \"net_15\", label: \"Net 15\" },\n  { value: \"net_30\", label: \"Net 30\" },\n  { value: \"net_45\", label: \"Net 45\" },\n  { value: \"net_60\", label: \"Net 60\" },\n  { value: \"due_end_of_month\", label: \"Due end of the month\" },\n  { value: \"due_end_of_next_month\", label: \"Due end of next month\" }\n];\n\nconst CURRENCIES = [\n  { value: \"INR\", label: \"INR - Indian Rupee\" },\n  { value: \"USD\", label: \"USD - US Dollar\" },\n  { value: \"EUR\", label: \"EUR - Euro\" },\n  { value: \"GBP\", label: \"GBP - British Pound\" },\n  { value: \"AED\", label: \"AED - UAE Dirham\" }\n];\n\nfunction validateGSTIN(gstin: string): { valid: boolean; message?: string } {\n  if (!gstin) return { valid: true };\n\n  if (gstin.length !== 15) {\n    return { valid: false, message: \"GSTIN must be 15 characters\" };\n  }\n\n  const gstinPattern = /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/;\n  if (!gstinPattern.test(gstin)) {\n    return { valid: false, message: \"Invalid GSTIN format\" };\n  }\n\n  return { valid: true };\n}\n\nfunction validatePAN(pan: string): { valid: boolean; message?: string } {\n  if (!pan) return { valid: true };\n\n  if (pan.length !== 10) {\n    return { valid: false, message: \"PAN must be 10 characters\" };\n  }\n\n  const panPattern = /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/;\n  if (!panPattern.test(pan)) {\n    return { valid: false, message: \"Invalid PAN format (e.g., ABCDE1234F)\" };\n  }\n\n  return { valid: true };\n}\n\ninterface Customer {\n  id: string;\n  displayName: string;\n  companyName?: string;\n  email?: string;\n  workPhone?: string;\n  mobile?: string;\n  gstTreatment?: string;\n  placeOfSupply?: string;\n  gstin?: string;\n  pan?: string;\n  taxPreference?: string;\n  currency?: string;\n  paymentTerms?: string;\n  customerType?: string;\n  billingAddress?: {\n    street: string;\n    city: string;\n    state: string;\n    country: string;\n    pincode: string;\n  };\n  shippingAddress?: {\n    street: string;\n    city: string;\n    state: string;\n    country: string;\n    pincode: string;\n  };\n  contactPersons?: Array<{\n    salutation: string;\n    firstName: string;\n    lastName: string;\n    email: string;\n    workPhone: string;\n    mobile: string;\n  }>;\n}\n\nexport default function CustomerEdit() {\n  const [, setLocation] = useLocation();\n  const params = useParams<{ id: string }>();\n  const { toast } = useToast();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [customer, setCustomer] = useState<Customer | null>(null);\n\n  // Dropdown state management\n  const [gstTreatmentOpen, setGstTreatmentOpen] = useState(false);\n  const [gstTreatmentSearch, setGstTreatmentSearch] = useState(\"\");\n  const [placeOfSupplyOpen, setPlaceOfSupplyOpen] = useState(false);\n  const [placeOfSupplySearch, setPlaceOfSupplySearch] = useState(\"\");\n  const [exemptionOpen, setExemptionOpen] = useState(false);\n  const [exemptionSearch, setExemptionSearch] = useState(\"\");\n  const [currencyOpen, setCurrencyOpen] = useState(false);\n  const [currencySearch, setCurrencySearch] = useState(\"\");\n  const [paymentTermsOpen, setPaymentTermsOpen] = useState(false);\n\n  interface AttachedFile {\n    id: string;\n    name: string;\n    size: number;\n    type: string;\n    data?: string;\n  }\n\n  const [documents, setDocuments] = useState<AttachedFile[]>([]);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const handleFileUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = event.target.files;\n    if (!files) return;\n\n    const maxSize = 10 * 1024 * 1024;\n    const maxFiles = 10;\n\n    if (documents.length + files.length > maxFiles) {\n      toast({\n        title: \"Too many files\",\n        description: `You can only upload up to ${maxFiles} files.`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    Array.from(files).forEach((file) => {\n      if (file.size > maxSize) {\n        toast({\n          title: \"File too large\",\n          description: `${file.name} exceeds 10MB limit.`,\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        const newFile: AttachedFile = {\n          id: `file-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n          name: file.name,\n          size: file.size,\n          type: file.type,\n          data: e.target?.result as string,\n        };\n        setDocuments((prev) => [...prev, newFile]);\n      };\n      reader.readAsDataURL(file);\n    });\n\n    if (event.target) {\n      event.target.value = \"\";\n    }\n  };\n\n  const removeFile = (fileId: string) => {\n    setDocuments((prev) => prev.filter((f) => f.id !== fileId));\n  };\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes < 1024) return bytes + \" B\";\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + \" KB\";\n    return (bytes / (1024 * 1024)).toFixed(1) + \" MB\";\n  };\n\n  const [formData, setFormData] = useState({\n    customerType: \"business\" as \"business\" | \"individual\",\n    displayName: \"\",\n    companyName: \"\",\n    email: \"\",\n    workPhone: \"\",\n    mobile: \"\",\n    gstTreatment: \"\",\n    placeOfSupply: \"\",\n    gstin: \"\",\n    pan: \"\",\n    taxPreference: \"taxable\" as \"taxable\" | \"tax_exempt\",\n    exemptionReason: \"\",\n    currency: \"INR\",\n    paymentTerms: \"\",\n    billingStreet: \"\",\n    billingCity: \"\",\n    billingState: \"\",\n    billingCountry: \"India\",\n    billingPincode: \"\",\n    shippingStreet: \"\",\n    shippingCity: \"\",\n    shippingState: \"\",\n    shippingCountry: \"India\",\n    shippingPincode: \"\",\n  });\n\n  const [contactPersons, setContactPersons] = useState<Array<{\n    salutation: string;\n    firstName: string;\n    lastName: string;\n    email: string;\n    workPhone: string;\n    mobile: string;\n  }>>([]);\n\n  useEffect(() => {\n    const fetchCustomer = async () => {\n      if (!params.id) return;\n      try {\n        const response = await fetch(`/api/customers/${params.id}`);\n        if (response.ok) {\n          const data = await response.json();\n          const found = data.data;\n          if (found) {\n            setCustomer(found);\n            setFormData({\n              customerType: found.customerType || \"business\",\n              displayName: found.displayName || found.name || \"\",\n              companyName: found.companyName || \"\",\n              email: found.email || \"\",\n              workPhone: found.workPhone || found.phone || \"\",\n              mobile: found.mobile || \"\",\n              gstTreatment: found.gstTreatment || \"\",\n              placeOfSupply: found.placeOfSupply || \"\",\n              gstin: found.gstin || \"\",\n              pan: found.pan || \"\",\n              taxPreference: found.taxPreference || \"taxable\",\n              exemptionReason: found.exemptionReason || \"\",\n              currency: found.currency || \"INR\",\n              paymentTerms: found.paymentTerms || \"\",\n              billingStreet: found.billingAddress?.street || \"\",\n              billingCity: found.billingAddress?.city || \"\",\n              billingState: found.billingAddress?.state || \"\",\n              billingCountry: found.billingAddress?.country || \"India\",\n              billingPincode: found.billingAddress?.pincode || \"\",\n              shippingStreet: found.shippingAddress?.street || \"\",\n              shippingCity: found.shippingAddress?.city || \"\",\n              shippingState: found.shippingAddress?.state || \"\",\n              shippingCountry: found.shippingAddress?.country || \"India\",\n              shippingPincode: found.shippingAddress?.pincode || \"\",\n            });\n            if (found.contactPersons) {\n              setContactPersons(found.contactPersons);\n            }\n          }\n        }\n      } catch (error) {\n        console.error('Failed to fetch customer:', error);\n        toast({\n          title: \"Error\",\n          description: \"Failed to load customer data.\",\n          variant: \"destructive\",\n        });\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchCustomer();\n  }, [params.id]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!params.id) return;\n\n    setIsSubmitting(true);\n\n    try {\n      const updateData = {\n        name: formData.displayName,\n        displayName: formData.displayName,\n        companyName: formData.companyName,\n        email: formData.email,\n        phone: formData.workPhone,\n        workPhone: formData.workPhone,\n        mobile: formData.mobile,\n        gstTreatment: (formData.taxPreference === \"taxable\" || formData.taxPreference === \"tax_exempt\") ? formData.gstTreatment : \"\",\n        placeOfSupply: formData.placeOfSupply,\n        gstin: formData.taxPreference === \"taxable\" ? formData.gstin : \"\",\n        pan: formData.pan,\n        taxPreference: formData.taxPreference,\n        exemptionReason: formData.taxPreference === \"tax_exempt\" ? formData.exemptionReason : \"\",\n        currency: formData.currency,\n        paymentTerms: formData.paymentTerms,\n        customerType: formData.customerType,\n        billingAddress: {\n          street: formData.billingStreet,\n          city: formData.billingCity,\n          state: formData.billingState,\n          country: formData.billingCountry,\n          pincode: formData.billingPincode,\n        },\n        shippingAddress: {\n          street: formData.shippingStreet,\n          city: formData.shippingCity,\n          state: formData.shippingState,\n          country: formData.shippingCountry,\n          pincode: formData.shippingPincode,\n        },\n        contactPersons: contactPersons,\n      };\n\n      const response = await fetch(`/api/customers/${params.id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(updateData),\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Customer Updated\",\n          description: \"The customer has been successfully updated.\",\n        });\n        setLocation(\"/customers\");\n      } else {\n        throw new Error('Failed to update customer');\n      }\n    } catch (error) {\n      console.error('Failed to update customer:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to update customer. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"max-w-5xl mx-auto py-12 text-center\">\n        <p className=\"text-slate-500\">Loading customer...</p>\n      </div>\n    );\n  }\n\n  if (!customer) {\n    return (\n      <div className=\"max-w-5xl mx-auto py-12 text-center\">\n        <p className=\"text-slate-500\">Customer not found</p>\n        <Button variant=\"link\" onClick={() => setLocation(\"/customers\")}>\n          Back to Customers\n        </Button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-5xl mx-auto pb-20 p-4\">\n      <div className=\"mb-6\">\n        <div\n          className=\"flex items-center gap-2 mb-4 text-slate-500 hover:text-slate-800 transition-colors cursor-pointer w-fit\"\n          onClick={() => setLocation(\"/customers\")}\n          data-testid=\"link-back-customers\"\n        >\n          <ArrowLeft className=\"h-4 w-4\" />\n          <span className=\"text-sm font-medium\">Back to Customers</span>\n        </div>\n        <div className=\"flex items-center justify-between\">\n          <h1 className=\"text-2xl font-bold text-slate-900\">Edit Customer</h1>\n        </div>\n      </div>\n\n      <form onSubmit={handleSubmit} className=\"space-y-8\">\n        <div className=\"grid grid-cols-1 md:grid-cols-12 gap-6 md:gap-12\">\n          <div className=\"md:col-span-6 space-y-6\">\n            <div className=\"space-y-3\">\n              <Label>Customer Type</Label>\n              <RadioGroup\n                value={formData.customerType}\n                onValueChange={(val) => setFormData({ ...formData, customerType: val as \"business\" | \"individual\" })}\n                className=\"flex flex-row space-x-4\"\n              >\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"business\" id=\"business\" />\n                  <Label htmlFor=\"business\" className=\"font-normal\">Business</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"individual\" id=\"individual\" />\n                  <Label htmlFor=\"individual\" className=\"font-normal\">Individual</Label>\n                </div>\n              </RadioGroup>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"displayName\">Display Name *</Label>\n              <Input\n                id=\"displayName\"\n                value={formData.displayName}\n                onChange={(e) => setFormData({ ...formData, displayName: e.target.value })}\n                required\n                data-testid=\"input-display-name\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"companyName\">Company Name</Label>\n              <Input\n                id=\"companyName\"\n                value={formData.companyName}\n                onChange={(e) => setFormData({ ...formData, companyName: e.target.value })}\n                data-testid=\"input-company-name\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Email</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                value={formData.email}\n                onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                data-testid=\"input-email\"\n              />\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"workPhone\">Work Phone</Label>\n                <Input\n                  id=\"workPhone\"\n                  value={formData.workPhone}\n                  onChange={(e) => setFormData({ ...formData, workPhone: e.target.value })}\n                  data-testid=\"input-work-phone\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"mobile\">Mobile</Label>\n                <Input\n                  id=\"mobile\"\n                  value={formData.mobile}\n                  onChange={(e) => setFormData({ ...formData, mobile: e.target.value })}\n                  data-testid=\"input-mobile\"\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <Tabs defaultValue=\"tax\" className=\"w-full mt-8\">\n          <TabsList className=\"w-full justify-start h-auto border-b border-slate-200 bg-transparent p-0 rounded-none space-x-6\">\n            <TabsTrigger value=\"tax\" className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:bg-transparent px-0 py-2\">Tax Details</TabsTrigger>\n            <TabsTrigger value=\"address\" className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:bg-transparent px-0 py-2\">Address</TabsTrigger>\n            <TabsTrigger value=\"contact\" className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:text-blue-700 px-0 py-2\">Contact Persons</TabsTrigger>\n            <TabsTrigger value=\"documents\" className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:text-blue-700 px-0 py-2\">Documents</TabsTrigger>\n          </TabsList>\n\n          <div className=\"mt-6\">\n            <TabsContent value=\"tax\" className=\"space-y-6 max-w-4xl\">\n              <div className=\"space-y-3\">\n                <Label>Tax Preference *</Label>\n                <RadioGroup\n                  value={formData.taxPreference}\n                  onValueChange={(val) => {\n                    const newData = { ...formData, taxPreference: val as \"taxable\" | \"tax_exempt\" };\n                    if (val === \"tax_exempt\") {\n                      newData.gstTreatment = \"\";\n                      newData.gstin = \"\";\n                    } else {\n                      newData.exemptionReason = \"\";\n                    }\n                    setFormData(newData);\n                  }}\n                  className=\"flex flex-row space-x-4\"\n                >\n                  <div className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value=\"taxable\" id=\"taxable\" data-testid=\"radio-taxable\" />\n                    <Label htmlFor=\"taxable\" className=\"font-normal\">Taxable</Label>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value=\"tax_exempt\" id=\"tax_exempt\" data-testid=\"radio-tax-exempt\" />\n                    <Label htmlFor=\"tax_exempt\" className=\"font-normal\">Tax Exempt</Label>\n                  </div>\n                </RadioGroup>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6\">\n                {(formData.taxPreference === \"taxable\" || formData.taxPreference === \"tax_exempt\") && (\n                  <div className=\"flex flex-col space-y-2\">\n                    <Label>GST Treatment<span className=\"text-red-500 ml-0.5\">*</span></Label>\n                    <Popover open={gstTreatmentOpen} onOpenChange={setGstTreatmentOpen}>\n                      <PopoverTrigger asChild>\n                        <Button\n                          variant=\"outline\"\n                          role=\"combobox\"\n                          aria-expanded={gstTreatmentOpen}\n                          className={cn(\n                            \"justify-between\",\n                            !formData.gstTreatment && \"text-muted-foreground\"\n                          )}\n                          data-testid=\"button-gst-treatment\"\n                        >\n                          {formData.gstTreatment ?\n                            GST_TREATMENTS.find(g => g.value === formData.gstTreatment)?.label || formData.gstTreatment :\n                            \"Select a GST treatment\"\n                          }\n                          <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                        </Button>\n                      </PopoverTrigger>\n                      <PopoverContent className=\"w-[400px] p-0\">\n                        <Command>\n                          <CommandInput\n                            placeholder=\"Search GST treatment...\"\n                            value={gstTreatmentSearch}\n                            onValueChange={setGstTreatmentSearch}\n                            data-testid=\"input-gst-treatment-search\"\n                          />\n                          <CommandList className=\"max-h-[300px]\">\n                            <CommandEmpty>No GST treatment found</CommandEmpty>\n                            <CommandGroup>\n                              {GST_TREATMENTS\n                                .filter(treatment =>\n                                  treatment.label.toLowerCase().includes(gstTreatmentSearch.toLowerCase()) ||\n                                  treatment.description.toLowerCase().includes(gstTreatmentSearch.toLowerCase())\n                                )\n                                .map((treatment) => (\n                                  <CommandItem\n                                    key={treatment.value}\n                                    value={treatment.label}\n                                    onSelect={() => {\n                                      setFormData({ ...formData, gstTreatment: treatment.value });\n                                      setGstTreatmentSearch(\"\");\n                                      setGstTreatmentOpen(false);\n                                    }}\n                                    className=\"flex flex-col items-start p-3 cursor-pointer\"\n                                    data-testid={`option-gst-treatment-${treatment.value}`}\n                                  >\n                                    <div className=\"flex items-center w-full\">\n                                      <Check\n                                        className={cn(\n                                          \"mr-2 h-4 w-4\",\n                                          formData.gstTreatment === treatment.value ? \"opacity-100\" : \"opacity-0\"\n                                        )}\n                                      />\n                                      <div className=\"flex-1\">\n                                        <div className=\"font-medium\">{treatment.label}</div>\n                                        <div className=\"text-sm text-slate-500 mt-0.5\">{treatment.description}</div>\n                                      </div>\n                                    </div>\n                                  </CommandItem>\n                                ))}\n                            </CommandGroup>\n                          </CommandList>\n                        </Command>\n                      </PopoverContent>\n                    </Popover>\n                    {formData.gstTreatment && (\n                      <p className=\"text-sm text-muted-foreground mt-1\">\n                        {GST_TREATMENTS.find(g => g.value === formData.gstTreatment)?.description}\n                      </p>\n                    )}\n                  </div>\n                )}\n\n                {formData.taxPreference === \"tax_exempt\" && (\n                  <div className=\"flex flex-col space-y-2\">\n                    <div className=\"flex items-center gap-1\">\n                      <Label>Exemption Reason<span className=\"text-red-500 ml-0.5\">*</span></Label>\n                      <Info className=\"h-3.5 w-3.5 text-slate-400\" />\n                    </div>\n                    <Popover open={exemptionOpen} onOpenChange={setExemptionOpen}>\n                      <PopoverTrigger asChild>\n                        <Button\n                          variant=\"outline\"\n                          role=\"combobox\"\n                          aria-expanded={exemptionOpen}\n                          className={cn(\n                            \"justify-between\",\n                            !formData.exemptionReason && \"text-muted-foreground\"\n                          )}\n                          data-testid=\"button-exemption-reason\"\n                        >\n                          {formData.exemptionReason || \"Select or type to add\"}\n                          <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                        </Button>\n                      </PopoverTrigger>\n                      <PopoverContent className=\"w-[350px] p-0\">\n                        <Command>\n                          <CommandInput\n                            placeholder=\"Search or type...\"\n                            value={exemptionSearch}\n                            onValueChange={setExemptionSearch}\n                            data-testid=\"input-exemption-search\"\n                          />\n                          <CommandList className=\"max-h-[200px]\">\n                            <CommandEmpty>\n                              {exemptionSearch ? (\n                                <div\n                                  className=\"py-2 px-3 cursor-pointer hover:bg-accent rounded-sm\"\n                                  onClick={() => {\n                                    setFormData({ ...formData, exemptionReason: exemptionSearch.trim() });\n                                    setExemptionOpen(false);\n                                    setExemptionSearch(\"\");\n                                  }}\n                                >\n                                  Use \"{exemptionSearch.trim()}\"\n                                </div>\n                              ) : (\n                                \"No exemption reasons found\"\n                              )}\n                            </CommandEmpty>\n                            <CommandGroup>\n                              {EXEMPTION_REASONS\n                                .filter(reason => reason.toLowerCase().includes(exemptionSearch.toLowerCase()))\n                                .map((reason) => (\n                                  <CommandItem\n                                    key={reason}\n                                    value={reason}\n                                    onSelect={() => {\n                                      setFormData({ ...formData, exemptionReason: reason });\n                                      setExemptionSearch(\"\");\n                                      setExemptionOpen(false);\n                                    }}\n                                    data-testid={`option-exemption-${reason.replace(/\\s+/g, '-').toLowerCase()}`}\n                                  >\n                                    <Check\n                                      className={cn(\n                                        \"mr-2 h-4 w-4\",\n                                        formData.exemptionReason === reason ? \"opacity-100\" : \"opacity-0\"\n                                      )}\n                                    />\n                                    {reason}\n                                  </CommandItem>\n                                ))}\n                            </CommandGroup>\n                          </CommandList>\n                        </Command>\n                      </PopoverContent>\n                    </Popover>\n                  </div>\n                )}\n\n                <div className=\"flex flex-col space-y-2\">\n                  <Label>Place of Supply<span className=\"text-red-500 ml-0.5\">*</span></Label>\n                  <Popover open={placeOfSupplyOpen} onOpenChange={setPlaceOfSupplyOpen}>\n                    <PopoverTrigger asChild>\n                      <Button\n                        variant=\"outline\"\n                        role=\"combobox\"\n                        aria-expanded={placeOfSupplyOpen}\n                        className={cn(\n                          \"justify-between\",\n                          !formData.placeOfSupply && \"text-muted-foreground\"\n                        )}\n                        data-testid=\"button-place-of-supply\"\n                      >\n                        {formData.placeOfSupply\n                          ? INDIAN_STATES.find(s => s.code === formData.placeOfSupply)?.name || formData.placeOfSupply\n                          : \"Please select a place of supply\"\n                        }\n                        <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                      </Button>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-[350px] p-0\">\n                      <Command>\n                        <CommandInput\n                          placeholder=\"Search state...\"\n                          value={placeOfSupplySearch}\n                          onValueChange={setPlaceOfSupplySearch}\n                          data-testid=\"input-place-of-supply-search\"\n                        />\n                        <CommandList className=\"max-h-[300px]\">\n                          <CommandEmpty>No state found</CommandEmpty>\n                          <CommandGroup>\n                            {INDIAN_STATES\n                              .filter(state =>\n                                state.name.toLowerCase().includes(placeOfSupplySearch.toLowerCase()) ||\n                                state.code.toLowerCase().includes(placeOfSupplySearch.toLowerCase())\n                              )\n                              .map((state) => (\n                                <CommandItem\n                                  key={state.code}\n                                  value={`${state.code} ${state.name}`}\n                                  onSelect={() => {\n                                    setFormData({ ...formData, placeOfSupply: state.code });\n                                    setPlaceOfSupplySearch(\"\");\n                                    setPlaceOfSupplyOpen(false);\n                                  }}\n                                  data-testid={`option-state-${state.code}`}\n                                >\n                                  <Check\n                                    className={cn(\n                                      \"mr-2 h-4 w-4\",\n                                      formData.placeOfSupply === state.code ? \"opacity-100\" : \"opacity-0\"\n                                    )}\n                                  />\n                                  {state.name}\n                                </CommandItem>\n                              ))}\n                          </CommandGroup>\n                        </CommandList>\n                      </Command>\n                    </PopoverContent>\n                  </Popover>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 md:col-span-2\">\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center gap-1\">\n                      <Label htmlFor=\"pan\">PAN</Label>\n                      <Info className=\"h-3.5 w-3.5 text-slate-400\" />\n                    </div>\n                    <Input\n                      id=\"pan\"\n                      value={formData.pan}\n                      onChange={(e) => {\n                        const value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');\n                        setFormData({ ...formData, pan: value.substring(0, 10) });\n                      }}\n                      maxLength={10}\n                      placeholder=\"e.g., ABCDE1234F\"\n                      data-testid=\"input-pan\"\n                    />\n                    {formData.pan && !validatePAN(formData.pan).valid && (\n                      <p className=\"text-red-500 text-sm mt-1\">{validatePAN(formData.pan).message}</p>\n                    )}\n                  </div>\n\n                  {formData.taxPreference === \"taxable\" && (\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"gstin\">GSTIN</Label>\n                      <Input\n                        id=\"gstin\"\n                        value={formData.gstin}\n                        onChange={(e) => {\n                          const value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');\n                          setFormData({ ...formData, gstin: value.substring(0, 15) });\n                        }}\n                        maxLength={15}\n                        placeholder=\"e.g., 27AAGCA4900Q1ZE\"\n                        data-testid=\"input-gstin\"\n                      />\n                      {formData.gstin && !validateGSTIN(formData.gstin).valid && (\n                        <p className=\"text-red-500 text-sm mt-1\">{validateGSTIN(formData.gstin).message}</p>\n                      )}\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"flex flex-col space-y-2\">\n                  <Label>Currency</Label>\n                  <Popover open={currencyOpen} onOpenChange={setCurrencyOpen}>\n                    <PopoverTrigger asChild>\n                      <Button\n                        variant=\"outline\"\n                        role=\"combobox\"\n                        aria-expanded={currencyOpen}\n                        className={cn(\n                          \"justify-between\",\n                          !formData.currency && \"text-muted-foreground\"\n                        )}\n                        data-testid=\"button-currency\"\n                      >\n                        {formData.currency ?\n                          CURRENCIES.find(c => c.value === formData.currency)?.label || formData.currency :\n                          \"INR - Indian Rupee\"\n                        }\n                        <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                      </Button>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-[300px] p-0\">\n                      <Command>\n                        <CommandInput\n                          placeholder=\"Search currency...\"\n                          value={currencySearch}\n                          onValueChange={setCurrencySearch}\n                          data-testid=\"input-currency-search\"\n                        />\n                        <CommandList className=\"max-h-[200px]\">\n                          <CommandEmpty>No currency found</CommandEmpty>\n                          <CommandGroup>\n                            {CURRENCIES\n                              .filter(currency => currency.label.toLowerCase().includes(currencySearch.toLowerCase()))\n                              .map((currency) => (\n                                <CommandItem\n                                  key={currency.value}\n                                  value={currency.label}\n                                  onSelect={() => {\n                                    setFormData({ ...formData, currency: currency.value });\n                                    setCurrencySearch(\"\");\n                                    setCurrencyOpen(false);\n                                  }}\n                                  data-testid={`option-currency-${currency.value}`}\n                                >\n                                  <Check\n                                    className={cn(\n                                      \"mr-2 h-4 w-4\",\n                                      formData.currency === currency.value ? \"opacity-100\" : \"opacity-0\"\n                                    )}\n                                  />\n                                  {currency.label}\n                                </CommandItem>\n                              ))}\n                          </CommandGroup>\n                        </CommandList>\n                      </Command>\n                    </PopoverContent>\n                  </Popover>\n                </div>\n\n                <div className=\"flex flex-col space-y-2\">\n                  <Label>Payment Terms</Label>\n                  <Popover open={paymentTermsOpen} onOpenChange={setPaymentTermsOpen}>\n                    <PopoverTrigger asChild>\n                      <Button\n                        variant=\"outline\"\n                        role=\"combobox\"\n                        aria-expanded={paymentTermsOpen}\n                        className={cn(\n                          \"justify-between\",\n                          !formData.paymentTerms && \"text-muted-foreground\"\n                        )}\n                        data-testid=\"button-payment-terms\"\n                      >\n                        {formData.paymentTerms ?\n                          PAYMENT_TERMS_OPTIONS.find(p => p.value === formData.paymentTerms)?.label || formData.paymentTerms :\n                          \"Due on Receipt\"\n                        }\n                        <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                      </Button>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-[280px] p-0\">\n                      <Command>\n                        <CommandList>\n                          <CommandGroup>\n                            {PAYMENT_TERMS_OPTIONS.map((term) => (\n                              <CommandItem\n                                key={term.value}\n                                value={term.label}\n                                onSelect={() => {\n                                  setFormData({ ...formData, paymentTerms: term.value });\n                                  setPaymentTermsOpen(false);\n                                }}\n                                data-testid={`option-payment-terms-${term.value}`}\n                              >\n                                <Check\n                                  className={cn(\n                                    \"mr-2 h-4 w-4\",\n                                    formData.paymentTerms === term.value ? \"opacity-100\" : \"opacity-0\"\n                                  )}\n                                />\n                                {term.label}\n                              </CommandItem>\n                            ))}\n                          </CommandGroup>\n                        </CommandList>\n                      </Command>\n                    </PopoverContent>\n                  </Popover>\n                </div>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"address\" className=\"space-y-6 max-w-4xl\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                <div className=\"space-y-4\">\n                  <h3 className=\"font-medium text-slate-900\">Billing Address</h3>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"billingStreet\">Street</Label>\n                    <Textarea\n                      id=\"billingStreet\"\n                      value={formData.billingStreet}\n                      onChange={(e) => setFormData({ ...formData, billingStreet: e.target.value })}\n                      data-testid=\"input-billing-street\"\n                    />\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"billingCity\">City</Label>\n                      <Input\n                        id=\"billingCity\"\n                        value={formData.billingCity}\n                        onChange={(e) => setFormData({ ...formData, billingCity: e.target.value })}\n                        data-testid=\"input-billing-city\"\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"billingState\">State</Label>\n                      <Input\n                        id=\"billingState\"\n                        value={formData.billingState}\n                        onChange={(e) => setFormData({ ...formData, billingState: e.target.value })}\n                        data-testid=\"input-billing-state\"\n                      />\n                    </div>\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"billingPincode\">Pincode</Label>\n                      <Input\n                        id=\"billingPincode\"\n                        value={formData.billingPincode}\n                        onChange={(e) => setFormData({ ...formData, billingPincode: e.target.value })}\n                        data-testid=\"input-billing-pincode\"\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"billingCountry\">Country</Label>\n                      <Input\n                        id=\"billingCountry\"\n                        value={formData.billingCountry}\n                        onChange={(e) => setFormData({ ...formData, billingCountry: e.target.value })}\n                        data-testid=\"input-billing-country\"\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"space-y-4\">\n                  <h3 className=\"font-medium text-slate-900\">Shipping Address</h3>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"shippingStreet\">Street</Label>\n                    <Textarea\n                      id=\"shippingStreet\"\n                      value={formData.shippingStreet}\n                      onChange={(e) => setFormData({ ...formData, shippingStreet: e.target.value })}\n                      data-testid=\"input-shipping-street\"\n                    />\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"shippingCity\">City</Label>\n                      <Input\n                        id=\"shippingCity\"\n                        value={formData.shippingCity}\n                        onChange={(e) => setFormData({ ...formData, shippingCity: e.target.value })}\n                        data-testid=\"input-shipping-city\"\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"shippingState\">State</Label>\n                      <Input\n                        id=\"shippingState\"\n                        value={formData.shippingState}\n                        onChange={(e) => setFormData({ ...formData, shippingState: e.target.value })}\n                        data-testid=\"input-shipping-state\"\n                      />\n                    </div>\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"shippingPincode\">Pincode</Label>\n                      <Input\n                        id=\"shippingPincode\"\n                        value={formData.shippingPincode}\n                        onChange={(e) => setFormData({ ...formData, shippingPincode: e.target.value })}\n                        data-testid=\"input-shipping-pincode\"\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"shippingCountry\">Country</Label>\n                      <Input\n                        id=\"shippingCountry\"\n                        value={formData.shippingCountry}\n                        onChange={(e) => setFormData({ ...formData, shippingCountry: e.target.value })}\n                        data-testid=\"input-shipping-country\"\n                      />\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"contact\">\n              <Card>\n                <CardContent className=\"p-0\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Salutation</TableHead>\n                        <TableHead>First Name</TableHead>\n                        <TableHead>Last Name</TableHead>\n                        <TableHead>Email Address</TableHead>\n                        <TableHead>Work Phone</TableHead>\n                        <TableHead>Mobile</TableHead>\n                        <TableHead className=\"w-10\"></TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {contactPersons.map((person, index) => (\n                        <TableRow key={index}>\n                          <TableCell>\n                            <Input\n                              value={person.salutation}\n                              onChange={(e) => {\n                                const updated = [...contactPersons];\n                                updated[index].salutation = e.target.value;\n                                setContactPersons(updated);\n                              }}\n                              className=\"h-8\"\n                              placeholder=\"Mr.\"\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <Input\n                              value={person.firstName}\n                              onChange={(e) => {\n                                const updated = [...contactPersons];\n                                updated[index].firstName = e.target.value;\n                                setContactPersons(updated);\n                              }}\n                              className=\"h-8\"\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <Input\n                              value={person.lastName}\n                              onChange={(e) => {\n                                const updated = [...contactPersons];\n                                updated[index].lastName = e.target.value;\n                                setContactPersons(updated);\n                              }}\n                              className=\"h-8\"\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <Input\n                              value={person.email}\n                              onChange={(e) => {\n                                const updated = [...contactPersons];\n                                updated[index].email = e.target.value;\n                                setContactPersons(updated);\n                              }}\n                              className=\"h-8\"\n                              type=\"email\"\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <Input\n                              value={person.workPhone}\n                              onChange={(e) => {\n                                const updated = [...contactPersons];\n                                updated[index].workPhone = e.target.value;\n                                setContactPersons(updated);\n                              }}\n                              className=\"h-8\"\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <Input\n                              value={person.mobile}\n                              onChange={(e) => {\n                                const updated = [...contactPersons];\n                                updated[index].mobile = e.target.value;\n                                setContactPersons(updated);\n                              }}\n                              className=\"h-8\"\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              type=\"button\"\n                              onClick={() => {\n                                const updated = contactPersons.filter((_, i) => i !== index);\n                                setContactPersons(updated);\n                              }}\n                            >\n                              <X className=\"h-4 w-4 text-slate-400 hover:text-red-500\" />\n                            </Button>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                      {contactPersons.length === 0 && (\n                        <TableRow>\n                          <TableCell colSpan={7} className=\"text-center py-8 text-slate-500\">\n                            No contact persons added.\n                          </TableCell>\n                        </TableRow>\n                      )}\n                    </TableBody>\n                  </Table>\n                </CardContent>\n              </Card>\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                className=\"mt-4\"\n                onClick={() => {\n                  setContactPersons([\n                    ...contactPersons,\n                    { salutation: \"\", firstName: \"\", lastName: \"\", email: \"\", workPhone: \"\", mobile: \"\" }\n                  ]);\n                }}\n              >\n                <Plus className=\"h-4 w-4 mr-2\" /> Add Contact Person\n              </Button>\n            </TabsContent>\n\n            <TabsContent value=\"documents\" className=\"space-y-6 max-w-4xl\">\n              <div>\n                <Label className=\"mb-2 block\">Documents</Label>\n                <input\n                  type=\"file\"\n                  ref={fileInputRef}\n                  onChange={handleFileUpload}\n                  multiple\n                  className=\"hidden\"\n                  accept=\".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg,.gif\"\n                  data-testid=\"input-file-upload\"\n                />\n                <div\n                  className=\"border-2 border-dashed border-slate-200 rounded-lg p-8 text-center hover:bg-slate-50 transition-colors cursor-pointer\"\n                  onClick={() => fileInputRef.current?.click()}\n                  data-testid=\"button-upload-area\"\n                >\n                  <div className=\"flex flex-col items-center gap-2\">\n                    <div className=\"bg-blue-50 p-3 rounded-full\">\n                      <Upload className=\"h-5 w-5 text-blue-600\" />\n                    </div>\n                    <div className=\"text-sm text-slate-600\">\n                      <span className=\"text-blue-600 font-medium\">Upload files</span> or drag and drop\n                    </div>\n                    <p className=\"text-xs text-slate-400\">Up to 10 files (max 10MB each)</p>\n                  </div>\n                </div>\n\n                {documents.length > 0 && (\n                  <div className=\"mt-4 space-y-2\" data-testid=\"list-uploaded-files\">\n                    {documents.map((file) => (\n                      <div\n                        key={file.id}\n                        className=\"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-200\"\n                        data-testid={`file-item-${file.id}`}\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <FileText className=\"h-5 w-5 text-slate-400\" />\n                          <div>\n                            <p className=\"text-sm font-medium text-slate-700\" data-testid={`text-filename-${file.id}`}>{file.name}</p>\n                            <p className=\"text-xs text-slate-400\">{formatFileSize(file.size)}</p>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          {file.data && (\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => window.open(file.data, '_blank')}\n                              data-testid={`button-view-file-${file.id}`}\n                            >\n                              View\n                            </Button>\n                          )}\n                          <Button\n                            type=\"button\"\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => removeFile(file.id)}\n                            data-testid={`button-remove-file-${file.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4 text-slate-400\" />\n                          </Button>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n            </TabsContent>\n          </div>\n        </Tabs>\n\n        <div className=\"flex items-center gap-4 pt-6 border-t border-slate-200\">\n          <Button type=\"submit\" disabled={isSubmitting} data-testid=\"button-save-customer\">\n            {isSubmitting ? \"Saving...\" : \"Save\"}\n          </Button>\n          <Button type=\"button\" variant=\"outline\" onClick={() => setLocation(\"/customers\")} data-testid=\"button-cancel\">\n            Cancel\n          </Button>\n        </div>\n      </form>\n    </div>\n  );\n}\n","path":null,"size_bytes":55892,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-3.5 w-3.5 fill-primary\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1410,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"server/src/modules/reports/routes/index.ts":{"content":"import { Router } from 'express';\n\nexport const reportsRouter = Router();\n\nreportsRouter.get('/', (req, res) => {\n  res.json({ success: true, data: [], message: 'Reports endpoint' });\n});\n\nreportsRouter.get('/profit-loss', (req, res) => {\n  res.json({ success: true, data: {}, message: 'Profit & Loss report endpoint' });\n});\n\nreportsRouter.get('/balance-sheet', (req, res) => {\n  res.json({ success: true, data: {}, message: 'Balance Sheet report endpoint' });\n});\n\nreportsRouter.get('/cash-flow', (req, res) => {\n  res.json({ success: true, data: {}, message: 'Cash Flow report endpoint' });\n});\n\nexport default reportsRouter;\n","path":null,"size_bytes":629,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"@neondatabase/serverless\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1439,"size_tokens":null},"client/src/shared/utils/formatters.ts":{"content":"import { format, parseISO } from 'date-fns';\nimport { config } from '@/config';\n\nexport const formatCurrency = (\n  amount: number,\n  currency = config.currency.code,\n  locale = config.currency.locale\n): string => {\n  return new Intl.NumberFormat(locale, {\n    style: 'currency',\n    currency,\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n  }).format(amount);\n};\n\nexport const formatDate = (date: string | Date, formatStr = 'dd MMM yyyy'): string => {\n  const parsedDate = typeof date === 'string' ? parseISO(date) : date;\n  return format(parsedDate, formatStr);\n};\n\nexport const formatDateTime = (date: string | Date): string => {\n  return formatDate(date, 'dd MMM yyyy, hh:mm a');\n};\n\nexport const formatNumber = (num: number, locale = 'en-IN'): string => {\n  return new Intl.NumberFormat(locale).format(num);\n};\n\nexport const formatPercentage = (value: number, decimals = 2): string => {\n  return `${value.toFixed(decimals)}%`;\n};\n\nexport const formatPhoneNumber = (phone: string): string => {\n  const cleaned = phone.replace(/\\D/g, '');\n  if (cleaned.length === 10) {\n    return `${cleaned.slice(0, 5)} ${cleaned.slice(5)}`;\n  }\n  return phone;\n};\n\nexport const truncateText = (text: string, maxLength: number): string => {\n  if (text.length <= maxLength) return text;\n  return `${text.slice(0, maxLength)}...`;\n};\n\nexport const capitalizeFirst = (str: string): string => {\n  return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();\n};\n\nexport const toTitleCase = (str: string): string => {\n  return str\n    .split(' ')\n    .map(word => capitalizeFirst(word))\n    .join(' ');\n};\n","path":null,"size_bytes":1605,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"server/src/modules/purchases/routes/index.ts":{"content":"import { Router } from 'express';\n\nexport const purchasesRouter = Router();\n\npurchasesRouter.get('/orders', (req, res) => {\n  res.json({ success: true, data: [], message: 'Purchase orders endpoint' });\n});\n\npurchasesRouter.get('/bills', (req, res) => {\n  res.json({ success: true, data: [], message: 'Bills endpoint' });\n});\n\npurchasesRouter.get('/vendor-credits', (req, res) => {\n  res.json({ success: true, data: [], message: 'Vendor credits endpoint' });\n});\n\nexport default purchasesRouter;\n","path":null,"size_bytes":495,"size_tokens":null},"client/src/pages/sales-orders.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport {\n  Plus,\n  Search,\n  Filter,\n  MoreHorizontal,\n  Pencil,\n  Trash2,\n  ChevronDown,\n  X,\n  Send,\n  FileText,\n  Receipt,\n  Package,\n  Truck,\n  CreditCard,\n  Calendar,\n  MapPin,\n  Building2,\n  CheckCircle,\n  Clock,\n  AlertCircle,\n  ChevronLeft,\n  ChevronRight,\n  Printer\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { usePagination } from \"@/hooks/use-pagination\";\nimport { TablePagination } from \"@/components/table-pagination\";\n\ninterface SalesOrderListItem {\n  id: string;\n  date: string;\n  salesOrderNumber: string;\n  referenceNumber: string;\n  customerName: string;\n  orderStatus: string;\n  invoiceStatus: string;\n  paymentStatus: string;\n  total: number;\n  expectedShipmentDate: string;\n}\n\ninterface SalesOrderItem {\n  id: string;\n  itemId: string;\n  name: string;\n  description: string;\n  hsnSac: string;\n  quantity: number;\n  unit: string;\n  rate: number;\n  discount: number;\n  discountType: string;\n  tax: number;\n  taxName: string;\n  amount: number;\n  ordered: number;\n  invoicedQty: number;\n  invoiceStatus: string;\n}\n\ninterface SalesOrderInvoice {\n  id: string;\n  invoiceNumber: string;\n  date: string;\n  dueDate: string;\n  status: string;\n  amount: number;\n  balanceDue: number;\n}\n\ninterface SalesOrderDetail {\n  id: string;\n  salesOrderNumber: string;\n  referenceNumber: string;\n  date: string;\n  expectedShipmentDate: string;\n  customerId: string;\n  customerName: string;\n  billingAddress: {\n    street: string;\n    city: string;\n    state: string;\n    country: string;\n    pincode: string;\n  };\n  shippingAddress: {\n    street: string;\n    city: string;\n    state: string;\n    country: string;\n    pincode: string;\n  };\n  paymentTerms: string;\n  deliveryMethod: string;\n  salesperson: string;\n  placeOfSupply: string;\n  items: SalesOrderItem[];\n  subTotal: number;\n  shippingCharges: number;\n  cgst: number;\n  sgst: number;\n  igst: number;\n  adjustment: number;\n  total: number;\n  customerNotes: string;\n  termsAndConditions: string;\n  orderStatus: string;\n  invoiceStatus: string;\n  paymentStatus: string;\n  shipmentStatus: string;\n  invoices?: SalesOrderInvoice[];\n  createdAt?: string;\n  createdBy?: string;\n}\n\nconst formatCurrency = (amount: number) => {\n  return `${amount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n};\n\nconst formatDate = (dateString: string) => {\n  if (!dateString) return '-';\n  const date = new Date(dateString);\n  return date.toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: 'numeric' });\n};\n\nconst formatAddress = (address: any) => {\n  if (!address) return ['-'];\n  const parts = [address.street, address.city, address.state, address.country, address.pincode].filter(Boolean);\n  return parts.length > 0 ? parts : ['-'];\n};\n\nconst getStatusBadgeStyles = (status: string) => {\n  const statusLower = status?.toLowerCase() || '';\n  if (statusLower === 'confirmed' || statusLower === 'closed' || statusLower === 'invoiced' || statusLower === 'paid' || statusLower === 'shipped' || statusLower === 'delivered') {\n    return 'bg-green-100 text-green-700 border-green-200';\n  }\n  if (statusLower === 'draft' || statusLower === 'pending' || statusLower === 'not invoiced' || statusLower === 'unpaid') {\n    return 'bg-amber-100 text-amber-700 border-amber-200';\n  }\n  if (statusLower === 'cancelled' || statusLower === 'void') {\n    return 'bg-red-100 text-red-700 border-red-200';\n  }\n  return 'bg-slate-100 text-slate-600 border-slate-200';\n};\n\ninterface SalesOrderDetailPanelProps {\n  order: SalesOrderDetail;\n  onClose: () => void;\n  onEdit: () => void;\n  onDelete: () => void;\n  onConvertToInvoice: () => void;\n  onConvertSelectedItems: () => void;\n}\n\nfunction SalesOrderPdfPreview({ order }: { order: SalesOrderDetail }) {\n  return (\n    <div id=\"pdf-content\" className=\"bg-white p-8 text-black min-h-full\" style={{ fontFamily: 'Arial, sans-serif' }}>\n      <div className=\"max-w-3xl mx-auto\">\n        <div className=\"flex justify-between items-start mb-8 border-b-2 border-blue-600 pb-4\">\n          <div>\n            <h1 className=\"text-2xl font-bold text-blue-600\">SALES ORDER</h1>\n            <p className=\"text-sm text-gray-600 mt-1\">{order.salesOrderNumber}</p>\n          </div>\n          <div className=\"text-right\">\n            <p className=\"font-semibold text-lg\">Your Company Name</p>\n            <p className=\"text-sm text-gray-600\">123 Business Street</p>\n            <p className=\"text-sm text-gray-600\">Mumbai, Maharashtra 400001</p>\n            <p className=\"text-sm text-gray-600\">GSTIN: 27XXXXX1234X1ZX</p>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-8 mb-8\">\n          <div>\n            <h3 className=\"text-sm font-semibold text-gray-500 uppercase mb-2\">Bill To</h3>\n            <p className=\"font-semibold\">{order.customerName}</p>\n            <div className=\"text-sm text-gray-600\">\n              {formatAddress(order.billingAddress).map((line, i) => (\n                <p key={i}>{line}</p>\n              ))}\n            </div>\n          </div>\n          <div>\n            <h3 className=\"text-sm font-semibold text-gray-500 uppercase mb-2\">Ship To</h3>\n            <p className=\"font-semibold\">{order.customerName}</p>\n            <div className=\"text-sm text-gray-600\">\n              {formatAddress(order.shippingAddress).map((line, i) => (\n                <p key={i}>{line}</p>\n              ))}\n            </div>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-4 gap-4 mb-8 bg-gray-50 p-4 rounded-md\">\n          <div>\n            <p className=\"text-xs text-gray-500 uppercase\">Order Date</p>\n            <p className=\"font-medium\">{formatDate(order.date)}</p>\n          </div>\n          <div>\n            <p className=\"text-xs text-gray-500 uppercase\">Expected Shipment</p>\n            <p className=\"font-medium\">{formatDate(order.expectedShipmentDate)}</p>\n          </div>\n          <div>\n            <p className=\"text-xs text-gray-500 uppercase\">Payment Terms</p>\n            <p className=\"font-medium\">{order.paymentTerms}</p>\n          </div>\n          <div>\n            <p className=\"text-xs text-gray-500 uppercase\">Place of Supply</p>\n            <p className=\"font-medium\">{order.placeOfSupply || '-'}</p>\n          </div>\n        </div>\n\n        <table className=\"w-full mb-8 text-sm\">\n          <thead>\n            <tr className=\"bg-gray-100\">\n              <th className=\"px-3 py-2 text-left font-semibold\">#</th>\n              <th className=\"px-3 py-2 text-left font-semibold\">Item & Description</th>\n              <th className=\"px-3 py-2 text-left font-semibold\">HSN/SAC</th>\n              <th className=\"px-3 py-2 text-right font-semibold\">Qty</th>\n              <th className=\"px-3 py-2 text-right font-semibold\">Rate</th>\n              <th className=\"px-3 py-2 text-right font-semibold\">Tax</th>\n              <th className=\"px-3 py-2 text-right font-semibold\">Amount</th>\n            </tr>\n          </thead>\n          <tbody>\n            {order.items.map((item, index) => (\n              <tr key={item.id} className=\"border-b border-gray-200\">\n                <td className=\"px-3 py-2\">{index + 1}</td>\n                <td className=\"px-3 py-2\">\n                  <p className=\"font-medium\">{item.name}</p>\n                  {item.description && <p className=\"text-gray-600 text-xs\">{item.description}</p>}\n                </td>\n                <td className=\"px-3 py-2\">{item.hsnSac || '-'}</td>\n                <td className=\"px-3 py-2 text-right\">{item.ordered} {item.unit}</td>\n                <td className=\"px-3 py-2 text-right\">{formatCurrency(item.rate)}</td>\n                <td className=\"px-3 py-2 text-right\">{item.taxName || `${item.tax}%`}</td>\n                <td className=\"px-3 py-2 text-right font-medium\">{formatCurrency(item.amount)}</td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n\n        <div className=\"flex justify-end mb-8\">\n          <div className=\"w-72\">\n            <div className=\"flex justify-between py-2 border-b border-gray-200\">\n              <span className=\"text-gray-600\">Sub Total</span>\n              <span className=\"font-medium\">{formatCurrency(order.subTotal)}</span>\n            </div>\n            {order.shippingCharges > 0 && (\n              <div className=\"flex justify-between py-2 border-b border-gray-200\">\n                <span className=\"text-gray-600\">Shipping Charges</span>\n                <span className=\"font-medium\">{formatCurrency(order.shippingCharges)}</span>\n              </div>\n            )}\n            {order.cgst > 0 && (\n              <div className=\"flex justify-between py-2 border-b border-gray-200\">\n                <span className=\"text-gray-600\">CGST</span>\n                <span className=\"font-medium\">{formatCurrency(order.cgst)}</span>\n              </div>\n            )}\n            {order.sgst > 0 && (\n              <div className=\"flex justify-between py-2 border-b border-gray-200\">\n                <span className=\"text-gray-600\">SGST</span>\n                <span className=\"font-medium\">{formatCurrency(order.sgst)}</span>\n              </div>\n            )}\n            {order.igst > 0 && (\n              <div className=\"flex justify-between py-2 border-b border-gray-200\">\n                <span className=\"text-gray-600\">IGST</span>\n                <span className=\"font-medium\">{formatCurrency(order.igst)}</span>\n              </div>\n            )}\n            <div className=\"flex justify-between py-3 text-lg font-bold bg-blue-50 px-3 rounded-md mt-2\">\n              <span>Total</span>\n              <span>{formatCurrency(order.total)}</span>\n            </div>\n          </div>\n        </div>\n\n        {order.customerNotes && (\n          <div className=\"mb-6\">\n            <h3 className=\"text-sm font-semibold text-gray-500 uppercase mb-2\">Customer Notes</h3>\n            <p className=\"text-sm text-gray-600\">{order.customerNotes}</p>\n          </div>\n        )}\n\n        {order.termsAndConditions && (\n          <div className=\"mb-6\">\n            <h3 className=\"text-sm font-semibold text-gray-500 uppercase mb-2\">Terms & Conditions</h3>\n            <p className=\"text-sm text-gray-600\">{order.termsAndConditions}</p>\n          </div>\n        )}\n\n        <div className=\"mt-12 pt-8 border-t border-gray-300 text-center text-sm text-gray-500\">\n          <p>Thank you for your business!</p>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction SalesOrderDetailPanel({ order, onClose, onEdit, onDelete, onConvertToInvoice, onConvertSelectedItems }: SalesOrderDetailPanelProps) {\n  const [activeTab, setActiveTab] = useState(\"details\");\n  const [showPdfPreview, setShowPdfPreview] = useState(false);\n\n  const handlePrint = () => {\n    const printContent = document.getElementById('pdf-content');\n    if (printContent) {\n      const printWindow = window.open('', '_blank');\n      if (printWindow) {\n        printWindow.document.write(`\n          <html>\n            <head>\n              <title>${order.salesOrderNumber} - Sales Order</title>\n              <style>\n                body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }\n                table { width: 100%; border-collapse: collapse; }\n                th, td { padding: 8px 12px; text-align: left; }\n                th { background-color: #f3f4f6; }\n                .text-right { text-align: right; }\n                .font-medium { font-weight: 500; }\n                .font-semibold { font-weight: 600; }\n                .font-bold { font-weight: 700; }\n                .text-sm { font-size: 14px; }\n                .text-xs { font-size: 12px; }\n                .text-lg { font-size: 18px; }\n                .text-2xl { font-size: 24px; }\n                .text-gray-500 { color: #6b7280; }\n                .text-gray-600 { color: #4b5563; }\n                .text-blue-600 { color: #2563eb; }\n                .mb-2 { margin-bottom: 8px; }\n                .mb-6 { margin-bottom: 24px; }\n                .mb-8 { margin-bottom: 32px; }\n                .mt-2 { margin-top: 8px; }\n                .mt-12 { margin-top: 48px; }\n                .pt-8 { padding-top: 32px; }\n                .py-2 { padding-top: 8px; padding-bottom: 8px; }\n                .py-3 { padding-top: 12px; padding-bottom: 12px; }\n                .px-3 { padding-left: 12px; padding-right: 12px; }\n                .p-4 { padding: 16px; }\n                .rounded-md { border-radius: 6px; }\n                .border-b { border-bottom: 1px solid #e5e7eb; }\n                .border-b-2 { border-bottom: 2px solid #2563eb; }\n                .border-t { border-top: 1px solid #d1d5db; }\n                .bg-gray-50 { background-color: #f9fafb; }\n                .bg-gray-100 { background-color: #f3f4f6; }\n                .bg-blue-50 { background-color: #eff6ff; }\n                .grid { display: grid; }\n                .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }\n                .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }\n                .gap-4 { gap: 16px; }\n                .gap-8 { gap: 32px; }\n                .flex { display: flex; }\n                .justify-between { justify-content: space-between; }\n                .justify-end { justify-content: flex-end; }\n                .items-start { align-items: flex-start; }\n                .text-center { text-align: center; }\n                .uppercase { text-transform: uppercase; }\n                .w-72 { width: 288px; }\n                .max-w-3xl { max-width: 768px; margin: 0 auto; }\n                @media print {\n                  body { padding: 0; }\n                }\n              </style>\n            </head>\n            <body>\n              ${printContent.innerHTML}\n            </body>\n          </html>\n        `);\n        printWindow.document.close();\n        printWindow.print();\n      }\n    } else {\n      setShowPdfPreview(true);\n      setTimeout(() => {\n        handlePrint();\n      }, 100);\n    }\n  };\n\n  return (\n    <div className=\"h-full flex flex-col bg-white dark:bg-slate-900 border-l border-slate-200 dark:border-slate-700\">\n      <div className=\"flex items-center justify-between px-6 py-4 border-b border-slate-200 dark:border-slate-700\">\n        <div>\n          <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white\" data-testid=\"text-order-number\">{order.salesOrderNumber}</h2>\n          <p className=\"text-sm text-slate-500\">{order.customerName}</p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button\n            variant={showPdfPreview ? \"default\" : \"ghost\"}\n            size=\"icon\"\n            onClick={() => setShowPdfPreview(!showPdfPreview)}\n            data-testid=\"button-pdf-view\"\n          >\n            <FileText className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" onClick={onClose} data-testid=\"button-close-panel\">\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"flex items-center gap-2 px-6 py-3 border-b border-slate-200 dark:border-slate-700 overflow-x-auto flex-wrap\">\n        <Button variant=\"ghost\" size=\"sm\" className=\"gap-1.5\" onClick={onEdit} data-testid=\"button-edit-order\">\n          <Pencil className=\"h-3.5 w-3.5\" />\n          Edit\n        </Button>\n        <Button variant=\"ghost\" size=\"sm\" className=\"gap-1.5\" data-testid=\"button-send-email\">\n          <Send className=\"h-3.5 w-3.5\" />\n          Send Email\n        </Button>\n        <Button variant=\"ghost\" size=\"sm\" className=\"gap-1.5\" onClick={handlePrint} data-testid=\"button-print\">\n          <Printer className=\"h-3.5 w-3.5\" />\n          PDF/Print\n        </Button>\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" size=\"sm\" className=\"gap-1.5\" data-testid=\"button-convert-invoice\">\n              <Receipt className=\"h-3.5 w-3.5\" />\n              Convert to Invoice\n              <ChevronDown className=\"h-3 w-3\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"start\" className=\"w-56\">\n            <DropdownMenuItem onClick={onConvertToInvoice} data-testid=\"menu-item-invoice-all\">\n              <Receipt className=\"mr-2 h-4 w-4\" /> Invoice All Items\n            </DropdownMenuItem>\n            <DropdownMenuItem onClick={onConvertSelectedItems} data-testid=\"menu-item-invoice-selected\">\n              <Package className=\"mr-2 h-4 w-4\" /> Invoice Selected Items\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-more-options\">\n              <MoreHorizontal className=\"h-4 w-4\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\" className=\"w-48\">\n            <DropdownMenuItem data-testid=\"menu-item-clone\">\n              <FileText className=\"mr-2 h-4 w-4\" /> Clone\n            </DropdownMenuItem>\n            <DropdownMenuSeparator />\n            <DropdownMenuItem onClick={onDelete} className=\"text-destructive focus:text-destructive\" data-testid=\"menu-item-delete\">\n              <Trash2 className=\"mr-2 h-4 w-4\" /> Delete\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n      </div>\n\n      {showPdfPreview ? (\n        <div className=\"flex-1 overflow-auto bg-slate-100 dark:bg-slate-800\">\n          <SalesOrderPdfPreview order={order} />\n        </div>\n      ) : (\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"flex-1 flex flex-col overflow-hidden\">\n          <div className=\"flex items-center px-6 border-b border-slate-200 dark:border-slate-700\">\n            <TabsList className=\"h-auto p-0 bg-transparent\">\n              <TabsTrigger\n                value=\"details\"\n                className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n                data-testid=\"tab-details\"\n              >\n                Order Details\n              </TabsTrigger>\n              <TabsTrigger\n                value=\"invoices\"\n                className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n                data-testid=\"tab-invoices\"\n              >\n                Invoices ({order.invoices?.length || 0})\n              </TabsTrigger>\n            </TabsList>\n          </div>\n\n          <TabsContent value=\"details\" className=\"flex-1 overflow-auto p-6 mt-0\">\n            <div className=\"space-y-6\">\n              <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4\">\n                <div className=\"bg-slate-50 dark:bg-slate-800 rounded-md p-4\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <Package className=\"h-4 w-4 text-slate-500\" />\n                    <span className=\"text-xs text-slate-500 uppercase\">Order Status</span>\n                  </div>\n                  <Badge className={getStatusBadgeStyles(order.orderStatus)}>\n                    {order.orderStatus}\n                  </Badge>\n                </div>\n                <div className=\"bg-slate-50 dark:bg-slate-800 rounded-md p-4\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <Receipt className=\"h-4 w-4 text-slate-500\" />\n                    <span className=\"text-xs text-slate-500 uppercase\">Invoice Status</span>\n                  </div>\n                  <Badge className={getStatusBadgeStyles(order.invoiceStatus)}>\n                    {order.invoiceStatus}\n                  </Badge>\n                </div>\n                <div className=\"bg-slate-50 dark:bg-slate-800 rounded-md p-4\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <CreditCard className=\"h-4 w-4 text-slate-500\" />\n                    <span className=\"text-xs text-slate-500 uppercase\">Payment Status</span>\n                  </div>\n                  <Badge className={getStatusBadgeStyles(order.paymentStatus)}>\n                    {order.paymentStatus}\n                  </Badge>\n                </div>\n                <div className=\"bg-slate-50 dark:bg-slate-800 rounded-md p-4\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <Truck className=\"h-4 w-4 text-slate-500\" />\n                    <span className=\"text-xs text-slate-500 uppercase\">Shipment</span>\n                  </div>\n                  <Badge className={getStatusBadgeStyles(order.shipmentStatus)}>\n                    {order.shipmentStatus}\n                  </Badge>\n                </div>\n              </div>\n\n              <div className=\"border-t border-slate-200 dark:border-slate-700 pt-6\">\n                <div className=\"grid grid-cols-2 gap-8\">\n                  <div>\n                    <h4 className=\"text-sm font-medium text-slate-900 dark:text-white mb-3 flex items-center gap-2\">\n                      <MapPin className=\"h-4 w-4 text-slate-500\" /> Billing Address\n                    </h4>\n                    <div className=\"text-sm text-slate-600 dark:text-slate-400\">\n                      {formatAddress(order.billingAddress).map((line, i) => (\n                        <p key={i}>{line}</p>\n                      ))}\n                    </div>\n                  </div>\n                  <div>\n                    <h4 className=\"text-sm font-medium text-slate-900 dark:text-white mb-3 flex items-center gap-2\">\n                      <Truck className=\"h-4 w-4 text-slate-500\" /> Shipping Address\n                    </h4>\n                    <div className=\"text-sm text-slate-600 dark:text-slate-400\">\n                      {formatAddress(order.shippingAddress).map((line, i) => (\n                        <p key={i}>{line}</p>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"border-t border-slate-200 dark:border-slate-700 pt-6\">\n                <h4 className=\"text-sm font-medium text-slate-900 dark:text-white mb-4\">Items</h4>\n                <div className=\"border border-slate-200 dark:border-slate-700 rounded-md overflow-hidden\">\n                  <table className=\"w-full text-sm\">\n                    <thead className=\"bg-slate-50 dark:bg-slate-800\">\n                      <tr>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Items & Description</th>\n                        <th className=\"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase\">Ordered</th>\n                        <th className=\"px-4 py-3 text-center text-xs font-medium text-slate-500 uppercase\">Status</th>\n                        <th className=\"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase\">Rate</th>\n                        <th className=\"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase\">Discount</th>\n                        <th className=\"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase\">Amount</th>\n                      </tr>\n                    </thead>\n                    <tbody className=\"divide-y divide-slate-200 dark:divide-slate-700\">\n                      {order.items.map((item) => (\n                        <tr key={item.id} data-testid={`row-item-${item.id}`}>\n                          <td className=\"px-4 py-3\">\n                            <div className=\"font-medium text-slate-900 dark:text-white\">{item.name}</div>\n                            {item.description && <div className=\"text-xs text-slate-500\">{item.description}</div>}\n                            {item.hsnSac && <div className=\"text-xs text-slate-400\">HSN/SAC: {item.hsnSac}</div>}\n                          </td>\n                          <td className=\"px-4 py-3 text-right text-slate-600 dark:text-slate-400\">{item.ordered} {item.unit}</td>\n                          <td className=\"px-4 py-3 text-center\">\n                            <Badge variant=\"outline\" className={getStatusBadgeStyles(item.invoiceStatus)}>\n                              {item.invoiceStatus}\n                            </Badge>\n                          </td>\n                          <td className=\"px-4 py-3 text-right text-slate-600 dark:text-slate-400\">{formatCurrency(item.rate)}</td>\n                          <td className=\"px-4 py-3 text-right text-slate-600 dark:text-slate-400\">\n                            {item.discount > 0 ? (item.discountType === 'percentage' ? `${item.discount}%` : formatCurrency(item.discount)) : '-'}\n                          </td>\n                          <td className=\"px-4 py-3 text-right font-medium text-slate-900 dark:text-white\">{formatCurrency(item.amount)}</td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n\n              <div className=\"border-t border-slate-200 dark:border-slate-700 pt-6\">\n                <div className=\"flex justify-end\">\n                  <div className=\"w-72 space-y-2\">\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-slate-500\">Sub Total</span>\n                      <span className=\"text-slate-900 dark:text-white\">{formatCurrency(order.subTotal)}</span>\n                    </div>\n                    {order.shippingCharges > 0 && (\n                      <div className=\"flex justify-between text-sm\">\n                        <span className=\"text-slate-500\">Shipping Charges</span>\n                        <span className=\"text-slate-900 dark:text-white\">{formatCurrency(order.shippingCharges)}</span>\n                      </div>\n                    )}\n                    {order.cgst > 0 && (\n                      <div className=\"flex justify-between text-sm\">\n                        <span className=\"text-slate-500\">CGST (9%)</span>\n                        <span className=\"text-slate-900 dark:text-white\">{formatCurrency(order.cgst)}</span>\n                      </div>\n                    )}\n                    {order.sgst > 0 && (\n                      <div className=\"flex justify-between text-sm\">\n                        <span className=\"text-slate-500\">SGST (9%)</span>\n                        <span className=\"text-slate-900 dark:text-white\">{formatCurrency(order.sgst)}</span>\n                      </div>\n                    )}\n                    {order.igst > 0 && (\n                      <div className=\"flex justify-between text-sm\">\n                        <span className=\"text-slate-500\">IGST (18%)</span>\n                        <span className=\"text-slate-900 dark:text-white\">{formatCurrency(order.igst)}</span>\n                      </div>\n                    )}\n                    <div className=\"flex justify-between text-sm font-semibold pt-2 border-t border-slate-200 dark:border-slate-700\">\n                      <span className=\"text-slate-900 dark:text-white\">Total</span>\n                      <span className=\"text-slate-900 dark:text-white\">{formatCurrency(order.total)}</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {order.customerNotes && (\n                <div className=\"border-t border-slate-200 dark:border-slate-700 pt-6\">\n                  <h4 className=\"text-sm font-medium text-slate-900 dark:text-white mb-2\">Customer Notes</h4>\n                  <p className=\"text-sm text-slate-600 dark:text-slate-400\">{order.customerNotes}</p>\n                </div>\n              )}\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"invoices\" className=\"flex-1 overflow-auto p-6 mt-0\">\n            {order.invoices && order.invoices.length > 0 ? (\n              <div className=\"space-y-4\">\n                {order.invoices.map((invoice) => (\n                  <div key={invoice.id} className=\"border border-slate-200 dark:border-slate-700 rounded-md p-4\" data-testid={`card-invoice-${invoice.id}`}>\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"font-medium text-slate-900 dark:text-white\">{invoice.invoiceNumber}</p>\n                        <p className=\"text-sm text-slate-500\">{formatDate(invoice.date)}</p>\n                      </div>\n                      <div className=\"text-right\">\n                        <p className=\"font-medium text-slate-900 dark:text-white\">{formatCurrency(invoice.amount)}</p>\n                        <Badge className={getStatusBadgeStyles(invoice.status)}>{invoice.status}</Badge>\n                      </div>\n                    </div>\n                    {invoice.balanceDue > 0 && (\n                      <div className=\"mt-2 pt-2 border-t border-slate-200 dark:border-slate-700 flex justify-between text-sm\">\n                        <span className=\"text-slate-500\">Balance Due</span>\n                        <span className=\"text-amber-600 font-medium\">{formatCurrency(invoice.balanceDue)}</span>\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-center py-8 text-slate-500\">\n                <Receipt className=\"h-8 w-8 mx-auto mb-2 text-slate-300\" />\n                <p className=\"text-sm\">No invoices yet</p>\n                <p className=\"text-xs text-slate-400\">Convert this order to an invoice to get started</p>\n              </div>\n            )}\n          </TabsContent>\n        </Tabs>\n      )}\n\n      <div className=\"border-t border-slate-200 dark:border-slate-700 p-4 flex items-center justify-between\">\n        <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-prev-order\">\n          <ChevronLeft className=\"h-4 w-4\" />\n        </Button>\n        <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-next-order\">\n          <ChevronRight className=\"h-4 w-4\" />\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nexport default function SalesOrdersPage() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [salesOrders, setSalesOrders] = useState<SalesOrderListItem[]>([]);\n  const [selectedOrders, setSelectedOrders] = useState<string[]>([]);\n  const [selectedOrder, setSelectedOrder] = useState<SalesOrderDetail | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [orderToDelete, setOrderToDelete] = useState<string | null>(null);\n  const [invoiceDialogOpen, setInvoiceDialogOpen] = useState(false);\n  const [selectedItemsForInvoice, setSelectedItemsForInvoice] = useState<string[]>([]);\n\n  useEffect(() => {\n    fetchSalesOrders();\n  }, []);\n\n  const fetchSalesOrders = async () => {\n    try {\n      const response = await fetch('/api/sales-orders');\n      if (response.ok) {\n        const data = await response.json();\n        setSalesOrders(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch sales orders:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchOrderDetail = async (id: string) => {\n    try {\n      const response = await fetch(`/api/sales-orders/${id}`);\n      if (response.ok) {\n        const data = await response.json();\n        setSelectedOrder(data.data);\n      }\n    } catch (error) {\n      console.error('Failed to fetch order detail:', error);\n    }\n  };\n\n  const handleOrderClick = (order: SalesOrderListItem) => {\n    fetchOrderDetail(order.id);\n  };\n\n  const handleClosePanel = () => {\n    setSelectedOrder(null);\n  };\n\n  const handleEditOrder = () => {\n    if (selectedOrder) {\n      setLocation(`/sales-orders/${selectedOrder.id}/edit`);\n    }\n  };\n\n  const toggleSelectOrder = (id: string, e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (selectedOrders.includes(id)) {\n      setSelectedOrders(selectedOrders.filter(i => i !== id));\n    } else {\n      setSelectedOrders([...selectedOrders, id]);\n    }\n  };\n\n  const handleDeleteClick = () => {\n    if (selectedOrder) {\n      setOrderToDelete(selectedOrder.id);\n      setDeleteDialogOpen(true);\n    }\n  };\n\n  const confirmDelete = async () => {\n    if (!orderToDelete) return;\n    try {\n      const response = await fetch(`/api/sales-orders/${orderToDelete}`, { method: 'DELETE' });\n      if (response.ok) {\n        toast({ title: \"Sales order deleted successfully\" });\n        handleClosePanel();\n        fetchSalesOrders();\n      }\n    } catch (error) {\n      toast({ title: \"Failed to delete sales order\", variant: \"destructive\" });\n    } finally {\n      setDeleteDialogOpen(false);\n      setOrderToDelete(null);\n    }\n  };\n\n  const handleConvertToInvoice = async () => {\n    if (!selectedOrder) return;\n\n    try {\n      // Create invoice with all items\n      const invoiceData = {\n        salesOrderId: selectedOrder.id,\n        customerId: selectedOrder.customerId,\n        customerName: selectedOrder.customerName,\n        items: selectedOrder.items.filter(item => (item.quantity - (item.invoicedQty || 0)) > 0),\n        convertAll: true,\n        billingAddress: selectedOrder.billingAddress,\n        shippingAddress: selectedOrder.shippingAddress,\n        paymentTerms: selectedOrder.paymentTerms,\n        notes: `Converted from Sales Order: ${selectedOrder.salesOrderNumber}`\n      };\n\n      const response = await fetch('/api/invoices', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(invoiceData)\n      });\n\n      if (response.ok) {\n        const result = await response.json();\n        toast({\n          title: \"Invoice Created Successfully\",\n          description: `Invoice ${result.data.invoiceNumber} has been created from sales order ${selectedOrder.salesOrderNumber}`\n        });\n\n        // Refresh sales order data and navigate to invoices\n        await fetchOrderDetail(selectedOrder.id);\n        await fetchSalesOrders();\n        setLocation('/invoices');\n      } else {\n        throw new Error('Failed to create invoice');\n      }\n    } catch (error) {\n      console.error('Error creating invoice:', error);\n      toast({\n        title: \"Failed to Create Invoice\",\n        description: \"There was an error creating the invoice. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const handleConvertSelectedItems = () => {\n    if (!selectedOrder) return;\n    // Open dialog to select items\n    setSelectedItemsForInvoice([]);\n    setInvoiceDialogOpen(true);\n  };\n\n  const handleConfirmSelectedItems = async () => {\n    if (!selectedOrder || selectedItemsForInvoice.length === 0) {\n      toast({ title: \"Please select at least one item\", variant: \"destructive\" });\n      return;\n    }\n\n    try {\n      // Filter selected items and ensure they have remaining quantity\n      const selectedItems = selectedOrder.items\n        .filter(item => selectedItemsForInvoice.includes(item.id))\n        .filter(item => (item.quantity - (item.invoicedQty || 0)) > 0);\n\n      if (selectedItems.length === 0) {\n        toast({\n          title: \"No Items to Invoice\",\n          description: \"All selected items have already been fully invoiced.\",\n          variant: \"destructive\"\n        });\n        return;\n      }\n\n      // Calculate invoice totals from selected items\n      const calculateInvoiceTotals = (items: SalesOrderItem[]) => {\n        let subtotal = 0;\n        let totalTax = 0;\n\n        items.forEach(item => {\n          const itemSubtotal = item.quantity * item.rate;\n          const discountAmount = item.discountType === 'percentage'\n            ? (itemSubtotal * item.discount) / 100\n            : item.discount;\n          const taxableAmount = itemSubtotal - discountAmount;\n          const taxAmount = (taxableAmount * item.tax) / 100;\n\n          subtotal += taxableAmount;\n          totalTax += taxAmount;\n        });\n\n        const total = subtotal + totalTax;\n\n        return {\n          subTotal: subtotal,\n          totalTax,\n          total,\n          cgst: 0, // Will be calculated based on tax preference\n          sgst: 0,\n          igst: totalTax // Assuming IGST for now\n        };\n      };\n\n      const totals = calculateInvoiceTotals(selectedItems);\n\n      // Create invoice with selected items and calculated totals\n      const invoiceData = {\n        date: new Date().toISOString().split('T')[0],\n        dueDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 30 days from now\n        salesOrderId: selectedOrder.id,\n        customerId: selectedOrder.customerId,\n        customerName: selectedOrder.customerName,\n        items: selectedItems,\n        convertAll: false,\n        selectedItemIds: selectedItemsForInvoice,\n        billingAddress: selectedOrder.billingAddress,\n        shippingAddress: selectedOrder.shippingAddress,\n        paymentTerms: selectedOrder.paymentTerms,\n        subTotal: totals.subTotal,\n        shippingCharges: 0,\n        cgst: totals.cgst,\n        sgst: totals.sgst,\n        igst: totals.igst,\n        adjustment: 0,\n        total: totals.total,\n        status: 'pending',\n        customerNotes: '',\n        termsAndConditions: '',\n        notes: `Converted from Sales Order: ${selectedOrder.salesOrderNumber} (${selectedItems.length} selected items)`\n      };\n\n      const response = await fetch('/api/invoices', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(invoiceData)\n      });\n\n      if (response.ok) {\n        const result = await response.json();\n        toast({\n          title: \"Invoice Created Successfully\",\n          description: `Invoice ${result.data.invoiceNumber} has been created with ${selectedItems.length} items from sales order ${selectedOrder.salesOrderNumber}`\n        });\n\n        // Close dialog, refresh data and navigate to invoices\n        setInvoiceDialogOpen(false);\n        setSelectedItemsForInvoice([]);\n        await fetchOrderDetail(selectedOrder.id);\n        await fetchSalesOrders();\n        setLocation('/invoices');\n      } else {\n        throw new Error('Failed to create invoice');\n      }\n    } catch (error) {\n      console.error('Error creating invoice:', error);\n      toast({\n        title: \"Failed to Create Invoice\",\n        description: \"There was an error creating the invoice. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const toggleItemSelection = (itemId: string) => {\n    if (!selectedOrder) return;\n\n    const item = selectedOrder.items.find(i => i.id === itemId);\n    if (!item) return;\n\n    const remainingQty = item.quantity - (item.invoicedQty || 0);\n    if (remainingQty <= 0) return; // Don't allow selection of fully invoiced items\n\n    setSelectedItemsForInvoice(prev =>\n      prev.includes(itemId)\n        ? prev.filter(id => id !== itemId)\n        : [...prev, itemId]\n    );\n  };\n\n  const filteredOrders = salesOrders.filter(order =>\n    order.salesOrderNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    order.customerName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    (order.referenceNumber && order.referenceNumber.toLowerCase().includes(searchTerm.toLowerCase()))\n  );\n\n  const { currentPage, totalPages, totalItems, itemsPerPage, paginatedItems, goToPage } = usePagination(filteredOrders, 10);\n\n  return (\n    <div className=\"flex h-[calc(100vh-80px)] animate-in fade-in duration-300 -m-4 lg:-m-6\">\n      <div className={`flex-1 flex flex-col overflow-hidden ${selectedOrder ? 'max-w-md' : ''}`}>\n        <div className=\"flex items-center justify-between p-4 gap-4\">\n          <div className=\"flex items-center gap-2\">\n            <h1 className=\"text-xl font-semibold text-slate-900 dark:text-white\">All Sales Orders</h1>\n            <ChevronDown className=\"h-4 w-4 text-slate-500\" />\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              onClick={() => setLocation(\"/sales-orders/create\")}\n              className=\"bg-blue-600 hover:bg-blue-700 gap-1.5\"\n              data-testid=\"button-new-order\"\n            >\n              <Plus className=\"h-4 w-4\" /> New\n            </Button>\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"outline\" size=\"icon\" data-testid=\"button-menu\">\n                  <MoreHorizontal className=\"h-4 w-4\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <DropdownMenuItem>Sort</DropdownMenuItem>\n                <DropdownMenuItem>Import Sales Orders</DropdownMenuItem>\n                <DropdownMenuItem>Export Sales Orders</DropdownMenuItem>\n                <DropdownMenuSeparator />\n                <DropdownMenuItem>Preferences</DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </div>\n\n        {!selectedOrder && (\n          <div className=\"px-4 pb-3 flex items-center gap-2 flex-wrap\">\n            <div className=\"relative flex-1 max-w-sm\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400\" />\n              <Input\n                placeholder=\"Search sales orders...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-9\"\n                data-testid=\"input-search\"\n              />\n            </div>\n            <Button variant=\"outline\" size=\"sm\" className=\"gap-1.5\">\n              <Filter className=\"h-4 w-4\" />\n              Filter\n            </Button>\n          </div>\n        )}\n\n        <div className=\"flex-1 overflow-auto border-t border-slate-200 dark:border-slate-700\">\n          {loading ? (\n            <div className=\"p-8 text-center text-slate-500\">Loading sales orders...</div>\n          ) : filteredOrders.length === 0 ? (\n            <div className=\"p-8 text-center text-slate-500\">\n              <Package className=\"h-12 w-12 mx-auto mb-4 text-slate-300\" />\n              <p className=\"font-medium\">No sales orders found</p>\n              <p className=\"text-sm text-slate-400 mt-1\">Create your first sales order to get started</p>\n              <Button\n                onClick={() => setLocation(\"/sales-orders/create\")}\n                className=\"mt-4 bg-blue-600 hover:bg-blue-700\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" /> Create Sales Order\n              </Button>\n            </div>\n          ) : selectedOrder ? (\n            <div className=\"divide-y divide-slate-100 dark:divide-slate-800\">\n              {filteredOrders.map((order) => (\n                <div\n                  key={order.id}\n                  className={`p-4 hover:bg-slate-50 dark:hover:bg-slate-800 cursor-pointer transition-colors ${selectedOrder?.id === order.id ? 'bg-blue-50 dark:bg-blue-900/20 border-l-2 border-l-blue-600' : ''\n                    }`}\n                  onClick={() => handleOrderClick(order)}\n                  data-testid={`card-order-${order.id}`}\n                >\n                  <div className=\"flex items-start justify-between mb-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <Checkbox\n                        checked={selectedOrders.includes(order.id)}\n                        onClick={(e) => toggleSelectOrder(order.id, e)}\n                      />\n                      <span className=\"font-medium text-slate-900 dark:text-white truncate\">{order.customerName}</span>\n                    </div>\n                    <span className=\"font-semibold text-slate-900 dark:text-white\">{formatCurrency(order.total)}</span>\n                  </div>\n                  <div className=\"ml-6 flex items-center gap-2 text-sm flex-wrap\">\n                    <span className=\"text-slate-500\">{order.salesOrderNumber}</span>\n                    <span className=\"text-slate-300\">|</span>\n                    <span className=\"text-slate-500\">{formatDate(order.date)}</span>\n                  </div>\n                  <div className=\"ml-6 mt-2 flex items-center gap-2 flex-wrap\">\n                    <Badge variant=\"outline\" className={getStatusBadgeStyles(order.orderStatus)}>\n                      {order.orderStatus}\n                    </Badge>\n                    <Badge variant=\"outline\" className={getStatusBadgeStyles(order.invoiceStatus)}>\n                      {order.invoiceStatus}\n                    </Badge>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <>\n              <table className=\"w-full\">\n                <thead className=\"bg-slate-50 dark:bg-slate-800 sticky top-0 z-10\">\n                  <tr>\n                    <th className=\"w-12 px-4 py-3\">\n                      <Checkbox />\n                    </th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Date</th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Sales Order#</th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Reference#</th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Customer Name</th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Status</th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Invoiced</th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Payment</th>\n                    <th className=\"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase\">Amount</th>\n                    <th className=\"w-10 px-4 py-3\"></th>\n                  </tr>\n                </thead>\n                <tbody className=\"divide-y divide-slate-100 dark:divide-slate-800\">\n                  {paginatedItems.map((order) => (\n                    <tr\n                      key={order.id}\n                      className=\"hover:bg-slate-50 dark:hover:bg-slate-800 cursor-pointer\"\n                      onClick={() => handleOrderClick(order)}\n                      data-testid={`row-order-${order.id}`}\n                    >\n                      <td className=\"px-4 py-3\">\n                        <Checkbox\n                          checked={selectedOrders.includes(order.id)}\n                          onClick={(e) => toggleSelectOrder(order.id, e)}\n                        />\n                      </td>\n                      <td className=\"px-4 py-3 text-sm text-slate-600 dark:text-slate-400\">{formatDate(order.date)}</td>\n                      <td className=\"px-4 py-3\">\n                        <span className=\"text-blue-600 font-medium\">{order.salesOrderNumber}</span>\n                      </td>\n                      <td className=\"px-4 py-3 text-sm text-slate-600 dark:text-slate-400\">{order.referenceNumber || '-'}</td>\n                      <td className=\"px-4 py-3 text-sm text-slate-900 dark:text-white font-medium\">{order.customerName}</td>\n                      <td className=\"px-4 py-3\">\n                        <Badge variant=\"outline\" className={getStatusBadgeStyles(order.orderStatus)}>\n                          {order.orderStatus}\n                        </Badge>\n                      </td>\n                      <td className=\"px-4 py-3\">\n                        <Badge variant=\"outline\" className={getStatusBadgeStyles(order.invoiceStatus)}>\n                          {order.invoiceStatus}\n                        </Badge>\n                      </td>\n                      <td className=\"px-4 py-3\">\n                        <Badge variant=\"outline\" className={getStatusBadgeStyles(order.paymentStatus)}>\n                          {order.paymentStatus}\n                        </Badge>\n                      </td>\n                      <td className=\"px-4 py-3 text-right font-semibold text-slate-900 dark:text-white\">{formatCurrency(order.total)}</td>\n                      <td className=\"px-4 py-3\">\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={(e) => e.stopPropagation()}>\n                              <MoreHorizontal className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem onClick={(e) => { e.stopPropagation(); setLocation(`/sales-orders/${order.id}/edit`); }}>\n                              <Pencil className=\"mr-2 h-4 w-4\" /> Edit\n                            </DropdownMenuItem>\n                            <DropdownMenuItem>\n                              <Receipt className=\"mr-2 h-4 w-4\" /> Convert to Invoice\n                            </DropdownMenuItem>\n                            <DropdownMenuSeparator />\n                            <DropdownMenuItem className=\"text-destructive\">\n                              <Trash2 className=\"mr-2 h-4 w-4\" /> Delete\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n              <TablePagination\n                currentPage={currentPage}\n                totalPages={totalPages}\n                totalItems={totalItems}\n                itemsPerPage={itemsPerPage}\n                onPageChange={goToPage}\n              />\n            </>\n          )}\n        </div>\n      </div>\n\n      {selectedOrder && (\n        <div className=\"flex-1 min-w-0\">\n          <SalesOrderDetailPanel\n            order={selectedOrder}\n            onClose={handleClosePanel}\n            onEdit={handleEditOrder}\n            onDelete={handleDeleteClick}\n            onConvertToInvoice={handleConvertToInvoice}\n            onConvertSelectedItems={handleConvertSelectedItems}\n          />\n        </div>\n      )}\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Sales Order</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete this sales order? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={confirmDelete} className=\"bg-red-600 hover:bg-red-700\">\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Item Selection Dialog for Invoice */}\n      <Dialog open={invoiceDialogOpen} onOpenChange={setInvoiceDialogOpen}>\n        <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Select Items to Invoice</DialogTitle>\n            <DialogDescription>\n              Choose which items from the sales order you want to include in the invoice.\n            </DialogDescription>\n          </DialogHeader>\n\n          {selectedOrder && (\n            <div className=\"space-y-4\">\n              <div className=\"border rounded-lg p-4\">\n                <h4 className=\"font-medium mb-2\">Sales Order: {selectedOrder.salesOrderNumber}</h4>\n                <p className=\"text-sm text-gray-600\">Customer: {selectedOrder.customerName}</p>\n              </div>\n\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center justify-between\">\n                  <h4 className=\"font-medium\">Items</h4>\n                  <div className=\"flex gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => {\n                        const invoiceableItems = selectedOrder.items\n                          .filter(item => (item.quantity - (item.invoicedQty || 0)) > 0)\n                          .map(item => item.id);\n                        setSelectedItemsForInvoice(invoiceableItems);\n                      }}\n                    >\n                      Select All Available\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setSelectedItemsForInvoice([])}\n                    >\n                      Clear All\n                    </Button>\n                  </div>\n                </div>\n\n                <div className=\"border rounded-lg overflow-hidden\">\n                  <div className=\"max-h-60 overflow-y-auto\">\n                    {selectedOrder.items.map((item) => {\n                      const remainingQty = item.quantity - (item.invoicedQty || 0);\n                      const isFullyInvoiced = remainingQty <= 0;\n\n                      return (\n                        <div key={item.id} className={`flex items-center justify-between p-3 border-b last:border-b-0 ${isFullyInvoiced ? 'bg-gray-50 opacity-60' : 'hover:bg-gray-50'}`}>\n                          <div className=\"flex items-center gap-3\">\n                            <Checkbox\n                              checked={selectedItemsForInvoice.includes(item.id)}\n                              onCheckedChange={() => toggleItemSelection(item.id)}\n                              disabled={isFullyInvoiced}\n                            />\n                            <div className=\"flex-1\">\n                              <div className={`font-medium ${isFullyInvoiced ? 'text-gray-400' : ''}`}>{item.name}</div>\n                              {item.description && (\n                                <div className={`text-sm ${isFullyInvoiced ? 'text-gray-400' : 'text-gray-600'}`}>{item.description}</div>\n                              )}\n                              <div className={`text-xs ${isFullyInvoiced ? 'text-gray-400' : 'text-gray-500'}`}>\n                                Total Qty: {item.quantity} | Invoiced: {item.invoicedQty || 0} | <strong>Remaining: {remainingQty}</strong>\n                              </div>\n                              <div className={`text-xs ${isFullyInvoiced ? 'text-gray-400' : 'text-gray-500'}`}>\n                                Rate: {item.rate.toFixed(2)}\n                              </div>\n                            </div>\n                          </div>\n                          <div className=\"text-right\">\n                            <div className={`font-medium ${isFullyInvoiced ? 'text-gray-400' : ''}`}>\n                              {(item.rate * remainingQty).toFixed(2)}\n                            </div>\n                            <div className={`text-xs ${isFullyInvoiced ? 'text-gray-400' : 'text-gray-500'}`}>\n                              {isFullyInvoiced ? \"Fully Invoiced\" : (item.invoiceStatus || \"Available\")}\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                </div>\n\n                {selectedItemsForInvoice.length > 0 && selectedOrder && (\n                  <div className=\"bg-blue-50 p-3 rounded-lg\">\n                    <div className=\"text-sm\">\n                      <strong>{selectedItemsForInvoice.length}</strong> item(s) selected for invoice\n                    </div>\n                    <div className=\"text-xs text-blue-700 mt-1\">\n                      Total Amount: {selectedOrder.items\n                        .filter(item => selectedItemsForInvoice.includes(item.id))\n                        .reduce((sum, item) => {\n                          const remainingQty = item.quantity - (item.invoicedQty || 0);\n                          return sum + (item.rate * remainingQty);\n                        }, 0)\n                        .toFixed(2)\n                      }\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setInvoiceDialogOpen(false)}>\n              Cancel\n            </Button>\n            <Button onClick={handleConfirmSelectedItems} disabled={selectedItemsForInvoice.length === 0}>\n              Create Invoice ({selectedItemsForInvoice.length} items)\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":57682,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-primary/10\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":266,"size_tokens":null},"client/src/pages/invoice-edit.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation, useParams } from \"wouter\";\nimport {\n  Calendar as CalendarIcon,\n  ChevronDown,\n  Plus,\n  Trash2,\n  Save,\n  Send,\n  ArrowLeft,\n  Printer,\n  Share2,\n  Search,\n  Settings,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { addDays, endOfMonth, addMonths, format, parse } from \"date-fns\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { cn } from \"@/lib/utils\";\nimport { Separator } from \"@/components/ui/separator\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { ManageSalespersonsDialog } from \"@/components/ManageSalespersonsDialog\";\n\ninterface InvoiceItem {\n  id: string;\n  itemId: string;\n  name: string;\n  description: string;\n  quantity: number;\n  rate: number;\n  discount: number;\n  discountType: 'percentage' | 'flat';\n  tax: string;\n  originalTaxName: string;\n  taxAmount: number;\n  amount: number;\n  isModified?: boolean;\n  taxModified?: boolean;\n}\n\ninterface ItemOption {\n  id: string;\n  name: string;\n  description?: string;\n  rate: string;\n  hsnSac: string;\n  type: string;\n  taxPreference: string;\n  intraStateTax: string;\n  interStateTax: string;\n  usageUnit: string;\n  isActive: boolean;\n}\n\nconst TAX_OPTIONS = [\n  { label: \"Non-taxable\", value: \"none\", rate: 0 },\n  { label: \"GST0 [0%]\", value: \"GST0\", rate: 0 },\n  { label: \"GST5 [5%]\", value: \"GST5\", rate: 5 },\n  { label: \"GST12 [12%]\", value: \"GST12\", rate: 12 },\n  { label: \"GST18 [18%]\", value: \"GST18\", rate: 18 },\n  { label: \"GST28 [28%]\", value: \"GST28\", rate: 28 },\n];\n\nconst TERMS_OPTIONS = [\n  { value: \"Due on Receipt\", label: \"Due on Receipt\", days: 0 },\n  { value: \"Net 15\", label: \"Net 15\", days: 15 },\n  { value: \"Net 30\", label: \"Net 30\", days: 30 },\n  { value: \"Net 45\", label: \"Net 45\", days: 45 },\n  { value: \"Net 60\", label: \"Net 60\", days: 60 },\n];\n\nconst getTaxRate = (taxValue: string): number => {\n  const option = TAX_OPTIONS.find(t => t.value === taxValue);\n  return option?.rate || 0;\n};\n\nexport default function InvoiceEdit() {\n  const [, setLocation] = useLocation();\n  const params = useParams<{ id: string }>();\n  const { toast } = useToast();\n\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [invoiceNumber, setInvoiceNumber] = useState(\"\");\n  const [date, setDate] = useState<Date>(new Date());\n  const [dueDate, setDueDate] = useState<Date>(new Date());\n  const [customerName, setCustomerName] = useState(\"\");\n  const [customerId, setCustomerId] = useState(\"\");\n  const [paymentTerms, setPaymentTerms] = useState(\"Net 30\");\n  const [billingAddress, setBillingAddress] = useState(\"\");\n  const [customerNotes, setCustomerNotes] = useState(\"\");\n  const [termsAndConditions, setTermsAndConditions] = useState(\"\");\n  const [items, setItems] = useState<InvoiceItem[]>([]);\n  const [itemOptions, setItemOptions] = useState<ItemOption[]>([]);\n  const [shippingCharges, setShippingCharges] = useState(0);\n  const [adjustment, setAdjustment] = useState(0);\n  const [selectedSalesperson, setSelectedSalesperson] = useState(\"\");\n  const [showManageSalespersons, setShowManageSalespersons] = useState(false);\n  const [salespersons, setSalespersons] = useState<{ id: string; name: string }[]>([]);\n\n  useEffect(() => {\n    fetchInvoice();\n    fetchSalespersons();\n    fetchItems();\n  }, [params.id]);\n\n  const fetchSalespersons = async () => {\n    try {\n      const response = await fetch('/api/salespersons');\n      if (response.ok) {\n        const data = await response.json();\n        setSalespersons(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch salespersons:', error);\n    }\n  };\n\n  const fetchItems = async () => {\n    try {\n      const response = await fetch('/api/items');\n      if (response.ok) {\n        const data = await response.json();\n        const items = data.data || data.items || [];\n        // Filter only active items\n        const activeItems = items.filter((item: ItemOption) => item.isActive !== false);\n        setItemOptions(activeItems);\n      } else {\n        console.error('Failed to fetch items:', response.statusText);\n      }\n    } catch (error) {\n      console.error('Failed to fetch items:', error);\n    }\n  };\n\n  const fetchInvoice = async () => {\n    try {\n      const response = await fetch(`/api/invoices/${params.id}`);\n      if (response.ok) {\n        const data = await response.json();\n        const invoice = data.data;\n\n        setInvoiceNumber(invoice.invoiceNumber);\n        setDate(new Date(invoice.date));\n        setDueDate(new Date(invoice.dueDate));\n        setCustomerName(invoice.customerName);\n        setCustomerId(invoice.customerId);\n        setPaymentTerms(invoice.paymentTerms);\n        setBillingAddress(invoice.billingAddress?.street || '');\n        setCustomerNotes(invoice.customerNotes || '');\n        setTermsAndConditions(invoice.termsAndConditions || '');\n        setItems(invoice.items.map((item: any, index: number) => {\n          const storedTaxName = item.taxName || 'GST18';\n          const knownTax = TAX_OPTIONS.find(t => t.value === storedTaxName);\n          return {\n            id: item.id || String(index + 1),\n            itemId: item.itemId || '',\n            name: item.name,\n            description: item.description || '',\n            quantity: item.quantity,\n            rate: item.rate,\n            discount: item.discount || 0,\n            discountType: item.discountType || 'flat',\n            tax: knownTax ? storedTaxName : 'custom',\n            originalTaxName: storedTaxName,\n            taxAmount: item.tax || 0,\n            amount: item.amount,\n            isModified: false,\n            taxModified: false\n          };\n        }));\n        setShippingCharges(invoice.shippingCharges || 0);\n        setAdjustment(invoice.adjustment || 0);\n        setSelectedSalesperson(invoice.salesperson || \"\");\n      }\n    } catch (error) {\n      console.error('Failed to fetch invoice:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to load invoice\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const calculateLineItem = (item: InvoiceItem, forceRecalc: boolean = false) => {\n    const baseAmount = item.quantity * item.rate;\n    let discountAmount = 0;\n    if (item.discountType === 'percentage') {\n      discountAmount = baseAmount * (Math.min(item.discount, 100) / 100);\n    } else {\n      discountAmount = item.discount;\n    }\n    discountAmount = Math.min(discountAmount, baseAmount);\n    const taxableAmount = baseAmount - discountAmount;\n\n    if (!item.isModified && !forceRecalc) {\n      return {\n        baseAmount,\n        discountAmount,\n        taxableAmount,\n        taxAmount: item.taxAmount,\n        total: item.amount\n      };\n    }\n\n    const taxRate = getTaxRate(item.tax);\n    const taxAmount = taxableAmount * (taxRate / 100);\n    return {\n      baseAmount,\n      discountAmount,\n      taxableAmount,\n      taxAmount,\n      total: taxableAmount + taxAmount\n    };\n  };\n\n  const totals = items.reduce((acc, item) => {\n    const line = calculateLineItem(item);\n    return {\n      subtotal: acc.subtotal + line.taxableAmount,\n      totalTax: acc.totalTax + line.taxAmount,\n      grandTotal: acc.grandTotal + line.total\n    };\n  }, { subtotal: 0, totalTax: 0, grandTotal: 0 });\n\n  const finalTotal = totals.grandTotal + shippingCharges + adjustment;\n\n  const handleItemChange = (index: number, itemId: string) => {\n    const selectedItem = itemOptions.find(i => i.id === itemId);\n    if (selectedItem) {\n      const rate = parseFloat(selectedItem.rate.toString().replace(/[,]/g, '')) || 0;\n      // Extract tax rate from intraStateTax field\n      const taxRate = selectedItem.intraStateTax?.includes('18') ? 18 :\n        selectedItem.intraStateTax?.includes('12') ? 12 :\n          selectedItem.intraStateTax?.includes('5') ? 5 :\n            selectedItem.intraStateTax?.includes('28') ? 28 : 0;\n\n      const newItems = [...items];\n      newItems[index] = {\n        ...newItems[index],\n        itemId,\n        name: selectedItem.name,\n        description: selectedItem.description || '',\n        rate,\n        tax: `GST${taxRate}`,\n        isModified: true,\n        taxModified: newItems[index].taxModified\n      };\n      const calc = calculateLineItem(newItems[index], true);\n      newItems[index].taxAmount = calc.taxAmount;\n      newItems[index].amount = calc.total;\n      setItems(newItems);\n    }\n  };\n\n  const handleUpdateItem = (index: number, field: keyof InvoiceItem, value: any) => {\n    const newItems = [...items];\n    newItems[index] = {\n      ...newItems[index],\n      [field]: value\n    };\n    if (field === 'quantity' || field === 'rate' || field === 'discount' || field === 'discountType' || field === 'tax') {\n      newItems[index].isModified = true;\n      if (field === 'tax') {\n        newItems[index].taxModified = true;\n      }\n      const calc = calculateLineItem(newItems[index], true);\n      newItems[index].taxAmount = calc.taxAmount;\n      newItems[index].amount = calc.total;\n    }\n    setItems(newItems);\n  };\n\n  const handleAddItem = () => {\n    setItems([...items, {\n      id: String(Date.now()),\n      itemId: '',\n      name: '',\n      description: '',\n      quantity: 1,\n      rate: 0,\n      discount: 0,\n      discountType: 'percentage',\n      tax: 'GST18',\n      originalTaxName: 'GST18',\n      taxAmount: 0,\n      amount: 0,\n      isModified: true,\n      taxModified: true\n    }]);\n  };\n\n  const handleRemoveItem = (index: number) => {\n    setItems(items.filter((_, i) => i !== index));\n  };\n\n  const handleSave = async () => {\n    setSaving(true);\n    try {\n      const invoiceItems = items.map(item => {\n        const lineCalc = calculateLineItem(item);\n        const effectiveTaxName = item.taxModified\n          ? (item.tax === 'custom' ? item.originalTaxName : item.tax)\n          : item.originalTaxName;\n        return {\n          id: item.id,\n          itemId: item.itemId,\n          name: item.name,\n          description: item.description,\n          quantity: item.quantity,\n          unit: 'pcs',\n          rate: item.rate,\n          discount: item.discount,\n          discountType: item.discountType,\n          tax: lineCalc.taxAmount,\n          taxName: effectiveTaxName,\n          amount: lineCalc.total\n        };\n      });\n\n      const invoiceData = {\n        date: format(date, 'yyyy-MM-dd'),\n        dueDate: format(dueDate, 'yyyy-MM-dd'),\n        customerId,\n        customerName,\n        billingAddress: {\n          street: billingAddress,\n          city: '',\n          state: '',\n          country: 'India',\n          pincode: ''\n        },\n        shippingAddress: {\n          street: '',\n          city: '',\n          state: '',\n          country: 'India',\n          pincode: ''\n        },\n        paymentTerms,\n        salesperson: selectedSalesperson,\n        items: invoiceItems,\n        subTotal: totals.subtotal,\n        shippingCharges,\n        cgst: totals.totalTax / 2,\n        sgst: totals.totalTax / 2,\n        igst: 0,\n        adjustment,\n        total: finalTotal,\n        customerNotes,\n        termsAndConditions,\n        balanceDue: finalTotal\n      };\n\n      const response = await fetch(`/api/invoices/${params.id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(invoiceData)\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Invoice Updated\",\n          description: `Invoice ${invoiceNumber} has been updated successfully.`,\n        });\n        setLocation(\"/invoices\");\n      } else {\n        throw new Error('Failed to update invoice');\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update invoice. Please try again.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const formatCurrency = (amount: number) => {\n    return `${amount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n  };\n\n  if (loading) {\n    return (\n      <div className=\"p-8 text-center\">\n        <p className=\"text-muted-foreground\">Loading invoice...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6 pb-24\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div className=\"flex items-center gap-4\">\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => setLocation('/invoices')} data-testid=\"button-back\">\n            <ArrowLeft className=\"h-5 w-5\" />\n          </Button>\n          <div>\n            <h1 className=\"text-2xl font-semibold\">Edit Invoice</h1>\n            <p className=\"text-sm text-muted-foreground\">{invoiceNumber}</p>\n          </div>\n        </div>\n      </div>\n\n      <Card className=\"mb-6\">\n        <CardHeader>\n          <CardTitle>Invoice Details</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label>Customer Name</Label>\n              <Input value={customerName} disabled className=\"bg-muted/50\" data-testid=\"input-customer-name\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Invoice #</Label>\n              <Input value={invoiceNumber} disabled className=\"bg-muted/50\" data-testid=\"input-invoice-number\" />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            <div className=\"space-y-2\">\n              <Label>Invoice Date</Label>\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    className={cn(\"w-full justify-start text-left font-normal\", !date && \"text-muted-foreground\")}\n                    data-testid=\"button-invoice-date\"\n                  >\n                    <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                    {date ? format(date, \"dd/MM/yyyy\") : \"Select date\"}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                  <Calendar mode=\"single\" selected={date} onSelect={(d) => d && setDate(d)} />\n                </PopoverContent>\n              </Popover>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Terms</Label>\n              <Select value={paymentTerms} onValueChange={setPaymentTerms}>\n                <SelectTrigger data-testid=\"select-payment-terms\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {TERMS_OPTIONS.map(opt => (\n                    <SelectItem key={opt.value} value={opt.value}>{opt.label}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Due Date</Label>\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    className={cn(\"w-full justify-start text-left font-normal\", !dueDate && \"text-muted-foreground\")}\n                    data-testid=\"button-due-date\"\n                  >\n                    <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                    {dueDate ? format(dueDate, \"dd/MM/yyyy\") : \"Select date\"}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                  <Calendar mode=\"single\" selected={dueDate} onSelect={(d) => d && setDueDate(d)} />\n                </PopoverContent>\n              </Popover>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Salesperson</Label>\n              <Select value={selectedSalesperson} onValueChange={(val) => {\n                if (val === \"manage_salespersons\") {\n                  setShowManageSalespersons(true);\n                } else {\n                  setSelectedSalesperson(val);\n                }\n              }}>\n                <SelectTrigger data-testid=\"select-salesperson\">\n                  <SelectValue placeholder=\"Select salesperson\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {salespersons.map((sp) => (\n                    <SelectItem key={sp.id} value={sp.id}>{sp.name}</SelectItem>\n                  ))}\n                  <Separator className=\"my-1\" />\n                  <div\n                    className=\"flex items-center gap-2 px-2 py-1.5 text-sm text-blue-600 cursor-pointer hover:bg-accent\"\n                    onClick={() => setShowManageSalespersons(true)}\n                  >\n                    <Settings className=\"h-4 w-4\" />\n                    Manage Salespersons\n                  </div>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card className=\"mb-6\">\n        <CardHeader className=\"flex flex-row items-center justify-between gap-4\">\n          <CardTitle>Item Table</CardTitle>\n          <Button variant=\"outline\" size=\"sm\" onClick={handleAddItem} data-testid=\"button-add-item\">\n            <Plus className=\"h-4 w-4 mr-1\" /> Add Item\n          </Button>\n        </CardHeader>\n        <CardContent>\n          <div className=\"border rounded-lg overflow-x-auto\">\n            <Table>\n              <TableHeader className=\"bg-muted/30\">\n                <TableRow>\n                  <TableHead className=\"w-[30%] min-w-[200px]\">Item Details</TableHead>\n                  <TableHead className=\"w-[10%] min-w-[80px]\">Qty</TableHead>\n                  <TableHead className=\"w-[12%] min-w-[100px]\">Rate</TableHead>\n                  <TableHead className=\"w-[15%] min-w-[120px]\">Discount</TableHead>\n                  <TableHead className=\"w-[13%] min-w-[100px]\">Tax</TableHead>\n                  <TableHead className=\"w-[10%] min-w-[80px]\">Tax Amt</TableHead>\n                  <TableHead className=\"w-[10%] min-w-[100px] text-right\">Amount</TableHead>\n                  <TableHead className=\"w-[5%] min-w-[50px]\"></TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {items.map((item, index) => {\n                  const lineCalc = calculateLineItem(item);\n                  return (\n                    <TableRow key={item.id} className=\"align-top\">\n                      <TableCell className=\"py-3\">\n                        <div className=\"space-y-2\">\n                          <Select\n                            value={item.itemId || \"custom\"}\n                            onValueChange={(val) => {\n                              if (val === \"create_new_item\") {\n                                setLocation('/items/create');\n                                return;\n                              }\n                              handleItemChange(index, val);\n                            }}\n                          >\n                            <SelectTrigger className=\"h-9\" data-testid={`select-item-${index}`}>\n                              <SelectValue placeholder=\"Select item\">\n                                {item.name || \"Select item\"}\n                              </SelectValue>\n                            </SelectTrigger>\n                            <SelectContent>\n                              {itemOptions.map((opt) => (\n                                <SelectItem key={opt.id} value={opt.id}>{opt.name}</SelectItem>\n                              ))}\n                              <Separator className=\"my-1\" />\n                              <SelectItem value=\"create_new_item\" className=\"text-primary font-medium cursor-pointer\">\n                                + Create New Item\n                              </SelectItem>\n                            </SelectContent>\n                          </Select>\n\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"py-3\">\n                        <Input\n                          type=\"number\"\n                          min=\"0\"\n                          value={item.quantity}\n                          onChange={(e) => handleUpdateItem(index, 'quantity', parseFloat(e.target.value) || 0)}\n                          className=\"h-9\"\n                          data-testid={`input-item-qty-${index}`}\n                        />\n                      </TableCell>\n                      <TableCell className=\"py-3\">\n                        <Input\n                          type=\"number\"\n                          min=\"0\"\n                          value={item.rate}\n                          onChange={(e) => handleUpdateItem(index, 'rate', parseFloat(e.target.value) || 0)}\n                          className=\"h-9\"\n                          data-testid={`input-item-rate-${index}`}\n                        />\n                      </TableCell>\n                      <TableCell className=\"py-3\">\n                        <div className=\"flex shadow-sm rounded-md\">\n                          <Input\n                            type=\"number\"\n                            min=\"0\"\n                            max={item.discountType === 'percentage' ? 100 : undefined}\n                            value={item.discount}\n                            onChange={(e) => handleUpdateItem(index, 'discount', parseFloat(e.target.value) || 0)}\n                            className=\"h-9 rounded-r-none border-r-0\"\n                            data-testid={`input-item-discount-${index}`}\n                          />\n                          <Select\n                            value={item.discountType}\n                            onValueChange={(val: 'percentage' | 'flat') => handleUpdateItem(index, 'discountType', val)}\n                          >\n                            <SelectTrigger className=\"h-9 w-[55px] rounded-l-none border-l-0 bg-muted/30\">\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"percentage\">%</SelectItem>\n                              <SelectItem value=\"flat\">Rs</SelectItem>\n                            </SelectContent>\n                          </Select>\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"py-3\">\n                        <Select\n                          value={item.tax}\n                          onValueChange={(val) => handleUpdateItem(index, 'tax', val)}\n                        >\n                          <SelectTrigger className=\"h-9\" data-testid={`select-item-tax-${index}`}>\n                            <SelectValue placeholder=\"Tax\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {TAX_OPTIONS.map(opt => (\n                              <SelectItem key={opt.value} value={opt.value}>\n                                {opt.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </TableCell>\n                      <TableCell className=\"py-3 text-sm text-muted-foreground\">\n                        {formatCurrency(lineCalc.taxAmount)}\n                      </TableCell>\n                      <TableCell className=\"py-3 text-right font-medium\">\n                        {formatCurrency(lineCalc.total)}\n                      </TableCell>\n                      <TableCell className=\"py-3\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => handleRemoveItem(index)}\n                          className=\"text-muted-foreground hover:text-destructive\"\n                          data-testid={`button-remove-item-${index}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  );\n                })}\n              </TableBody>\n            </Table>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">\n        <div className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Customer Notes</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <Textarea\n                value={customerNotes}\n                onChange={(e) => setCustomerNotes(e.target.value)}\n                placeholder=\"Notes visible to customer...\"\n                rows={4}\n                data-testid=\"textarea-customer-notes\"\n              />\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader>\n              <CardTitle>Terms & Conditions</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <Textarea\n                value={termsAndConditions}\n                onChange={(e) => setTermsAndConditions(e.target.value)}\n                placeholder=\"Terms and conditions...\"\n                rows={4}\n                data-testid=\"textarea-terms\"\n              />\n            </CardContent>\n          </Card>\n        </div>\n\n        <Card className=\"h-fit\">\n          <CardHeader>\n            <CardTitle>Summary</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3 text-sm\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Subtotal</span>\n                <span className=\"font-medium\">{formatCurrency(totals.subtotal)}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Tax</span>\n                <span>{formatCurrency(totals.totalTax)}</span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-muted-foreground\">Shipping Charges</span>\n                <Input\n                  type=\"number\"\n                  value={shippingCharges}\n                  onChange={(e) => setShippingCharges(parseFloat(e.target.value) || 0)}\n                  className=\"w-24 h-8 text-right\"\n                  data-testid=\"input-shipping\"\n                />\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-muted-foreground\">Adjustment</span>\n                <Input\n                  type=\"number\"\n                  value={adjustment}\n                  onChange={(e) => setAdjustment(parseFloat(e.target.value) || 0)}\n                  className=\"w-24 h-8 text-right\"\n                  data-testid=\"input-adjustment\"\n                />\n              </div>\n              <Separator />\n              <div className=\"flex justify-between text-lg font-semibold\">\n                <span>Total</span>\n                <span className=\"text-blue-600\" data-testid=\"text-total\">{formatCurrency(finalTotal)}</span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"fixed bottom-0 left-0 md:left-64 right-0 bg-card/80 backdrop-blur-md border-t border-border/60 p-4 z-40\">\n        <div className=\"max-w-6xl mx-auto flex items-center justify-between gap-4\">\n          <Button variant=\"ghost\" onClick={() => setLocation(\"/invoices\")} data-testid=\"button-cancel\">\n            Cancel\n          </Button>\n          <div className=\"flex items-center gap-3\">\n            <Button onClick={handleSave} disabled={saving} className=\"gap-2\" data-testid=\"button-save\">\n              <Save className=\"h-4 w-4\" />\n              {saving ? \"Saving...\" : \"Save Changes\"}\n            </Button>\n          </div>\n        </div>\n      </div>\n      <ManageSalespersonsDialog\n        open={showManageSalespersons}\n        onOpenChange={setShowManageSalespersons}\n        onSalespersonChange={fetchSalespersons}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":28800,"size_tokens":null},"client/src/pages/purchase-orders.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { \n  Plus, Search, ChevronDown, MoreHorizontal, Pencil, Trash2, \n  X, Mail, FileText, Printer, ArrowRight, Filter, Download,\n  ClipboardList, Eye, Check\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { usePagination } from \"@/hooks/use-pagination\";\nimport { TablePagination } from \"@/components/table-pagination\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\n\ninterface PurchaseOrder {\n  id: string;\n  purchaseOrderNumber: string;\n  referenceNumber?: string;\n  date: string;\n  deliveryDate?: string;\n  vendorId: string;\n  vendorName: string;\n  vendorAddress?: {\n    street1?: string;\n    street2?: string;\n    city?: string;\n    state?: string;\n    pinCode?: string;\n    countryRegion?: string;\n    gstin?: string;\n  };\n  items: Array<{\n    id: string;\n    itemName: string;\n    description?: string;\n    quantity: number;\n    rate: number;\n    tax?: string;\n    taxAmount?: number;\n    amount: number;\n  }>;\n  subTotal: number;\n  discountAmount?: number;\n  taxAmount?: number;\n  adjustment?: number;\n  total: number;\n  notes?: string;\n  termsAndConditions?: string;\n  status: string;\n  receiveStatus?: string;\n  billedStatus?: string;\n  createdAt?: string;\n  pdfTemplate?: string;\n}\n\nfunction formatCurrency(amount: number): string {\n  return new Intl.NumberFormat('en-IN', {\n    style: 'currency',\n    currency: 'INR',\n    minimumFractionDigits: 2\n  }).format(amount);\n}\n\nfunction formatDate(dateString: string): string {\n  if (!dateString) return '-';\n  const date = new Date(dateString);\n  return date.toLocaleDateString('en-IN', { day: '2-digit', month: '2-digit', year: 'numeric' });\n}\n\nfunction PurchaseOrderPDFView({ purchaseOrder }: { purchaseOrder: PurchaseOrder }) {\n  const companyInfo = {\n    name: \"SKILLTONIT\",\n    address: \"Hinjawadi - Wakad road\",\n    city: \"Hinjawadi\",\n    state: \"Pune Maharashtra 411057\",\n    country: \"India\",\n    gstin: \"27A7C7A5145K1Z1\",\n    website: \"www.skilltonit.com\"\n  };\n\n  return (\n    <div className=\"bg-white border border-slate-200 shadow-sm w-full\">\n      <div className=\"flex w-full\">\n        <div className=\"w-2 bg-blue-600 shrink-0\"></div>\n        <div className=\"flex-1 p-4 min-w-0\">\n          <div className=\"flex justify-between items-start mb-6\">\n            <div>\n              <div className=\"flex items-center gap-2 mb-2\">\n                <div className=\"w-10 h-10 bg-blue-600 rounded flex items-center justify-center\">\n                  <span className=\"text-white font-bold text-lg\">S</span>\n                </div>\n                <span className=\"text-xl font-bold text-blue-600\">{companyInfo.name}</span>\n              </div>\n              <div className=\"text-sm text-slate-600 space-y-0.5\">\n                <p>{companyInfo.address}</p>\n                <p>{companyInfo.city}</p>\n                <p>{companyInfo.state}</p>\n                <p>{companyInfo.country}</p>\n                <p>GSTIN: {companyInfo.gstin}</p>\n                <p className=\"text-blue-600\">{companyInfo.website}</p>\n              </div>\n            </div>\n            <div className=\"text-right\">\n              <h2 className=\"text-2xl font-bold text-blue-600 mb-2\">Purchase Order</h2>\n              <p className=\"text-blue-600 font-medium\"># {purchaseOrder.purchaseOrderNumber}</p>\n            </div>\n          </div>\n\n          <div className=\"mb-6\">\n            <h4 className=\"text-sm font-semibold text-slate-500 mb-2\">Vendor Address</h4>\n            <p className=\"font-semibold text-blue-600\">{purchaseOrder.vendorName}</p>\n            {purchaseOrder.vendorAddress && (\n              <div className=\"text-sm text-slate-600\">\n                {purchaseOrder.vendorAddress.street1 && <p>{purchaseOrder.vendorAddress.street1}</p>}\n                {purchaseOrder.vendorAddress.city && (\n                  <p>{purchaseOrder.vendorAddress.city}, {purchaseOrder.vendorAddress.state}</p>\n                )}\n                {purchaseOrder.vendorAddress.pinCode && <p>{purchaseOrder.vendorAddress.pinCode}</p>}\n                {purchaseOrder.vendorAddress.countryRegion && <p>{purchaseOrder.vendorAddress.countryRegion}</p>}\n                {purchaseOrder.vendorAddress.gstin && <p>GSTIN: {purchaseOrder.vendorAddress.gstin}</p>}\n              </div>\n            )}\n          </div>\n\n          <div className=\"text-right mb-4\">\n            <p className=\"text-sm\"><span className=\"text-slate-500\">Date:</span> {formatDate(purchaseOrder.date)}</p>\n          </div>\n\n          <table className=\"w-full mb-6\">\n            <thead>\n              <tr className=\"bg-blue-600 text-white\">\n                <th className=\"px-3 py-2 text-left text-sm font-medium\">#</th>\n                <th className=\"px-3 py-2 text-left text-sm font-medium\">Item & Description</th>\n                <th className=\"px-3 py-2 text-center text-sm font-medium\">Qty</th>\n                <th className=\"px-3 py-2 text-right text-sm font-medium\">Rate</th>\n                <th className=\"px-3 py-2 text-right text-sm font-medium\">Amount</th>\n              </tr>\n            </thead>\n            <tbody>\n              {purchaseOrder.items.map((item, index) => (\n                <tr key={item.id} className=\"border-b border-slate-100\">\n                  <td className=\"px-3 py-3 text-sm\">{index + 1}</td>\n                  <td className=\"px-3 py-3\">\n                    <p className=\"font-medium text-sm\">{item.itemName}</p>\n                    {item.description && <p className=\"text-xs text-slate-500\">{item.description}</p>}\n                  </td>\n                  <td className=\"px-3 py-3 text-center text-sm\">{item.quantity.toLocaleString('en-IN')}</td>\n                  <td className=\"px-3 py-3 text-right text-sm\">{item.rate.toLocaleString('en-IN', { minimumFractionDigits: 2 })}</td>\n                  <td className=\"px-3 py-3 text-right text-sm font-medium\">{item.amount.toLocaleString('en-IN', { minimumFractionDigits: 2 })}</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n\n          <div className=\"flex justify-end mb-6\">\n            <div className=\"w-64 space-y-2\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-slate-500\">Sub Total</span>\n                <span>{purchaseOrder.subTotal.toLocaleString('en-IN', { minimumFractionDigits: 2 })}</span>\n              </div>\n              {purchaseOrder.taxAmount && purchaseOrder.taxAmount > 0 && (\n                <div className=\"flex justify-between text-sm\">\n                  <span className=\"text-slate-500\">IGST (18%)</span>\n                  <span>{purchaseOrder.taxAmount.toLocaleString('en-IN', { minimumFractionDigits: 2 })}</span>\n                </div>\n              )}\n              <div className=\"flex justify-between font-semibold border-t pt-2\">\n                <span>Total</span>\n                <span>{formatCurrency(purchaseOrder.total)}</span>\n              </div>\n            </div>\n          </div>\n\n          {purchaseOrder.termsAndConditions && (\n            <div className=\"mb-6\">\n              <h4 className=\"text-sm font-semibold mb-2\">Terms & Conditions</h4>\n              <div className=\"text-xs text-slate-600 space-y-1\">\n                {purchaseOrder.termsAndConditions.split('\\n').map((line, i) => (\n                  <p key={i}>{line}</p>\n                ))}\n              </div>\n            </div>\n          )}\n\n          <div className=\"mt-8\">\n            <div className=\"w-32 h-32 border-2 border-blue-600 rounded-full flex items-center justify-center mx-auto\">\n              <div className=\"text-center\">\n                <p className=\"text-xs text-blue-600 font-medium\">SKILLTONIT</p>\n                <p className=\"text-[8px] text-slate-500\">PVT. LTD.</p>\n              </div>\n            </div>\n            <p className=\"text-center text-sm mt-2\">Authorized Signature</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction PurchaseOrderDetailPanel({ \n  purchaseOrder, \n  onClose, \n  onEdit, \n  onDelete,\n  onConvertToBill\n}: { \n  purchaseOrder: PurchaseOrder; \n  onClose: () => void; \n  onEdit: () => void;\n  onDelete: () => void;\n  onConvertToBill: () => void;\n}) {\n  const [showPdfView, setShowPdfView] = useState(true);\n\n  return (\n    <div className=\"h-full flex flex-col bg-white border-l border-slate-200 overflow-hidden\">\n      <div className=\"flex items-center justify-between px-4 py-3 border-b border-slate-200 bg-slate-50\">\n        <h2 className=\"text-lg font-semibold text-slate-900\" data-testid=\"text-po-number\">{purchaseOrder.purchaseOrderNumber}</h2>\n        <div className=\"flex items-center gap-1\">\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n            <Download className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n            <Printer className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n            <Eye className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={onClose} data-testid=\"button-close-panel\">\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"flex items-center gap-2 px-4 py-2 border-b border-slate-200 overflow-x-auto bg-white\">\n        <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\" onClick={onEdit} data-testid=\"button-edit-po\">\n          <Pencil className=\"h-3.5 w-3.5\" />\n          Edit\n        </Button>\n        <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\">\n          <Mail className=\"h-3.5 w-3.5\" />\n          Send Email\n        </Button>\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\">\n              <FileText className=\"h-3.5 w-3.5\" />\n              PDF/Print\n              <ChevronDown className=\"h-3 w-3\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent>\n            <DropdownMenuItem>\n              <Download className=\"mr-2 h-4 w-4\" /> Download PDF\n            </DropdownMenuItem>\n            <DropdownMenuItem>\n              <Printer className=\"mr-2 h-4 w-4\" /> Print\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n        <Button \n          variant=\"outline\" \n          size=\"sm\" \n          className=\"h-8 gap-1.5\"\n          onClick={onConvertToBill}\n          data-testid=\"button-convert-to-bill\"\n        >\n          <ArrowRight className=\"h-3.5 w-3.5\" />\n          Convert to Bill\n        </Button>\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\" data-testid=\"button-more-actions\">\n              <MoreHorizontal className=\"h-3.5 w-3.5\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\">\n            <DropdownMenuItem className=\"text-red-600\" onClick={onDelete}>\n              <Trash2 className=\"mr-2 h-4 w-4\" />\n              Delete\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n      </div>\n\n      {purchaseOrder.billedStatus === 'YET TO BE BILLED' && (\n        <div className=\"px-4 py-3 bg-amber-50 border-b border-amber-100 flex items-center gap-2\">\n          <span className=\"text-amber-600 text-sm font-medium\">WHAT'S NEXT?</span>\n          <span className=\"text-sm text-slate-600\">Convert this to a bill to complete your purchase.</span>\n          <Button \n            size=\"sm\" \n            className=\"ml-auto bg-blue-600 hover:bg-blue-700\"\n            onClick={onConvertToBill}\n          >\n            Convert to Bill\n          </Button>\n        </div>\n      )}\n\n      <div className=\"px-4 py-3 border-b border-slate-200 flex items-center justify-between\">\n        <div className=\"flex items-center gap-4 text-sm\">\n          <span>\n            <span className=\"text-slate-500\">Receive Status:</span>{' '}\n            <span className=\"text-amber-600 font-medium\">{purchaseOrder.receiveStatus || 'YET TO BE RECEIVED'}</span>\n          </span>\n          <span>\n            <span className=\"text-slate-500\">Bill Status:</span>{' '}\n            <span className=\"text-amber-600 font-medium\">{purchaseOrder.billedStatus || 'YET TO BE BILLED'}</span>\n          </span>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Label htmlFor=\"pdf-view\" className=\"text-sm text-slate-500\">Show PDF View</Label>\n          <Switch id=\"pdf-view\" checked={showPdfView} onCheckedChange={setShowPdfView} />\n        </div>\n      </div>\n\n      <div className=\"flex-1 overflow-auto p-2\">\n        {showPdfView ? (\n          <div className=\"w-full\">\n            <PurchaseOrderPDFView purchaseOrder={purchaseOrder} />\n          </div>\n        ) : (\n          <div className=\"space-y-6\">\n            <div className=\"grid grid-cols-2 gap-4 text-sm\">\n              <div>\n                <span className=\"text-slate-500\">Vendor</span>\n                <p className=\"font-medium text-blue-600\">{purchaseOrder.vendorName}</p>\n              </div>\n              <div>\n                <span className=\"text-slate-500\">Date</span>\n                <p className=\"font-medium\">{formatDate(purchaseOrder.date)}</p>\n              </div>\n              <div>\n                <span className=\"text-slate-500\">Delivery Date</span>\n                <p className=\"font-medium\">{formatDate(purchaseOrder.deliveryDate || '')}</p>\n              </div>\n              <div>\n                <span className=\"text-slate-500\">Status</span>\n                <Badge variant=\"outline\" className=\"text-green-600 border-green-200\">\n                  {purchaseOrder.status}\n                </Badge>\n              </div>\n            </div>\n\n            <div>\n              <h4 className=\"font-semibold mb-2\">Items</h4>\n              <table className=\"w-full text-sm\">\n                <thead className=\"bg-slate-50\">\n                  <tr>\n                    <th className=\"px-2 py-1 text-left\">Item</th>\n                    <th className=\"px-2 py-1 text-center\">Qty</th>\n                    <th className=\"px-2 py-1 text-right\">Rate</th>\n                    <th className=\"px-2 py-1 text-right\">Amount</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {purchaseOrder.items.map((item) => (\n                    <tr key={item.id} className=\"border-b\">\n                      <td className=\"px-2 py-2\">{item.itemName}</td>\n                      <td className=\"px-2 py-2 text-center\">{item.quantity}</td>\n                      <td className=\"px-2 py-2 text-right\">{formatCurrency(item.rate)}</td>\n                      <td className=\"px-2 py-2 text-right\">{formatCurrency(item.amount)}</td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n\n            <div className=\"text-right space-y-1\">\n              <div className=\"flex justify-end gap-4 text-sm\">\n                <span className=\"text-slate-500\">Sub Total:</span>\n                <span className=\"w-28\">{formatCurrency(purchaseOrder.subTotal)}</span>\n              </div>\n              <div className=\"flex justify-end gap-4 text-sm font-semibold\">\n                <span>Total:</span>\n                <span className=\"w-28\">{formatCurrency(purchaseOrder.total)}</span>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n\n      <div className=\"border-t border-slate-200 p-3 text-center text-xs text-slate-500\">\n        PDF Template: <span className=\"text-blue-600\">{purchaseOrder.pdfTemplate || 'Standard Template'}</span>\n        <button className=\"text-blue-600 ml-2\">Change</button>\n      </div>\n    </div>\n  );\n}\n\nexport default function PurchaseOrders() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [purchaseOrders, setPurchaseOrders] = useState<PurchaseOrder[]>([]);\n  const [selectedPO, setSelectedPO] = useState<PurchaseOrder | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [poToDelete, setPoToDelete] = useState<string | null>(null);\n  const [selectedPOs, setSelectedPOs] = useState<string[]>([]);\n\n  useEffect(() => {\n    fetchPurchaseOrders();\n  }, []);\n\n  const fetchPurchaseOrders = async () => {\n    try {\n      const response = await fetch('/api/purchase-orders');\n      if (response.ok) {\n        const data = await response.json();\n        setPurchaseOrders(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch purchase orders:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchPODetail = async (id: string) => {\n    try {\n      const response = await fetch(`/api/purchase-orders/${id}`);\n      if (response.ok) {\n        const data = await response.json();\n        setSelectedPO(data.data);\n      }\n    } catch (error) {\n      console.error('Failed to fetch PO detail:', error);\n    }\n  };\n\n  const handlePOClick = (po: PurchaseOrder) => {\n    fetchPODetail(po.id);\n  };\n\n  const handleClosePanel = () => {\n    setSelectedPO(null);\n  };\n\n  const handleEditPO = () => {\n    if (selectedPO) {\n      setLocation(`/purchase-orders/${selectedPO.id}/edit`);\n    }\n  };\n\n  const handleDelete = (id: string) => {\n    setPoToDelete(id);\n    setDeleteDialogOpen(true);\n  };\n\n  const confirmDelete = async () => {\n    if (!poToDelete) return;\n    try {\n      const response = await fetch(`/api/purchase-orders/${poToDelete}`, { method: 'DELETE' });\n      if (response.ok) {\n        toast({ title: \"Purchase order deleted successfully\" });\n        fetchPurchaseOrders();\n        if (selectedPO?.id === poToDelete) {\n          handleClosePanel();\n        }\n      }\n    } catch (error) {\n      toast({ title: \"Failed to delete purchase order\", variant: \"destructive\" });\n    } finally {\n      setDeleteDialogOpen(false);\n      setPoToDelete(null);\n    }\n  };\n\n  const handleConvertToBill = async () => {\n    if (!selectedPO) return;\n    try {\n      // First update the PO status\n      const response = await fetch(`/api/purchase-orders/${selectedPO.id}/convert-to-bill`, {\n        method: 'POST'\n      });\n      if (response.ok) {\n        toast({ title: \"Converting purchase order to bill...\" });\n        // Refresh PO list to update status before navigating\n        await fetchPurchaseOrders();\n        // Navigate to bill create with all PO data\n        setLocation(`/bills/new?purchaseOrderId=${selectedPO.id}`);\n      }\n    } catch (error) {\n      toast({ title: \"Failed to convert to bill\", variant: \"destructive\" });\n    }\n  };\n\n  const toggleSelectPO = (id: string, e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (selectedPOs.includes(id)) {\n      setSelectedPOs(selectedPOs.filter(i => i !== id));\n    } else {\n      setSelectedPOs([...selectedPOs, id]);\n    }\n  };\n\n  const filteredPOs = purchaseOrders.filter(po =>\n    po.purchaseOrderNumber?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    po.vendorName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    po.referenceNumber?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const { currentPage, totalPages, totalItems, itemsPerPage, paginatedItems, goToPage } = usePagination(filteredPOs, 10);\n\n  const getStatusBadge = (status: string) => {\n    switch (status?.toUpperCase()) {\n      case 'ISSUED':\n        return <Badge variant=\"outline\" className=\"text-green-600 border-green-200 bg-green-50\">ISSUED</Badge>;\n      case 'DRAFT':\n        return <Badge variant=\"outline\" className=\"text-slate-600 border-slate-200\">DRAFT</Badge>;\n      case 'CLOSED':\n        return <Badge variant=\"outline\" className=\"text-blue-600 border-blue-200 bg-blue-50\">CLOSED</Badge>;\n      case 'CANCELLED':\n        return <Badge variant=\"outline\" className=\"text-red-600 border-red-200 bg-red-50\">CANCELLED</Badge>;\n      default:\n        return <Badge variant=\"outline\">{status}</Badge>;\n    }\n  };\n\n  return (\n    <div className=\"flex h-[calc(100vh-80px)] animate-in fade-in duration-300 w-full\">\n      <div className={`flex flex-col overflow-hidden transition-all duration-300 ${selectedPO ? 'w-[350px] min-w-[350px] flex-shrink-0' : 'flex-1 w-full'}`}>\n        <div className=\"flex items-center justify-between p-4 border-b border-slate-200\">\n          <div className=\"flex items-center gap-2\">\n            <h1 className=\"text-xl font-semibold text-slate-900\">All Purchase Orders</h1>\n            <ChevronDown className=\"h-4 w-4 text-slate-500\" />\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button \n              onClick={() => setLocation(\"/purchase-orders/new\")} \n              className=\"bg-blue-600 hover:bg-blue-700 gap-1.5 h-9\"\n              data-testid=\"button-new-po\"\n            >\n              <Plus className=\"h-4 w-4\" /> New\n            </Button>\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"outline\" size=\"icon\" className=\"h-9 w-9\" data-testid=\"button-more-options\">\n                  <MoreHorizontal className=\"h-4 w-4\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <DropdownMenuItem>\n                  <Download className=\"mr-2 h-4 w-4\" /> Export\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={fetchPurchaseOrders}>\n                  Refresh List\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </div>\n\n        {!selectedPO && (\n          <div className=\"px-4 py-3 flex items-center gap-2 border-b border-slate-200\">\n            <div className=\"relative flex-1 max-w-sm\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400\" />\n              <Input\n                placeholder=\"Search purchase orders...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-9\"\n                data-testid=\"input-search\"\n              />\n            </div>\n            <Button variant=\"outline\" className=\"gap-2\">\n              <Filter className=\"h-4 w-4\" /> Filter\n            </Button>\n          </div>\n        )}\n\n        <div className=\"flex-1 overflow-auto\">\n          {loading ? (\n            <div className=\"p-8 text-center text-slate-500\">Loading purchase orders...</div>\n          ) : filteredPOs.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-16 text-center\">\n              <div className=\"h-16 w-16 rounded-full bg-slate-100 flex items-center justify-center mb-4\">\n                <ClipboardList className=\"h-8 w-8 text-slate-400\" />\n              </div>\n              <h3 className=\"text-lg font-semibold mb-2\">No purchase orders yet</h3>\n              <p className=\"text-slate-500 mb-4 max-w-sm\">\n                Create purchase orders to formalize orders with your vendors and track deliveries.\n              </p>\n              <Button \n                onClick={() => setLocation(\"/purchase-orders/new\")} \n                className=\"bg-blue-600 hover:bg-blue-700\"\n                data-testid=\"button-create-first-po\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" /> Create Your First Purchase Order\n              </Button>\n            </div>\n          ) : selectedPO ? (\n            <div className=\"divide-y divide-slate-100\">\n              {paginatedItems.map((po) => (\n                <div \n                  key={po.id} \n                  className={`p-4 hover:bg-slate-50 cursor-pointer transition-colors ${\n                    selectedPO?.id === po.id ? 'bg-blue-50 border-l-2 border-l-blue-600' : ''\n                  }`}\n                  onClick={() => handlePOClick(po)}\n                  data-testid={`card-po-${po.id}`}\n                >\n                  <div className=\"flex items-start justify-between mb-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <Checkbox \n                        checked={selectedPOs.includes(po.id)}\n                        onClick={(e) => toggleSelectPO(po.id, e)}\n                      />\n                      <span className=\"font-medium text-blue-600\">{po.purchaseOrderNumber}</span>\n                    </div>\n                    {getStatusBadge(po.status)}\n                  </div>\n                  <div className=\"ml-6 text-sm text-slate-500\">\n                    <p>{po.vendorName}</p>\n                    <p className=\"font-medium text-slate-900\">{formatCurrency(po.total)}</p>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <Table>\n              <TableHeader className=\"bg-slate-50 sticky top-0\">\n                <TableRow>\n                  <TableHead className=\"w-12\">\n                    <Checkbox />\n                  </TableHead>\n                  <TableHead className=\"text-xs font-medium text-slate-500 uppercase\">Date</TableHead>\n                  <TableHead className=\"text-xs font-medium text-slate-500 uppercase\">Purchase Order#</TableHead>\n                  <TableHead className=\"text-xs font-medium text-slate-500 uppercase\">Reference#</TableHead>\n                  <TableHead className=\"text-xs font-medium text-slate-500 uppercase\">Vendor Name</TableHead>\n                  <TableHead className=\"text-xs font-medium text-slate-500 uppercase\">Status</TableHead>\n                  <TableHead className=\"text-xs font-medium text-slate-500 uppercase\">Billed Status</TableHead>\n                  <TableHead className=\"text-xs font-medium text-slate-500 uppercase text-right\">Amount</TableHead>\n                  <TableHead className=\"text-xs font-medium text-slate-500 uppercase\">Delivery Date</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {paginatedItems.map((po) => (\n                  <TableRow \n                    key={po.id} \n                    className=\"cursor-pointer hover:bg-slate-50\"\n                    onClick={() => handlePOClick(po)}\n                    data-testid={`row-po-${po.id}`}\n                  >\n                    <TableCell onClick={(e) => e.stopPropagation()}>\n                      <Checkbox \n                        checked={selectedPOs.includes(po.id)}\n                        onClick={(e) => toggleSelectPO(po.id, e)}\n                      />\n                    </TableCell>\n                    <TableCell className=\"text-sm\">{formatDate(po.date)}</TableCell>\n                    <TableCell className=\"text-sm font-medium text-blue-600\">{po.purchaseOrderNumber}</TableCell>\n                    <TableCell className=\"text-sm text-slate-500\">{po.referenceNumber || '-'}</TableCell>\n                    <TableCell className=\"text-sm\">{po.vendorName}</TableCell>\n                    <TableCell>{getStatusBadge(po.status)}</TableCell>\n                    <TableCell>\n                      <span className=\"text-xs text-slate-500\">{po.billedStatus || 'YET TO BE BILLED'}</span>\n                    </TableCell>\n                    <TableCell className=\"text-sm text-right font-medium\">{formatCurrency(po.total)}</TableCell>\n                    <TableCell className=\"text-sm text-slate-500\">{formatDate(po.deliveryDate || '')}</TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n          {filteredPOs.length > 0 && (\n            <TablePagination\n              currentPage={currentPage}\n              totalPages={totalPages}\n              totalItems={totalItems}\n              itemsPerPage={itemsPerPage}\n              onPageChange={goToPage}\n            />\n          )}\n        </div>\n      </div>\n\n      {selectedPO && (\n        <div className=\"flex-1 min-w-0 border-l border-slate-200 overflow-hidden\">\n          <PurchaseOrderDetailPanel \n            purchaseOrder={selectedPO}\n            onClose={handleClosePanel}\n            onEdit={handleEditPO}\n            onDelete={() => handleDelete(selectedPO.id)}\n            onConvertToBill={handleConvertToBill}\n          />\n        </div>\n      )}\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Purchase Order</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete this purchase order? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={confirmDelete} className=\"bg-red-600 hover:bg-red-700\">\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":29864,"size_tokens":null},"client/src/modules/sales/pages/QuoteCreatePage.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Plus, X, Search, Upload, Pencil, AlertCircle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { ManageSalespersonsDialog } from \"@/components/ManageSalespersonsDialog\";\nimport { useTransactionBootstrap } from \"@/hooks/use-transaction-bootstrap\";\nimport { formatAddressDisplay } from \"@/lib/customer-snapshot\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Badge } from \"@/components/ui/badge\";\n\ninterface Customer {\n  id: string;\n  name: string;\n  email: string;\n  billingAddress: any;\n  shippingAddress: any;\n}\n\ninterface Item {\n  id: string;\n  name: string;\n  description: string;\n  rate: string;\n  hsnSac: string;\n}\n\ninterface QuoteItem {\n  id: string;\n  itemId: string;\n  name: string;\n  description: string;\n  quantity: number;\n  rate: number;\n  discount: number;\n  discountType: string;\n  tax: string;\n  amount: number;\n}\n\nconst taxOptions = [\n  { value: \"none\", label: \"No Tax\" },\n  { value: \"GST0\", label: \"GST (0%)\" },\n  { value: \"GST5\", label: \"GST (5%)\" },\n  { value: \"GST12\", label: \"GST (12%)\" },\n  { value: \"GST18\", label: \"GST (18%)\" },\n  { value: \"GST28\", label: \"GST (28%)\" },\n];\n\nconst getTaxRate = (taxValue: string): number => {\n  const rates: Record<string, number> = {\n    \"none\": 0,\n    \"GST0\": 0,\n    \"GST5\": 5,\n    \"GST12\": 12,\n    \"GST18\": 18,\n    \"GST28\": 28,\n  };\n  return rates[taxValue] || 0;\n};\n\ninterface AttachedFile {\n  id: string;\n  name: string;\n  size: number;\n  type: string;\n  data: string;\n}\n\nexport default function QuoteCreatePage() {\n  const [location, setLocation] = useLocation();\n  \n  // Transaction bootstrap for auto-population\n  const {\n    customerId: bootstrapCustomerId,\n    customerSnapshot,\n    taxRegime,\n    isLoadingCustomer,\n    customerError,\n    formData: bootstrapFormData,\n    onCustomerChange\n  } = useTransactionBootstrap({ transactionType: 'quote' });\n  \n  const [customers, setCustomers] = useState<Customer[]>([]);\n  const [items, setItems] = useState<Item[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [nextQuoteNumber, setNextQuoteNumber] = useState(\"QT-000005\");\n  const [showManageSalespersons, setShowManageSalespersons] = useState(false);\n  const [salespersons, setSalespersons] = useState<{ id: string; name: string }[]>([]);\n  const [attachedFiles, setAttachedFiles] = useState<AttachedFile[]>([]);\n\n  const [formData, setFormData] = useState({\n    customerId: \"\",\n    customerName: \"\",\n    quoteNumber: \"\",\n    referenceNumber: \"\",\n    quoteDate: new Date().toISOString().split('T')[0],\n    expiryDate: \"\",\n    salesperson: \"\",\n    projectName: \"\",\n    subject: \"\",\n    customerNotes: \"Looking forward for your business.\",\n    termsAndConditions: \"\",\n    shippingCharges: 0,\n    tdsType: \"\",\n    adjustment: 0,\n    adjustmentDescription: \"\",\n  });\n  \n  // Sync with bootstrap customer\n  useEffect(() => {\n    if (bootstrapCustomerId && !formData.customerId) {\n      setFormData(prev => ({ ...prev, customerId: bootstrapCustomerId }));\n    }\n  }, [bootstrapCustomerId]);\n  \n  // Update form data when customer snapshot changes\n  useEffect(() => {\n    if (customerSnapshot) {\n      setFormData(prev => ({\n        ...prev,\n        customerName: customerSnapshot.displayName || customerSnapshot.customerName\n      }));\n    }\n  }, [customerSnapshot]);\n\n  const [quoteItems, setQuoteItems] = useState<QuoteItem[]>([\n    {\n      id: \"1\",\n      itemId: \"\",\n      name: \"\",\n      description: \"\",\n      quantity: 1,\n      rate: 0,\n      discount: 0,\n      discountType: \"percentage\",\n      tax: \"none\",\n      amount: 0,\n    }\n  ]);\n\n  useEffect(() => {\n    fetchCustomers();\n    fetchItems();\n    fetchNextQuoteNumber();\n    fetchSalespersons();\n    \n    // Handle clone parameter\n    const params = new URLSearchParams(location.split('?')[1]);\n    const cloneFromId = params.get('cloneFrom');\n    if (cloneFromId) {\n      fetchQuoteToClone(cloneFromId);\n    }\n  }, [location]);\n\n  const fetchQuoteToClone = async (quoteId: string) => {\n    try {\n      const response = await fetch(`/api/quotes/${quoteId}`);\n      if (response.ok) {\n        const data = await response.json();\n        const quote = data.data;\n\n        // Pre-populate form with cloned quote data\n        setFormData(prev => ({\n          ...prev,\n          customerId: quote.customerId || \"\",\n          customerName: quote.customerName || \"\",\n          referenceNumber: quote.referenceNumber || \"\",\n          quoteDate: new Date().toISOString().split('T')[0],\n          expiryDate: quote.expiryDate ? new Date(quote.expiryDate).toISOString().split('T')[0] : \"\",\n          salesperson: quote.salesperson || \"\",\n          projectName: quote.projectName || \"\",\n          subject: quote.subject || \"\",\n          customerNotes: quote.customerNotes || \"Looking forward for your business.\",\n          termsAndConditions: quote.termsAndConditions || \"\",\n          shippingCharges: quote.shippingCharges || 0,\n          adjustment: quote.adjustment || 0,\n        }));\n\n        // Pre-populate items\n        if (quote.items && quote.items.length > 0) {\n          const clonedItems = quote.items.map((item: any, index: number) => ({\n            id: String(Date.now() + index),\n            itemId: item.itemId || \"\",\n            name: item.name || \"\",\n            description: item.description || \"\",\n            quantity: item.quantity || 1,\n            rate: item.rate || 0,\n            discount: item.discount || 0,\n            discountType: item.discountType || \"percentage\",\n            tax: item.taxName || \"none\",\n            amount: item.amount || 0,\n          }));\n          setQuoteItems(clonedItems);\n        }\n      }\n    } catch (error) {\n      console.error('Failed to fetch quote for cloning:', error);\n    }\n  };\n\n  const fetchSalespersons = async () => {\n    try {\n      const response = await fetch('/api/salespersons');\n      if (response.ok) {\n        const data = await response.json();\n        setSalespersons(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch salespersons:', error);\n    }\n  };\n\n  const fetchCustomers = async () => {\n    try {\n      const response = await fetch('/api/customers');\n      if (response.ok) {\n        const data = await response.json();\n        setCustomers(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch customers:', error);\n    }\n  };\n\n  const fetchItems = async () => {\n    try {\n      const response = await fetch('/api/items');\n      if (response.ok) {\n        const data = await response.json();\n        setItems(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch items:', error);\n    }\n  };\n\n  const fetchNextQuoteNumber = async () => {\n    try {\n      const response = await fetch('/api/quotes/next-number');\n      if (response.ok) {\n        const data = await response.json();\n        setNextQuoteNumber(data.data?.quoteNumber || \"QT-000005\");\n        setFormData(prev => ({ ...prev, quoteNumber: data.data?.quoteNumber || \"QT-000005\" }));\n      }\n    } catch (error) {\n      console.error('Failed to fetch next quote number:', error);\n    }\n  };\n\n  const handleCustomerChange = (customerId: string) => {\n    const customer = customers.find(c => c.id === customerId);\n    if (customer) {\n      setFormData(prev => ({\n        ...prev,\n        customerId,\n        customerName: customer.name\n      }));\n    }\n  };\n\n  const handleItemChange = (index: number, itemId: string) => {\n    const item = items.find(i => i.id === itemId);\n    if (item) {\n      const updatedItems = [...quoteItems];\n      const rate = parseFloat(item.rate.replace(/[,]/g, '')) || 0;\n      updatedItems[index] = {\n        ...updatedItems[index],\n        itemId,\n        name: item.name,\n        description: item.description || '',\n        rate,\n        amount: rate * updatedItems[index].quantity\n      };\n      setQuoteItems(updatedItems);\n    }\n  };\n\n  const updateQuoteItem = (index: number, field: string, value: any) => {\n    const updatedItems = [...quoteItems];\n    updatedItems[index] = { ...updatedItems[index], [field]: value };\n\n    const quantity = updatedItems[index].quantity;\n    const rate = updatedItems[index].rate;\n    const discount = updatedItems[index].discount;\n    const discountType = updatedItems[index].discountType;\n\n    let subtotal = quantity * rate;\n    if (discountType === 'percentage') {\n      subtotal = subtotal - (subtotal * discount / 100);\n    } else {\n      subtotal = subtotal - discount;\n    }\n\n    updatedItems[index].amount = Math.max(0, subtotal);\n    setQuoteItems(updatedItems);\n  };\n\n  const addNewRow = () => {\n    setQuoteItems([\n      ...quoteItems,\n      {\n        id: String(Date.now()),\n        itemId: \"\",\n        name: \"\",\n        description: \"\",\n        quantity: 1,\n        rate: 0,\n        discount: 0,\n        discountType: \"percentage\",\n        tax: \"none\",\n        amount: 0,\n      }\n    ]);\n  };\n\n  const removeRow = (index: number) => {\n    if (quoteItems.length > 1) {\n      setQuoteItems(quoteItems.filter((_, i) => i !== index));\n    }\n  };\n\n  const calculateSubTotal = () => {\n    return quoteItems.reduce((sum, item) => sum + item.amount, 0);\n  };\n\n  const calculateTax = () => {\n    return quoteItems.reduce((sum, item) => {\n      const taxRate = getTaxRate(item.tax);\n      return sum + (item.amount * taxRate / 100);\n    }, 0);\n  };\n\n  const calculateTotal = () => {\n    const subTotal = calculateSubTotal();\n    const tax = calculateTax();\n    const shipping = formData.shippingCharges || 0;\n    const adjustment = formData.adjustment || 0;\n    return subTotal + tax + shipping + adjustment;\n  };\n\n  const handleSubmit = async (status: string) => {\n    setLoading(true);\n    try {\n      const subTotal = calculateSubTotal();\n      const taxAmount = calculateTax();\n\n      const quoteData = {\n        customerId: formData.customerId,\n        customerName: formData.customerName,\n        referenceNumber: formData.referenceNumber,\n        date: formData.quoteDate,\n        expiryDate: formData.expiryDate,\n        salesperson: formData.salesperson,\n        projectName: formData.projectName,\n        subject: formData.subject,\n        items: quoteItems.filter(item => item.itemId).map(item => ({\n          id: item.id,\n          itemId: item.itemId,\n          name: item.name,\n          description: item.description,\n          quantity: item.quantity,\n          unit: \"\",\n          rate: item.rate,\n          discount: item.discount,\n          discountType: item.discountType,\n          tax: getTaxRate(item.tax),\n          taxName: item.tax,\n          amount: item.amount\n        })),\n        subTotal,\n        shippingCharges: formData.shippingCharges,\n        cgst: taxAmount / 2,\n        sgst: taxAmount / 2,\n        igst: 0,\n        adjustment: formData.adjustment,\n        total: calculateTotal(),\n        customerNotes: formData.customerNotes,\n        termsAndConditions: formData.termsAndConditions,\n        status,\n        createdBy: \"Admin User\",\n        attachments: attachedFiles.map(f => ({ id: f.id, name: f.name, size: f.size, type: f.type }))\n      };\n\n      const response = await fetch('/api/quotes', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(quoteData)\n      });\n\n      if (response.ok) {\n        setLocation('/quotes');\n      } else {\n        console.error('Failed to create quote');\n      }\n    } catch (error) {\n      console.error('Error creating quote:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const formatCurrency = (amount: number) => {\n    return amount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n  };\n\n  const handleFileUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = event.target.files;\n    if (!files) return;\n\n    const maxFiles = 5;\n    const maxSize = 10 * 1024 * 1024;\n\n    if (attachedFiles.length + files.length > maxFiles) {\n      alert(`You can only upload a maximum of ${maxFiles} files`);\n      return;\n    }\n\n    Array.from(files).forEach(file => {\n      if (file.size > maxSize) {\n        alert(`File ${file.name} exceeds 10MB limit`);\n        return;\n      }\n\n      const reader = new FileReader();\n      reader.onload = () => {\n        const newFile: AttachedFile = {\n          id: String(Date.now() + Math.random()),\n          name: file.name,\n          size: file.size,\n          type: file.type,\n          data: reader.result as string\n        };\n        setAttachedFiles(prev => [...prev, newFile]);\n      };\n      reader.readAsDataURL(file);\n    });\n\n    event.target.value = '';\n  };\n\n  const removeFile = (fileId: string) => {\n    setAttachedFiles(prev => prev.filter(f => f.id !== fileId));\n  };\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes < 1024) return bytes + ' B';\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\n    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\n  };\n\n  return (\n    <div className=\"max-w-5xl mx-auto py-6 animate-in fade-in duration-300\">\n      <h1 className=\"text-2xl font-semibold text-slate-900 mb-6\">New Quote</h1>\n\n      <div className=\"space-y-6\">\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-red-600\">Customer Name*</Label>\n            <Select value={formData.customerId} onValueChange={handleCustomerChange}>\n              <SelectTrigger className=\"bg-blue-50 border-blue-200\">\n                <SelectValue placeholder=\"Select or add a customer\" />\n              </SelectTrigger>\n              <SelectContent>\n                {customers.map(customer => (\n                  <SelectItem key={customer.id} value={customer.id}>\n                    {customer.name}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n          <div className=\"flex justify-end\">\n            <Button variant=\"outline\" size=\"icon\" className=\"h-10 w-10\">\n              <Search className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-red-600\">Quote#*</Label>\n            <div className=\"flex gap-2\">\n              <Input\n                value={formData.quoteNumber || nextQuoteNumber}\n                onChange={(e) => setFormData(prev => ({ ...prev, quoteNumber: e.target.value }))}\n                className=\"flex-1\"\n              />\n              <Button variant=\"outline\" size=\"icon\" className=\"h-10 w-10\">\n                <Pencil className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Reference#</Label>\n            <Input\n              value={formData.referenceNumber}\n              onChange={(e) => setFormData(prev => ({ ...prev, referenceNumber: e.target.value }))}\n            />\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-red-600\">Quote Date*</Label>\n            <Input\n              type=\"date\"\n              value={formData.quoteDate}\n              onChange={(e) => setFormData(prev => ({ ...prev, quoteDate: e.target.value }))}\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Expiry Date</Label>\n            <Input\n              type=\"date\"\n              value={formData.expiryDate}\n              onChange={(e) => setFormData(prev => ({ ...prev, expiryDate: e.target.value }))}\n            />\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-2\">\n            <Label>Salesperson</Label>\n            <Select value={formData.salesperson} onValueChange={(v) => {\n              if (v === \"manage_salespersons\") {\n                setShowManageSalespersons(true);\n              } else {\n                setFormData(prev => ({ ...prev, salesperson: v }));\n              }\n            }}>\n              <SelectTrigger>\n                <SelectValue placeholder=\"Select or Add Salesperson\" />\n              </SelectTrigger>\n              <SelectContent>\n                <div className=\"p-2\">\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\n                    <Input placeholder=\"Search\" className=\"pl-8 h-9\" />\n                  </div>\n                </div>\n                {salespersons.map(sp => (\n                  <SelectItem key={sp.id} value={sp.name}>{sp.name}</SelectItem>\n                ))}\n                <div\n                  className=\"flex items-center gap-2 p-2 text-sm text-blue-600 cursor-pointer hover:bg-slate-100 border-t mt-1\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    setShowManageSalespersons(true);\n                  }}\n                >\n                  <Plus className=\"h-4 w-4\" />\n                  Manage Salespersons\n                </div>\n              </SelectContent>\n            </Select>\n          </div>\n          {/* Project Name field hidden as per requirements */}\n          {/* <div className=\"space-y-2\">\n            <Label>Project Name</Label>\n            <Select value={formData.projectName} onValueChange={(v) => setFormData(prev => ({ ...prev, projectName: v }))}>\n              <SelectTrigger>\n                <SelectValue placeholder=\"Select a project\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"default\">Default Project</SelectItem>\n              </SelectContent>\n            </Select>\n            <p className=\"text-xs text-slate-500\">Select a customer to associate a project.</p>\n          </div> */}\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label>Subject</Label>\n          <div className=\"flex gap-2\">\n            <Input\n              value={formData.subject}\n              onChange={(e) => setFormData(prev => ({ ...prev, subject: e.target.value }))}\n              placeholder=\"Let your customer know what this Quote is for\"\n              className=\"flex-1\"\n            />\n            <Button variant=\"outline\" size=\"icon\" className=\"h-10 w-10\">\n              <Pencil className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"border border-slate-200 rounded-lg overflow-hidden\">\n          <div className=\"bg-slate-50 px-4 py-2 font-medium text-sm text-slate-700\">\n            Item Table\n          </div>\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead className=\"bg-slate-50 border-b border-slate-200\">\n                <tr>\n                  <th className=\"px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase w-8\"></th>\n                  <th className=\"px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase\">Item Details</th>\n                  <th className=\"px-4 py-2 text-center text-xs font-medium text-slate-500 uppercase w-24\">Quantity</th>\n                  <th className=\"px-4 py-2 text-right text-xs font-medium text-slate-500 uppercase w-28\">Rate ()</th>\n                  <th className=\"px-4 py-2 text-center text-xs font-medium text-slate-500 uppercase w-28\">Discount</th>\n                  <th className=\"px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase w-32\">Tax</th>\n                  <th className=\"px-4 py-2 text-right text-xs font-medium text-slate-500 uppercase w-24\">Tax Amt</th>\n                  <th className=\"px-4 py-2 text-right text-xs font-medium text-slate-500 uppercase w-28\">Amount</th>\n                  <th className=\"px-4 py-2 w-10\"></th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-slate-100\">\n                {quoteItems.map((item, index) => (\n                  <tr key={item.id}>\n                    <td className=\"px-4 py-2 text-slate-400\">::</td>\n                    <td className=\"px-4 py-2\">\n                      <Select value={item.itemId} onValueChange={(v) => handleItemChange(index, v)}>\n                        <SelectTrigger className=\"border-dashed\">\n                          <SelectValue placeholder=\"Type or click to select an item.\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {items.map(i => (\n                            <SelectItem key={i.id} value={i.id}>{i.name}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <Input\n                        type=\"number\"\n                        min=\"1\"\n                        value={item.quantity}\n                        onChange={(e) => updateQuoteItem(index, 'quantity', parseFloat(e.target.value) || 1)}\n                        className=\"text-center\"\n                      />\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <Input\n                        type=\"number\"\n                        min=\"0\"\n                        step=\"0.01\"\n                        value={item.rate}\n                        onChange={(e) => updateQuoteItem(index, 'rate', parseFloat(e.target.value) || 0)}\n                        className=\"text-right\"\n                      />\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <div className=\"flex items-center gap-1\">\n                        <Input\n                          type=\"number\"\n                          min=\"0\"\n                          value={item.discount}\n                          onChange={(e) => updateQuoteItem(index, 'discount', parseFloat(e.target.value) || 0)}\n                          className=\"w-16 text-center\"\n                        />\n                        <Select\n                          value={item.discountType}\n                          onValueChange={(v) => updateQuoteItem(index, 'discountType', v)}\n                        >\n                          <SelectTrigger className=\"w-14\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"percentage\">%</SelectItem>\n                            <SelectItem value=\"amount\"></SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <Select value={item.tax} onValueChange={(v) => updateQuoteItem(index, 'tax', v)}>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select a Tax\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {taxOptions.map(tax => (\n                            <SelectItem key={tax.value} value={tax.value}>{tax.label}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </td>\n                    <td className=\"px-4 py-2 text-right text-xs text-slate-500\">\n                      {getTaxRate(item.tax) > 0 ? (\n                        <span>{formatCurrency(item.amount * getTaxRate(item.tax) / 100)} ({getTaxRate(item.tax)}%)</span>\n                      ) : '-'}\n                    </td>\n                    <td className=\"px-4 py-2 text-right font-medium\">\n                      {formatCurrency(item.amount + (item.amount * getTaxRate(item.tax) / 100))}\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"h-8 w-8 text-red-500 hover:text-red-700\"\n                        onClick={() => removeRow(index)}\n                      >\n                        <X className=\"h-4 w-4\" />\n                      </Button>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n          <div className=\"px-4 py-3 flex gap-4\">\n            <Button variant=\"link\" className=\"text-blue-600 p-0 h-auto\" onClick={addNewRow}>\n              <Plus className=\"h-4 w-4 mr-1\" />\n              Add New Row\n            </Button>\n            <Button variant=\"link\" className=\"text-blue-600 p-0 h-auto\">\n              <Plus className=\"h-4 w-4 mr-1\" />\n              Add Items in Bulk\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-8\">\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label>Customer Notes</Label>\n              <Textarea\n                value={formData.customerNotes}\n                onChange={(e) => setFormData(prev => ({ ...prev, customerNotes: e.target.value }))}\n                placeholder=\"Looking forward for your business.\"\n                className=\"min-h-[80px]\"\n              />\n            </div>\n          </div>\n\n          <div className=\"space-y-3\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-slate-600\">Sub Total</span>\n              <span className=\"font-medium\">{formatCurrency(calculateSubTotal())}</span>\n            </div>\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-slate-600\">Shipping Charges</span>\n              <Input\n                type=\"number\"\n                min=\"0\"\n                step=\"0.01\"\n                value={formData.shippingCharges}\n                onChange={(e) => setFormData(prev => ({ ...prev, shippingCharges: parseFloat(e.target.value) || 0 }))}\n                className=\"w-32 text-right\"\n              />\n            </div>\n            {/* TDS and TCS fields hidden as per requirements */}\n            {/* <div className=\"flex justify-between items-center\">\n              <div className=\"flex items-center gap-2\">\n                <Checkbox id=\"tds\" />\n                <Label htmlFor=\"tds\" className=\"text-slate-600\">TDS</Label>\n                <Checkbox id=\"tcs\" />\n                <Label htmlFor=\"tcs\" className=\"text-slate-600\">TCS</Label>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Select>\n                  <SelectTrigger className=\"w-32\">\n                    <SelectValue placeholder=\"Select a Tax\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"none\">None</SelectItem>\n                  </SelectContent>\n                </Select>\n                <span className=\"text-slate-500\">- 0.00</span>\n              </div>\n            </div> */}\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-slate-600\">Adjustment</span>\n              <Input\n                type=\"number\"\n                step=\"0.01\"\n                value={formData.adjustment}\n                onChange={(e) => setFormData(prev => ({ ...prev, adjustment: parseFloat(e.target.value) || 0 }))}\n                className=\"w-32 text-right\"\n              />\n            </div>\n            <div className=\"flex justify-between items-center pt-3 border-t border-slate-200\">\n              <span className=\"font-semibold\">Total (  )</span>\n              <span className=\"font-bold text-lg\">{formatCurrency(calculateTotal())}</span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"border-t border-slate-200 pt-6\">\n          <div className=\"grid grid-cols-2 gap-8\">\n            <div className=\"space-y-2\">\n              <Label>Terms & Conditions</Label>\n              <Textarea\n                value={formData.termsAndConditions}\n                onChange={(e) => setFormData(prev => ({ ...prev, termsAndConditions: e.target.value }))}\n                placeholder=\"Enter the terms and conditions of your business to be displayed in your transaction\"\n                className=\"min-h-[100px]\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Attach File(s) to Quote</Label>\n              <div className=\"border-2 border-dashed border-slate-200 rounded-lg p-4 text-center\">\n                <input\n                  type=\"file\"\n                  id=\"file-upload\"\n                  multiple\n                  className=\"hidden\"\n                  onChange={handleFileUpload}\n                  accept=\".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg\"\n                  data-testid=\"input-file-upload\"\n                />\n                <label htmlFor=\"file-upload\">\n                  <Button variant=\"outline\" className=\"gap-2\" type=\"button\" onClick={() => document.getElementById('file-upload')?.click()}>\n                    <Upload className=\"h-4 w-4\" />\n                    Upload File\n                  </Button>\n                </label>\n                <p className=\"text-xs text-slate-500 mt-2\">You can upload a maximum of 5 files, 10MB each</p>\n              </div>\n              {attachedFiles.length > 0 && (\n                <div className=\"space-y-2 mt-3\">\n                  {attachedFiles.map(file => (\n                    <div key={file.id} className=\"flex items-center justify-between bg-slate-50 rounded-lg px-3 py-2\" data-testid={`file-item-${file.id}`}>\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"w-8 h-8 bg-blue-100 rounded flex items-center justify-center\">\n                          <Upload className=\"h-4 w-4 text-blue-600\" />\n                        </div>\n                        <div>\n                          <p className=\"text-sm font-medium text-slate-700\">{file.name}</p>\n                          <p className=\"text-xs text-slate-500\">{formatFileSize(file.size)}</p>\n                        </div>\n                      </div>\n                      <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={() => removeFile(file.id)} data-testid={`button-remove-file-${file.id}`}>\n                        <X className=\"h-4 w-4 text-red-500\" />\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n\n        <p className=\"text-sm text-slate-500\">\n          Additional Fields: Start adding custom fields for your quotes by going to Settings  Sales  Quotes.\n        </p>\n\n        <div className=\"flex items-center gap-3 pt-4 border-t border-slate-200\">\n          <Button\n            variant=\"outline\"\n            onClick={() => handleSubmit('DRAFT')}\n            disabled={loading}\n          >\n            Save as Draft\n          </Button>\n          <Button\n            className=\"bg-blue-600 hover:bg-blue-700\"\n            onClick={() => handleSubmit('SENT')}\n            disabled={loading}\n          >\n            Send\n          </Button>\n          <Button\n            variant=\"ghost\"\n            onClick={() => setLocation('/quotes')}\n          >\n            Cancel\n          </Button>\n        </div>\n      </div>\n\n      <ManageSalespersonsDialog\n        open={showManageSalespersons}\n        onOpenChange={setShowManageSalespersons}\n        onSalespersonChange={fetchSalespersons}\n      />\n    </div >\n  );\n}\n","path":null,"size_bytes":31930,"size_tokens":null},"client/src/pages/vendor-create.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Plus, Trash2, HelpCircle, Upload, Link as LinkIcon, Search, Check, X, Paperclip } from \"lucide-react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\n\nconst SALUTATIONS = [\"Mr.\", \"Mrs.\", \"Ms.\", \"Miss\", \"Dr.\"];\n\nconst GST_TREATMENTS = [\n  { value: \"registered-regular\", label: \"Registered Business - Regular\" },\n  { value: \"registered-composition\", label: \"Registered Business - Composition\" },\n  { value: \"unregistered\", label: \"Unregistered Business\" },\n  { value: \"consumer\", label: \"Consumer\" },\n  { value: \"overseas\", label: \"Overseas\" },\n  { value: \"sez\", label: \"Special Economic Zone\" },\n  { value: \"deemed-export\", label: \"Deemed Export\" },\n];\n\nconst INDIAN_STATES = [\n  \"[AN] - Andaman and Nicobar Islands\",\n  \"[AP] - Andhra Pradesh\",\n  \"[AR] - Arunachal Pradesh\",\n  \"[AS] - Assam\",\n  \"[BR] - Bihar\",\n  \"[CG] - Chhattisgarh\",\n  \"[CH] - Chandigarh\",\n  \"[DD] - Daman and Diu\",\n  \"[DL] - Delhi\",\n  \"[GA] - Goa\",\n  \"[GJ] - Gujarat\",\n  \"[HP] - Himachal Pradesh\",\n  \"[HR] - Haryana\",\n  \"[JH] - Jharkhand\",\n  \"[JK] - Jammu and Kashmir\",\n  \"[KA] - Karnataka\",\n  \"[KL] - Kerala\",\n  \"[LA] - Ladakh\",\n  \"[LD] - Lakshadweep\",\n  \"[MH] - Maharashtra\",\n  \"[ML] - Meghalaya\",\n  \"[MN] - Manipur\",\n  \"[MP] - Madhya Pradesh\",\n  \"[MZ] - Mizoram\",\n  \"[NL] - Nagaland\",\n  \"[OR] - Odisha\",\n  \"[PB] - Punjab\",\n  \"[PY] - Puducherry\",\n  \"[RJ] - Rajasthan\",\n  \"[SK] - Sikkim\",\n  \"[TN] - Tamil Nadu\",\n  \"[TS] - Telangana\",\n  \"[TR] - Tripura\",\n  \"[UK] - Uttarakhand\",\n  \"[UP] - Uttar Pradesh\",\n  \"[WB] - West Bengal\",\n];\n\nconst PAYMENT_TERMS = [\n  \"Due on Receipt\",\n  \"Net 15\",\n  \"Net 30\",\n  \"Net 45\",\n  \"Net 60\",\n  \"Due end of the month\",\n  \"Due end of next month\",\n];\n\nconst CURRENCIES = [\n  { value: \"INR\", label: \"INR - Indian Rupee\" },\n  { value: \"USD\", label: \"USD - US Dollar\" },\n  { value: \"EUR\", label: \"EUR - Euro\" },\n  { value: \"GBP\", label: \"GBP - British Pound\" },\n];\n\nconst MSME_REGISTRATION_TYPES = [\n  { value: \"micro\", label: \"Micro\" },\n  { value: \"small\", label: \"Small\" },\n  { value: \"medium\", label: \"Medium\" },\n];\n\nconst TDS_OPTIONS = [\n  { value: \"none\", label: \"None\", rate: \"\" },\n  { value: \"commission-brokerage-2\", label: \"Commission or Brokerage\", rate: \"2%\" },\n  { value: \"commission-brokerage-reduced\", label: \"Commission or Brokerage (Reduced)\", rate: \"3.75%\" },\n  { value: \"dividend-10\", label: \"Dividend\", rate: \"10%\" },\n  { value: \"dividend-reduced\", label: \"Dividend (Reduced)\", rate: \"7.5%\" },\n  { value: \"interest-other-10\", label: \"Other Interest than Securities\", rate: \"10%\" },\n  { value: \"interest-other-reduced\", label: \"Other Interest than Securities (Reduced)\", rate: \"7.5%\" },\n  { value: \"contractors-others-2\", label: \"Payment of Contractors for Others\", rate: \"2%\" },\n  { value: \"contractors-others-reduced\", label: \"Payment of Contractors for Others (Reduced)\", rate: \"1.5%\" },\n  { value: \"contractors-huf-1\", label: \"Payment of Contractors HUF/Indiv\", rate: \"1%\" },\n  { value: \"contractors-huf-reduced\", label: \"Payment of Contractors HUF/Indiv (Reduced)\", rate: \"0.75%\" },\n  { value: \"professional-fees-10\", label: \"Professional Fees\", rate: \"10%\" },\n  { value: \"professional-fees-reduced\", label: \"Professional Fees (Reduced)\", rate: \"7.5%\" },\n  { value: \"rent-land-furniture-10\", label: \"Rent on Land or Furniture etc\", rate: \"10%\" },\n  { value: \"rent-land-furniture-reduced\", label: \"Rent on Land or Furniture etc (Reduced)\", rate: \"7.5%\" },\n  { value: \"technical-fees-2\", label: \"Technical Fees\", rate: \"2%\" },\n];\n\nconst ACCOUNTS = [\n  \"Cost Of Goods Sold\",\n  \"Cost of Goods Sold\",\n  \"Job Costing\",\n  \"Labor\",\n  \"Materials\",\n  \"Subcontractor\",\n  \"Expense\",\n  \"Advertising And Marketing\",\n  \"Automobile Expense\",\n  \"Bad Debt\",\n  \"Bank Fees and Charges\",\n  \"Consultant Expense\",\n  \"Contract Assets\",\n  \"Credit Card Charges\",\n  \"Depreciation And Amortisation\",\n  \"Depreciation Expense\",\n  \"IT and Internet Expenses\",\n  \"Janitorial Expense\",\n  \"Lodging\",\n  \"Meals and Entertainment\",\n  \"Merchandise\",\n  \"Office Supplies\",\n  \"Other Expenses\",\n  \"Postage\",\n  \"Printing and Stationery\",\n  \"Purchase Discounts\",\n  \"Raw Materials And Consumables\",\n  \"Rent Expense\",\n  \"Repairs and Maintenance\",\n  \"Salaries and Employee Wages\",\n  \"Telephone Expense\",\n  \"Transportation Expense\",\n  \"Travel Expense\",\n  \"Non Current Liability\",\n  \"Construction Loans\",\n  \"Mortgages\",\n  \"Other Current Liability\",\n  \"Employee Reimbursements\",\n  \"GST Payable\",\n  \"Output CGST\",\n  \"Output IGST\",\n  \"Output SGST\",\n  \"Tax Payable\",\n  \"TDS Payable\",\n  \"Fixed Asset\",\n  \"Furniture and Equipment\",\n  \"Other Current Asset\",\n  \"Advance Tax\",\n  \"Employee Advance\",\n  \"Input Tax Credits\",\n  \"Input CGST\",\n  \"Input IGST\",\n  \"Input SGST\",\n  \"Prepaid Expenses\",\n  \"TDS Receivable\",\n];\n\ninterface ContactPerson {\n  id: string;\n  salutation: string;\n  firstName: string;\n  lastName: string;\n  email: string;\n  workPhone: string;\n  mobile: string;\n}\n\nexport default function VendorCreate() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState(\"other-details\");\n  const [saving, setSaving] = useState(false);\n  const [tdsOpen, setTdsOpen] = useState(false);\n  const [accountsOpen, setAccountsOpen] = useState(false);\n  const [showCreateAccountDialog, setShowCreateAccountDialog] = useState(false);\n  const [newAccountName, setNewAccountName] = useState(\"\");\n  const [uploadedFiles, setUploadedFiles] = useState<File[]>([]);\n  const [showAttachmentsDialog, setShowAttachmentsDialog] = useState(false);\n  const [newAttachments, setNewAttachments] = useState<File[]>([]);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const attachmentInputRef = useRef<HTMLInputElement>(null);\n\n  const [formData, setFormData] = useState({\n    salutation: \"\",\n    firstName: \"\",\n    lastName: \"\",\n    companyName: \"\",\n    displayName: \"\",\n    email: \"\",\n    workPhone: \"\",\n    mobile: \"\",\n    gstTreatment: \"\",\n    sourceOfSupply: \"\",\n    pan: \"\",\n    expenseAccount: \"\",\n    msmeRegistered: false,\n    msmeRegistrationType: \"\",\n    msmeRegistrationNumber: \"\",\n    currency: \"INR\",\n    openingBalance: \"\",\n    paymentTerms: \"Due on Receipt\",\n    tds: \"\",\n    billingAddress: {\n      attention: \"\",\n      countryRegion: \"\",\n      street1: \"\",\n      street2: \"\",\n      city: \"\",\n      state: \"\",\n      pinCode: \"\",\n      phone: \"\",\n      faxNumber: \"\",\n    },\n    shippingAddress: {\n      attention: \"\",\n      countryRegion: \"\",\n      street1: \"\",\n      street2: \"\",\n      city: \"\",\n      state: \"\",\n      pinCode: \"\",\n      phone: \"\",\n      faxNumber: \"\",\n    },\n    bankDetails: {\n      accountHolderName: \"\",\n      bankName: \"\",\n      accountNumber: \"\",\n      ifscCode: \"\",\n      swiftCode: \"\",\n      branchName: \"\",\n    },\n    remarks: \"\",\n  });\n\n  const [contactPersons, setContactPersons] = useState<ContactPerson[]>([]);\n\n  const handleInputChange = (field: string, value: any) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n  };\n\n  const handleAddressChange = (type: 'billingAddress' | 'shippingAddress', field: string, value: string) => {\n    setFormData(prev => ({\n      ...prev,\n      [type]: { ...prev[type], [field]: value }\n    }));\n  };\n\n  const handleBankDetailsChange = (field: string, value: string) => {\n    setFormData(prev => ({\n      ...prev,\n      bankDetails: { ...prev.bankDetails, [field]: value }\n    }));\n  };\n\n  const copyBillingToShipping = () => {\n    setFormData(prev => ({\n      ...prev,\n      shippingAddress: { ...prev.billingAddress }\n    }));\n  };\n\n  const addContactPerson = () => {\n    setContactPersons(prev => [...prev, {\n      id: Date.now().toString(),\n      salutation: \"\",\n      firstName: \"\",\n      lastName: \"\",\n      email: \"\",\n      workPhone: \"\",\n      mobile: \"\",\n    }]);\n  };\n\n  const updateContactPerson = (id: string, field: string, value: string) => {\n    setContactPersons(prev => prev.map(cp => \n      cp.id === id ? { ...cp, [field]: value } : cp\n    ));\n  };\n\n  const removeContactPerson = (id: string) => {\n    setContactPersons(prev => prev.filter(cp => cp.id !== id));\n  };\n\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (files) {\n      const newFiles = Array.from(files);\n      const totalFiles = uploadedFiles.length + newFiles.length;\n      \n      if (totalFiles > 10) {\n        toast({ title: \"Maximum 10 files allowed\", variant: \"destructive\" });\n        return;\n      }\n\n      const validFiles = newFiles.filter(file => {\n        if (file.size > 10 * 1024 * 1024) {\n          toast({ title: `${file.name} exceeds 10MB limit`, variant: \"destructive\" });\n          return false;\n        }\n        return true;\n      });\n\n      setUploadedFiles(prev => [...prev, ...validFiles]);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  const removeFile = (index: number) => {\n    setUploadedFiles(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const handleAttachmentUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (files) {\n      const newFiles = Array.from(files);\n      if (newAttachments.length + newFiles.length > 10) {\n        toast({ title: \"Maximum 10 files allowed\", variant: \"destructive\" });\n        return;\n      }\n      const validFiles = newFiles.filter(file => {\n        if (file.size > 10 * 1024 * 1024) {\n          toast({ title: `${file.name} exceeds 10MB limit`, variant: \"destructive\" });\n          return false;\n        }\n        return true;\n      });\n      setNewAttachments(prev => [...prev, ...validFiles]);\n      if (attachmentInputRef.current) attachmentInputRef.current.value = '';\n    }\n  };\n\n  const removeAttachment = (index: number) => {\n    setNewAttachments(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const handleCreateAccount = () => {\n    if (!newAccountName.trim()) {\n      toast({ title: \"Account name is required\", variant: \"destructive\" });\n      return;\n    }\n    handleInputChange('expenseAccount', newAccountName);\n    setShowCreateAccountDialog(false);\n    setNewAccountName(\"\");\n    toast({ title: \"Account created and selected\" });\n  };\n\n  const handleSave = async () => {\n    if (!formData.displayName) {\n      toast({ title: \"Display Name is required\", variant: \"destructive\" });\n      return;\n    }\n\n    if (!formData.gstTreatment) {\n      toast({ title: \"GST Treatment is required\", variant: \"destructive\" });\n      return;\n    }\n\n    if (!formData.sourceOfSupply) {\n      toast({ title: \"Source of Supply is required\", variant: \"destructive\" });\n      return;\n    }\n\n    if (formData.msmeRegistered) {\n      if (!formData.msmeRegistrationType) {\n        toast({ title: \"MSME/Udyam Registration Type is required\", variant: \"destructive\" });\n        return;\n      }\n      if (!formData.msmeRegistrationNumber) {\n        toast({ title: \"MSME/Udyam Registration Number is required\", variant: \"destructive\" });\n        return;\n      }\n      if (!/^UDYAM-[A-Z]{2}-\\d{2}-\\d{7}$/.test(formData.msmeRegistrationNumber)) {\n        toast({ title: \"Invalid MSME/Udyam Registration Number format\", variant: \"destructive\" });\n        return;\n      }\n    }\n\n    setSaving(true);\n    try {\n      const payload = {\n        ...formData,\n        contactPersons,\n        openingBalance: formData.openingBalance ? parseFloat(formData.openingBalance) : 0,\n      };\n\n      const response = await fetch('/api/vendors', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      });\n\n      if (response.ok) {\n        toast({ title: \"Vendor created successfully\" });\n        setLocation('/vendors');\n      } else {\n        const error = await response.json();\n        toast({ title: error.message || \"Failed to create vendor\", variant: \"destructive\" });\n      }\n    } catch (error) {\n      toast({ title: \"Failed to create vendor\", variant: \"destructive\" });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  return (\n    <div className=\"h-full flex flex-col bg-white\">\n      <div className=\"border-b border-slate-200 px-6 py-4\">\n        <h1 className=\"text-2xl font-semibold text-slate-900\">New Vendor</h1>\n      </div>\n\n      <div className=\"flex-1 overflow-auto\">\n        <div className=\"max-w-4xl mx-auto p-6 space-y-6\">\n          <div className=\"bg-blue-50 border border-blue-200 rounded-md px-4 py-3 flex items-center gap-2\">\n            <LinkIcon className=\"h-4 w-4 text-blue-600\" />\n            <span className=\"text-sm text-blue-800\">\n              Prefill Vendor details from the GST portal using the Vendor's GSTIN.{\" \"}\n              <a href=\"#\" className=\"text-blue-600 hover:underline\">Prefill</a>\n            </span>\n          </div>\n\n          <div className=\"grid grid-cols-[200px_1fr] gap-6 items-start\">\n            <Label className=\"text-sm font-medium text-slate-700 pt-2 flex items-center gap-1\">\n              Primary Contact\n              <HelpCircle className=\"h-3.5 w-3.5 text-slate-400\" />\n            </Label>\n            <div className=\"flex gap-3\">\n              <Select value={formData.salutation} onValueChange={(v) => handleInputChange('salutation', v)}>\n                <SelectTrigger className=\"w-32\" data-testid=\"select-salutation\">\n                  <SelectValue placeholder=\"Salutation\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {SALUTATIONS.map(s => <SelectItem key={s} value={s}>{s}</SelectItem>)}\n                </SelectContent>\n              </Select>\n              <Input \n                placeholder=\"First Name\" \n                value={formData.firstName}\n                onChange={(e) => handleInputChange('firstName', e.target.value)}\n                className=\"flex-1\"\n                data-testid=\"input-first-name\"\n              />\n              <Input \n                placeholder=\"Last Name\" \n                value={formData.lastName}\n                onChange={(e) => handleInputChange('lastName', e.target.value)}\n                className=\"flex-1\"\n                data-testid=\"input-last-name\"\n              />\n            </div>\n\n            <Label className=\"text-sm font-medium text-slate-700 pt-2\">Company Name</Label>\n            <Input \n              value={formData.companyName}\n              onChange={(e) => handleInputChange('companyName', e.target.value)}\n              data-testid=\"input-company-name\"\n            />\n\n            <Label className=\"text-sm font-medium text-red-600 pt-2 flex items-center gap-1\">\n              Display Name*\n              <HelpCircle className=\"h-3.5 w-3.5 text-slate-400\" />\n            </Label>\n            <Select value={formData.displayName} onValueChange={(v) => handleInputChange('displayName', v)}>\n              <SelectTrigger data-testid=\"select-display-name\">\n                <SelectValue placeholder=\"Select or type to add\" />\n              </SelectTrigger>\n              <SelectContent>\n                {formData.companyName && (\n                  <SelectItem value={formData.companyName}>{formData.companyName}</SelectItem>\n                )}\n                {formData.firstName && formData.lastName && (\n                  <SelectItem value={`${formData.firstName} ${formData.lastName}`}>\n                    {formData.firstName} {formData.lastName}\n                  </SelectItem>\n                )}\n                {formData.firstName && (\n                  <SelectItem value={formData.firstName}>{formData.firstName}</SelectItem>\n                )}\n              </SelectContent>\n            </Select>\n\n            <Label className=\"text-sm font-medium text-slate-700 pt-2 flex items-center gap-1\">\n              Email Address\n              <HelpCircle className=\"h-3.5 w-3.5 text-slate-400\" />\n            </Label>\n            <Input \n              type=\"email\"\n              value={formData.email}\n              onChange={(e) => handleInputChange('email', e.target.value)}\n              data-testid=\"input-email\"\n            />\n\n            <Label className=\"text-sm font-medium text-slate-700 pt-2 flex items-center gap-1\">\n              Phone\n              <HelpCircle className=\"h-3.5 w-3.5 text-slate-400\" />\n            </Label>\n            <div className=\"flex gap-3\">\n              <Input \n                placeholder=\"Work Phone\" \n                value={formData.workPhone}\n                onChange={(e) => handleInputChange('workPhone', e.target.value)}\n                className=\"flex-1\"\n                data-testid=\"input-work-phone\"\n              />\n              <Input \n                placeholder=\"Mobile\" \n                value={formData.mobile}\n                onChange={(e) => handleInputChange('mobile', e.target.value)}\n                className=\"flex-1\"\n                data-testid=\"input-mobile\"\n              />\n            </div>\n          </div>\n\n          <Tabs value={activeTab} onValueChange={setActiveTab} className=\"mt-6\">\n            <TabsList className=\"h-12 w-full justify-start rounded-none border-b bg-transparent p-0 gap-0\">\n              <TabsTrigger \n                value=\"other-details\" \n                className=\"rounded-none border-b-2 border-transparent px-6 data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n              >\n                Other Details\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"address\" \n                className=\"rounded-none border-b-2 border-transparent px-6 data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n              >\n                Address\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"contact-persons\" \n                className=\"rounded-none border-b-2 border-transparent px-6 data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n              >\n                Contact Persons\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"bank-details\" \n                className=\"rounded-none border-b-2 border-transparent px-6 data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n              >\n                Bank Details\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"custom-fields\" \n                className=\"rounded-none border-b-2 border-transparent px-6 data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n              >\n                Custom Fields\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"reporting-tags\" \n                className=\"rounded-none border-b-2 border-transparent px-6 data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n              >\n                Reporting Tags\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"remarks\" \n                className=\"rounded-none border-b-2 border-transparent px-6 data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n              >\n                Remarks\n              </TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"other-details\" className=\"mt-6\">\n              <div className=\"grid grid-cols-[200px_1fr] gap-6 items-start\">\n                <Label className=\"text-sm font-medium text-slate-700 pt-2\">\n                  Expense Account\n                  <span className=\"text-red-600\">*</span>\n                </Label>\n                <Popover open={accountsOpen} onOpenChange={setAccountsOpen}>\n                  <PopoverTrigger asChild>\n                    <Button\n                      variant=\"outline\"\n                      role=\"combobox\"\n                      aria-expanded={accountsOpen}\n                      className=\"w-full justify-between font-normal\"\n                      data-testid=\"select-expense-account\"\n                    >\n                      {formData.expenseAccount || \"Search and select account...\"}\n                      <Search className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-[400px] p-0\" align=\"start\">\n                    <Command>\n                      <CommandInput placeholder=\"Search accounts...\" />\n                      <CommandList>\n                        <CommandEmpty>No account found.</CommandEmpty>\n                        <CommandGroup>\n                          {ACCOUNTS.map((account) => (\n                            <CommandItem\n                              key={account}\n                              value={account}\n                              onSelect={() => {\n                                handleInputChange('expenseAccount', account);\n                                setAccountsOpen(false);\n                              }}\n                            >\n                              <Check\n                                className={`mr-2 h-4 w-4 ${\n                                  formData.expenseAccount === account ? \"opacity-100\" : \"opacity-0\"\n                                }`}\n                              />\n                              {account}\n                            </CommandItem>\n                          ))}\n                        </CommandGroup>\n                        <div className=\"border-t px-2 py-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"w-full justify-start gap-2\"\n                            onClick={() => {\n                              setShowCreateAccountDialog(true);\n                              setAccountsOpen(false);\n                            }}\n                            type=\"button\"\n                          >\n                            <Plus className=\"h-4 w-4\" />\n                            Create New Account\n                          </Button>\n                        </div>\n                      </CommandList>\n                    </Command>\n                  </PopoverContent>\n                </Popover>\n\n                <Label className=\"text-sm font-medium text-slate-700 pt-2\">\n                  GST Treatment\n                  <span className=\"text-red-600\">*</span>\n                </Label>\n                <Select value={formData.gstTreatment} onValueChange={(v) => handleInputChange('gstTreatment', v)}>\n                  <SelectTrigger data-testid=\"select-gst-treatment\">\n                    <SelectValue placeholder=\"Select a GST treatment\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {GST_TREATMENTS.map(g => (\n                      <SelectItem key={g.value} value={g.label}>{g.label}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n\n                <Label className=\"text-sm font-medium text-slate-700 pt-2\">\n                  Source of Supply\n                  <span className=\"text-red-600\">*</span>\n                </Label>\n                <Select value={formData.sourceOfSupply} onValueChange={(v) => handleInputChange('sourceOfSupply', v)}>\n                  <SelectTrigger data-testid=\"select-source-of-supply\">\n                    <SelectValue placeholder=\"Select\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {INDIAN_STATES.map(s => (\n                      <SelectItem key={s} value={s}>{s}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n\n                <Label className=\"text-sm font-medium text-slate-700 pt-2 flex items-center gap-1\">\n                  PAN\n                  <HelpCircle className=\"h-3.5 w-3.5 text-slate-400\" />\n                </Label>\n                <Input \n                  value={formData.pan}\n                  onChange={(e) => handleInputChange('pan', e.target.value.toUpperCase())}\n                  maxLength={10}\n                  data-testid=\"input-pan\"\n                />\n\n                <Label className=\"text-sm font-medium text-slate-700 pt-2 flex items-center gap-1\">\n                  MSME Registered?\n                  <HelpCircle className=\"h-3.5 w-3.5 text-slate-400\" />\n                </Label>\n                <div className=\"flex items-center gap-2\">\n                  <Checkbox \n                    checked={formData.msmeRegistered}\n                    onCheckedChange={(v) => {\n                      handleInputChange('msmeRegistered', v);\n                      if (!v) {\n                        handleInputChange('msmeRegistrationType', '');\n                        handleInputChange('msmeRegistrationNumber', '');\n                      }\n                    }}\n                    data-testid=\"checkbox-msme\"\n                  />\n                  <span className=\"text-sm text-slate-600\">This vendor is MSME registered</span>\n                </div>\n\n                {formData.msmeRegistered && (\n                  <>\n                    <Label className=\"text-sm font-medium text-red-600 pt-2 flex items-center gap-1\">\n                      MSME/Udyam Registration Type*\n                    </Label>\n                    <Select \n                      value={formData.msmeRegistrationType} \n                      onValueChange={(v) => handleInputChange('msmeRegistrationType', v)}\n                    >\n                      <SelectTrigger data-testid=\"select-msme-type\">\n                        <SelectValue placeholder=\"Select the Registration Type...\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {MSME_REGISTRATION_TYPES.map(t => (\n                          <SelectItem key={t.value} value={t.value}>{t.label}</SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n\n                    <Label className=\"text-sm font-medium text-red-600 pt-2 flex items-center gap-1\">\n                      MSME/Udyam Registration Number\n                      <HelpCircle className=\"h-3.5 w-3.5 text-slate-400\" />\n                      *\n                    </Label>\n                    <div>\n                      <Input \n                        value={formData.msmeRegistrationNumber}\n                        onChange={(e) => handleInputChange('msmeRegistrationNumber', e.target.value.toUpperCase())}\n                        placeholder=\"Enter the Registration Number\"\n                        data-testid=\"input-msme-number\"\n                      />\n                      {formData.msmeRegistrationNumber && !/^UDYAM-[A-Z]{2}-\\d{2}-\\d{7}$/.test(formData.msmeRegistrationNumber) && (\n                        <p className=\"text-sm text-red-500 mt-1 flex items-start gap-1\">\n                          <span className=\"text-red-500\"></span>\n                          Enter a valid MSME/Udyam Registration Number. Ensure that the number is in the format UDYAM-XX-00-0000000.\n                        </p>\n                      )}\n                    </div>\n                  </>\n                )}\n\n                <Label className=\"text-sm font-medium text-slate-700 pt-2\">Currency</Label>\n                <Select value={formData.currency} onValueChange={(v) => handleInputChange('currency', v)}>\n                  <SelectTrigger data-testid=\"select-currency\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {CURRENCIES.map(c => (\n                      <SelectItem key={c.value} value={c.value}>{c.label}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n\n                <Label className=\"text-sm font-medium text-slate-700 pt-2\">Opening Balance</Label>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-slate-500\">INR</span>\n                  <Input \n                    type=\"number\"\n                    value={formData.openingBalance}\n                    onChange={(e) => handleInputChange('openingBalance', e.target.value)}\n                    className=\"flex-1\"\n                    data-testid=\"input-opening-balance\"\n                  />\n                </div>\n\n                <Label className=\"text-sm font-medium text-slate-700 pt-2\">Payment Terms</Label>\n                <Select value={formData.paymentTerms} onValueChange={(v) => handleInputChange('paymentTerms', v)}>\n                  <SelectTrigger data-testid=\"select-payment-terms\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {PAYMENT_TERMS.map(p => (\n                      <SelectItem key={p} value={p}>{p}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n\n                <Label className=\"text-sm font-medium text-slate-700 pt-2\">TDS</Label>\n                <Popover open={tdsOpen} onOpenChange={setTdsOpen}>\n                  <PopoverTrigger asChild>\n                    <Button\n                      variant=\"outline\"\n                      role=\"combobox\"\n                      aria-expanded={tdsOpen}\n                      className=\"w-full justify-between font-normal\"\n                      data-testid=\"select-tds\"\n                    >\n                      {formData.tds\n                        ? TDS_OPTIONS.find((t) => t.value === formData.tds)?.label + \n                          (TDS_OPTIONS.find((t) => t.value === formData.tds)?.rate \n                            ? ` - ${TDS_OPTIONS.find((t) => t.value === formData.tds)?.rate}` \n                            : '')\n                        : \"Select a Tax\"}\n                      <Search className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-[400px] p-0\" align=\"start\">\n                    <Command>\n                      <CommandInput placeholder=\"Search TDS type...\" />\n                      <CommandList>\n                        <CommandEmpty>No TDS type found.</CommandEmpty>\n                        <CommandGroup>\n                          {TDS_OPTIONS.map((tds) => (\n                            <CommandItem\n                              key={tds.value}\n                              value={tds.label}\n                              onSelect={() => {\n                                handleInputChange('tds', tds.value);\n                                setTdsOpen(false);\n                              }}\n                              className=\"flex justify-between\"\n                            >\n                              <div className=\"flex items-center gap-2\">\n                                <Check\n                                  className={`h-4 w-4 ${\n                                    formData.tds === tds.value ? \"opacity-100\" : \"opacity-0\"\n                                  }`}\n                                />\n                                <span>{tds.label}</span>\n                              </div>\n                              {tds.rate && (\n                                <span className=\"text-slate-500\">{tds.rate}</span>\n                              )}\n                            </CommandItem>\n                          ))}\n                        </CommandGroup>\n                      </CommandList>\n                    </Command>\n                  </PopoverContent>\n                </Popover>\n\n                <Label className=\"text-sm font-medium text-slate-700 pt-2\">Documents</Label>\n                <div>\n                  <div className=\"flex items-center gap-2\">\n                    <Button \n                      variant=\"outline\" \n                      className=\"gap-2\"\n                      onClick={() => fileInputRef.current?.click()}\n                      data-testid=\"button-upload-file\"\n                      type=\"button\"\n                    >\n                      <Upload className=\"h-4 w-4\" />\n                      Upload File\n                    </Button>\n                    {uploadedFiles.length > 0 && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => setShowAttachmentsDialog(true)}\n                        data-testid=\"button-view-attachments\"\n                        type=\"button\"\n                        className=\"text-blue-600 hover:text-blue-700\"\n                      >\n                        <Paperclip className=\"h-5 w-5\" />\n                      </Button>\n                    )}\n                  </div>\n                  <input \n                    ref={fileInputRef}\n                    type=\"file\"\n                    multiple\n                    hidden\n                    onChange={handleFileUpload}\n                    accept=\"*/*\"\n                  />\n                  <p className=\"text-xs text-slate-500 mt-1\">You can upload a maximum of 10 files, 10MB each</p>\n                  \n                  {uploadedFiles.length > 0 && (\n                    <div className=\"mt-4 space-y-2\">\n                      <p className=\"text-sm font-medium text-slate-700\">Uploaded Files ({uploadedFiles.length}/10)</p>\n                      <div className=\"space-y-2\">\n                        {uploadedFiles.map((file, index) => (\n                          <div key={index} className=\"flex items-center justify-between bg-slate-50 p-3 rounded-md border border-slate-200\">\n                            <div className=\"flex-1 min-w-0\">\n                              <p className=\"text-sm text-slate-900 truncate\">{file.name}</p>\n                              <p className=\"text-xs text-slate-500\">{(file.size / 1024).toFixed(2)} KB</p>\n                            </div>\n                            <Button \n                              variant=\"ghost\" \n                              size=\"icon\"\n                              className=\"h-8 w-8 text-slate-400 hover:text-red-600 flex-shrink-0\"\n                              onClick={() => removeFile(index)}\n                              data-testid={`button-remove-file-${index}`}\n                              type=\"button\"\n                            >\n                              <X className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"mt-6\">\n                <a href=\"#\" className=\"text-blue-600 hover:underline text-sm\">Add more details</a>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"address\" className=\"mt-6\">\n              <div className=\"grid grid-cols-2 gap-8\">\n                <div>\n                  <h3 className=\"font-semibold text-slate-900 mb-4\">Billing Address</h3>\n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Attention</Label>\n                      <Input \n                        value={formData.billingAddress.attention}\n                        onChange={(e) => handleAddressChange('billingAddress', 'attention', e.target.value)}\n                        data-testid=\"input-billing-attention\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Country/Region</Label>\n                      <Select \n                        value={formData.billingAddress.countryRegion} \n                        onValueChange={(v) => handleAddressChange('billingAddress', 'countryRegion', v)}\n                      >\n                        <SelectTrigger data-testid=\"select-billing-country\">\n                          <SelectValue placeholder=\"Select\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"India\">India</SelectItem>\n                          <SelectItem value=\"United States\">United States</SelectItem>\n                          <SelectItem value=\"United Kingdom\">United Kingdom</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Address</Label>\n                      <Textarea \n                        placeholder=\"Street 1\"\n                        value={formData.billingAddress.street1}\n                        onChange={(e) => handleAddressChange('billingAddress', 'street1', e.target.value)}\n                        className=\"mb-2\"\n                        data-testid=\"input-billing-street1\"\n                      />\n                      <Textarea \n                        placeholder=\"Street 2\"\n                        value={formData.billingAddress.street2}\n                        onChange={(e) => handleAddressChange('billingAddress', 'street2', e.target.value)}\n                        data-testid=\"input-billing-street2\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">City</Label>\n                      <Input \n                        value={formData.billingAddress.city}\n                        onChange={(e) => handleAddressChange('billingAddress', 'city', e.target.value)}\n                        data-testid=\"input-billing-city\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">State</Label>\n                      <Select \n                        value={formData.billingAddress.state} \n                        onValueChange={(v) => handleAddressChange('billingAddress', 'state', v)}\n                      >\n                        <SelectTrigger data-testid=\"select-billing-state\">\n                          <SelectValue placeholder=\"Select or type to add\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {INDIAN_STATES.map(s => (\n                            <SelectItem key={s} value={s}>{s}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Pin Code</Label>\n                      <Input \n                        value={formData.billingAddress.pinCode}\n                        onChange={(e) => handleAddressChange('billingAddress', 'pinCode', e.target.value)}\n                        data-testid=\"input-billing-pincode\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Phone</Label>\n                      <Input \n                        value={formData.billingAddress.phone}\n                        onChange={(e) => handleAddressChange('billingAddress', 'phone', e.target.value)}\n                        data-testid=\"input-billing-phone\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Fax Number</Label>\n                      <Input \n                        value={formData.billingAddress.faxNumber}\n                        onChange={(e) => handleAddressChange('billingAddress', 'faxNumber', e.target.value)}\n                        data-testid=\"input-billing-fax\"\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                <div>\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <h3 className=\"font-semibold text-slate-900\">Shipping Address</h3>\n                    <button \n                      type=\"button\"\n                      onClick={copyBillingToShipping}\n                      className=\"text-sm text-blue-600 hover:underline\"\n                      data-testid=\"button-copy-billing\"\n                    >\n                      Copy billing address\n                    </button>\n                  </div>\n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Attention</Label>\n                      <Input \n                        value={formData.shippingAddress.attention}\n                        onChange={(e) => handleAddressChange('shippingAddress', 'attention', e.target.value)}\n                        data-testid=\"input-shipping-attention\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Country/Region</Label>\n                      <Select \n                        value={formData.shippingAddress.countryRegion} \n                        onValueChange={(v) => handleAddressChange('shippingAddress', 'countryRegion', v)}\n                      >\n                        <SelectTrigger data-testid=\"select-shipping-country\">\n                          <SelectValue placeholder=\"Select\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"India\">India</SelectItem>\n                          <SelectItem value=\"United States\">United States</SelectItem>\n                          <SelectItem value=\"United Kingdom\">United Kingdom</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Address</Label>\n                      <Textarea \n                        placeholder=\"Street 1\"\n                        value={formData.shippingAddress.street1}\n                        onChange={(e) => handleAddressChange('shippingAddress', 'street1', e.target.value)}\n                        className=\"mb-2\"\n                        data-testid=\"input-shipping-street1\"\n                      />\n                      <Textarea \n                        placeholder=\"Street 2\"\n                        value={formData.shippingAddress.street2}\n                        onChange={(e) => handleAddressChange('shippingAddress', 'street2', e.target.value)}\n                        data-testid=\"input-shipping-street2\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">City</Label>\n                      <Input \n                        value={formData.shippingAddress.city}\n                        onChange={(e) => handleAddressChange('shippingAddress', 'city', e.target.value)}\n                        data-testid=\"input-shipping-city\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">State</Label>\n                      <Select \n                        value={formData.shippingAddress.state} \n                        onValueChange={(v) => handleAddressChange('shippingAddress', 'state', v)}\n                      >\n                        <SelectTrigger data-testid=\"select-shipping-state\">\n                          <SelectValue placeholder=\"Select or type to add\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {INDIAN_STATES.map(s => (\n                            <SelectItem key={s} value={s}>{s}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Pin Code</Label>\n                      <Input \n                        value={formData.shippingAddress.pinCode}\n                        onChange={(e) => handleAddressChange('shippingAddress', 'pinCode', e.target.value)}\n                        data-testid=\"input-shipping-pincode\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Phone</Label>\n                      <Input \n                        value={formData.shippingAddress.phone}\n                        onChange={(e) => handleAddressChange('shippingAddress', 'phone', e.target.value)}\n                        data-testid=\"input-shipping-phone\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Fax Number</Label>\n                      <Input \n                        value={formData.shippingAddress.faxNumber}\n                        onChange={(e) => handleAddressChange('shippingAddress', 'faxNumber', e.target.value)}\n                        data-testid=\"input-shipping-fax\"\n                      />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"mt-6 bg-amber-50 border border-amber-200 rounded-md p-4\">\n                <p className=\"text-sm text-amber-800\">\n                  <strong>Note:</strong>\n                </p>\n                <ul className=\"text-sm text-amber-700 list-disc ml-4 mt-1\">\n                  <li>Add and manage additional addresses from this Customers and Vendors details section.</li>\n                  <li>You can customise how customers' addresses are displayed in transaction PDFs. To do this, go to Settings {'>'} Preferences {'>'} Customers and Vendors, and navigate to the Address Format sections.</li>\n                </ul>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"contact-persons\" className=\"mt-6\">\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full\">\n                  <thead className=\"bg-slate-50\">\n                    <tr>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Salutation</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">First Name</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Last Name</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Email Address</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Work Phone</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Mobile</th>\n                      <th className=\"px-4 py-3 w-12\"></th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-slate-100\">\n                    {contactPersons.map((cp, index) => (\n                      <tr key={cp.id}>\n                        <td className=\"px-4 py-2\">\n                          <Select \n                            value={cp.salutation} \n                            onValueChange={(v) => updateContactPerson(cp.id, 'salutation', v)}\n                          >\n                            <SelectTrigger className=\"w-24\">\n                              <SelectValue placeholder=\"Select\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {SALUTATIONS.map(s => <SelectItem key={s} value={s}>{s}</SelectItem>)}\n                            </SelectContent>\n                          </Select>\n                        </td>\n                        <td className=\"px-4 py-2\">\n                          <Input \n                            value={cp.firstName}\n                            onChange={(e) => updateContactPerson(cp.id, 'firstName', e.target.value)}\n                            data-testid={`input-contact-firstname-${index}`}\n                          />\n                        </td>\n                        <td className=\"px-4 py-2\">\n                          <Input \n                            value={cp.lastName}\n                            onChange={(e) => updateContactPerson(cp.id, 'lastName', e.target.value)}\n                            data-testid={`input-contact-lastname-${index}`}\n                          />\n                        </td>\n                        <td className=\"px-4 py-2\">\n                          <Input \n                            type=\"email\"\n                            value={cp.email}\n                            onChange={(e) => updateContactPerson(cp.id, 'email', e.target.value)}\n                            data-testid={`input-contact-email-${index}`}\n                          />\n                        </td>\n                        <td className=\"px-4 py-2\">\n                          <Input \n                            value={cp.workPhone}\n                            onChange={(e) => updateContactPerson(cp.id, 'workPhone', e.target.value)}\n                            data-testid={`input-contact-workphone-${index}`}\n                          />\n                        </td>\n                        <td className=\"px-4 py-2\">\n                          <Input \n                            value={cp.mobile}\n                            onChange={(e) => updateContactPerson(cp.id, 'mobile', e.target.value)}\n                            data-testid={`input-contact-mobile-${index}`}\n                          />\n                        </td>\n                        <td className=\"px-4 py-2\">\n                          <Button \n                            variant=\"ghost\" \n                            size=\"icon\" \n                            className=\"h-8 w-8 text-slate-400 hover:text-red-600\"\n                            onClick={() => removeContactPerson(cp.id)}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </td>\n                      </tr>\n                    ))}\n                    {contactPersons.length === 0 && (\n                      <tr>\n                        <td colSpan={7} className=\"px-4 py-8 text-center text-slate-500\">\n                          No contact persons added yet\n                        </td>\n                      </tr>\n                    )}\n                  </tbody>\n                </table>\n              </div>\n              <Button \n                variant=\"outline\" \n                className=\"mt-4 gap-2 text-blue-600 border-blue-200 hover:bg-blue-50\"\n                onClick={addContactPerson}\n                data-testid=\"button-add-contact\"\n              >\n                <Plus className=\"h-4 w-4\" />\n                Add Contact Person\n              </Button>\n            </TabsContent>\n\n            <TabsContent value=\"bank-details\" className=\"mt-6\">\n              <div className=\"max-w-xl space-y-4\">\n                <div>\n                  <Label className=\"text-sm text-slate-600\">Account Holder Name</Label>\n                  <Input \n                    value={formData.bankDetails.accountHolderName}\n                    onChange={(e) => handleBankDetailsChange('accountHolderName', e.target.value)}\n                    data-testid=\"input-account-holder\"\n                  />\n                </div>\n                <div>\n                  <Label className=\"text-sm text-slate-600\">Bank Name</Label>\n                  <Input \n                    value={formData.bankDetails.bankName}\n                    onChange={(e) => handleBankDetailsChange('bankName', e.target.value)}\n                    data-testid=\"input-bank-name\"\n                  />\n                </div>\n                <div>\n                  <Label className=\"text-sm text-slate-600\">Account Number</Label>\n                  <Input \n                    value={formData.bankDetails.accountNumber}\n                    onChange={(e) => handleBankDetailsChange('accountNumber', e.target.value)}\n                    data-testid=\"input-account-number\"\n                  />\n                </div>\n                <div>\n                  <Label className=\"text-sm text-slate-600\">IFSC Code</Label>\n                  <Input \n                    value={formData.bankDetails.ifscCode}\n                    onChange={(e) => handleBankDetailsChange('ifscCode', e.target.value.toUpperCase())}\n                    data-testid=\"input-ifsc\"\n                  />\n                </div>\n                <div>\n                  <Label className=\"text-sm text-slate-600\">SWIFT Code</Label>\n                  <Input \n                    value={formData.bankDetails.swiftCode}\n                    onChange={(e) => handleBankDetailsChange('swiftCode', e.target.value.toUpperCase())}\n                    data-testid=\"input-swift\"\n                  />\n                </div>\n                <div>\n                  <Label className=\"text-sm text-slate-600\">Branch Name</Label>\n                  <Input \n                    value={formData.bankDetails.branchName}\n                    onChange={(e) => handleBankDetailsChange('branchName', e.target.value)}\n                    data-testid=\"input-branch\"\n                  />\n                </div>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"custom-fields\" className=\"mt-6\">\n              <div className=\"text-center py-12 text-slate-500\">\n                <p className=\"text-lg font-medium mb-1\">No custom fields configured</p>\n                <p className=\"text-sm text-slate-400\">Custom fields can be configured in Settings</p>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"reporting-tags\" className=\"mt-6\">\n              <div className=\"text-center py-12 text-slate-500\">\n                <p className=\"text-lg font-medium mb-1\">No reporting tags configured</p>\n                <p className=\"text-sm text-slate-400\">Reporting tags can be configured in Settings</p>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"remarks\" className=\"mt-6\">\n              <div className=\"max-w-xl\">\n                <Label className=\"text-sm text-slate-600 mb-2 block\">Remarks (For Internal Use)</Label>\n                <Textarea \n                  placeholder=\"Add any internal notes about this vendor...\"\n                  value={formData.remarks}\n                  onChange={(e) => handleInputChange('remarks', e.target.value)}\n                  rows={6}\n                  data-testid=\"input-remarks\"\n                />\n              </div>\n            </TabsContent>\n          </Tabs>\n        </div>\n      </div>\n\n      <div className=\"border-t border-slate-200 px-6 py-4 flex items-center gap-3\">\n        <Button \n          onClick={handleSave} \n          disabled={saving}\n          className=\"bg-blue-600 hover:bg-blue-700\"\n          data-testid=\"button-save\"\n        >\n          {saving ? 'Saving...' : 'Save'}\n        </Button>\n        <Button \n          variant=\"outline\" \n          onClick={() => setLocation('/vendors')}\n          data-testid=\"button-cancel\"\n        >\n          Cancel\n        </Button>\n      </div>\n\n      <Dialog open={showCreateAccountDialog} onOpenChange={setShowCreateAccountDialog}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Create New Account</DialogTitle>\n            <DialogDescription>Enter the name for the new expense account</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <Input\n              placeholder=\"Account Name\"\n              value={newAccountName}\n              onChange={(e) => setNewAccountName(e.target.value)}\n              onKeyDown={(e) => {\n                if (e.key === 'Enter') {\n                  handleCreateAccount();\n                }\n              }}\n              data-testid=\"input-new-account\"\n            />\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowCreateAccountDialog(false)}>\n              Cancel\n            </Button>\n            <Button onClick={handleCreateAccount} className=\"bg-blue-600 hover:bg-blue-700\">\n              Save and Select\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showAttachmentsDialog} onOpenChange={setShowAttachmentsDialog}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Manage Documents</DialogTitle>\n            <DialogDescription>Upload, view, and manage vendor documents</DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            <div>\n              <Button \n                variant=\"outline\" \n                className=\"gap-2 w-full\"\n                onClick={() => attachmentInputRef.current?.click()}\n                type=\"button\"\n              >\n                <Upload className=\"h-4 w-4\" />\n                Upload your Files\n              </Button>\n              <input \n                ref={attachmentInputRef}\n                type=\"file\"\n                multiple\n                hidden\n                onChange={handleAttachmentUpload}\n                accept=\"*/*\"\n              />\n              <p className=\"text-xs text-slate-500 mt-2\">Maximum 10 files, 10MB each</p>\n            </div>\n\n            {(uploadedFiles.length > 0 || newAttachments.length > 0) && (\n              <div className=\"border-t pt-4\">\n                <p className=\"text-sm font-medium text-slate-700 mb-3\">\n                  Uploaded Files ({(uploadedFiles.length + newAttachments.length)}/10)\n                </p>\n                <div className=\"space-y-2 max-h-96 overflow-y-auto\">\n                  {uploadedFiles.map((file, index) => (\n                    <div key={`uploaded-${index}`} className=\"flex items-center justify-between bg-slate-50 p-3 rounded-md border border-slate-200\">\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-sm text-slate-900 truncate\">{file.name}</p>\n                        <p className=\"text-xs text-slate-500\">{(file.size / 1024).toFixed(2)} KB</p>\n                      </div>\n                      <Button \n                        variant=\"ghost\" \n                        size=\"icon\"\n                        className=\"h-8 w-8 text-slate-400 hover:text-red-600 flex-shrink-0\"\n                        onClick={() => removeFile(index)}\n                        type=\"button\"\n                      >\n                        <X className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  ))}\n                  {newAttachments.map((file, index) => (\n                    <div key={`new-${index}`} className=\"flex items-center justify-between bg-blue-50 p-3 rounded-md border border-blue-200\">\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-sm text-slate-900 truncate\">{file.name}</p>\n                        <p className=\"text-xs text-slate-500\">{(file.size / 1024).toFixed(2)} KB</p>\n                      </div>\n                      <Button \n                        variant=\"ghost\" \n                        size=\"icon\"\n                        className=\"h-8 w-8 text-slate-400 hover:text-red-600 flex-shrink-0\"\n                        onClick={() => removeAttachment(index)}\n                        type=\"button\"\n                      >\n                        <X className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowAttachmentsDialog(false)}>\n              Close\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":60845,"size_tokens":null},"client/src/shared/components/index.ts":{"content":"export { PageHeader } from './PageHeader';\nexport { DataTable } from './DataTable';\nexport { ConfirmDialog } from './ConfirmDialog';\nexport { StatusBadge } from './StatusBadge';\n","path":null,"size_bytes":178,"size_tokens":null},"client/src/pages/sales-order-edit.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation, useRoute } from \"wouter\";\nimport { Plus, X, Search, Upload, Pencil, ArrowLeft, Loader2, Settings } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { ManageSalespersonsDialog } from \"@/components/ManageSalespersonsDialog\";\n\ninterface Customer {\n  id: string;\n  name: string;\n  email: string;\n  billingAddress: any;\n  shippingAddress: any;\n}\n\ninterface Item {\n  id: string;\n  name: string;\n  description: string;\n  rate: string;\n  hsnSac: string;\n}\n\ninterface SalesOrderItem {\n  id: string;\n  itemId: string;\n  name: string;\n  description: string;\n  hsnSac: string;\n  quantity: number;\n  unit: string;\n  rate: number;\n  discount: number;\n  discountType: string;\n  tax: string;\n  amount: number;\n  ordered?: number;\n  invoicedQty?: number;\n  invoiceStatus?: string;\n}\n\nconst taxOptions = [\n  { value: \"none\", label: \"No Tax\" },\n  { value: \"GST0\", label: \"GST (0%)\" },\n  { value: \"GST5\", label: \"GST (5%)\" },\n  { value: \"GST12\", label: \"GST (12%)\" },\n  { value: \"GST18\", label: \"GST (18%)\" },\n  { value: \"GST28\", label: \"GST (28%)\" },\n];\n\nconst getTaxRate = (taxValue: string): number => {\n  const rates: Record<string, number> = {\n    \"none\": 0,\n    \"GST0\": 0,\n    \"GST5\": 5,\n    \"GST12\": 12,\n    \"GST18\": 18,\n    \"GST28\": 28,\n  };\n  return rates[taxValue] || 0;\n};\n\nconst getTaxValueFromName = (taxName: string | undefined, rate: number): string => {\n  if (taxName && taxOptions.find(t => t.value === taxName)) {\n    return taxName;\n  }\n  const rateMap: Record<number, string> = {\n    0: \"none\",\n    5: \"GST5\",\n    12: \"GST12\",\n    18: \"GST18\",\n    28: \"GST28\",\n  };\n  return rateMap[rate] || \"none\";\n};\n\nconst paymentTermsOptions = [\n  { value: \"due_on_receipt\", label: \"Due on Receipt\" },\n  { value: \"net_15\", label: \"Net 15\" },\n  { value: \"net_30\", label: \"Net 30\" },\n  { value: \"net_45\", label: \"Net 45\" },\n  { value: \"net_60\", label: \"Net 60\" },\n];\n\nconst deliveryMethodOptions = [\n  { value: \"standard\", label: \"Standard Delivery\" },\n  { value: \"express\", label: \"Express Delivery\" },\n  { value: \"pickup\", label: \"Customer Pickup\" },\n];\n\nconst getPaymentTermsValue = (label: string): string => {\n  const option = paymentTermsOptions.find(p => p.label === label);\n  return option?.value || \"due_on_receipt\";\n};\n\nconst getDeliveryMethodValue = (label: string): string => {\n  const option = deliveryMethodOptions.find(d => d.label === label);\n  return option?.value || \"standard\";\n};\n\nexport default function SalesOrderEditPage() {\n  const [, params] = useRoute(\"/sales-orders/:id/edit\");\n  const orderId = params?.id;\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [customers, setCustomers] = useState<Customer[]>([]);\n  const [customerSearchTerm, setCustomerSearchTerm] = useState(\"\");\n  const [items, setItems] = useState<Item[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [initialLoading, setInitialLoading] = useState(true);\n  const [originalOrder, setOriginalOrder] = useState<any>({});\n  const [showManageSalespersons, setShowManageSalespersons] = useState(false);\n  const [salespersons, setSalespersons] = useState<{ id: string; name: string }[]>([]);\n\n  const [formData, setFormData] = useState({\n    customerId: \"\",\n    customerName: \"\",\n    salesOrderNumber: \"\",\n    referenceNumber: \"\",\n    orderDate: new Date().toISOString().split('T')[0],\n    expectedShipmentDate: \"\",\n    paymentTerms: \"due_on_receipt\",\n    deliveryMethod: \"standard\",\n    salesperson: \"\",\n    placeOfSupply: \"\",\n    customerNotes: \"\",\n    termsAndConditions: \"\",\n    shippingCharges: 0,\n    adjustment: 0,\n    adjustmentDescription: \"\",\n    orderStatus: \"Draft\",\n  });\n\n  const [orderItems, setOrderItems] = useState<SalesOrderItem[]>([\n    {\n      id: \"1\",\n      itemId: \"\",\n      name: \"\",\n      description: \"\",\n      hsnSac: \"\",\n      quantity: 1,\n      unit: \"pcs\",\n      rate: 0,\n      discount: 0,\n      discountType: \"percentage\",\n      tax: \"none\",\n      amount: 0,\n    }\n  ]);\n\n  useEffect(() => {\n    fetchCustomers();\n    fetchItems();\n    fetchSalespersons();\n  }, []);\n\n  useEffect(() => {\n    if (orderId) {\n      fetchOrderData();\n    }\n  }, [orderId]);\n\n  const fetchCustomers = async () => {\n    try {\n      const response = await fetch('/api/customers');\n      if (response.ok) {\n        const data = await response.json();\n        setCustomers(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch customers:', error);\n    }\n  };\n\n  const fetchItems = async () => {\n    try {\n      const response = await fetch('/api/items');\n      if (response.ok) {\n        const data = await response.json();\n        setItems(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch items:', error);\n    }\n  };\n\n  const fetchSalespersons = async () => {\n    try {\n      const response = await fetch('/api/salespersons');\n      if (response.ok) {\n        const data = await response.json();\n        setSalespersons(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch salespersons:', error);\n    }\n  };\n\n  const fetchOrderData = async () => {\n    if (!orderId) {\n      setInitialLoading(false);\n      toast({ title: \"Invalid order ID\", variant: \"destructive\" });\n      setLocation('/sales-orders');\n      return;\n    }\n    try {\n      const response = await fetch(`/api/sales-orders/${orderId}`);\n      if (response.ok) {\n        const data = await response.json();\n        const order = data.data;\n\n        setOriginalOrder(order);\n\n        setFormData({\n          customerId: order.customerId || \"\",\n          customerName: order.customerName || \"\",\n          salesOrderNumber: order.salesOrderNumber || \"\",\n          referenceNumber: order.referenceNumber || \"\",\n          orderDate: order.date || new Date().toISOString().split('T')[0],\n          expectedShipmentDate: order.expectedShipmentDate || \"\",\n          paymentTerms: getPaymentTermsValue(order.paymentTerms),\n          deliveryMethod: getDeliveryMethodValue(order.deliveryMethod),\n          salesperson: order.salesperson || \"\",\n          placeOfSupply: order.placeOfSupply?.toLowerCase() || \"\",\n          customerNotes: order.customerNotes || \"\",\n          termsAndConditions: order.termsAndConditions || \"\",\n          shippingCharges: order.shippingCharges || 0,\n          adjustment: order.adjustment || 0,\n          adjustmentDescription: \"\",\n          orderStatus: order.orderStatus || \"Draft\",\n        });\n\n        if (order.items && order.items.length > 0) {\n          setOrderItems(order.items.map((item: any) => ({\n            id: item.id || String(Date.now()),\n            itemId: item.itemId || \"\",\n            name: item.name || \"\",\n            description: item.description || \"\",\n            hsnSac: item.hsnSac || \"\",\n            quantity: item.quantity || 1,\n            unit: item.unit || \"pcs\",\n            rate: item.rate || 0,\n            discount: item.discount || 0,\n            discountType: item.discountType || \"percentage\",\n            tax: getTaxValueFromName(item.taxName, item.tax || 0),\n            amount: item.amount || 0,\n            ordered: item.ordered,\n            invoicedQty: item.invoicedQty,\n            invoiceStatus: item.invoiceStatus,\n          })));\n        }\n      } else {\n        toast({ title: \"Failed to load order\", variant: \"destructive\" });\n        setLocation('/sales-orders');\n      }\n    } catch (error) {\n      console.error('Failed to fetch order:', error);\n      toast({ title: \"Error loading order\", variant: \"destructive\" });\n      setLocation('/sales-orders');\n    } finally {\n      setInitialLoading(false);\n    }\n  };\n\n  const filteredCustomers = customers.filter(customer => {\n    const customerName = customer.name || \"\";\n    return customerName.toLowerCase().includes(customerSearchTerm.toLowerCase());\n  });\n\n  const handleCustomerChange = (customerId: string) => {\n    if (customerId === \"__add_new_customer__\") {\n      setLocation(\"/customers/new\");\n      return;\n    }\n\n    const customer = customers.find(c => c.id === customerId);\n    if (customer) {\n      setFormData(prev => ({\n        ...prev,\n        customerId,\n        customerName: customer.name\n      }));\n    }\n  };\n\n  const handleItemChange = (index: number, itemId: string) => {\n    const item = items.find(i => i.id === itemId);\n    if (item) {\n      const updatedItems = [...orderItems];\n      const rate = parseFloat(item.rate.replace(/[,]/g, '')) || 0;\n      updatedItems[index] = {\n        ...updatedItems[index],\n        itemId,\n        name: item.name,\n        description: item.description || '',\n        hsnSac: item.hsnSac || '',\n        rate,\n        amount: rate * updatedItems[index].quantity\n      };\n      setOrderItems(updatedItems);\n    }\n  };\n\n  const updateOrderItem = (index: number, field: string, value: any) => {\n    const updatedItems = [...orderItems];\n    updatedItems[index] = { ...updatedItems[index], [field]: value };\n\n    const quantity = updatedItems[index].quantity;\n    const rate = updatedItems[index].rate;\n    const discount = updatedItems[index].discount;\n    const discountType = updatedItems[index].discountType;\n\n    let subtotal = quantity * rate;\n    if (discountType === 'percentage') {\n      subtotal = subtotal - (subtotal * discount / 100);\n    } else {\n      subtotal = subtotal - discount;\n    }\n\n    updatedItems[index].amount = Math.max(0, subtotal);\n    setOrderItems(updatedItems);\n  };\n\n  const addNewRow = () => {\n    setOrderItems([\n      ...orderItems,\n      {\n        id: String(Date.now()),\n        itemId: \"\",\n        name: \"\",\n        description: \"\",\n        hsnSac: \"\",\n        quantity: 1,\n        unit: \"pcs\",\n        rate: 0,\n        discount: 0,\n        discountType: \"percentage\",\n        tax: \"none\",\n        amount: 0,\n      }\n    ]);\n  };\n\n  const removeRow = (index: number) => {\n    if (orderItems.length > 1) {\n      setOrderItems(orderItems.filter((_, i) => i !== index));\n    }\n  };\n\n  const calculateSubTotal = () => {\n    return orderItems.reduce((sum, item) => sum + item.amount, 0);\n  };\n\n  const calculateTax = () => {\n    return orderItems.reduce((sum, item) => {\n      const taxRate = getTaxRate(item.tax);\n      return sum + (item.amount * taxRate / 100);\n    }, 0);\n  };\n\n  const calculateTotal = () => {\n    const subTotal = calculateSubTotal();\n    const tax = calculateTax();\n    const shipping = formData.shippingCharges || 0;\n    const adjustment = formData.adjustment || 0;\n    return subTotal + tax + shipping + adjustment;\n  };\n\n  const handleSubmit = async (status: string) => {\n    if (!originalOrder?.id) {\n      toast({ title: \"Please wait for order data to load\", variant: \"destructive\" });\n      return;\n    }\n\n    if (!formData.customerId) {\n      toast({ title: \"Please select a customer\", variant: \"destructive\" });\n      return;\n    }\n\n    const validItems = orderItems.filter(item => item.itemId);\n    if (validItems.length === 0) {\n      toast({ title: \"Please add at least one item\", variant: \"destructive\" });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const subTotal = calculateSubTotal();\n      const taxAmount = calculateTax();\n\n      const customer = customers.find(c => c.id === formData.customerId);\n      const customerState = customer?.billingAddress?.state?.toLowerCase() || '';\n      const supplyState = formData.placeOfSupply?.toLowerCase() || '';\n      const isInterState = customerState && supplyState && customerState !== supplyState;\n\n      const defaultAddress = { street: \"\", city: \"\", state: \"\", country: \"\", pincode: \"\" };\n      const orderData = {\n        ...originalOrder,\n        salesOrderNumber: formData.salesOrderNumber,\n        customerId: formData.customerId,\n        customerName: formData.customerName,\n        referenceNumber: formData.referenceNumber,\n        date: formData.orderDate,\n        expectedShipmentDate: formData.expectedShipmentDate,\n        paymentTerms: paymentTermsOptions.find(p => p.value === formData.paymentTerms)?.label || \"Due on Receipt\",\n        deliveryMethod: deliveryMethodOptions.find(d => d.value === formData.deliveryMethod)?.label || \"Standard Delivery\",\n        salesperson: formData.salesperson,\n        placeOfSupply: formData.placeOfSupply,\n        billingAddress: customer?.billingAddress || originalOrder?.billingAddress || defaultAddress,\n        shippingAddress: customer?.shippingAddress || originalOrder?.shippingAddress || defaultAddress,\n        items: validItems.map(item => {\n          const originalItem = originalOrder?.items?.find((oi: any) => oi.id === item.id) || {};\n          return {\n            ...originalItem,\n            id: item.id,\n            itemId: item.itemId,\n            name: item.name,\n            description: item.description,\n            hsnSac: item.hsnSac,\n            quantity: item.quantity,\n            unit: item.unit,\n            rate: item.rate,\n            discount: item.discount,\n            discountType: item.discountType,\n            tax: getTaxRate(item.tax),\n            taxName: item.tax,\n            amount: item.amount,\n            ordered: item.ordered ?? originalItem?.ordered ?? item.quantity,\n            invoicedQty: item.invoicedQty ?? originalItem?.invoicedQty ?? 0,\n            invoiceStatus: item.invoiceStatus ?? originalItem?.invoiceStatus ?? \"Not Invoiced\"\n          };\n        }),\n        subTotal,\n        shippingCharges: formData.shippingCharges,\n        cgst: isInterState ? 0 : taxAmount / 2,\n        sgst: isInterState ? 0 : taxAmount / 2,\n        igst: isInterState ? taxAmount : 0,\n        adjustment: formData.adjustment,\n        total: calculateTotal(),\n        customerNotes: formData.customerNotes,\n        termsAndConditions: formData.termsAndConditions,\n        orderStatus: status === 'draft' ? 'Draft' : (originalOrder?.orderStatus === 'Draft' ? 'Confirmed' : originalOrder?.orderStatus || 'Confirmed'),\n      };\n\n      const response = await fetch(`/api/sales-orders/${orderId}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(orderData)\n      });\n\n      if (response.ok) {\n        toast({ title: `Sales order updated successfully` });\n        setLocation('/sales-orders');\n      } else {\n        toast({ title: \"Failed to update sales order\", variant: \"destructive\" });\n      }\n    } catch (error) {\n      console.error('Error updating sales order:', error);\n      toast({ title: \"Error updating sales order\", variant: \"destructive\" });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const formatCurrency = (amount: number) => {\n    return amount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n  };\n\n  if (initialLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-96\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-slate-400\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-5xl mx-auto py-6 animate-in fade-in duration-300\">\n      <div className=\"flex items-center gap-4 mb-6\">\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          onClick={() => setLocation('/sales-orders')}\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"h-4 w-4\" />\n        </Button>\n        <h1 className=\"text-2xl font-semibold text-slate-900 dark:text-white\">Edit Sales Order</h1>\n      </div>\n\n      <div className=\"space-y-6\">\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-red-600\">Customer Name*</Label>\n            <Select value={formData.customerId} onValueChange={handleCustomerChange}>\n              <SelectTrigger className=\"bg-blue-50 dark:bg-blue-950 border-blue-200 dark:border-blue-800\" data-testid=\"select-customer\">\n                <SelectValue placeholder=\"Select or add a customer\" />\n              </SelectTrigger>\n              <SelectContent>\n                <div className=\"p-2\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <Search className=\"h-4 w-4 text-gray-400\" />\n                    <Input\n                      placeholder=\"Search customers...\"\n                      className=\"h-8\"\n                      value={customerSearchTerm}\n                      onChange={(e) => setCustomerSearchTerm(e.target.value)}\n                    />\n                  </div>\n                </div>\n                {filteredCustomers.map(customer => (\n                  <SelectItem key={customer.id} value={customer.id} data-testid={`option-customer-${customer.id}`}>\n                    {customer.name}\n                  </SelectItem>\n                ))}\n                <div className=\"border-t mt-1 pt-1\">\n                  <SelectItem value=\"__add_new_customer__\">\n                    <div className=\"flex items-center gap-2 text-blue-600\">\n                      <Plus className=\"h-4 w-4\" />\n                      Add New Customer\n                    </div>\n                  </SelectItem>\n                </div>\n              </SelectContent>\n            </Select>\n          </div>\n          <div className=\"flex justify-end\">\n            <Button variant=\"outline\" size=\"icon\" data-testid=\"button-search-customer\">\n              <Search className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-red-600\">Sales Order#*</Label>\n            <div className=\"flex gap-2\">\n              <Input\n                value={formData.salesOrderNumber}\n                onChange={(e) => setFormData(prev => ({ ...prev, salesOrderNumber: e.target.value }))}\n                className=\"flex-1\"\n                data-testid=\"input-order-number\"\n              />\n              <Button variant=\"outline\" size=\"icon\" data-testid=\"button-edit-order-number\">\n                <Pencil className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Reference#</Label>\n            <Input\n              value={formData.referenceNumber}\n              onChange={(e) => setFormData(prev => ({ ...prev, referenceNumber: e.target.value }))}\n              data-testid=\"input-reference-number\"\n            />\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-red-600\">Sales Order Date*</Label>\n            <Input\n              type=\"date\"\n              value={formData.orderDate}\n              onChange={(e) => setFormData(prev => ({ ...prev, orderDate: e.target.value }))}\n              data-testid=\"input-order-date\"\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Expected Shipment Date</Label>\n            <Input\n              type=\"date\"\n              value={formData.expectedShipmentDate}\n              onChange={(e) => setFormData(prev => ({ ...prev, expectedShipmentDate: e.target.value }))}\n              data-testid=\"input-shipment-date\"\n            />\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-2\">\n            <Label>Payment Terms</Label>\n            <Select value={formData.paymentTerms} onValueChange={(v) => setFormData(prev => ({ ...prev, paymentTerms: v }))}>\n              <SelectTrigger data-testid=\"select-payment-terms\">\n                <SelectValue placeholder=\"Select payment terms\" />\n              </SelectTrigger>\n              <SelectContent>\n                {paymentTermsOptions.map(option => (\n                  <SelectItem key={option.value} value={option.value}>{option.label}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Delivery Method</Label>\n            <Select value={formData.deliveryMethod} onValueChange={(v) => setFormData(prev => ({ ...prev, deliveryMethod: v }))}>\n              <SelectTrigger data-testid=\"select-delivery-method\">\n                <SelectValue placeholder=\"Select delivery method\" />\n              </SelectTrigger>\n              <SelectContent>\n                {deliveryMethodOptions.map(option => (\n                  <SelectItem key={option.value} value={option.value}>{option.label}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-2\">\n            <Label>Salesperson</Label>\n            <Select value={formData.salesperson} onValueChange={(v) => {\n              if (v === \"manage_salespersons\") {\n                setShowManageSalespersons(true);\n              } else {\n                setFormData(prev => ({ ...prev, salesperson: v }));\n              }\n            }}>\n              <SelectTrigger data-testid=\"select-salesperson\">\n                <SelectValue placeholder=\"Select or Add Salesperson\" />\n              </SelectTrigger>\n              <SelectContent>\n                <div className=\"relative mb-2\">\n                  <Search className=\"absolute left-2 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <input\n                    className=\"w-full pl-8 pr-2 py-1.5 text-sm border-b bg-transparent outline-none\"\n                    placeholder=\"Search\"\n                  />\n                </div>\n                {salespersons.map(sp => (\n                  <SelectItem key={sp.id} value={sp.id}>{sp.name}</SelectItem>\n                ))}\n                <div\n                  className=\"flex items-center gap-2 px-2 py-1.5 text-sm text-blue-600 cursor-pointer hover:bg-slate-100\"\n                  onClick={() => {\n                    setShowManageSalespersons(true);\n                  }}\n                >\n                  <Settings className=\"h-4 w-4\" />\n                  Manage Salespersons\n                </div>\n              </SelectContent>\n            </Select>\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Place of Supply</Label>\n            <Select value={formData.placeOfSupply} onValueChange={(v) => setFormData(prev => ({ ...prev, placeOfSupply: v }))}>\n              <SelectTrigger data-testid=\"select-place-of-supply\">\n                <SelectValue placeholder=\"Select place of supply\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"maharashtra\">Maharashtra</SelectItem>\n                <SelectItem value=\"gujarat\">Gujarat</SelectItem>\n                <SelectItem value=\"karnataka\">Karnataka</SelectItem>\n                <SelectItem value=\"delhi\">Delhi</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        <div className=\"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden\">\n          <div className=\"bg-slate-50 dark:bg-slate-800 px-4 py-2 font-medium text-sm text-slate-700 dark:text-slate-300\">\n            Item Table\n          </div>\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead className=\"bg-slate-50 dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700\">\n                <tr>\n                  <th className=\"px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase w-8\"></th>\n                  <th className=\"px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase\">Item Details</th>\n                  <th className=\"px-4 py-2 text-center text-xs font-medium text-slate-500 uppercase w-24\">Quantity</th>\n                  <th className=\"px-4 py-2 text-right text-xs font-medium text-slate-500 uppercase w-28\">Rate ()</th>\n                  <th className=\"px-4 py-2 text-center text-xs font-medium text-slate-500 uppercase w-28\">Discount</th>\n                  <th className=\"px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase w-32\">Tax</th>\n                  <th className=\"px-4 py-2 text-right text-xs font-medium text-slate-500 uppercase w-28\">Amount</th>\n                  <th className=\"px-4 py-2 w-10\"></th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-slate-100 dark:divide-slate-700\">\n                {orderItems.map((item, index) => (\n                  <tr key={item.id} data-testid={`row-item-${index}`}>\n                    <td className=\"px-4 py-2 text-slate-400\">::</td>\n                    <td className=\"px-4 py-2\">\n                      <Select value={item.itemId} onValueChange={(v) => handleItemChange(index, v)}>\n                        <SelectTrigger className=\"border-dashed\" data-testid={`select-item-${index}`}>\n                          <SelectValue placeholder=\"Type or click to select an item.\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {items.map(i => (\n                            <SelectItem key={i.id} value={i.id}>{i.name}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <Input\n                        type=\"number\"\n                        min=\"1\"\n                        value={item.quantity}\n                        onChange={(e) => updateOrderItem(index, 'quantity', parseFloat(e.target.value) || 1)}\n                        className=\"text-center\"\n                        data-testid={`input-quantity-${index}`}\n                      />\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <Input\n                        type=\"number\"\n                        min=\"0\"\n                        step=\"0.01\"\n                        value={item.rate}\n                        onChange={(e) => updateOrderItem(index, 'rate', parseFloat(e.target.value) || 0)}\n                        className=\"text-right\"\n                        data-testid={`input-rate-${index}`}\n                      />\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <div className=\"flex items-center gap-1\">\n                        <Input\n                          type=\"number\"\n                          min=\"0\"\n                          value={item.discount}\n                          onChange={(e) => updateOrderItem(index, 'discount', parseFloat(e.target.value) || 0)}\n                          className=\"w-16 text-center\"\n                          data-testid={`input-discount-${index}`}\n                        />\n                        <Select\n                          value={item.discountType}\n                          onValueChange={(v) => updateOrderItem(index, 'discountType', v)}\n                        >\n                          <SelectTrigger className=\"w-14\" data-testid={`select-discount-type-${index}`}>\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"percentage\">%</SelectItem>\n                            <SelectItem value=\"amount\"></SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <Select value={item.tax} onValueChange={(v) => updateOrderItem(index, 'tax', v)}>\n                        <SelectTrigger data-testid={`select-tax-${index}`}>\n                          <SelectValue placeholder=\"Select a Tax\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {taxOptions.map(tax => (\n                            <SelectItem key={tax.value} value={tax.value}>{tax.label}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </td>\n                    <td className=\"px-4 py-2 text-right font-medium text-slate-900 dark:text-white\">\n                      {formatCurrency(item.amount)}\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"text-red-500\"\n                        onClick={() => removeRow(index)}\n                        data-testid={`button-remove-item-${index}`}\n                      >\n                        <X className=\"h-4 w-4\" />\n                      </Button>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n          <div className=\"px-4 py-3 flex gap-4 border-t border-slate-200 dark:border-slate-700\">\n            <Button variant=\"link\" className=\"text-blue-600 p-0 h-auto\" onClick={addNewRow} data-testid=\"button-add-row\">\n              <Plus className=\"h-4 w-4 mr-1\" /> Add another line\n            </Button>\n            <Button variant=\"link\" className=\"text-blue-600 p-0 h-auto\" data-testid=\"button-add-bulk\">\n              <Plus className=\"h-4 w-4 mr-1\" /> Add items in bulk\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-8\">\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label>Customer Notes</Label>\n              <Textarea\n                value={formData.customerNotes}\n                onChange={(e) => setFormData(prev => ({ ...prev, customerNotes: e.target.value }))}\n                placeholder=\"Looking forward to your business.\"\n                className=\"resize-none\"\n                data-testid=\"input-customer-notes\"\n              />\n              <p className=\"text-xs text-slate-500\">Will be displayed on the sales order</p>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Terms & Conditions</Label>\n              <Textarea\n                value={formData.termsAndConditions}\n                onChange={(e) => setFormData(prev => ({ ...prev, termsAndConditions: e.target.value }))}\n                placeholder=\"Enter the terms and conditions of your business...\"\n                className=\"resize-none\"\n                data-testid=\"input-terms\"\n              />\n            </div>\n          </div>\n\n          <div className=\"space-y-3 bg-slate-50 dark:bg-slate-800 rounded-lg p-4\">\n            <div className=\"flex justify-between items-center gap-2\">\n              <span className=\"text-sm text-slate-600 dark:text-slate-400\">Sub Total</span>\n              <span className=\"font-medium text-slate-900 dark:text-white\">{formatCurrency(calculateSubTotal())}</span>\n            </div>\n            <div className=\"flex justify-between items-center gap-2\">\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-sm text-slate-600 dark:text-slate-400\">Shipping Charges</span>\n              </div>\n              <Input\n                type=\"number\"\n                min=\"0\"\n                value={formData.shippingCharges}\n                onChange={(e) => setFormData(prev => ({ ...prev, shippingCharges: parseFloat(e.target.value) || 0 }))}\n                className=\"w-28 text-right\"\n                data-testid=\"input-shipping\"\n              />\n            </div>\n            <div className=\"flex justify-between items-center gap-2\">\n              <span className=\"text-sm text-slate-600 dark:text-slate-400\">Tax</span>\n              <span className=\"font-medium text-slate-900 dark:text-white\">{formatCurrency(calculateTax())}</span>\n            </div>\n            <div className=\"flex justify-between items-center gap-2\">\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-sm text-slate-600 dark:text-slate-400\">Adjustment</span>\n              </div>\n              <Input\n                type=\"number\"\n                value={formData.adjustment}\n                onChange={(e) => setFormData(prev => ({ ...prev, adjustment: parseFloat(e.target.value) || 0 }))}\n                className=\"w-28 text-right\"\n                data-testid=\"input-adjustment\"\n              />\n            </div>\n            <div className=\"flex justify-between items-center pt-3 border-t border-slate-200 dark:border-slate-600 gap-2\">\n              <span className=\"text-base font-semibold text-slate-900 dark:text-white\">Total ()</span>\n              <span className=\"text-lg font-bold text-slate-900 dark:text-white\">{formatCurrency(calculateTotal())}</span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex justify-between items-center pt-6 border-t border-slate-200 dark:border-slate-700\">\n          <div className=\"flex items-center gap-2\">\n            <Checkbox id=\"tds\" data-testid=\"checkbox-tds\" />\n            <Label htmlFor=\"tds\" className=\"text-sm text-slate-600 dark:text-slate-400\">Apply TDS/TCS</Label>\n          </div>\n          <div className=\"flex gap-3\">\n            <Button variant=\"outline\" onClick={() => setLocation('/sales-orders')} data-testid=\"button-cancel\">\n              Cancel\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={() => handleSubmit('draft')}\n              disabled={loading}\n              data-testid=\"button-save-draft\"\n            >\n              {loading ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : null}\n              Save as Draft\n            </Button>\n            <Button\n              onClick={() => handleSubmit('confirm')}\n              disabled={loading}\n              data-testid=\"button-save-confirm\"\n            >\n              {loading ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : null}\n              Save and Confirm\n            </Button>\n          </div>\n        </div>\n      </div>\n      <ManageSalespersonsDialog\n        open={showManageSalespersons}\n        onOpenChange={setShowManageSalespersons}\n        onSalespersonChange={fetchSalespersons}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":34484,"size_tokens":null},"client/src/store/appStore.ts":{"content":"import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\ninterface AppState {\n  sidebarOpen: boolean;\n  sidebarCollapsed: boolean;\n  theme: 'light' | 'dark' | 'system';\n  toggleSidebar: () => void;\n  setSidebarOpen: (open: boolean) => void;\n  toggleSidebarCollapsed: () => void;\n  setTheme: (theme: 'light' | 'dark' | 'system') => void;\n}\n\nexport const useAppStore = create<AppState>()(\n  persist(\n    (set) => ({\n      sidebarOpen: true,\n      sidebarCollapsed: false,\n      theme: 'light',\n      toggleSidebar: () => set((state) => ({ sidebarOpen: !state.sidebarOpen })),\n      setSidebarOpen: (open) => set({ sidebarOpen: open }),\n      toggleSidebarCollapsed: () =>\n        set((state) => ({ sidebarCollapsed: !state.sidebarCollapsed })),\n      setTheme: (theme) => set({ theme }),\n    }),\n    {\n      name: 'app-storage',\n      partialize: (state) => ({\n        sidebarCollapsed: state.sidebarCollapsed,\n        theme: state.theme,\n      }),\n    }\n  )\n);\n","path":null,"size_bytes":984,"size_tokens":null},"client/src/modules/sales/pages/QuotesPage.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Plus, MoreHorizontal, ChevronDown, Search, Filter } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport QuoteDetailPanel from \"../components/QuoteDetailPanel\";\n\ninterface QuoteListItem {\n  id: string;\n  date: string;\n  quoteNumber: string;\n  referenceNumber: string;\n  customerName: string;\n  status: string;\n  convertedTo?: string;\n  total: number;\n}\n\ninterface QuoteDetail {\n  id: string;\n  quoteNumber: string;\n  referenceNumber: string;\n  date: string;\n  expiryDate: string;\n  customerId: string;\n  customerName: string;\n  billingAddress: {\n    street: string;\n    city: string;\n    state: string;\n    country: string;\n    pincode: string;\n  };\n  shippingAddress: {\n    street: string;\n    city: string;\n    state: string;\n    country: string;\n    pincode: string;\n  };\n  salesperson: string;\n  projectName: string;\n  subject: string;\n  placeOfSupply: string;\n  pdfTemplate: string;\n  items: any[];\n  subTotal: number;\n  shippingCharges: number;\n  cgst: number;\n  sgst: number;\n  igst: number;\n  adjustment: number;\n  total: number;\n  customerNotes: string;\n  termsAndConditions: string;\n  status: string;\n  emailRecipients: string[];\n  createdAt: string;\n  activityLogs: any[];\n}\n\nconst getStatusColor = (status: string) => {\n  switch (status.toUpperCase()) {\n    case 'ACCEPTED':\n      return 'text-green-600';\n    case 'SENT':\n      return 'text-blue-600';\n    case 'DRAFT':\n      return 'text-slate-500';\n    case 'DECLINED':\n      return 'text-red-600';\n    case 'CONVERTED':\n      return 'text-purple-600';\n    default:\n      return 'text-slate-500';\n  }\n};\n\nconst getStatusDisplayText = (status: string, convertedTo?: string) => {\n  const upperStatus = status.toUpperCase();\n  if (upperStatus === 'CONVERTED') {\n    if (convertedTo === 'invoice') {\n      return 'Converted To Invoice';\n    } else if (convertedTo === 'sales-order') {\n      return 'Converted To Sales Order';\n    }\n    return 'Converted';\n  }\n  if (upperStatus === 'SENT') {\n    return 'Quotation Send';\n  }\n  if (upperStatus === 'DRAFT') {\n    return 'Draft';\n  }\n  if (upperStatus === 'ACCEPTED') {\n    return 'Accepted';\n  }\n  if (upperStatus === 'DECLINED') {\n    return 'Declined';\n  }\n  if (upperStatus === 'EXPIRED') {\n    return 'Expired';\n  }\n  return status.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ');\n};\n\nconst formatDate = (dateString: string) => {\n  const date = new Date(dateString);\n  return date.toLocaleDateString('en-IN', { day: '2-digit', month: '2-digit', year: 'numeric' });\n};\n\nconst formatCurrency = (amount: number) => {\n  return `${amount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n};\n\nexport default function QuotesPage() {\n  const [, setLocation] = useLocation();\n  const [quotes, setQuotes] = useState<QuoteListItem[]>([]);\n  const [selectedQuotes, setSelectedQuotes] = useState<string[]>([]);\n  const [selectedQuote, setSelectedQuote] = useState<QuoteDetail | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n\n  useEffect(() => {\n    fetchQuotes();\n  }, []);\n\n  const fetchQuotes = async () => {\n    try {\n      const response = await fetch('/api/quotes');\n      if (response.ok) {\n        const data = await response.json();\n        setQuotes(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch quotes:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchQuoteDetail = async (id: string) => {\n    try {\n      const response = await fetch(`/api/quotes/${id}`);\n      if (response.ok) {\n        const data = await response.json();\n        setSelectedQuote(data.data);\n      }\n    } catch (error) {\n      console.error('Failed to fetch quote detail:', error);\n    }\n  };\n\n  const handleQuoteClick = (quote: QuoteListItem) => {\n    fetchQuoteDetail(quote.id);\n  };\n\n  const handleClosePanel = () => {\n    setSelectedQuote(null);\n  };\n\n  const handleEditQuote = () => {\n    if (selectedQuote) {\n      setLocation(`/quotes/${selectedQuote.id}/edit`);\n    }\n  };\n\n  const toggleSelectQuote = (id: string, e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (selectedQuotes.includes(id)) {\n      setSelectedQuotes(selectedQuotes.filter(i => i !== id));\n    } else {\n      setSelectedQuotes([...selectedQuotes, id]);\n    }\n  };\n\n  const filteredQuotes = quotes.filter(quote => \n    quote.customerName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    quote.quoteNumber.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  return (\n    <div className=\"flex h-[calc(100vh-80px)] animate-in fade-in duration-300\">\n      <div className={`flex-1 flex flex-col overflow-hidden ${selectedQuote ? 'max-w-md' : ''}`}>\n        <div className=\"flex items-center justify-between p-4\">\n          <div className=\"flex items-center gap-2\">\n            <h1 className=\"text-xl font-semibold text-slate-900\">All Quotes</h1>\n            <ChevronDown className=\"h-4 w-4 text-slate-500\" />\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button \n              onClick={() => setLocation(\"/quotes/create\")} \n              className=\"bg-blue-600 hover:bg-blue-700 gap-1.5 h-9\"\n            >\n              <Plus className=\"h-4 w-4\" /> New\n            </Button>\n            <Button variant=\"outline\" size=\"icon\" className=\"h-9 w-9\">\n              <MoreHorizontal className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n\n        {!selectedQuote && (\n          <div className=\"px-4 pb-3 flex items-center gap-2\">\n            <div className=\"relative flex-1 max-w-sm\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400\" />\n              <Input\n                placeholder=\"Search quotes...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-9\"\n              />\n            </div>\n            <Button variant=\"outline\" size=\"sm\" className=\"gap-1.5\">\n              <Filter className=\"h-4 w-4\" />\n              Filter\n            </Button>\n          </div>\n        )}\n\n        <div className=\"flex-1 overflow-auto border-t border-slate-200\">\n          {loading ? (\n            <div className=\"p-8 text-center text-slate-500\">Loading quotes...</div>\n          ) : filteredQuotes.length === 0 ? (\n            <div className=\"p-8 text-center text-slate-500\">\n              <p>No quotes found.</p>\n              <Button \n                onClick={() => setLocation(\"/quotes/create\")} \n                className=\"mt-4 bg-blue-600 hover:bg-blue-700\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" /> Create your first quote\n              </Button>\n            </div>\n          ) : selectedQuote ? (\n            <div className=\"divide-y divide-slate-100\">\n              {filteredQuotes.map((quote) => (\n                <div \n                  key={quote.id} \n                  className={`p-4 hover:bg-slate-50 cursor-pointer transition-colors ${\n                    selectedQuote?.id === quote.id ? 'bg-blue-50 border-l-2 border-l-blue-600' : ''\n                  }`}\n                  onClick={() => handleQuoteClick(quote)}\n                >\n                  <div className=\"flex items-start justify-between mb-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <Checkbox \n                        checked={selectedQuotes.includes(quote.id)}\n                        onClick={(e) => toggleSelectQuote(quote.id, e)}\n                      />\n                      <span className=\"font-medium text-slate-900 truncate\">{quote.customerName}</span>\n                    </div>\n                    <span className=\"text-sm font-medium text-slate-900\">\n                      {formatCurrency(quote.total)}\n                    </span>\n                  </div>\n                  <div className=\"ml-6 flex items-center gap-2 text-sm\">\n                    <span className=\"text-slate-500\">{quote.quoteNumber}</span>\n                    <span className=\"text-slate-400\"></span>\n                    <span className=\"text-slate-500\">{formatDate(quote.date)}</span>\n                  </div>\n                  <div className=\"ml-6 mt-1\">\n                    <span className={`text-sm font-medium ${getStatusColor(quote.status)}`}>\n                      {getStatusDisplayText(quote.status, quote.convertedTo)}\n                    </span>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <table className=\"w-full\">\n              <thead className=\"bg-slate-50 sticky top-0\">\n                <tr>\n                  <th className=\"w-12 px-4 py-3\">\n                    <Checkbox />\n                  </th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Date</th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Quote Number</th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Reference Number</th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Customer Name</th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Status</th>\n                  <th className=\"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase\">Amount</th>\n                  <th className=\"w-10 px-4 py-3\"></th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-slate-100\">\n                {filteredQuotes.map((quote) => (\n                  <tr \n                    key={quote.id} \n                    className=\"hover:bg-slate-50 cursor-pointer\"\n                    onClick={() => handleQuoteClick(quote)}\n                  >\n                    <td className=\"px-4 py-3\">\n                      <Checkbox \n                        checked={selectedQuotes.includes(quote.id)}\n                        onClick={(e) => toggleSelectQuote(quote.id, e)}\n                      />\n                    </td>\n                    <td className=\"px-4 py-3 text-sm text-slate-600\">\n                      {formatDate(quote.date)}\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <span className=\"text-sm text-blue-600 hover:underline\">\n                        {quote.quoteNumber}\n                      </span>\n                    </td>\n                    <td className=\"px-4 py-3 text-sm text-slate-600\">\n                      {quote.referenceNumber || '-'}\n                    </td>\n                    <td className=\"px-4 py-3 text-sm text-slate-900 font-medium\">\n                      {quote.customerName}\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <span className={`text-sm font-medium ${getStatusColor(quote.status)}`}>\n                        {getStatusDisplayText(quote.status, quote.convertedTo)}\n                      </span>\n                    </td>\n                    <td className=\"px-4 py-3 text-sm text-slate-900 text-right font-medium\">\n                      {formatCurrency(quote.total)}\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <DropdownMenu>\n                        <DropdownMenuTrigger asChild onClick={(e) => e.stopPropagation()}>\n                          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n                            <MoreHorizontal className=\"h-4 w-4\" />\n                          </Button>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent align=\"end\">\n                          <DropdownMenuItem onClick={(e) => { e.stopPropagation(); setLocation(`/quotes/${quote.id}/edit`); }}>Edit</DropdownMenuItem>\n                          <DropdownMenuItem onClick={(e) => { e.stopPropagation(); setLocation(`/quotes/create?cloneFrom=${quote.id}`); }}>Clone</DropdownMenuItem>\n                          <DropdownMenuItem onClick={(e) => e.stopPropagation()}>Send</DropdownMenuItem>\n                          <DropdownMenuItem onClick={(e) => e.stopPropagation()} className=\"text-red-600\">Delete</DropdownMenuItem>\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          )}\n        </div>\n      </div>\n\n      {selectedQuote && (\n        <div className=\"flex-1 overflow-hidden\">\n          <QuoteDetailPanel \n            quote={selectedQuote} \n            onClose={handleClosePanel}\n            onEdit={handleEditQuote}\n            onRefresh={() => {\n              fetchQuotes();\n              setSelectedQuote(null);\n            }}\n          />\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":13301,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\n      \"p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2859,"size_tokens":null},"server/src/utils/index.ts":{"content":"export * from './pagination';\n","path":null,"size_bytes":30,"size_tokens":null},"server/src/modules/customers/routes/index.ts":{"content":"import { Router } from 'express';\n\nexport const customersRouter = Router();\n\ncustomersRouter.get('/', (req, res) => {\n  res.json({ success: true, data: [], message: 'Customers endpoint' });\n});\n\ncustomersRouter.get('/:id', (req, res) => {\n  res.json({ success: true, data: { id: req.params.id }, message: 'Customer detail endpoint' });\n});\n\ncustomersRouter.post('/', (req, res) => {\n  res.json({ success: true, data: req.body, message: 'Customer created' });\n});\n\nexport default customersRouter;\n","path":null,"size_bytes":496,"size_tokens":null},"server/src/middleware/logger.ts":{"content":"import { Request, Response, NextFunction } from 'express';\n\nexport const requestLogger = (req: Request, res: Response, next: NextFunction) => {\n  const start = Date.now();\n  const { method, url, ip } = req;\n\n  res.on('finish', () => {\n    const duration = Date.now() - start;\n    const { statusCode } = res;\n    \n    const logLevel = statusCode >= 500 ? 'error' : statusCode >= 400 ? 'warn' : 'info';\n    \n    console[logLevel === 'error' ? 'error' : logLevel === 'warn' ? 'warn' : 'log'](\n      `[${new Date().toISOString()}] ${method} ${url} ${statusCode} ${duration}ms - ${ip}`\n    );\n  });\n\n  next();\n};\n\nexport const createLogger = (prefix: string) => ({\n  info: (message: string, ...args: any[]) => {\n    console.log(`[${new Date().toISOString()}] [${prefix}] INFO:`, message, ...args);\n  },\n  warn: (message: string, ...args: any[]) => {\n    console.warn(`[${new Date().toISOString()}] [${prefix}] WARN:`, message, ...args);\n  },\n  error: (message: string, ...args: any[]) => {\n    console.error(`[${new Date().toISOString()}] [${prefix}] ERROR:`, message, ...args);\n  },\n  debug: (message: string, ...args: any[]) => {\n    if (process.env.NODE_ENV === 'development') {\n      console.debug(`[${new Date().toISOString()}] [${prefix}] DEBUG:`, message, ...args);\n    }\n  },\n});\n\nexport default requestLogger;\n","path":null,"size_bytes":1314,"size_tokens":null},"client/src/pages/banking.tsx":{"content":"import { Plus, Search, Filter, Landmark, Link2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent } from \"@/components/ui/card\";\n\nexport default function Banking() {\n  return (\n    <div className=\"max-w-7xl mx-auto space-y-6 animate-in fade-in duration-500\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl sm:text-3xl font-display font-bold text-foreground tracking-tight\">Banking</h1>\n          <p className=\"text-muted-foreground\">Connect and manage your bank accounts for reconciliation.</p>\n        </div>\n        <Button className=\"gap-2 shadow-lg shadow-primary/20\">\n          <Link2 className=\"h-4 w-4\" /> Connect Bank\n        </Button>\n      </div>\n\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"relative flex-1\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input placeholder=\"Search transactions...\" className=\"pl-9\" />\n        </div>\n        <Button variant=\"outline\" className=\"gap-2\">\n          <Filter className=\"h-4 w-4\" /> Filter\n        </Button>\n      </div>\n\n      <Card className=\"border-dashed\">\n        <CardContent className=\"flex flex-col items-center justify-center py-16 text-center\">\n          <div className=\"h-16 w-16 rounded-full bg-muted flex items-center justify-center mb-4\">\n            <Landmark className=\"h-8 w-8 text-muted-foreground\" />\n          </div>\n          <h3 className=\"text-lg font-semibold mb-2\">No bank accounts connected</h3>\n          <p className=\"text-muted-foreground mb-4 max-w-sm\">\n            Connect your bank accounts to automatically import transactions and reconcile your books.\n          </p>\n          <Button className=\"gap-2\">\n            <Link2 className=\"h-4 w-4\" /> Connect Your First Bank Account\n          </Button>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":2031,"size_tokens":null},"client/src/pages/settings.tsx":{"content":"import { useState } from \"react\";\nimport { Upload, Plus } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\n\nexport default function Settings() {\n  return (\n    <div className=\"max-w-6xl mx-auto p-6 space-y-8 mb-20\">\n      <div>\n        <h1 className=\"text-2xl font-bold text-slate-900\">Business Settings</h1>\n        <p className=\"text-slate-500 mt-1\">Manage your business profile and preferences.</p>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n        {/* Left Column - Logo & Signature */}\n        <div className=\"space-y-8\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-base\">Business Logo</CardTitle>\n            </CardHeader>\n            <CardContent>\n               <div className=\"border-2 border-dashed border-slate-300 rounded-lg h-48 flex flex-col items-center justify-center bg-slate-50 hover:bg-slate-100 transition-colors cursor-pointer group relative overflow-hidden\">\n                  <div className=\"flex flex-col items-center gap-2 z-10\">\n                     <div className=\"bg-white p-2 rounded-full shadow-sm border border-slate-200 group-hover:border-blue-300 transition-colors\">\n                        <Upload className=\"h-5 w-5 text-slate-400 group-hover:text-blue-600\" />\n                     </div>\n                     <span className=\"text-sm font-medium text-slate-600 group-hover:text-blue-700\">Upload Logo</span>\n                     <span className=\"text-xs text-slate-400\">PNG, JPG up to 2MB</span>\n                  </div>\n               </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n             <CardHeader>\n                <CardTitle className=\"text-base\">Signature</CardTitle>\n             </CardHeader>\n             <CardContent>\n                <div className=\"border-2 border-dashed border-slate-300 rounded-lg h-32 flex items-center justify-center bg-slate-50 hover:bg-slate-100 transition-colors cursor-pointer group\">\n                   <div className=\"flex items-center gap-2 text-slate-500 group-hover:text-blue-600 transition-colors\">\n                      <Plus className=\"h-4 w-4\" />\n                      <span className=\"text-sm font-medium\">Add Signature</span>\n                   </div>\n                </div>\n             </CardContent>\n          </Card>\n        </div>\n\n        {/* Right Column - Form Fields */}\n        <div className=\"lg:col-span-2 space-y-6\">\n           <Card>\n              <CardContent className=\"p-6 space-y-6\">\n                 <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    <div className=\"space-y-2 md:col-span-2\">\n                       <Label className=\"after:content-['*'] after:ml-0.5 after:text-red-500\">Business Name</Label>\n                       <Input placeholder=\"Enter your business name\" className=\"bg-white\" />\n                    </div>\n\n                    <div className=\"space-y-2\">\n                       <Label>Phone Number</Label>\n                       <Input placeholder=\"Phone number\" className=\"bg-white\" />\n                    </div>\n\n                    <div className=\"space-y-2\">\n                       <Label>Email</Label>\n                       <Input placeholder=\"Email address\" className=\"bg-white\" />\n                    </div>\n\n                    <div className=\"space-y-2 md:col-span-2\">\n                       <Label>Billing Address</Label>\n                       <Textarea placeholder=\"Enter billing address\" className=\"bg-white min-h-[80px]\" />\n                    </div>\n\n                    <div className=\"space-y-2\">\n                       <Label>State</Label>\n                       <Select>\n                          <SelectTrigger className=\"bg-white\">\n                             <SelectValue placeholder=\"Select State\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                             <SelectItem value=\"KA\">Karnataka</SelectItem>\n                             <SelectItem value=\"MH\">Maharashtra</SelectItem>\n                             <SelectItem value=\"DL\">Delhi</SelectItem>\n                             <SelectItem value=\"TN\">Tamil Nadu</SelectItem>\n                          </SelectContent>\n                       </Select>\n                    </div>\n\n                    <div className=\"grid grid-cols-2 gap-4\">\n                       <div className=\"space-y-2\">\n                          <Label>Pincode</Label>\n                          <Input placeholder=\"Pincode\" className=\"bg-white\" />\n                       </div>\n                       <div className=\"space-y-2\">\n                          <Label>City</Label>\n                          <Input placeholder=\"City\" className=\"bg-white\" />\n                       </div>\n                    </div>\n\n                    <div className=\"space-y-2\">\n                       <Label>Business Type</Label>\n                       <Select>\n                          <SelectTrigger className=\"bg-white\">\n                             <SelectValue placeholder=\"Select Type\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                             <SelectItem value=\"proprietorship\">Proprietorship</SelectItem>\n                             <SelectItem value=\"partnership\">Partnership</SelectItem>\n                             <SelectItem value=\"pvt_ltd\">Private Limited</SelectItem>\n                             <SelectItem value=\"public_ltd\">Public Limited</SelectItem>\n                          </SelectContent>\n                       </Select>\n                    </div>\n\n                    <div className=\"space-y-2\">\n                       <Label>Industry Type</Label>\n                       <Select>\n                          <SelectTrigger className=\"bg-white\">\n                             <SelectValue placeholder=\"Select Industry\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                             <SelectItem value=\"retail\">Retail</SelectItem>\n                             <SelectItem value=\"wholesale\">Wholesale</SelectItem>\n                             <SelectItem value=\"manufacturing\">Manufacturing</SelectItem>\n                             <SelectItem value=\"services\">Services</SelectItem>\n                             <SelectItem value=\"technology\">Technology</SelectItem>\n                          </SelectContent>\n                       </Select>\n                    </div>\n                 </div>\n              </CardContent>\n           </Card>\n        </div>\n      </div>\n\n      {/* Sticky Footer */}\n      <div className=\"fixed bottom-0 left-0 md:left-64 right-0 bg-white border-t border-slate-200 p-4 flex items-center gap-4 z-10 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]\">\n         <Button className=\"bg-blue-600 hover:bg-blue-700 min-w-[120px]\">\n            Save Changes\n         </Button>\n         <Button variant=\"outline\" onClick={() => window.history.back()}>\n            Cancel\n         </Button>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":7372,"size_tokens":null},"client/src/components/ui/spinner.tsx":{"content":"import { Loader2Icon } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Spinner({ className, ...props }: React.ComponentProps<\"svg\">) {\n  return (\n    <Loader2Icon\n      role=\"status\"\n      aria-label=\"Loading\"\n      className={cn(\"size-4 animate-spin\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Spinner }\n","path":null,"size_bytes":331,"size_tokens":null},"client/src/modules/purchases/pages/PaymentsMadePage.tsx":{"content":"export { default } from '@/pages/payments-made';\n","path":null,"size_bytes":49,"size_tokens":null},"client/src/pages/vendor-edit.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useLocation, useParams } from \"wouter\";\nimport { Plus, Trash2, HelpCircle, Upload, Link as LinkIcon, Search, Check, X, Paperclip } from \"lucide-react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\n\nconst SALUTATIONS = [\"Mr.\", \"Mrs.\", \"Ms.\", \"Miss\", \"Dr.\"];\n\nconst GST_TREATMENTS = [\n  { value: \"registered-regular\", label: \"Registered Business - Regular\" },\n  { value: \"registered-composition\", label: \"Registered Business - Composition\" },\n  { value: \"unregistered\", label: \"Unregistered Business\" },\n  { value: \"consumer\", label: \"Consumer\" },\n  { value: \"overseas\", label: \"Overseas\" },\n  { value: \"sez\", label: \"Special Economic Zone\" },\n  { value: \"deemed-export\", label: \"Deemed Export\" },\n];\n\nconst INDIAN_STATES = [\n  \"[AN] - Andaman and Nicobar Islands\",\n  \"[AP] - Andhra Pradesh\",\n  \"[AR] - Arunachal Pradesh\",\n  \"[AS] - Assam\",\n  \"[BR] - Bihar\",\n  \"[CG] - Chhattisgarh\",\n  \"[CH] - Chandigarh\",\n  \"[DD] - Daman and Diu\",\n  \"[DL] - Delhi\",\n  \"[GA] - Goa\",\n  \"[GJ] - Gujarat\",\n  \"[HP] - Himachal Pradesh\",\n  \"[HR] - Haryana\",\n  \"[JH] - Jharkhand\",\n  \"[JK] - Jammu and Kashmir\",\n  \"[KA] - Karnataka\",\n  \"[KL] - Kerala\",\n  \"[LA] - Ladakh\",\n  \"[LD] - Lakshadweep\",\n  \"[MH] - Maharashtra\",\n  \"[ML] - Meghalaya\",\n  \"[MN] - Manipur\",\n  \"[MP] - Madhya Pradesh\",\n  \"[MZ] - Mizoram\",\n  \"[NL] - Nagaland\",\n  \"[OR] - Odisha\",\n  \"[PB] - Punjab\",\n  \"[PY] - Puducherry\",\n  \"[RJ] - Rajasthan\",\n  \"[SK] - Sikkim\",\n  \"[TN] - Tamil Nadu\",\n  \"[TS] - Telangana\",\n  \"[TR] - Tripura\",\n  \"[UK] - Uttarakhand\",\n  \"[UP] - Uttar Pradesh\",\n  \"[WB] - West Bengal\",\n];\n\nconst PAYMENT_TERMS = [\n  \"Due on Receipt\",\n  \"Net 15\",\n  \"Net 30\",\n  \"Net 45\",\n  \"Net 60\",\n  \"Due end of the month\",\n  \"Due end of next month\",\n];\n\nconst CURRENCIES = [\n  { value: \"INR\", label: \"INR - Indian Rupee\" },\n  { value: \"USD\", label: \"USD - US Dollar\" },\n  { value: \"EUR\", label: \"EUR - Euro\" },\n  { value: \"GBP\", label: \"GBP - British Pound\" },\n];\n\nconst MSME_REGISTRATION_TYPES = [\n  { value: \"micro\", label: \"Micro\" },\n  { value: \"small\", label: \"Small\" },\n  { value: \"medium\", label: \"Medium\" },\n];\n\nconst TDS_OPTIONS = [\n  { value: \"none\", label: \"None\", rate: \"\" },\n  { value: \"commission-brokerage-2\", label: \"Commission or Brokerage\", rate: \"2%\" },\n  { value: \"commission-brokerage-reduced\", label: \"Commission or Brokerage (Reduced)\", rate: \"3.75%\" },\n  { value: \"dividend-10\", label: \"Dividend\", rate: \"10%\" },\n  { value: \"dividend-reduced\", label: \"Dividend (Reduced)\", rate: \"7.5%\" },\n  { value: \"interest-other-10\", label: \"Other Interest than Securities\", rate: \"10%\" },\n  { value: \"interest-other-reduced\", label: \"Other Interest than Securities (Reduced)\", rate: \"7.5%\" },\n  { value: \"contractors-others-2\", label: \"Payment of Contractors for Others\", rate: \"2%\" },\n  { value: \"contractors-others-reduced\", label: \"Payment of Contractors for Others (Reduced)\", rate: \"1.5%\" },\n  { value: \"contractors-huf-1\", label: \"Payment of Contractors HUF/Indiv\", rate: \"1%\" },\n  { value: \"contractors-huf-reduced\", label: \"Payment of Contractors HUF/Indiv (Reduced)\", rate: \"0.75%\" },\n  { value: \"professional-fees-10\", label: \"Professional Fees\", rate: \"10%\" },\n  { value: \"professional-fees-reduced\", label: \"Professional Fees (Reduced)\", rate: \"7.5%\" },\n  { value: \"rent-land-furniture-10\", label: \"Rent on Land or Furniture etc\", rate: \"10%\" },\n  { value: \"rent-land-furniture-reduced\", label: \"Rent on Land or Furniture etc (Reduced)\", rate: \"7.5%\" },\n  { value: \"technical-fees-2\", label: \"Technical Fees\", rate: \"2%\" },\n];\n\nconst ACCOUNTS = [\n  \"Cost Of Goods Sold\",\n  \"Cost of Goods Sold\",\n  \"Job Costing\",\n  \"Labor\",\n  \"Materials\",\n  \"Subcontractor\",\n  \"Expense\",\n  \"Advertising And Marketing\",\n  \"Automobile Expense\",\n  \"Bad Debt\",\n  \"Bank Fees and Charges\",\n  \"Consultant Expense\",\n  \"Contract Assets\",\n  \"Credit Card Charges\",\n  \"Depreciation And Amortisation\",\n  \"Depreciation Expense\",\n  \"IT and Internet Expenses\",\n  \"Janitorial Expense\",\n  \"Lodging\",\n  \"Meals and Entertainment\",\n  \"Merchandise\",\n  \"Office Supplies\",\n  \"Other Expenses\",\n  \"Postage\",\n  \"Printing and Stationery\",\n  \"Purchase Discounts\",\n  \"Raw Materials And Consumables\",\n  \"Rent Expense\",\n  \"Repairs and Maintenance\",\n  \"Salaries and Employee Wages\",\n  \"Telephone Expense\",\n  \"Transportation Expense\",\n  \"Travel Expense\",\n  \"Non Current Liability\",\n  \"Construction Loans\",\n  \"Mortgages\",\n  \"Other Current Liability\",\n  \"Employee Reimbursements\",\n  \"GST Payable\",\n  \"Output CGST\",\n  \"Output IGST\",\n  \"Output SGST\",\n  \"Tax Payable\",\n  \"TDS Payable\",\n  \"Fixed Asset\",\n  \"Furniture and Equipment\",\n  \"Other Current Asset\",\n  \"Advance Tax\",\n  \"Employee Advance\",\n  \"Input Tax Credits\",\n  \"Input CGST\",\n  \"Input IGST\",\n  \"Input SGST\",\n  \"Prepaid Expenses\",\n  \"TDS Receivable\",\n];\n\ninterface ContactPerson {\n  id: string;\n  salutation: string;\n  firstName: string;\n  lastName: string;\n  email: string;\n  workPhone: string;\n  mobile: string;\n}\n\nexport default function VendorEdit() {\n  const [, setLocation] = useLocation();\n  const params = useParams<{ id: string }>();\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState(\"other-details\");\n  const [saving, setSaving] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [tdsOpen, setTdsOpen] = useState(false);\n  const [accountsOpen, setAccountsOpen] = useState(false);\n  const [showCreateAccountDialog, setShowCreateAccountDialog] = useState(false);\n  const [newAccountName, setNewAccountName] = useState(\"\");\n  const [uploadedFiles, setUploadedFiles] = useState<File[]>([]);\n  const [showAttachmentsDialog, setShowAttachmentsDialog] = useState(false);\n  const [newAttachments, setNewAttachments] = useState<File[]>([]);\n  const [vendorAttachments, setVendorAttachments] = useState<any[]>([]);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const attachmentInputRef = useRef<HTMLInputElement>(null);\n\n  const [formData, setFormData] = useState({\n    salutation: \"\",\n    firstName: \"\",\n    lastName: \"\",\n    companyName: \"\",\n    displayName: \"\",\n    email: \"\",\n    workPhone: \"\",\n    mobile: \"\",\n    gstTreatment: \"\",\n    sourceOfSupply: \"\",\n    pan: \"\",\n    expenseAccount: \"\",\n    msmeRegistered: false,\n    msmeRegistrationType: \"\",\n    msmeRegistrationNumber: \"\",\n    currency: \"INR\",\n    openingBalance: \"\",\n    paymentTerms: \"Due on Receipt\",\n    tds: \"\",\n    billingAddress: {\n      attention: \"\",\n      countryRegion: \"\",\n      street1: \"\",\n      street2: \"\",\n      city: \"\",\n      state: \"\",\n      pinCode: \"\",\n      phone: \"\",\n      faxNumber: \"\",\n    },\n    shippingAddress: {\n      attention: \"\",\n      countryRegion: \"\",\n      street1: \"\",\n      street2: \"\",\n      city: \"\",\n      state: \"\",\n      pinCode: \"\",\n      phone: \"\",\n      faxNumber: \"\",\n    },\n    bankDetails: {\n      accountHolderName: \"\",\n      bankName: \"\",\n      accountNumber: \"\",\n      ifscCode: \"\",\n      swiftCode: \"\",\n      branchName: \"\",\n    },\n    remarks: \"\",\n  });\n\n  const [contactPersons, setContactPersons] = useState<ContactPerson[]>([]);\n\n  useEffect(() => {\n    fetchVendor();\n  }, [params.id]);\n\n  const fetchVendor = async () => {\n    try {\n      const response = await fetch(`/api/vendors/${params.id}`);\n      if (response.ok) {\n        const data = await response.json();\n        const vendor = data.data;\n        setFormData({\n          salutation: vendor.salutation || \"\",\n          firstName: vendor.firstName || \"\",\n          lastName: vendor.lastName || \"\",\n          companyName: vendor.companyName || \"\",\n          displayName: vendor.displayName || \"\",\n          email: vendor.email || \"\",\n          workPhone: vendor.workPhone || \"\",\n          mobile: vendor.mobile || \"\",\n          gstTreatment: vendor.gstTreatment || \"\",\n          sourceOfSupply: vendor.sourceOfSupply || \"\",\n          pan: vendor.pan || \"\",\n          msmeRegistered: vendor.msmeRegistered || false,\n          msmeRegistrationType: vendor.msmeRegistrationType || \"\",\n          msmeRegistrationNumber: vendor.msmeRegistrationNumber || \"\",\n          currency: vendor.currency || \"INR\",\n          openingBalance: vendor.openingBalance?.toString() || \"\",\n          paymentTerms: vendor.paymentTerms || \"Due on Receipt\",\n          tds: vendor.tds || \"\",\n          billingAddress: vendor.billingAddress || {\n            attention: \"\",\n            countryRegion: \"\",\n            street1: \"\",\n            street2: \"\",\n            city: \"\",\n            state: \"\",\n            pinCode: \"\",\n            phone: \"\",\n            faxNumber: \"\",\n          },\n          shippingAddress: vendor.shippingAddress || {\n            attention: \"\",\n            countryRegion: \"\",\n            street1: \"\",\n            street2: \"\",\n            city: \"\",\n            state: \"\",\n            pinCode: \"\",\n            phone: \"\",\n            faxNumber: \"\",\n          },\n          bankDetails: vendor.bankDetails || {\n            accountHolderName: \"\",\n            bankName: \"\",\n            accountNumber: \"\",\n            ifscCode: \"\",\n            swiftCode: \"\",\n            branchName: \"\",\n          },\n          remarks: vendor.remarks || \"\",\n        });\n        setContactPersons(vendor.contactPersons || []);\n      } else {\n        toast({ title: \"Failed to load vendor\", variant: \"destructive\" });\n        setLocation('/vendors');\n      }\n    } catch (error) {\n      toast({ title: \"Failed to load vendor\", variant: \"destructive\" });\n      setLocation('/vendors');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleInputChange = (field: string, value: any) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n  };\n\n  const handleAddressChange = (type: 'billingAddress' | 'shippingAddress', field: string, value: string) => {\n    setFormData(prev => ({\n      ...prev,\n      [type]: { ...prev[type], [field]: value }\n    }));\n  };\n\n  const handleBankDetailsChange = (field: string, value: string) => {\n    setFormData(prev => ({\n      ...prev,\n      bankDetails: { ...prev.bankDetails, [field]: value }\n    }));\n  };\n\n  const copyBillingToShipping = () => {\n    setFormData(prev => ({\n      ...prev,\n      shippingAddress: { ...prev.billingAddress }\n    }));\n  };\n\n  const addContactPerson = () => {\n    setContactPersons(prev => [...prev, {\n      id: Date.now().toString(),\n      salutation: \"\",\n      firstName: \"\",\n      lastName: \"\",\n      email: \"\",\n      workPhone: \"\",\n      mobile: \"\",\n    }]);\n  };\n\n  const updateContactPerson = (id: string, field: string, value: string) => {\n    setContactPersons(prev => prev.map(cp => \n      cp.id === id ? { ...cp, [field]: value } : cp\n    ));\n  };\n\n  const removeContactPerson = (id: string) => {\n    setContactPersons(prev => prev.filter(cp => cp.id !== id));\n  };\n\n  const handleAttachmentUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (files) {\n      const newFiles = Array.from(files);\n      if (newAttachments.length + newFiles.length > 10) {\n        toast({ title: \"Maximum 10 files allowed\", variant: \"destructive\" });\n        return;\n      }\n      const validFiles = newFiles.filter(file => {\n        if (file.size > 10 * 1024 * 1024) {\n          toast({ title: `${file.name} exceeds 10MB limit`, variant: \"destructive\" });\n          return false;\n        }\n        return true;\n      });\n      setNewAttachments(prev => [...prev, ...validFiles]);\n      if (attachmentInputRef.current) attachmentInputRef.current.value = '';\n    }\n  };\n\n  const removeAttachment = (index: number) => {\n    setNewAttachments(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (files) {\n      const newFiles = Array.from(files);\n      const totalFiles = uploadedFiles.length + newFiles.length;\n      \n      if (totalFiles > 10) {\n        toast({ title: \"Maximum 10 files allowed\", variant: \"destructive\" });\n        return;\n      }\n\n      const validFiles = newFiles.filter(file => {\n        if (file.size > 10 * 1024 * 1024) {\n          toast({ title: `${file.name} exceeds 10MB limit`, variant: \"destructive\" });\n          return false;\n        }\n        return true;\n      });\n\n      setUploadedFiles(prev => [...prev, ...validFiles]);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  const removeFile = (index: number) => {\n    setUploadedFiles(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const handleCreateAccount = () => {\n    if (!newAccountName.trim()) {\n      toast({ title: \"Account name is required\", variant: \"destructive\" });\n      return;\n    }\n    handleInputChange('expenseAccount', newAccountName);\n    setShowCreateAccountDialog(false);\n    setNewAccountName(\"\");\n    toast({ title: \"Account created and selected\" });\n  };\n\n  const handleSave = async () => {\n    if (!formData.displayName) {\n      toast({ title: \"Display Name is required\", variant: \"destructive\" });\n      return;\n    }\n\n    if (!formData.gstTreatment) {\n      toast({ title: \"GST Treatment is required\", variant: \"destructive\" });\n      return;\n    }\n\n    if (!formData.sourceOfSupply) {\n      toast({ title: \"Source of Supply is required\", variant: \"destructive\" });\n      return;\n    }\n\n    if (formData.msmeRegistered) {\n      if (!formData.msmeRegistrationType) {\n        toast({ title: \"MSME/Udyam Registration Type is required\", variant: \"destructive\" });\n        return;\n      }\n      if (!formData.msmeRegistrationNumber) {\n        toast({ title: \"MSME/Udyam Registration Number is required\", variant: \"destructive\" });\n        return;\n      }\n      if (!/^UDYAM-[A-Z]{2}-\\d{2}-\\d{7}$/.test(formData.msmeRegistrationNumber)) {\n        toast({ title: \"Invalid MSME/Udyam Registration Number format\", variant: \"destructive\" });\n        return;\n      }\n    }\n\n    setSaving(true);\n    try {\n      const payload = {\n        ...formData,\n        contactPersons,\n        openingBalance: formData.openingBalance ? parseFloat(formData.openingBalance) : 0,\n      };\n\n      const response = await fetch(`/api/vendors/${params.id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      });\n\n      if (response.ok) {\n        toast({ title: \"Vendor updated successfully\" });\n        setLocation('/vendors');\n      } else {\n        const error = await response.json();\n        toast({ title: error.message || \"Failed to update vendor\", variant: \"destructive\" });\n      }\n    } catch (error) {\n      toast({ title: \"Failed to update vendor\", variant: \"destructive\" });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"h-full flex items-center justify-center\">\n        <p className=\"text-slate-500\">Loading vendor...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full flex flex-col bg-white\">\n      <div className=\"border-b border-slate-200 px-6 py-4\">\n        <h1 className=\"text-2xl font-semibold text-slate-900\">Edit Vendor</h1>\n      </div>\n\n      <div className=\"flex-1 overflow-auto\">\n        <div className=\"max-w-4xl mx-auto p-6 space-y-6\">\n          <div className=\"bg-blue-50 border border-blue-200 rounded-md px-4 py-3 flex items-center gap-2\">\n            <LinkIcon className=\"h-4 w-4 text-blue-600\" />\n            <span className=\"text-sm text-blue-800\">\n              Prefill Vendor details from the GST portal using the Vendor's GSTIN.{\" \"}\n              <a href=\"#\" className=\"text-blue-600 hover:underline\">Prefill</a>\n            </span>\n          </div>\n\n          <div className=\"grid grid-cols-[200px_1fr] gap-6 items-start\">\n            <Label className=\"text-sm font-medium text-slate-700 pt-2 flex items-center gap-1\">\n              Primary Contact\n              <HelpCircle className=\"h-3.5 w-3.5 text-slate-400\" />\n            </Label>\n            <div className=\"flex gap-3\">\n              <Select value={formData.salutation} onValueChange={(v) => handleInputChange('salutation', v)}>\n                <SelectTrigger className=\"w-32\" data-testid=\"select-salutation\">\n                  <SelectValue placeholder=\"Salutation\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {SALUTATIONS.map(s => <SelectItem key={s} value={s}>{s}</SelectItem>)}\n                </SelectContent>\n              </Select>\n              <Input \n                placeholder=\"First Name\" \n                value={formData.firstName}\n                onChange={(e) => handleInputChange('firstName', e.target.value)}\n                className=\"flex-1\"\n                data-testid=\"input-first-name\"\n              />\n              <Input \n                placeholder=\"Last Name\" \n                value={formData.lastName}\n                onChange={(e) => handleInputChange('lastName', e.target.value)}\n                className=\"flex-1\"\n                data-testid=\"input-last-name\"\n              />\n            </div>\n\n            <Label className=\"text-sm font-medium text-slate-700 pt-2\">Company Name</Label>\n            <Input \n              value={formData.companyName}\n              onChange={(e) => handleInputChange('companyName', e.target.value)}\n              data-testid=\"input-company-name\"\n            />\n\n            <Label className=\"text-sm font-medium text-slate-700 pt-2\">\n              Expense Account\n              <span className=\"text-red-600\">*</span>\n            </Label>\n            <Popover open={accountsOpen} onOpenChange={setAccountsOpen}>\n              <PopoverTrigger asChild>\n                <Button\n                  variant=\"outline\"\n                  role=\"combobox\"\n                  aria-expanded={accountsOpen}\n                  className=\"w-full justify-between font-normal\"\n                  data-testid=\"select-expense-account\"\n                >\n                  {formData.expenseAccount || \"Search and select account...\"}\n                  <Search className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                </Button>\n              </PopoverTrigger>\n              <PopoverContent className=\"w-[400px] p-0\" align=\"start\">\n                <Command>\n                  <CommandInput placeholder=\"Search accounts...\" />\n                  <CommandList>\n                    <CommandEmpty>No account found.</CommandEmpty>\n                    <CommandGroup>\n                      {ACCOUNTS.map((account) => (\n                        <CommandItem\n                          key={account}\n                          value={account}\n                          onSelect={() => {\n                            handleInputChange('expenseAccount', account);\n                            setAccountsOpen(false);\n                          }}\n                        >\n                          <Check\n                            className={`mr-2 h-4 w-4 ${\n                              formData.expenseAccount === account ? \"opacity-100\" : \"opacity-0\"\n                            }`}\n                          />\n                          {account}\n                        </CommandItem>\n                      ))}\n                    </CommandGroup>\n                    <div className=\"border-t px-2 py-2\">\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        className=\"w-full justify-start gap-2\"\n                        onClick={() => {\n                          setShowCreateAccountDialog(true);\n                          setAccountsOpen(false);\n                        }}\n                        type=\"button\"\n                      >\n                        <Plus className=\"h-4 w-4\" />\n                        Create New Account\n                      </Button>\n                    </div>\n                  </CommandList>\n                </Command>\n              </PopoverContent>\n            </Popover>\n\n            <Label className=\"text-sm font-medium text-slate-700 pt-2 flex items-center gap-1\">\n              Display Name\n              <span className=\"text-red-600\">*</span>\n              <HelpCircle className=\"h-3.5 w-3.5 text-slate-400\" />\n            </Label>\n            <Input \n              value={formData.displayName}\n              onChange={(e) => handleInputChange('displayName', e.target.value)}\n              data-testid=\"input-display-name\"\n            />\n\n            <Label className=\"text-sm font-medium text-slate-700 pt-2 flex items-center gap-1\">\n              Email Address\n              <HelpCircle className=\"h-3.5 w-3.5 text-slate-400\" />\n            </Label>\n            <Input \n              type=\"email\"\n              value={formData.email}\n              onChange={(e) => handleInputChange('email', e.target.value)}\n              data-testid=\"input-email\"\n            />\n\n            <Label className=\"text-sm font-medium text-slate-700 pt-2 flex items-center gap-1\">\n              Phone\n              <HelpCircle className=\"h-3.5 w-3.5 text-slate-400\" />\n            </Label>\n            <div className=\"flex gap-3\">\n              <Input \n                placeholder=\"Work Phone\" \n                value={formData.workPhone}\n                onChange={(e) => handleInputChange('workPhone', e.target.value)}\n                className=\"flex-1\"\n                data-testid=\"input-work-phone\"\n              />\n              <Input \n                placeholder=\"Mobile\" \n                value={formData.mobile}\n                onChange={(e) => handleInputChange('mobile', e.target.value)}\n                className=\"flex-1\"\n                data-testid=\"input-mobile\"\n              />\n            </div>\n          </div>\n\n          <Tabs value={activeTab} onValueChange={setActiveTab} className=\"mt-6\">\n            <TabsList className=\"h-12 w-full justify-start rounded-none border-b bg-transparent p-0 gap-0\">\n              <TabsTrigger \n                value=\"other-details\" \n                className=\"rounded-none border-b-2 border-transparent px-6 data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n              >\n                Other Details\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"address\" \n                className=\"rounded-none border-b-2 border-transparent px-6 data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n              >\n                Address\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"contact-persons\" \n                className=\"rounded-none border-b-2 border-transparent px-6 data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n              >\n                Contact Persons\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"bank-details\" \n                className=\"rounded-none border-b-2 border-transparent px-6 data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n              >\n                Bank Details\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"custom-fields\" \n                className=\"rounded-none border-b-2 border-transparent px-6 data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n              >\n                Custom Fields\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"reporting-tags\" \n                className=\"rounded-none border-b-2 border-transparent px-6 data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n              >\n                Reporting Tags\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"remarks\" \n                className=\"rounded-none border-b-2 border-transparent px-6 data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n              >\n                Remarks\n              </TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"other-details\" className=\"mt-6\">\n              <div className=\"grid grid-cols-[200px_1fr] gap-6 items-start\">\n                <Label className=\"text-sm font-medium text-red-600 pt-2\">GST Treatment*</Label>\n                <Select value={formData.gstTreatment} onValueChange={(v) => handleInputChange('gstTreatment', v)}>\n                  <SelectTrigger data-testid=\"select-gst-treatment\">\n                    <SelectValue placeholder=\"Select a GST treatment\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {GST_TREATMENTS.map(g => (\n                      <SelectItem key={g.value} value={g.label}>{g.label}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n\n                <Label className=\"text-sm font-medium text-red-600 pt-2\">Source of Supply*</Label>\n                <Select value={formData.sourceOfSupply} onValueChange={(v) => handleInputChange('sourceOfSupply', v)}>\n                  <SelectTrigger data-testid=\"select-source-of-supply\">\n                    <SelectValue placeholder=\"Select\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {INDIAN_STATES.map(s => (\n                      <SelectItem key={s} value={s}>{s}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n\n                <Label className=\"text-sm font-medium text-slate-700 pt-2 flex items-center gap-1\">\n                  PAN\n                  <HelpCircle className=\"h-3.5 w-3.5 text-slate-400\" />\n                </Label>\n                <Input \n                  value={formData.pan}\n                  onChange={(e) => handleInputChange('pan', e.target.value.toUpperCase())}\n                  maxLength={10}\n                  data-testid=\"input-pan\"\n                />\n\n                <Label className=\"text-sm font-medium text-slate-700 pt-2 flex items-center gap-1\">\n                  MSME Registered?\n                  <HelpCircle className=\"h-3.5 w-3.5 text-slate-400\" />\n                </Label>\n                <div className=\"flex items-center gap-2\">\n                  <Checkbox \n                    checked={formData.msmeRegistered}\n                    onCheckedChange={(v) => {\n                      handleInputChange('msmeRegistered', v);\n                      if (!v) {\n                        handleInputChange('msmeRegistrationType', '');\n                        handleInputChange('msmeRegistrationNumber', '');\n                      }\n                    }}\n                    data-testid=\"checkbox-msme\"\n                  />\n                  <span className=\"text-sm text-slate-600\">This vendor is MSME registered</span>\n                </div>\n\n                {formData.msmeRegistered && (\n                  <>\n                    <Label className=\"text-sm font-medium text-red-600 pt-2 flex items-center gap-1\">\n                      MSME/Udyam Registration Type*\n                    </Label>\n                    <Select \n                      value={formData.msmeRegistrationType} \n                      onValueChange={(v) => handleInputChange('msmeRegistrationType', v)}\n                    >\n                      <SelectTrigger data-testid=\"select-msme-type\">\n                        <SelectValue placeholder=\"Select the Registration Type...\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {MSME_REGISTRATION_TYPES.map(t => (\n                          <SelectItem key={t.value} value={t.value}>{t.label}</SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n\n                    <Label className=\"text-sm font-medium text-red-600 pt-2 flex items-center gap-1\">\n                      MSME/Udyam Registration Number\n                      <HelpCircle className=\"h-3.5 w-3.5 text-slate-400\" />\n                      *\n                    </Label>\n                    <div>\n                      <Input \n                        value={formData.msmeRegistrationNumber}\n                        onChange={(e) => handleInputChange('msmeRegistrationNumber', e.target.value.toUpperCase())}\n                        placeholder=\"Enter the Registration Number\"\n                        data-testid=\"input-msme-number\"\n                      />\n                      {formData.msmeRegistrationNumber && !/^UDYAM-[A-Z]{2}-\\d{2}-\\d{7}$/.test(formData.msmeRegistrationNumber) && (\n                        <p className=\"text-sm text-red-500 mt-1 flex items-start gap-1\">\n                          <span className=\"text-red-500\">!</span>\n                          Enter a valid MSME/Udyam Registration Number. Ensure that the number is in the format UDYAM-XX-00-0000000.\n                        </p>\n                      )}\n                    </div>\n                  </>\n                )}\n\n                <Label className=\"text-sm font-medium text-slate-700 pt-2\">Currency</Label>\n                <Select value={formData.currency} onValueChange={(v) => handleInputChange('currency', v)}>\n                  <SelectTrigger data-testid=\"select-currency\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {CURRENCIES.map(c => (\n                      <SelectItem key={c.value} value={c.value}>{c.label}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n\n                <Label className=\"text-sm font-medium text-slate-700 pt-2\">Opening Balance</Label>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-slate-500\">INR</span>\n                  <Input \n                    type=\"number\"\n                    value={formData.openingBalance}\n                    onChange={(e) => handleInputChange('openingBalance', e.target.value)}\n                    className=\"flex-1\"\n                    data-testid=\"input-opening-balance\"\n                  />\n                </div>\n\n                <Label className=\"text-sm font-medium text-slate-700 pt-2\">Payment Terms</Label>\n                <Select value={formData.paymentTerms} onValueChange={(v) => handleInputChange('paymentTerms', v)}>\n                  <SelectTrigger data-testid=\"select-payment-terms\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {PAYMENT_TERMS.map(p => (\n                      <SelectItem key={p} value={p}>{p}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n\n                <Label className=\"text-sm font-medium text-slate-700 pt-2\">TDS</Label>\n                <Popover open={tdsOpen} onOpenChange={setTdsOpen}>\n                  <PopoverTrigger asChild>\n                    <Button\n                      variant=\"outline\"\n                      role=\"combobox\"\n                      aria-expanded={tdsOpen}\n                      className=\"w-full justify-between font-normal\"\n                      data-testid=\"select-tds\"\n                    >\n                      {formData.tds\n                        ? TDS_OPTIONS.find((t) => t.value === formData.tds)?.label + \n                          (TDS_OPTIONS.find((t) => t.value === formData.tds)?.rate \n                            ? ` - ${TDS_OPTIONS.find((t) => t.value === formData.tds)?.rate}` \n                            : '')\n                        : \"Select a Tax\"}\n                      <Search className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-[400px] p-0\" align=\"start\">\n                    <Command>\n                      <CommandInput placeholder=\"Search TDS type...\" />\n                      <CommandList>\n                        <CommandEmpty>No TDS type found.</CommandEmpty>\n                        <CommandGroup>\n                          {TDS_OPTIONS.map((tds) => (\n                            <CommandItem\n                              key={tds.value}\n                              value={tds.label}\n                              onSelect={() => {\n                                handleInputChange('tds', tds.value);\n                                setTdsOpen(false);\n                              }}\n                              className=\"flex justify-between\"\n                            >\n                              <div className=\"flex items-center gap-2\">\n                                <Check\n                                  className={`h-4 w-4 ${\n                                    formData.tds === tds.value ? \"opacity-100\" : \"opacity-0\"\n                                  }`}\n                                />\n                                <span>{tds.label}</span>\n                              </div>\n                              {tds.rate && (\n                                <span className=\"text-slate-500\">{tds.rate}</span>\n                              )}\n                            </CommandItem>\n                          ))}\n                        </CommandGroup>\n                      </CommandList>\n                    </Command>\n                  </PopoverContent>\n                </Popover>\n\n                <Label className=\"text-sm font-medium text-slate-700 pt-2\">Documents</Label>\n                <div>\n                  <div className=\"flex items-center gap-2\">\n                    <Button \n                      variant=\"outline\" \n                      className=\"gap-2\"\n                      onClick={() => fileInputRef.current?.click()}\n                      data-testid=\"button-upload-file\"\n                      type=\"button\"\n                    >\n                      <Upload className=\"h-4 w-4\" />\n                      Upload File\n                    </Button>\n                    {(uploadedFiles.length > 0 || vendorAttachments.length > 0) && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => setShowAttachmentsDialog(true)}\n                        data-testid=\"button-view-attachments\"\n                        type=\"button\"\n                        className=\"text-blue-600 hover:text-blue-700\"\n                      >\n                        <Paperclip className=\"h-5 w-5\" />\n                      </Button>\n                    )}\n                  </div>\n                  <input \n                    ref={fileInputRef}\n                    type=\"file\"\n                    multiple\n                    hidden\n                    onChange={handleFileUpload}\n                    accept=\"*/*\"\n                  />\n                  <p className=\"text-xs text-slate-500 mt-1\">You can upload a maximum of 10 files, 10MB each</p>\n                  \n                  {uploadedFiles.length > 0 && (\n                    <div className=\"mt-4 space-y-2\">\n                      <p className=\"text-sm font-medium text-slate-700\">Uploaded Files ({uploadedFiles.length}/10)</p>\n                      <div className=\"space-y-2\">\n                        {uploadedFiles.map((file, index) => (\n                          <div key={index} className=\"flex items-center justify-between bg-slate-50 p-3 rounded-md border border-slate-200\">\n                            <div className=\"flex-1 min-w-0\">\n                              <p className=\"text-sm text-slate-900 truncate\">{file.name}</p>\n                              <p className=\"text-xs text-slate-500\">{(file.size / 1024).toFixed(2)} KB</p>\n                            </div>\n                            <Button \n                              variant=\"ghost\" \n                              size=\"icon\"\n                              className=\"h-8 w-8 text-slate-400 hover:text-red-600 flex-shrink-0\"\n                              onClick={() => removeFile(index)}\n                              data-testid={`button-remove-file-${index}`}\n                              type=\"button\"\n                            >\n                              <X className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"address\" className=\"mt-6\">\n              <div className=\"grid grid-cols-2 gap-8\">\n                <div>\n                  <h3 className=\"font-semibold text-slate-900 mb-4\">Billing Address</h3>\n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Attention</Label>\n                      <Input \n                        value={formData.billingAddress.attention}\n                        onChange={(e) => handleAddressChange('billingAddress', 'attention', e.target.value)}\n                        data-testid=\"input-billing-attention\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Country/Region</Label>\n                      <Select \n                        value={formData.billingAddress.countryRegion} \n                        onValueChange={(v) => handleAddressChange('billingAddress', 'countryRegion', v)}\n                      >\n                        <SelectTrigger data-testid=\"select-billing-country\">\n                          <SelectValue placeholder=\"Select\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"India\">India</SelectItem>\n                          <SelectItem value=\"United States\">United States</SelectItem>\n                          <SelectItem value=\"United Kingdom\">United Kingdom</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Address</Label>\n                      <Textarea \n                        placeholder=\"Street 1\"\n                        value={formData.billingAddress.street1}\n                        onChange={(e) => handleAddressChange('billingAddress', 'street1', e.target.value)}\n                        className=\"mb-2\"\n                        data-testid=\"input-billing-street1\"\n                      />\n                      <Textarea \n                        placeholder=\"Street 2\"\n                        value={formData.billingAddress.street2}\n                        onChange={(e) => handleAddressChange('billingAddress', 'street2', e.target.value)}\n                        data-testid=\"input-billing-street2\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">City</Label>\n                      <Input \n                        value={formData.billingAddress.city}\n                        onChange={(e) => handleAddressChange('billingAddress', 'city', e.target.value)}\n                        data-testid=\"input-billing-city\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">State</Label>\n                      <Select \n                        value={formData.billingAddress.state} \n                        onValueChange={(v) => handleAddressChange('billingAddress', 'state', v)}\n                      >\n                        <SelectTrigger data-testid=\"select-billing-state\">\n                          <SelectValue placeholder=\"Select or type to add\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {INDIAN_STATES.map(s => (\n                            <SelectItem key={s} value={s}>{s}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Pin Code</Label>\n                      <Input \n                        value={formData.billingAddress.pinCode}\n                        onChange={(e) => handleAddressChange('billingAddress', 'pinCode', e.target.value)}\n                        data-testid=\"input-billing-pincode\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Phone</Label>\n                      <Input \n                        value={formData.billingAddress.phone}\n                        onChange={(e) => handleAddressChange('billingAddress', 'phone', e.target.value)}\n                        data-testid=\"input-billing-phone\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Fax Number</Label>\n                      <Input \n                        value={formData.billingAddress.faxNumber}\n                        onChange={(e) => handleAddressChange('billingAddress', 'faxNumber', e.target.value)}\n                        data-testid=\"input-billing-fax\"\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                <div>\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <h3 className=\"font-semibold text-slate-900\">Shipping Address</h3>\n                    <button \n                      type=\"button\"\n                      onClick={copyBillingToShipping}\n                      className=\"text-sm text-blue-600 hover:underline\"\n                      data-testid=\"button-copy-billing\"\n                    >\n                      Copy billing address\n                    </button>\n                  </div>\n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Attention</Label>\n                      <Input \n                        value={formData.shippingAddress.attention}\n                        onChange={(e) => handleAddressChange('shippingAddress', 'attention', e.target.value)}\n                        data-testid=\"input-shipping-attention\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Country/Region</Label>\n                      <Select \n                        value={formData.shippingAddress.countryRegion} \n                        onValueChange={(v) => handleAddressChange('shippingAddress', 'countryRegion', v)}\n                      >\n                        <SelectTrigger data-testid=\"select-shipping-country\">\n                          <SelectValue placeholder=\"Select\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"India\">India</SelectItem>\n                          <SelectItem value=\"United States\">United States</SelectItem>\n                          <SelectItem value=\"United Kingdom\">United Kingdom</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Address</Label>\n                      <Textarea \n                        placeholder=\"Street 1\"\n                        value={formData.shippingAddress.street1}\n                        onChange={(e) => handleAddressChange('shippingAddress', 'street1', e.target.value)}\n                        className=\"mb-2\"\n                        data-testid=\"input-shipping-street1\"\n                      />\n                      <Textarea \n                        placeholder=\"Street 2\"\n                        value={formData.shippingAddress.street2}\n                        onChange={(e) => handleAddressChange('shippingAddress', 'street2', e.target.value)}\n                        data-testid=\"input-shipping-street2\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">City</Label>\n                      <Input \n                        value={formData.shippingAddress.city}\n                        onChange={(e) => handleAddressChange('shippingAddress', 'city', e.target.value)}\n                        data-testid=\"input-shipping-city\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">State</Label>\n                      <Select \n                        value={formData.shippingAddress.state} \n                        onValueChange={(v) => handleAddressChange('shippingAddress', 'state', v)}\n                      >\n                        <SelectTrigger data-testid=\"select-shipping-state\">\n                          <SelectValue placeholder=\"Select or type to add\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {INDIAN_STATES.map(s => (\n                            <SelectItem key={s} value={s}>{s}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Pin Code</Label>\n                      <Input \n                        value={formData.shippingAddress.pinCode}\n                        onChange={(e) => handleAddressChange('shippingAddress', 'pinCode', e.target.value)}\n                        data-testid=\"input-shipping-pincode\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Phone</Label>\n                      <Input \n                        value={formData.shippingAddress.phone}\n                        onChange={(e) => handleAddressChange('shippingAddress', 'phone', e.target.value)}\n                        data-testid=\"input-shipping-phone\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-sm text-slate-600\">Fax Number</Label>\n                      <Input \n                        value={formData.shippingAddress.faxNumber}\n                        onChange={(e) => handleAddressChange('shippingAddress', 'faxNumber', e.target.value)}\n                        data-testid=\"input-shipping-fax\"\n                      />\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"contact-persons\" className=\"mt-6\">\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full\">\n                  <thead className=\"bg-slate-50\">\n                    <tr>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Salutation</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">First Name</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Last Name</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Email Address</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Work Phone</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Mobile</th>\n                      <th className=\"px-4 py-3 w-12\"></th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-slate-100\">\n                    {contactPersons.map((cp, index) => (\n                      <tr key={cp.id}>\n                        <td className=\"px-4 py-2\">\n                          <Select \n                            value={cp.salutation} \n                            onValueChange={(v) => updateContactPerson(cp.id, 'salutation', v)}\n                          >\n                            <SelectTrigger className=\"w-24\">\n                              <SelectValue placeholder=\"Select\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {SALUTATIONS.map(s => <SelectItem key={s} value={s}>{s}</SelectItem>)}\n                            </SelectContent>\n                          </Select>\n                        </td>\n                        <td className=\"px-4 py-2\">\n                          <Input \n                            value={cp.firstName}\n                            onChange={(e) => updateContactPerson(cp.id, 'firstName', e.target.value)}\n                          />\n                        </td>\n                        <td className=\"px-4 py-2\">\n                          <Input \n                            value={cp.lastName}\n                            onChange={(e) => updateContactPerson(cp.id, 'lastName', e.target.value)}\n                          />\n                        </td>\n                        <td className=\"px-4 py-2\">\n                          <Input \n                            type=\"email\"\n                            value={cp.email}\n                            onChange={(e) => updateContactPerson(cp.id, 'email', e.target.value)}\n                          />\n                        </td>\n                        <td className=\"px-4 py-2\">\n                          <Input \n                            value={cp.workPhone}\n                            onChange={(e) => updateContactPerson(cp.id, 'workPhone', e.target.value)}\n                          />\n                        </td>\n                        <td className=\"px-4 py-2\">\n                          <Input \n                            value={cp.mobile}\n                            onChange={(e) => updateContactPerson(cp.id, 'mobile', e.target.value)}\n                          />\n                        </td>\n                        <td className=\"px-4 py-2\">\n                          <Button \n                            variant=\"ghost\" \n                            size=\"icon\" \n                            className=\"h-8 w-8 text-slate-400 hover:text-red-600\"\n                            onClick={() => removeContactPerson(cp.id)}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </td>\n                      </tr>\n                    ))}\n                    {contactPersons.length === 0 && (\n                      <tr>\n                        <td colSpan={7} className=\"px-4 py-8 text-center text-slate-500\">\n                          No contact persons added yet\n                        </td>\n                      </tr>\n                    )}\n                  </tbody>\n                </table>\n              </div>\n              <Button \n                variant=\"outline\" \n                className=\"mt-4 gap-2 text-blue-600 border-blue-200 hover:bg-blue-50\"\n                onClick={addContactPerson}\n                data-testid=\"button-add-contact\"\n              >\n                <Plus className=\"h-4 w-4\" />\n                Add Contact Person\n              </Button>\n            </TabsContent>\n\n            <TabsContent value=\"bank-details\" className=\"mt-6\">\n              <div className=\"max-w-xl space-y-4\">\n                <div>\n                  <Label className=\"text-sm text-slate-600\">Account Holder Name</Label>\n                  <Input \n                    value={formData.bankDetails.accountHolderName}\n                    onChange={(e) => handleBankDetailsChange('accountHolderName', e.target.value)}\n                    data-testid=\"input-account-holder\"\n                  />\n                </div>\n                <div>\n                  <Label className=\"text-sm text-slate-600\">Bank Name</Label>\n                  <Input \n                    value={formData.bankDetails.bankName}\n                    onChange={(e) => handleBankDetailsChange('bankName', e.target.value)}\n                    data-testid=\"input-bank-name\"\n                  />\n                </div>\n                <div>\n                  <Label className=\"text-sm text-slate-600\">Account Number</Label>\n                  <Input \n                    value={formData.bankDetails.accountNumber}\n                    onChange={(e) => handleBankDetailsChange('accountNumber', e.target.value)}\n                    data-testid=\"input-account-number\"\n                  />\n                </div>\n                <div>\n                  <Label className=\"text-sm text-slate-600\">IFSC Code</Label>\n                  <Input \n                    value={formData.bankDetails.ifscCode}\n                    onChange={(e) => handleBankDetailsChange('ifscCode', e.target.value.toUpperCase())}\n                    data-testid=\"input-ifsc\"\n                  />\n                </div>\n                <div>\n                  <Label className=\"text-sm text-slate-600\">SWIFT Code</Label>\n                  <Input \n                    value={formData.bankDetails.swiftCode}\n                    onChange={(e) => handleBankDetailsChange('swiftCode', e.target.value.toUpperCase())}\n                    data-testid=\"input-swift\"\n                  />\n                </div>\n                <div>\n                  <Label className=\"text-sm text-slate-600\">Branch Name</Label>\n                  <Input \n                    value={formData.bankDetails.branchName}\n                    onChange={(e) => handleBankDetailsChange('branchName', e.target.value)}\n                    data-testid=\"input-branch\"\n                  />\n                </div>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"custom-fields\" className=\"mt-6\">\n              <div className=\"text-center py-12 text-slate-500\">\n                <p className=\"text-lg font-medium mb-1\">No custom fields configured</p>\n                <p className=\"text-sm text-slate-400\">Custom fields can be configured in Settings</p>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"reporting-tags\" className=\"mt-6\">\n              <div className=\"text-center py-12 text-slate-500\">\n                <p className=\"text-lg font-medium mb-1\">No reporting tags configured</p>\n                <p className=\"text-sm text-slate-400\">Reporting tags can be configured in Settings</p>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"remarks\" className=\"mt-6\">\n              <div className=\"max-w-xl\">\n                <Label className=\"text-sm text-slate-600 mb-2 block\">Remarks (For Internal Use)</Label>\n                <Textarea \n                  placeholder=\"Add any internal notes about this vendor...\"\n                  value={formData.remarks}\n                  onChange={(e) => handleInputChange('remarks', e.target.value)}\n                  rows={6}\n                  data-testid=\"input-remarks\"\n                />\n              </div>\n            </TabsContent>\n          </Tabs>\n        </div>\n      </div>\n\n      <div className=\"border-t border-slate-200 px-6 py-4 flex items-center gap-3\">\n        <Button \n          onClick={handleSave} \n          disabled={saving}\n          className=\"bg-blue-600 hover:bg-blue-700\"\n          data-testid=\"button-save\"\n        >\n          {saving ? 'Saving...' : 'Save'}\n        </Button>\n        <Button \n          variant=\"outline\" \n          onClick={() => setLocation('/vendors')}\n          data-testid=\"button-cancel\"\n        >\n          Cancel\n        </Button>\n      </div>\n\n      <Dialog open={showCreateAccountDialog} onOpenChange={setShowCreateAccountDialog}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Create New Account</DialogTitle>\n            <DialogDescription>Enter the name for the new expense account</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <Input\n              placeholder=\"Account Name\"\n              value={newAccountName}\n              onChange={(e) => setNewAccountName(e.target.value)}\n              onKeyDown={(e) => {\n                if (e.key === 'Enter') {\n                  handleCreateAccount();\n                }\n              }}\n              data-testid=\"input-new-account\"\n            />\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowCreateAccountDialog(false)}>\n              Cancel\n            </Button>\n            <Button onClick={handleCreateAccount} className=\"bg-blue-600 hover:bg-blue-700\">\n              Save and Select\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showAttachmentsDialog} onOpenChange={setShowAttachmentsDialog}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Manage Documents</DialogTitle>\n            <DialogDescription>Upload, view, and manage vendor documents</DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            <div>\n              <Button \n                variant=\"outline\" \n                className=\"gap-2 w-full\"\n                onClick={() => attachmentInputRef.current?.click()}\n                type=\"button\"\n              >\n                <Upload className=\"h-4 w-4\" />\n                Upload your Files\n              </Button>\n              <input \n                ref={attachmentInputRef}\n                type=\"file\"\n                multiple\n                hidden\n                onChange={handleAttachmentUpload}\n                accept=\"*/*\"\n              />\n              <p className=\"text-xs text-slate-500 mt-2\">Maximum 10 files, 10MB each</p>\n            </div>\n\n            {(uploadedFiles.length > 0 || newAttachments.length > 0 || vendorAttachments.length > 0) && (\n              <div className=\"border-t pt-4\">\n                <p className=\"text-sm font-medium text-slate-700 mb-3\">\n                  Documents ({(uploadedFiles.length + newAttachments.length + vendorAttachments.length)}/10)\n                </p>\n                <div className=\"space-y-2 max-h-96 overflow-y-auto\">\n                  {vendorAttachments.map((att, index) => (\n                    <div key={`vendor-${index}`} className=\"flex items-center justify-between bg-slate-50 p-3 rounded-md border border-slate-200\">\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-sm text-slate-900 truncate\">{att.name}</p>\n                        <p className=\"text-xs text-slate-500\">{(att.size / 1024).toFixed(2)} KB</p>\n                      </div>\n                      <Button \n                        variant=\"ghost\" \n                        size=\"icon\"\n                        className=\"h-8 w-8 text-slate-400 hover:text-red-600 flex-shrink-0\"\n                        onClick={() => setVendorAttachments(prev => prev.filter((_, i) => i !== index))}\n                        type=\"button\"\n                      >\n                        <X className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  ))}\n                  {uploadedFiles.map((file, index) => (\n                    <div key={`uploaded-${index}`} className=\"flex items-center justify-between bg-slate-50 p-3 rounded-md border border-slate-200\">\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-sm text-slate-900 truncate\">{file.name}</p>\n                        <p className=\"text-xs text-slate-500\">{(file.size / 1024).toFixed(2)} KB</p>\n                      </div>\n                      <Button \n                        variant=\"ghost\" \n                        size=\"icon\"\n                        className=\"h-8 w-8 text-slate-400 hover:text-red-600 flex-shrink-0\"\n                        onClick={() => removeFile(index)}\n                        type=\"button\"\n                      >\n                        <X className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  ))}\n                  {newAttachments.map((file, index) => (\n                    <div key={`new-${index}`} className=\"flex items-center justify-between bg-blue-50 p-3 rounded-md border border-blue-200\">\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-sm text-slate-900 truncate\">{file.name}</p>\n                        <p className=\"text-xs text-slate-500\">{(file.size / 1024).toFixed(2)} KB</p>\n                      </div>\n                      <Button \n                        variant=\"ghost\" \n                        size=\"icon\"\n                        className=\"h-8 w-8 text-slate-400 hover:text-red-600 flex-shrink-0\"\n                        onClick={() => removeAttachment(index)}\n                        type=\"button\"\n                      >\n                        <X className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowAttachmentsDialog(false)}>\n              Close\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":62435,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/layouts/index.ts":{"content":"export { MainLayout } from './MainLayout';\nexport { AuthLayout } from './AuthLayout';\n","path":null,"size_bytes":86,"size_tokens":null},"client/src/constants/index.ts":{"content":"export const APP_CONSTANTS = {\n  STORAGE_KEYS: {\n    AUTH_TOKEN: 'auth_token',\n    REFRESH_TOKEN: 'refresh_token',\n    USER: 'user',\n    THEME: 'theme',\n    SIDEBAR_STATE: 'sidebar_state',\n  },\n  ROLES: {\n    ADMIN: 'admin',\n    ACCOUNTANT: 'accountant',\n    MANAGER: 'manager',\n    VIEWER: 'viewer',\n  },\n  PERMISSIONS: {\n    CREATE: 'create',\n    READ: 'read',\n    UPDATE: 'update',\n    DELETE: 'delete',\n  },\n  STATUS: {\n    DRAFT: 'draft',\n    PENDING: 'pending',\n    APPROVED: 'approved',\n    REJECTED: 'rejected',\n    PAID: 'paid',\n    OVERDUE: 'overdue',\n    CANCELLED: 'cancelled',\n  },\n  PAYMENT_STATUS: {\n    UNPAID: 'unpaid',\n    PARTIAL: 'partial',\n    PAID: 'paid',\n  },\n  INVOICE_STATUS: {\n    DRAFT: 'draft',\n    SENT: 'sent',\n    VIEWED: 'viewed',\n    PAID: 'paid',\n    OVERDUE: 'overdue',\n  },\n} as const;\n\nexport const PAGINATION = {\n  DEFAULT_PAGE: 1,\n  DEFAULT_LIMIT: 10,\n  PAGE_SIZE_OPTIONS: [10, 25, 50, 100],\n} as const;\n\nexport const DATE_FORMATS = {\n  DISPLAY: 'dd MMM yyyy',\n  INPUT: 'yyyy-MM-dd',\n  DATETIME: 'dd MMM yyyy, hh:mm a',\n  API: 'yyyy-MM-dd',\n} as const;\n\nexport const CURRENCY = {\n  INR: { code: 'INR', symbol: '', locale: 'en-IN' },\n  USD: { code: 'USD', symbol: '$', locale: 'en-US' },\n  EUR: { code: 'EUR', symbol: '', locale: 'de-DE' },\n} as const;\n","path":null,"size_bytes":1298,"size_tokens":null},"client/src/modules/sales/components/QuoteDetailPanel.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { jsPDF } from \"jspdf\";\nimport { X, Edit, MoreHorizontal, ChevronDown, Send, Share2, FileText, RefreshCw, ExternalLink, Printer, Copy, Trash2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\ninterface QuoteItem {\n  id: string;\n  itemId: string;\n  name: string;\n  description: string;\n  quantity: number;\n  unit: string;\n  rate: number;\n  discount: number;\n  discountType: string;\n  tax: number;\n  taxName: string;\n  amount: number;\n}\n\ninterface ActivityLog {\n  id: string;\n  timestamp: string;\n  action: string;\n  description: string;\n  link?: string;\n  user: string;\n}\n\ninterface Quote {\n  id: string;\n  quoteNumber: string;\n  referenceNumber: string;\n  date: string;\n  expiryDate: string;\n  customerId: string;\n  customerName: string;\n  billingAddress: {\n    street: string;\n    city: string;\n    state: string;\n    country: string;\n    pincode: string;\n  };\n  shippingAddress: {\n    street: string;\n    city: string;\n    state: string;\n    country: string;\n    pincode: string;\n  };\n  salesperson: string;\n  projectName: string;\n  subject: string;\n  placeOfSupply: string;\n  pdfTemplate: string;\n  items: QuoteItem[];\n  subTotal: number;\n  shippingCharges: number;\n  cgst: number;\n  sgst: number;\n  igst: number;\n  adjustment: number;\n  total: number;\n  customerNotes: string;\n  termsAndConditions: string;\n  status: string;\n  emailRecipients: string[];\n  createdAt: string;\n  activityLogs: ActivityLog[];\n}\n\ninterface QuoteDetailPanelProps {\n  quote: Quote;\n  onClose: () => void;\n  onEdit?: () => void;\n  onRefresh?: () => void;\n}\n\nconst getStatusColor = (status: string) => {\n  switch (status.toUpperCase()) {\n    case 'ACCEPTED':\n      return 'bg-green-100 text-green-700 border-green-200';\n    case 'SENT':\n      return 'bg-blue-100 text-blue-700 border-blue-200';\n    case 'DRAFT':\n      return 'bg-slate-100 text-slate-600 border-slate-200';\n    case 'DECLINED':\n      return 'bg-red-100 text-red-700 border-red-200';\n    case 'CONVERTED':\n      return 'bg-purple-100 text-purple-700 border-purple-200';\n    default:\n      return 'bg-slate-100 text-slate-600 border-slate-200';\n  }\n};\n\nconst getActivityIcon = (action: string) => {\n  switch (action) {\n    case 'created':\n      return <div className=\"w-3 h-3 rounded-full bg-green-500\" />;\n    case 'emailed':\n    case 'sent':\n      return <div className=\"w-3 h-3 rounded-full bg-red-500\" />;\n    case 'accepted':\n      return <div className=\"w-3 h-3 rounded-full bg-green-500\" />;\n    case 'converted':\n      return <div className=\"w-3 h-3 rounded-full bg-blue-500\" />;\n    case 'updated':\n      return <div className=\"w-3 h-3 rounded-full bg-yellow-500\" />;\n    default:\n      return <div className=\"w-3 h-3 rounded-full bg-slate-400\" />;\n  }\n};\n\nconst formatDate = (dateString: string) => {\n  const date = new Date(dateString);\n  return date.toLocaleDateString('en-IN', { day: '2-digit', month: '2-digit', year: 'numeric' });\n};\n\nconst formatDateTime = (dateString: string) => {\n  const date = new Date(dateString);\n  return date.toLocaleString('en-IN', { \n    day: '2-digit', \n    month: '2-digit', \n    year: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n    hour12: true\n  });\n};\n\nconst formatCurrency = (amount: number) => {\n  return `${amount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n};\n\nconst formatAddress = (address: any) => {\n  const parts = [address.street, address.city, address.state, address.country, address.pincode].filter(Boolean);\n  return parts.length > 0 ? parts : ['-'];\n};\n\nexport default function QuoteDetailPanel({ quote, onClose, onEdit, onRefresh }: QuoteDetailPanelProps) {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState(\"details\");\n  const [showPdfView, setShowPdfView] = useState(false);\n  const [isConverting, setIsConverting] = useState(false);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n\n  const handleConvertToInvoice = async () => {\n    setIsConverting(true);\n    try {\n      const response = await fetch(`/api/quotes/${quote.id}/convert-to-invoice`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({})\n      });\n\n      if (response.ok) {\n        const result = await response.json();\n        toast({\n          title: \"Quote Converted\",\n          description: `Quote converted to Invoice ${result.data.invoice.invoiceNumber}`,\n        });\n        onRefresh?.();\n        setLocation(`/invoices`);\n      } else {\n        throw new Error('Failed to convert');\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to convert quote to invoice\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsConverting(false);\n    }\n  };\n\n  const handleConvertToSalesOrder = async () => {\n    setIsConverting(true);\n    try {\n      const response = await fetch(`/api/quotes/${quote.id}/convert-to-sales-order`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({})\n      });\n\n      if (response.ok) {\n        const result = await response.json();\n        toast({\n          title: \"Quote Converted\",\n          description: `Quote converted to Sales Order ${result.data.salesOrder.salesOrderNumber}`,\n        });\n        onRefresh?.();\n        setLocation(`/sales-orders`);\n      } else {\n        throw new Error('Failed to convert');\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to convert quote to sales order\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsConverting(false);\n    }\n  };\n\n  const handleSendQuote = async () => {\n    try {\n      const response = await fetch(`/api/quotes/${quote.id}/send`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({})\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Quote Sent\",\n          description: \"Quote has been marked as sent to customer\",\n        });\n        onRefresh?.();\n      } else {\n        throw new Error('Failed to send');\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to send quote\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const handleDownloadPDF = () => {\n    const doc = new jsPDF();\n    \n    doc.setFontSize(24);\n    doc.setFont(\"helvetica\", \"bold\");\n    doc.text(\"QUOTE\", 190, 30, { align: \"right\" });\n    \n    doc.setFontSize(12);\n    doc.setFont(\"helvetica\", \"normal\");\n    doc.text(`# ${quote.quoteNumber}`, 190, 38, { align: \"right\" });\n    doc.text(`Total`, 190, 48, { align: \"right\" });\n    doc.setFont(\"helvetica\", \"bold\");\n    doc.text(formatCurrency(quote.total), 190, 56, { align: \"right\" });\n    \n    doc.setFont(\"helvetica\", \"bold\");\n    doc.setFontSize(14);\n    doc.text(\"Your Company\", 20, 30);\n    doc.setFont(\"helvetica\", \"normal\");\n    doc.setFontSize(10);\n    doc.text(\"123 Business Street\", 20, 38);\n    doc.text(\"City, State 12345\", 20, 44);\n    doc.text(\"India\", 20, 50);\n    \n    doc.setFont(\"helvetica\", \"bold\");\n    doc.setFontSize(11);\n    doc.text(\"QUOTE TO\", 20, 70);\n    doc.setFont(\"helvetica\", \"normal\");\n    doc.setFontSize(10);\n    doc.text(quote.customerName, 20, 78);\n    const billAddress = formatAddress(quote.billingAddress);\n    billAddress.forEach((line, i) => {\n      doc.text(line, 20, 84 + (i * 5));\n    });\n    \n    doc.text(`Quote Date: ${formatDate(quote.date)}`, 120, 78);\n    doc.text(`Expiry Date: ${formatDate(quote.expiryDate)}`, 120, 84);\n    \n    doc.setDrawColor(200);\n    doc.setLineWidth(0.5);\n    doc.line(20, 110, 190, 110);\n    \n    doc.setFont(\"helvetica\", \"bold\");\n    doc.text(\"#\", 20, 118);\n    doc.text(\"Item\", 30, 118);\n    doc.text(\"Qty\", 100, 118);\n    doc.text(\"Rate\", 130, 118);\n    doc.text(\"Amount\", 190, 118, { align: \"right\" });\n    \n    doc.line(20, 122, 190, 122);\n    \n    let yPos = 130;\n    doc.setFont(\"helvetica\", \"normal\");\n    quote.items.forEach((item, index) => {\n      doc.text(String(index + 1), 20, yPos);\n      doc.text(item.name || 'Item', 30, yPos);\n      doc.text(String(item.quantity || 1), 100, yPos);\n      doc.text(formatCurrency(item.rate || 0), 130, yPos);\n      doc.text(formatCurrency(item.amount || 0), 190, yPos, { align: \"right\" });\n      yPos += 8;\n    });\n    \n    yPos += 10;\n    doc.line(120, yPos, 190, yPos);\n    yPos += 8;\n    \n    doc.text(\"Sub Total\", 120, yPos);\n    doc.text(formatCurrency(quote.subTotal), 190, yPos, { align: \"right\" });\n    yPos += 8;\n    \n    if (quote.cgst > 0) {\n      doc.text(\"CGST\", 120, yPos);\n      doc.text(formatCurrency(quote.cgst), 190, yPos, { align: \"right\" });\n      yPos += 8;\n    }\n    if (quote.sgst > 0) {\n      doc.text(\"SGST\", 120, yPos);\n      doc.text(formatCurrency(quote.sgst), 190, yPos, { align: \"right\" });\n      yPos += 8;\n    }\n    \n    doc.setFont(\"helvetica\", \"bold\");\n    doc.text(\"Total\", 120, yPos);\n    doc.text(formatCurrency(quote.total), 190, yPos, { align: \"right\" });\n    \n    doc.setFontSize(8);\n    doc.setFont(\"helvetica\", \"normal\");\n    doc.text(`Generated on: ${new Date().toLocaleString()}`, 105, 280, { align: \"center\" });\n    \n    doc.save(`${quote.quoteNumber}.pdf`);\n    \n    toast({\n      title: \"PDF Downloaded\",\n      description: `${quote.quoteNumber}.pdf has been downloaded successfully.`,\n    });\n  };\n\n  const handlePrint = () => {\n    window.print();\n    toast({\n      title: \"Print Dialog\",\n      description: \"Print dialog opened\",\n    });\n  };\n\n  const handleShare = () => {\n    if (navigator.share) {\n      navigator.share({\n        title: `Quote ${quote.quoteNumber}`,\n        text: `Quote for ${quote.customerName} - ${formatCurrency(quote.total)}`,\n        url: window.location.href\n      });\n    } else {\n      navigator.clipboard.writeText(window.location.href);\n      toast({\n        title: \"Link Copied\",\n        description: \"Quote link copied to clipboard\",\n      });\n    }\n  };\n\n  const handleDelete = async () => {\n    try {\n      const response = await fetch(`/api/quotes/${quote.id}`, { method: 'DELETE' });\n      if (response.ok) {\n        toast({ title: \"Quote deleted successfully\" });\n        onClose();\n        onRefresh?.();\n      }\n    } catch (error) {\n      toast({ title: \"Failed to delete quote\", variant: \"destructive\" });\n    }\n    setDeleteDialogOpen(false);\n  };\n\n  return (\n    <div className=\"h-full flex flex-col bg-white dark:bg-slate-900 border-l border-slate-200 dark:border-slate-700\">\n      <div className=\"flex items-center justify-between px-6 py-4 border-b border-slate-200 dark:border-slate-700\">\n        <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white\" data-testid=\"text-quote-number\">{quote.quoteNumber}</h2>\n        <div className=\"flex items-center gap-2\">\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n            <span className=\"text-xs font-bold\">$</span>\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={handleDownloadPDF}>\n            <FileText className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={onClose} data-testid=\"button-close-panel\">\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"flex items-center gap-2 px-6 py-3 border-b border-slate-200 dark:border-slate-700 overflow-x-auto\">\n        <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\" onClick={onEdit} data-testid=\"button-edit-quote\">\n          <Edit className=\"h-3.5 w-3.5\" />\n          Edit\n        </Button>\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\" data-testid=\"button-send-quote\">\n              <Send className=\"h-3.5 w-3.5\" />\n              Send\n              <ChevronDown className=\"h-3 w-3\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent>\n            <DropdownMenuItem onClick={handleSendQuote}>Send Email</DropdownMenuItem>\n            <DropdownMenuItem onClick={handleSendQuote}>Send WhatsApp</DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n        <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\" onClick={handleShare} data-testid=\"button-share-quote\">\n          <Share2 className=\"h-3.5 w-3.5\" />\n          Share\n        </Button>\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\" data-testid=\"button-pdf-print\">\n              <FileText className=\"h-3.5 w-3.5\" />\n              PDF/Print\n              <ChevronDown className=\"h-3 w-3\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent>\n            <DropdownMenuItem onClick={handleDownloadPDF}>Download PDF</DropdownMenuItem>\n            <DropdownMenuItem onClick={handlePrint}>Print</DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\" disabled={isConverting || quote.status === 'CONVERTED'} data-testid=\"button-convert\">\n              <RefreshCw className={`h-3.5 w-3.5 ${isConverting ? 'animate-spin' : ''}`} />\n              Convert\n              <ChevronDown className=\"h-3 w-3\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent>\n            <DropdownMenuItem onClick={handleConvertToInvoice} data-testid=\"menu-item-convert-to-invoice\">\n              Convert to Invoice\n            </DropdownMenuItem>\n            <DropdownMenuItem onClick={handleConvertToSalesOrder} data-testid=\"menu-item-convert-to-sales-order\">\n              Convert to Sales Order\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n              <MoreHorizontal className=\"h-4 w-4\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\">\n            <DropdownMenuItem onClick={() => setLocation(`/quotes/create?cloneFrom=${quote.id}`)} data-testid=\"menu-item-duplicate\">\n              <Copy className=\"h-4 w-4 mr-2\" /> Duplicate\n            </DropdownMenuItem>\n            <DropdownMenuSeparator />\n            <DropdownMenuItem onClick={() => setDeleteDialogOpen(true)} className=\"text-destructive\">\n              <Trash2 className=\"h-4 w-4 mr-2\" /> Delete\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n      </div>\n\n      {quote.status !== 'CONVERTED' && quote.status !== 'SENT' && (\n        <div className=\"bg-blue-50 dark:bg-blue-900/20 px-6 py-3 flex items-center justify-between border-b border-blue-100 dark:border-blue-800\">\n          <div className=\"flex items-center gap-2 text-sm\">\n            <span className=\"text-blue-700 dark:text-blue-400 font-medium\">WHAT'S NEXT?</span>\n            <span className=\"text-slate-600 dark:text-slate-400\">Send this quote to your customer.</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button size=\"sm\" className=\"h-7 bg-blue-600 hover:bg-blue-700\" onClick={handleSendQuote} data-testid=\"button-send-quote-action\">\n              <Send className=\"h-3 w-3 mr-1\" />\n              Send Quote\n            </Button>\n            <Button variant=\"outline\" size=\"sm\" className=\"h-7\">\n              Create Project\n            </Button>\n          </div>\n        </div>\n      )}\n      {quote.status === 'SENT' && (\n        <div className=\"bg-blue-50 dark:bg-blue-900/20 px-6 py-3 flex items-center justify-between border-b border-blue-100 dark:border-blue-800\">\n          <div className=\"flex items-center gap-2 text-sm\">\n            <span className=\"text-blue-700 dark:text-blue-400 font-medium\">WHAT'S NEXT?</span>\n            <span className=\"text-slate-600 dark:text-slate-400\">Convert this quote to an invoice or a sales order.</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button size=\"sm\" className=\"h-7 bg-blue-600 hover:bg-blue-700\" disabled={isConverting}>\n                  Convert\n                  <ChevronDown className=\"h-3 w-3 ml-1\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent>\n                <DropdownMenuItem onClick={handleConvertToInvoice}>Convert to Invoice</DropdownMenuItem>\n                <DropdownMenuItem onClick={handleConvertToSalesOrder}>Convert to Sales Order</DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n            <Button variant=\"outline\" size=\"sm\" className=\"h-7\">\n              Create Project\n            </Button>\n          </div>\n        </div>\n      )}\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"flex-1 flex flex-col overflow-hidden\">\n        <div className=\"flex items-center justify-between px-6 border-b border-slate-200 dark:border-slate-700\">\n          <TabsList className=\"h-auto p-0 bg-transparent\">\n            <TabsTrigger \n              value=\"details\" \n              className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n            >\n              Quote Details\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"activity\" \n              className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n            >\n              Activity Logs\n            </TabsTrigger>\n          </TabsList>\n          <div className=\"flex items-center gap-2 text-sm\">\n            <span className=\"text-slate-500 dark:text-slate-400\">Show PDF View</span>\n            <Switch checked={showPdfView} onCheckedChange={setShowPdfView} />\n          </div>\n        </div>\n\n        <TabsContent value=\"details\" className=\"flex-1 overflow-auto p-6 mt-0\">\n          <div className=\"space-y-6\">\n            <div className=\"flex items-start justify-between\">\n              <div>\n                <div className=\"flex items-center gap-3 mb-1\">\n                  <h3 className=\"text-lg font-semibold text-slate-900 dark:text-white\">{quote.quoteNumber}</h3>\n                  <Badge className={getStatusColor(quote.status)}>{quote.status}</Badge>\n                </div>\n                <p className=\"text-sm text-slate-500 dark:text-slate-400\">Total: {formatCurrency(quote.total)}</p>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-x-12 gap-y-3 text-sm\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-500 dark:text-slate-400\">Quote Number</span>\n                <span className=\"text-slate-900 dark:text-white\">{quote.quoteNumber}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-500 dark:text-slate-400\">Quote Date</span>\n                <span className=\"text-slate-900 dark:text-white\">{formatDate(quote.date)}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-500 dark:text-slate-400\">Creation Date</span>\n                <span className=\"text-slate-900 dark:text-white\">{formatDate(quote.createdAt)}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-500 dark:text-slate-400\">Salesperson</span>\n                <span className=\"text-slate-900 dark:text-white\">{quote.salesperson || '-'}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-500 dark:text-slate-400\">Place of Supply</span>\n                <span className=\"text-slate-900 dark:text-white\">{quote.placeOfSupply || '-'}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-500 dark:text-slate-400\">PDF Template</span>\n                <span className=\"text-blue-600 dark:text-blue-400 flex items-center gap-1\">\n                  {quote.pdfTemplate}\n                  <ExternalLink className=\"h-3 w-3\" />\n                </span>\n              </div>\n              <div className=\"flex justify-between col-span-2\">\n                <span className=\"text-slate-500 dark:text-slate-400\">Subject</span>\n                <span className=\"text-slate-900 dark:text-white\">{quote.subject || '-'}</span>\n              </div>\n            </div>\n\n            <div className=\"border-t border-slate-200 dark:border-slate-700 pt-6\">\n              <h4 className=\"text-base font-medium text-slate-900 dark:text-white mb-4\">Customer Details</h4>\n              <div className=\"grid grid-cols-2 gap-8\">\n                <div>\n                  <p className=\"text-sm text-slate-500 dark:text-slate-400 mb-1\">Name</p>\n                  <p className=\"text-sm text-blue-600 dark:text-blue-400 flex items-center gap-1\">\n                    <span className=\"w-2 h-2 rounded-full bg-yellow-400\" />\n                    {quote.customerName}\n                  </p>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-2 gap-8 mt-4\">\n                <div>\n                  <p className=\"text-sm text-slate-500 dark:text-slate-400 mb-1\">Billing Address</p>\n                  {formatAddress(quote.billingAddress).map((line, i) => (\n                    <p key={i} className=\"text-sm text-slate-900 dark:text-white\">{line}</p>\n                  ))}\n                </div>\n                <div>\n                  <p className=\"text-sm text-slate-500 dark:text-slate-400 mb-1\">Shipping Address</p>\n                  {formatAddress(quote.shippingAddress).map((line, i) => (\n                    <p key={i} className=\"text-sm text-slate-900 dark:text-white\">{line}</p>\n                  ))}\n                </div>\n              </div>\n            </div>\n\n            <div className=\"border-t border-slate-200 dark:border-slate-700 pt-6\">\n              <div className=\"flex items-center gap-2 mb-4\">\n                <h4 className=\"text-base font-medium text-slate-900 dark:text-white\">Items</h4>\n                <span className=\"text-xs bg-slate-100 dark:bg-slate-800 px-1.5 py-0.5 rounded text-slate-500 dark:text-slate-400\">\n                  {quote.items.length}\n                </span>\n              </div>\n              <Table>\n                <TableHeader>\n                  <TableRow className=\"bg-slate-50 dark:bg-slate-800\">\n                    <TableHead className=\"text-xs w-12\">S.NO</TableHead>\n                    <TableHead className=\"text-xs\">ITEM</TableHead>\n                    <TableHead className=\"text-xs text-center\">QTY</TableHead>\n                    <TableHead className=\"text-xs text-right\">PRICE</TableHead>\n                    <TableHead className=\"text-xs text-right\">DISCOUNT</TableHead>\n                    <TableHead className=\"text-xs text-right\">AMOUNT</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {quote.items.map((item, index) => (\n                    <TableRow key={item.id}>\n                      <TableCell className=\"text-sm\">{index + 1}</TableCell>\n                      <TableCell>\n                        <p className=\"text-sm text-blue-600 dark:text-blue-400\">{item.name}</p>\n                        {item.description && (\n                          <p className=\"text-xs text-slate-500 dark:text-slate-400\">{item.description}</p>\n                        )}\n                      </TableCell>\n                      <TableCell className=\"text-sm text-center\">\n                        {item.quantity}{item.unit}\n                      </TableCell>\n                      <TableCell className=\"text-sm text-right\">{formatCurrency(item.rate)}</TableCell>\n                      <TableCell className=\"text-sm text-right\">{formatCurrency(item.discount)}</TableCell>\n                      <TableCell className=\"text-sm text-right\">{formatCurrency(item.amount)}</TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n\n              <div className=\"mt-4 flex justify-end\">\n                <div className=\"w-64 space-y-2 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-slate-500 dark:text-slate-400\">Sub Total</span>\n                    <span className=\"font-medium\">{formatCurrency(quote.subTotal)}</span>\n                  </div>\n                  {quote.shippingCharges > 0 && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-slate-500 dark:text-slate-400\">Shipping Charge</span>\n                      <span>{formatCurrency(quote.shippingCharges)}</span>\n                    </div>\n                  )}\n                  {quote.cgst > 0 && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-slate-500 dark:text-slate-400\">CGST9</span>\n                      <span>{formatCurrency(quote.cgst)}</span>\n                    </div>\n                  )}\n                  {quote.sgst > 0 && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-slate-500 dark:text-slate-400\">SGST9</span>\n                      <span>{formatCurrency(quote.sgst)}</span>\n                    </div>\n                  )}\n                  {quote.adjustment !== 0 && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-slate-500 dark:text-slate-400\">Adjustment</span>\n                      <span>{quote.adjustment}</span>\n                    </div>\n                  )}\n                  <div className=\"flex justify-between pt-2 border-t border-slate-200 dark:border-slate-700\">\n                    <span className=\"font-medium\">Total</span>\n                    <span className=\"font-semibold\">{formatCurrency(quote.total)}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"border-t border-slate-200 dark:border-slate-700 pt-6\">\n              <h4 className=\"text-base font-medium text-slate-900 dark:text-white mb-2\">Notes</h4>\n              <p className=\"text-sm text-slate-600 dark:text-slate-400\">{quote.customerNotes || 'No notes added.'}</p>\n            </div>\n\n            {quote.emailRecipients.length > 0 && (\n              <div className=\"border-t border-slate-200 dark:border-slate-700 pt-6\">\n                <h4 className=\"text-base font-medium text-slate-900 dark:text-white mb-2\">Email Recipients</h4>\n                {quote.emailRecipients.map((email, i) => (\n                  <p key={i} className=\"text-sm text-slate-600 dark:text-slate-400 flex items-center gap-2\">\n                    <span className=\"w-2 h-2 rounded-full bg-green-500\" />\n                    {email}\n                  </p>\n                ))}\n              </div>\n            )}\n\n            <div className=\"border-t border-slate-200 dark:border-slate-700 pt-6\">\n              <h4 className=\"text-base font-medium text-slate-900 dark:text-white mb-2\">Terms and Conditions</h4>\n              <p className=\"text-sm text-slate-500 dark:text-slate-400\">{quote.termsAndConditions || 'No Terms and Conditions'}</p>\n            </div>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"activity\" className=\"flex-1 overflow-auto mt-0\">\n          <div className=\"p-6 space-y-4\">\n            {quote.activityLogs\n              .slice()\n              .sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime())\n              .map((log) => (\n                <div key={log.id} className=\"flex gap-4\">\n                  <div className=\"text-sm text-slate-500 dark:text-slate-400 w-40 flex-shrink-0\">\n                    {formatDateTime(log.timestamp)}\n                  </div>\n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"mt-1\">{getActivityIcon(log.action)}</div>\n                    <div>\n                      <p className=\"text-sm text-slate-900 dark:text-white\">{log.description}</p>\n                      <p className=\"text-sm text-slate-500 dark:text-slate-400\">by {log.user}</p>\n                      {log.link && (\n                        <a href={log.link} className=\"text-sm text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1 mt-1\">\n                          View the document\n                        </a>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              ))}\n          </div>\n        </TabsContent>\n      </Tabs>\n\n      <div className=\"border-t border-slate-200 dark:border-slate-700 p-4 flex items-center justify-between\">\n        <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n          <ChevronDown className=\"h-4 w-4 rotate-90\" />\n        </Button>\n        <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n          <ChevronDown className=\"h-4 w-4 -rotate-90\" />\n        </Button>\n      </div>\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Quote</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete this quote? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={handleDelete} className=\"bg-red-600 hover:bg-red-700\">\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":31023,"size_tokens":null},"client/src/modules/vendors/pages/VendorsPage.tsx":{"content":"export { default } from '@/pages/vendors';\n","path":null,"size_bytes":43,"size_tokens":null},"client/src/pages/customer-create.tsx":{"content":"import { useState, useRef, useMemo, useEffect } from \"react\";\nimport { useLocation, useSearch } from \"wouter\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useForm, useFieldArray } from \"react-hook-form\";\nimport { z } from \"zod\";\nimport { ArrowLeft, Upload, X, Info, Plus, MoreHorizontal, FileText, Trash2, Check, ChevronsUpDown, AlertTriangle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n  FormDescription,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAppStore } from \"@/lib/store\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { cn } from \"@/lib/utils\";\n\nconst INDIAN_STATES = [\n  { code: \"01\", name: \"Jammu and Kashmir\" },\n  { code: \"02\", name: \"Himachal Pradesh\" },\n  { code: \"03\", name: \"Punjab\" },\n  { code: \"04\", name: \"Chandigarh\" },\n  { code: \"05\", name: \"Uttarakhand\" },\n  { code: \"06\", name: \"Haryana\" },\n  { code: \"07\", name: \"Delhi\" },\n  { code: \"08\", name: \"Rajasthan\" },\n  { code: \"09\", name: \"Uttar Pradesh\" },\n  { code: \"10\", name: \"Bihar\" },\n  { code: \"11\", name: \"Sikkim\" },\n  { code: \"12\", name: \"Arunachal Pradesh\" },\n  { code: \"13\", name: \"Nagaland\" },\n  { code: \"14\", name: \"Manipur\" },\n  { code: \"15\", name: \"Mizoram\" },\n  { code: \"16\", name: \"Tripura\" },\n  { code: \"17\", name: \"Meghalaya\" },\n  { code: \"18\", name: \"Assam\" },\n  { code: \"19\", name: \"West Bengal\" },\n  { code: \"20\", name: \"Jharkhand\" },\n  { code: \"21\", name: \"Odisha\" },\n  { code: \"22\", name: \"Chhattisgarh\" },\n  { code: \"23\", name: \"Madhya Pradesh\" },\n  { code: \"24\", name: \"Gujarat\" },\n  { code: \"25\", name: \"Daman and Diu (Old)\" },\n  { code: \"26\", name: \"Dadra and Nagar Haveli and Daman and Diu\" },\n  { code: \"27\", name: \"Maharashtra\" },\n  { code: \"28\", name: \"Andhra Pradesh (Old)\" },\n  { code: \"29\", name: \"Karnataka\" },\n  { code: \"30\", name: \"Goa\" },\n  { code: \"31\", name: \"Lakshadweep\" },\n  { code: \"32\", name: \"Kerala\" },\n  { code: \"33\", name: \"Tamil Nadu\" },\n  { code: \"34\", name: \"Puducherry\" },\n  { code: \"35\", name: \"Andaman and Nicobar Islands\" },\n  { code: \"36\", name: \"Telangana\" },\n  { code: \"37\", name: \"Andhra Pradesh\" },\n  { code: \"38\", name: \"Ladakh\" },\n  { code: \"97\", name: \"Other Territory\" },\n];\n\nconst GST_TREATMENTS = [\n  {\n    value: \"registered_regular\",\n    label: \"Registered Business  Regular\",\n    description: \"Regular business registered under GST\"\n  },\n  {\n    value: \"registered_composition\",\n    label: \"Registered Business  Composition\",\n    description: \"Registered under GST Composition Scheme\"\n  },\n  {\n    value: \"unregistered_business\",\n    label: \"Unregistered Business\",\n    description: \"Business not registered under GST\"\n  },\n  {\n    value: \"consumer\",\n    label: \"Consumer\",\n    description: \"A normal consumer\"\n  },\n  {\n    value: \"overseas\",\n    label: \"Overseas\",\n    description: \"International import/export parties\"\n  },\n  {\n    value: \"sez_unit\",\n    label: \"Special Economic Zone (SEZ Unit)\",\n    description: \"Business operating inside SEZ\"\n  },\n  {\n    value: \"deemed_export\",\n    label: \"Deemed Export\",\n    description: \"Sales to EOU or EPCG license holders\"\n  },\n  {\n    value: \"tax_deductor\",\n    label: \"Tax Deductor\",\n    description: \"Govt agencies deducting TDS under GST\"\n  },\n  {\n    value: \"sez_developer\",\n    label: \"SEZ Developer\",\n    description: \"Owner/Developer of SEZ unit\"\n  },\n  {\n    value: \"isd\",\n    label: \"Input Service Distributor (ISD)\",\n    description: \"Head office distributing GST credits internally\"\n  }\n];\n\nconst EXEMPTION_REASONS = [\n  \"Exempt supply under GST\",\n  \"Export without payment of tax\",\n  \"SEZ supply\",\n  \"Deemed export\",\n  \"Zero-rated supply\",\n  \"Supply to EOU/STP/EHTP\",\n  \"Government entity\",\n  \"Charitable organization\",\n  \"Educational institution\",\n  \"Healthcare services\",\n];\n\nconst PAYMENT_TERMS_OPTIONS = [\n  { value: \"due_on_receipt\", label: \"Due on Receipt\" },\n  { value: \"net_15\", label: \"Net 15\" },\n  { value: \"net_30\", label: \"Net 30\" },\n  { value: \"net_45\", label: \"Net 45\" },\n  { value: \"net_60\", label: \"Net 60\" },\n  { value: \"due_end_of_month\", label: \"Due end of the month\" },\n  { value: \"due_end_of_next_month\", label: \"Due end of next month\" }\n];\n\nconst CURRENCIES = [\n  { value: \"INR\", label: \"INR - Indian Rupee\" },\n  { value: \"USD\", label: \"USD - US Dollar\" },\n  { value: \"EUR\", label: \"EUR - Euro\" },\n  { value: \"GBP\", label: \"GBP - British Pound\" },\n  { value: \"AED\", label: \"AED - UAE Dirham\" }\n];\n\nconst SALUTATIONS: Record<string, string> = {\n  mr: \"Mr.\",\n  mrs: \"Mrs.\",\n  ms: \"Ms.\",\n  dr: \"Dr.\",\n};\n\nconst customerSchema = z.object({\n  customerType: z.enum([\"business\", \"individual\"]),\n  salutation: z.string().optional(),\n  firstName: z.string().optional(),\n  lastName: z.string().optional(),\n  companyName: z.string().optional(),\n  displayName: z.string().min(1, \"Display Name is required\"),\n  email: z.string().email(\"Invalid email address\").or(z.literal(\"\")),\n  workPhone: z.string().optional(),\n  mobile: z.string().optional(),\n  language: z.string().default(\"English\"),\n\n  gstTreatment: z.string().optional(),\n  placeOfSupply: z.string().min(1, \"Place of Supply is required\"),\n  gstin: z.string().optional(),\n  pan: z.string().optional(),\n  taxPreference: z.enum([\"taxable\", \"tax_exempt\"]),\n  exemptionReason: z.string().optional(),\n  currency: z.string().default(\"INR\"),\n  openingBalance: z.string().optional(),\n  paymentTerms: z.string().optional(),\n  enablePortal: z.boolean().default(false),\n\n  billingAddress: z.object({\n    attention: z.string().optional(),\n    country: z.string().optional(),\n    street1: z.string().optional(),\n    street2: z.string().optional(),\n    city: z.string().optional(),\n    state: z.string().optional(),\n    pincode: z.string().optional(),\n    phone: z.string().optional(),\n    fax: z.string().optional(),\n  }),\n  shippingAddress: z.object({\n    attention: z.string().optional(),\n    country: z.string().optional(),\n    street1: z.string().optional(),\n    street2: z.string().optional(),\n    city: z.string().optional(),\n    state: z.string().optional(),\n    pincode: z.string().optional(),\n    phone: z.string().optional(),\n    fax: z.string().optional(),\n  }),\n\n  contactPersons: z.array(z.object({\n    salutation: z.string().optional(),\n    firstName: z.string().optional(),\n    lastName: z.string().optional(),\n    email: z.string().email(\"Invalid email\").or(z.literal(\"\")),\n    workPhone: z.string().optional(),\n    mobile: z.string().optional(),\n  })),\n\n  remarks: z.string().optional(),\n  tags: z.array(z.string()).optional(),\n}).refine((data) => {\n  if (data.taxPreference === \"taxable\" && !data.gstTreatment) {\n    return false;\n  }\n  return true;\n}, {\n  message: \"GST Treatment is required for taxable customers\",\n  path: [\"gstTreatment\"],\n}).refine((data) => {\n  if (data.taxPreference === \"tax_exempt\" && !data.exemptionReason) {\n    return false;\n  }\n  return true;\n}, {\n  message: \"Exemption Reason is required for tax exempt customers\",\n  path: [\"exemptionReason\"],\n}).refine((data) => {\n  if (data.taxPreference === \"taxable\" && data.gstin) {\n    if (data.gstin.length !== 15) {\n      return false;\n    }\n    const gstinPattern = /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/;\n    if (!gstinPattern.test(data.gstin)) {\n      return false;\n    }\n  }\n  return true;\n}, {\n  message: \"Invalid GSTIN format. Must be 15 characters (e.g., 27AAGCA4900Q1ZE)\",\n  path: [\"gstin\"],\n});\n\ntype CustomerFormValues = z.infer<typeof customerSchema>;\n\nconst defaultValues: CustomerFormValues = {\n  customerType: \"business\",\n  displayName: \"\",\n  email: \"\",\n  language: \"English\",\n  gstTreatment: \"\",\n  placeOfSupply: \"\",\n  gstin: \"\",\n  taxPreference: \"taxable\",\n  exemptionReason: \"\",\n  currency: \"INR\",\n  paymentTerms: \"due_on_receipt\",\n  enablePortal: false,\n  billingAddress: { street1: \"\", street2: \"\", city: \"\", state: \"\", country: \"\", pincode: \"\" },\n  shippingAddress: { street1: \"\", street2: \"\", city: \"\", state: \"\", country: \"\", pincode: \"\" },\n  contactPersons: [],\n  tags: [],\n};\n\nfunction validateGSTIN(gstin: string): { valid: boolean; message?: string } {\n  if (!gstin) return { valid: true };\n\n  if (gstin.length !== 15) {\n    return { valid: false, message: \"GSTIN must be 15 characters\" };\n  }\n\n  const gstinPattern = /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/;\n  if (!gstinPattern.test(gstin)) {\n    return { valid: false, message: \"Invalid GSTIN format\" };\n  }\n\n  return { valid: true };\n}\n\nfunction validatePAN(pan: string): { valid: boolean; message?: string } {\n  if (!pan) return { valid: true };\n\n  if (pan.length !== 10) {\n    return { valid: false, message: \"PAN must be 10 characters\" };\n  }\n\n  const panPattern = /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/;\n  if (!panPattern.test(pan)) {\n    return { valid: false, message: \"Invalid PAN format (e.g., ABCDE1234F)\" };\n  }\n\n  return { valid: true };\n}\n\nfunction getStateCodeFromGSTIN(gstin: string): string | null {\n  if (!gstin || gstin.length < 2) return null;\n  return gstin.substring(0, 2);\n}\n\nexport default function CustomerCreate() {\n  const [, setLocation] = useLocation();\n  const searchString = useSearch();\n  const searchParams = new URLSearchParams(searchString);\n  const returnTo = searchParams.get(\"returnTo\");\n  const { toast } = useToast();\n  const { addCustomer, setPendingCustomerId } = useAppStore();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const [displayNameOpen, setDisplayNameOpen] = useState(false);\n  const [displayNameSearch, setDisplayNameSearch] = useState(\"\");\n  const [stateOpen, setStateOpen] = useState(false);\n  const [stateSearch, setStateSearch] = useState(\"\");\n  const [exemptionOpen, setExemptionOpen] = useState(false);\n  const [exemptionSearch, setExemptionSearch] = useState(\"\");\n  const [gstinWarning, setGstinWarning] = useState<string | null>(null);\n  const [gstTreatmentOpen, setGstTreatmentOpen] = useState(false);\n  const [gstTreatmentSearch, setGstTreatmentSearch] = useState(\"\");\n  const [placeOfSupplyOpen, setPlaceOfSupplyOpen] = useState(false);\n  const [placeOfSupplySearch, setPlaceOfSupplySearch] = useState(\"\");\n  const [currencyOpen, setCurrencyOpen] = useState(false);\n  const [currencySearch, setCurrencySearch] = useState(\"\");\n  const [paymentTermsOpen, setPaymentTermsOpen] = useState(false);\n\n  interface AttachedFile {\n    id: string;\n    name: string;\n    size: number;\n    type: string;\n    data?: string;\n  }\n\n  const [documents, setDocuments] = useState<AttachedFile[]>([]);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const handleFileUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = event.target.files;\n    if (!files) return;\n\n    const maxSize = 10 * 1024 * 1024;\n    const maxFiles = 10;\n\n    if (documents.length + files.length > maxFiles) {\n      toast({\n        title: \"Too many files\",\n        description: `You can only upload up to ${maxFiles} files.`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    Array.from(files).forEach((file) => {\n      if (file.size > maxSize) {\n        toast({\n          title: \"File too large\",\n          description: `${file.name} exceeds 10MB limit.`,\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        const newFile: AttachedFile = {\n          id: `file-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n          name: file.name,\n          size: file.size,\n          type: file.type,\n          data: e.target?.result as string,\n        };\n        setDocuments((prev) => [...prev, newFile]);\n      };\n      reader.readAsDataURL(file);\n    });\n\n    if (event.target) {\n      event.target.value = \"\";\n    }\n  };\n\n  const removeFile = (fileId: string) => {\n    setDocuments((prev) => prev.filter((f) => f.id !== fileId));\n  };\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes < 1024) return bytes + \" B\";\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + \" KB\";\n    return (bytes / (1024 * 1024)).toFixed(1) + \" MB\";\n  };\n\n  const form = useForm<CustomerFormValues>({\n    resolver: zodResolver(customerSchema),\n    defaultValues,\n  });\n\n  const { fields: contactFields, append: appendContact, remove: removeContact } = useFieldArray({\n    control: form.control,\n    name: \"contactPersons\",\n  });\n\n  const watchSalutation = form.watch(\"salutation\");\n  const watchFirstName = form.watch(\"firstName\");\n  const watchLastName = form.watch(\"lastName\");\n  const watchCompanyName = form.watch(\"companyName\");\n  const watchTaxPreference = form.watch(\"taxPreference\");\n\n\n  const watchPlaceOfSupply = form.watch(\"placeOfSupply\");\n  const watchGstin = form.watch(\"gstin\");\n\n  const displayNameOptions = useMemo(() => {\n    const options: string[] = [];\n    const salutationLabel = watchSalutation ? SALUTATIONS[watchSalutation] : \"\";\n    const firstName = watchFirstName?.trim() || \"\";\n    const lastName = watchLastName?.trim() || \"\";\n    const companyName = watchCompanyName?.trim() || \"\";\n\n    if (salutationLabel && firstName && lastName) {\n      options.push(`${salutationLabel} ${firstName} ${lastName}`);\n    }\n    if (firstName && lastName) {\n      options.push(`${firstName} ${lastName}`);\n    }\n    if (lastName && firstName) {\n      options.push(`${lastName}, ${firstName}`);\n    }\n    if (companyName) {\n      options.push(companyName);\n    }\n    if (firstName && !lastName) {\n      if (salutationLabel) {\n        options.push(`${salutationLabel} ${firstName}`);\n      }\n      options.push(firstName);\n    }\n    if (lastName && !firstName) {\n      if (salutationLabel) {\n        options.push(`${salutationLabel} ${lastName}`);\n      }\n      options.push(lastName);\n    }\n\n    return Array.from(new Set(options));\n  }, [watchSalutation, watchFirstName, watchLastName, watchCompanyName]);\n\n  useEffect(() => {\n    if (watchTaxPreference === \"tax_exempt\") {\n      form.setValue(\"gstTreatment\", \"\");\n      form.setValue(\"gstin\", \"\");\n      setGstinWarning(null);\n    } else {\n      form.setValue(\"exemptionReason\", \"\");\n    }\n  }, [watchTaxPreference, form]);\n\n  useEffect(() => {\n    if (watchGstin && watchPlaceOfSupply) {\n      const gstinStateCode = getStateCodeFromGSTIN(watchGstin);\n      if (gstinStateCode && gstinStateCode !== watchPlaceOfSupply) {\n        const gstinState = INDIAN_STATES.find(s => s.code === gstinStateCode);\n        const selectedState = INDIAN_STATES.find(s => s.code === watchPlaceOfSupply);\n        setGstinWarning(\n          `GSTIN state code (${gstinStateCode} - ${gstinState?.name || \"Unknown\"}) does not match Place of Supply (${selectedState?.name || watchPlaceOfSupply})`\n        );\n      } else {\n        setGstinWarning(null);\n      }\n    } else {\n      setGstinWarning(null);\n    }\n  }, [watchGstin, watchPlaceOfSupply]);\n\n  const filteredStates = useMemo(() => {\n    if (!stateSearch) return INDIAN_STATES;\n    const searchLower = stateSearch.toLowerCase();\n    return INDIAN_STATES.filter(\n      state =>\n        state.name.toLowerCase().includes(searchLower) ||\n        state.code.includes(searchLower)\n    );\n  }, [stateSearch]);\n\n  const filteredExemptionReasons = useMemo(() => {\n    if (!exemptionSearch) return EXEMPTION_REASONS;\n    const searchLower = exemptionSearch.toLowerCase();\n    return EXEMPTION_REASONS.filter(reason =>\n      reason.toLowerCase().includes(searchLower)\n    );\n  }, [exemptionSearch]);\n\n  const onSubmit = async (data: CustomerFormValues) => {\n    setIsSubmitting(true);\n    await new Promise((resolve) => setTimeout(resolve, 500));\n\n    const gstTreatmentLabels: Record<string, string> = {\n      \"registered_regular\": \"Registered Business - Regular\",\n      \"registered_composition\": \"Registered Business - Composition\",\n      \"unregistered\": \"Unregistered Business\",\n      \"consumer\": \"Consumer\",\n      \"overseas\": \"Overseas\",\n    };\n\n    const selectedState = INDIAN_STATES.find(s => s.code === data.placeOfSupply);\n\n    const billingAddress = {\n      street: [data.billingAddress.street1, data.billingAddress.street2].filter(Boolean).join(\", \") || \"\",\n      city: data.billingAddress.city || \"\",\n      state: data.billingAddress.state || \"\",\n      country: data.billingAddress.country || \"India\",\n      pincode: data.billingAddress.pincode || \"\",\n    };\n\n    const shippingAddress = {\n      street: [data.shippingAddress.street1, data.shippingAddress.street2].filter(Boolean).join(\", \") || \"\",\n      city: data.shippingAddress.city || \"\",\n      state: data.shippingAddress.state || \"\",\n      country: data.shippingAddress.country || \"India\",\n      pincode: data.shippingAddress.pincode || \"\",\n    };\n\n    const customerPayload = {\n      name: data.displayName,\n      displayName: data.displayName,\n      companyName: data.companyName || data.displayName,\n      email: data.email || \"\",\n      phone: data.workPhone || \"\",\n      workPhone: data.workPhone || \"\",\n      mobile: data.mobile || \"\",\n      gstTreatment: data.taxPreference === \"taxable\"\n        ? (gstTreatmentLabels[data.gstTreatment || \"\"] || data.gstTreatment || \"\")\n        : \"\",\n      gstin: data.taxPreference === \"taxable\" ? (data.gstin || \"\") : \"\",\n      receivables: \"0.00\",\n      avatar: data.displayName.slice(0, 2).toUpperCase(),\n      pan: data.pan || \"\",\n      customerType: data.customerType,\n      status: \"active\" as const,\n      billingAddress,\n      shippingAddress,\n      currency: data.currency || \"INR\",\n      paymentTerms: data.paymentTerms || \"Due on Receipt\",\n      placeOfSupply: selectedState ? `${selectedState.code} - ${selectedState.name}` : data.placeOfSupply,\n      taxPreference: data.taxPreference,\n      exemptionReason: data.taxPreference === \"tax_exempt\" ? (data.exemptionReason || \"\") : \"\",\n      portalStatus: (data.enablePortal ? \"enabled\" : \"disabled\") as \"enabled\" | \"disabled\",\n      contactPersons: data.contactPersons || [],\n    };\n\n    try {\n      const response = await fetch(\"/api/customers\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(customerPayload),\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to create customer\");\n      }\n\n      const result = await response.json();\n      const newCustomer = result.data;\n\n      addCustomer(customerPayload);\n\n      toast({\n        title: \"Customer Created\",\n        description: \"The customer has been successfully added.\",\n      });\n      setIsSubmitting(false);\n\n      if (returnTo === \"invoice\") {\n        setPendingCustomerId(newCustomer.id);\n        setLocation(\"/invoices/create\");\n      } else {\n        setLocation(\"/customers\");\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create customer. Please try again.\",\n        variant: \"destructive\",\n      });\n      setIsSubmitting(false);\n    }\n  };\n\n  const handlePrefill = () => {\n    toast({\n      title: \"Fetching GST Details...\",\n      description: \"Connecting to GST portal (Simulation)\",\n    });\n    setTimeout(() => {\n      form.setValue(\"companyName\", \"Tech Solutions Pvt Ltd\");\n      form.setValue(\"displayName\", \"Tech Solutions\");\n      form.setValue(\"gstTreatment\", \"registered_regular\");\n      form.setValue(\"placeOfSupply\", \"29\");\n      form.setValue(\"gstin\", \"29AAGCA4900Q1ZE\");\n      toast({\n        title: \"Details Prefilled\",\n        description: \"Customer details have been populated from GSTIN.\",\n      });\n    }, 1500);\n  };\n\n  const copyBillingToShipping = () => {\n    const billing = form.getValues(\"billingAddress\");\n    form.setValue(\"shippingAddress\", billing);\n    toast({\n      description: \"Billing address copied to shipping address.\",\n    });\n  };\n\n  return (\n    <div className=\"max-w-5xl mx-auto pb-20\">\n      <div className=\"mb-6\">\n        <div className=\"flex items-center gap-2 mb-4 text-slate-500 hover:text-slate-800 transition-colors cursor-pointer w-fit\" onClick={() => setLocation(\"/customers\")} data-testid=\"link-back-customers\">\n          <ArrowLeft className=\"h-4 w-4\" />\n          <span className=\"text-sm font-medium\">Back to Customers</span>\n        </div>\n        <div className=\"flex items-center justify-between\">\n          <h1 className=\"text-2xl font-bold text-slate-900\" data-testid=\"text-page-title\">New Customer</h1>\n        </div>\n      </div>\n\n      <div className=\"bg-blue-50 border border-blue-100 px-4 py-3 rounded-md flex items-center gap-2 text-sm text-blue-700 mb-8\">\n        <Info className=\"h-4 w-4\" />\n        <span>Prefill Customer details from the GST portal using the Customer's GSTIN.</span>\n        <button type=\"button\" onClick={handlePrefill} className=\"font-semibold hover:underline ml-1\" data-testid=\"button-prefill-gst\">Prefill {\">\"}</button>\n      </div>\n\n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-8\">\n          <div className=\"grid grid-cols-1 md:grid-cols-12 gap-6 md:gap-12\">\n            <div className=\"md:col-span-4 space-y-6\">\n              <FormField\n                control={form.control}\n                name=\"customerType\"\n                render={({ field }) => (\n                  <FormItem className=\"space-y-3\">\n                    <FormLabel>Customer Type</FormLabel>\n                    <FormControl>\n                      <RadioGroup\n                        onValueChange={field.onChange}\n                        defaultValue={field.value}\n                        className=\"flex flex-row space-x-4\"\n                      >\n                        <FormItem className=\"flex items-center space-x-2 space-y-0\">\n                          <FormControl>\n                            <RadioGroupItem value=\"business\" data-testid=\"radio-customer-business\" />\n                          </FormControl>\n                          <FormLabel className=\"font-normal\">Business</FormLabel>\n                        </FormItem>\n                        <FormItem className=\"flex items-center space-x-2 space-y-0\">\n                          <FormControl>\n                            <RadioGroupItem value=\"individual\" data-testid=\"radio-customer-individual\" />\n                          </FormControl>\n                          <FormLabel className=\"font-normal\">Individual</FormLabel>\n                        </FormItem>\n                      </RadioGroup>\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"space-y-4\">\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center gap-1\">\n                    <Label className=\"block text-sm font-medium\">Primary Contact</Label>\n                    <Info className=\"h-3.5 w-3.5 text-slate-400\" />\n                  </div>\n                  <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3\">\n                    <FormField\n                      control={form.control}\n                      name=\"salutation\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <Select onValueChange={field.onChange} value={field.value}>\n                            <FormControl>\n                              <SelectTrigger className=\"w-full\" data-testid=\"select-salutation\">\n                                <SelectValue placeholder=\"Salutation\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent className=\"z-[100]\">\n                              <SelectItem value=\"mr\">Mr.</SelectItem>\n                              <SelectItem value=\"mrs\">Mrs.</SelectItem>\n                              <SelectItem value=\"ms\">Ms.</SelectItem>\n                              <SelectItem value=\"dr\">Dr.</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"firstName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormControl>\n                            <Input placeholder=\"First Name\" {...field} className=\"w-full\" data-testid=\"input-first-name\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"lastName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormControl>\n                            <Input placeholder=\"Last Name\" {...field} className=\"w-full\" data-testid=\"input-last-name\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"companyName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Company Name</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"\" {...field} data-testid=\"input-company-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"displayName\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-col\">\n                      <div className=\"flex items-center gap-1\">\n                        <FormLabel className=\"text-red-500 after:content-['*'] after:ml-0.5\">Display Name</FormLabel>\n                        <Info className=\"h-3.5 w-3.5 text-slate-400\" />\n                      </div>\n                      <Popover open={displayNameOpen} onOpenChange={setDisplayNameOpen}>\n                        <PopoverTrigger asChild>\n                          <FormControl>\n                            <Button\n                              variant=\"outline\"\n                              role=\"combobox\"\n                              aria-expanded={displayNameOpen}\n                              className={cn(\n                                \"w-full justify-between font-normal\",\n                                !field.value && \"text-muted-foreground\"\n                              )}\n                              data-testid=\"combobox-display-name\"\n                            >\n                              {field.value || \"Select or type to add\"}\n                              <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                            </Button>\n                          </FormControl>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-[--radix-popover-trigger-width] p-0\" align=\"start\">\n                          <Command>\n                            <CommandInput\n                              placeholder=\"Select or type to add...\"\n                              value={displayNameSearch}\n                              onValueChange={(value) => {\n                                setDisplayNameSearch(value);\n                                field.onChange(value);\n                              }}\n                              data-testid=\"input-display-name-search\"\n                            />\n                            <CommandList>\n                              <CommandEmpty>\n                                {displayNameSearch ? (\n                                  <div\n                                    className=\"py-2 px-3 cursor-pointer hover:bg-accent rounded-sm\"\n                                    onClick={() => {\n                                      field.onChange(displayNameSearch.trim());\n                                      setDisplayNameOpen(false);\n                                    }}\n                                  >\n                                    Use \"{displayNameSearch.trim()}\"\n                                  </div>\n                                ) : (\n                                  \"Type a name or enter contact details above\"\n                                )}\n                              </CommandEmpty>\n                              {displayNameOptions.length > 0 && (\n                                <CommandGroup heading=\"Suggested Names\">\n                                  {displayNameOptions.map((option) => (\n                                    <CommandItem\n                                      key={option}\n                                      value={option}\n                                      onSelect={() => {\n                                        field.onChange(option);\n                                        setDisplayNameSearch(\"\");\n                                        setDisplayNameOpen(false);\n                                      }}\n                                      data-testid={`option-display-name-${option.replace(/\\s+/g, '-').toLowerCase()}`}\n                                    >\n                                      <Check\n                                        className={cn(\n                                          \"mr-2 h-4 w-4\",\n                                          field.value === option ? \"opacity-100\" : \"opacity-0\"\n                                        )}\n                                      />\n                                      {option}\n                                    </CommandItem>\n                                  ))}\n                                </CommandGroup>\n                              )}\n                            </CommandList>\n                          </Command>\n                        </PopoverContent>\n                      </Popover>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <div className=\"flex items-center gap-1\">\n                        <FormLabel>Email Address</FormLabel>\n                        <Info className=\"h-3.5 w-3.5 text-slate-400\" />\n                      </div>\n                      <FormControl>\n                        <div className=\"relative\">\n                          <Input placeholder=\"\" {...field} className=\"pl-9\" data-testid=\"input-email\" />\n                          <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                            <span className=\"text-slate-400\">@</span>\n                          </div>\n                        </div>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"workPhone\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <div className=\"flex items-center gap-1\">\n                          <FormLabel>Phone</FormLabel>\n                          <Info className=\"h-3.5 w-3.5 text-slate-400\" />\n                        </div>\n                        <FormControl>\n                          <Input placeholder=\"\" {...field} className=\"w-full\" data-testid=\"input-work-phone\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"mobile\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Mobile</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"\" {...field} className=\"w-full\" data-testid=\"input-mobile\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <Tabs defaultValue=\"other\" className=\"w-full mt-8\">\n            <TabsList className=\"w-full justify-start h-auto border-b border-slate-200 bg-transparent p-0 rounded-none space-x-6 flex-wrap\">\n              <TabsTrigger value=\"other\" className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:text-blue-700 px-0 py-2\" data-testid=\"tab-other-details\">Other Details</TabsTrigger>\n              <TabsTrigger value=\"address\" className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:text-blue-700 px-0 py-2\" data-testid=\"tab-address\">Address</TabsTrigger>\n              <TabsTrigger value=\"contact\" className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:text-blue-700 px-0 py-2\" data-testid=\"tab-contact\">Contact Persons</TabsTrigger>\n              <TabsTrigger value=\"custom\" className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:text-blue-700 px-0 py-2\" data-testid=\"tab-custom\">Custom Fields</TabsTrigger>\n              <TabsTrigger value=\"tags\" className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:text-blue-700 px-0 py-2\" data-testid=\"tab-tags\">Reporting Tags</TabsTrigger>\n              <TabsTrigger value=\"remarks\" className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:text-blue-700 px-0 py-2\" data-testid=\"tab-remarks\">Remarks</TabsTrigger>\n            </TabsList>\n\n            <div className=\"mt-6\">\n              <TabsContent value=\"other\" className=\"space-y-6 max-w-4xl\">\n                <FormField\n                  control={form.control}\n                  name=\"taxPreference\"\n                  render={({ field }) => (\n                    <FormItem className=\"space-y-3\">\n                      <FormLabel>Tax Preference<span className=\"text-red-500 ml-0.5\">*</span></FormLabel>\n                      <FormControl>\n                        <RadioGroup\n                          onValueChange={field.onChange}\n                          value={field.value}\n                          className=\"flex flex-row space-x-4\"\n                        >\n                          <FormItem className=\"flex items-center space-x-2 space-y-0\">\n                            <FormControl>\n                              <RadioGroupItem value=\"taxable\" data-testid=\"radio-taxable\" />\n                            </FormControl>\n                            <FormLabel className=\"font-normal\">Taxable</FormLabel>\n                          </FormItem>\n                          <FormItem className=\"flex items-center space-x-2 space-y-0\">\n                            <FormControl>\n                              <RadioGroupItem value=\"tax_exempt\" data-testid=\"radio-tax-exempt\" />\n                            </FormControl>\n                            <FormLabel className=\"font-normal\">Tax Exempt</FormLabel>\n                          </FormItem>\n                        </RadioGroup>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6\">\n                  {watchTaxPreference === \"taxable\" && (\n                    <FormField\n                      control={form.control}\n                      name=\"gstTreatment\"\n                      render={({ field }) => {\n                        const selectedGstTreatment = GST_TREATMENTS.find(g => g.value === field.value);\n                        const filteredGstTreatments = GST_TREATMENTS.filter(treatment =>\n                          treatment.label.toLowerCase().includes(gstTreatmentSearch.toLowerCase()) ||\n                          treatment.description.toLowerCase().includes(gstTreatmentSearch.toLowerCase())\n                        );\n\n                        return (\n                          <FormItem className=\"flex flex-col\">\n                            <FormLabel>GST Treatment<span className=\"text-red-500 ml-0.5\">*</span></FormLabel>\n                            <Popover open={gstTreatmentOpen} onOpenChange={setGstTreatmentOpen}>\n                              <PopoverTrigger asChild>\n                                <FormControl>\n                                  <Button\n                                    variant=\"outline\"\n                                    role=\"combobox\"\n                                    aria-expanded={gstTreatmentOpen}\n                                    className={cn(\n                                      \"justify-between\",\n                                      !field.value && \"text-muted-foreground\"\n                                    )}\n                                    data-testid=\"button-gst-treatment\"\n                                  >\n                                    {selectedGstTreatment ? selectedGstTreatment.label : \"Select a GST treatment\"}\n                                    <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                                  </Button>\n                                </FormControl>\n                              </PopoverTrigger>\n                              <PopoverContent className=\"w-[400px] p-0\">\n                                <Command>\n                                  <CommandInput\n                                    placeholder=\"Search GST treatment...\"\n                                    value={gstTreatmentSearch}\n                                    onValueChange={setGstTreatmentSearch}\n                                    data-testid=\"input-gst-treatment-search\"\n                                  />\n                                  <CommandList className=\"max-h-[300px]\">\n                                    <CommandEmpty>No GST treatment found</CommandEmpty>\n                                    <CommandGroup>\n                                      {filteredGstTreatments.map((treatment) => (\n                                        <CommandItem\n                                          key={treatment.value}\n                                          value={treatment.label}\n                                          onSelect={() => {\n                                            field.onChange(treatment.value);\n                                            setGstTreatmentSearch(\"\");\n                                            setGstTreatmentOpen(false);\n                                          }}\n                                          className=\"flex flex-col items-start p-3 cursor-pointer\"\n                                          data-testid={`option-gst-treatment-${treatment.value}`}\n                                        >\n                                          <div className=\"flex items-center w-full\">\n                                            <Check\n                                              className={cn(\n                                                \"mr-2 h-4 w-4\",\n                                                field.value === treatment.value ? \"opacity-100\" : \"opacity-0\"\n                                              )}\n                                            />\n                                            <div className=\"flex-1\">\n                                              <div className=\"font-medium\">{treatment.label}</div>\n                                              <div className=\"text-sm text-slate-500 mt-0.5\">{treatment.description}</div>\n                                            </div>\n                                          </div>\n                                        </CommandItem>\n                                      ))}\n                                    </CommandGroup>\n                                  </CommandList>\n                                </Command>\n                              </PopoverContent>\n                            </Popover>\n                            {field.value && (\n                              <p className=\"text-sm text-muted-foreground mt-1\">\n                                {selectedGstTreatment?.description}\n                              </p>\n                            )}\n                            <FormMessage />\n                          </FormItem>\n                        );\n                      }}\n                    />\n                  )}\n\n                  {watchTaxPreference === \"tax_exempt\" && (\n                    <FormField\n                      control={form.control}\n                      name=\"exemptionReason\"\n                      render={({ field }) => (\n                        <FormItem className=\"flex flex-col\">\n                          <div className=\"flex items-center gap-1\">\n                            <FormLabel>Exemption Reason<span className=\"text-red-500 ml-0.5\">*</span></FormLabel>\n                            <Info className=\"h-3.5 w-3.5 text-slate-400\" />\n                          </div>\n                          <Popover open={exemptionOpen} onOpenChange={setExemptionOpen}>\n                            <PopoverTrigger asChild>\n                              <FormControl>\n                                <Button\n                                  variant=\"outline\"\n                                  role=\"combobox\"\n                                  aria-expanded={exemptionOpen}\n                                  className={cn(\n                                    \"w-full justify-between font-normal\",\n                                    !field.value && \"text-muted-foreground\"\n                                  )}\n                                  data-testid=\"combobox-exemption-reason\"\n                                >\n                                  {field.value || \"Select or type to add\"}\n                                  <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                                </Button>\n                              </FormControl>\n                            </PopoverTrigger>\n                            <PopoverContent className=\"w-[--radix-popover-trigger-width] p-0\" align=\"start\">\n                              <Command>\n                                <CommandInput\n                                  placeholder=\"Search or type...\"\n                                  value={exemptionSearch}\n                                  onValueChange={(value) => {\n                                    setExemptionSearch(value);\n                                  }}\n                                  data-testid=\"input-exemption-search\"\n                                />\n                                <CommandList>\n                                  <CommandEmpty>\n                                    {exemptionSearch ? (\n                                      <div\n                                        className=\"py-2 px-3 cursor-pointer hover:bg-accent rounded-sm\"\n                                        onClick={() => {\n                                          field.onChange(exemptionSearch.trim());\n                                          setExemptionOpen(false);\n                                          setExemptionSearch(\"\");\n                                        }}\n                                      >\n                                        Use \"{exemptionSearch.trim()}\"\n                                      </div>\n                                    ) : (\n                                      \"No exemption reasons found\"\n                                    )}\n                                  </CommandEmpty>\n                                  <CommandGroup>\n                                    {filteredExemptionReasons.map((reason) => (\n                                      <CommandItem\n                                        key={reason}\n                                        value={reason}\n                                        onSelect={() => {\n                                          field.onChange(reason);\n                                          setExemptionSearch(\"\");\n                                          setExemptionOpen(false);\n                                        }}\n                                        data-testid={`option-exemption-${reason.replace(/\\s+/g, '-').toLowerCase()}`}\n                                      >\n                                        <Check\n                                          className={cn(\n                                            \"mr-2 h-4 w-4\",\n                                            field.value === reason ? \"opacity-100\" : \"opacity-0\"\n                                          )}\n                                        />\n                                        {reason}\n                                      </CommandItem>\n                                    ))}\n                                  </CommandGroup>\n                                </CommandList>\n                              </Command>\n                            </PopoverContent>\n                          </Popover>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  )}\n\n                  <FormField\n                    control={form.control}\n                    name=\"placeOfSupply\"\n                    render={({ field }) => (\n                      <FormItem className=\"flex flex-col\">\n                        <FormLabel>Place of Supply<span className=\"text-red-500 ml-0.5\">*</span></FormLabel>\n                        <Popover open={stateOpen} onOpenChange={setStateOpen}>\n                          <PopoverTrigger asChild>\n                            <FormControl>\n                              <Button\n                                variant=\"outline\"\n                                role=\"combobox\"\n                                aria-expanded={stateOpen}\n                                className={cn(\n                                  \"w-full justify-between font-normal\",\n                                  !field.value && \"text-muted-foreground\"\n                                )}\n                                data-testid=\"combobox-place-of-supply\"\n                              >\n                                {field.value\n                                  ? INDIAN_STATES.find(s => s.code === field.value)?.name || field.value\n                                  : \"Select State\"}\n                                <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                              </Button>\n                            </FormControl>\n                          </PopoverTrigger>\n                          <PopoverContent className=\"w-[--radix-popover-trigger-width] p-0\" align=\"start\">\n                            <Command>\n                              <CommandInput\n                                placeholder=\"Search state...\"\n                                value={stateSearch}\n                                onValueChange={setStateSearch}\n                                data-testid=\"input-state-search\"\n                              />\n                              <CommandList className=\"max-h-[300px]\">\n                                <CommandEmpty>No state found</CommandEmpty>\n                                <CommandGroup>\n                                  {filteredStates.map((state) => (\n                                    <CommandItem\n                                      key={state.code}\n                                      value={`${state.code} ${state.name}`}\n                                      onSelect={() => {\n                                        field.onChange(state.code);\n                                        setStateSearch(\"\");\n                                        setStateOpen(false);\n                                      }}\n                                      data-testid={`option-state-${state.code}`}\n                                    >\n                                      <Check\n                                        className={cn(\n                                          \"mr-2 h-4 w-4\",\n                                          field.value === state.code ? \"opacity-100\" : \"opacity-0\"\n                                        )}\n                                      />\n                                      {state.name}\n                                    </CommandItem>\n                                  ))}\n                                </CommandGroup>\n                              </CommandList>\n                            </Command>\n                          </PopoverContent>\n                        </Popover>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    {/* PAN */}\n                    <FormField\n                      control={form.control}\n                      name=\"pan\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <div className=\"flex items-center gap-1\">\n                            <FormLabel>PAN</FormLabel>\n                            <Info className=\"h-3.5 w-3.5 text-slate-400\" />\n                          </div>\n                          <FormControl>\n                            <Input\n                              placeholder=\"e.g., ABCDE1234F\"\n                              {...field}\n                              onChange={(e) => {\n                                const value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');\n                                field.onChange(value.substring(0, 10));\n                              }}\n                              maxLength={10}\n                              data-testid=\"input-pan\"\n                            />\n                          </FormControl>\n                          {field.value && !validatePAN(field.value).valid && (\n                            <p className=\"text-red-500 text-sm mt-1\">{validatePAN(field.value).message}</p>\n                          )}\n                        </FormItem>\n                      )}\n                    />\n\n                    {/* GSTIN */}\n                    <FormField\n                      control={form.control}\n                      name=\"gstin\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel className=\"text-black\">\n                            GSTIN\n                          </FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder=\"e.g., 09ABCDE1234F2Z5\"\n                              {...field}\n                              onChange={(e) => {\n                                const value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');\n                                field.onChange(value.substring(0, 15));\n                              }}\n                              maxLength={15}\n                              data-testid=\"input-gstin\"\n                            />\n                          </FormControl>\n                          {field.value && !validateGSTIN(field.value).valid && (\n                            <p className=\"text-red-500 text-sm mt-1\">{validateGSTIN(field.value).message}</p>\n                          )}\n                          {gstinWarning && (\n                            <div className=\"flex items-center gap-1 text-amber-600 text-sm mt-1\">\n                              <AlertTriangle className=\"h-3.5 w-3.5\" />\n                              <span>{gstinWarning}</span>\n                            </div>\n                          )}\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                </div>\n\n                {/* Currency and Payment Terms */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"currency\"\n                    render={({ field }) => {\n                      const selectedCurrency = CURRENCIES.find(c => c.value === field.value);\n                      const filteredCurrencies = CURRENCIES.filter(currency =>\n                        currency.label.toLowerCase().includes(currencySearch.toLowerCase())\n                      );\n\n                      return (\n                        <FormItem className=\"flex flex-col\">\n                          <FormLabel>Currency</FormLabel>\n                          <Popover open={currencyOpen} onOpenChange={setCurrencyOpen}>\n                            <PopoverTrigger asChild>\n                              <FormControl>\n                                <Button\n                                  variant=\"outline\"\n                                  role=\"combobox\"\n                                  aria-expanded={currencyOpen}\n                                  className={cn(\n                                    \"justify-between\",\n                                    !field.value && \"text-muted-foreground\"\n                                  )}\n                                  data-testid=\"button-currency\"\n                                >\n                                  {selectedCurrency ? selectedCurrency.label : \"INR - Indian Rupee\"}\n                                  <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                                </Button>\n                              </FormControl>\n                            </PopoverTrigger>\n                            <PopoverContent className=\"w-[300px] p-0\">\n                              <Command>\n                                <CommandInput\n                                  placeholder=\"Search currency...\"\n                                  value={currencySearch}\n                                  onValueChange={setCurrencySearch}\n                                  data-testid=\"input-currency-search\"\n                                />\n                                <CommandList className=\"max-h-[200px]\">\n                                  <CommandEmpty>No currency found</CommandEmpty>\n                                  <CommandGroup>\n                                    {filteredCurrencies.map((currency) => (\n                                      <CommandItem\n                                        key={currency.value}\n                                        value={currency.label}\n                                        onSelect={() => {\n                                          field.onChange(currency.value);\n                                          setCurrencySearch(\"\");\n                                          setCurrencyOpen(false);\n                                        }}\n                                        data-testid={`option-currency-${currency.value}`}\n                                      >\n                                        <Check\n                                          className={cn(\n                                            \"mr-2 h-4 w-4\",\n                                            field.value === currency.value ? \"opacity-100\" : \"opacity-0\"\n                                          )}\n                                        />\n                                        {currency.label}\n                                      </CommandItem>\n                                    ))}\n                                  </CommandGroup>\n                                </CommandList>\n                              </Command>\n                            </PopoverContent>\n                          </Popover>\n                          <FormMessage />\n                        </FormItem>\n                      );\n                    }}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"openingBalance\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Opening Balance</FormLabel>\n                        <FormControl>\n                          <div className=\"flex items-center\">\n                            <span className=\"bg-slate-100 border border-r-0 border-slate-300 rounded-l-md px-3 py-2 text-sm text-slate-500\">INR</span>\n                            <Input placeholder=\"0.00\" {...field} className=\"rounded-l-none\" data-testid=\"input-opening-balance\" />\n                          </div>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"paymentTerms\"\n                    render={({ field }) => {\n                      const selectedPaymentTerm = PAYMENT_TERMS_OPTIONS.find(p => p.value === field.value);\n\n                      return (\n                        <FormItem className=\"flex flex-col\">\n                          <FormLabel>Payment Terms</FormLabel>\n                          <Popover open={paymentTermsOpen} onOpenChange={setPaymentTermsOpen}>\n                            <PopoverTrigger asChild>\n                              <FormControl>\n                                <Button\n                                  variant=\"outline\"\n                                  role=\"combobox\"\n                                  aria-expanded={paymentTermsOpen}\n                                  className={cn(\n                                    \"justify-between\",\n                                    !field.value && \"text-muted-foreground\"\n                                  )}\n                                  data-testid=\"button-payment-terms\"\n                                >\n                                  {selectedPaymentTerm ? selectedPaymentTerm.label : \"Due on Receipt\"}\n                                  <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                                </Button>\n                              </FormControl>\n                            </PopoverTrigger>\n                            <PopoverContent className=\"w-[280px] p-0\">\n                              <Command>\n                                <CommandList>\n                                  <CommandGroup>\n                                    {PAYMENT_TERMS_OPTIONS.map((term) => (\n                                      <CommandItem\n                                        key={term.value}\n                                        value={term.label}\n                                        onSelect={() => {\n                                          field.onChange(term.value);\n                                          setPaymentTermsOpen(false);\n                                        }}\n                                        data-testid={`option-payment-terms-${term.value}`}\n                                      >\n                                        <Check\n                                          className={cn(\n                                            \"mr-2 h-4 w-4\",\n                                            field.value === term.value ? \"opacity-100\" : \"opacity-0\"\n                                          )}\n                                        />\n                                        {term.label}\n                                      </CommandItem>\n                                    ))}\n                                  </CommandGroup>\n                                </CommandList>\n                              </Command>\n                            </PopoverContent>\n                          </Popover>\n                          <FormMessage />\n                        </FormItem>\n                      );\n                    }}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"enablePortal\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-row items-start space-x-3 space-y-0 rounded-md p-4 border border-slate-100 bg-slate-50/50\">\n                      <FormControl>\n                        <Checkbox\n                          checked={field.value}\n                          onCheckedChange={field.onChange}\n                          data-testid=\"checkbox-enable-portal\"\n                        />\n                      </FormControl>\n                      <div className=\"space-y-1 leading-none\">\n                        <FormLabel>\n                          Allow portal access for this customer\n                        </FormLabel>\n                        <FormDescription>\n                          Customer will be able to view invoices and make payments online.\n                        </FormDescription>\n                      </div>\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"pt-4\">\n                  <Label className=\"mb-2 block\">Documents</Label>\n                  <input\n                    type=\"file\"\n                    ref={fileInputRef}\n                    onChange={handleFileUpload}\n                    multiple\n                    className=\"hidden\"\n                    accept=\".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg,.gif\"\n                    data-testid=\"input-file-upload\"\n                  />\n                  <div\n                    className=\"border-2 border-dashed border-slate-200 rounded-lg p-8 text-center hover:bg-slate-50 transition-colors cursor-pointer\"\n                    onClick={() => fileInputRef.current?.click()}\n                    data-testid=\"button-upload-area\"\n                  >\n                    <div className=\"flex flex-col items-center gap-2\">\n                      <div className=\"bg-blue-50 p-3 rounded-full\">\n                        <Upload className=\"h-5 w-5 text-blue-600\" />\n                      </div>\n                      <div className=\"text-sm text-slate-600\">\n                        <span className=\"text-blue-600 font-medium\">Upload files</span> or drag and drop\n                      </div>\n                      <p className=\"text-xs text-slate-400\">Up to 10 files (max 10MB each)</p>\n                    </div>\n                  </div>\n\n                  {documents.length > 0 && (\n                    <div className=\"mt-4 space-y-2\" data-testid=\"list-uploaded-files\">\n                      {documents.map((file) => (\n                        <div\n                          key={file.id}\n                          className=\"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-200\"\n                          data-testid={`file-item-${file.id}`}\n                        >\n                          <div className=\"flex items-center gap-3\">\n                            <FileText className=\"h-5 w-5 text-slate-400\" />\n                            <div>\n                              <p className=\"text-sm font-medium text-slate-700\" data-testid={`text-filename-${file.id}`}>{file.name}</p>\n                              <p className=\"text-xs text-slate-400\">{formatFileSize(file.size)}</p>\n                            </div>\n                          </div>\n                          <div className=\"flex items-center gap-1\">\n                            {file.data && (\n                              <Button\n                                type=\"button\"\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => window.open(file.data, '_blank')}\n                                data-testid={`button-view-file-${file.id}`}\n                              >\n                                View\n                              </Button>\n                            )}\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => removeFile(file.id)}\n                              data-testid={`button-remove-file-${file.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4 text-slate-400\" />\n                            </Button>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"address\" className=\"space-y-6\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                  <div className=\"space-y-4\">\n                    <h3 className=\"font-semibold text-sm uppercase tracking-wider text-slate-500 mb-4\">Billing Address</h3>\n\n                    <FormField\n                      control={form.control}\n                      name=\"billingAddress.attention\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Attention</FormLabel>\n                          <FormControl>\n                            <Input {...field} data-testid=\"input-billing-attention\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"billingAddress.country\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Country / Region</FormLabel>\n                          <Select onValueChange={field.onChange} defaultValue={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-billing-country\">\n                                <SelectValue placeholder=\"Select Country\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"India\">India</SelectItem>\n                              <SelectItem value=\"USA\">USA</SelectItem>\n                              <SelectItem value=\"UK\">UK</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <div className=\"space-y-2\">\n                      <FormField\n                        control={form.control}\n                        name=\"billingAddress.street1\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Address</FormLabel>\n                            <FormControl>\n                              <Input placeholder=\"Street 1\" {...field} data-testid=\"input-billing-street1\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={form.control}\n                        name=\"billingAddress.street2\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormControl>\n                              <Input placeholder=\"Street 2\" {...field} data-testid=\"input-billing-street2\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <FormField\n                        control={form.control}\n                        name=\"billingAddress.city\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>City</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-billing-city\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={form.control}\n                        name=\"billingAddress.state\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>State</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-billing-state\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <FormField\n                        control={form.control}\n                        name=\"billingAddress.pincode\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Pin Code</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-billing-pincode\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={form.control}\n                        name=\"billingAddress.phone\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Phone</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-billing-phone\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                    <FormField\n                      control={form.control}\n                      name=\"billingAddress.fax\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Fax</FormLabel>\n                          <FormControl>\n                            <Input {...field} data-testid=\"input-billing-fax\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between mb-4\">\n                      <h3 className=\"font-semibold text-sm uppercase tracking-wider text-slate-500\">Shipping Address</h3>\n                      <Button type=\"button\" variant=\"link\" size=\"sm\" onClick={copyBillingToShipping} className=\"text-blue-600 h-auto p-0\" data-testid=\"button-copy-billing\">\n                        Copy billing address\n                      </Button>\n                    </div>\n\n                    <FormField\n                      control={form.control}\n                      name=\"shippingAddress.attention\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Attention</FormLabel>\n                          <FormControl>\n                            <Input {...field} data-testid=\"input-shipping-attention\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"shippingAddress.country\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Country / Region</FormLabel>\n                          <Select onValueChange={field.onChange} defaultValue={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-shipping-country\">\n                                <SelectValue placeholder=\"Select Country\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"India\">India</SelectItem>\n                              <SelectItem value=\"USA\">USA</SelectItem>\n                              <SelectItem value=\"UK\">UK</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <div className=\"space-y-2\">\n                      <FormField\n                        control={form.control}\n                        name=\"shippingAddress.street1\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Address</FormLabel>\n                            <FormControl>\n                              <Input placeholder=\"Street 1\" {...field} data-testid=\"input-shipping-street1\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={form.control}\n                        name=\"shippingAddress.street2\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormControl>\n                              <Input placeholder=\"Street 2\" {...field} data-testid=\"input-shipping-street2\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <FormField\n                        control={form.control}\n                        name=\"shippingAddress.city\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>City</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-shipping-city\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={form.control}\n                        name=\"shippingAddress.state\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>State</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-shipping-state\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <FormField\n                        control={form.control}\n                        name=\"shippingAddress.pincode\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Pin Code</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-shipping-pincode\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={form.control}\n                        name=\"shippingAddress.phone\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Phone</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-shipping-phone\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                    <FormField\n                      control={form.control}\n                      name=\"shippingAddress.fax\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Fax</FormLabel>\n                          <FormControl>\n                            <Input {...field} data-testid=\"input-shipping-fax\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"contact\" className=\"space-y-6\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h3 className=\"font-semibold text-sm uppercase tracking-wider text-slate-500\">Contact Persons</h3>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => appendContact({ salutation: \"\", firstName: \"\", lastName: \"\", email: \"\", workPhone: \"\", mobile: \"\" })}\n                    data-testid=\"button-add-contact\"\n                  >\n                    <Plus className=\"h-4 w-4 mr-1\" />\n                    Add Contact Person\n                  </Button>\n                </div>\n\n                {contactFields.length === 0 ? (\n                  <div className=\"text-center py-8 text-slate-500\">\n                    <p>No contact persons added yet.</p>\n                    <p className=\"text-sm mt-1\">Click \"Add Contact Person\" to add one.</p>\n                  </div>\n                ) : (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Salutation</TableHead>\n                        <TableHead>First Name</TableHead>\n                        <TableHead>Last Name</TableHead>\n                        <TableHead>Email</TableHead>\n                        <TableHead>Work Phone</TableHead>\n                        <TableHead>Mobile</TableHead>\n                        <TableHead></TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {contactFields.map((field, index) => (\n                        <TableRow key={field.id} data-testid={`row-contact-${index}`}>\n                          <TableCell>\n                            <FormField\n                              control={form.control}\n                              name={`contactPersons.${index}.salutation`}\n                              render={({ field }) => (\n                                <Select onValueChange={field.onChange} value={field.value}>\n                                  <SelectTrigger className=\"w-24\" data-testid={`select-contact-salutation-${index}`}>\n                                    <SelectValue placeholder=\"--\" />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    <SelectItem value=\"mr\">Mr.</SelectItem>\n                                    <SelectItem value=\"mrs\">Mrs.</SelectItem>\n                                    <SelectItem value=\"ms\">Ms.</SelectItem>\n                                    <SelectItem value=\"dr\">Dr.</SelectItem>\n                                  </SelectContent>\n                                </Select>\n                              )}\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <FormField\n                              control={form.control}\n                              name={`contactPersons.${index}.firstName`}\n                              render={({ field }) => (\n                                <Input {...field} className=\"w-full\" data-testid={`input-contact-firstname-${index}`} />\n                              )}\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <FormField\n                              control={form.control}\n                              name={`contactPersons.${index}.lastName`}\n                              render={({ field }) => (\n                                <Input {...field} className=\"w-full\" data-testid={`input-contact-lastname-${index}`} />\n                              )}\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <FormField\n                              control={form.control}\n                              name={`contactPersons.${index}.email`}\n                              render={({ field }) => (\n                                <Input {...field} type=\"email\" className=\"w-full\" data-testid={`input-contact-email-${index}`} />\n                              )}\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <FormField\n                              control={form.control}\n                              name={`contactPersons.${index}.workPhone`}\n                              render={({ field }) => (\n                                <Input {...field} className=\"w-full\" data-testid={`input-contact-workphone-${index}`} />\n                              )}\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <FormField\n                              control={form.control}\n                              name={`contactPersons.${index}.mobile`}\n                              render={({ field }) => (\n                                <Input {...field} className=\"w-full\" data-testid={`input-contact-mobile-${index}`} />\n                              )}\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => removeContact(index)}\n                              data-testid={`button-remove-contact-${index}`}\n                            >\n                              <Trash2 className=\"h-4 w-4 text-slate-400\" />\n                            </Button>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"custom\" className=\"space-y-6\">\n                <div className=\"text-center py-8 text-slate-500\">\n                  <p>Custom fields can be configured in Settings.</p>\n                  <Button variant=\"link\" className=\"text-blue-600 mt-2\" data-testid=\"link-configure-custom-fields\">\n                    Configure Custom Fields\n                  </Button>\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"tags\" className=\"space-y-6\">\n                <div className=\"text-center py-8 text-slate-500\">\n                  <p>Reporting tags help categorize customers for reports.</p>\n                  <Button variant=\"link\" className=\"text-blue-600 mt-2\" data-testid=\"link-configure-tags\">\n                    Configure Reporting Tags\n                  </Button>\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"remarks\" className=\"space-y-6\">\n                <FormField\n                  control={form.control}\n                  name=\"remarks\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Remarks</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"For internal use only. These remarks won't appear on any documents.\"\n                          className=\"min-h-[100px]\"\n                          {...field}\n                          data-testid=\"textarea-remarks\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </TabsContent>\n            </div>\n          </Tabs>\n\n          <div className=\"flex items-center gap-3 pt-6 border-t\">\n            <Button type=\"submit\" disabled={isSubmitting} data-testid=\"button-save-customer\">\n              {isSubmitting ? \"Saving...\" : \"Save\"}\n            </Button>\n            <Button type=\"button\" variant=\"outline\" onClick={() => setLocation(\"/customers\")} data-testid=\"button-cancel\">\n              Cancel\n            </Button>\n          </div>\n        </form>\n      </Form >\n    </div >\n  );\n}\n","path":null,"size_bytes":87198,"size_tokens":null},"client/src/layouts/MainLayout.tsx":{"content":"import { ReactNode } from 'react';\nimport { AppShell } from '@/components/layout/AppShell';\n\ninterface MainLayoutProps {\n  children: ReactNode;\n}\n\nexport const MainLayout = ({ children }: MainLayoutProps) => {\n  return <AppShell>{children}</AppShell>;\n};\n\nexport default MainLayout;\n","path":null,"size_bytes":283,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { AppProvider } from \"@/lib/store\";\nimport NotFound from \"@/pages/not-found\";\nimport AppShell from \"@/components/layout/AppShell\";\nimport Dashboard from \"@/pages/dashboard\";\nimport Invoices from \"@/pages/invoices\";\nimport InvoiceCreate from \"@/pages/invoice-create\";\nimport InvoiceImport from \"@/pages/invoice-import\";\nimport Customers from \"@/pages/customers\";\nimport CustomerCreate from \"@/pages/customer-create\";\nimport CustomerEdit from \"@/pages/customer-edit\";\nimport Products from \"@/pages/products\";\nimport ProductCreate from \"@/pages/products-create\";\nimport ProductEdit from \"@/pages/products-edit\";\nimport ItemsPage from \"@/modules/items/pages/ItemsPage\";\nimport ItemCreatePage from \"@/modules/items/pages/ItemCreatePage\";\nimport ItemDetailPage from \"@/modules/items/pages/ItemDetailPage\";\nimport QuotesPage from \"@/modules/sales/pages/QuotesPage\";\nimport QuoteCreatePage from \"@/modules/sales/pages/QuoteCreatePage\";\nimport QuoteEditPage from \"@/modules/sales/pages/QuoteEditPage\";\nimport SalesOrdersPage from \"@/pages/sales-orders\";\nimport SalesOrderCreatePage from \"@/pages/sales-order-create\";\nimport SalesOrderEditPage from \"@/pages/sales-order-edit\";\nimport InvoiceEdit from \"@/pages/invoice-edit\";\nimport Reports from \"@/pages/reports\";\nimport Settings from \"@/pages/settings\";\nimport Support from \"@/pages/support\";\nimport Vendors from \"@/pages/vendors\";\nimport VendorCreate from \"@/pages/vendor-create\";\nimport VendorEdit from \"@/pages/vendor-edit\";\nimport Expenses from \"@/pages/expenses\";\nimport PurchaseOrders from \"@/pages/purchase-orders\";\nimport PurchaseOrderCreate from \"@/pages/purchase-order-create\";\nimport PurchaseOrderEdit from \"@/pages/purchase-order-edit\";\nimport Bills from \"@/pages/bills\";\nimport BillCreate from \"@/pages/bill-create\";\nimport BillEdit from \"@/pages/bill-edit\";\nimport PaymentsMade from \"@/pages/payments-made\";\nimport PaymentsMadeCreate from \"@/pages/payments-made-create\";\nimport VendorCredits from \"@/pages/vendor-credits\";\nimport VendorCreditCreate from \"@/pages/vendor-credit-create\";\nimport VendorCreditEdit from \"@/pages/vendor-credit-edit\";\nimport TimeTracking from \"@/pages/time-tracking\";\nimport Banking from \"@/pages/banking\";\nimport FilingCompliance from \"@/pages/filing-compliance\";\nimport Accountant from \"@/pages/accountant\";\nimport Documents from \"@/pages/documents\";\nimport DeliveryChallans from \"@/pages/delivery-challans\";\nimport DeliveryChallanCreate from \"@/pages/delivery-challan-create\";\nimport DeliveryChallanEdit from \"@/pages/delivery-challan-edit\";\nimport CreditNotes from \"@/pages/credit-notes\";\nimport CreditNoteCreate from \"@/pages/credit-note-create\";\nimport CreditNoteEdit from \"@/pages/credit-note-edit\";\nimport PaymentsReceived from \"@/pages/payments-received\";\nimport PaymentsReceivedCreate from \"@/pages/payments-received-create\";\nimport EWayBills from \"@/pages/e-way-bills\";\n\nfunction Router() {\n  return (\n    <AppShell>\n      <Switch>\n        <Route path=\"/\" component={Dashboard} />\n        <Route path=\"/invoices\" component={Invoices} />\n        <Route path=\"/invoices/new\" component={InvoiceCreate} />\n        <Route path=\"/invoices/create\" component={InvoiceCreate} />\n        <Route path=\"/invoices/import\" component={InvoiceImport} />\n        <Route path=\"/invoices/:id/edit\" component={InvoiceEdit} />\n        <Route path=\"/estimates\" component={QuotesPage} />\n        <Route path=\"/quotes\" component={QuotesPage} />\n        <Route path=\"/quotes/create\" component={QuoteCreatePage} />\n        <Route path=\"/estimates/:id/edit\" component={QuoteEditPage} />\n        <Route path=\"/quotes/:id/edit\" component={QuoteEditPage} />\n        <Route path=\"/sales-orders\" component={SalesOrdersPage} />\n        <Route path=\"/sales-orders/create\" component={SalesOrderCreatePage} />\n        <Route path=\"/sales-orders/:id/edit\" component={SalesOrderEditPage} />\n        <Route path=\"/delivery-challans\" component={DeliveryChallans} />\n        <Route path=\"/delivery-challans/new\" component={DeliveryChallanCreate} />\n        <Route path=\"/delivery-challans/create\" component={DeliveryChallanCreate} />\n        <Route path=\"/delivery-challans/:id/edit\" component={DeliveryChallanEdit} />\n        <Route path=\"/credit-notes\" component={CreditNotes} />\n        <Route path=\"/credit-notes/create\" component={CreditNoteCreate} />\n        <Route path=\"/credit-notes/:id/edit\" component={CreditNoteEdit} />\n        <Route path=\"/payments-received\" component={PaymentsReceived} />\n        <Route path=\"/payments-received/create\" component={PaymentsReceivedCreate} />\n        <Route path=\"/eway-bills\" component={EWayBills} />\n        <Route path=\"/e-way-bills\" component={EWayBills} />\n        <Route path=\"/customers\" component={Customers} />\n        <Route path=\"/customers/new\" component={CustomerCreate} />\n        <Route path=\"/customers/:id/edit\" component={CustomerEdit} />\n        <Route path=\"/products\" component={Products} />\n        <Route path=\"/products/new\" component={ProductCreate} />\n        <Route path=\"/items\" component={ItemsPage} />\n        <Route path=\"/items/create\" component={ItemCreatePage} />\n        <Route path=\"/items/:id/edit\" component={ProductEdit} />\n        <Route path=\"/items/:id\" component={ItemDetailPage} />\n        <Route path=\"/reports\" component={Reports} />\n        <Route path=\"/settings\" component={Settings} />\n        <Route path=\"/support\" component={Support} />\n        <Route path=\"/vendors\" component={Vendors} />\n        <Route path=\"/vendors/new\" component={VendorCreate} />\n        <Route path=\"/vendors/:id/edit\" component={VendorEdit} />\n        <Route path=\"/expenses\" component={Expenses} />\n        <Route path=\"/purchase-orders\" component={PurchaseOrders} />\n        <Route path=\"/purchase-orders/new\" component={PurchaseOrderCreate} />\n        <Route path=\"/purchase-orders/:id/edit\" component={PurchaseOrderEdit} />\n        <Route path=\"/bills\" component={Bills} />\n        <Route path=\"/bills/new\" component={BillCreate} />\n        <Route path=\"/bills/:id/edit\" component={BillEdit} />\n        <Route path=\"/payments-made\" component={PaymentsMade} />\n        <Route path=\"/payments-made/new\" component={PaymentsMadeCreate} />\n        <Route path=\"/vendor-credits\" component={VendorCredits} />\n        <Route path=\"/vendor-credits/new\" component={VendorCreditCreate} />\n        <Route path=\"/vendor-credits/create\" component={VendorCreditCreate} />\n        <Route path=\"/vendor-credits/:id/edit\" component={VendorCreditEdit} />\n        <Route path=\"/time-tracking\" component={TimeTracking} />\n        <Route path=\"/banking\" component={Banking} />\n        <Route path=\"/filing-compliance\" component={FilingCompliance} />\n        <Route path=\"/accountant\" component={Accountant} />\n        <Route path=\"/documents\" component={Documents} />\n        <Route component={NotFound} />\n      </Switch>\n    </AppShell>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AppProvider>\n        <TooltipProvider>\n          <Toaster />\n          <Router />\n        </TooltipProvider>\n      </AppProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":7392,"size_tokens":null},"server/src/modules/items/validators/index.ts":{"content":"import { z } from 'zod';\n\nexport const createItemSchema = z.object({\n  name: z.string().min(1, 'Name is required').max(255),\n  description: z.string().max(1000).optional(),\n  type: z.enum(['goods', 'service']),\n  sku: z.string().max(50).optional(),\n  hsnSac: z.string().max(20).optional(),\n  unit: z.string().max(20).optional(),\n  sellingPrice: z.number().min(0, 'Selling price must be positive'),\n  purchasePrice: z.number().min(0, 'Purchase price must be positive'),\n  taxRate: z.number().min(0).max(100).optional(),\n});\n\nexport const updateItemSchema = createItemSchema.partial().extend({\n  isActive: z.boolean().optional(),\n});\n\nexport const itemIdParamSchema = z.object({\n  id: z.string().min(1, 'Item ID is required'),\n});\n\nexport const itemQuerySchema = z.object({\n  page: z.coerce.number().int().min(1).default(1),\n  limit: z.coerce.number().int().min(1).max(100).default(10),\n  search: z.string().optional(),\n  type: z.enum(['goods', 'service']).optional(),\n  isActive: z.coerce.boolean().optional(),\n});\n","path":null,"size_bytes":1014,"size_tokens":null},"client/src/pages/products-edit.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation, useRoute } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useForm } from \"react-hook-form\";\nimport { z } from \"zod\";\nimport { X, Check, ChevronsUpDown, Search, HelpCircle, Settings } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n  CommandSeparator,\n} from \"@/components/ui/command\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { cn } from \"@/lib/utils\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\n\ninterface Unit {\n  id: string;\n  name: string;\n  uqc: string;\n}\n\ninterface TaxRate {\n  id: string;\n  name: string;\n  rate: number;\n  label: string;\n}\n\nconst itemSchema = z.object({\n  type: z.enum([\"goods\", \"service\"]),\n  name: z.string().min(1, \"Item Name is required\"),\n  unit: z.string().optional(),\n  hsnSac: z.string().optional(),\n  taxPreference: z.string().default(\"taxable\"),\n  exemptionReason: z.string().optional(),\n  sellable: z.boolean().default(true),\n  sellingPrice: z.string().optional(),\n  salesAccount: z.string().default(\"sales\"),\n  salesDescription: z.string().optional(),\n  purchasable: z.boolean().default(true),\n  costPrice: z.string().optional(),\n  purchaseAccount: z.string().default(\"cost_of_goods\"),\n  purchaseDescription: z.string().optional(),\n  preferredVendor: z.string().optional(),\n  intraStateTaxRate: z.string().default(\"gst18\"),\n  interStateTaxRate: z.string().default(\"igst18\"),\n});\n\ntype ItemFormValues = z.infer<typeof itemSchema>;\n\nconst taxPreferences = [\n  { label: \"Taxable\", value: \"taxable\" },\n  { label: \"Non-Taxable\", value: \"non_taxable\" },\n  { label: \"Out of Scope\", value: \"out_of_scope\" },\n  { label: \"Non-GST Supply\", value: \"non_gst\" },\n];\n\nconst exemptionReasons = [\n  { label: \"Exempt under section 10\", value: \"section_10\" },\n  { label: \"Exempt under section 11\", value: \"section_11\" },\n  { label: \"Exempt supply under notification\", value: \"notification\" },\n  { label: \"Other exemption\", value: \"other\" },\n];\n\n// Hierarchical account structure - matches New Item exactly\nconst ACCOUNT_HIERARCHY = [\n  {\n    category: \"Other Current Asset\",\n    accounts: [\n      { label: \"Advance Tax\", value: \"advance_tax\" },\n      { label: \"Employee Advance\", value: \"employee_advance\" },\n      { label: \"Input Tax Credits\", value: \"input_tax_credits\", children: [\n        { label: \"Input CGST\", value: \"input_cgst\" },\n        { label: \"Input IGST\", value: \"input_igst\" },\n        { label: \"Input SGST\", value: \"input_sgst\" },\n      ]},\n      { label: \"Prepaid Expenses\", value: \"prepaid_expenses\" },\n      { label: \"Reverse Charge Tax Input but not due\", value: \"reverse_charge_input\" },\n      { label: \"TDS Receivable\", value: \"tds_receivable\" },\n    ]\n  },\n  {\n    category: \"Fixed Asset\",\n    accounts: [\n      { label: \"Furniture and Equipment\", value: \"furniture_equipment\" },\n    ]\n  },\n  {\n    category: \"Other Current Liability\",\n    accounts: [\n      { label: \"Employee Reimbursements\", value: \"employee_reimbursements\" },\n      { label: \"GST Payable\", value: \"gst_payable\", children: [\n        { label: \"Output CGST\", value: \"output_cgst\" },\n        { label: \"Output IGST\", value: \"output_igst\" },\n        { label: \"Output SGST\", value: \"output_sgst\" },\n      ]},\n      { label: \"Opening Balance Adjustments\", value: \"opening_balance_adjustments\" },\n      { label: \"Tax Payable\", value: \"tax_payable\" },\n      { label: \"TDS Payable\", value: \"tds_payable\" },\n      { label: \"Unearned Revenue\", value: \"unearned_revenue\" },\n    ]\n  },\n  {\n    category: \"Income\",\n    accounts: [\n      { label: \"Discount\", value: \"discount\" },\n      { label: \"General Income\", value: \"general_income\" },\n      { label: \"Interest Income\", value: \"interest_income\" },\n      { label: \"Late Fee Income\", value: \"late_fee_income\" },\n      { label: \"Other Charges\", value: \"other_charges\" },\n      { label: \"Sales\", value: \"sales\" },\n      { label: \"Shipping Charge\", value: \"shipping_charge\" },\n    ]\n  },\n  {\n    category: \"Cost of Goods Sold\",\n    accounts: [\n      { label: \"Cost of Goods Sold\", value: \"cost_of_goods\" },\n      { label: \"Job Costing\", value: \"job_costing\" },\n      { label: \"Materials\", value: \"materials\" },\n      { label: \"Subcontractor\", value: \"subcontractor\" },\n    ]\n  },\n  {\n    category: \"Expense\",\n    accounts: [\n      { label: \"Advertising And Marketing\", value: \"advertising_marketing\" },\n      { label: \"Automobile Expense\", value: \"automobile_expense\" },\n      { label: \"Bank Fees and Charges\", value: \"bank_fees\" },\n      { label: \"Consultant Expense\", value: \"consultant_expense\" },\n      { label: \"Office Supplies\", value: \"office_supplies\" },\n      { label: \"Rent Expense\", value: \"rent_expense\" },\n      { label: \"Travel Expense\", value: \"travel_expense\" },\n    ]\n  }\n];\n\n// Flatten accounts for search\nconst flattenAccounts = () => {\n  const flat: { label: string; value: string; category: string; indent: number }[] = [];\n  ACCOUNT_HIERARCHY.forEach(cat => {\n    cat.accounts.forEach(acc => {\n      flat.push({ label: acc.label, value: acc.value, category: cat.category, indent: 0 });\n      if ('children' in acc && acc.children) {\n        acc.children.forEach((child: any) => {\n          flat.push({ label: child.label, value: child.value, category: cat.category, indent: 1 });\n        });\n      }\n    });\n  });\n  return flat;\n};\n\nconst ALL_ACCOUNTS = flattenAccounts();\n\nexport default function ProductEdit() {\n  const [, setLocation] = useLocation();\n  const [, params] = useRoute(\"/items/:id/edit\");\n  const { toast } = useToast();\n  const [unitOpen, setUnitOpen] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [salesAccountOpen, setSalesAccountOpen] = useState(false);\n  const [purchaseAccountOpen, setPurchaseAccountOpen] = useState(false);\n  const [intraStateTaxOpen, setIntraStateTaxOpen] = useState(false);\n  const [interStateTaxOpen, setInterStateTaxOpen] = useState(false);\n  const [vendors, setVendors] = useState<{ label: string; value: string }[]>([]);\n  const [vendorsLoading, setVendorsLoading] = useState(true);\n\n  // Fetch units from API\n  const { data: unitsData } = useQuery<{ success: boolean; data: Unit[] }>({\n    queryKey: ['/api/units'],\n  });\n  const units = unitsData?.data || [];\n\n  // Fetch tax rates from API\n  const { data: taxRatesData } = useQuery<{ success: boolean; data: TaxRate[] }>({\n    queryKey: ['/api/taxRates'],\n  });\n  const taxRates = taxRatesData?.data || [];\n\n  // Separate GST and IGST rates\n  const gstRates = taxRates.filter(t => t.name.startsWith('GST') || t.name === 'Exempt');\n  const igstRates = taxRates.filter(t => t.name.startsWith('IGST') || t.name === 'Exempt');\n\n  // Fetch vendors from API\n  useEffect(() => {\n    const fetchVendors = async () => {\n      try {\n        const response = await fetch('/api/vendors');\n        if (response.ok) {\n          const result = await response.json();\n          const vendorOptions = result.data.map((vendor: any) => ({\n            label: vendor.displayName || vendor.companyName || `${vendor.firstName} ${vendor.lastName}`.trim(),\n            value: vendor.id,\n          }));\n          setVendors(vendorOptions);\n        }\n      } catch (error) {\n        console.error('Failed to fetch vendors:', error);\n      } finally {\n        setVendorsLoading(false);\n      }\n    };\n\n    fetchVendors();\n  }, []);\n\n  const form = useForm<ItemFormValues>({\n    resolver: zodResolver(itemSchema),\n    defaultValues: {\n      type: \"goods\",\n      name: \"\",\n      taxPreference: \"taxable\",\n      sellable: true,\n      purchasable: true,\n      salesAccount: \"sales\",\n      purchaseAccount: \"cost_of_goods\",\n      intraStateTaxRate: \"GST18\",\n      interStateTaxRate: \"IGST18\",\n    },\n  });\n\n  useEffect(() => {\n    if (params?.id) {\n      fetchItem(params.id);\n    }\n  }, [params?.id]);\n\n  const fetchItem = async (id: string) => {\n    try {\n      const response = await fetch(`/api/items/${id}`);\n      if (response.ok) {\n        const item = await response.json();\n        form.reset({\n          type: item.type || \"goods\",\n          name: item.name || \"\",\n          unit: item.usageUnit || \"\",\n          hsnSac: item.hsnSac || \"\",\n          taxPreference: item.taxPreference || \"taxable\",\n          exemptionReason: item.exemptionReason || \"\",\n          sellable: true,\n          sellingPrice: item.rate?.replace(\"\", \"\") || \"\",\n          salesAccount: item.salesAccount || \"sales\",\n          salesDescription: item.description || \"\",\n          purchasable: true,\n          costPrice: item.purchaseRate?.replace(\"\", \"\") || \"\",\n          purchaseAccount: item.purchaseAccount || \"cost_of_goods\",\n          purchaseDescription: item.purchaseDescription || \"\",\n          preferredVendor: item.preferredVendor || \"\",\n          intraStateTaxRate: item.intraStateTax || \"GST18\",\n          interStateTaxRate: item.interStateTax || \"IGST18\",\n        });\n      } else {\n        toast({\n          title: \"Error\",\n          description: \"Item not found\",\n          variant: \"destructive\",\n        });\n        setLocation(\"/items\");\n      }\n    } catch (error) {\n      console.error(\"Failed to fetch item:\", error);\n      setLocation(\"/items\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const itemType = form.watch(\"type\");\n  const taxPreference = form.watch(\"taxPreference\");\n  const sellable = form.watch(\"sellable\");\n  const purchasable = form.watch(\"purchasable\");\n\n  const onSubmit = async (data: ItemFormValues) => {\n    if (!params?.id) return;\n\n    try {\n      const itemData = {\n        name: data.name,\n        type: data.type,\n        hsnSac: data.hsnSac || \"\",\n        usageUnit: data.unit || \"\",\n        rate: data.sellingPrice || \"0.00\",\n        purchaseRate: data.costPrice || \"0.00\",\n        description: data.salesDescription || \"\",\n        purchaseDescription: data.purchaseDescription || \"\",\n        taxPreference: data.taxPreference,\n        exemptionReason: data.exemptionReason || \"\",\n        intraStateTax: data.intraStateTaxRate,\n        interStateTax: data.interStateTaxRate,\n        salesAccount: data.salesAccount,\n        purchaseAccount: data.purchaseAccount,\n        preferredVendor: data.preferredVendor || \"\",\n      };\n\n      const response = await fetch(`/api/items/${params.id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(itemData),\n      });\n\n      if (response.ok) {\n        queryClient.invalidateQueries({ queryKey: ['/api/items'] });\n        toast({\n          title: \"Item Updated\",\n          description: \"The item has been successfully updated.\",\n        });\n        setLocation(\"/items\");\n      } else {\n        throw new Error(\"Failed to update item\");\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update item. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const getAccountLabel = (value: string) => {\n    const acc = ALL_ACCOUNTS.find(a => a.value === value);\n    return acc?.label || value;\n  };\n\n  const getTaxRateLabel = (value: string) => {\n    const tax = taxRates.find(t => t.name === value);\n    return tax?.label || value;\n  };\n\n  if (loading) {\n    return (\n      <div className=\"fixed inset-0 z-50 bg-black/20 flex items-center justify-center\">\n        <div className=\"bg-white p-8 rounded-lg shadow-xl\">\n          <p className=\"text-slate-600\">Loading item...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"fixed inset-0 z-50 bg-black/20\">\n      <div className=\"fixed inset-y-0 right-0 w-full max-w-2xl bg-white shadow-xl overflow-hidden flex flex-col animate-in slide-in-from-right duration-300\">\n        <div className=\"flex items-center justify-between p-4 border-b border-slate-200\">\n          <h1 className=\"text-xl font-semibold text-slate-900\">Edit Item</h1>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setLocation(\"/items\")}\n            className=\"h-8 w-8\"\n            data-testid=\"button-close-edit\"\n          >\n            <X className=\"h-5 w-5\" />\n          </Button>\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n\n              <FormField\n                control={form.control}\n                name=\"type\"\n                render={({ field }) => (\n                  <FormItem className=\"flex items-center gap-8\">\n                    <div className=\"text-slate-600 min-w-[100px] flex items-center gap-1 text-sm font-medium\">\n                      Type\n                      <Tooltip>\n                        <TooltipTrigger asChild>\n                          <HelpCircle className=\"h-3.5 w-3.5 text-slate-400\" />\n                        </TooltipTrigger>\n                        <TooltipContent>\n                          <p>Select whether this is a physical product (Goods) or a service</p>\n                        </TooltipContent>\n                      </Tooltip>\n                    </div>\n                    <FormControl>\n                      <RadioGroup\n                        onValueChange={field.onChange}\n                        value={field.value}\n                        className=\"flex gap-6\"\n                      >\n                        <div className=\"flex items-center space-x-2\">\n                          <RadioGroupItem value=\"goods\" id=\"goods-edit\" className=\"border-blue-600 text-blue-600\" data-testid=\"radio-goods-edit\" />\n                          <Label htmlFor=\"goods-edit\" className=\"font-normal cursor-pointer\">Goods</Label>\n                        </div>\n                        <div className=\"flex items-center space-x-2\">\n                          <RadioGroupItem value=\"service\" id=\"service-edit\" className=\"border-blue-600 text-blue-600\" data-testid=\"radio-service-edit\" />\n                          <Label htmlFor=\"service-edit\" className=\"font-normal cursor-pointer\">Service</Label>\n                        </div>\n                      </RadioGroup>\n                    </FormControl>\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem className=\"grid grid-cols-[120px_1fr] items-start gap-4\">\n                    <FormLabel className=\"text-slate-700 pt-2.5\">\n                      Name<span className=\"text-red-600\">*</span>\n                    </FormLabel>\n                    <div>\n                      <FormControl>\n                        <Input {...field} className=\"bg-white border-blue-500 focus:border-blue-600\" data-testid=\"input-item-name-edit\" />\n                      </FormControl>\n                      <FormMessage />\n                    </div>\n                  </FormItem>\n                )}\n              />\n\n              {/* Unit Dropdown with API data */}\n              <FormField\n                control={form.control}\n                name=\"unit\"\n                render={({ field }) => (\n                  <FormItem className=\"grid grid-cols-[120px_1fr] items-start gap-4\">\n                    <div className=\"text-slate-600 pt-2.5 flex items-center gap-1 text-sm font-medium\">\n                      Unit\n                      <Tooltip>\n                        <TooltipTrigger asChild>\n                          <HelpCircle className=\"h-3.5 w-3.5 text-slate-400\" />\n                        </TooltipTrigger>\n                        <TooltipContent>\n                          <p>Select the unit of measurement for this item</p>\n                        </TooltipContent>\n                      </Tooltip>\n                    </div>\n                    <div>\n                      <Popover open={unitOpen} onOpenChange={setUnitOpen}>\n                        <PopoverTrigger asChild>\n                          <FormControl>\n                            <Button\n                              variant=\"outline\"\n                              role=\"combobox\"\n                              className={cn(\n                                \"w-full justify-between font-normal bg-white\",\n                                !field.value && \"text-muted-foreground\"\n                              )}\n                              data-testid=\"select-unit-edit\"\n                            >\n                              {field.value\n                                ? units.find((u) => u.name === field.value)\n                                  ? `${field.value} (${units.find((u) => u.name === field.value)?.uqc || ''})`\n                                  : field.value\n                                : \"Select unit...\"}\n                              <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                            </Button>\n                          </FormControl>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-[300px] p-0\" align=\"start\">\n                          <Command>\n                            <CommandInput placeholder=\"Search\" />\n                            <CommandList className=\"max-h-[200px] overflow-y-auto\">\n                              <CommandEmpty>No unit found.</CommandEmpty>\n                              <CommandGroup>\n                                {units.map((unit) => (\n                                  <CommandItem\n                                    value={`${unit.name} (${unit.uqc})`}\n                                    key={unit.id}\n                                    onSelect={() => {\n                                      form.setValue(\"unit\", unit.name);\n                                      setUnitOpen(false);\n                                    }}\n                                    data-testid={`unit-option-edit-${unit.name}`}\n                                  >\n                                    <Check\n                                      className={cn(\n                                        \"mr-2 h-4 w-4\",\n                                        unit.name === field.value ? \"opacity-100\" : \"opacity-0\"\n                                      )}\n                                    />\n                                    {unit.name} ({unit.uqc})\n                                  </CommandItem>\n                                ))}\n                              </CommandGroup>\n                              <CommandSeparator />\n                              <CommandGroup>\n                                <CommandItem\n                                  className=\"text-blue-600 cursor-pointer\"\n                                  onSelect={() => {\n                                    setUnitOpen(false);\n                                  }}\n                                  data-testid=\"button-configure-units-edit\"\n                                >\n                                  <Settings className=\"mr-2 h-4 w-4\" />\n                                  Configure Units\n                                </CommandItem>\n                              </CommandGroup>\n                            </CommandList>\n                          </Command>\n                        </PopoverContent>\n                      </Popover>\n                    </div>\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"hsnSac\"\n                render={({ field }) => (\n                  <FormItem className=\"grid grid-cols-[120px_1fr] items-start gap-4\">\n                    <FormLabel className=\"text-slate-600 pt-2.5\">\n                      {itemType === \"goods\" ? \"HSN Code\" : \"SAC\"}\n                    </FormLabel>\n                    <div className=\"relative\">\n                      <FormControl>\n                        <Input {...field} className=\"bg-white pr-10\" data-testid=\"input-hsn-sac-edit\" />\n                      </FormControl>\n                      <Search className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-blue-500 cursor-pointer\" />\n                    </div>\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"taxPreference\"\n                render={({ field }) => (\n                  <FormItem className=\"grid grid-cols-[120px_1fr] items-start gap-4\">\n                    <FormLabel className=\"text-slate-700 pt-2.5\">\n                      Tax Preference<span className=\"text-red-600\">*</span>\n                    </FormLabel>\n                    <div>\n                      <Select onValueChange={field.onChange} value={field.value}>\n                        <FormControl>\n                          <SelectTrigger className=\"bg-white\" data-testid=\"select-tax-preference-edit\">\n                            <SelectValue placeholder=\"Select tax preference\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {taxPreferences.map((pref) => (\n                            <SelectItem key={pref.value} value={pref.value}>\n                              {pref.label}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </FormItem>\n                )}\n              />\n\n              {taxPreference === \"non_gst\" && (\n                <FormField\n                  control={form.control}\n                  name=\"exemptionReason\"\n                  render={({ field }) => (\n                    <FormItem className=\"grid grid-cols-[120px_1fr] items-start gap-4\">\n                      <div className=\"text-slate-700 pt-2.5 flex items-center gap-1 text-sm font-medium\">\n                        Exemption Reason<span className=\"text-red-600\">*</span>\n                      </div>\n                      <div>\n                        <Select onValueChange={field.onChange} value={field.value}>\n                          <FormControl>\n                            <SelectTrigger className=\"bg-white\">\n                              <SelectValue placeholder=\"Select exemption reason\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {exemptionReasons.map((reason) => (\n                              <SelectItem key={reason.value} value={reason.value}>\n                                {reason.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </FormItem>\n                  )}\n                />\n              )}\n\n              {/* Default Tax Rates Section */}\n              <div className=\"border-t pt-4 mt-4\">\n                <h3 className=\"font-semibold text-slate-800 mb-4\">Default Tax Rates</h3>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  {/* Intra State Tax Dropdown */}\n                  <FormField\n                    control={form.control}\n                    name=\"intraStateTaxRate\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-slate-700\">Intra State Tax</FormLabel>\n                        <Popover open={intraStateTaxOpen} onOpenChange={setIntraStateTaxOpen}>\n                          <PopoverTrigger asChild>\n                            <FormControl>\n                              <Button\n                                variant=\"outline\"\n                                role=\"combobox\"\n                                className=\"w-full justify-between font-normal bg-white\"\n                                data-testid=\"select-intra-state-tax-edit\"\n                              >\n                                {getTaxRateLabel(field.value)}\n                                <Search className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                              </Button>\n                            </FormControl>\n                          </PopoverTrigger>\n                          <PopoverContent className=\"w-[250px] p-0\" align=\"start\">\n                            <Command>\n                              <CommandInput placeholder=\"Search tax rates...\" />\n                              <CommandList>\n                                <CommandEmpty>No tax rate found.</CommandEmpty>\n                                <CommandGroup>\n                                  {gstRates.map((tax) => (\n                                    <CommandItem\n                                      key={tax.id}\n                                      value={tax.label}\n                                      onSelect={() => {\n                                        form.setValue(\"intraStateTaxRate\", tax.name);\n                                        setIntraStateTaxOpen(false);\n                                      }}\n                                    >\n                                      <Check\n                                        className={cn(\n                                          \"mr-2 h-4 w-4\",\n                                          tax.name === field.value ? \"opacity-100\" : \"opacity-0\"\n                                        )}\n                                      />\n                                      {tax.label}\n                                    </CommandItem>\n                                  ))}\n                                </CommandGroup>\n                              </CommandList>\n                            </Command>\n                          </PopoverContent>\n                        </Popover>\n                      </FormItem>\n                    )}\n                  />\n\n                  {/* Inter State Tax Dropdown */}\n                  <FormField\n                    control={form.control}\n                    name=\"interStateTaxRate\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-slate-700\">Inter State Tax</FormLabel>\n                        <Popover open={interStateTaxOpen} onOpenChange={setInterStateTaxOpen}>\n                          <PopoverTrigger asChild>\n                            <FormControl>\n                              <Button\n                                variant=\"outline\"\n                                role=\"combobox\"\n                                className=\"w-full justify-between font-normal bg-white\"\n                                data-testid=\"select-inter-state-tax-edit\"\n                              >\n                                {getTaxRateLabel(field.value)}\n                                <Search className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                              </Button>\n                            </FormControl>\n                          </PopoverTrigger>\n                          <PopoverContent className=\"w-[250px] p-0\" align=\"start\">\n                            <Command>\n                              <CommandInput placeholder=\"Search tax rates...\" />\n                              <CommandList>\n                                <CommandEmpty>No tax rate found.</CommandEmpty>\n                                <CommandGroup>\n                                  {igstRates.map((tax) => (\n                                    <CommandItem\n                                      key={tax.id}\n                                      value={tax.label}\n                                      onSelect={() => {\n                                        form.setValue(\"interStateTaxRate\", tax.name);\n                                        setInterStateTaxOpen(false);\n                                      }}\n                                    >\n                                      <Check\n                                        className={cn(\n                                          \"mr-2 h-4 w-4\",\n                                          tax.name === field.value ? \"opacity-100\" : \"opacity-0\"\n                                        )}\n                                      />\n                                      {tax.label}\n                                    </CommandItem>\n                                  ))}\n                                </CommandGroup>\n                              </CommandList>\n                            </Command>\n                          </PopoverContent>\n                        </Popover>\n                      </FormItem>\n                    )}\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-8 pt-4\">\n                {/* Sales Information */}\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"font-semibold text-slate-800\">Sales Information</h3>\n                    <FormField\n                      control={form.control}\n                      name=\"sellable\"\n                      render={({ field }) => (\n                        <FormItem className=\"flex items-center space-x-2 space-y-0\">\n                          <FormControl>\n                            <Checkbox\n                              checked={field.value}\n                              onCheckedChange={field.onChange}\n                              data-testid=\"checkbox-sellable-edit\"\n                            />\n                          </FormControl>\n                          <Label className=\"font-normal text-sm\">Sellable</Label>\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  {sellable && (\n                    <>\n                      <FormField\n                        control={form.control}\n                        name=\"sellingPrice\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-slate-700\">\n                              Selling Price<span className=\"text-red-600\">*</span>\n                            </FormLabel>\n                            <div className=\"flex\">\n                              <span className=\"bg-slate-100 border border-r-0 border-slate-300 rounded-l-md px-3 py-2 text-sm text-slate-600\">INR</span>\n                              <FormControl>\n                                <Input {...field} className=\"rounded-l-none bg-white\" placeholder=\"0.00\" data-testid=\"input-selling-price-edit\" />\n                              </FormControl>\n                            </div>\n                          </FormItem>\n                        )}\n                      />\n\n                      {/* Sales Account - Searchable Hierarchical */}\n                      <FormField\n                        control={form.control}\n                        name=\"salesAccount\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-slate-700\">\n                              Account<span className=\"text-red-600\">*</span>\n                            </FormLabel>\n                            <Popover open={salesAccountOpen} onOpenChange={setSalesAccountOpen}>\n                              <PopoverTrigger asChild>\n                                <FormControl>\n                                  <Button\n                                    variant=\"outline\"\n                                    role=\"combobox\"\n                                    className=\"w-full justify-between font-normal bg-white\"\n                                    data-testid=\"select-sales-account-edit\"\n                                  >\n                                    {getAccountLabel(field.value)}\n                                    <Search className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                                  </Button>\n                                </FormControl>\n                              </PopoverTrigger>\n                              <PopoverContent className=\"w-[350px] p-0\" align=\"start\">\n                                <Command>\n                                  <CommandInput placeholder=\"Search accounts...\" />\n                                  <CommandList className=\"max-h-[300px] overflow-y-auto\">\n                                    <CommandEmpty>No account found.</CommandEmpty>\n                                    {ACCOUNT_HIERARCHY.map((category) => (\n                                      <CommandGroup key={category.category} heading={category.category}>\n                                        {category.accounts.map((acc) => (\n                                          <div key={acc.value}>\n                                            <CommandItem\n                                              value={acc.label}\n                                              onSelect={() => {\n                                                form.setValue(\"salesAccount\", acc.value);\n                                                setSalesAccountOpen(false);\n                                              }}\n                                            >\n                                              <Check\n                                                className={cn(\n                                                  \"mr-2 h-4 w-4\",\n                                                  acc.value === field.value ? \"opacity-100\" : \"opacity-0\"\n                                                )}\n                                              />\n                                              {acc.label}\n                                            </CommandItem>\n                                            {'children' in acc && acc.children && acc.children.map((child: any) => (\n                                              <CommandItem\n                                                key={child.value}\n                                                value={child.label}\n                                                onSelect={() => {\n                                                  form.setValue(\"salesAccount\", child.value);\n                                                  setSalesAccountOpen(false);\n                                                }}\n                                                className=\"pl-8\"\n                                              >\n                                                <Check\n                                                  className={cn(\n                                                    \"mr-2 h-4 w-4\",\n                                                    child.value === field.value ? \"opacity-100\" : \"opacity-0\"\n                                                  )}\n                                                />\n                                                 {child.label}\n                                              </CommandItem>\n                                            ))}\n                                          </div>\n                                        ))}\n                                      </CommandGroup>\n                                    ))}\n                                  </CommandList>\n                                </Command>\n                              </PopoverContent>\n                            </Popover>\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={form.control}\n                        name=\"salesDescription\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-slate-600\">Description</FormLabel>\n                            <FormControl>\n                              <Textarea {...field} className=\"bg-white min-h-[80px] resize-none\" data-testid=\"textarea-sales-description-edit\" />\n                            </FormControl>\n                          </FormItem>\n                        )}\n                      />\n                    </>\n                  )}\n                </div>\n\n                {/* Purchase Information */}\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"font-semibold text-slate-800\">Purchase Information</h3>\n                    <FormField\n                      control={form.control}\n                      name=\"purchasable\"\n                      render={({ field }) => (\n                        <FormItem className=\"flex items-center space-x-2 space-y-0\">\n                          <FormControl>\n                            <Checkbox\n                              checked={field.value}\n                              onCheckedChange={field.onChange}\n                              data-testid=\"checkbox-purchasable-edit\"\n                            />\n                          </FormControl>\n                          <Label className=\"font-normal text-sm\">Purchasable</Label>\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  {purchasable && (\n                    <>\n                      <FormField\n                        control={form.control}\n                        name=\"costPrice\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-slate-700\">\n                              Cost Price<span className=\"text-red-600\">*</span>\n                            </FormLabel>\n                            <div className=\"flex\">\n                              <span className=\"bg-slate-100 border border-r-0 border-slate-300 rounded-l-md px-3 py-2 text-sm text-slate-600\">INR</span>\n                              <FormControl>\n                                <Input {...field} className=\"rounded-l-none bg-white\" placeholder=\"0.00\" data-testid=\"input-cost-price-edit\" />\n                              </FormControl>\n                            </div>\n                          </FormItem>\n                        )}\n                      />\n\n                      {/* Purchase Account - Searchable Hierarchical */}\n                      <FormField\n                        control={form.control}\n                        name=\"purchaseAccount\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-slate-700\">\n                              Account<span className=\"text-red-600\">*</span>\n                            </FormLabel>\n                            <Popover open={purchaseAccountOpen} onOpenChange={setPurchaseAccountOpen}>\n                              <PopoverTrigger asChild>\n                                <FormControl>\n                                  <Button\n                                    variant=\"outline\"\n                                    role=\"combobox\"\n                                    className=\"w-full justify-between font-normal bg-white\"\n                                    data-testid=\"select-purchase-account-edit\"\n                                  >\n                                    {getAccountLabel(field.value)}\n                                    <Search className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                                  </Button>\n                                </FormControl>\n                              </PopoverTrigger>\n                              <PopoverContent className=\"w-[350px] p-0\" align=\"start\">\n                                <Command>\n                                  <CommandInput placeholder=\"Search accounts...\" />\n                                  <CommandList className=\"max-h-[300px] overflow-y-auto\">\n                                    <CommandEmpty>No account found.</CommandEmpty>\n                                    {ACCOUNT_HIERARCHY.map((category) => (\n                                      <CommandGroup key={category.category} heading={category.category}>\n                                        {category.accounts.map((acc) => (\n                                          <div key={acc.value}>\n                                            <CommandItem\n                                              value={acc.label}\n                                              onSelect={() => {\n                                                form.setValue(\"purchaseAccount\", acc.value);\n                                                setPurchaseAccountOpen(false);\n                                              }}\n                                            >\n                                              <Check\n                                                className={cn(\n                                                  \"mr-2 h-4 w-4\",\n                                                  acc.value === field.value ? \"opacity-100\" : \"opacity-0\"\n                                                )}\n                                              />\n                                              {acc.label}\n                                            </CommandItem>\n                                            {'children' in acc && acc.children && acc.children.map((child: any) => (\n                                              <CommandItem\n                                                key={child.value}\n                                                value={child.label}\n                                                onSelect={() => {\n                                                  form.setValue(\"purchaseAccount\", child.value);\n                                                  setPurchaseAccountOpen(false);\n                                                }}\n                                                className=\"pl-8\"\n                                              >\n                                                <Check\n                                                  className={cn(\n                                                    \"mr-2 h-4 w-4\",\n                                                    child.value === field.value ? \"opacity-100\" : \"opacity-0\"\n                                                  )}\n                                                />\n                                                 {child.label}\n                                              </CommandItem>\n                                            ))}\n                                          </div>\n                                        ))}\n                                      </CommandGroup>\n                                    ))}\n                                  </CommandList>\n                                </Command>\n                              </PopoverContent>\n                            </Popover>\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={form.control}\n                        name=\"purchaseDescription\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-slate-600\">Description</FormLabel>\n                            <FormControl>\n                              <Textarea {...field} className=\"bg-white min-h-[80px] resize-none\" data-testid=\"textarea-purchase-description-edit\" />\n                            </FormControl>\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={form.control}\n                        name=\"preferredVendor\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-slate-600\">Preferred Vendor</FormLabel>\n                            <Select onValueChange={field.onChange} value={field.value || \"\"}>\n                              <FormControl>\n                                <SelectTrigger className=\"bg-white\" data-testid=\"select-preferred-vendor-edit\">\n                                  <SelectValue placeholder={vendorsLoading ? \"Loading vendors...\" : \"Select a vendor\"} />\n                                </SelectTrigger>\n                              </FormControl>\n                              <SelectContent>\n                                {vendors.map((vendor) => (\n                                  <SelectItem key={vendor.value} value={vendor.value}>\n                                    {vendor.label}\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          </FormItem>\n                        )}\n                      />\n                    </>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"flex justify-end gap-3 pt-4 border-t mt-6\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setLocation(\"/items\")}\n                  data-testid=\"button-cancel-edit\"\n                >\n                  Cancel\n                </Button>\n                <Button type=\"submit\" className=\"bg-blue-600 hover:bg-blue-700\" data-testid=\"button-save-item-edit\">\n                  Save\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":46395,"size_tokens":null},"client/src/pages/estimates.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport {\n  Plus,\n  ChevronDown,\n  MoreHorizontal,\n  Search,\n  X,\n  FileText,\n  Pencil,\n  Trash2,\n  Copy,\n  Send,\n  CheckCircle,\n  XCircle,\n  ShoppingCart,\n  Receipt,\n  Clock,\n  Calendar,\n  User,\n  Building2,\n  Mail,\n  Phone,\n  MapPin,\n  Printer,\n  Download\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { usePagination } from \"@/hooks/use-pagination\";\nimport { TablePagination } from \"@/components/table-pagination\";\n\ninterface Quote {\n  id: string;\n  quoteNumber: string;\n  referenceNumber?: string;\n  date: string;\n  expiryDate?: string;\n  customerId: string;\n  customerName: string;\n  total: number;\n  status: string;\n  convertedTo?: string; // 'invoice' | 'sales-order'\n  salesperson?: string;\n  createdAt?: string;\n  updatedAt?: string;\n  items?: any[];\n  billingAddress?: any;\n  shippingAddress?: any;\n  customerNotes?: string;\n  termsAndConditions?: string;\n  activityLogs?: any[];\n}\n\nconst formatCurrency = (amount: number) => {\n  return new Intl.NumberFormat('en-IN', {\n    style: 'currency',\n    currency: 'INR',\n    minimumFractionDigits: 2\n  }).format(amount);\n};\n\nconst formatDate = (dateString: string) => {\n  if (!dateString) return '-';\n  const date = new Date(dateString);\n  return date.toLocaleDateString('en-IN', { day: '2-digit', month: '2-digit', year: 'numeric' });\n};\n\nconst getStatusBadge = (status: string, convertedTo?: string) => {\n  const statusMap: Record<string, { label: string; variant: \"default\" | \"secondary\" | \"destructive\" | \"outline\" }> = {\n    DRAFT: { label: \"Draft\", variant: \"secondary\" },\n    SENT: { label: \"Sent\", variant: \"default\" },\n    ACCEPTED: { label: \"Accepted\", variant: \"default\" },\n    DECLINED: { label: \"Declined\", variant: \"destructive\" },\n    CONVERTED: {\n      label: convertedTo === 'invoice' ? \"Converted to Invoice\" :\n        convertedTo === 'sales-order' ? \"Converted to Sales Order\" : \"Converted\",\n      variant: \"outline\"\n    },\n    EXPIRED: { label: \"Expired\", variant: \"destructive\" },\n  };\n  const config = statusMap[status] || { label: status, variant: \"secondary\" as const };\n  return <Badge variant={config.variant}>{config.label}</Badge>;\n};\n\ninterface QuoteDetailPanelProps {\n  quote: Quote;\n  onClose: () => void;\n  onEdit: () => void;\n  onDelete: () => void;\n  onConvert: (type: string) => void;\n  onClone: () => void;\n}\n\nfunction QuoteDetailPanel({ quote, onClose, onEdit, onDelete, onConvert, onClone }: QuoteDetailPanelProps) {\n  const [activeTab, setActiveTab] = useState(\"overview\");\n  const { toast } = useToast();\n\n  return (\n    <div className=\"h-full flex flex-col bg-white dark:bg-slate-900 border-l border-slate-200 dark:border-slate-700\">\n      <div className=\"flex items-center justify-between px-6 py-4 border-b border-slate-200 dark:border-slate-700\">\n        <div className=\"flex items-center gap-3\">\n          <Button variant=\"ghost\" size=\"icon\" onClick={onClose} className=\"h-8 w-8\">\n            <ChevronDown className=\"h-4 w-4 rotate-90\" />\n          </Button>\n          <div>\n            <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white\" data-testid=\"text-quote-number\">{quote.quoteNumber}</h2>\n            <p className=\"text-sm text-slate-500\">{quote.customerName}</p>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button variant=\"outline\" size=\"sm\" onClick={onEdit} data-testid=\"button-edit-quote\">\n            Edit\n          </Button>\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button className=\"bg-blue-600 hover:bg-blue-700 gap-1.5\" size=\"sm\" data-testid=\"button-convert\">\n                Convert\n                <ChevronDown className=\"h-3 w-3\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\" className=\"w-48\">\n              <DropdownMenuItem onClick={() => onConvert(\"sales-order\")} data-testid=\"menu-item-convert-sales-order\">\n                <ShoppingCart className=\"mr-2 h-4 w-4\" /> To Sales Order\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => onConvert(\"invoice\")} data-testid=\"menu-item-convert-invoice\">\n                <Receipt className=\"mr-2 h-4 w-4\" /> To Invoice\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"outline\" size=\"sm\" className=\"gap-1.5\" data-testid=\"button-more-actions\">\n                More\n                <ChevronDown className=\"h-3 w-3\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\" className=\"w-48\">\n              <DropdownMenuItem data-testid=\"menu-item-send\">\n                <Send className=\"mr-2 h-4 w-4\" /> Send Email\n              </DropdownMenuItem>\n              <DropdownMenuItem data-testid=\"menu-item-print\">\n                <Printer className=\"mr-2 h-4 w-4\" /> Print\n              </DropdownMenuItem>\n              <DropdownMenuItem data-testid=\"menu-item-download\">\n                <Download className=\"mr-2 h-4 w-4\" /> Download PDF\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={onClone} data-testid=\"menu-item-clone\">\n                <Copy className=\"mr-2 h-4 w-4\" /> Clone\n              </DropdownMenuItem>\n              <DropdownMenuSeparator />\n              <DropdownMenuItem data-testid=\"menu-item-accept\">\n                <CheckCircle className=\"mr-2 h-4 w-4\" /> Mark as Accepted\n              </DropdownMenuItem>\n              <DropdownMenuItem data-testid=\"menu-item-decline\">\n                <XCircle className=\"mr-2 h-4 w-4\" /> Mark as Declined\n              </DropdownMenuItem>\n              <DropdownMenuSeparator />\n              <DropdownMenuItem className=\"text-red-600\" onClick={onDelete} data-testid=\"menu-item-delete\">\n                <Trash2 className=\"mr-2 h-4 w-4\" /> Delete\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={onClose} data-testid=\"button-close-panel\">\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"flex-1 flex flex-col overflow-hidden\">\n        <div className=\"flex items-center px-6 border-b border-slate-200 dark:border-slate-700\">\n          <TabsList className=\"h-auto p-0 bg-transparent\">\n            <TabsTrigger\n              value=\"overview\"\n              className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n              data-testid=\"tab-overview\"\n            >\n              Overview\n            </TabsTrigger>\n            <TabsTrigger\n              value=\"activity\"\n              className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n              data-testid=\"tab-activity\"\n            >\n              Activity\n            </TabsTrigger>\n          </TabsList>\n        </div>\n\n        <TabsContent value=\"overview\" className=\"flex-1 overflow-auto mt-0\">\n          <div className=\"p-6 space-y-6\">\n            <div className=\"grid grid-cols-2 gap-6\">\n              <div>\n                <p className=\"text-sm text-slate-500\">Quote Number</p>\n                <p className=\"font-medium\">{quote.quoteNumber}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-slate-500\">Status</p>\n                <div className=\"mt-1\">{getStatusBadge(quote.status, quote.convertedTo)}</div>\n              </div>\n              <div>\n                <p className=\"text-sm text-slate-500\">Quote Date</p>\n                <p className=\"font-medium\">{formatDate(quote.date)}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-slate-500\">Expiry Date</p>\n                <p className=\"font-medium\">{quote.expiryDate ? formatDate(quote.expiryDate) : '-'}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-slate-500\">Customer</p>\n                <p className=\"font-medium text-blue-600\">{quote.customerName}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-slate-500\">Salesperson</p>\n                <p className=\"font-medium\">{quote.salesperson || '-'}</p>\n              </div>\n            </div>\n\n            <div className=\"border-t pt-6\">\n              <h4 className=\"text-lg font-semibold mb-4\">Amount</h4>\n              <div className=\"text-3xl font-bold text-slate-900 dark:text-white\">\n                {formatCurrency(quote.total)}\n              </div>\n            </div>\n\n            {quote.items && quote.items.length > 0 && (\n              <div className=\"border-t pt-6\">\n                <h4 className=\"text-lg font-semibold mb-4\">Items</h4>\n                <table className=\"w-full text-sm\">\n                  <thead>\n                    <tr className=\"border-b text-left text-slate-500\">\n                      <th className=\"py-2\">Item</th>\n                      <th className=\"py-2 text-right\">Qty</th>\n                      <th className=\"py-2 text-right\">Rate</th>\n                      <th className=\"py-2 text-right\">Amount</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {quote.items.map((item: any, index: number) => (\n                      <tr key={item.id || index} className=\"border-b\">\n                        <td className=\"py-2\">{item.name}</td>\n                        <td className=\"py-2 text-right\">{item.quantity}</td>\n                        <td className=\"py-2 text-right\">{formatCurrency(item.rate)}</td>\n                        <td className=\"py-2 text-right\">{formatCurrency(item.amount)}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            )}\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"activity\" className=\"flex-1 overflow-auto mt-0\">\n          <div className=\"p-6\">\n            {quote.activityLogs && quote.activityLogs.length > 0 ? (\n              <div className=\"space-y-4\">\n                {quote.activityLogs.map((log: any) => (\n                  <div key={log.id} className=\"flex items-start gap-3 p-3 rounded-lg bg-slate-50 dark:bg-slate-800\">\n                    <div className=\"h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center\">\n                      <Clock className=\"h-4 w-4 text-blue-600\" />\n                    </div>\n                    <div>\n                      <p className=\"font-medium\">{log.description}</p>\n                      <p className=\"text-sm text-slate-500\">\n                        {log.user} - {formatDate(log.timestamp)}\n                      </p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <p className=\"text-center text-slate-500 py-8\">No activity recorded</p>\n            )}\n          </div>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n\nexport default function Estimates() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [quotes, setQuotes] = useState<Quote[]>([]);\n  const [selectedQuotes, setSelectedQuotes] = useState<string[]>([]);\n  const [selectedQuote, setSelectedQuote] = useState<Quote | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [quoteToDelete, setQuoteToDelete] = useState<string | null>(null);\n\n  useEffect(() => {\n    fetchQuotes();\n  }, []);\n\n  const fetchQuotes = async () => {\n    try {\n      const response = await fetch('/api/quotes');\n      if (response.ok) {\n        const data = await response.json();\n        setQuotes(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch quotes:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleQuoteClick = (quote: Quote) => {\n    setSelectedQuote(quote);\n  };\n\n  const handleClosePanel = () => {\n    setSelectedQuote(null);\n  };\n\n  const handleEditQuote = () => {\n    if (selectedQuote) {\n      setLocation(`/estimates/${selectedQuote.id}/edit`);\n    }\n  };\n\n  const toggleSelectQuote = (id: string, e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (selectedQuotes.includes(id)) {\n      setSelectedQuotes(selectedQuotes.filter(i => i !== id));\n    } else {\n      setSelectedQuotes([...selectedQuotes, id]);\n    }\n  };\n\n  const handleDeleteClick = () => {\n    if (selectedQuote) {\n      setQuoteToDelete(selectedQuote.id);\n      setDeleteDialogOpen(true);\n    }\n  };\n\n  const confirmDelete = async () => {\n    if (!quoteToDelete) return;\n    try {\n      const response = await fetch(`/api/quotes/${quoteToDelete}`, { method: 'DELETE' });\n      if (response.ok) {\n        toast({ title: \"Quote deleted successfully\" });\n        handleClosePanel();\n        fetchQuotes();\n      }\n    } catch (error) {\n      toast({ title: \"Failed to delete quote\", variant: \"destructive\" });\n    } finally {\n      setDeleteDialogOpen(false);\n      setQuoteToDelete(null);\n    }\n  };\n\n  const handleConvert = async (type: string) => {\n    if (!selectedQuote) return;\n\n    try {\n      const endpoint = type === 'invoice'\n        ? `/api/quotes/${selectedQuote.id}/convert-to-invoice`\n        : `/api/quotes/${selectedQuote.id}/convert-to-sales-order`;\n\n      const response = await fetch(endpoint, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n      });\n\n      if (response.ok) {\n        const result = await response.json();\n        const targetType = type === 'invoice' ? 'Invoice' : 'Sales Order';\n        const targetNumber = type === 'invoice'\n          ? result.data?.invoice?.invoiceNumber || result.data?.invoiceNumber\n          : result.data?.salesOrder?.orderNumber || result.data?.orderNumber;\n\n        toast({\n          title: \"Quote Converted\",\n          description: `Quote converted to ${targetType}${targetNumber ? ' ' + targetNumber : ''}`,\n        });\n\n        // Refresh quotes to show updated status\n        fetchQuotes();\n        handleClosePanel();\n      } else {\n        throw new Error('Failed to convert');\n      }\n    } catch (error) {\n      console.error('Error converting quote:', error);\n      toast({\n        title: \"Conversion Failed\",\n        description: `Failed to convert quote to ${type === 'invoice' ? 'Invoice' : 'Sales Order'}`,\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const handleClone = async () => {\n    if (!selectedQuote) return;\n    setLocation(`/quotes/create?cloneFrom=${selectedQuote.id}`);\n  };\n\n  const filteredQuotes = quotes.filter(quote => {\n    const matchesSearch =\n      quote.quoteNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      quote.customerName.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesStatus = statusFilter === \"all\" || quote.status === statusFilter;\n    return matchesSearch && matchesStatus;\n  });\n\n  const { currentPage, totalPages, totalItems, itemsPerPage, paginatedItems, goToPage } = usePagination(filteredQuotes, 10);\n\n  return (\n    <div className=\"flex h-[calc(100vh-80px)] animate-in fade-in duration-300\">\n      <div className={`flex-1 flex flex-col overflow-hidden transition-all duration-300 ${selectedQuote ? 'w-80' : 'w-full'}`}>\n        <div className=\"flex items-center justify-between p-4\">\n          <div className=\"flex items-center gap-2\">\n            <h1 className=\"text-xl font-semibold text-slate-900 dark:text-white\">All Quotes</h1>\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"ghost\" size=\"sm\" className=\"h-8\">\n                  <ChevronDown className=\"h-4 w-4\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"start\">\n                <DropdownMenuItem onClick={() => setStatusFilter(\"all\")}>All Quotes</DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setStatusFilter(\"DRAFT\")}>Draft</DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setStatusFilter(\"SENT\")}>Sent</DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setStatusFilter(\"ACCEPTED\")}>Accepted</DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setStatusFilter(\"CONVERTED\")}>Converted</DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setStatusFilter(\"DECLINED\")}>Declined</DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              onClick={() => setLocation(\"/estimates/create\")}\n              className=\"bg-blue-600 hover:bg-blue-700 gap-1.5 h-9\"\n              data-testid=\"button-new-quote\"\n            >\n              <Plus className=\"h-4 w-4\" /> New\n            </Button>\n            <Button variant=\"outline\" size=\"icon\" className=\"h-9 w-9\">\n              <MoreHorizontal className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"flex-1 overflow-auto\">\n          {loading ? (\n            <div className=\"p-8 text-center text-slate-500\">Loading quotes...</div>\n          ) : filteredQuotes.length === 0 ? (\n            <div className=\"p-8 text-center text-slate-500\">\n              <div className=\"h-16 w-16 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center mx-auto mb-4\">\n                <FileText className=\"h-8 w-8 text-slate-400\" />\n              </div>\n              <p className=\"mb-4\">No quotes found.</p>\n              <Button\n                onClick={() => setLocation(\"/estimates/create\")}\n                className=\"bg-blue-600 hover:bg-blue-700\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" /> Create your first quote\n              </Button>\n            </div>\n          ) : (\n            <>\n            <table className=\"w-full text-sm\">\n              <thead className=\"bg-slate-50 dark:bg-slate-800 sticky top-0 z-10\">\n                <tr className=\"border-b border-slate-200 dark:border-slate-700\">\n                  <th className=\"w-10 px-3 py-3 text-left\">\n                    <Checkbox\n                      checked={selectedQuotes.length === filteredQuotes.length && filteredQuotes.length > 0}\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        if (selectedQuotes.length === filteredQuotes.length) {\n                          setSelectedQuotes([]);\n                        } else {\n                          setSelectedQuotes(filteredQuotes.map(q => q.id));\n                        }\n                      }}\n                    />\n                  </th>\n                  <th className=\"px-3 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Date</th>\n                  <th className=\"px-3 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Quote Number</th>\n                  <th className=\"px-3 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Reference#</th>\n                  <th className=\"px-3 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Customer Name</th>\n                  <th className=\"px-3 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Status</th>\n                  <th className=\"px-3 py-3 text-right text-xs font-semibold text-slate-500 uppercase tracking-wider\">Amount</th>\n                  <th className=\"w-10 px-3 py-3\"></th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-slate-100 dark:divide-slate-700\">\n                {paginatedItems.map((quote) => (\n                  <tr\n                    key={quote.id}\n                    className={`hover:bg-slate-50 dark:hover:bg-slate-800 cursor-pointer transition-colors ${selectedQuote?.id === quote.id ? 'bg-blue-50 dark:bg-blue-900/20' : ''\n                      }`}\n                    onClick={() => handleQuoteClick(quote)}\n                    data-testid={`row-quote-${quote.id}`}\n                  >\n                    <td className=\"px-3 py-3\">\n                      <Checkbox\n                        checked={selectedQuotes.includes(quote.id)}\n                        onClick={(e) => toggleSelectQuote(quote.id, e)}\n                      />\n                    </td>\n                    <td className=\"px-3 py-3 text-slate-600 dark:text-slate-400\">\n                      {formatDate(quote.date)}\n                    </td>\n                    <td className=\"px-3 py-3\">\n                      <span className=\"font-medium text-blue-600 dark:text-blue-400\">{quote.quoteNumber}</span>\n                    </td>\n                    <td className=\"px-3 py-3 text-slate-600 dark:text-slate-400\">\n                      {quote.referenceNumber || '-'}\n                    </td>\n                    <td className=\"px-3 py-3 text-slate-600 dark:text-slate-400\">\n                      {quote.customerName}\n                    </td>\n                    <td className=\"px-3 py-3\">\n                      {getStatusBadge(quote.status, quote.convertedTo)}\n                    </td>\n                    <td className=\"px-3 py-3 text-right text-slate-600 dark:text-slate-400\">\n                      {formatCurrency(quote.total)}\n                    </td>\n                    <td className=\"px-3 py-3\">\n                      <DropdownMenu>\n                        <DropdownMenuTrigger asChild onClick={(e) => e.stopPropagation()}>\n                          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n                            <Search className=\"h-4 w-4 text-slate-400\" />\n                          </Button>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent align=\"end\">\n                          <DropdownMenuItem onClick={(e) => { e.stopPropagation(); handleQuoteClick(quote); }}>\n                            View Details\n                          </DropdownMenuItem>\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n            <TablePagination\n              currentPage={currentPage}\n              totalPages={totalPages}\n              totalItems={totalItems}\n              itemsPerPage={itemsPerPage}\n              onPageChange={goToPage}\n            />\n            </>\n          )}\n        </div>\n      </div>\n\n      {selectedQuote && (\n        <div className=\"flex-1 min-w-0\">\n          <QuoteDetailPanel\n            quote={selectedQuote}\n            onClose={handleClosePanel}\n            onEdit={handleEditQuote}\n            onDelete={handleDeleteClick}\n            onConvert={handleConvert}\n            onClone={handleClone}\n          />\n        </div>\n      )}\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Quote</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete this quote? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={confirmDelete} className=\"bg-red-600 hover:bg-red-700\">\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":24821,"size_tokens":null},"client/src/shared/types/index.ts":{"content":"export interface PaginatedResponse<T> {\n  data: T[];\n  total: number;\n  page: number;\n  limit: number;\n  totalPages: number;\n}\n\nexport interface ApiError {\n  message: string;\n  code?: string;\n  status?: number;\n  errors?: Record<string, string[]>;\n}\n\nexport interface SelectOption {\n  label: string;\n  value: string | number;\n}\n\nexport interface TableColumn<T> {\n  key: keyof T | string;\n  label: string;\n  sortable?: boolean;\n  render?: (value: any, row: T) => React.ReactNode;\n}\n\nexport interface FilterOption {\n  field: string;\n  operator: 'eq' | 'ne' | 'gt' | 'gte' | 'lt' | 'lte' | 'like' | 'in';\n  value: string | number | string[] | number[];\n}\n\nexport interface SortOption {\n  field: string;\n  direction: 'asc' | 'desc';\n}\n\nexport interface BaseEntity {\n  id: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface Address {\n  street?: string;\n  city?: string;\n  state?: string;\n  postalCode?: string;\n  country?: string;\n}\n\nexport interface ContactInfo {\n  phone?: string;\n  email?: string;\n  website?: string;\n}\n","path":null,"size_bytes":1037,"size_tokens":null},"client/src/modules/sales/pages/index.ts":{"content":"export { default as InvoicesPage } from './InvoicesPage';\nexport { default as InvoiceCreatePage } from './InvoiceCreatePage';\nexport { default as EstimatesPage } from './EstimatesPage';\nexport { default as QuotesPage } from './QuotesPage';\nexport { default as QuoteCreatePage } from './QuoteCreatePage';\nexport { default as QuoteEditPage } from './QuoteEditPage';\n","path":null,"size_bytes":364,"size_tokens":null},"client/src/modules/items/services/index.ts":{"content":"import { itemsApi } from '../api';\nimport { CreateItemDto, UpdateItemDto, ItemFilters } from '../types';\n\nexport const itemsService = {\n  async fetchItems(page = 1, limit = 10, filters?: ItemFilters) {\n    try {\n      const response = await itemsApi.getAll(page, limit, filters);\n      return { success: true, data: response };\n    } catch (error) {\n      console.error('Failed to fetch items:', error);\n      throw error;\n    }\n  },\n\n  async fetchItem(id: string) {\n    try {\n      const response = await itemsApi.getById(id);\n      return { success: true, data: response };\n    } catch (error) {\n      console.error('Failed to fetch item:', error);\n      throw error;\n    }\n  },\n\n  async createItem(data: CreateItemDto) {\n    try {\n      const response = await itemsApi.create(data);\n      return { success: true, data: response };\n    } catch (error) {\n      console.error('Failed to create item:', error);\n      throw error;\n    }\n  },\n\n  async updateItem(id: string, data: UpdateItemDto) {\n    try {\n      const response = await itemsApi.update(id, data);\n      return { success: true, data: response };\n    } catch (error) {\n      console.error('Failed to update item:', error);\n      throw error;\n    }\n  },\n\n  async deleteItem(id: string) {\n    try {\n      await itemsApi.delete(id);\n      return { success: true };\n    } catch (error) {\n      console.error('Failed to delete item:', error);\n      throw error;\n    }\n  },\n};\n\nexport default itemsService;\n","path":null,"size_bytes":1463,"size_tokens":null},"server/src/database/schema/index.ts":{"content":"export * from '../../modules/items/model';\n\nimport { pgTable, text, varchar, numeric, boolean, timestamp, integer, jsonb } from 'drizzle-orm/pg-core';\n\nexport const users = pgTable('users', {\n  id: text('id').primaryKey(),\n  email: varchar('email', { length: 255 }).notNull().unique(),\n  password: text('password').notNull(),\n  name: varchar('name', { length: 255 }).notNull(),\n  role: varchar('role', { length: 50 }).notNull().default('viewer'),\n  phone: varchar('phone', { length: 20 }),\n  avatar: text('avatar'),\n  isActive: boolean('is_active').notNull().default(true),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n});\n\nexport const customers = pgTable('customers', {\n  id: text('id').primaryKey(),\n  displayName: varchar('display_name', { length: 255 }).notNull(),\n  companyName: varchar('company_name', { length: 255 }),\n  email: varchar('email', { length: 255 }),\n  phone: varchar('phone', { length: 20 }),\n  gst: varchar('gst', { length: 15 }),\n  pan: varchar('pan', { length: 10 }),\n  billingAddress: jsonb('billing_address'),\n  shippingAddress: jsonb('shipping_address'),\n  creditLimit: numeric('credit_limit', { precision: 18, scale: 2 }),\n  paymentTerms: integer('payment_terms'),\n  notes: text('notes'),\n  isActive: boolean('is_active').notNull().default(true),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n});\n\nexport const vendors = pgTable('vendors', {\n  id: text('id').primaryKey(),\n  displayName: varchar('display_name', { length: 255 }).notNull(),\n  companyName: varchar('company_name', { length: 255 }),\n  email: varchar('email', { length: 255 }),\n  phone: varchar('phone', { length: 20 }),\n  gst: varchar('gst', { length: 15 }),\n  pan: varchar('pan', { length: 10 }),\n  billingAddress: jsonb('billing_address'),\n  paymentTerms: integer('payment_terms'),\n  notes: text('notes'),\n  isActive: boolean('is_active').notNull().default(true),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n});\n\nexport const invoices = pgTable('invoices', {\n  id: text('id').primaryKey(),\n  invoiceNumber: varchar('invoice_number', { length: 50 }).notNull().unique(),\n  customerId: text('customer_id').notNull(),\n  invoiceDate: timestamp('invoice_date').notNull(),\n  dueDate: timestamp('due_date').notNull(),\n  status: varchar('status', { length: 50 }).notNull().default('draft'),\n  subtotal: numeric('subtotal', { precision: 18, scale: 2 }).notNull().default('0'),\n  discountTotal: numeric('discount_total', { precision: 18, scale: 2 }).notNull().default('0'),\n  taxTotal: numeric('tax_total', { precision: 18, scale: 2 }).notNull().default('0'),\n  total: numeric('total', { precision: 18, scale: 2 }).notNull().default('0'),\n  amountPaid: numeric('amount_paid', { precision: 18, scale: 2 }).notNull().default('0'),\n  balance: numeric('balance', { precision: 18, scale: 2 }).notNull().default('0'),\n  notes: text('notes'),\n  terms: text('terms'),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n});\n\nexport const invoiceLineItems = pgTable('invoice_line_items', {\n  id: text('id').primaryKey(),\n  invoiceId: text('invoice_id').notNull(),\n  itemId: text('item_id'),\n  itemName: varchar('item_name', { length: 255 }).notNull(),\n  description: text('description'),\n  quantity: numeric('quantity', { precision: 18, scale: 4 }).notNull(),\n  rate: numeric('rate', { precision: 18, scale: 2 }).notNull(),\n  discount: numeric('discount', { precision: 18, scale: 2 }),\n  taxRate: numeric('tax_rate', { precision: 5, scale: 2 }),\n  amount: numeric('amount', { precision: 18, scale: 2 }).notNull(),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n});\n\nexport const expenses = pgTable('expenses', {\n  id: text('id').primaryKey(),\n  date: timestamp('date').notNull(),\n  category: varchar('category', { length: 100 }).notNull(),\n  vendorId: text('vendor_id'),\n  amount: numeric('amount', { precision: 18, scale: 2 }).notNull(),\n  taxAmount: numeric('tax_amount', { precision: 18, scale: 2 }),\n  notes: text('notes'),\n  receiptUrl: text('receipt_url'),\n  status: varchar('status', { length: 50 }).notNull().default('pending'),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n});\n\nexport const bankAccounts = pgTable('bank_accounts', {\n  id: text('id').primaryKey(),\n  accountName: varchar('account_name', { length: 255 }).notNull(),\n  accountNumber: varchar('account_number', { length: 50 }).notNull(),\n  bankName: varchar('bank_name', { length: 255 }).notNull(),\n  ifscCode: varchar('ifsc_code', { length: 11 }),\n  accountType: varchar('account_type', { length: 50 }).notNull(),\n  balance: numeric('balance', { precision: 18, scale: 2 }).notNull().default('0'),\n  isActive: boolean('is_active').notNull().default(true),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n});\n","path":null,"size_bytes":5120,"size_tokens":null},"client/src/components/ui/input-group.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Textarea } from \"@/components/ui/textarea\"\n\nfunction InputGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"input-group\"\n      role=\"group\"\n      className={cn(\n        \"group/input-group border-input dark:bg-input/30 shadow-xs relative flex w-full items-center rounded-md border outline-none transition-[color,box-shadow]\",\n        \"h-9 has-[>textarea]:h-auto\",\n\n        // Variants based on alignment.\n        \"has-[>[data-align=inline-start]]:[&>input]:pl-2\",\n        \"has-[>[data-align=inline-end]]:[&>input]:pr-2\",\n        \"has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3\",\n        \"has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3\",\n\n        // Focus state.\n        \"has-[[data-slot=input-group-control]:focus-visible]:ring-ring has-[[data-slot=input-group-control]:focus-visible]:ring-1\",\n\n        // Error state.\n        \"has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40\",\n\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupAddonVariants = cva(\n  \"text-muted-foreground flex h-auto cursor-text select-none items-center justify-center gap-2 py-1.5 text-sm font-medium group-data-[disabled=true]/input-group:opacity-50 [&>kbd]:rounded-[calc(var(--radius)-5px)] [&>svg:not([class*='size-'])]:size-4\",\n  {\n    variants: {\n      align: {\n        \"inline-start\":\n          \"order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]\",\n        \"inline-end\":\n          \"order-last pr-3 has-[>button]:mr-[-0.4rem] has-[>kbd]:mr-[-0.35rem]\",\n        \"block-start\":\n          \"[.border-b]:pb-3 order-first w-full justify-start px-3 pt-3 group-has-[>input]/input-group:pt-2.5\",\n        \"block-end\":\n          \"[.border-t]:pt-3 order-last w-full justify-start px-3 pb-3 group-has-[>input]/input-group:pb-2.5\",\n      },\n    },\n    defaultVariants: {\n      align: \"inline-start\",\n    },\n  }\n)\n\nfunction InputGroupAddon({\n  className,\n  align = \"inline-start\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof inputGroupAddonVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"input-group-addon\"\n      data-align={align}\n      className={cn(inputGroupAddonVariants({ align }), className)}\n      onClick={(e) => {\n        if ((e.target as HTMLElement).closest(\"button\")) {\n          return\n        }\n        e.currentTarget.parentElement?.querySelector(\"input\")?.focus()\n      }}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupButtonVariants = cva(\n  \"flex items-center gap-2 text-sm shadow-none\",\n  {\n    variants: {\n      size: {\n        xs: \"h-6 gap-1 rounded-[calc(var(--radius)-5px)] px-2 has-[>svg]:px-2 [&>svg:not([class*='size-'])]:size-3.5\",\n        sm: \"h-8 gap-1.5 rounded-md px-2.5 has-[>svg]:px-2.5\",\n        \"icon-xs\":\n          \"size-6 rounded-[calc(var(--radius)-5px)] p-0 has-[>svg]:p-0\",\n        \"icon-sm\": \"size-8 p-0 has-[>svg]:p-0\",\n      },\n    },\n    defaultVariants: {\n      size: \"xs\",\n    },\n  }\n)\n\nfunction InputGroupButton({\n  className,\n  type = \"button\",\n  variant = \"ghost\",\n  size = \"xs\",\n  ...props\n}: Omit<React.ComponentProps<typeof Button>, \"size\"> &\n  VariantProps<typeof inputGroupButtonVariants>) {\n  return (\n    <Button\n      type={type}\n      data-size={size}\n      variant={variant}\n      className={cn(inputGroupButtonVariants({ size }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupText({ className, ...props }: React.ComponentProps<\"span\">) {\n  return (\n    <span\n      className={cn(\n        \"text-muted-foreground flex items-center gap-2 text-sm [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupInput({\n  className,\n  ...props\n}: React.ComponentProps<\"input\">) {\n  return (\n    <Input\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupTextarea({\n  className,\n  ...props\n}: React.ComponentProps<\"textarea\">) {\n  return (\n    <Textarea\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 resize-none rounded-none border-0 bg-transparent py-3 shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  InputGroup,\n  InputGroupAddon,\n  InputGroupButton,\n  InputGroupText,\n  InputGroupInput,\n  InputGroupTextarea,\n}\n","path":null,"size_bytes":4971,"size_tokens":null},"client/src/modules/purchases/pages/VendorCreditsPage.tsx":{"content":"export { default } from '@/pages/vendor-credits';\n","path":null,"size_bytes":50,"size_tokens":null},"server/src/modules/banking/routes/index.ts":{"content":"import { Router } from 'express';\n\nexport const bankingRouter = Router();\n\nbankingRouter.get('/accounts', (req, res) => {\n  res.json({ success: true, data: [], message: 'Bank accounts endpoint' });\n});\n\nbankingRouter.get('/transactions', (req, res) => {\n  res.json({ success: true, data: [], message: 'Transactions endpoint' });\n});\n\nexport default bankingRouter;\n","path":null,"size_bytes":364,"size_tokens":null},"client/src/modules/auth/types/index.ts":{"content":"export interface User {\n  id: string;\n  email: string;\n  name: string;\n  role: 'admin' | 'accountant' | 'manager' | 'viewer';\n  permissions?: string[];\n  avatar?: string;\n  phone?: string;\n  isActive: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface LoginCredentials {\n  email: string;\n  password: string;\n}\n\nexport interface RegisterData {\n  name: string;\n  email: string;\n  password: string;\n  confirmPassword: string;\n}\n\nexport interface AuthResponse {\n  user: User;\n  token: string;\n  refreshToken?: string;\n}\n\nexport interface ResetPasswordData {\n  email: string;\n}\n\nexport interface ChangePasswordData {\n  currentPassword: string;\n  newPassword: string;\n  confirmPassword: string;\n}\n","path":null,"size_bytes":711,"size_tokens":null},"server/src/modules/items/index.ts":{"content":"export { itemsRouter } from './routes';\nexport { ItemsController } from './controller';\nexport { ItemsService } from './service';\nexport { ItemsRepository } from './repository';\nexport * from './validators';\nexport * from './model';\n","path":null,"size_bytes":233,"size_tokens":null},"client/src/modules/customers/types/index.ts":{"content":"import { BaseEntity, Address, ContactInfo } from '@/shared/types';\n\nexport interface Customer extends BaseEntity {\n  displayName: string;\n  companyName?: string;\n  email?: string;\n  phone?: string;\n  gst?: string;\n  pan?: string;\n  billingAddress?: Address;\n  shippingAddress?: Address;\n  contactInfo?: ContactInfo;\n  creditLimit?: number;\n  paymentTerms?: number;\n  notes?: string;\n  isActive: boolean;\n}\n\nexport interface CreateCustomerDto {\n  displayName: string;\n  companyName?: string;\n  email?: string;\n  phone?: string;\n  gst?: string;\n  pan?: string;\n  billingAddress?: Address;\n  shippingAddress?: Address;\n  creditLimit?: number;\n  paymentTerms?: number;\n  notes?: string;\n}\n\nexport interface UpdateCustomerDto extends Partial<CreateCustomerDto> {\n  isActive?: boolean;\n}\n\nexport interface CustomerFilters {\n  search?: string;\n  isActive?: boolean;\n}\n","path":null,"size_bytes":861,"size_tokens":null},"client/src/pages/delivery-challans.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { jsPDF } from \"jspdf\";\nimport { usePagination } from \"@/hooks/use-pagination\";\nimport { TablePagination } from \"@/components/table-pagination\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { \n    Plus, \n    Download, \n    Send, \n    MoreHorizontal, \n    Trash2, \n    Pencil,\n    MessageSquare,\n    HelpCircle,\n    Mail,\n    Printer,\n    Copy,\n    X,\n    Menu,\n    Search,\n    Filter,\n    ChevronDown,\n    FileText,\n    ArrowRight\n} from \"lucide-react\";\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuSeparator,\n    DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\n\ninterface ChallanListItem {\n    id: string;\n    challanNumber: string;\n    referenceNumber: string;\n    customerName: string;\n    customerId: string;\n    date: string;\n    amount: number;\n    status: string;\n    invoiceStatus: string;\n    challanType: string;\n}\n\ninterface ChallanDetail {\n    id: string;\n    challanNumber: string;\n    referenceNumber: string;\n    date: string;\n    customerId: string;\n    customerName: string;\n    challanType: string;\n    billingAddress: {\n        street: string;\n        city: string;\n        state: string;\n        country: string;\n        pincode: string;\n    };\n    shippingAddress: {\n        street: string;\n        city: string;\n        state: string;\n        country: string;\n        pincode: string;\n    };\n    placeOfSupply: string;\n    gstin: string;\n    items: any[];\n    subTotal: number;\n    cgst: number;\n    sgst: number;\n    igst: number;\n    adjustment: number;\n    total: number;\n    customerNotes: string;\n    termsAndConditions: string;\n    status: string;\n    invoiceStatus: string;\n    invoiceId: string | null;\n    createdAt: string;\n    activityLogs: any[];\n}\n\nconst formatCurrency = (amount: number) => {\n    return `${amount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n};\n\nconst formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-IN', { day: '2-digit', month: '2-digit', year: 'numeric' });\n};\n\nconst formatDateTime = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleString('en-IN', { \n        day: '2-digit', \n        month: '2-digit', \n        year: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit',\n        hour12: true\n    });\n};\n\nconst formatAddress = (address: any): string[] => {\n    if (!address) return ['-'];\n    if (typeof address === 'string') return [address];\n    if (typeof address !== 'object') return ['-'];\n    const parts = [\n        address.street ? String(address.street) : '',\n        address.city ? String(address.city) : '',\n        address.state ? String(address.state) : '',\n        address.country ? String(address.country) : '',\n        address.pincode ? String(address.pincode) : ''\n    ].filter(Boolean);\n    return parts.length > 0 ? parts : ['-'];\n};\n\nconst getChallanTypeLabel = (type: string) => {\n    switch (type) {\n        case 'supply_on_approval': return 'Supply on Approval';\n        case 'supply_for_job_work': return 'Supply for Job Work';\n        case 'supply_for_repair': return 'Supply for Repair';\n        case 'removal_for_own_use': return 'Removal for Own Use';\n        case 'others': return 'Others';\n        default: return type || 'Others';\n    }\n};\n\nconst getStatusColor = (status: string) => {\n    switch (status?.toUpperCase()) {\n        case 'OPEN':\n            return 'bg-blue-100 text-blue-700 border-blue-200';\n        case 'DELIVERED':\n            return 'bg-green-100 text-green-700 border-green-200';\n        case 'DRAFT':\n            return 'bg-slate-100 text-slate-600 border-slate-200';\n        case 'INVOICED':\n            return 'bg-purple-100 text-purple-700 border-purple-200';\n        default:\n            return 'bg-slate-100 text-slate-600 border-slate-200';\n    }\n};\n\nconst getActivityIcon = (action: string) => {\n    switch (action) {\n        case 'created':\n            return <div className=\"w-3 h-3 rounded-full bg-green-500\" />;\n        case 'sent':\n            return <div className=\"w-3 h-3 rounded-full bg-blue-500\" />;\n        case 'converted':\n            return <div className=\"w-3 h-3 rounded-full bg-purple-500\" />;\n        case 'updated':\n            return <div className=\"w-3 h-3 rounded-full bg-yellow-500\" />;\n        default:\n            return <div className=\"w-3 h-3 rounded-full bg-slate-400\" />;\n    }\n};\n\nexport default function DeliveryChallans() {\n    const [, setLocation] = useLocation();\n    const { toast } = useToast();\n    const [challans, setChallans] = useState<ChallanListItem[]>([]);\n    const [selectedChallan, setSelectedChallan] = useState<ChallanDetail | null>(null);\n    const [selectedChallans, setSelectedChallans] = useState<string[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [searchTerm, setSearchTerm] = useState(\"\");\n    const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n    const [challanToDelete, setChallanToDelete] = useState<string | null>(null);\n    const [activeTab, setActiveTab] = useState(\"whats-next\");\n\n    useEffect(() => {\n        fetchChallans();\n    }, []);\n\n    const fetchChallans = async () => {\n        try {\n            const response = await fetch('/api/delivery-challans');\n            if (response.ok) {\n                const data = await response.json();\n                setChallans(data.data || []);\n            }\n        } catch (error) {\n            console.error('Failed to fetch delivery challans:', error);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const fetchChallanDetail = async (id: string) => {\n        try {\n            const response = await fetch(`/api/delivery-challans/${id}`);\n            if (response.ok) {\n                const data = await response.json();\n                setSelectedChallan(data.data);\n            }\n        } catch (error) {\n            console.error('Failed to fetch challan detail:', error);\n        }\n    };\n\n    const handleSelectChallan = (challan: ChallanListItem) => {\n        fetchChallanDetail(challan.id);\n    };\n\n    const handleCloseDetail = () => {\n        setSelectedChallan(null);\n    };\n\n    const handleDeleteChallan = async () => {\n        if (!challanToDelete) return;\n\n        try {\n            const response = await fetch(`/api/delivery-challans/${challanToDelete}`, {\n                method: 'DELETE'\n            });\n\n            if (response.ok) {\n                toast({\n                    title: \"Delivery Challan Deleted\",\n                    description: \"The delivery challan has been deleted successfully.\",\n                });\n                fetchChallans();\n                if (selectedChallan?.id === challanToDelete) {\n                    setSelectedChallan(null);\n                }\n            } else {\n                throw new Error('Failed to delete');\n            }\n        } catch (error) {\n            toast({\n                title: \"Error\",\n                description: \"Failed to delete delivery challan. Please try again.\",\n                variant: \"destructive\"\n            });\n        } finally {\n            setDeleteDialogOpen(false);\n            setChallanToDelete(null);\n        }\n    };\n\n    const handleConvertToInvoice = async (challanId: string) => {\n        try {\n            const response = await fetch(`/api/delivery-challans/${challanId}/convert-to-invoice`, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' }\n            });\n\n            if (response.ok) {\n                const data = await response.json();\n                toast({\n                    title: \"Converted to Invoice\",\n                    description: `Invoice ${data.data.invoice.invoiceNumber} has been created.`,\n                });\n                fetchChallans();\n                if (selectedChallan?.id === challanId) {\n                    fetchChallanDetail(challanId);\n                }\n            } else {\n                throw new Error('Failed to convert');\n            }\n        } catch (error) {\n            toast({\n                title: \"Error\",\n                description: \"Failed to convert to invoice. Please try again.\",\n                variant: \"destructive\"\n            });\n        }\n    };\n\n    const handleStatusChange = async (challanId: string, newStatus: string) => {\n        try {\n            const response = await fetch(`/api/delivery-challans/${challanId}/status`, {\n                method: 'PATCH',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ status: newStatus })\n            });\n\n            if (response.ok) {\n                toast({\n                    title: \"Status Updated\",\n                    description: `Delivery challan status changed to ${newStatus}.`,\n                });\n                fetchChallans();\n                if (selectedChallan?.id === challanId) {\n                    fetchChallanDetail(challanId);\n                }\n            } else {\n                throw new Error('Failed to update status');\n            }\n        } catch (error) {\n            toast({\n                title: \"Error\",\n                description: \"Failed to update status. Please try again.\",\n                variant: \"destructive\"\n            });\n        }\n    };\n\n    const handleCloneChallan = async (challanId: string) => {\n        try {\n            const response = await fetch(`/api/delivery-challans/${challanId}/clone`, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' }\n            });\n\n            if (response.ok) {\n                const data = await response.json();\n                toast({\n                    title: \"Challan Cloned\",\n                    description: `New challan ${data.data.challanNumber} has been created.`,\n                });\n                fetchChallans();\n            } else {\n                throw new Error('Failed to clone');\n            }\n        } catch (error) {\n            toast({\n                title: \"Error\",\n                description: \"Failed to clone delivery challan. Please try again.\",\n                variant: \"destructive\"\n            });\n        }\n    };\n\n    const handleGeneratePDF = () => {\n        if (!selectedChallan) return;\n\n        const doc = new jsPDF();\n        doc.setFontSize(20);\n        doc.text('DELIVERY CHALLAN', 140, 20);\n        doc.setFontSize(12);\n        doc.text(`Delivery Challan# ${selectedChallan.challanNumber}`, 140, 30);\n        doc.text(`Date: ${formatDate(selectedChallan.date)}`, 140, 40);\n        doc.text(`Challan Type: ${getChallanTypeLabel(selectedChallan.challanType)}`, 140, 50);\n\n        doc.setFontSize(10);\n        doc.text('Deliver To:', 20, 70);\n        doc.text(selectedChallan.customerName, 20, 80);\n        const addressLines = formatAddress(selectedChallan.shippingAddress);\n        addressLines.forEach((line, i) => {\n            doc.text(line, 20, 90 + (i * 7));\n        });\n\n        let yPos = 130;\n        doc.setFontSize(10);\n        doc.text('#', 20, yPos);\n        doc.text('Item & Description', 30, yPos);\n        doc.text('HSN/SAC', 100, yPos);\n        doc.text('Qty', 130, yPos);\n        doc.text('Rate', 150, yPos);\n        doc.text('Amount', 175, yPos);\n\n        yPos += 10;\n        selectedChallan.items.forEach((item, index) => {\n            doc.text(String(index + 1), 20, yPos);\n            doc.text(item.name || '', 30, yPos);\n            doc.text(item.hsnSac || '', 100, yPos);\n            doc.text(String(item.quantity), 130, yPos);\n            doc.text(formatCurrency(item.rate), 150, yPos);\n            doc.text(formatCurrency(item.amount), 175, yPos);\n            yPos += 10;\n        });\n\n        yPos += 10;\n        doc.text(`Sub Total: ${formatCurrency(selectedChallan.subTotal)}`, 150, yPos);\n        yPos += 7;\n        doc.text(`CGST: ${formatCurrency(selectedChallan.cgst)}`, 150, yPos);\n        yPos += 7;\n        doc.text(`SGST: ${formatCurrency(selectedChallan.sgst)}`, 150, yPos);\n        yPos += 10;\n        doc.setFontSize(12);\n        doc.text(`Total: ${formatCurrency(selectedChallan.total)}`, 150, yPos);\n\n        doc.save(`${selectedChallan.challanNumber}.pdf`);\n    };\n\n    const filteredChallans = challans.filter(challan =>\n        challan.challanNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        challan.customerName.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n\n    const { currentPage, totalPages, totalItems, itemsPerPage, paginatedItems, goToPage } = usePagination(filteredChallans, 10);\n\n    const toggleSelectAll = () => {\n        if (selectedChallans.length === filteredChallans.length) {\n            setSelectedChallans([]);\n        } else {\n            setSelectedChallans(filteredChallans.map(c => c.id));\n        }\n    };\n\n    const toggleSelectChallan = (id: string) => {\n        setSelectedChallans(prev =>\n            prev.includes(id) ? prev.filter(i => i !== id) : [...prev, id]\n        );\n    };\n\n    return (\n        <div className=\"flex h-full\">\n            <div className={`flex-1 flex flex-col transition-all duration-300 ${selectedChallan ? 'w-1/2' : 'w-full'}`}>\n                <div className=\"flex items-center justify-between gap-4 p-4 border-b border-border/60\">\n                    <div className=\"flex items-center gap-2\">\n                        <DropdownMenu>\n                            <DropdownMenuTrigger asChild>\n                                <Button variant=\"ghost\" className=\"text-lg font-semibold gap-1\" data-testid=\"dropdown-challan-filter\">\n                                    All Delivery Challans\n                                    <ChevronDown className=\"h-4 w-4\" />\n                                </Button>\n                            </DropdownMenuTrigger>\n                            <DropdownMenuContent align=\"start\">\n                                <DropdownMenuItem data-testid=\"filter-all\">All Delivery Challans</DropdownMenuItem>\n                                <DropdownMenuItem data-testid=\"filter-draft\">Draft</DropdownMenuItem>\n                                <DropdownMenuItem data-testid=\"filter-open\">Open</DropdownMenuItem>\n                                <DropdownMenuItem data-testid=\"filter-delivered\">Delivered</DropdownMenuItem>\n                                <DropdownMenuItem data-testid=\"filter-invoiced\">Invoiced</DropdownMenuItem>\n                            </DropdownMenuContent>\n                        </DropdownMenu>\n                    </div>\n\n                    <div className=\"flex items-center gap-2\">\n                        <Link href=\"/delivery-challans/new\">\n                            <Button className=\"gap-1\" data-testid=\"button-new-challan\">\n                                <Plus className=\"h-4 w-4\" />\n                                New\n                            </Button>\n                        </Link>\n                        <DropdownMenu>\n                            <DropdownMenuTrigger asChild>\n                                <Button variant=\"outline\" size=\"icon\" data-testid=\"button-more-options\">\n                                    <MoreHorizontal className=\"h-4 w-4\" />\n                                </Button>\n                            </DropdownMenuTrigger>\n                            <DropdownMenuContent align=\"end\">\n                                <DropdownMenuItem data-testid=\"menu-import\">Import Challans</DropdownMenuItem>\n                                <DropdownMenuItem data-testid=\"menu-export\">Export Challans</DropdownMenuItem>\n                                <DropdownMenuSeparator />\n                                <DropdownMenuItem data-testid=\"menu-preferences\">Preferences</DropdownMenuItem>\n                            </DropdownMenuContent>\n                        </DropdownMenu>\n                    </div>\n                </div>\n\n                <div className=\"flex items-center gap-2 px-4 py-2 border-b border-border/40\">\n                    <div className=\"relative flex-1 max-w-sm\">\n                        <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n                        <Input\n                            placeholder=\"Search challans...\"\n                            value={searchTerm}\n                            onChange={(e) => setSearchTerm(e.target.value)}\n                            className=\"pl-8 h-9\"\n                            data-testid=\"input-search-challans\"\n                        />\n                    </div>\n                    <Button variant=\"outline\" size=\"sm\" className=\"gap-1\" data-testid=\"button-filter\">\n                        <Filter className=\"h-4 w-4\" />\n                        Filters\n                    </Button>\n                </div>\n\n                <div className=\"flex-1 overflow-hidden\">\n                    <ScrollArea className=\"h-full\">\n                        <table className=\"w-full\">\n                            <thead className=\"bg-muted/30 sticky top-0\">\n                                <tr className=\"text-left text-xs uppercase text-muted-foreground\">\n                                    <th className=\"p-3 w-10\">\n                                        <Checkbox\n                                            checked={selectedChallans.length === filteredChallans.length && filteredChallans.length > 0}\n                                            onCheckedChange={toggleSelectAll}\n                                            data-testid=\"checkbox-select-all\"\n                                        />\n                                    </th>\n                                    <th className=\"p-3\">Date</th>\n                                    <th className=\"p-3\">Delivery Challan#</th>\n                                    <th className=\"p-3\">Reference Number</th>\n                                    <th className=\"p-3\">Customer Name</th>\n                                    <th className=\"p-3\">Status</th>\n                                    <th className=\"p-3\">Invoice Status</th>\n                                    <th className=\"p-3 text-right\">Amount</th>\n                                    <th className=\"p-3 w-10\"></th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                {loading ? (\n                                    <tr>\n                                        <td colSpan={9} className=\"p-8 text-center text-muted-foreground\">\n                                            Loading...\n                                        </td>\n                                    </tr>\n                                ) : filteredChallans.length === 0 ? (\n                                    <tr>\n                                        <td colSpan={9} className=\"p-8 text-center text-muted-foreground\">\n                                            No delivery challans found\n                                        </td>\n                                    </tr>\n                                ) : (\n                                    paginatedItems.map((challan) => (\n                                        <tr\n                                            key={challan.id}\n                                            className={`border-b border-border/40 hover-elevate cursor-pointer ${selectedChallan?.id === challan.id ? 'bg-primary/5' : ''}`}\n                                            onClick={() => handleSelectChallan(challan)}\n                                            data-testid={`row-challan-${challan.id}`}\n                                        >\n                                            <td className=\"p-3\" onClick={(e) => e.stopPropagation()}>\n                                                <Checkbox\n                                                    checked={selectedChallans.includes(challan.id)}\n                                                    onCheckedChange={() => toggleSelectChallan(challan.id)}\n                                                    data-testid={`checkbox-challan-${challan.id}`}\n                                                />\n                                            </td>\n                                            <td className=\"p-3 text-sm\">{formatDate(challan.date)}</td>\n                                            <td className=\"p-3\">\n                                                <span className=\"text-primary font-medium text-sm\" data-testid={`text-challan-number-${challan.id}`}>\n                                                    {challan.challanNumber}\n                                                </span>\n                                            </td>\n                                            <td className=\"p-3 text-sm text-muted-foreground\">\n                                                {challan.referenceNumber || '-'}\n                                            </td>\n                                            <td className=\"p-3 text-sm font-medium\">{challan.customerName}</td>\n                                            <td className=\"p-3\">\n                                                <Badge \n                                                    variant=\"outline\" \n                                                    className={`text-xs ${getStatusColor(challan.status)}`}\n                                                    data-testid={`badge-status-${challan.id}`}\n                                                >\n                                                    {challan.status}\n                                                </Badge>\n                                            </td>\n                                            <td className=\"p-3\">\n                                                {challan.invoiceStatus && (\n                                                    <Badge \n                                                        variant=\"outline\" \n                                                        className={`text-xs ${getStatusColor(challan.invoiceStatus)}`}\n                                                    >\n                                                        {challan.invoiceStatus}\n                                                    </Badge>\n                                                )}\n                                            </td>\n                                            <td className=\"p-3 text-right text-sm font-medium\">\n                                                {formatCurrency(challan.amount)}\n                                            </td>\n                                            <td className=\"p-3\" onClick={(e) => e.stopPropagation()}>\n                                                <DropdownMenu>\n                                                    <DropdownMenuTrigger asChild>\n                                                        <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" data-testid={`button-actions-${challan.id}`}>\n                                                            <MoreHorizontal className=\"h-4 w-4\" />\n                                                        </Button>\n                                                    </DropdownMenuTrigger>\n                                                    <DropdownMenuContent align=\"end\">\n                                                        <DropdownMenuItem onClick={() => setLocation(`/delivery-challans/${challan.id}/edit`)} data-testid={`action-edit-${challan.id}`}>\n                                                            <Pencil className=\"h-4 w-4 mr-2\" />\n                                                            Edit\n                                                        </DropdownMenuItem>\n                                                        <DropdownMenuItem onClick={() => handleConvertToInvoice(challan.id)} data-testid={`action-convert-${challan.id}`}>\n                                                            <ArrowRight className=\"h-4 w-4 mr-2\" />\n                                                            Convert to Invoice\n                                                        </DropdownMenuItem>\n                                                        <DropdownMenuSeparator />\n                                                        <DropdownMenuItem \n                                                            className=\"text-destructive\"\n                                                            onClick={() => {\n                                                                setChallanToDelete(challan.id);\n                                                                setDeleteDialogOpen(true);\n                                                            }}\n                                                            data-testid={`action-delete-${challan.id}`}\n                                                        >\n                                                            <Trash2 className=\"h-4 w-4 mr-2\" />\n                                                            Delete\n                                                        </DropdownMenuItem>\n                                                    </DropdownMenuContent>\n                                                </DropdownMenu>\n                                            </td>\n                                        </tr>\n                                    ))\n                                )}\n                            </tbody>\n                        </table>\n                        <TablePagination\n                            currentPage={currentPage}\n                            totalPages={totalPages}\n                            totalItems={totalItems}\n                            itemsPerPage={itemsPerPage}\n                            onPageChange={goToPage}\n                        />\n                    </ScrollArea>\n                </div>\n            </div>\n\n            {selectedChallan && (\n                <div className=\"w-1/2 border-l border-border/60 flex flex-col bg-background\">\n                    <div className=\"flex items-center justify-between gap-2 p-3 border-b border-border/60\">\n                        <h2 className=\"font-semibold text-lg\" data-testid=\"text-selected-challan-number\">\n                            {selectedChallan.challanNumber}\n                        </h2>\n                        <div className=\"flex items-center gap-1\">\n                            <Button variant=\"ghost\" size=\"icon\" onClick={() => setLocation(`/delivery-challans/${selectedChallan.id}/edit`)} data-testid=\"button-edit-detail\">\n                                <Pencil className=\"h-4 w-4\" />\n                            </Button>\n                            <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-comment\">\n                                <MessageSquare className=\"h-4 w-4\" />\n                            </Button>\n                            <Button variant=\"ghost\" size=\"icon\" onClick={handleCloseDetail} data-testid=\"button-close-detail\">\n                                <X className=\"h-4 w-4\" />\n                            </Button>\n                        </div>\n                    </div>\n\n                    <div className=\"flex items-center gap-2 p-3 border-b border-border/60\">\n                        <Button variant=\"outline\" size=\"sm\" className=\"gap-1\" onClick={() => setLocation(`/delivery-challans/${selectedChallan.id}/edit`)} data-testid=\"button-edit-challan\">\n                            <Pencil className=\"h-4 w-4\" />\n                            Edit\n                        </Button>\n                        <DropdownMenu>\n                            <DropdownMenuTrigger asChild>\n                                <Button variant=\"outline\" size=\"sm\" className=\"gap-1\" data-testid=\"button-pdf-print\">\n                                    <FileText className=\"h-4 w-4\" />\n                                    PDF/Print\n                                    <ChevronDown className=\"h-3 w-3\" />\n                                </Button>\n                            </DropdownMenuTrigger>\n                            <DropdownMenuContent>\n                                <DropdownMenuItem onClick={handleGeneratePDF} data-testid=\"action-download-pdf\">\n                                    <Download className=\"h-4 w-4 mr-2\" />\n                                    Download PDF\n                                </DropdownMenuItem>\n                                <DropdownMenuItem data-testid=\"action-print\">\n                                    <Printer className=\"h-4 w-4 mr-2\" />\n                                    Print\n                                </DropdownMenuItem>\n                            </DropdownMenuContent>\n                        </DropdownMenu>\n                        {!selectedChallan.invoiceStatus && (\n                            <Button \n                                variant=\"outline\" \n                                size=\"sm\" \n                                className=\"gap-1\"\n                                onClick={() => handleConvertToInvoice(selectedChallan.id)}\n                                data-testid=\"button-convert-to-invoice\"\n                            >\n                                <ArrowRight className=\"h-4 w-4\" />\n                                Convert to Invoice\n                            </Button>\n                        )}\n                        <DropdownMenu>\n                            <DropdownMenuTrigger asChild>\n                                <Button variant=\"outline\" size=\"sm\" data-testid=\"button-more-actions\">\n                                    <MoreHorizontal className=\"h-4 w-4\" />\n                                </Button>\n                            </DropdownMenuTrigger>\n                            <DropdownMenuContent align=\"end\">\n                                {!selectedChallan.invoiceId && (\n                                    <DropdownMenuItem \n                                        onClick={() => handleConvertToInvoice(selectedChallan.id)}\n                                        className=\"text-primary font-medium\"\n                                        data-testid=\"action-convert-invoice\"\n                                    >\n                                        Convert to Invoice\n                                    </DropdownMenuItem>\n                                )}\n                                {selectedChallan.status === 'DELIVERED' && (\n                                    <DropdownMenuItem \n                                        onClick={() => handleStatusChange(selectedChallan.id, 'OPEN')}\n                                        data-testid=\"action-revert-open\"\n                                    >\n                                        Revert to Open\n                                    </DropdownMenuItem>\n                                )}\n                                {selectedChallan.status === 'OPEN' && (\n                                    <DropdownMenuItem \n                                        onClick={() => handleStatusChange(selectedChallan.id, 'DELIVERED')}\n                                        data-testid=\"action-mark-delivered\"\n                                    >\n                                        Mark as Delivered\n                                    </DropdownMenuItem>\n                                )}\n                                {selectedChallan.status === 'DRAFT' && (\n                                    <DropdownMenuItem \n                                        onClick={() => handleStatusChange(selectedChallan.id, 'OPEN')}\n                                        data-testid=\"action-mark-open\"\n                                    >\n                                        Mark as Open\n                                    </DropdownMenuItem>\n                                )}\n                                <DropdownMenuItem data-testid=\"action-eway-bill\">\n                                    Add e-Way Bill Details\n                                </DropdownMenuItem>\n                                <DropdownMenuItem \n                                    onClick={() => handleCloneChallan(selectedChallan.id)}\n                                    data-testid=\"action-clone\"\n                                >\n                                    <Copy className=\"h-4 w-4 mr-2\" />\n                                    Clone\n                                </DropdownMenuItem>\n                                <DropdownMenuSeparator />\n                                <DropdownMenuItem \n                                    className=\"text-destructive\"\n                                    onClick={() => {\n                                        setChallanToDelete(selectedChallan.id);\n                                        setDeleteDialogOpen(true);\n                                    }}\n                                    data-testid=\"action-delete-selected\"\n                                >\n                                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                                    Delete\n                                </DropdownMenuItem>\n                            </DropdownMenuContent>\n                        </DropdownMenu>\n                    </div>\n\n                    <ScrollArea className=\"flex-1\">\n                        <div className=\"p-6\">\n                            <div className=\"bg-white dark:bg-slate-900 border border-border/60 rounded-lg shadow-sm\">\n                                <div className=\"p-6 border-b border-border/40 relative\">\n                                    {selectedChallan.status === 'DRAFT' && (\n                                        <div className=\"absolute top-4 left-4 transform -rotate-12\">\n                                            <span className=\"text-4xl font-bold text-slate-200 dark:text-slate-700 uppercase tracking-wider\">\n                                                Draft\n                                            </span>\n                                        </div>\n                                    )}\n                                    <div className=\"flex justify-between items-start\">\n                                        <div>\n                                            <h3 className=\"text-xl font-bold text-primary mb-2\">Your Company Name</h3>\n                                            <div className=\"text-sm text-muted-foreground space-y-0.5\">\n                                                <p>Your Address Line 1</p>\n                                                <p>City, State, PIN</p>\n                                                <p>India</p>\n                                                <p className=\"mt-2\">GSTIN: YOUR_GSTIN_NUMBER</p>\n                                            </div>\n                                        </div>\n                                        <div className=\"text-right\">\n                                            <h2 className=\"text-2xl font-bold text-foreground mb-2\">DELIVERY CHALLAN</h2>\n                                            <p className=\"text-sm font-medium\">Delivery Challan# {selectedChallan.challanNumber}</p>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div className=\"p-6 border-b border-border/40\">\n                                    <div className=\"grid grid-cols-2 gap-8\">\n                                        <div>\n                                            <h4 className=\"text-xs uppercase tracking-wider text-muted-foreground mb-2\">Deliver To</h4>\n                                            <p className=\"font-semibold text-primary\">{selectedChallan.customerName}</p>\n                                            <div className=\"text-sm text-muted-foreground mt-1 space-y-0.5\">\n                                                {formatAddress(selectedChallan.shippingAddress).map((line, i) => (\n                                                    <p key={i}>{line}</p>\n                                                ))}\n                                                {selectedChallan.gstin && <p className=\"mt-2\">GSTIN: {selectedChallan.gstin}</p>}\n                                            </div>\n                                        </div>\n                                        <div className=\"text-right space-y-2\">\n                                            <div>\n                                                <span className=\"text-xs text-muted-foreground\">Challan Date:</span>\n                                                <span className=\"ml-2 text-sm\">{formatDate(selectedChallan.date)}</span>\n                                            </div>\n                                            <div>\n                                                <span className=\"text-xs text-muted-foreground\">Challan Type:</span>\n                                                <span className=\"ml-2 text-sm\">{getChallanTypeLabel(selectedChallan.challanType)}</span>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    {selectedChallan.placeOfSupply && (\n                                        <div className=\"mt-4 pt-4 border-t border-border/40\">\n                                            <span className=\"text-xs text-muted-foreground\">Place Of Supply:</span>\n                                            <span className=\"ml-2 text-sm\">{selectedChallan.placeOfSupply}</span>\n                                        </div>\n                                    )}\n                                </div>\n\n                                <div className=\"p-6\">\n                                    <table className=\"w-full text-sm\">\n                                        <thead>\n                                            <tr className=\"bg-primary text-primary-foreground\">\n                                                <th className=\"p-2 text-left\">#</th>\n                                                <th className=\"p-2 text-left\">Item & Description</th>\n                                                <th className=\"p-2 text-center\">HSN/SAC</th>\n                                                <th className=\"p-2 text-center\">Qty</th>\n                                                <th className=\"p-2 text-right\">Rate</th>\n                                                <th className=\"p-2 text-right\">Amount</th>\n                                            </tr>\n                                        </thead>\n                                        <tbody>\n                                            {selectedChallan.items.map((item, index) => (\n                                                <tr key={item.id} className=\"border-b border-border/40\">\n                                                    <td className=\"p-2\">{index + 1}</td>\n                                                    <td className=\"p-2\">\n                                                        <div className=\"font-medium\">{item.name}</div>\n                                                        {item.description && (\n                                                            <div className=\"text-xs text-muted-foreground\">{item.description}</div>\n                                                        )}\n                                                    </td>\n                                                    <td className=\"p-2 text-center\">{item.hsnSac || '-'}</td>\n                                                    <td className=\"p-2 text-center\">{item.quantity}</td>\n                                                    <td className=\"p-2 text-right\">{formatCurrency(item.rate)}</td>\n                                                    <td className=\"p-2 text-right\">{formatCurrency(item.amount)}</td>\n                                                </tr>\n                                            ))}\n                                        </tbody>\n                                    </table>\n\n                                    <div className=\"mt-4 flex justify-end\">\n                                        <div className=\"w-64 space-y-2 text-sm\">\n                                            <div className=\"flex justify-between\">\n                                                <span>Sub Total</span>\n                                                <span>{formatCurrency(selectedChallan.subTotal)}</span>\n                                            </div>\n                                            {selectedChallan.cgst > 0 && (\n                                                <div className=\"flex justify-between text-muted-foreground\">\n                                                    <span>CGST (9%)</span>\n                                                    <span>{formatCurrency(selectedChallan.cgst)}</span>\n                                                </div>\n                                            )}\n                                            {selectedChallan.sgst > 0 && (\n                                                <div className=\"flex justify-between text-muted-foreground\">\n                                                    <span>SGST (9%)</span>\n                                                    <span>{formatCurrency(selectedChallan.sgst)}</span>\n                                                </div>\n                                            )}\n                                            <div className=\"flex justify-between font-bold bg-primary/10 p-2 rounded\">\n                                                <span>Total</span>\n                                                <span>{formatCurrency(selectedChallan.total)}</span>\n                                            </div>\n                                        </div>\n                                    </div>\n\n                                    <div className=\"mt-8 pt-8 border-t border-border/40\">\n                                        <p className=\"text-sm\">Authorized Signature ____________________</p>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div className=\"px-6 pb-6\">\n                            <Tabs value={activeTab} onValueChange={setActiveTab}>\n                                <TabsList className=\"w-full justify-start\">\n                                    <TabsTrigger value=\"whats-next\" data-testid=\"tab-whats-next\">What's Next</TabsTrigger>\n                                    <TabsTrigger value=\"activity\" data-testid=\"tab-activity\">Activity</TabsTrigger>\n                                </TabsList>\n                                <TabsContent value=\"whats-next\" className=\"mt-4\">\n                                    <div className=\"space-y-3\">\n                                        <Button variant=\"outline\" className=\"w-full justify-start gap-2\" data-testid=\"button-send-email\">\n                                            <Send className=\"h-4 w-4\" />\n                                            Send Delivery Challan via Email\n                                        </Button>\n                                        {!selectedChallan.invoiceStatus && (\n                                            <Button \n                                                variant=\"outline\" \n                                                className=\"w-full justify-start gap-2\"\n                                                onClick={() => handleConvertToInvoice(selectedChallan.id)}\n                                                data-testid=\"button-create-invoice\"\n                                            >\n                                                <FileText className=\"h-4 w-4\" />\n                                                Create Invoice from Challan\n                                            </Button>\n                                        )}\n                                    </div>\n                                </TabsContent>\n                                <TabsContent value=\"activity\" className=\"mt-4\">\n                                    <div className=\"space-y-4\">\n                                        {selectedChallan.activityLogs?.map((log) => (\n                                            <div key={log.id} className=\"flex gap-3\">\n                                                <div className=\"mt-1.5\">{getActivityIcon(log.action)}</div>\n                                                <div className=\"flex-1\">\n                                                    <p className=\"text-sm\">{log.description}</p>\n                                                    <p className=\"text-xs text-muted-foreground\">\n                                                        {formatDateTime(log.timestamp)} by {log.user}\n                                                    </p>\n                                                </div>\n                                            </div>\n                                        ))}\n                                    </div>\n                                </TabsContent>\n                            </Tabs>\n                        </div>\n                    </ScrollArea>\n                </div>\n            )}\n\n            <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>Delete Delivery Challan</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            Are you sure you want to delete this delivery challan? This action cannot be undone.\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel data-testid=\"button-cancel-delete\">Cancel</AlertDialogCancel>\n                        <AlertDialogAction onClick={handleDeleteChallan} className=\"bg-destructive text-destructive-foreground\" data-testid=\"button-confirm-delete\">\n                            Delete\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </div>\n    );\n}\n","path":null,"size_bytes":46979,"size_tokens":null},"client/src/components/ui/empty.tsx":{"content":"import { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Empty({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty\"\n      className={cn(\n        \"flex min-w-0 flex-1 flex-col items-center justify-center gap-6 text-balance rounded-lg border-dashed p-6 text-center md:p-12\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-header\"\n      className={cn(\n        \"flex max-w-sm flex-col items-center gap-2 text-center\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst emptyMediaVariants = cva(\n  \"mb-2 flex shrink-0 items-center justify-center [&_svg]:pointer-events-none [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted text-foreground flex size-10 shrink-0 items-center justify-center rounded-lg [&_svg:not([class*='size-'])]:size-6\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction EmptyMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof emptyMediaVariants>) {\n  return (\n    <div\n      data-slot=\"empty-icon\"\n      data-variant={variant}\n      className={cn(emptyMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-title\"\n      className={cn(\"text-lg font-medium tracking-tight\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <div\n      data-slot=\"empty-description\"\n      className={cn(\n        \"text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-content\"\n      className={cn(\n        \"flex w-full min-w-0 max-w-sm flex-col items-center gap-4 text-balance text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Empty,\n  EmptyHeader,\n  EmptyTitle,\n  EmptyDescription,\n  EmptyContent,\n  EmptyMedia,\n}\n","path":null,"size_bytes":2396,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"server/src/modules/sales/routes/index.ts":{"content":"import { Router } from 'express';\nimport { readFileSync, writeFileSync, existsSync } from 'fs';\nimport { join } from 'path';\n\nexport const salesRouter = Router();\n\nconst quotesFilePath = join(process.cwd(), 'Billing-9-12-230/server/data/quotes.json');\n\nfunction readQuotesData() {\n  if (!existsSync(quotesFilePath)) {\n    return { quotes: [], nextQuoteNumber: 1 };\n  }\n  const data = readFileSync(quotesFilePath, 'utf-8');\n  return JSON.parse(data);\n}\n\nfunction writeQuotesData(data: any) {\n  writeFileSync(quotesFilePath, JSON.stringify(data, null, 2));\n}\n\nfunction generateQuoteNumber(num: number): string {\n  return `QT-${String(num).padStart(6, '0')}`;\n}\n\nsalesRouter.get('/quotes', (req, res) => {\n  try {\n    const data = readQuotesData();\n    const quotes = data.quotes.map((quote: any) => ({\n      id: quote.id,\n      date: quote.date,\n      quoteNumber: quote.quoteNumber,\n      referenceNumber: quote.referenceNumber,\n      customerName: quote.customerName,\n      status: quote.status,\n      total: quote.total\n    }));\n    res.json({ success: true, data: quotes });\n  } catch (error) {\n    console.error('Error reading quotes:', error);\n    res.status(500).json({ success: false, message: 'Failed to fetch quotes' });\n  }\n});\n\nsalesRouter.get('/quotes/:id', (req, res) => {\n  try {\n    const data = readQuotesData();\n    const quote = data.quotes.find((q: any) => q.id === req.params.id);\n    if (!quote) {\n      return res.status(404).json({ success: false, message: 'Quote not found' });\n    }\n    res.json({ success: true, data: quote });\n  } catch (error) {\n    console.error('Error reading quote:', error);\n    res.status(500).json({ success: false, message: 'Failed to fetch quote' });\n  }\n});\n\nsalesRouter.post('/quotes', (req, res) => {\n  try {\n    const data = readQuotesData();\n    const quoteNumber = generateQuoteNumber(data.nextQuoteNumber);\n    const now = new Date().toISOString();\n\n    const newQuote = {\n      id: String(Date.now()),\n      quoteNumber,\n      referenceNumber: req.body.referenceNumber || '',\n      date: req.body.date || new Date().toISOString().split('T')[0],\n      expiryDate: req.body.expiryDate || '',\n      customerId: req.body.customerId || '',\n      customerName: req.body.customerName || '',\n      billingAddress: req.body.billingAddress || { street: '', city: '', state: '', country: 'India', pincode: '' },\n      shippingAddress: req.body.shippingAddress || { street: '', city: '', state: '', country: 'India', pincode: '' },\n      salesperson: req.body.salesperson || '',\n      projectName: req.body.projectName || '',\n      subject: req.body.subject || '',\n      placeOfSupply: req.body.placeOfSupply || '',\n      pdfTemplate: req.body.pdfTemplate || 'Standard Template',\n      items: req.body.items || [],\n      subTotal: req.body.subTotal || 0,\n      shippingCharges: req.body.shippingCharges || 0,\n      tdsType: req.body.tdsType || '',\n      tdsAmount: req.body.tdsAmount || 0,\n      cgst: req.body.cgst || 0,\n      sgst: req.body.sgst || 0,\n      igst: req.body.igst || 0,\n      adjustment: req.body.adjustment || 0,\n      total: req.body.total || 0,\n      customerNotes: req.body.customerNotes || 'Looking forward for your business.',\n      termsAndConditions: req.body.termsAndConditions || '',\n      status: req.body.status || 'DRAFT',\n      emailRecipients: req.body.emailRecipients || [],\n      createdAt: now,\n      updatedAt: now,\n      createdBy: req.body.createdBy || 'Admin User',\n      activityLogs: [\n        {\n          id: '1',\n          timestamp: now,\n          action: 'created',\n          description: `Quote created for ${req.body.total?.toLocaleString('en-IN') || '0.00'}`,\n          user: req.body.createdBy || 'Admin User'\n        }\n      ]\n    };\n\n    data.quotes.unshift(newQuote);\n    data.nextQuoteNumber += 1;\n    writeQuotesData(data);\n\n    res.status(201).json({ success: true, data: newQuote });\n  } catch (error) {\n    console.error('Error creating quote:', error);\n    res.status(500).json({ success: false, message: 'Failed to create quote' });\n  }\n});\n\nsalesRouter.put('/quotes/:id', (req, res) => {\n  try {\n    const data = readQuotesData();\n    const quoteIndex = data.quotes.findIndex((q: any) => q.id === req.params.id);\n\n    if (quoteIndex === -1) {\n      return res.status(404).json({ success: false, message: 'Quote not found' });\n    }\n\n    const now = new Date().toISOString();\n    const existingQuote = data.quotes[quoteIndex];\n\n    const updatedQuote = {\n      ...existingQuote,\n      ...req.body,\n      id: existingQuote.id,\n      quoteNumber: existingQuote.quoteNumber,\n      createdAt: existingQuote.createdAt,\n      updatedAt: now,\n      activityLogs: [\n        ...existingQuote.activityLogs,\n        {\n          id: String(existingQuote.activityLogs.length + 1),\n          timestamp: now,\n          action: 'updated',\n          description: 'Quote has been updated',\n          user: req.body.updatedBy || 'Admin User'\n        }\n      ]\n    };\n\n    data.quotes[quoteIndex] = updatedQuote;\n    writeQuotesData(data);\n\n    res.json({ success: true, data: updatedQuote });\n  } catch (error) {\n    console.error('Error updating quote:', error);\n    res.status(500).json({ success: false, message: 'Failed to update quote' });\n  }\n});\n\nsalesRouter.patch('/quotes/:id/status', (req, res) => {\n  try {\n    const data = readQuotesData();\n    const quoteIndex = data.quotes.findIndex((q: any) => q.id === req.params.id);\n\n    if (quoteIndex === -1) {\n      return res.status(404).json({ success: false, message: 'Quote not found' });\n    }\n\n    const now = new Date().toISOString();\n    const existingQuote = data.quotes[quoteIndex];\n    const newStatus = req.body.status;\n\n    let actionDescription = '';\n    switch (newStatus) {\n      case 'SENT':\n        actionDescription = 'Quote has been sent';\n        break;\n      case 'ACCEPTED':\n        actionDescription = 'Quote marked as accepted';\n        break;\n      case 'DECLINED':\n        actionDescription = 'Quote marked as declined';\n        break;\n      default:\n        actionDescription = `Quote status changed to ${newStatus}`;\n    }\n\n    existingQuote.status = newStatus;\n    existingQuote.updatedAt = now;\n    existingQuote.activityLogs.push({\n      id: String(existingQuote.activityLogs.length + 1),\n      timestamp: now,\n      action: newStatus.toLowerCase(),\n      description: actionDescription,\n      user: req.body.updatedBy || 'Admin User'\n    });\n\n    data.quotes[quoteIndex] = existingQuote;\n    writeQuotesData(data);\n\n    res.json({ success: true, data: existingQuote });\n  } catch (error) {\n    console.error('Error updating quote status:', error);\n    res.status(500).json({ success: false, message: 'Failed to update quote status' });\n  }\n});\n\nsalesRouter.delete('/quotes/:id', (req, res) => {\n  try {\n    const data = readQuotesData();\n    const quoteIndex = data.quotes.findIndex((q: any) => q.id === req.params.id);\n\n    if (quoteIndex === -1) {\n      return res.status(404).json({ success: false, message: 'Quote not found' });\n    }\n\n    data.quotes.splice(quoteIndex, 1);\n    writeQuotesData(data);\n\n    res.json({ success: true, message: 'Quote deleted successfully' });\n  } catch (error) {\n    console.error('Error deleting quote:', error);\n    res.status(500).json({ success: false, message: 'Failed to delete quote' });\n  }\n});\n\nsalesRouter.get('/quotes/next-number', (req, res) => {\n  try {\n    const data = readQuotesData();\n    const nextNumber = generateQuoteNumber(data.nextQuoteNumber);\n    res.json({ success: true, data: { quoteNumber: nextNumber } });\n  } catch (error) {\n    console.error('Error getting next quote number:', error);\n    res.status(500).json({ success: false, message: 'Failed to get next quote number' });\n  }\n});\n\nsalesRouter.get('/invoices', (req, res) => {\n  res.json({ success: true, data: [], message: 'Invoices endpoint' });\n});\n\nsalesRouter.get('/estimates', (req, res) => {\n  res.json({ success: true, data: [], message: 'Estimates endpoint' });\n});\n\nsalesRouter.get('/payments', (req, res) => {\n  res.json({ success: true, data: [], message: 'Payments endpoint' });\n});\n\nexport default salesRouter;\n","path":null,"size_bytes":8124,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1037,"size_tokens":null},"client/src/pages/invoice-create.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport {\n  Calendar as CalendarIcon,\n  ChevronDown,\n  Plus,\n  Trash2,\n  UploadCloud,\n  Save,\n  Send,\n  Clock,\n  Printer,\n  Share2,\n  X,\n  UserPlus,\n  HelpCircle,\n  Search,\n  Check,\n  Settings,\n  Edit3,\n  AlertCircle\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAppStore, type ContactPerson } from \"@/lib/store\";\nimport { useTransactionBootstrap } from \"@/hooks/use-transaction-bootstrap\";\nimport { calculateItemTax, formatAddressDisplay } from \"@/lib/customer-snapshot\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { addDays, endOfMonth, addMonths } from \"date-fns\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { format } from \"date-fns\";\nimport { cn } from \"@/lib/utils\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from \"@/components/ui/dialog\";\nimport { AdvancedDatePicker } from \"@/components/ui/advanced-date-picker\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { ManageSalespersonsDialog } from \"@/components/ManageSalespersonsDialog\";\n\ninterface InvoiceItem {\n  id: number;\n  name: string;\n  description: string;\n  qty: number;\n  rate: number;\n  discountType: 'percentage' | 'flat';\n  discountValue: number;\n  gstRate: number; // 0, 5, 12, 18, 28, -1 (Non-taxable)\n  productId?: string; // Track the selected product ID\n}\n\ninterface TaxOption {\n  label: string;\n  value: number;\n}\n\nconst DEFAULT_TAX_OPTIONS: TaxOption[] = [\n  { label: \"Non-taxable\", value: -1 },\n  { label: \"GST0 [0%]\", value: 0 },\n  { label: \"GST5 [5%]\", value: 5 },\n  { label: \"GST12 [12%]\", value: 12 },\n  { label: \"GST18 [18%]\", value: 18 },\n  { label: \"GST28 [28%]\", value: 28 },\n];\n\nconst TERMS_OPTIONS = [\n  { value: \"due_on_receipt\", label: \"Due on Receipt\", days: 0 },\n  { value: \"net15\", label: \"Net 15\", days: 15 },\n  { value: \"net30\", label: \"Net 30\", days: 30 },\n  { value: \"net45\", label: \"Net 45\", days: 45 },\n  { value: \"net60\", label: \"Net 60\", days: 60 },\n  { value: \"end_of_month\", label: \"Due end of the month\", days: -1 },\n  { value: \"end_of_next_month\", label: \"Due end of next month\", days: -2 },\n  { value: \"paid\", label: \"PAID\", days: -99 },\n];\n\ninterface Customer {\n  id: string;\n  name: string;\n  displayName: string;\n  companyName: string;\n  email: string;\n  workPhone: string;\n  billingAddress?: any;\n}\n\ninterface Product {\n  id: string;\n  name: string;\n  description: string;\n  rate: string;\n  hsnSac: string;\n  type: string;\n  taxPreference: string;\n  intraStateTax: string;\n  interStateTax: string;\n  usageUnit: string;\n  purchaseRate: string;\n  isActive: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport default function InvoiceCreate() {\n  const [location, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { addInvoice, invoices, contactPersons, addContactPerson, pendingCustomerId, setPendingCustomerId } = useAppStore();\n\n  // Transaction bootstrap for auto-population\n  const {\n    customerId: bootstrapCustomerId,\n    customerSnapshot,\n    taxRegime,\n    isLoadingCustomer,\n    customerError,\n    formData,\n    onCustomerChange\n  } = useTransactionBootstrap({ transactionType: 'invoice' });\n\n  const [customers, setCustomers] = useState<Customer[]>([]);\n  const [products, setProducts] = useState<Product[]>([]);\n  const [customersLoading, setCustomersLoading] = useState(true);\n  const [productsLoading, setProductsLoading] = useState(true);\n  const [customerIdFromUrl, setCustomerIdFromUrl] = useState<string | null>(null);\n  const [salesOrderId, setSalesOrderId] = useState<string | null>(null);\n  const [selectedItemIds, setSelectedItemIds] = useState<string[]>([]);\n  const [convertAll, setConvertAll] = useState(false);\n\n  const [date, setDate] = useState<Date>(new Date());\n  const [dueDate, setDueDate] = useState<Date>(new Date(new Date().setDate(new Date().getDate() + 30)));\n  const [hasShipping, setHasShipping] = useState(false);\n  const [shippingAmount, setShippingAmount] = useState(0);\n  const [paymentReceived, setPaymentReceived] = useState(false);\n  const [adjustment, setAdjustment] = useState(0);\n  const [selectedCustomerId, setSelectedCustomerId] = useState<string>(\"\");\n  const [shippingAddress, setShippingAddress] = useState<string>(\"\");\n\n  const [selectedTerms, setSelectedTerms] = useState<string>(\"net30\");\n  const [termsSearchQuery, setTermsSearchQuery] = useState(\"\");\n  const [isTermsOpen, setIsTermsOpen] = useState(false);\n  const [billingAddress, setBillingAddress] = useState<string>(\"\");\n  const [isEditingBillingAddress, setIsEditingBillingAddress] = useState(false);\n\n  // Sync with bootstrap customer\n  useEffect(() => {\n    if (bootstrapCustomerId && !selectedCustomerId) {\n      setSelectedCustomerId(bootstrapCustomerId);\n    }\n  }, [bootstrapCustomerId]);\n\n  // Update form data when customer snapshot changes\n  useEffect(() => {\n    if (customerSnapshot) {\n      setBillingAddress(formatAddressDisplay(customerSnapshot.billingAddress));\n      setShippingAddress(formatAddressDisplay(customerSnapshot.shippingAddress));\n\n      // Update payment terms if customer has default\n      if (customerSnapshot.paymentTerms) {\n        const termsMap: Record<string, string> = {\n          'Due on Receipt': 'due_on_receipt',\n          'Net 15': 'net15',\n          'Net 30': 'net30',\n          'Net 45': 'net45',\n          'Net 60': 'net60'\n        };\n        const termValue = termsMap[customerSnapshot.paymentTerms] || 'net30';\n        setSelectedTerms(termValue);\n      }\n    }\n  }, [customerSnapshot]);\n\n  useEffect(() => {\n    if (pendingCustomerId) {\n      setSelectedCustomerId(pendingCustomerId);\n      setPendingCustomerId(null);\n    }\n  }, [pendingCustomerId, setPendingCustomerId]);\n\n  useEffect(() => {\n    if (selectedCustomerId && !customerSnapshot) {\n      const customer = customers.find(c => c.id === selectedCustomerId);\n      if (customer) {\n        let addressStr = '';\n        if (customer.billingAddress) {\n          if (typeof customer.billingAddress === 'string') {\n            addressStr = customer.billingAddress;\n          } else {\n            const addr = customer.billingAddress;\n            const parts = [addr.street, addr.city, addr.state, addr.country, addr.pincode].filter(Boolean);\n            addressStr = parts.join('\\n');\n          }\n        }\n        const defaultAddress = addressStr ||\n          `${customer.companyName}\\n${customer.email}\\n${customer.workPhone}`;\n        setBillingAddress(defaultAddress);\n      }\n    }\n  }, [selectedCustomerId, customers, customerSnapshot]);\n\n  useEffect(() => {\n    const termsOption = TERMS_OPTIONS.find(t => t.value === selectedTerms);\n    if (termsOption) {\n      let newDueDate: Date;\n      if (termsOption.days === -99) {\n        newDueDate = date;\n      } else if (termsOption.days === -1) {\n        newDueDate = endOfMonth(date);\n      } else if (termsOption.days === -2) {\n        newDueDate = endOfMonth(addMonths(date, 1));\n      } else {\n        newDueDate = addDays(date, termsOption.days);\n      }\n      setDueDate(newDueDate);\n    }\n  }, [selectedTerms, date]);\n\n  useEffect(() => {\n    fetchSalespersons();\n    fetchCustomers();\n    fetchProducts();\n    // Handle clone parameter, customerId, and sales order conversion from URL\n    const params = new URLSearchParams(location.split('?')[1]);\n    const cloneFromId = params.get('cloneFrom');\n    const urlCustomerId = params.get('customerId');\n    const salesOrderIdParam = params.get('salesOrderId');\n    const convertAllParam = params.get('convertAll');\n    const selectedItemsParam = params.get('selectedItems');\n\n    if (cloneFromId) {\n      fetchInvoiceToClone(cloneFromId);\n    } else if (urlCustomerId) {\n      setCustomerIdFromUrl(urlCustomerId);\n    } else if (salesOrderIdParam) {\n      setSalesOrderId(salesOrderIdParam);\n      setConvertAll(convertAllParam === 'true');\n      if (selectedItemsParam) {\n        setSelectedItemIds(selectedItemsParam.split(','));\n      }\n      fetchSalesOrderForConversion(salesOrderIdParam);\n    }\n  }, [location]);\n\n  // Set customer from URL after customers are loaded\n  useEffect(() => {\n    if (customerIdFromUrl && customers.length > 0) {\n      const customer = customers.find(c => c.id === customerIdFromUrl);\n      if (customer) {\n        setSelectedCustomerId(customer.id);\n        setCustomerIdFromUrl(null);\n      }\n    }\n  }, [customerIdFromUrl, customers]);\n\n  const fetchCustomers = async () => {\n    try {\n      setCustomersLoading(true);\n      const response = await fetch('/api/customers');\n      if (response.ok) {\n        const data = await response.json();\n        setCustomers(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch customers:', error);\n    } finally {\n      setCustomersLoading(false);\n    }\n  };\n\n  const fetchProducts = async () => {\n    try {\n      setProductsLoading(true);\n      const response = await fetch('/api/items');\n      if (response.ok) {\n        const data = await response.json();\n        console.log('Fetched products data:', data);\n        const items = data.data || data.items || [];\n        console.log('Items array:', items);\n        // Filter only active items\n        const activeItems = items.filter((item: Product) => item.isActive !== false);\n        console.log('Active items:', activeItems);\n        setProducts(activeItems);\n      } else {\n        console.error('Failed to fetch products:', response.statusText, response.status);\n      }\n    } catch (error) {\n      console.error('Failed to fetch products:', error);\n    } finally {\n      setProductsLoading(false);\n    }\n  };\n\n  const fetchInvoiceToClone = async (invoiceId: string) => {\n    try {\n      const response = await fetch(`/api/invoices/${invoiceId}`);\n      if (response.ok) {\n        const data = await response.json();\n        const invoice = data.data;\n\n        // Pre-populate form with cloned invoice data\n        setSelectedCustomerId(invoice.customerId);\n        setDate(new Date());\n        setDueDate(new Date(new Date().setDate(new Date().getDate() + 30)));\n        setSelectedTerms(invoice.paymentTerms || 'net30');\n        setBillingAddress(invoice.billingAddress?.street || '');\n        setSelectedSalesperson(invoice.salesperson || '');\n        setHasShipping(invoice.shippingCharges > 0);\n        setShippingAmount(invoice.shippingCharges || 0);\n        setAdjustment(invoice.adjustment || 0);\n\n        // Pre-populate items\n        if (invoice.items && invoice.items.length > 0) {\n          const clonedItems = invoice.items.map((item: any, index: number) => ({\n            id: Math.random(),\n            name: item.name,\n            description: item.description || '',\n            qty: item.quantity,\n            rate: item.rate,\n            discountType: item.discountType || 'percentage',\n            discountValue: item.discount || 0,\n            gstRate: item.tax && item.tax > 0 ? (item.tax / (item.rate * item.quantity - (item.discount || 0))) * 100 : 18\n          }));\n          setItems(clonedItems);\n        }\n\n        toast({\n          title: \"Invoice Cloned\",\n          description: \"Invoice data has been pre-filled. Edit as needed and save.\",\n        });\n      }\n    } catch (error) {\n      console.error('Failed to fetch invoice for cloning:', error);\n      toast({\n        title: \"Clone Failed\",\n        description: \"Could not load invoice data for duplication.\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const fetchSalesOrderForConversion = async (salesOrderId: string) => {\n    try {\n      const response = await fetch(`/api/sales-orders/${salesOrderId}`);\n      if (response.ok) {\n        const data = await response.json();\n        const salesOrder = data.data;\n\n        // Pre-populate form with sales order data\n        setSelectedCustomerId(salesOrder.customerId);\n        setDate(new Date());\n        setDueDate(new Date(new Date().setDate(new Date().getDate() + 30)));\n        setSelectedTerms(salesOrder.paymentTerms || 'net30');\n        setBillingAddress(salesOrder.billingAddress?.street || '');\n        setShippingAddress(salesOrder.shippingAddress?.street || '');\n        setSelectedSalesperson(salesOrder.salesperson || '');\n\n        // Handle items - either all items or selected items\n        let itemsToConvert = salesOrder.items || [];\n\n        if (!convertAll && selectedItemIds.length > 0) {\n          // Filter to only selected items\n          itemsToConvert = salesOrder.items.filter((item: any) =>\n            selectedItemIds.includes(item.id)\n          );\n        }\n\n        if (itemsToConvert.length > 0) {\n          const convertedItems = itemsToConvert.map((item: any) => ({\n            id: Math.random(),\n            name: item.name,\n            description: item.description || '',\n            qty: item.quantity - (item.invoicedQty || 0), // Only uninvoiced quantity\n            rate: item.rate,\n            discountType: item.discountType || 'percentage',\n            discountValue: item.discount || 0,\n            gstRate: item.tax && item.tax > 0 ? (item.tax / (item.rate * item.quantity - (item.discount || 0))) * 100 : 18\n          })).filter(item => item.qty > 0); // Only include items with remaining quantity\n\n          setItems(convertedItems);\n        }\n\n        toast({\n          title: \"Sales Order Loaded\",\n          description: `Converting ${convertAll ? 'all' : 'selected'} items from sales order ${salesOrder.salesOrderNumber}`,\n        });\n      }\n    } catch (error) {\n      console.error('Failed to fetch sales order for conversion:', error);\n      toast({\n        title: \"Conversion Failed\",\n        description: \"Could not load sales order data for conversion.\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const fetchSalespersons = async () => {\n    try {\n      const response = await fetch('/api/salespersons');\n      if (response.ok) {\n        const data = await response.json();\n        setSalespersons(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch salespersons:', error);\n    }\n  };\n\n  const filteredTermsOptions = TERMS_OPTIONS.filter(opt =>\n    opt.label.toLowerCase().includes(termsSearchQuery.toLowerCase())\n  );\n\n  const getTermsLabel = () => {\n    const term = TERMS_OPTIONS.find(t => t.value === selectedTerms);\n    return term?.label || \"Select Terms\";\n  };\n\n  const handleTermsSelect = (value: string) => {\n    setSelectedTerms(value);\n    setIsTermsOpen(false);\n    setTermsSearchQuery(\"\");\n  };\n\n  const handleCustomerChange = (value: string) => {\n    if (value === \"add_new_customer\") {\n      setPendingCustomerId(null);\n      setLocation(\"/customers/new?returnTo=invoice\");\n    } else {\n      setSelectedCustomerId(value);\n      onCustomerChange(value);\n    }\n  };\n\n  // Custom Tax Modal State\n  const [isTaxModalOpen, setIsTaxModalOpen] = useState(false);\n  const [newTaxName, setNewTaxName] = useState(\"\");\n  const [newTaxRate, setNewTaxRate] = useState(\"\");\n  const [taxOptions, setTaxOptions] = useState<TaxOption[]>(DEFAULT_TAX_OPTIONS);\n\n  // Salesperson state\n  const [selectedSalesperson, setSelectedSalesperson] = useState<string>(\"\");\n  const [isAddPersonModalOpen, setIsAddPersonModalOpen] = useState(false);\n  const [showManageSalespersons, setShowManageSalespersons] = useState(false);\n  const [salespersons, setSalespersons] = useState<{ id: string; name: string }[]>([]);\n  const [newPersonFirstName, setNewPersonFirstName] = useState(\"\");\n  const [newPersonLastName, setNewPersonLastName] = useState(\"\");\n  const [newPersonEmail, setNewPersonEmail] = useState(\"\");\n  const [newPersonPhone, setNewPersonPhone] = useState(\"\");\n  const [newPersonCustomerId, setNewPersonCustomerId] = useState(\"\");\n\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [attachments, setAttachments] = useState<File[]>([]);\n\n  const getNextInvoiceNumber = () => {\n    const lastNumber = invoices.length > 0\n      ? parseInt(invoices[0].invoiceNumber.replace(\"INV-\", \"\"))\n      : 12;\n    return `INV-${String(lastNumber + 1).padStart(5, \"0\")}`;\n  };\n\n  const [invoiceNumber, setInvoiceNumber] = useState(getNextInvoiceNumber().replace(\"INV-\", \"\"));\n\n  const selectedCustomer = customers.find(c => c.id === selectedCustomerId);\n\n  const handleSaveInvoice = async (saveStatus: \"draft\" | \"pending\" = \"pending\") => {\n    const formattedDate = format(date, \"yyyy-MM-dd\");\n    const formattedDueDate = format(dueDate, \"yyyy-MM-dd\");\n\n    let finalStatus = saveStatus.toUpperCase();\n    if (saveStatus !== \"draft\") {\n      if (selectedTerms === \"paid\" || paymentReceived) {\n        finalStatus = \"PAID\";\n      } else {\n        finalStatus = \"PENDING\";\n      }\n    } else {\n      finalStatus = \"DRAFT\";\n    }\n\n    const invoiceItems = items.map(item => {\n      const lineCalc = calculateLineItem(item);\n      return {\n        id: String(item.id),\n        itemId: String(item.id),\n        name: item.name,\n        description: item.description,\n        quantity: item.qty,\n        unit: 'pcs',\n        rate: item.rate,\n        discount: lineCalc.discountAmount,\n        discountType: item.discountType,\n        tax: lineCalc.taxAmount,\n        taxName: item.gstRate > 0 ? `GST${item.gstRate}` : 'Non-taxable',\n        amount: lineCalc.total\n      };\n    });\n\n    // Calculate taxes based on tax regime (intra = CGST+SGST, inter = IGST, exempt = 0)\n    let cgstAmount = 0;\n    let sgstAmount = 0;\n    let igstAmount = 0;\n\n    if (taxRegime.regime === 'exempt' || customerSnapshot?.taxPreference === 'tax_exempt') {\n      // Tax exempt - no taxes\n      cgstAmount = 0;\n      sgstAmount = 0;\n      igstAmount = 0;\n    } else if (taxRegime.regime === 'inter') {\n      // Inter-state - use IGST\n      cgstAmount = 0;\n      sgstAmount = 0;\n      igstAmount = totals.totalTax;\n    } else {\n      // Intra-state - split between CGST and SGST\n      cgstAmount = totals.totalTax / 2;\n      sgstAmount = totals.totalTax / 2;\n      igstAmount = 0;\n    }\n\n    const invoiceData = {\n      date: formattedDate,\n      dueDate: formattedDueDate,\n      customerId: selectedCustomerId,\n      customerName: customerSnapshot?.displayName || selectedCustomer?.displayName || \"Unknown Customer\",\n      billingAddress: customerSnapshot?.billingAddress || {\n        street: billingAddress,\n        city: '',\n        state: '',\n        country: 'India',\n        pincode: ''\n      },\n      shippingAddress: customerSnapshot?.shippingAddress || {\n        street: shippingAddress,\n        city: '',\n        state: '',\n        country: 'India',\n        pincode: ''\n      },\n      salesperson: selectedSalesperson,\n      paymentTerms: getTermsLabel(),\n      items: invoiceItems,\n      subTotal: totals.taxableSubtotal,\n      shippingCharges: shippingAmount,\n      cgst: cgstAmount,\n      sgst: sgstAmount,\n      igst: igstAmount,\n      adjustment: adjustment,\n      total: finalTotal,\n      customerNotes: '',\n      termsAndConditions: '',\n      status: finalStatus,\n      // Store customer snapshot for immutability\n      gstTreatment: customerSnapshot?.gstTreatment || '',\n      taxPreference: customerSnapshot?.taxPreference || 'taxable',\n      placeOfSupply: customerSnapshot?.placeOfSupply || '',\n      gstin: customerSnapshot?.gstin || '',\n      customerSnapshot: customerSnapshot\n    };\n\n    try {\n      const response = await fetch('/api/invoices', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(invoiceData)\n      });\n\n      if (response.ok) {\n        const result = await response.json();\n        toast({\n          title: saveStatus === \"draft\" ? \"Invoice Saved as Draft\" : \"Invoice Created\",\n          description: `Invoice ${result.data.invoiceNumber} has been ${saveStatus === \"draft\" ? \"saved as draft\" : \"created\"}.`,\n        });\n        setLocation(\"/invoices\");\n      } else {\n        throw new Error('Failed to create invoice');\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create invoice. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const [items, setItems] = useState<InvoiceItem[]>([]);\n\n  // Calculations\n  const calculateLineItem = (item: InvoiceItem) => {\n    const baseAmount = item.qty * item.rate;\n\n    let discountAmount = 0;\n    if (item.discountType === 'percentage') {\n      discountAmount = baseAmount * (Math.min(item.discountValue, 100) / 100);\n    } else {\n      discountAmount = item.discountValue;\n    }\n\n    // Ensure discount doesn't exceed base amount\n    discountAmount = Math.min(discountAmount, baseAmount);\n\n    const taxableAmount = baseAmount - discountAmount;\n\n    let taxAmount = 0;\n    if (item.gstRate > 0) {\n      taxAmount = taxableAmount * (item.gstRate / 100);\n    }\n\n    return {\n      baseAmount,\n      discountAmount,\n      taxableAmount,\n      taxAmount,\n      total: taxableAmount + taxAmount\n    };\n  };\n\n  const totals = items.reduce((acc, item) => {\n    const line = calculateLineItem(item);\n    return {\n      subtotal: acc.subtotal + line.baseAmount, // Usually subtotal is before discount/tax in many systems, but user asked for \"Line Total (Qty  Rate  Discount + GST)\". Let's treat subtotal as sum of line totals for now? \n      // Actually, standard invoice subtotal is usually sum of (Qty * Rate).\n      // Then Total Discount.\n      // Then Total Tax.\n      // Let's follow the user's \"Subtotal\" requirement.\n      // \"Editing any item field recalculates: ... Subtotal, Tax Summary, Final Total\"\n      // I will calculate Subtotal as the sum of (Qty * Rate) - Discount. i.e. Taxable Value.\n      taxableSubtotal: acc.taxableSubtotal + line.taxableAmount,\n      totalTax: acc.totalTax + line.taxAmount,\n      grandTotal: acc.grandTotal + line.total\n    };\n  }, { subtotal: 0, taxableSubtotal: 0, totalTax: 0, grandTotal: 0 });\n\n  const finalTotal = totals.grandTotal + (hasShipping ? shippingAmount : 0) + adjustment;\n\n  const updateItem = (id: number, field: keyof InvoiceItem, value: any) => {\n    setItems(items.map(item => {\n      if (item.id === id) {\n        return { ...item, [field]: value };\n      }\n      return item;\n    }));\n  };\n\n  const addItem = () => {\n    setItems([...items, {\n      id: Math.random(),\n      name: \"\",\n      description: \"\",\n      productId: undefined,\n      qty: 1,\n      rate: 0,\n      discountType: 'percentage',\n      discountValue: 0,\n      gstRate: 0\n    }]);\n  };\n\n  const removeItem = (id: number) => {\n    setItems(items.filter(i => i.id !== id));\n  };\n\n  const handleAddTax = () => {\n    if (newTaxName && newTaxRate) {\n      const rate = parseFloat(newTaxRate);\n      if (!isNaN(rate)) {\n        setTaxOptions([...taxOptions, { label: `${newTaxName} [${rate}%]`, value: rate }]);\n        setIsTaxModalOpen(false);\n        setNewTaxName(\"\");\n        setNewTaxRate(\"\");\n      }\n    }\n  };\n\n  const handleAddNewPerson = () => {\n    if (newPersonFirstName && newPersonCustomerId) {\n      const newPerson = addContactPerson({\n        customerId: newPersonCustomerId,\n        firstName: newPersonFirstName,\n        lastName: newPersonLastName,\n        email: newPersonEmail,\n        workPhone: newPersonPhone,\n      });\n      setSelectedSalesperson(newPerson.id);\n      setIsAddPersonModalOpen(false);\n      setNewPersonFirstName(\"\");\n      setNewPersonLastName(\"\");\n      setNewPersonEmail(\"\");\n      setNewPersonPhone(\"\");\n      setNewPersonCustomerId(\"\");\n      toast({\n        title: \"Contact Person Added\",\n        description: `${newPersonFirstName} ${newPersonLastName} has been added successfully.`,\n      });\n    }\n  };\n\n  const getSalespersonName = (id: string) => {\n    const person = contactPersons.find(p => p.id === id);\n    return person ? `${person.firstName} ${person.lastName}` : \"\";\n  };\n\n  return (\n    <div className=\"max-w-7xl mx-auto space-y-8 pb-32 px-4 sm:px-6 relative overflow-visible\">\n\n      <div>\n        <h1 className=\"text-3xl font-display font-bold text-foreground tracking-tight\">Create Invoice</h1>\n        <p className=\"text-muted-foreground mt-1\">Draft a new invoice for your customer.</p>\n        {salesOrderId && (\n          <div className=\"mt-3\">\n            <Badge variant=\"secondary\" className=\"bg-blue-100 text-blue-700 border-blue-200\">\n              <Receipt className=\"w-3 h-3 mr-1\" />\n              Converting from Sales Order\n              {convertAll ? ' (All Items)' : ` (${selectedItemIds.length} Selected Items)`}\n            </Badge>\n          </div>\n        )}\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n        {/* Left Column - Main Invoice Details */}\n        <div className=\"lg:col-span-3 space-y-6\">\n\n          {/* Header Card */}\n          <Card className=\"border-border/60 shadow-sm\">\n            <CardContent className=\"p-6 md:p-8\">\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-x-8 gap-y-6\">\n\n                {/* Customer Section */}\n                <div className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-xs uppercase tracking-wider text-muted-foreground font-semibold\">Customer</Label>\n                    <Select value={selectedCustomerId} onValueChange={handleCustomerChange}>\n                      <SelectTrigger className=\"w-full h-11 bg-white border-border/60 focus:ring-primary/20\" data-testid=\"select-customer\">\n                        <SelectValue placeholder={customersLoading ? \"Loading customers...\" : \"Select or search customer\"} />\n                      </SelectTrigger>\n                      <SelectContent className=\"bg-white border border-slate-200 shadow-lg z-100 max-h-60 overflow-y-auto\">\n                        {customersLoading ? (\n                          <div className=\"p-2 text-sm text-muted-foreground\">Loading customers...</div>\n                        ) : customers.length === 0 ? (\n                          <div className=\"p-2 text-sm text-muted-foreground\">No customers found</div>\n                        ) : (\n                          customers.map((customer) => (\n                            <SelectItem key={customer.id} value={customer.id} data-testid={`customer-option-${customer.id}`}>\n                              {customer.displayName || customer.name}\n                            </SelectItem>\n                          ))\n                        )}\n                        <Separator className=\"my-1\" />\n                        <SelectItem value=\"add_new_customer\" className=\"text-primary font-medium\">\n                          <div className=\"flex items-center gap-2\">\n                            <Plus className=\"h-4 w-4\" />\n                            New Customer\n                          </div>\n                        </SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div className=\"p-4 rounded-lg bg-secondary/30 border border-border/50 text-sm space-y-2 wrap-break-word\">\n                    <div className=\"flex items-center justify-between\">\n                      <p className=\"font-medium text-foreground\">{selectedCustomer?.displayName || \"Select a customer\"}</p>\n                      {selectedCustomer && (\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-6 px-2 text-xs text-blue-600 hover:text-blue-700\"\n                          onClick={() => setIsEditingBillingAddress(!isEditingBillingAddress)}\n                        >\n                          <Edit3 className=\"h-3 w-3 mr-1\" />\n                          {isEditingBillingAddress ? \"Done\" : \"Edit\"}\n                        </Button>\n                      )}\n                    </div>\n                    {isEditingBillingAddress ? (\n                      <Textarea\n                        value={billingAddress}\n                        onChange={(e) => setBillingAddress(e.target.value)}\n                        className=\"min-h-20 text-sm bg-white border-border/60\"\n                        placeholder=\"Enter billing address...\"\n                      />\n                    ) : (\n                      <div className=\"text-muted-foreground whitespace-pre-line\">\n                        {billingAddress || (selectedCustomer ? `${selectedCustomer.companyName}\\n${selectedCustomer.email}` : \"No address available\")}\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* Invoice Meta Data */}\n                <div className=\"space-y-6\">\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label className=\"text-xs uppercase tracking-wider text-muted-foreground font-semibold\">Invoice #</Label>\n                      <div className=\"flex items-center w-full\">\n                        <span className=\"bg-secondary/50 border border-r-0 border-border/60 rounded-l-md px-3 py-2.5 text-sm text-muted-foreground whitespace-nowrap\">INV-</span>\n                        <Input\n                          className=\"flex-1 min-w-0 rounded-l-none border-l-0 focus-visible:ring-0 focus-visible:border-primary\"\n                          value={invoiceNumber}\n                          onChange={(e) => setInvoiceNumber(e.target.value)}\n                        />\n                      </div>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label className=\"text-xs uppercase tracking-wider text-muted-foreground font-semibold\">Order #</Label>\n                      <Input placeholder=\"Optional\" className=\"w-full bg-secondary/20 border-border/60\" />\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2 2xl:grid-cols-3 gap-4 min-w-0\">\n                    <div className=\"space-y-2 min-w-0\">\n                      <Label className=\"text-xs uppercase tracking-wider text-muted-foreground font-semibold\">Date</Label>\n                      <Popover>\n                        <PopoverTrigger asChild>\n                          <Button variant=\"outline\" className=\"w-full pl-3 text-left font-normal bg-secondary/20 border-border/60\">\n                            {date ? format(date, \"dd/MM/yyyy\") : <span>Pick a date</span>}\n                            <CalendarIcon className=\"ml-auto h-4 w-4 opacity-50\" />\n                          </Button>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                          <AdvancedDatePicker date={date} onSelect={(d: Date) => d && setDate(d)} />\n                        </PopoverContent>\n                      </Popover>\n                    </div>\n                    <div className=\"space-y-2 min-w-0 relative\">\n                      <Label className=\"text-xs uppercase tracking-wider text-muted-foreground font-semibold\">Terms</Label>\n                      <Popover open={isTermsOpen} onOpenChange={setIsTermsOpen}>\n                        <PopoverTrigger asChild>\n                          <Button\n                            variant=\"outline\"\n                            role=\"combobox\"\n                            className=\"w-full justify-between bg-secondary/20 border-border/60 font-normal\"\n                          >\n                            <span className={selectedTerms === \"paid\" ? \"text-green-600 font-semibold\" : \"\"}>\n                              {getTermsLabel()}\n                            </span>\n                            <ChevronDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                          </Button>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-60 p-0 bg-white border border-slate-200 shadow-lg z-100\" align=\"start\">\n                          <div className=\"p-2 border-b border-slate-100\">\n                            <div className=\"relative\">\n                              <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n                              <Input\n                                placeholder=\"Search terms...\"\n                                value={termsSearchQuery}\n                                onChange={(e) => setTermsSearchQuery(e.target.value)}\n                                className=\"pl-8 h-9 bg-slate-50 border-slate-200\"\n                              />\n                            </div>\n                          </div>\n                          <div className=\"max-h-[200px] overflow-y-auto\">\n                            {filteredTermsOptions.map((option) => (\n                              <div\n                                key={option.value}\n                                className={cn(\n                                  \"flex items-center justify-between px-3 py-2 cursor-pointer hover:bg-slate-50 transition-colors\",\n                                  selectedTerms === option.value && \"bg-blue-50\"\n                                )}\n                                onClick={() => handleTermsSelect(option.value)}\n                              >\n                                <span className={cn(\n                                  \"text-sm\",\n                                  option.value === \"paid\" && \"text-green-600 font-semibold\"\n                                )}>\n                                  {option.label}\n                                </span>\n                                {selectedTerms === option.value && (\n                                  <Check className=\"h-4 w-4 text-blue-600\" />\n                                )}\n                              </div>\n                            ))}\n                            {filteredTermsOptions.length === 0 && (\n                              <div className=\"px-3 py-4 text-sm text-muted-foreground text-center\">\n                                No terms found\n                              </div>\n                            )}\n                          </div>\n                          <div className=\"border-t border-slate-100 p-2\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              className=\"w-full justify-start text-muted-foreground hover:text-foreground\"\n                            >\n                              <Settings className=\"h-4 w-4 mr-2\" />\n                              Configure Terms\n                            </Button>\n                          </div>\n                        </PopoverContent>\n                      </Popover>\n                    </div>\n                    <div className=\"space-y-2 min-w-0\">\n                      <Label className=\"text-xs uppercase tracking-wider text-muted-foreground font-semibold\">Due Date</Label>\n                      <Popover>\n                        <PopoverTrigger asChild>\n                          <Button variant=\"outline\" className=\"w-full pl-3 text-left font-normal bg-secondary/20 border-border/60\">\n                            {dueDate ? format(dueDate, \"dd/MM/yyyy\") : <span>Pick a date</span>}\n                            <CalendarIcon className=\"ml-auto h-4 w-4 opacity-50\" />\n                          </Button>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                          <AdvancedDatePicker date={dueDate} onSelect={(d: Date) => d && setDueDate(d)} />\n                        </PopoverContent>\n                      </Popover>\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-xs uppercase tracking-wider text-muted-foreground font-semibold\">Salesperson</Label>\n                    <Select value={selectedSalesperson} onValueChange={(val) => {\n                      if (val === \"manage_salespersons\") {\n                        setShowManageSalespersons(true);\n                      } else {\n                        setSelectedSalesperson(val);\n                      }\n                    }}>\n                      <SelectTrigger className=\"bg-secondary/20 border-border/60\">\n                        <SelectValue placeholder=\"Select salesperson\">\n                          {selectedSalesperson || \"Select salesperson\"}\n                        </SelectValue>\n                      </SelectTrigger>\n                      <SelectContent className=\"z-100\">\n                        <div className=\"p-2\">\n                          <div className=\"relative\">\n                            <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\n                            <Input placeholder=\"Search\" className=\"pl-8 h-9\" />\n                          </div>\n                        </div>\n                        {salespersons.map((sp) => (\n                          <SelectItem key={sp.id} value={sp.name}>\n                            {sp.name}\n                          </SelectItem>\n                        ))}\n                        <Separator className=\"my-1\" />\n                        <div\n                          className=\"flex items-center gap-2 p-2 text-sm text-blue-600 cursor-pointer hover:bg-slate-100\"\n                          onClick={(e) => {\n                            e.preventDefault();\n                            e.stopPropagation();\n                            setShowManageSalespersons(true);\n                          }}\n                        >\n                          <Plus className=\"h-4 w-4\" />\n                          Manage Salespersons\n                        </div>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n              </div>\n\n              <Separator className=\"my-8 bg-border/60\" />\n\n              {/* Items Table */}\n              <div className=\"rounded-lg border border-border/60 bg-background relative overflow-visible\">\n\n                <div className=\"overflow-x-auto overflow-y-visible relative\">\n\n                  <Table className=\"w-full\">\n                    <TableHeader className=\"bg-secondary/30\">\n                      <TableRow className=\"hover:bg-transparent border-border/60\">\n                        <TableHead className=\"w-[30%] min-w-[200px] pl-4\">Item Details</TableHead>\n                        <TableHead className=\"w-[10%] min-w-20\">Quantity</TableHead>\n                        <TableHead className=\"w-[12%] min-w-[100px]\">Rate</TableHead>\n                        <TableHead className=\"w-[15%] min-w-[140px]\">Discount</TableHead>\n                        <TableHead className=\"w-[13%] min-w-[120px]\">GST</TableHead>\n                        <TableHead className=\"w-[15%] min-w-[100px] text-right pr-4\">Amount</TableHead>\n                        <TableHead className=\"w-[5%] min-w-[50px]\"></TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {items.length === 0 && (\n                        <TableRow>\n                          <TableCell colSpan={7} className=\"text-center py-12 text-muted-foreground\">\n                            <div className=\"flex flex-col items-center gap-2\">\n                              <Plus className=\"h-8 w-8 text-muted-foreground/50\" />\n                              <p>No items added yet</p>\n                              <Button variant=\"outline\" size=\"sm\" onClick={addItem} className=\"mt-2 gap-2\" data-testid=\"button-add-first-item\">\n                                <Plus className=\"h-4 w-4\" /> Add Item\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      )}\n                      {items.map((item) => {\n                        const lineCalc = calculateLineItem(item);\n                        return (\n                          <TableRow\n                            key={item.id}\n                            className=\"hover:bg-secondary/10 border-border/60 align-top relative overflow-visible\"\n                          >\n\n                            <TableCell className=\"pl-4 py-3 relative overflow-visible\">\n\n                              <div className=\"space-y-2\">\n                                <Select\n                                  value={item.productId || \"\"}\n                                  onValueChange={(val) => {\n                                    if (val === \"create_new_item\") {\n                                      setLocation('/items/create');\n                                      return;\n                                    }\n\n                                    console.log('Selected value:', val);\n                                    console.log('Available products:', products);\n\n                                    const selectedProduct = products.find(p => p.id === val);\n                                    console.log('Found product:', selectedProduct);\n\n                                    if (selectedProduct) {\n                                      const rateStr = selectedProduct.rate?.toString() || '0';\n                                      const rateNum = parseFloat(rateStr.replace(/[^\\d.]/g, '')) || 0;\n\n                                      const gstRate = selectedProduct.intraStateTax?.includes('18') ? 18 :\n                                        selectedProduct.intraStateTax?.includes('12') ? 12 :\n                                          selectedProduct.intraStateTax?.includes('5') ? 5 :\n                                            selectedProduct.intraStateTax?.includes('28') ? 28 : 0;\n\n                                      // Batch all updates into a single state change for better performance\n                                      setItems(prevItems => prevItems.map(prevItem => {\n                                        if (prevItem.id === item.id) {\n                                          return {\n                                            ...prevItem,\n                                            productId: selectedProduct.id,\n                                            name: selectedProduct.name,\n                                            description: selectedProduct.description || '',\n                                            rate: rateNum,\n                                            gstRate: gstRate\n                                          };\n                                        }\n                                        return prevItem;\n                                      }));\n                                    }\n                                  }}\n                                >\n                                  <SelectTrigger className=\"h-9 border-transparent hover:border-border/60 focus:border-primary bg-transparent px-2 -ml-2 font-medium text-base\" data-testid={`select-item-${item.id}`}>\n                                    <SelectValue placeholder=\"Select item\">{item.name || \"Select item\"}</SelectValue>\n                                  </SelectTrigger>\n                                  <SelectContent className=\"max-h-60 overflow-y-auto\">\n                                    {productsLoading ? (\n                                      <div className=\"p-2 text-sm text-muted-foreground\">Loading items...</div>\n                                    ) : products.length === 0 ? (\n                                      <div className=\"p-2 text-sm text-muted-foreground\">No items found</div>\n                                    ) : (\n                                      [\n                                        ...products.map((product) => {\n                                          const rateStr = product.rate?.toString() || '0';\n                                          const rateNum = parseFloat(rateStr.replace(/[^\\d.]/g, '')) || 0;\n                                          return (\n                                            <SelectItem key={product.id} value={product.id} data-testid={`item-option-${product.id}`}>\n                                              {product.name} {rateNum > 0 ? `- ${rateNum.toFixed(2)}` : ''}\n                                            </SelectItem>\n                                          );\n                                        }),\n                                        <Separator key=\"separator\" className=\"my-1\" />,\n                                        <SelectItem key=\"create-new\" value=\"create_new_item\" className=\"text-primary font-medium cursor-pointer\">\n                                          + Create New Item\n                                        </SelectItem>\n                                      ]\n                                    )}\n                                  </SelectContent>\n                                </Select>\n                              </div>\n                            </TableCell>\n                            <TableCell className=\"py-3 align-top relative overflow-visible\">\n\n                              <Input\n                                type=\"number\"\n                                min=\"0\"\n                                value={item.qty}\n                                onChange={(e) => updateItem(item.id, \"qty\", parseFloat(e.target.value) || 0)}\n                                className=\"h-9 w-full min-w-[70px] bg-transparent border-border/60 focus:bg-background\"\n                                data-testid={`input-item-qty-${item.id}`}\n                              />\n                            </TableCell>\n                            <TableCell className=\"py-3 align-top relative overflow-visible\">\n\n                              <Input\n                                type=\"number\"\n                                min=\"0\"\n                                value={item.rate}\n                                onChange={(e) => updateItem(item.id, \"rate\", parseFloat(e.target.value) || 0)}\n                                className=\"h-9 w-full min-w-[90px] bg-transparent border-border/60 focus:bg-background\"\n                              />\n                            </TableCell>\n                            <TableCell className=\"py-3 align-top relative overflow-visible\">\n\n                              <div className=\"flex shadow-sm rounded-md\">\n                                <div className=\"relative flex-1\">\n                                  <Input\n                                    type=\"number\"\n                                    min=\"0\"\n                                    max={item.discountType === 'percentage' ? 100 : undefined}\n                                    value={item.discountValue}\n                                    onChange={(e) => updateItem(item.id, \"discountValue\", parseFloat(e.target.value) || 0)}\n                                    className=\"h-9 w-full min-w-20 rounded-r-none bg-transparent border-border/60 focus:bg-background border-r-0\"\n                                  />\n                                </div>\n                                <Select\n                                  value={item.discountType}\n                                  onValueChange={(val: 'percentage' | 'flat') => updateItem(item.id, \"discountType\", val)}\n                                >\n                                  <SelectTrigger className=\"h-9 w-[55px] rounded-l-none border-l-0 bg-secondary/20 px-2\">\n                                    <SelectValue />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    <SelectItem value=\"percentage\">%</SelectItem>\n                                    <SelectItem value=\"flat\">Rs</SelectItem>\n                                  </SelectContent>\n                                </Select>\n                              </div>\n                              {lineCalc.discountAmount > 0 && (\n                                <span className=\"text-[10px] text-green-600 mt-1 block pl-1\">\n                                  -Rs {lineCalc.discountAmount.toFixed(2)}\n                                </span>\n                              )}\n                            </TableCell>\n                            <TableCell className=\"py-3 align-top relative overflow-visible\">\n\n                              <Select\n                                value={item.gstRate.toString()}\n                                onValueChange={(val) => {\n                                  if (val === \"new\") {\n                                    setIsTaxModalOpen(true);\n                                  } else {\n                                    updateItem(item.id, \"gstRate\", parseFloat(val));\n                                  }\n                                }}\n                              >\n                                <SelectTrigger className=\"h-9 w-full min-w-[110px] border-border/60 bg-transparent\">\n                                  <SelectValue placeholder=\"Tax\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                  {taxOptions.map(opt => (\n                                    <SelectItem key={opt.label} value={opt.value.toString()}>\n                                      {opt.label}\n                                    </SelectItem>\n                                  ))}\n                                  <Separator className=\"my-1\" />\n                                  <SelectItem value=\"new\" className=\"text-primary font-medium cursor-pointer\">\n                                    + New Tax\n                                  </SelectItem>\n                                </SelectContent>\n                              </Select>\n                            </TableCell>\n                            <TableCell className=\"text-right font-medium py-3 align-top pr-4\">\n                              <div className=\"h-9 flex items-center justify-end\">\n                                Rs {lineCalc.total.toFixed(2)}\n                              </div>\n                            </TableCell>\n                            <TableCell className=\"py-3 align-top relative overflow-visible\">\n\n                              <Button variant=\"ghost\" size=\"icon\" onClick={() => removeItem(item.id)} className=\"text-muted-foreground hover:text-destructive hover:bg-destructive/10 h-8 w-8\">\n                                <Trash2 className=\"h-4 w-4\" />\n                              </Button>\n                            </TableCell>\n                          </TableRow>\n                        );\n                      })}\n                    </TableBody>\n                  </Table>\n                </div>\n\n                <div className=\"flex flex-col sm:flex-row sm:items-center justify-between p-4 bg-secondary/10 border-t border-border/60 gap-4\">\n                  <div className=\"flex gap-3\">\n                    <Button variant=\"outline\" size=\"sm\" onClick={addItem} className=\"gap-2 border-dashed border-border hover:border-primary hover:text-primary bg-background\">\n                      <Plus className=\"h-4 w-4\" /> Add Line Item\n                    </Button>\n\n                    <Dialog>\n                      <DialogTrigger asChild>\n                        <Button variant=\"ghost\" size=\"sm\" className=\"gap-2 text-muted-foreground\">\n                          <UploadCloud className=\"h-4 w-4\" /> Add Items in Bulk\n                        </Button>\n                      </DialogTrigger>\n                      <DialogContent className=\"max-w-2xl\">\n                        <DialogHeader>\n                          <DialogTitle>Bulk Add Items</DialogTitle>\n                        </DialogHeader>\n                        <div className=\"space-y-4 py-4\">\n                          <p className=\"text-sm text-muted-foreground\">Paste items from a spreadsheet below.</p>\n                          <Textarea placeholder=\"Item Name, Quantity, Rate\" className=\"h-48 font-mono text-sm\" />\n                          <Button>Process & Add</Button>\n                        </div>\n                      </DialogContent>\n                    </Dialog>\n                  </div>\n\n                  <div className=\"text-sm text-muted-foreground\">\n                    Total Rows: {items.length}\n                  </div>\n                </div>\n              </div>\n\n              {/* Footer Section */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12 pt-4\">\n                <div className=\"space-y-6 order-2 md:order-1\">\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-xs uppercase tracking-wider text-muted-foreground font-semibold\">Customer Notes</Label>\n                    <Textarea placeholder=\"Notes visible to the customer...\" className=\"resize-none bg-secondary/20 border-border/60 min-h-[100px]\" />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-xs uppercase tracking-wider text-muted-foreground font-semibold\">Terms & Conditions</Label>\n                    <Textarea placeholder=\"Payment terms, warranty info...\" className=\"resize-none bg-secondary/20 border-border/60 min-h-[100px]\" />\n                  </div>\n\n                  <div className=\"pt-4\">\n                    <div className=\"space-y-2\">\n                      <Label className=\"text-xs uppercase tracking-wider text-muted-foreground font-semibold\">Attach File(s) to Invoice</Label>\n                      <div className=\"space-y-2\">\n                        <input\n                          type=\"file\"\n                          ref={fileInputRef}\n                          className=\"hidden\"\n                          multiple\n                          onChange={(e) => {\n                            if (e.target.files && e.target.files.length > 0) {\n                              setAttachments((prev) => [...prev, ...Array.from(e.target.files!)]);\n                              e.target.value = \"\";\n                            }\n                          }}\n                        />\n                        <Button\n                          variant=\"outline\"\n                          className=\"w-fit justify-between gap-4 border-dashed border-border/60\"\n                          onClick={() => fileInputRef.current?.click()}\n                        >\n                          <div className=\"flex items-center gap-2\">\n                            <UploadCloud className=\"h-4 w-4\" />\n                            <span>Upload File</span>\n                          </div>\n                        </Button>\n                        <p className=\"text-xs text-muted-foreground\">You can upload a maximum of 10 files, 10MB each</p>\n\n                        {attachments.length > 0 && (\n                          <div className=\"space-y-2 mt-2\">\n                            {attachments.map((file, index) => (\n                              <div key={index} className=\"flex items-center justify-between p-2 bg-secondary/20 rounded-md border border-border/60 text-sm\">\n                                <span className=\"truncate max-w-[200px] text-muted-foreground\">{file.name}</span>\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"icon\"\n                                  className=\"h-6 w-6 text-muted-foreground hover:text-destructive\"\n                                  onClick={() => setAttachments((prev) => prev.filter((_, i) => i !== index))}\n                                >\n                                  <X className=\"h-4 w-4\" />\n                                </Button>\n                              </div>\n                            ))}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"space-y-4 bg-secondary/10 p-6 rounded-xl border border-border/40 h-fit order-1 md:order-2\">\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-muted-foreground\">Subtotal (Taxable)</span>\n                    <span className=\"font-medium\">Rs {totals.taxableSubtotal.toFixed(2)}</span>\n                  </div>\n\n                  <div className=\"flex justify-between items-center text-sm\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-muted-foreground\">Shipping Charges</span>\n                      <Switch checked={hasShipping} onCheckedChange={setHasShipping} className=\"scale-75\" />\n                    </div>\n                    {hasShipping ? (\n                      <Input\n                        type=\"number\"\n                        value={shippingAmount}\n                        onChange={(e) => setShippingAmount(parseFloat(e.target.value) || 0)}\n                        className=\"w-24 h-8 text-right bg-background\"\n                        placeholder=\"0.00\"\n                      />\n                    ) : (\n                      <span className=\"text-muted-foreground\">-</span>\n                    )}\n                  </div>\n\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-muted-foreground\">Total GST</span>\n                    <span className=\"font-medium\">Rs {totals.totalTax.toFixed(2)}</span>\n                  </div>\n\n                  <div className=\"flex justify-between items-center text-sm pt-2\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-muted-foreground\">Adjustment</span>\n                      <Popover>\n                        <PopoverTrigger>\n                          <HelpCircleIcon className=\"h-3 w-3 text-muted-foreground\" />\n                        </PopoverTrigger>\n                        <PopoverContent className=\"text-xs w-60\">\n                          Add any positive or negative adjustment to the final total (e.g. Rounding off).\n                        </PopoverContent>\n                      </Popover>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Input\n                        type=\"number\"\n                        value={adjustment}\n                        onChange={(e) => setAdjustment(parseFloat(e.target.value) || 0)}\n                        className=\"w-24 h-8 text-right bg-background\"\n                        placeholder=\"0.00\"\n                      />\n                    </div>\n                  </div>\n\n                  <Separator className=\"bg-border/60\" />\n\n                  <div className=\"flex justify-between items-baseline\">\n                    <span className=\"font-bold text-lg\">Total</span>\n                    <span className=\"font-bold text-2xl text-primary\">Rs {finalTotal.toFixed(2)}</span>\n                  </div>\n\n                  <div className=\"pt-4\">\n                    <div className=\"flex items-center gap-2 mb-3\">\n                      <Switch id=\"payment-received\" checked={paymentReceived} onCheckedChange={setPaymentReceived} />\n                      <Label htmlFor=\"payment-received\" className=\"font-medium cursor-pointer\">I have received the payment</Label>\n                    </div>\n\n                    {paymentReceived && (\n                      <div className=\"p-4 bg-background border border-border/60 rounded-lg space-y-3 animate-in slide-in-from-top-2 fade-in duration-200\">\n                        <div className=\"grid grid-cols-2 gap-3\">\n                          <Select defaultValue=\"cash\">\n                            <SelectTrigger><SelectValue placeholder=\"Mode\" /></SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"cash\">Cash</SelectItem>\n                              <SelectItem value=\"bank\">Bank Transfer</SelectItem>\n                              <SelectItem value=\"check\">Check</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <Input placeholder=\"Amount\" defaultValue={finalTotal.toFixed(2)} />\n                        </div>\n                        <div className=\"flex items-center gap-2 text-xs text-primary cursor-pointer hover:underline\">\n                          <Plus className=\"h-3 w-3\" /> Add another payment (Split)\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {/* Sticky Bottom Bar */}\n      <div className=\"fixed bottom-0 left-0 md:left-64 right-0 bg-card/80 backdrop-blur-md border-t border-border/60 p-4 z-40\">\n        <div className=\"max-w-6xl mx-auto flex items-center justify-between gap-4\">\n          <Button variant=\"ghost\" className=\"text-muted-foreground hover:text-destructive\" onClick={() => setLocation(\"/invoices\")}>\n            Cancel\n          </Button>\n          <div className=\"flex items-center gap-3\">\n            <Button variant=\"outline\" className=\"hidden sm:flex gap-2 bg-card hover:bg-secondary/50\" onClick={() => handleSaveInvoice(\"draft\")}>\n              <Save className=\"h-4 w-4\" /> Save as Draft\n            </Button>\n            <Button variant=\"outline\" className=\"gap-2 bg-card hover:bg-secondary/50\" onClick={() => handleSaveInvoice(\"pending\")}>\n              <Clock className=\"h-4 w-4\" /> Schedule\n            </Button>\n            <div className=\"h-8 w-px bg-border/60 mx-1\"></div>\n            <div className=\"flex items-center rounded-md bg-primary shadow-md hover:bg-primary/90 transition-all\">\n              <Button className=\"rounded-r-none border-r border-primary-foreground/20 bg-transparent shadow-none hover:bg-transparent px-4\" onClick={() => handleSaveInvoice(\"pending\")}>\n                <Send className=\"h-4 w-4 mr-2\" />\n                <span className=\"hidden sm:inline\">Save & Send</span>\n              </Button>\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button className=\"rounded-l-none px-2 bg-transparent shadow-none hover:bg-transparent\">\n                    <ChevronDown className=\"h-4 w-4 text-primary-foreground\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"end\" className=\"w-56\">\n                  <DropdownMenuItem onClick={() => handleSaveInvoice(\"pending\")}>\n                    <Printer className=\"mr-2 h-4 w-4\" /> Save and Print\n                  </DropdownMenuItem>\n                  <DropdownMenuItem onClick={() => handleSaveInvoice(\"pending\")}>\n                    <Share2 className=\"mr-2 h-4 w-4\" /> Save and Share\n                  </DropdownMenuItem>\n                  <DropdownMenuItem onClick={() => handleSaveInvoice(\"pending\")}>\n                    <Clock className=\"mr-2 h-4 w-4\" /> Save and Send Later\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* New Tax Modal */}\n      <Dialog open={isTaxModalOpen} onOpenChange={setIsTaxModalOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Add New Tax</DialogTitle>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"tax-name\" className=\"text-right\">\n                Name\n              </Label>\n              <Input\n                id=\"tax-name\"\n                placeholder=\"e.g., GST28\"\n                className=\"col-span-3\"\n                value={newTaxName}\n                onChange={(e) => setNewTaxName(e.target.value)}\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"tax-rate\" className=\"text-right\">\n                Rate (%)\n              </Label>\n              <Input\n                id=\"tax-rate\"\n                type=\"number\"\n                placeholder=\"28\"\n                className=\"col-span-3\"\n                value={newTaxRate}\n                onChange={(e) => setNewTaxRate(e.target.value)}\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsTaxModalOpen(false)}>Cancel</Button>\n            <Button onClick={handleAddTax}>Save Tax</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Add New Person Modal */}\n      <Dialog open={isAddPersonModalOpen} onOpenChange={setIsAddPersonModalOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Add New Contact Person</DialogTitle>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"person-customer\">Customer *</Label>\n              <Select value={newPersonCustomerId} onValueChange={setNewPersonCustomerId}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select customer\" />\n                </SelectTrigger>\n                <SelectContent className=\"z-200\">\n                  {customers.map((customer) => (\n                    <SelectItem key={customer.id} value={customer.id}>\n                      {customer.displayName}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"person-firstname\">First Name *</Label>\n                <Input\n                  id=\"person-firstname\"\n                  placeholder=\"First Name\"\n                  value={newPersonFirstName}\n                  onChange={(e) => setNewPersonFirstName(e.target.value)}\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"person-lastname\">Last Name</Label>\n                <Input\n                  id=\"person-lastname\"\n                  placeholder=\"Last Name\"\n                  value={newPersonLastName}\n                  onChange={(e) => setNewPersonLastName(e.target.value)}\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"person-email\">Email</Label>\n              <Input\n                id=\"person-email\"\n                type=\"email\"\n                placeholder=\"email@example.com\"\n                value={newPersonEmail}\n                onChange={(e) => setNewPersonEmail(e.target.value)}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"person-phone\">Work Phone</Label>\n              <Input\n                id=\"person-phone\"\n                placeholder=\"+1 (555) 123-4567\"\n                value={newPersonPhone}\n                onChange={(e) => setNewPersonPhone(e.target.value)}\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsAddPersonModalOpen(false)}>Cancel</Button>\n            <Button onClick={handleAddNewPerson} disabled={!newPersonFirstName || !newPersonCustomerId}>\n              <UserPlus className=\"h-4 w-4 mr-2\" />\n              Add Person\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <ManageSalespersonsDialog\n        open={showManageSalespersons}\n        onOpenChange={setShowManageSalespersons}\n        onSalespersonChange={fetchSalespersons}\n      />\n    </div>\n  );\n}\n\nfunction HelpCircleIcon(props: any) {\n  return (\n    <svg\n      {...props}\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <circle cx=\"12\" cy=\"12\" r=\"10\" />\n      <path d=\"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3\" />\n      <path d=\"M12 17h.01\" />\n    </svg>\n  )\n}\n","path":null,"size_bytes":68950,"size_tokens":null},"client/src/pages/delivery-challan-edit.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation, useRoute } from \"wouter\";\nimport {\n  Calendar as CalendarIcon,\n  Plus,\n  X,\n  HelpCircle\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { cn } from \"@/lib/utils\";\nimport { Separator } from \"@/components/ui/separator\";\n\ninterface ChallanItem {\n  id: number;\n  name: string;\n  description: string;\n  hsnSac: string;\n  qty: number;\n  rate: number;\n  discountType: 'percentage' | 'flat';\n  discountValue: number;\n  gstRate: number;\n}\n\ninterface Customer {\n  id: string;\n  displayName: string;\n  companyName: string;\n  email: string;\n  gstin?: string;\n  billingAddress?: any;\n  shippingAddress?: any;\n}\n\nconst CHALLAN_TYPES = [\n  { value: \"supply_on_approval\", label: \"Supply on Approval\" },\n  { value: \"supply_for_job_work\", label: \"Supply for Job Work\" },\n  { value: \"supply_for_repair\", label: \"Supply for Repair\" },\n  { value: \"removal_for_own_use\", label: \"Removal for Own Use\" },\n  { value: \"others\", label: \"Others\" }\n];\n\nconst TAX_OPTIONS = [\n  { label: \"Non-taxable\", value: -1 },\n  { label: \"GST0 [0%]\", value: 0 },\n  { label: \"GST5 [5%]\", value: 5 },\n  { label: \"GST12 [12%]\", value: 12 },\n  { label: \"GST18 [18%]\", value: 18 },\n  { label: \"GST28 [28%]\", value: 28 },\n];\n\nexport default function DeliveryChallanEdit() {\n  const [, setLocation] = useLocation();\n  const [match, params] = useRoute(\"/delivery-challans/:id/edit\");\n  const { toast } = useToast();\n  \n  const [date, setDate] = useState<Date>(new Date());\n  const [challanNumber, setChallanNumber] = useState(\"\");\n  const [referenceNumber, setReferenceNumber] = useState(\"\");\n  const [selectedCustomerId, setSelectedCustomerId] = useState<string>(\"\");\n  const [challanType, setChallanType] = useState<string>(\"\");\n  const [customers, setCustomers] = useState<Customer[]>([]);\n  const [customerNotes, setCustomerNotes] = useState(\"\");\n  const [termsAndConditions, setTermsAndConditions] = useState(\"\");\n  const [adjustment, setAdjustment] = useState(0);\n  const [saving, setSaving] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [status, setStatus] = useState(\"DRAFT\");\n\n  const [items, setItems] = useState<ChallanItem[]>([]);\n\n  useEffect(() => {\n    fetchCustomers();\n    if (params?.id) {\n      fetchChallan(params.id);\n    }\n  }, [params?.id]);\n\n  const fetchChallan = async (id: string) => {\n    try {\n      const response = await fetch(`/api/delivery-challans/${id}`);\n      if (response.ok) {\n        const data = await response.json();\n        const challan = data.data;\n        \n        setChallanNumber(challan.challanNumber.replace(\"DC-\", \"\"));\n        setReferenceNumber(challan.referenceNumber || \"\");\n        setDate(new Date(challan.date));\n        setSelectedCustomerId(challan.customerId);\n        setChallanType(challan.challanType);\n        setCustomerNotes(challan.customerNotes || \"\");\n        setTermsAndConditions(challan.termsAndConditions || \"\");\n        setAdjustment(challan.adjustment || 0);\n        setStatus(challan.status);\n        \n        const challanItems = challan.items.map((item: any, index: number) => ({\n          id: index + 1,\n          name: item.name,\n          description: item.description || \"\",\n          hsnSac: item.hsnSac || \"\",\n          qty: item.quantity,\n          rate: item.rate,\n          discountType: item.discountType || 'percentage',\n          discountValue: item.discount || 0,\n          gstRate: item.taxName?.includes('18') ? 18 : (item.taxName?.includes('12') ? 12 : (item.taxName?.includes('5') ? 5 : (item.taxName?.includes('28') ? 28 : 0)))\n        }));\n        \n        setItems(challanItems.length > 0 ? challanItems : [{\n          id: 1,\n          name: \"\",\n          description: \"\",\n          hsnSac: \"\",\n          qty: 1,\n          rate: 0,\n          discountType: 'percentage',\n          discountValue: 0,\n          gstRate: 18\n        }]);\n      }\n    } catch (error) {\n      console.error('Failed to fetch challan:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to load delivery challan.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchCustomers = async () => {\n    try {\n      const response = await fetch('/api/customers');\n      if (response.ok) {\n        const data = await response.json();\n        setCustomers(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch customers:', error);\n    }\n  };\n\n  const selectedCustomer = customers.find(c => c.id === selectedCustomerId);\n\n  const calculateLineItem = (item: ChallanItem) => {\n    const baseAmount = item.qty * item.rate;\n    let discountAmount = 0;\n    if (item.discountType === 'percentage') {\n      discountAmount = baseAmount * (Math.min(item.discountValue, 100) / 100);\n    } else {\n      discountAmount = item.discountValue;\n    }\n    discountAmount = Math.min(discountAmount, baseAmount);\n    const taxableAmount = baseAmount - discountAmount;\n    let taxAmount = 0;\n    if (item.gstRate > 0) {\n      taxAmount = taxableAmount * (item.gstRate / 100);\n    }\n    return {\n      baseAmount,\n      discountAmount,\n      taxableAmount,\n      taxAmount,\n      total: taxableAmount + taxAmount\n    };\n  };\n\n  const totals = items.reduce((acc, item) => {\n    const line = calculateLineItem(item);\n    return {\n      taxableSubtotal: acc.taxableSubtotal + line.taxableAmount,\n      totalTax: acc.totalTax + line.taxAmount,\n      grandTotal: acc.grandTotal + line.total\n    };\n  }, { taxableSubtotal: 0, totalTax: 0, grandTotal: 0 });\n\n  const finalTotal = totals.grandTotal + adjustment;\n\n  const updateItem = (id: number, field: keyof ChallanItem, value: any) => {\n    setItems(items.map(item => {\n      if (item.id === id) {\n        return { ...item, [field]: value };\n      }\n      return item;\n    }));\n  };\n\n  const addItem = () => {\n    setItems([...items, {\n      id: Math.random(),\n      name: \"\",\n      description: \"\",\n      hsnSac: \"\",\n      qty: 1,\n      rate: 0,\n      discountType: 'percentage',\n      discountValue: 0,\n      gstRate: 18\n    }]);\n  };\n\n  const removeItem = (id: number) => {\n    if (items.length > 1) {\n      setItems(items.filter(i => i.id !== id));\n    }\n  };\n\n  const handleSave = async (newStatus?: string) => {\n    if (!selectedCustomerId) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please select a customer.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    if (!challanType) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please select a challan type.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    const validItems = items.filter(item => item.name.trim() !== '');\n    if (validItems.length === 0) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please add at least one item with a name.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    const invalidItems = validItems.filter(item => item.qty <= 0 || item.rate < 0);\n    if (invalidItems.length > 0) {\n      toast({\n        title: \"Validation Error\",\n        description: \"All items must have a positive quantity and non-negative rate.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setSaving(true);\n\n    const challanItems = validItems.map(item => {\n      const lineCalc = calculateLineItem(item);\n      return {\n        id: String(item.id),\n        itemId: String(item.id),\n        name: item.name,\n        description: item.description,\n        hsnSac: item.hsnSac,\n        quantity: item.qty,\n        unit: 'pcs',\n        rate: item.rate,\n        discount: lineCalc.discountAmount,\n        discountType: item.discountType,\n        tax: lineCalc.taxAmount,\n        taxName: item.gstRate > 0 ? `GST${item.gstRate}` : 'Non-taxable',\n        amount: lineCalc.total\n      };\n    });\n\n    const challanData = {\n      date: format(date, \"yyyy-MM-dd\"),\n      referenceNumber,\n      customerId: selectedCustomerId,\n      customerName: selectedCustomer?.displayName || \"Unknown Customer\",\n      challanType,\n      billingAddress: selectedCustomer?.billingAddress || {},\n      shippingAddress: selectedCustomer?.shippingAddress || selectedCustomer?.billingAddress || {},\n      placeOfSupply: '',\n      gstin: selectedCustomer?.gstin || '',\n      items: challanItems,\n      subTotal: totals.taxableSubtotal,\n      cgst: totals.totalTax / 2,\n      sgst: totals.totalTax / 2,\n      igst: 0,\n      adjustment: adjustment,\n      total: finalTotal,\n      customerNotes,\n      termsAndConditions,\n      status: newStatus || status\n    };\n\n    try {\n      const response = await fetch(`/api/delivery-challans/${params?.id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(challanData)\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Delivery Challan Updated\",\n          description: \"Your changes have been saved.\",\n        });\n        setLocation(\"/delivery-challans\");\n      } else {\n        throw new Error('Failed to update delivery challan');\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update delivery challan. Please try again.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const formatCurrency = (amount: number) => {\n    return `${amount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <p className=\"text-muted-foreground\">Loading...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-6xl mx-auto space-y-6 pb-32 px-4 sm:px-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-foreground\">Edit Delivery Challan</h1>\n          <p className=\"text-muted-foreground\">DC-{challanNumber}</p>\n        </div>\n        <Button variant=\"ghost\" size=\"icon\" onClick={() => setLocation(\"/delivery-challans\")} data-testid=\"button-close\">\n          <X className=\"h-5 w-5\" />\n        </Button>\n      </div>\n\n      <Card className=\"border-border/60\">\n        <CardContent className=\"p-6 space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium text-destructive\">Customer Name*</Label>\n                <Select value={selectedCustomerId} onValueChange={setSelectedCustomerId}>\n                  <SelectTrigger className=\"w-full\" data-testid=\"select-customer\">\n                    <SelectValue placeholder=\"Select a customer\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {customers.map((customer) => (\n                      <SelectItem key={customer.id} value={customer.id}>\n                        {customer.displayName}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium\">Delivery Challan#</Label>\n                <div className=\"flex items-center\">\n                  <span className=\"bg-muted border border-r-0 border-border rounded-l-md px-3 py-2 text-sm text-muted-foreground\">DC-</span>\n                  <Input\n                    value={challanNumber}\n                    disabled\n                    className=\"rounded-l-none bg-muted\"\n                    data-testid=\"input-challan-number\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium\">Reference#</Label>\n                <Input\n                  value={referenceNumber}\n                  onChange={(e) => setReferenceNumber(e.target.value)}\n                  data-testid=\"input-reference-number\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium text-destructive\">Delivery Challan Date*</Label>\n                <Popover>\n                  <PopoverTrigger asChild>\n                    <Button\n                      variant=\"outline\"\n                      className={cn(\"w-full justify-start text-left font-normal\", !date && \"text-muted-foreground\")}\n                      data-testid=\"button-date\"\n                    >\n                      <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                      {date ? format(date, \"dd/MM/yyyy\") : \"Select date\"}\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                    <Calendar\n                      mode=\"single\"\n                      selected={date}\n                      onSelect={(d) => d && setDate(d)}\n                      initialFocus\n                    />\n                  </PopoverContent>\n                </Popover>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium text-destructive\">Challan Type*</Label>\n                <Select value={challanType} onValueChange={setChallanType}>\n                  <SelectTrigger className=\"w-full\" data-testid=\"select-challan-type\">\n                    <SelectValue placeholder=\"Choose a challan type\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {CHALLAN_TYPES.map((type) => (\n                      <SelectItem key={type.value} value={type.value}>\n                        {type.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"mt-8\">\n            <div className=\"bg-muted/50 rounded-t-lg p-3\">\n              <h3 className=\"font-medium\">Item Table</h3>\n            </div>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead className=\"w-[300px]\">Item Details</TableHead>\n                  <TableHead className=\"text-center\">Quantity</TableHead>\n                  <TableHead className=\"text-center\">Rate</TableHead>\n                  <TableHead className=\"text-center\">Discount</TableHead>\n                  <TableHead className=\"text-center\">Tax</TableHead>\n                  <TableHead className=\"text-right\">Amount</TableHead>\n                  <TableHead className=\"w-10\"></TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {items.map((item, index) => {\n                  const lineCalc = calculateLineItem(item);\n                  return (\n                    <TableRow key={item.id}>\n                      <TableCell>\n                        <Input\n                          value={item.name}\n                          onChange={(e) => updateItem(item.id, 'name', e.target.value)}\n                          placeholder=\"Type or click to select an item.\"\n                          className=\"border-0 shadow-none focus-visible:ring-0 px-0\"\n                          data-testid={`input-item-name-${index}`}\n                        />\n                      </TableCell>\n                      <TableCell>\n                        <Input\n                          type=\"number\"\n                          value={item.qty}\n                          onChange={(e) => updateItem(item.id, 'qty', parseFloat(e.target.value) || 0)}\n                          className=\"w-20 text-center\"\n                          data-testid={`input-qty-${index}`}\n                        />\n                      </TableCell>\n                      <TableCell>\n                        <Input\n                          type=\"number\"\n                          value={item.rate}\n                          onChange={(e) => updateItem(item.id, 'rate', parseFloat(e.target.value) || 0)}\n                          className=\"w-24 text-right\"\n                          data-testid={`input-rate-${index}`}\n                        />\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-1\">\n                          <Input\n                            type=\"number\"\n                            value={item.discountValue}\n                            onChange={(e) => updateItem(item.id, 'discountValue', parseFloat(e.target.value) || 0)}\n                            className=\"w-16 text-right\"\n                            data-testid={`input-discount-${index}`}\n                          />\n                          <Select\n                            value={item.discountType}\n                            onValueChange={(v) => updateItem(item.id, 'discountType', v)}\n                          >\n                            <SelectTrigger className=\"w-14 px-1\">\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"percentage\">%</SelectItem>\n                              <SelectItem value=\"flat\">Rs</SelectItem>\n                            </SelectContent>\n                          </Select>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Select\n                          value={String(item.gstRate)}\n                          onValueChange={(v) => updateItem(item.id, 'gstRate', parseInt(v))}\n                        >\n                          <SelectTrigger className=\"w-32\" data-testid={`select-tax-${index}`}>\n                            <SelectValue placeholder=\"Select a Tax\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {TAX_OPTIONS.map((tax) => (\n                              <SelectItem key={tax.value} value={String(tax.value)}>\n                                {tax.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </TableCell>\n                      <TableCell className=\"text-right font-medium\">\n                        {formatCurrency(lineCalc.total)}\n                      </TableCell>\n                      <TableCell>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => removeItem(item.id)}\n                          disabled={items.length === 1}\n                          data-testid={`button-remove-item-${index}`}\n                        >\n                          <X className=\"h-4 w-4 text-destructive\" />\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  );\n                })}\n              </TableBody>\n            </Table>\n\n            <div className=\"flex gap-4 mt-4\">\n              <Button variant=\"outline\" size=\"sm\" onClick={addItem} className=\"gap-1\" data-testid=\"button-add-row\">\n                <Plus className=\"h-4 w-4\" />\n                Add New Row\n              </Button>\n            </div>\n\n            <div className=\"flex justify-between mt-8\">\n              <div className=\"w-1/2 pr-8 space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label className=\"text-sm font-medium\">Customer Notes</Label>\n                  <Textarea\n                    value={customerNotes}\n                    onChange={(e) => setCustomerNotes(e.target.value)}\n                    placeholder=\"Enter any notes to be displayed in your transaction\"\n                    className=\"min-h-[80px]\"\n                    data-testid=\"textarea-customer-notes\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"w-1/2 space-y-3\">\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-sm font-medium\">Sub Total</span>\n                  <span className=\"font-semibold\">{formatCurrency(totals.taxableSubtotal)}</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm\">Adjustment</span>\n                  <Input\n                    type=\"number\"\n                    value={adjustment}\n                    onChange={(e) => setAdjustment(parseFloat(e.target.value) || 0)}\n                    className=\"w-28 text-right\"\n                    data-testid=\"input-adjustment\"\n                  />\n                  <span className=\"text-sm\">{formatCurrency(adjustment)}</span>\n                </div>\n                <Separator />\n                <div className=\"flex justify-between items-center text-lg font-bold\">\n                  <span>Total ()</span>\n                  <span>{formatCurrency(finalTotal)}</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <Separator />\n\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">Terms & Conditions</Label>\n              <Textarea\n                value={termsAndConditions}\n                onChange={(e) => setTermsAndConditions(e.target.value)}\n                placeholder=\"Enter the terms and conditions of your business\"\n                className=\"min-h-[80px]\"\n                data-testid=\"textarea-terms\"\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"fixed bottom-0 left-0 right-0 bg-background border-t border-border p-4\">\n        <div className=\"max-w-6xl mx-auto flex items-center gap-2\">\n          <Button\n            onClick={() => handleSave()}\n            disabled={saving}\n            data-testid=\"button-save\"\n          >\n            {saving ? \"Saving...\" : \"Save\"}\n          </Button>\n          <Button\n            variant=\"outline\"\n            onClick={() => setLocation(\"/delivery-challans\")}\n            data-testid=\"button-cancel\"\n          >\n            Cancel\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":23037,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1877,"size_tokens":null},"replit.md":{"content":"# Billing Accounting Application\n\n## Overview\nA full-stack accounting application designed for comprehensive financial management, including invoices, customers, products, vendors, and expenses. It aims to provide an enterprise-grade solution for businesses, leveraging a modern tech stack and modular architecture to ensure scalability and maintainability.\n\n## User Preferences\nI want iterative development. Ask before making major changes. I prefer detailed explanations. Do not make changes to the folder `Z`. Do not make changes to the file `Y`.\n\n## System Architecture\n\n### UI/UX Decisions\n- **Framework**: React 19 with TypeScript\n- **Build Tool**: Vite 7\n- **UI Components**: Radix UI components with Tailwind CSS for a modern and consistent design.\n- **Routing**: Wouter with lazy loading for efficient navigation.\n- **State Management**: Zustand for global state and TanStack Query for server state.\n- **Forms**: React Hook Form with Zod validation for robust form handling.\n\n### Technical Implementations\n- **Backend Server**: Express 4\n- **Database**: PostgreSQL (Neon) managed with Drizzle ORM.\n- **API Versioning**: All API routes are prefixed with `/api/v1`.\n- **Authentication**: JWT-based authentication (prepared for implementation).\n- **Validation**: Zod schemas used for both frontend and backend validation.\n- **Deployment**: Designed for stateless web application deployment with `npm run build` and `npm start`.\n\n### Feature Specifications\n- **Core Modules**: Dashboard, Invoice, Customer, Product & Services, Estimates, Vendor, Expense, Purchase Order, Bill, Payment, Time Tracking, Banking, Filing & Compliance, Accountant Collaboration, Document Management, Reports, and Settings.\n- **Frontend Structure**: Enterprise modular structure (`client/src/modules/`) where each feature is a module with its own components, pages, hooks, API, types, and services. Global elements like API client, config, constants, layouts, routes, and shared utilities are managed centrally.\n- **Backend Structure**: Clean Architecture / Modular Monolith (`server/src/modules/`) with each module containing its own controller, service, model, routes, validators, and repository. Middleware for authentication, error handling, logging, and validation is centrally managed.\n\n### System Design Choices\n- **Development Mode**: Express server with Vite middleware for Hot Module Replacement (HMR).\n- **Production Mode**: Express serves pre-built static files from `dist/public`.\n- **API Pattern**: All modules expose their functionalities through versioned API endpoints, following a consistent `/{module}/{resource}` pattern.\n- **Module Architecture**: Frontend modules export pages, types, API functions, services, and hooks. Backend modules adhere to Clean Architecture principles with distinct layers for controllers, services, repositories, models, and validators.\n\n## Recent Changes (December 2025)\n\n### Vendor Credit and Purchase Order Improvements\n- **Vendor Credit Edit Page**: Added `/vendor-credits/:id/edit` route with full edit functionality\n  - Fetches existing vendor credit data and pre-populates form\n  - PUT request to `/api/vendor-credits/:id` for saving changes\n  - Proper tax amount recalculation when quantity/rate changes\n\n- **Vendor Credit Tax Calculation**:\n  - Added `taxAmount` field to LineItem interface\n  - `calculateItemTaxAmount` uses stored taxAmount first, falls back to calculation\n  - `updateItem` recalculates taxAmount when quantity, rate, or tax code changes\n  - Tax amounts properly included in total calculations and payloads\n\n- **Bill Creation from Purchase Orders**:\n  - Navigate to `/bills/new?purchaseOrderId=X` to create bill from PO\n  - Pre-populates vendor, items, and totals from purchase order data\n  - Refreshes PO list after conversion to reflect updated status\n\n- **Vendor Credit Creation from Bills**:\n  - Navigate to `/vendor-credits/new?billId=X` to create credit from bill\n  - Pre-populates vendor, items with taxAmount calculations\n  - Shows info banner indicating creation from bill\n\n### Sales Entry Point Flow Implementation\n- **Transaction Bootstrap Hooks**: Centralized customer auto-population for all transaction create pages\n  - `useTransactionBootstrap`: Main hook for transaction pages - reads customerId from URL, manages customer snapshot\n  - `useCustomerSnapshot`: Fetches and caches customer data as immutable snapshot\n  - `customer-snapshot.ts`: Utility functions for tax regime determination and address formatting\n\n- **Tax Calculation Logic**:\n  - Automatic CGST+SGST calculation for intra-state transactions (same state as company)\n  - Automatic IGST calculation for inter-state transactions (different state)\n  - Tax-exempt handling for customers with tax_exempt preference\n\n- **Customer Snapshot Architecture**:\n  - Immutable customer data preserved at transaction creation time\n  - Prevents retroactive changes when customer details are updated later\n  - Includes: billing address, shipping address, GSTIN, tax preference, payment terms, place of supply\n\n### Updated Create Pages\nAll transaction create pages now integrate with transaction bootstrap hooks:\n- Invoice Create (`/invoices/create`)\n- Quote Create (`/quotes/create`)\n- Sales Order Create (`/sales-orders/create`)\n- Delivery Challan Create (`/delivery-challans/create`)\n- Credit Note Create (`/credit-notes/create`)\n- Payments Received Create (`/payments-received/create`)\n\n## External Dependencies\n- **Database**: PostgreSQL (via Neon)\n- **ORM**: Drizzle ORM\n- **Frontend Libraries**: React, Vite, Radix UI, Tailwind CSS, Wouter, Zustand, TanStack Query, React Hook Form, Zod.\n- **Backend Libraries**: Express, Zod.","path":null,"size_bytes":5652,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-[100] max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-slate-200 bg-white dark:bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n        \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1 max-h-[280px] overflow-y-auto overscroll-contain\",\n          \"[&::-webkit-scrollbar]:w-1.5 [&::-webkit-scrollbar-track]:bg-slate-100 [&::-webkit-scrollbar-thumb]:bg-slate-300 [&::-webkit-scrollbar-thumb]:rounded-full\",\n          position === \"popper\" &&\n          \"w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n        style={{ scrollBehavior: 'auto' }}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal >\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"px-2 py-1.5 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute right-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5940,"size_tokens":null},"client/src/shared/utils/index.ts":{"content":"export * from './formatters';\nexport * from './validators';\n","path":null,"size_bytes":60,"size_tokens":null},"client/src/pages/invoice-import.tsx":{"content":"import { useState } from \"react\";\nimport { \n  UploadCloud, \n  FileSpreadsheet, \n  CheckCircle2, \n  AlertCircle, \n  ArrowRight, \n  Settings, \n  Database, \n  X,\n  FileText\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { cn } from \"@/lib/utils\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\n\nconst STEPS = [\n  { id: 1, name: \"Upload\", icon: UploadCloud },\n  { id: 2, name: \"Configure\", icon: Settings },\n  { id: 3, name: \"Map Fields\", icon: Database },\n  { id: 4, name: \"Preview\", icon: FileSpreadsheet },\n];\n\nexport default function InvoiceImport() {\n  const [step, setStep] = useState(1);\n  const [file, setFile] = useState<File | null>(null);\n\n  const handleNext = () => {\n    if (step < 4) setStep(step + 1);\n  };\n\n  const handleBack = () => {\n    if (step > 1) setStep(step - 1);\n  };\n\n  return (\n    <div className=\"max-w-5xl mx-auto space-y-12 pb-24\">\n      <div className=\"text-center space-y-4 max-w-2xl mx-auto\">\n        <h1 className=\"text-3xl font-display font-bold text-foreground tracking-tight\">Bulk Invoice Import</h1>\n        <p className=\"text-muted-foreground\">Import multiple invoices at once using CSV, TSV, or Excel files. Follow the steps below to map your data correctly.</p>\n      </div>\n\n      {/* Progress Stepper */}\n      <div className=\"relative\">\n        <div className=\"absolute top-1/2 left-0 w-full h-0.5 bg-border/60 -z-10 transform -translate-y-1/2 hidden md:block\"></div>\n        <div className=\"flex flex-wrap justify-center md:justify-between items-center max-w-3xl mx-auto gap-4 md:gap-0\">\n          {STEPS.map((s) => {\n            const isActive = s.id === step;\n            const isCompleted = s.id < step;\n            const Icon = s.icon;\n            \n            return (\n              <div key={s.id} className=\"flex flex-col items-center gap-3 bg-background px-2 min-w-[80px]\">\n                <div className={cn(\n                  \"h-12 w-12 rounded-full flex items-center justify-center border-2 transition-all duration-300\",\n                  isActive \n                    ? \"border-primary bg-primary text-primary-foreground shadow-[0_0_0_4px_rgba(63,125,232,0.2)]\" \n                    : isCompleted \n                      ? \"border-primary bg-primary text-primary-foreground\" \n                      : \"border-border bg-secondary/30 text-muted-foreground\"\n                )}>\n                  {isCompleted ? <CheckCircle2 className=\"h-6 w-6\" /> : <Icon className=\"h-5 w-5\" />}\n                </div>\n                <span className={cn(\n                  \"text-xs md:text-sm font-medium transition-colors text-center\",\n                  isActive || isCompleted ? \"text-foreground\" : \"text-muted-foreground\"\n                )}>\n                  {s.name}\n                </span>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n\n      <Card className=\"border-border/60 shadow-lg overflow-hidden min-h-[400px]\">\n        <CardContent className=\"p-0\">\n          \n          {/* STEP 1: UPLOAD */}\n          {step === 1 && (\n            <div className=\"p-6 md:p-12 flex flex-col items-center justify-center text-center animate-in fade-in slide-in-from-bottom-4 duration-500\">\n              <div \n                className={cn(\n                  \"w-full max-w-xl border-2 border-dashed rounded-2xl p-6 md:p-12 flex flex-col items-center justify-center gap-4 transition-all cursor-pointer group\",\n                  file ? \"border-primary bg-primary/5\" : \"border-border hover:border-primary/50 hover:bg-secondary/30\"\n                )}\n                onClick={() => !file && setFile(new File([\"\"], \"invoices_jan_2024.csv\"))} // Mock file select\n              >\n                <div className=\"h-20 w-20 bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center mb-2 group-hover:scale-110 transition-transform\">\n                  <UploadCloud className=\"h-10 w-10 text-primary\" />\n                </div>\n                \n                {file ? (\n                  <div className=\"space-y-2\">\n                    <p className=\"text-lg font-semibold text-foreground\">{file.name}</p>\n                    <p className=\"text-sm text-muted-foreground\">{(file.size / 1024).toFixed(2)} KB  CSV File</p>\n                    <Button variant=\"ghost\" size=\"sm\" className=\"text-destructive hover:bg-destructive/10 mt-2\" onClick={(e) => {\n                      e.stopPropagation();\n                      setFile(null);\n                    }}>\n                      Remove File\n                    </Button>\n                  </div>\n                ) : (\n                  <>\n                    <h3 className=\"text-xl font-semibold text-foreground\">Drag & Drop your file here</h3>\n                    <p className=\"text-muted-foreground\">or click to browse (CSV, TSV, XLS)</p>\n                    <p className=\"text-xs text-muted-foreground mt-4 bg-secondary/50 px-3 py-1 rounded-full\">Max file size: 10MB</p>\n                  </>\n                )}\n              </div>\n              \n              <div className=\"mt-8 flex gap-4 text-sm text-muted-foreground\">\n                 <a href=\"#\" className=\"flex items-center gap-1 hover:text-primary transition-colors\">\n                    <FileSpreadsheet className=\"h-4 w-4\" /> Download Sample Template\n                 </a>\n              </div>\n            </div>\n          )}\n\n          {/* STEP 2: CONFIGURE */}\n          {step === 2 && (\n             <div className=\"p-8 max-w-3xl mx-auto space-y-8 animate-in fade-in slide-in-from-right-8 duration-300\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                   <div className=\"space-y-4\">\n                      <div className=\"space-y-2\">\n                         <Label>Character Encoding</Label>\n                         <Select defaultValue=\"utf8\">\n                            <SelectTrigger><SelectValue /></SelectTrigger>\n                            <SelectContent>\n                               <SelectItem value=\"utf8\">UTF-8 (Recommended)</SelectItem>\n                               <SelectItem value=\"ascii\">ASCII</SelectItem>\n                            </SelectContent>\n                         </Select>\n                      </div>\n                      <div className=\"space-y-2\">\n                         <Label>Date Format</Label>\n                         <Select defaultValue=\"ymd\">\n                            <SelectTrigger><SelectValue /></SelectTrigger>\n                            <SelectContent>\n                               <SelectItem value=\"ymd\">YYYY-MM-DD</SelectItem>\n                               <SelectItem value=\"dmy\">DD-MM-YYYY</SelectItem>\n                               <SelectItem value=\"mdy\">MM-DD-YYYY</SelectItem>\n                            </SelectContent>\n                         </Select>\n                      </div>\n                      <div className=\"space-y-2\">\n                         <Label>File Delimiter</Label>\n                         <Select defaultValue=\"comma\">\n                            <SelectTrigger><SelectValue /></SelectTrigger>\n                            <SelectContent>\n                               <SelectItem value=\"comma\">Comma (,)</SelectItem>\n                               <SelectItem value=\"semi\">Semicolon (;)</SelectItem>\n                               <SelectItem value=\"tab\">Tab (\\t)</SelectItem>\n                            </SelectContent>\n                         </Select>\n                      </div>\n                   </div>\n\n                   <div className=\"space-y-6 bg-secondary/10 p-6 rounded-xl border border-border/50\">\n                      <h4 className=\"font-medium text-foreground\">Import Preferences</h4>\n                      <div className=\"flex items-center justify-between\">\n                         <Label htmlFor=\"auto-gen\" className=\"cursor-pointer\">Auto-Generate Invoice Numbers</Label>\n                         <Switch id=\"auto-gen\" defaultChecked />\n                      </div>\n                       <div className=\"flex items-center justify-between\">\n                         <Label htmlFor=\"link-orders\" className=\"cursor-pointer\">Link Related Sales Orders</Label>\n                         <Switch id=\"link-orders\" />\n                      </div>\n                      <div className=\"flex items-center justify-between\">\n                         <Label htmlFor=\"map-addr\" className=\"cursor-pointer\">Map Address to Existing Customers</Label>\n                         <Switch id=\"map-addr\" defaultChecked />\n                      </div>\n                       <div className=\"pt-4 border-t border-border/40\">\n                         <div className=\"flex items-center gap-2\">\n                            <Checkbox id=\"save-settings\" />\n                            <Label htmlFor=\"save-settings\" className=\"text-muted-foreground font-normal\">Save these settings for future imports</Label>\n                         </div>\n                       </div>\n                   </div>\n                </div>\n             </div>\n          )}\n\n          {/* STEP 3: MAP FIELDS */}\n          {step === 3 && (\n            <div className=\"p-0 animate-in fade-in slide-in-from-right-8 duration-300\">\n               <div className=\"bg-secondary/10 border-b border-border/60 p-4 px-8 flex items-center gap-2 text-sm text-muted-foreground\">\n                  <AlertCircle className=\"h-4 w-4 text-blue-500\" />\n                  <span>We matched <strong>8 of 12</strong> columns automatically based on your header row.</span>\n               </div>\n               <div className=\"max-h-[500px] overflow-auto\">\n                  <Table>\n                     <TableHeader>\n                        <TableRow className=\"bg-secondary/20\">\n                           <TableHead className=\"w-[30%] pl-8\">File Header (CSV)</TableHead>\n                           <TableHead className=\"w-[5%] text-center\"></TableHead>\n                           <TableHead className=\"w-[30%]\">System Field</TableHead>\n                           <TableHead className=\"w-[35%]\">Preview Data (Row 1)</TableHead>\n                        </TableRow>\n                     </TableHeader>\n                     <TableBody>\n                        {[\n                           { csv: \"Invoice No\", sys: \"Invoice Number\", data: \"INV-001\" },\n                           { csv: \"Customer Name\", sys: \"Customer Name\", data: \"Acme Corp\" },\n                           { csv: \"Email Address\", sys: \"Customer Email\", data: \"billing@acme.com\" },\n                           { csv: \"Issue Date\", sys: \"Invoice Date\", data: \"2023-10-24\" },\n                           { csv: \"Due Date\", sys: \"Due Date\", data: \"2023-11-24\" },\n                           { csv: \"Item Desc\", sys: \"Item Name\", data: \"Web Development\" },\n                           { csv: \"Qty\", sys: \"Quantity\", data: \"10\" },\n                           { csv: \"Price\", sys: \"Rate\", data: \"150.00\" },\n                           { csv: \"Tax Code\", sys: \"Unmapped\", data: \"GST_10\", warn: true },\n                        ].map((row, i) => (\n                           <TableRow key={i} className=\"hover:bg-secondary/5\">\n                              <TableHead className=\"pl-8 font-medium text-foreground\">{row.csv}</TableHead>\n                              <TableCell className=\"text-center text-muted-foreground\"><ArrowRight className=\"h-4 w-4 mx-auto\" /></TableCell>\n                              <TableCell>\n                                 <Select defaultValue={row.sys === \"Unmapped\" ? \"\" : row.sys.toLowerCase().replace(\" \", \"_\")}>\n                                    <SelectTrigger className={cn(\"h-9\", row.warn && \"border-yellow-500 bg-yellow-50 dark:bg-yellow-900/20\")}>\n                                       <SelectValue placeholder=\"Select field...\" />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                       <SelectItem value=\"invoice_number\">Invoice Number</SelectItem>\n                                       <SelectItem value=\"customer_name\">Customer Name</SelectItem>\n                                       <SelectItem value=\"customer_email\">Customer Email</SelectItem>\n                                       <SelectItem value=\"invoice_date\">Invoice Date</SelectItem>\n                                       <SelectItem value=\"due_date\">Due Date</SelectItem>\n                                       <SelectItem value=\"item_name\">Item Name</SelectItem>\n                                       <SelectItem value=\"quantity\">Quantity</SelectItem>\n                                       <SelectItem value=\"rate\">Rate</SelectItem>\n                                       <SelectItem value=\"ignore\">-- Ignore Column --</SelectItem>\n                                    </SelectContent>\n                                 </Select>\n                              </TableCell>\n                              <TableCell className=\"text-muted-foreground text-sm font-mono\">{row.data}</TableCell>\n                           </TableRow>\n                        ))}\n                     </TableBody>\n                  </Table>\n               </div>\n            </div>\n          )}\n\n          {/* STEP 4: PREVIEW */}\n          {step === 4 && (\n             <div className=\"p-8 space-y-6 animate-in fade-in slide-in-from-right-8 duration-300\">\n                <div className=\"grid grid-cols-3 gap-4 mb-6\">\n                   <Card className=\"bg-green-50/50 dark:bg-green-900/10 border-green-200/50 dark:border-green-800/30\">\n                      <CardContent className=\"p-4 flex flex-col items-center justify-center text-center\">\n                         <span className=\"text-3xl font-bold text-green-600 dark:text-green-400\">24</span>\n                         <span className=\"text-sm text-green-700 dark:text-green-300 font-medium\">Ready to Import</span>\n                      </CardContent>\n                   </Card>\n                   <Card className=\"bg-yellow-50/50 dark:bg-yellow-900/10 border-yellow-200/50 dark:border-yellow-800/30\">\n                      <CardContent className=\"p-4 flex flex-col items-center justify-center text-center\">\n                         <span className=\"text-3xl font-bold text-yellow-600 dark:text-yellow-400\">3</span>\n                         <span className=\"text-sm text-yellow-700 dark:text-yellow-300 font-medium\">Warnings</span>\n                      </CardContent>\n                   </Card>\n                   <Card className=\"bg-red-50/50 dark:bg-red-900/10 border-red-200/50 dark:border-red-800/30\">\n                      <CardContent className=\"p-4 flex flex-col items-center justify-center text-center\">\n                         <span className=\"text-3xl font-bold text-red-600 dark:text-red-400\">0</span>\n                         <span className=\"text-sm text-red-700 dark:text-red-300 font-medium\">Errors</span>\n                      </CardContent>\n                   </Card>\n                </div>\n\n                <div className=\"rounded-md border border-border/60 overflow-hidden\">\n                   <Table>\n                      <TableHeader className=\"bg-secondary/20\">\n                         <TableRow>\n                            <TableHead>Status</TableHead>\n                            <TableHead>Invoice #</TableHead>\n                            <TableHead>Customer</TableHead>\n                            <TableHead>Date</TableHead>\n                            <TableHead className=\"text-right\">Total</TableHead>\n                         </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                         <TableRow>\n                            <TableCell><Badge className=\"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 shadow-none border-green-200\">Valid</Badge></TableCell>\n                            <TableCell>INV-001</TableCell>\n                            <TableCell>Acme Corp</TableCell>\n                            <TableCell>Oct 24, 2023</TableCell>\n                            <TableCell className=\"text-right\">$1,500.00</TableCell>\n                         </TableRow>\n                         <TableRow>\n                            <TableCell><Badge className=\"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 shadow-none border-green-200\">Valid</Badge></TableCell>\n                            <TableCell>INV-002</TableCell>\n                            <TableCell>Globex Inc</TableCell>\n                            <TableCell>Oct 25, 2023</TableCell>\n                            <TableCell className=\"text-right\">$2,450.00</TableCell>\n                         </TableRow>\n                         <TableRow>\n                            <TableCell><Badge variant=\"outline\" className=\"bg-yellow-50 text-yellow-700 border-yellow-200\">Check Tax</Badge></TableCell>\n                            <TableCell>INV-003</TableCell>\n                            <TableCell>Soylent Corp</TableCell>\n                            <TableCell>Oct 26, 2023</TableCell>\n                            <TableCell className=\"text-right\">$500.00</TableCell>\n                         </TableRow>\n                      </TableBody>\n                   </Table>\n                </div>\n             </div>\n          )}\n        </CardContent>\n        \n        {/* Footer Actions */}\n        <div className=\"bg-secondary/10 p-6 border-t border-border/60 flex justify-between items-center\">\n          <Button variant=\"ghost\" onClick={handleBack} disabled={step === 1}>\n            Back\n          </Button>\n          \n          <div className=\"flex gap-3\">\n            <Button variant=\"outline\" asChild>\n              <a href=\"/dashboard\">Cancel</a>\n            </Button>\n            <Button \n              onClick={handleNext} \n              disabled={step === 1 && !file}\n              className=\"bg-primary text-primary-foreground shadow-md hover:bg-primary/90\"\n            >\n              {step === 4 ? \"Start Import\" : \"Next Step\"}\n              {step !== 4 && <ArrowRight className=\"ml-2 h-4 w-4\" />}\n            </Button>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":18613,"size_tokens":null},"client/src/modules/purchases/pages/BillsPage.tsx":{"content":"export { default } from '@/pages/bills';\n","path":null,"size_bytes":41,"size_tokens":null},"client/src/modules/settings/pages/SupportPage.tsx":{"content":"export { default } from '@/pages/support';\n","path":null,"size_bytes":43,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/modules/banking/pages/BankingPage.tsx":{"content":"export { default } from '@/pages/banking';\n","path":null,"size_bytes":43,"size_tokens":null},"client/src/modules/sales/pages/EstimatesPage.tsx":{"content":"export { default } from '@/pages/estimates';\n","path":null,"size_bytes":45,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4419,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":768,"size_tokens":null},"client/src/modules/customers/pages/CustomerCreatePage.tsx":{"content":"export { default } from '@/pages/customer-create';\n","path":null,"size_bytes":51,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\n      \"max-h-[280px] overflow-y-auto overflow-x-hidden overscroll-contain\",\n      \"[&::-webkit-scrollbar]:w-1.5 [&::-webkit-scrollbar-track]:bg-slate-100 [&::-webkit-scrollbar-thumb]:bg-slate-300 [&::-webkit-scrollbar-thumb]:rounded-full\",\n      className\n    )}\n    style={{ scrollBehavior: 'auto' }}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":5127,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"grid place-content-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1031,"size_tokens":null},"client/src/modules/accounting/pages/index.ts":{"content":"export { default as TimeTrackingPage } from './TimeTrackingPage';\nexport { default as FilingCompliancePage } from './FilingCompliancePage';\nexport { default as AccountantPage } from './AccountantPage';\n","path":null,"size_bytes":202,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"import * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3007,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n      {children}\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4280,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1148,"size_tokens":null},"client/src/modules/banking/pages/index.ts":{"content":"export { default as BankingPage } from './BankingPage';\n","path":null,"size_bytes":56,"size_tokens":null},"server/src/middleware/index.ts":{"content":"export { authenticate, requireRole, optionalAuth, AuthenticatedRequest } from './auth';\nexport { errorHandler, notFoundHandler, AppError, ValidationError, NotFoundError, UnauthorizedError, ForbiddenError } from './errorHandler';\nexport { requestLogger, createLogger } from './logger';\nexport { validate } from './validate';\n","path":null,"size_bytes":324,"size_tokens":null},"server/src/api/v1/index.ts":{"content":"import { Router } from 'express';\nimport { itemsRouter } from '../../modules/items/routes';\nimport { salesRouter } from '../../modules/sales/routes';\nimport { purchasesRouter } from '../../modules/purchases/routes';\nimport { customersRouter } from '../../modules/customers/routes';\nimport { vendorsRouter } from '../../modules/vendors/routes';\nimport { expensesRouter } from '../../modules/expenses/routes';\nimport { bankingRouter } from '../../modules/banking/routes';\nimport { reportsRouter } from '../../modules/reports/routes';\nimport { authRouter } from '../../modules/auth/routes';\n\nexport const apiRouter = Router();\n\n// Mount module routers\napiRouter.use('/auth', authRouter);\napiRouter.use('/items', itemsRouter);\napiRouter.use('/sales', salesRouter);\napiRouter.use('/purchases', purchasesRouter);\napiRouter.use('/customers', customersRouter);\napiRouter.use('/vendors', vendorsRouter);\napiRouter.use('/expenses', expensesRouter);\napiRouter.use('/banking', bankingRouter);\napiRouter.use('/reports', reportsRouter);\n\nexport default apiRouter;\n","path":null,"size_bytes":1050,"size_tokens":null},"server/src/modules/items/controller/index.ts":{"content":"import { Request, Response, NextFunction } from 'express';\nimport { sendSuccess, sendCreated, sendPaginated, sendNoContent } from '../../../common/responses';\nimport { parsePagination } from '../../../utils';\n\nexport class ItemsController {\n  getAll = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const { page, limit } = parsePagination(req.query);\n      // TODO: Implement actual database query\n      const items: any[] = [];\n      const total = 0;\n      \n      return sendPaginated(res, items, page, limit, total);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  getById = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const { id } = req.params;\n      // TODO: Implement actual database query\n      const item = { id };\n      \n      return sendSuccess(res, item);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  create = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const data = req.body;\n      // TODO: Implement actual database insert\n      const item = { id: '1', ...data };\n      \n      return sendCreated(res, item);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  update = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const { id } = req.params;\n      const data = req.body;\n      // TODO: Implement actual database update\n      const item = { id, ...data };\n      \n      return sendSuccess(res, item);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  delete = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const { id } = req.params;\n      // TODO: Implement actual database delete\n      \n      return sendNoContent(res);\n    } catch (error) {\n      next(error);\n    }\n  };\n}\n\nexport default ItemsController;\n","path":null,"size_bytes":1801,"size_tokens":null},"client/src/components/ui/item.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction ItemGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      role=\"list\"\n      data-slot=\"item-group\"\n      className={cn(\"group/item-group flex flex-col\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"item-separator\"\n      orientation=\"horizontal\"\n      className={cn(\"my-0\", className)}\n      {...props}\n    />\n  )\n}\n\nconst itemVariants = cva(\n  \"group/item [a]:hover:bg-accent/50 focus-visible:border-ring focus-visible:ring-ring/50 [a]:transition-colors flex flex-wrap items-center rounded-md border border-transparent text-sm outline-none transition-colors duration-100 focus-visible:ring-[3px]\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline: \"border-border\",\n        muted: \"bg-muted/50\",\n      },\n      size: {\n        default: \"gap-4 p-4 \",\n        sm: \"gap-2.5 px-4 py-3\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction Item({\n  className,\n  variant = \"default\",\n  size = \"default\",\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> &\n  VariantProps<typeof itemVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n  return (\n    <Comp\n      data-slot=\"item\"\n      data-variant={variant}\n      data-size={size}\n      className={cn(itemVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nconst itemMediaVariants = cva(\n  \"flex shrink-0 items-center justify-center gap-2 group-has-[[data-slot=item-description]]/item:translate-y-0.5 group-has-[[data-slot=item-description]]/item:self-start [&_svg]:pointer-events-none\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted size-8 rounded-sm border [&_svg:not([class*='size-'])]:size-4\",\n        image:\n          \"size-10 overflow-hidden rounded-sm [&_img]:size-full [&_img]:object-cover\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction ItemMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof itemMediaVariants>) {\n  return (\n    <div\n      data-slot=\"item-media\"\n      data-variant={variant}\n      className={cn(itemMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction ItemContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-content\"\n      className={cn(\n        \"flex flex-1 flex-col gap-1 [&+[data-slot=item-content]]:flex-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-title\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"item-description\"\n      className={cn(\n        \"text-muted-foreground line-clamp-2 text-balance text-sm font-normal leading-normal\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemActions({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-actions\"\n      className={cn(\"flex items-center gap-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-header\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-footer\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Item,\n  ItemMedia,\n  ItemContent,\n  ItemActions,\n  ItemGroup,\n  ItemSeparator,\n  ItemTitle,\n  ItemDescription,\n  ItemHeader,\n  ItemFooter,\n}\n","path":null,"size_bytes":4494,"size_tokens":null},"client/src/modules/documents/pages/index.ts":{"content":"export { default as DocumentsPage } from './DocumentsPage';\n","path":null,"size_bytes":60,"size_tokens":null},"client/src/pages/invoices.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { jsPDF } from \"jspdf\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport {\n    Plus,\n    Download,\n    Send,\n    MoreHorizontal,\n    Trash2,\n    Pencil,\n    MessageSquare,\n    CreditCard,\n    HelpCircle,\n    Mail,\n    Printer,\n    Copy,\n    X,\n    Menu,\n    Search,\n    Filter,\n    ChevronDown,\n    CheckCircle,\n    Clock,\n    AlertCircle,\n    Share2,\n    FileText,\n    Repeat,\n    FileCheck,\n    Truck,\n    Ban,\n    BookOpen,\n    Settings,\n    RotateCcw\n} from \"lucide-react\";\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuSeparator,\n    DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogFooter,\n    DialogHeader,\n    DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { usePagination } from \"@/hooks/use-pagination\";\nimport { TablePagination } from \"@/components/table-pagination\";\n\ninterface InvoiceListItem {\n    id: string;\n    invoiceNumber: string;\n    customerName: string;\n    customerId: string;\n    date: string;\n    dueDate: string;\n    amount: number;\n    status: string;\n    terms: string;\n    balanceDue: number;\n}\n\ninterface InvoiceDetail {\n    id: string;\n    invoiceNumber: string;\n    referenceNumber: string;\n    date: string;\n    dueDate: string;\n    customerId: string;\n    customerName: string;\n    billingAddress: {\n        street: string;\n        city: string;\n        state: string;\n        country: string;\n        pincode: string;\n    };\n    shippingAddress: {\n        street: string;\n        city: string;\n        state: string;\n        country: string;\n        pincode: string;\n    };\n    salesperson: string;\n    placeOfSupply: string;\n    paymentTerms: string;\n    items: any[];\n    subTotal: number;\n    shippingCharges: number;\n    cgst: number;\n    sgst: number;\n    igst: number;\n    adjustment: number;\n    total: number;\n    amountPaid: number;\n    balanceDue: number;\n    customerNotes: string;\n    termsAndConditions: string;\n    status: string;\n    sourceType: string | null;\n    sourceNumber: string | null;\n    payments: any[];\n    activityLogs: any[];\n    createdAt: string;\n    amountRefunded?: number;\n    refunds?: any[];\n}\n\nconst formatCurrency = (amount: number) => {\n    return `${amount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n};\n\nconst formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-IN', { day: '2-digit', month: '2-digit', year: 'numeric' });\n};\n\nconst formatDateTime = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleString('en-IN', {\n        day: '2-digit',\n        month: '2-digit',\n        year: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit',\n        hour12: true\n    });\n};\n\nconst formatAddress = (address: any) => {\n    if (!address) return ['-'];\n    const parts = [address.street, address.city, address.state, address.country, address.pincode].filter(Boolean);\n    return parts.length > 0 ? parts : ['-'];\n};\n\nconst getStatusColor = (status: string) => {\n    switch (status.toUpperCase()) {\n        case 'PAID':\n            return 'bg-green-100 text-green-700 border-green-200';\n        case 'PENDING':\n            return 'bg-orange-100 text-orange-700 border-orange-200';\n        case 'OVERDUE':\n            return 'bg-red-100 text-red-700 border-red-200';\n        case 'DRAFT':\n            return 'bg-slate-100 text-slate-600 border-slate-200';\n        case 'SENT':\n            return 'bg-blue-100 text-blue-700 border-blue-200';\n        case 'PARTIALLY_PAID':\n            return 'bg-yellow-100 text-yellow-700 border-yellow-200';\n        default:\n            return 'bg-slate-100 text-slate-600 border-slate-200';\n    }\n};\n\nconst getActivityIcon = (action: string) => {\n    switch (action) {\n        case 'created':\n            return <div className=\"w-3 h-3 rounded-full bg-green-500\" />;\n        case 'sent':\n            return <div className=\"w-3 h-3 rounded-full bg-blue-500\" />;\n        case 'paid':\n            return <div className=\"w-3 h-3 rounded-full bg-green-500\" />;\n        case 'payment_recorded':\n            return <div className=\"w-3 h-3 rounded-full bg-emerald-500\" />;\n        case 'updated':\n            return <div className=\"w-3 h-3 rounded-full bg-yellow-500\" />;\n        default:\n            return <div className=\"w-3 h-3 rounded-full bg-slate-400\" />;\n    }\n};\n\nexport default function Invoices() {\n    const [, setLocation] = useLocation();\n    const { toast } = useToast();\n    const [invoices, setInvoices] = useState<InvoiceListItem[]>([]);\n    const [selectedInvoice, setSelectedInvoice] = useState<InvoiceDetail | null>(null);\n    const [selectedInvoices, setSelectedInvoices] = useState<string[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [searchTerm, setSearchTerm] = useState(\"\");\n    const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n    const [invoiceToDelete, setInvoiceToDelete] = useState<string | null>(null);\n    const [activeTab, setActiveTab] = useState(\"whats-next\");\n    const [paymentDialogOpen, setPaymentDialogOpen] = useState(false);\n    const [paymentAmount, setPaymentAmount] = useState(\"\");\n    const [paymentMode, setPaymentMode] = useState(\"cash\");\n    const [paymentDate, setPaymentDate] = useState(new Date().toISOString().split('T')[0]);\n    const [paymentTime, setPaymentTime] = useState(new Date().toTimeString().slice(0, 5));\n    const [voidDialogOpen, setVoidDialogOpen] = useState(false);\n    const [recurringDialogOpen, setRecurringDialogOpen] = useState(false);\n    const [journalDialogOpen, setJournalDialogOpen] = useState(false);\n    const [preferencesDialogOpen, setPreferencesDialogOpen] = useState(false);\n    const [refundDialogOpen, setRefundDialogOpen] = useState(false);\n    const [refundAmount, setRefundAmount] = useState(\"\");\n    const [refundMode, setRefundMode] = useState(\"Cash\");\n    const [refundReason, setRefundReason] = useState(\"\");\n\n    useEffect(() => {\n        fetchInvoices();\n    }, []);\n\n    const fetchInvoices = async () => {\n        try {\n            const response = await fetch('/api/invoices');\n            if (response.ok) {\n                const data = await response.json();\n                setInvoices(data.data || []);\n            }\n        } catch (error) {\n            console.error('Failed to fetch invoices:', error);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const fetchInvoiceDetail = async (id: string) => {\n        try {\n            const response = await fetch(`/api/invoices/${id}`);\n            if (response.ok) {\n                const data = await response.json();\n                setSelectedInvoice(data.data);\n            }\n        } catch (error) {\n            console.error('Failed to fetch invoice detail:', error);\n        }\n    };\n\n    const handleInvoiceClick = (invoice: InvoiceListItem) => {\n        fetchInvoiceDetail(invoice.id);\n    };\n\n    const handleClosePanel = () => {\n        setSelectedInvoice(null);\n    };\n\n    const handleEditInvoice = () => {\n        if (selectedInvoice) {\n            setLocation(`/invoices/${selectedInvoice.id}/edit`);\n        }\n    };\n\n    const toggleSelectInvoice = (id: string, e: React.MouseEvent) => {\n        e.stopPropagation();\n        if (selectedInvoices.includes(id)) {\n            setSelectedInvoices(selectedInvoices.filter(i => i !== id));\n        } else {\n            setSelectedInvoices([...selectedInvoices, id]);\n        }\n    };\n\n    const handleDownloadPDF = (invoice: InvoiceDetail) => {\n        const doc = new jsPDF();\n\n        doc.setFontSize(24);\n        doc.setFont(\"helvetica\", \"bold\");\n        doc.text(\"INVOICE\", 190, 30, { align: \"right\" });\n\n        doc.setFontSize(12);\n        doc.setFont(\"helvetica\", \"normal\");\n        doc.text(`# ${invoice.invoiceNumber}`, 190, 38, { align: \"right\" });\n        doc.text(`Balance Due`, 190, 48, { align: \"right\" });\n        doc.setFont(\"helvetica\", \"bold\");\n        doc.text(formatCurrency(invoice.balanceDue), 190, 56, { align: \"right\" });\n\n        doc.setFont(\"helvetica\", \"bold\");\n        doc.setFontSize(14);\n        doc.text(\"Your Company\", 20, 30);\n        doc.setFont(\"helvetica\", \"normal\");\n        doc.setFontSize(10);\n        doc.text(\"123 Business Street\", 20, 38);\n        doc.text(\"City, State 12345\", 20, 44);\n        doc.text(\"India\", 20, 50);\n\n        doc.setFont(\"helvetica\", \"bold\");\n        doc.setFontSize(11);\n        doc.text(\"BILL TO\", 20, 70);\n        doc.setFont(\"helvetica\", \"normal\");\n        doc.setFontSize(10);\n        doc.text(invoice.customerName, 20, 78);\n        const billAddress = formatAddress(invoice.billingAddress);\n        billAddress.forEach((line, i) => {\n            doc.text(line, 20, 84 + (i * 5));\n        });\n\n        doc.text(`Invoice Date: ${formatDate(invoice.date)}`, 120, 78);\n        doc.text(`Terms: ${invoice.paymentTerms}`, 120, 84);\n        doc.text(`Due Date: ${formatDate(invoice.dueDate)}`, 120, 90);\n\n        doc.setDrawColor(200);\n        doc.setLineWidth(0.5);\n        doc.line(20, 110, 190, 110);\n\n        doc.setFont(\"helvetica\", \"bold\");\n        doc.text(\"#\", 20, 118);\n        doc.text(\"Item\", 30, 118);\n        doc.text(\"Qty\", 100, 118);\n        doc.text(\"Rate\", 130, 118);\n        doc.text(\"Amount\", 190, 118, { align: \"right\" });\n\n        doc.line(20, 122, 190, 122);\n\n        let yPos = 130;\n        doc.setFont(\"helvetica\", \"normal\");\n        invoice.items.forEach((item, index) => {\n            doc.text(String(index + 1), 20, yPos);\n            doc.text(item.name || 'Item', 30, yPos);\n            doc.text(String(item.quantity || 1), 100, yPos);\n            doc.text(formatCurrency(item.rate || 0), 130, yPos);\n            doc.text(formatCurrency(item.amount || 0), 190, yPos, { align: \"right\" });\n            yPos += 8;\n        });\n\n        yPos += 10;\n        doc.line(120, yPos, 190, yPos);\n        yPos += 8;\n\n        doc.text(\"Sub Total\", 120, yPos);\n        doc.text(formatCurrency(invoice.subTotal), 190, yPos, { align: \"right\" });\n        yPos += 8;\n\n        if (invoice.cgst > 0) {\n            doc.text(\"CGST\", 120, yPos);\n            doc.text(formatCurrency(invoice.cgst), 190, yPos, { align: \"right\" });\n            yPos += 8;\n        }\n        if (invoice.sgst > 0) {\n            doc.text(\"SGST\", 120, yPos);\n            doc.text(formatCurrency(invoice.sgst), 190, yPos, { align: \"right\" });\n            yPos += 8;\n        }\n\n        doc.setFont(\"helvetica\", \"bold\");\n        doc.text(\"Total\", 120, yPos);\n        doc.text(formatCurrency(invoice.total), 190, yPos, { align: \"right\" });\n        yPos += 8;\n\n        if (invoice.amountPaid > 0) {\n            doc.setFont(\"helvetica\", \"normal\");\n            doc.text(\"Payment Made\", 120, yPos);\n            doc.text(`(-) ${formatCurrency(invoice.amountPaid)}`, 190, yPos, { align: \"right\" });\n            yPos += 8;\n        }\n\n        doc.setFont(\"helvetica\", \"bold\");\n        doc.text(\"Balance Due\", 120, yPos);\n        doc.text(formatCurrency(invoice.balanceDue), 190, yPos, { align: \"right\" });\n\n        doc.setFontSize(8);\n        doc.setFont(\"helvetica\", \"normal\");\n        doc.text(`Generated on: ${new Date().toLocaleString()}`, 105, 280, { align: \"center\" });\n\n        doc.save(`${invoice.invoiceNumber}.pdf`);\n\n        toast({\n            title: \"PDF Downloaded\",\n            description: `${invoice.invoiceNumber}.pdf has been downloaded successfully.`,\n        });\n    };\n\n    const handleSendInvoice = async () => {\n        if (!selectedInvoice) return;\n        try {\n            const response = await fetch(`/api/invoices/${selectedInvoice.id}/status`, {\n                method: 'PATCH',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ status: 'SENT' })\n            });\n            if (response.ok) {\n                toast({ title: \"Invoice marked as sent\" });\n                fetchInvoiceDetail(selectedInvoice.id);\n                fetchInvoices();\n            }\n        } catch (error) {\n            toast({ title: \"Failed to send invoice\", variant: \"destructive\" });\n        }\n    };\n\n    const handleRecordPayment = async () => {\n        if (!selectedInvoice || !paymentAmount) return;\n        try {\n            // Combine date and time into a single timestamp\n            const paymentDateTime = new Date(`${paymentDate}T${paymentTime}`);\n\n            const response = await fetch(`/api/invoices/${selectedInvoice.id}/record-payment`, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    amount: parseFloat(paymentAmount),\n                    paymentMode: paymentMode,\n                    date: paymentDateTime.toISOString()\n                })\n            });\n            if (response.ok) {\n                toast({ title: \"Payment recorded successfully\" });\n                setPaymentDialogOpen(false);\n                setPaymentAmount(\"\");\n                setPaymentDate(new Date().toISOString().split('T')[0]);\n                setPaymentTime(new Date().toTimeString().slice(0, 5));\n                fetchInvoiceDetail(selectedInvoice.id);\n                fetchInvoices();\n            }\n        } catch (error) {\n            toast({ title: \"Failed to record payment\", variant: \"destructive\" });\n        }\n    };\n\n    const getRefundableAmount = () => {\n        if (!selectedInvoice) return 0;\n        return selectedInvoice.amountPaid || 0;\n    };\n\n    const handleRefund = async () => {\n        if (!selectedInvoice || !refundAmount) return;\n        const amount = parseFloat(refundAmount);\n        const refundableAmount = getRefundableAmount();\n        if (amount <= 0) {\n            toast({ title: \"Refund amount must be greater than 0\", variant: \"destructive\" });\n            return;\n        }\n        if (amount > refundableAmount) {\n            toast({ title: `Refund amount cannot exceed refundable balance of ${formatCurrency(refundableAmount)}`, variant: \"destructive\" });\n            return;\n        }\n        try {\n            const response = await fetch(`/api/invoices/${selectedInvoice.id}/refund`, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    amount: amount,\n                    mode: refundMode,\n                    reason: refundReason || 'Refund processed'\n                })\n            });\n            if (response.ok) {\n                toast({ title: \"Refund processed successfully\" });\n                setRefundDialogOpen(false);\n                setRefundAmount(\"\");\n                setRefundReason(\"\");\n                fetchInvoiceDetail(selectedInvoice.id);\n                fetchInvoices();\n            } else {\n                const errorData = await response.json();\n                toast({ title: errorData.message || \"Failed to process refund\", variant: \"destructive\" });\n            }\n        } catch (error) {\n            toast({ title: \"Failed to process refund\", variant: \"destructive\" });\n        }\n    };\n\n    const handleDeleteClick = () => {\n        if (selectedInvoice) {\n            setInvoiceToDelete(selectedInvoice.id);\n            setDeleteDialogOpen(true);\n        }\n    };\n\n    const confirmDelete = async () => {\n        if (!invoiceToDelete) return;\n        try {\n            const response = await fetch(`/api/invoices/${invoiceToDelete}`, { method: 'DELETE' });\n            if (response.ok) {\n                toast({ title: \"Invoice deleted successfully\" });\n                handleClosePanel();\n                fetchInvoices();\n            }\n        } catch (error) {\n            toast({ title: \"Failed to delete invoice\", variant: \"destructive\" });\n        } finally {\n            setDeleteDialogOpen(false);\n            setInvoiceToDelete(null);\n        }\n    };\n\n    const handleMarkAsSent = async () => {\n        if (!selectedInvoice) return;\n        try {\n            const response = await fetch(`/api/invoices/${selectedInvoice.id}/status`, {\n                method: 'PATCH',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ status: 'SENT' })\n            });\n            if (response.ok) {\n                toast({ title: \"Invoice marked as sent\" });\n                fetchInvoiceDetail(selectedInvoice.id);\n                fetchInvoices();\n            }\n        } catch (error) {\n            toast({ title: \"Failed to mark invoice as sent\", variant: \"destructive\" });\n        }\n    };\n\n    const handleMakeRecurring = () => {\n        setRecurringDialogOpen(true);\n    };\n\n    const handleCreateCreditNote = () => {\n        if (selectedInvoice) {\n            setLocation(`/credit-notes/create?fromInvoice=${selectedInvoice.id}`);\n        }\n    };\n\n    const handleAddEWayBillDetails = () => {\n        if (selectedInvoice) {\n            setLocation(`/e-way-bills?fromInvoice=${selectedInvoice.id}`);\n        }\n    };\n\n    const handleCloneInvoice = () => {\n        if (selectedInvoice) {\n            setLocation(`/invoices/new?cloneFrom=${selectedInvoice.id}`);\n        }\n    };\n\n    const handleVoidInvoice = async () => {\n        if (!selectedInvoice) return;\n        try {\n            const response = await fetch(`/api/invoices/${selectedInvoice.id}/status`, {\n                method: 'PATCH',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ status: 'VOID' })\n            });\n            if (response.ok) {\n                toast({ title: \"Invoice voided successfully\" });\n                setVoidDialogOpen(false);\n                fetchInvoiceDetail(selectedInvoice.id);\n                fetchInvoices();\n            }\n        } catch (error) {\n            toast({ title: \"Failed to void invoice\", variant: \"destructive\" });\n        }\n    };\n\n    const handleViewJournal = () => {\n        setJournalDialogOpen(true);\n    };\n\n    const handleInvoicePreferences = () => {\n        setPreferencesDialogOpen(true);\n    };\n\n    const handleShare = () => {\n        if (selectedInvoice) {\n            navigator.clipboard.writeText(`${window.location.origin}/invoices/${selectedInvoice.id}`);\n            toast({ title: \"Link copied to clipboard\" });\n        }\n    };\n\n    const handlePrint = () => {\n        if (selectedInvoice) {\n            handleDownloadPDF(selectedInvoice);\n        }\n    };\n\n    const filteredInvoices = invoices.filter(invoice =>\n        invoice.customerName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        invoice.invoiceNumber.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n\n    const { currentPage, totalPages, totalItems, itemsPerPage, paginatedItems, goToPage } = usePagination(filteredInvoices, 10);\n\n    const getCalculatedStatus = (invoice: InvoiceListItem) => {\n        if (invoice.status === 'PAID') return { label: 'PAID', color: 'text-green-700', bgColor: 'bg-green-100' };\n        if (invoice.status === 'DRAFT') return { label: 'DRAFT', color: 'text-slate-600', bgColor: 'bg-slate-100' };\n        if (invoice.status === 'PARTIALLY_PAID') return { label: 'PARTIALLY PAID', color: 'text-yellow-700', bgColor: 'bg-yellow-100' };\n\n        const today = new Date();\n        today.setHours(0, 0, 0, 0);\n        const dueDate = new Date(invoice.dueDate);\n        dueDate.setHours(0, 0, 0, 0);\n\n        const diffDays = Math.ceil((dueDate.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\n\n        if (diffDays < 0) return { label: 'OVERDUE', color: 'text-red-700', bgColor: 'bg-red-100' };\n        if (diffDays === 0) return { label: 'DUE TODAY', color: 'text-orange-700', bgColor: 'bg-orange-100' };\n        return { label: 'PENDING', color: 'text-orange-600', bgColor: 'bg-orange-100' };\n    };\n\n    return (\n        <div className=\"flex h-[calc(100vh-80px)] animate-in fade-in duration-300\">\n            <div className={`flex-1 flex flex-col overflow-hidden ${selectedInvoice ? 'max-w-md' : ''}`}>\n                <div className=\"flex items-center justify-between p-4\">\n                    <div className=\"flex items-center gap-2\">\n                        <h1 className=\"text-xl font-semibold text-slate-900\">All Invoices</h1>\n                        <span className=\"text-sm text-slate-400\">({invoices.length})</span>\n                        <ChevronDown className=\"h-4 w-4 text-slate-500\" />\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                        <Link href=\"/invoices/new\">\n                            <Button className=\"bg-red-500 hover:bg-red-600 gap-1.5 h-9\" data-testid=\"button-new-invoice\">\n                                <Plus className=\"h-4 w-4\" /> New\n                            </Button>\n                        </Link>\n                        <Button variant=\"outline\" size=\"icon\" className=\"h-9 w-9\">\n                            <Menu className=\"h-4 w-4\" />\n                        </Button>\n                    </div>\n                </div>\n\n                {!selectedInvoice && (\n                    <div className=\"px-4 pb-3 flex items-center gap-2\">\n                        <div className=\"relative flex-1 max-w-sm\">\n                            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400\" />\n                            <Input\n                                placeholder=\"Search invoices...\"\n                                value={searchTerm}\n                                onChange={(e) => setSearchTerm(e.target.value)}\n                                className=\"pl-9\"\n                                data-testid=\"input-search-invoices\"\n                            />\n                        </div>\n                        <Button variant=\"outline\" size=\"sm\" className=\"gap-1.5\">\n                            <Filter className=\"h-4 w-4\" />\n                            Filter\n                        </Button>\n                    </div>\n                )}\n\n                <div className=\"flex-1 overflow-auto border-t border-slate-200\">\n                    {loading ? (\n                        <div className=\"p-8 text-center text-slate-500\">Loading invoices...</div>\n                    ) : filteredInvoices.length === 0 ? (\n                        <div className=\"p-8 text-center text-slate-500\">\n                            <p>No invoices found.</p>\n                            <Link href=\"/invoices/new\">\n                                <Button className=\"mt-4 bg-red-500 hover:bg-red-600\">\n                                    <Plus className=\"h-4 w-4 mr-2\" /> Create your first invoice\n                                </Button>\n                            </Link>\n                        </div>\n                    ) : selectedInvoice ? (\n                        <div className=\"divide-y divide-slate-100\">\n                            {filteredInvoices.map((invoice) => {\n                                const status = getCalculatedStatus(invoice);\n                                return (\n                                    <div\n                                        key={invoice.id}\n                                        className={`p-4 hover:bg-slate-50 cursor-pointer transition-colors ${selectedInvoice?.id === invoice.id ? 'bg-blue-50 border-l-2 border-l-blue-600' : ''\n                                            }`}\n                                        onClick={() => handleInvoiceClick(invoice)}\n                                        data-testid={`card-invoice-${invoice.id}`}\n                                    >\n                                        <div className=\"flex items-start justify-between mb-1\">\n                                            <div className=\"flex items-center gap-2\">\n                                                <Checkbox\n                                                    checked={selectedInvoices.includes(invoice.id)}\n                                                    onClick={(e) => toggleSelectInvoice(invoice.id, e)}\n                                                />\n                                                <span className=\"font-medium text-slate-900 truncate\">{invoice.customerName}</span>\n                                            </div>\n                                            <span className=\"text-sm font-medium text-slate-900\">\n                                                {formatCurrency(invoice.amount)}\n                                            </span>\n                                        </div>\n                                        <div className=\"ml-6 flex items-center gap-2 text-sm\">\n                                            <span className=\"text-blue-600\">{invoice.invoiceNumber}</span>\n                                            <span className=\"text-slate-400\">{formatDate(invoice.date)}</span>\n                                        </div>\n                                        <div className=\"ml-6 mt-1\">\n                                            <Badge className={`text-[10px] px-1.5 py-0 border-0 uppercase ${status.bgColor} ${status.color}`}>\n                                                {status.label}\n                                            </Badge>\n                                        </div>\n                                    </div>\n                                );\n                            })}\n                        </div>\n                    ) : (\n                        <>\n                        <table className=\"w-full\">\n                            <thead className=\"bg-slate-50 sticky top-0\">\n                                <tr>\n                                    <th className=\"w-12 px-4 py-3\">\n                                        <Checkbox />\n                                    </th>\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Date</th>\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Invoice#</th>\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Customer Name</th>\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Status</th>\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Due Date</th>\n                                    <th className=\"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase\">Amount</th>\n                                    <th className=\"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase\">Balance Due</th>\n                                    <th className=\"w-10 px-4 py-3\"></th>\n                                </tr>\n                            </thead>\n                            <tbody className=\"divide-y divide-slate-100\">\n                                {paginatedItems.map((invoice) => {\n                                    const status = getCalculatedStatus(invoice);\n                                    return (\n                                        <tr\n                                            key={invoice.id}\n                                            className=\"hover:bg-slate-50 cursor-pointer\"\n                                            onClick={() => handleInvoiceClick(invoice)}\n                                            data-testid={`row-invoice-${invoice.id}`}\n                                        >\n                                            <td className=\"px-4 py-3\">\n                                                <Checkbox\n                                                    checked={selectedInvoices.includes(invoice.id)}\n                                                    onClick={(e) => toggleSelectInvoice(invoice.id, e)}\n                                                />\n                                            </td>\n                                            <td className=\"px-4 py-3 text-sm text-slate-600\">\n                                                {formatDate(invoice.date)}\n                                            </td>\n                                            <td className=\"px-4 py-3\">\n                                                <span className=\"text-sm text-blue-600 hover:underline\">\n                                                    {invoice.invoiceNumber}\n                                                </span>\n                                            </td>\n                                            <td className=\"px-4 py-3 text-sm text-slate-900 font-medium\">\n                                                {invoice.customerName}\n                                            </td>\n                                            <td className=\"px-4 py-3\">\n                                                <Badge className={`text-[10px] uppercase ${status.bgColor} ${status.color}`}>\n                                                    {status.label}\n                                                </Badge>\n                                            </td>\n                                            <td className=\"px-4 py-3 text-sm text-slate-600\">\n                                                {formatDate(invoice.dueDate)}\n                                            </td>\n                                            <td className=\"px-4 py-3 text-sm text-slate-900 text-right font-medium\">\n                                                {formatCurrency(invoice.amount)}\n                                            </td>\n                                            <td className=\"px-4 py-3 text-sm text-slate-900 text-right font-medium\">\n                                                {formatCurrency(invoice.balanceDue)}\n                                            </td>\n                                            <td className=\"px-4 py-3\">\n                                                <DropdownMenu>\n                                                    <DropdownMenuTrigger asChild onClick={(e) => e.stopPropagation()}>\n                                                        <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n                                                            <MoreHorizontal className=\"h-4 w-4\" />\n                                                        </Button>\n                                                    </DropdownMenuTrigger>\n                                                    <DropdownMenuContent align=\"end\">\n                                                        <DropdownMenuItem onClick={(e) => { e.stopPropagation(); setLocation(`/invoices/${invoice.id}/edit`); }}>Edit</DropdownMenuItem>\n                                                        <DropdownMenuItem onClick={(e) => { e.stopPropagation(); setLocation(`/invoices/create?cloneFrom=${invoice.id}`); }}>Clone</DropdownMenuItem>\n                                                        <DropdownMenuItem onClick={(e) => e.stopPropagation()}>Send</DropdownMenuItem>\n                                                        <DropdownMenuItem onClick={(e) => e.stopPropagation()} className=\"text-red-600\">Delete</DropdownMenuItem>\n                                                    </DropdownMenuContent>\n                                                </DropdownMenu>\n                                            </td>\n                                        </tr>\n                                    );\n                                })}\n                            </tbody>\n                        </table>\n                        <TablePagination\n                            currentPage={currentPage}\n                            totalPages={totalPages}\n                            totalItems={totalItems}\n                            itemsPerPage={itemsPerPage}\n                            onPageChange={goToPage}\n                        />\n                        </>\n                    )}\n                </div>\n            </div>\n\n            {selectedInvoice && (\n                <div className=\"flex-1 flex flex-col bg-white border-l border-slate-200 overflow-hidden\">\n                    <div className=\"flex items-center justify-between px-6 py-4 border-b border-slate-200\">\n                        <h2 className=\"text-xl font-semibold text-slate-900\" data-testid=\"text-invoice-number\">\n                            {selectedInvoice.invoiceNumber}\n                        </h2>\n                        <div className=\"flex items-center gap-2\">\n                            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={() => handleDownloadPDF(selectedInvoice)}>\n                                <Download className=\"h-4 w-4\" />\n                            </Button>\n                            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n                                <Printer className=\"h-4 w-4\" />\n                            </Button>\n                            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={handleSendInvoice}>\n                                <Mail className=\"h-4 w-4\" />\n                            </Button>\n                            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={handleClosePanel}>\n                                <X className=\"h-4 w-4\" />\n                            </Button>\n                        </div>\n                    </div>\n\n                    <div className=\"flex items-center gap-2 px-6 py-3 border-b border-slate-200 overflow-x-auto\">\n                        <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\" onClick={handleEditInvoice} data-testid=\"button-edit-invoice\">\n                            <Pencil className=\"h-3.5 w-3.5\" />\n                            Edit\n                        </Button>\n                        <DropdownMenu>\n                            <DropdownMenuTrigger asChild>\n                                <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\" data-testid=\"button-send-dropdown\">\n                                    <Mail className=\"h-3.5 w-3.5\" />\n                                    Send\n                                    <ChevronDown className=\"h-3 w-3\" />\n                                </Button>\n                            </DropdownMenuTrigger>\n                            <DropdownMenuContent>\n                                <DropdownMenuItem onClick={handleSendInvoice}>Send Email</DropdownMenuItem>\n                                <DropdownMenuItem>Send WhatsApp</DropdownMenuItem>\n                                <DropdownMenuItem>Send SMS</DropdownMenuItem>\n                            </DropdownMenuContent>\n                        </DropdownMenu>\n                        <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\" onClick={handleShare} data-testid=\"button-share-invoice\">\n                            <Share2 className=\"h-3.5 w-3.5\" />\n                            Share\n                        </Button>\n                        <DropdownMenu>\n                            <DropdownMenuTrigger asChild>\n                                <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\" data-testid=\"button-pdf-print\">\n                                    <FileText className=\"h-3.5 w-3.5\" />\n                                    PDF/Print\n                                    <ChevronDown className=\"h-3 w-3\" />\n                                </Button>\n                            </DropdownMenuTrigger>\n                            <DropdownMenuContent>\n                                <DropdownMenuItem onClick={handlePrint}>\n                                    <Download className=\"mr-2 h-4 w-4\" /> Download PDF\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={handlePrint}>\n                                    <Printer className=\"mr-2 h-4 w-4\" /> Print\n                                </DropdownMenuItem>\n                            </DropdownMenuContent>\n                        </DropdownMenu>\n                        <Button variant=\"outline\" size=\"sm\" className=\"h-8 gap-1.5\" onClick={() => setPaymentDialogOpen(true)} data-testid=\"button-record-payment\">\n                            <CreditCard className=\"h-3.5 w-3.5\" />\n                            Record Payment\n                        </Button>\n                        {(selectedInvoice?.amountPaid || 0) > 0 && (\n                            <Button variant=\"outline\" size=\"sm\" className=\"h-8 gap-1.5\" onClick={() => {\n                                setRefundAmount(\"\");\n                                setRefundReason(\"\");\n                                setRefundDialogOpen(true);\n                            }} data-testid=\"button-refund\">\n                                <RotateCcw className=\"h-3.5 w-3.5\" />\n                                Refund\n                            </Button>\n                        )}\n                        <DropdownMenu>\n                            <DropdownMenuTrigger asChild>\n                                <Button variant=\"outline\" size=\"sm\" className=\"h-8\" data-testid=\"button-more-actions\">\n                                    <MoreHorizontal className=\"h-4 w-4\" />\n                                </Button>\n                            </DropdownMenuTrigger>\n                            <DropdownMenuContent align=\"end\" className=\"w-56\">\n                                <DropdownMenuItem onClick={handleMarkAsSent} data-testid=\"menu-mark-as-sent\">\n                                    <CheckCircle className=\"mr-2 h-4 w-4 text-blue-600\" />\n                                    <span className=\"text-blue-600 font-medium\">Mark As Sent</span>\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={handleMakeRecurring} data-testid=\"menu-make-recurring\">\n                                    <Repeat className=\"mr-2 h-4 w-4\" /> Make Recurring\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={handleCreateCreditNote} data-testid=\"menu-create-credit-note\">\n                                    <FileCheck className=\"mr-2 h-4 w-4\" /> Create Credit Note\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={handleAddEWayBillDetails} data-testid=\"menu-add-eway-bill\">\n                                    <Truck className=\"mr-2 h-4 w-4\" /> Add e-Way Bill Details\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={handleCloneInvoice} data-testid=\"menu-clone\">\n                                    <Copy className=\"mr-2 h-4 w-4\" /> Clone\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => setVoidDialogOpen(true)} data-testid=\"menu-void\">\n                                    <Ban className=\"mr-2 h-4 w-4\" /> Void\n                                </DropdownMenuItem>\n                                <DropdownMenuSeparator />\n                                <DropdownMenuItem onClick={handleViewJournal} data-testid=\"menu-view-journal\">\n                                    <BookOpen className=\"mr-2 h-4 w-4\" /> View Journal\n                                </DropdownMenuItem>\n                                <DropdownMenuItem\n                                    className=\"text-destructive focus:text-destructive\"\n                                    onClick={handleDeleteClick}\n                                    data-testid=\"menu-delete-invoice\"\n                                >\n                                    <Trash2 className=\"mr-2 h-4 w-4\" /> Delete\n                                </DropdownMenuItem>\n                                <DropdownMenuSeparator />\n                                <DropdownMenuItem onClick={handleInvoicePreferences} data-testid=\"menu-invoice-preferences\">\n                                    <Settings className=\"mr-2 h-4 w-4\" /> Invoice Preferences\n                                </DropdownMenuItem>\n                            </DropdownMenuContent>\n                        </DropdownMenu>\n                    </div>\n\n                    <Tabs value={activeTab} onValueChange={setActiveTab} className=\"flex-1 flex flex-col overflow-hidden\">\n                        <div className=\"px-6 bg-white border-b border-slate-200\">\n                            <TabsList className=\"h-auto p-0 bg-transparent gap-4\">\n                                <TabsTrigger\n                                    value=\"whats-next\"\n                                    className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-0 py-3\"\n                                >\n                                    <HelpCircle className=\"h-3.5 w-3.5 mr-1.5\" />\n                                    What's Next\n                                </TabsTrigger>\n                                <TabsTrigger\n                                    value=\"comments\"\n                                    className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-0 py-3\"\n                                >\n                                    <MessageSquare className=\"h-3.5 w-3.5 mr-1.5\" />\n                                    Comments & History\n                                </TabsTrigger>\n                                {/* Payments tab removed - merged into Comments & History */}\n                            </TabsList>\n                        </div>\n\n                        <ScrollArea className=\"flex-1\">\n                            <TabsContent value=\"whats-next\" className=\"m-0 p-6\">\n                                <div className=\"bg-purple-50 rounded-lg border border-purple-100 p-4 flex items-start gap-4 mb-6\">\n                                    <div className=\"h-10 w-10 rounded-full bg-purple-100 flex items-center justify-center flex-shrink-0\">\n                                        <Send className=\"h-5 w-5 text-purple-600\" />\n                                    </div>\n                                    <div className=\"flex-1\">\n                                        <h4 className=\"font-medium text-slate-900\">Send the Invoice</h4>\n                                        <p className=\"text-sm text-slate-600 mt-1\">\n                                            Invoice has been created. You can now email this invoice to your customer or mark it as sent.\n                                        </p>\n                                        <div className=\"flex items-center gap-2 mt-3\">\n                                            <Button variant=\"outline\" size=\"sm\" onClick={handleSendInvoice}>\n                                                Mark as Sent\n                                            </Button>\n                                            <Button size=\"sm\" className=\"gap-1.5 bg-blue-600 hover:bg-blue-700\">\n                                                <Send className=\"h-3.5 w-3.5\" /> Send Invoice\n                                            </Button>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div className=\"space-y-6\">\n                                    <div className=\"bg-white rounded-lg border border-slate-200 p-6\">\n                                        <div className=\"flex items-start justify-between mb-6\">\n                                            <div>\n                                                <h3 className=\"text-lg font-bold text-slate-900\">Your Company</h3>\n                                                <p className=\"text-sm text-slate-500\">123 Business Street</p>\n                                                <p className=\"text-sm text-slate-500\">City, State 12345</p>\n                                                <p className=\"text-sm text-slate-500\">India</p>\n                                            </div>\n                                            <div className=\"text-right\">\n                                                <Badge className={getStatusColor(selectedInvoice.status)}>\n                                                    {selectedInvoice.status}\n                                                </Badge>\n                                                <h2 className=\"text-2xl font-bold text-blue-600 mt-2\">INVOICE</h2>\n                                                <p className=\"text-sm text-slate-500\"># {selectedInvoice.invoiceNumber}</p>\n                                                <p className=\"text-sm text-slate-500 mt-2\">Balance Due</p>\n                                                <p className=\"text-xl font-bold text-slate-900\">{formatCurrency(selectedInvoice.balanceDue)}</p>\n                                            </div>\n                                        </div>\n\n                                        <div className=\"grid grid-cols-2 gap-8 py-4 border-y border-slate-200\">\n                                            <div>\n                                                <p className=\"text-xs text-slate-500 uppercase mb-1\">Bill To</p>\n                                                <p className=\"font-medium text-blue-600\">{selectedInvoice.customerName}</p>\n                                                {formatAddress(selectedInvoice.billingAddress).map((line, i) => (\n                                                    <p key={i} className=\"text-sm text-slate-600\">{line}</p>\n                                                ))}\n                                            </div>\n                                            <div className=\"text-sm space-y-1\">\n                                                <div className=\"flex justify-between\">\n                                                    <span className=\"text-slate-500\">Invoice Date</span>\n                                                    <span>{formatDate(selectedInvoice.date)}</span>\n                                                </div>\n                                                <div className=\"flex justify-between\">\n                                                    <span className=\"text-slate-500\">Terms</span>\n                                                    <span>{selectedInvoice.paymentTerms}</span>\n                                                </div>\n                                                <div className=\"flex justify-between\">\n                                                    <span className=\"text-slate-500\">Due Date</span>\n                                                    <span>{formatDate(selectedInvoice.dueDate)}</span>\n                                                </div>\n                                            </div>\n                                        </div>\n\n                                        <table className=\"w-full mt-4\">\n                                            <thead>\n                                                <tr className=\"border-b border-slate-200\">\n                                                    <th className=\"py-2 text-left text-xs font-medium text-slate-500 uppercase\">#</th>\n                                                    <th className=\"py-2 text-left text-xs font-medium text-slate-500 uppercase\">Item & Description</th>\n                                                    <th className=\"py-2 text-center text-xs font-medium text-slate-500 uppercase\">Qty</th>\n                                                    <th className=\"py-2 text-right text-xs font-medium text-slate-500 uppercase\">Rate</th>\n                                                    <th className=\"py-2 text-right text-xs font-medium text-slate-500 uppercase\">Amount</th>\n                                                </tr>\n                                            </thead>\n                                            <tbody>\n                                                {(selectedInvoice.items || []).map((item, index) => (\n                                                    <tr key={item.id || index} className=\"border-b border-slate-100\">\n                                                        <td className=\"py-3 text-sm\">{index + 1}</td>\n                                                        <td className=\"py-3\">\n                                                            <p className=\"text-sm font-medium text-slate-900\">{item.name}</p>\n                                                            {item.description && (\n                                                                <p className=\"text-xs text-slate-500\">{item.description}</p>\n                                                            )}\n                                                        </td>\n                                                        <td className=\"py-3 text-sm text-center\">{item.quantity}</td>\n                                                        <td className=\"py-3 text-sm text-right\">{formatCurrency(item.rate)}</td>\n                                                        <td className=\"py-3 text-sm text-right font-medium\">{formatCurrency(item.amount)}</td>\n                                                    </tr>\n                                                ))}\n                                            </tbody>\n                                        </table>\n\n                                        <div className=\"mt-4 flex justify-end\">\n                                            <div className=\"w-64 space-y-2 text-sm\">\n                                                <div className=\"flex justify-between\">\n                                                    <span className=\"text-slate-500\">Sub Total</span>\n                                                    <span>{formatCurrency(selectedInvoice.subTotal)}</span>\n                                                </div>\n                                                {selectedInvoice.cgst > 0 && (\n                                                    <div className=\"flex justify-between\">\n                                                        <span className=\"text-slate-500\">CGST</span>\n                                                        <span>{formatCurrency(selectedInvoice.cgst)}</span>\n                                                    </div>\n                                                )}\n                                                {selectedInvoice.sgst > 0 && (\n                                                    <div className=\"flex justify-between\">\n                                                        <span className=\"text-slate-500\">SGST</span>\n                                                        <span>{formatCurrency(selectedInvoice.sgst)}</span>\n                                                    </div>\n                                                )}\n                                                <div className=\"flex justify-between pt-2 border-t border-slate-200 font-medium\">\n                                                    <span>Total</span>\n                                                    <span>{formatCurrency(selectedInvoice.total)}</span>\n                                                </div>\n                                                {(selectedInvoice.amountPaid > 0 || (selectedInvoice.amountRefunded || 0) > 0) && (\n                                                    <div className=\"flex justify-between text-green-600\">\n                                                        <span>Payment Made</span>\n                                                        <span>(-) {formatCurrency((selectedInvoice.amountPaid || 0) + (selectedInvoice.amountRefunded || 0))}</span>\n                                                    </div>\n                                                )}\n                                                {(selectedInvoice.amountRefunded || 0) > 0 && (\n                                                    <div className=\"flex justify-between text-orange-600\">\n                                                        <span>Refunded</span>\n                                                        <span>(+) {formatCurrency(selectedInvoice.amountRefunded || 0)}</span>\n                                                    </div>\n                                                )}\n                                                <div className=\"flex justify-between pt-2 border-t border-slate-200 font-bold text-base\">\n                                                    <span>Balance Due</span>\n                                                    <span>{formatCurrency(selectedInvoice.balanceDue)}</span>\n                                                </div>\n                                            </div>\n                                        </div>\n\n                                        {selectedInvoice.customerNotes && (\n                                            <div className=\"mt-6 pt-4 border-t border-slate-200\">\n                                                <p className=\"text-xs text-slate-500 uppercase mb-1\">Notes</p>\n                                                <p className=\"text-sm text-slate-600\">{selectedInvoice.customerNotes}</p>\n                                            </div>\n                                        )}\n                                    </div>\n                                </div>\n                            </TabsContent>\n\n                            <TabsContent value=\"comments\" className=\"m-0 p-6\">\n                                <div className=\"space-y-6\">\n                                    {/* Payment History Section */}\n                                    {(selectedInvoice.payments || []).length > 0 && (\n                                        <div>\n                                            <h3 className=\"text-sm font-semibold text-slate-700 mb-3\">Payment History</h3>\n                                            <div className=\"border border-slate-200 rounded-lg overflow-hidden\">\n                                                <table className=\"w-full\">\n                                                    <thead className=\"bg-slate-50\">\n                                                        <tr>\n                                                            <th className=\"px-4 py-3 text-left text-xs font-semibold text-slate-600\">System Activity</th>\n                                                            <th className=\"px-4 py-3 text-left text-xs font-semibold text-slate-600\">Payment Mode</th>\n                                                            <th className=\"px-4 py-3 text-left text-xs font-semibold text-slate-600\">Actual Payment Date & Time</th>\n                                                        </tr>\n                                                    </thead>\n                                                    <tbody className=\"divide-y divide-slate-200\">\n                                                        {(selectedInvoice.payments || []).map((payment: any) => (\n                                                            <tr key={payment.id} className=\"hover:bg-slate-50\">\n                                                                <td className=\"px-4 py-3 text-sm text-slate-900\">\n                                                                    Payment of {formatCurrency(payment.amount)} recorded\n                                                                </td>\n                                                                <td className=\"px-4 py-3 text-sm text-slate-900\">\n                                                                    {payment.paymentMode?.toUpperCase() || 'N/A'}\n                                                                </td>\n                                                                <td className=\"px-4 py-3 text-sm text-slate-900\">\n                                                                    {formatDateTime(payment.date || payment.timestamp)}\n                                                                </td>\n                                                            </tr>\n                                                        ))}\n                                                    </tbody>\n                                                </table>\n                                            </div>\n                                        </div>\n                                    )}\n\n                                    {/* Refund History Section */}\n                                    {(selectedInvoice.refunds || []).length > 0 && (\n                                        <div className=\"mt-6\">\n                                            <h3 className=\"text-sm font-semibold text-slate-700 mb-3\">Refund History</h3>\n                                            <div className=\"border border-slate-200 rounded-lg overflow-hidden\">\n                                                <table className=\"w-full\">\n                                                    <thead className=\"bg-orange-50\">\n                                                        <tr>\n                                                            <th className=\"px-4 py-3 text-left text-xs font-semibold text-slate-600\">Refund Details</th>\n                                                            <th className=\"px-4 py-3 text-left text-xs font-semibold text-slate-600\">Mode</th>\n                                                            <th className=\"px-4 py-3 text-left text-xs font-semibold text-slate-600\">Date</th>\n                                                        </tr>\n                                                    </thead>\n                                                    <tbody className=\"divide-y divide-slate-200\">\n                                                        {(selectedInvoice.refunds || []).map((refund: any) => (\n                                                            <tr key={refund.id} className=\"hover:bg-slate-50\">\n                                                                <td className=\"px-4 py-3 text-sm text-orange-700\">\n                                                                    Refund of {formatCurrency(refund.amount)} processed\n                                                                    {refund.reason && <span className=\"text-slate-500 ml-1\">- {refund.reason}</span>}\n                                                                </td>\n                                                                <td className=\"px-4 py-3 text-sm text-slate-900\">\n                                                                    {refund.mode?.toUpperCase() || 'N/A'}\n                                                                </td>\n                                                                <td className=\"px-4 py-3 text-sm text-slate-900\">\n                                                                    {formatDateTime(refund.date)}\n                                                                </td>\n                                                            </tr>\n                                                        ))}\n                                                    </tbody>\n                                                </table>\n                                            </div>\n                                        </div>\n                                    )}\n                                </div>\n                            </TabsContent>\n\n                            {/* Payments tab removed - content merged into Comments & History */}\n                        </ScrollArea>\n                    </Tabs>\n                </div>\n            )}\n\n            <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>Delete Invoice</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            Are you sure you want to delete this invoice? This action cannot be undone.\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\n                        <AlertDialogAction onClick={confirmDelete} className=\"bg-red-600 hover:bg-red-700\">\n                            Delete\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n\n            <Dialog open={paymentDialogOpen} onOpenChange={setPaymentDialogOpen}>\n                <DialogContent>\n                    <DialogHeader>\n                        <DialogTitle>Record Payment</DialogTitle>\n                        <DialogDescription>\n                            Record a payment for {selectedInvoice?.invoiceNumber}\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4 py-4\">\n                        <div className=\"space-y-2\">\n                            <Label>Amount Received</Label>\n                            <Input\n                                type=\"number\"\n                                placeholder=\"0.00\"\n                                value={paymentAmount}\n                                onChange={(e) => setPaymentAmount(e.target.value)}\n                                data-testid=\"input-payment-amount\"\n                            />\n                            <p className=\"text-xs text-slate-500\">\n                                Balance Due: {formatCurrency(selectedInvoice?.balanceDue || 0)}\n                            </p>\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label>Payment Mode</Label>\n                            <Select value={paymentMode} onValueChange={setPaymentMode}>\n                                <SelectTrigger data-testid=\"select-payment-mode\">\n                                    <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"cash\">Cash</SelectItem>\n                                    <SelectItem value=\"bank_transfer\">Bank Transfer</SelectItem>\n                                    <SelectItem value=\"cheque\">Cheque</SelectItem>\n                                    <SelectItem value=\"upi\">UPI</SelectItem>\n                                    <SelectItem value=\"credit_card\">Credit Card</SelectItem>\n                                </SelectContent>\n                            </Select>\n                        </div>\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <div className=\"space-y-2\">\n                                <Label>Payment Date</Label>\n                                <Input\n                                    type=\"date\"\n                                    value={paymentDate}\n                                    onChange={(e) => setPaymentDate(e.target.value)}\n                                    data-testid=\"input-payment-date\"\n                                />\n                            </div>\n                            <div className=\"space-y-2\">\n                                <Label>Payment Time</Label>\n                                <Input\n                                    type=\"time\"\n                                    value={paymentTime}\n                                    onChange={(e) => setPaymentTime(e.target.value)}\n                                    data-testid=\"input-payment-time\"\n                                />\n                            </div>\n                        </div>\n                    </div>\n                    <DialogFooter>\n                        <Button variant=\"outline\" onClick={() => setPaymentDialogOpen(false)}>Cancel</Button>\n                        <Button onClick={handleRecordPayment} data-testid=\"button-confirm-payment\">Record Payment</Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n\n            <Dialog open={refundDialogOpen} onOpenChange={setRefundDialogOpen}>\n                <DialogContent>\n                    <DialogHeader>\n                        <DialogTitle>Process Refund</DialogTitle>\n                        <DialogDescription>\n                            Process a refund for {selectedInvoice?.invoiceNumber}. Refundable balance: {formatCurrency(getRefundableAmount())}\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4 py-4\">\n                        <div className=\"space-y-2\">\n                            <Label>Refund Amount</Label>\n                            <Input\n                                type=\"number\"\n                                placeholder=\"Enter refund amount\"\n                                value={refundAmount}\n                                onChange={(e) => setRefundAmount(e.target.value)}\n                                max={getRefundableAmount()}\n                                data-testid=\"input-refund-amount\"\n                            />\n                            <p className=\"text-xs text-muted-foreground\">Maximum refundable: {formatCurrency(getRefundableAmount())}</p>\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label>Refund Mode</Label>\n                            <Select value={refundMode} onValueChange={setRefundMode}>\n                                <SelectTrigger data-testid=\"select-refund-mode\">\n                                    <SelectValue placeholder=\"Select refund mode\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"Cash\">Cash</SelectItem>\n                                    <SelectItem value=\"Bank Transfer\">Bank Transfer</SelectItem>\n                                    <SelectItem value=\"Cheque\">Cheque</SelectItem>\n                                    <SelectItem value=\"UPI\">UPI</SelectItem>\n                                    <SelectItem value=\"Credit Card\">Credit Card</SelectItem>\n                                </SelectContent>\n                            </Select>\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label>Reason (Optional)</Label>\n                            <Input\n                                placeholder=\"Enter reason for refund\"\n                                value={refundReason}\n                                onChange={(e) => setRefundReason(e.target.value)}\n                                data-testid=\"input-refund-reason\"\n                            />\n                        </div>\n                    </div>\n                    <DialogFooter>\n                        <Button variant=\"outline\" onClick={() => setRefundDialogOpen(false)}>Cancel</Button>\n                        <Button onClick={handleRefund} data-testid=\"button-confirm-refund\">Process Refund</Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n\n            <AlertDialog open={voidDialogOpen} onOpenChange={setVoidDialogOpen}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>Void Invoice</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            Are you sure you want to void this invoice ({selectedInvoice?.invoiceNumber})? This action will mark the invoice as void and it cannot be used for transactions.\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\n                        <AlertDialogAction onClick={handleVoidInvoice} className=\"bg-orange-600 hover:bg-orange-700\">\n                            Void Invoice\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n\n            <Dialog open={recurringDialogOpen} onOpenChange={setRecurringDialogOpen}>\n                <DialogContent className=\"max-w-md\">\n                    <DialogHeader>\n                        <DialogTitle>Make Recurring Invoice</DialogTitle>\n                        <DialogDescription>\n                            Set up this invoice to automatically generate on a schedule.\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4 py-4\">\n                        <div className=\"space-y-2\">\n                            <Label>Profile Name</Label>\n                            <Input placeholder=\"Monthly Invoice\" data-testid=\"input-recurring-name\" />\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label>Repeat Every</Label>\n                            <div className=\"flex gap-2\">\n                                <Input type=\"number\" defaultValue=\"1\" className=\"w-20\" />\n                                <Select defaultValue=\"month\">\n                                    <SelectTrigger className=\"flex-1\">\n                                        <SelectValue />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                        <SelectItem value=\"week\">Week(s)</SelectItem>\n                                        <SelectItem value=\"month\">Month(s)</SelectItem>\n                                        <SelectItem value=\"year\">Year(s)</SelectItem>\n                                    </SelectContent>\n                                </Select>\n                            </div>\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label>Start Date</Label>\n                            <Input type=\"date\" defaultValue={new Date().toISOString().split('T')[0]} />\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label>End</Label>\n                            <Select defaultValue=\"never\">\n                                <SelectTrigger>\n                                    <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"never\">Never</SelectItem>\n                                    <SelectItem value=\"after\">After # of occurrences</SelectItem>\n                                    <SelectItem value=\"on\">On a specific date</SelectItem>\n                                </SelectContent>\n                            </Select>\n                        </div>\n                    </div>\n                    <DialogFooter>\n                        <Button variant=\"outline\" onClick={() => setRecurringDialogOpen(false)}>Cancel</Button>\n                        <Button onClick={() => {\n                            toast({ title: \"Recurring invoice created\" });\n                            setRecurringDialogOpen(false);\n                        }}>Create Recurring Invoice</Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n\n            <Dialog open={journalDialogOpen} onOpenChange={setJournalDialogOpen}>\n                <DialogContent className=\"max-w-2xl\">\n                    <DialogHeader>\n                        <DialogTitle>Journal Entry</DialogTitle>\n                        <DialogDescription>\n                            View the accounting journal entry for {selectedInvoice?.invoiceNumber}\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"py-4\">\n                        <div className=\"border rounded-lg overflow-hidden\">\n                            <table className=\"w-full\">\n                                <thead className=\"bg-slate-50\">\n                                    <tr>\n                                        <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Account</th>\n                                        <th className=\"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase\">Debit</th>\n                                        <th className=\"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase\">Credit</th>\n                                    </tr>\n                                </thead>\n                                <tbody className=\"divide-y divide-slate-200\">\n                                    <tr>\n                                        <td className=\"px-4 py-3 text-sm text-slate-900\">Accounts Receivable</td>\n                                        <td className=\"px-4 py-3 text-sm text-slate-900 text-right\">{formatCurrency(selectedInvoice?.total || 0)}</td>\n                                        <td className=\"px-4 py-3 text-sm text-slate-900 text-right\">-</td>\n                                    </tr>\n                                    <tr>\n                                        <td className=\"px-4 py-3 text-sm text-slate-900\">Sales Revenue</td>\n                                        <td className=\"px-4 py-3 text-sm text-slate-900 text-right\">-</td>\n                                        <td className=\"px-4 py-3 text-sm text-slate-900 text-right\">{formatCurrency(selectedInvoice?.subTotal || 0)}</td>\n                                    </tr>\n                                    {(selectedInvoice?.cgst || 0) > 0 && (\n                                        <tr>\n                                            <td className=\"px-4 py-3 text-sm text-slate-900\">CGST Payable</td>\n                                            <td className=\"px-4 py-3 text-sm text-slate-900 text-right\">-</td>\n                                            <td className=\"px-4 py-3 text-sm text-slate-900 text-right\">{formatCurrency(selectedInvoice?.cgst || 0)}</td>\n                                        </tr>\n                                    )}\n                                    {(selectedInvoice?.sgst || 0) > 0 && (\n                                        <tr>\n                                            <td className=\"px-4 py-3 text-sm text-slate-900\">SGST Payable</td>\n                                            <td className=\"px-4 py-3 text-sm text-slate-900 text-right\">-</td>\n                                            <td className=\"px-4 py-3 text-sm text-slate-900 text-right\">{formatCurrency(selectedInvoice?.sgst || 0)}</td>\n                                        </tr>\n                                    )}\n                                </tbody>\n                                <tfoot className=\"bg-slate-50\">\n                                    <tr>\n                                        <td className=\"px-4 py-3 text-sm font-medium text-slate-900\">Total</td>\n                                        <td className=\"px-4 py-3 text-sm font-medium text-slate-900 text-right\">{formatCurrency(selectedInvoice?.total || 0)}</td>\n                                        <td className=\"px-4 py-3 text-sm font-medium text-slate-900 text-right\">{formatCurrency(selectedInvoice?.total || 0)}</td>\n                                    </tr>\n                                </tfoot>\n                            </table>\n                        </div>\n                    </div>\n                    <DialogFooter>\n                        <Button onClick={() => setJournalDialogOpen(false)}>Close</Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n\n            <Dialog open={preferencesDialogOpen} onOpenChange={setPreferencesDialogOpen}>\n                <DialogContent className=\"max-w-md\">\n                    <DialogHeader>\n                        <DialogTitle>Invoice Preferences</DialogTitle>\n                        <DialogDescription>\n                            Customize the settings for your invoices.\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4 py-4\">\n                        <div className=\"space-y-2\">\n                            <Label>Default Payment Terms</Label>\n                            <Select defaultValue=\"net30\">\n                                <SelectTrigger>\n                                    <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"due_on_receipt\">Due on Receipt</SelectItem>\n                                    <SelectItem value=\"net15\">Net 15</SelectItem>\n                                    <SelectItem value=\"net30\">Net 30</SelectItem>\n                                    <SelectItem value=\"net45\">Net 45</SelectItem>\n                                    <SelectItem value=\"net60\">Net 60</SelectItem>\n                                </SelectContent>\n                            </Select>\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label>Invoice Number Prefix</Label>\n                            <Input defaultValue=\"INV-\" />\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label>Default Notes</Label>\n                            <Input placeholder=\"Thank you for your business!\" />\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label>Default Terms & Conditions</Label>\n                            <Input placeholder=\"Payment is due within the terms specified...\" />\n                        </div>\n                    </div>\n                    <DialogFooter>\n                        <Button variant=\"outline\" onClick={() => setPreferencesDialogOpen(false)}>Cancel</Button>\n                        <Button onClick={() => {\n                            toast({ title: \"Invoice preferences saved\" });\n                            setPreferencesDialogOpen(false);\n                        }}>Save Preferences</Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n        </div>\n    );\n}\n","path":null,"size_bytes":79479,"size_tokens":null},"client/src/shared/components/DataTable.tsx":{"content":"import { ReactNode } from 'react';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport { Spinner } from '@/components/ui/spinner';\n\ninterface Column<T> {\n  key: string;\n  label: string;\n  render?: (value: any, row: T) => ReactNode;\n  className?: string;\n}\n\ninterface DataTableProps<T> {\n  columns: Column<T>[];\n  data: T[];\n  loading?: boolean;\n  emptyMessage?: string;\n  onRowClick?: (row: T) => void;\n}\n\nexport function DataTable<T extends Record<string, any>>({\n  columns,\n  data,\n  loading = false,\n  emptyMessage = 'No data found',\n  onRowClick,\n}: DataTableProps<T>) {\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <Spinner className=\"w-8 h-8\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"border rounded-lg overflow-hidden\">\n      <Table>\n        <TableHeader>\n          <TableRow className=\"bg-slate-50\">\n            {columns.map((column) => (\n              <TableHead key={column.key} className={column.className}>\n                {column.label}\n              </TableHead>\n            ))}\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {data.length === 0 ? (\n            <TableRow>\n              <TableCell\n                colSpan={columns.length}\n                className=\"text-center py-12 text-slate-500\"\n              >\n                {emptyMessage}\n              </TableCell>\n            </TableRow>\n          ) : (\n            data.map((row, index) => (\n              <TableRow\n                key={row.id || index}\n                onClick={() => onRowClick?.(row)}\n                className={onRowClick ? 'cursor-pointer hover:bg-slate-50' : ''}\n              >\n                {columns.map((column) => (\n                  <TableCell key={column.key} className={column.className}>\n                    {column.render\n                      ? column.render(row[column.key], row)\n                      : row[column.key]}\n                  </TableCell>\n                ))}\n              </TableRow>\n            ))\n          )}\n        </TableBody>\n      </Table>\n    </div>\n  );\n}\n\nexport default DataTable;\n","path":null,"size_bytes":2188,"size_tokens":null},"client/src/pages/bills.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport {\n  Plus, Search, ChevronDown, MoreHorizontal, Pencil, Trash2,\n  X, Mail, FileText, Printer, Filter, Download,\n  Eye, Check, List, Grid3X3, CreditCard, Copy, Clock,\n  BookOpen, Ban, Upload, RefreshCw, Lightbulb\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { usePagination } from \"@/hooks/use-pagination\";\nimport { TablePagination } from \"@/components/table-pagination\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\n\ninterface BillItem {\n  id: string;\n  itemName: string;\n  description?: string;\n  account: string;\n  quantity: number;\n  rate: number;\n  tax?: string;\n  taxAmount?: number;\n  customerDetails?: string;\n  amount: number;\n}\n\ninterface JournalEntry {\n  account: string;\n  debit: number;\n  credit: number;\n}\n\ninterface Bill {\n  id: string;\n  billNumber: string;\n  orderNumber?: string;\n  vendorId: string;\n  vendorName: string;\n  vendorAddress?: {\n    street1?: string;\n    street2?: string;\n    city?: string;\n    state?: string;\n    pinCode?: string;\n    country?: string;\n    gstin?: string;\n  };\n  billDate: string;\n  dueDate: string;\n  paymentTerms: string;\n  reverseCharge?: boolean;\n  subject?: string;\n  items: BillItem[];\n  subTotal: number;\n  discountType?: string;\n  discountValue?: number;\n  discountAmount?: number;\n  taxType?: string;\n  taxCategory?: string;\n  taxAmount?: number;\n  adjustment?: number;\n  adjustmentDescription?: string;\n  total: number;\n  amountPaid: number;\n  balanceDue: number;\n  notes?: string;\n  attachments?: string[];\n  status: string;\n  pdfTemplate?: string;\n  journalEntries?: JournalEntry[];\n  createdAt?: string;\n}\n\nfunction formatCurrency(amount: number): string {\n  return new Intl.NumberFormat('en-IN', {\n    style: 'currency',\n    currency: 'INR',\n    minimumFractionDigits: 2\n  }).format(amount);\n}\n\nfunction formatDate(dateString: string): string {\n  if (!dateString) return '-';\n  const date = new Date(dateString);\n  return date.toLocaleDateString('en-IN', { day: '2-digit', month: '2-digit', year: 'numeric' });\n}\n\nfunction BillPDFView({ bill }: { bill: Bill }) {\n  const companyInfo = {\n    name: \"SKILLTONIT\",\n    address: \"Hinjawadi - Wakad road\",\n    city: \"Hinjawadi\",\n    state: \"Pune Maharashtra 411057\",\n    country: \"India\",\n    gstin: \"27AZCPA5145K1ZH\",\n    email: \"Sales.SkilltonIT@skilltonit.com\",\n    website: \"www.skilltonit.com\"\n  };\n\n  return (\n    <div className=\"bg-white border border-slate-200 shadow-sm max-w-3xl mx-auto\">\n      <div className=\"relative\">\n        <div className=\"absolute top-4 left-4\">\n          <Badge className=\"bg-green-500 text-white border-0 px-3 py-1 text-xs font-semibold rotate-[-5deg]\">\n            Paid\n          </Badge>\n        </div>\n\n        <div className=\"p-8\">\n          <div className=\"flex justify-between items-start mb-8\">\n            <div>\n              <div className=\"flex items-center gap-2 mb-3\">\n                <div className=\"w-8 h-8 bg-green-600 rounded flex items-center justify-center\">\n                  <span className=\"text-white font-bold text-sm\">S</span>\n                </div>\n                <span className=\"text-lg font-bold text-green-600\">{companyInfo.name}</span>\n              </div>\n              <div className=\"text-sm text-slate-600 space-y-0.5\">\n                <p>{companyInfo.address}</p>\n                <p>{companyInfo.city}</p>\n                <p>{companyInfo.state}</p>\n                <p>{companyInfo.country}</p>\n                <p>GSTIN {companyInfo.gstin}</p>\n                <p className=\"text-blue-600\">{companyInfo.email}</p>\n                <p className=\"text-blue-600\">{companyInfo.website}</p>\n              </div>\n            </div>\n            <div className=\"text-right\">\n              <h2 className=\"text-3xl font-bold text-slate-800 mb-1\">BILL</h2>\n              <p className=\"text-slate-600\">Bill# <span className=\"font-medium\">{bill.billNumber}</span></p>\n              <div className=\"mt-2 text-sm\">\n                <p className=\"text-slate-500\">Balance Due</p>\n                <p className=\"text-xl font-bold\">{formatCurrency(bill.balanceDue)}</p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"mb-6\">\n            <h4 className=\"text-sm font-semibold text-slate-500 mb-2\">Bill From</h4>\n            <p className=\"font-semibold text-blue-600\">{bill.vendorName}</p>\n            {bill.vendorAddress && (\n              <div className=\"text-sm text-slate-600\">\n                {bill.vendorAddress.street1 && <p>{bill.vendorAddress.street1}</p>}\n                {bill.vendorAddress.city && (\n                  <p>{bill.vendorAddress.city}, {bill.vendorAddress.state}</p>\n                )}\n                {bill.vendorAddress.pinCode && <p>{bill.vendorAddress.pinCode}</p>}\n                {bill.vendorAddress.country && <p>{bill.vendorAddress.country}</p>}\n                {bill.vendorAddress.gstin && <p>GSTIN {bill.vendorAddress.gstin}</p>}\n              </div>\n            )}\n          </div>\n\n          <div className=\"flex justify-end mb-4 text-sm\">\n            <div className=\"space-y-1 text-right\">\n              <p><span className=\"text-slate-500\">Bill Date :</span> {formatDate(bill.billDate)}</p>\n              <p><span className=\"text-slate-500\">Due Date :</span> {formatDate(bill.dueDate)}</p>\n              <p><span className=\"text-slate-500\">Terms :</span> {bill.paymentTerms}</p>\n            </div>\n          </div>\n\n          <table className=\"w-full mb-6\">\n            <thead>\n              <tr className=\"bg-blue-600 text-white\">\n                <th className=\"px-3 py-2 text-left text-sm font-medium\">#</th>\n                <th className=\"px-3 py-2 text-left text-sm font-medium\">Item & Description</th>\n                <th className=\"px-3 py-2 text-center text-sm font-medium\">Qty</th>\n                <th className=\"px-3 py-2 text-right text-sm font-medium\">Rate</th>\n                <th className=\"px-3 py-2 text-right text-sm font-medium\">Amount</th>\n              </tr>\n            </thead>\n            <tbody>\n              {bill.items.map((item, index) => (\n                <tr key={item.id} className=\"border-b border-slate-100\">\n                  <td className=\"px-3 py-3 text-sm\">{index + 1}</td>\n                  <td className=\"px-3 py-3\">\n                    <p className=\"font-medium text-sm\">{item.itemName}</p>\n                    {item.description && <p className=\"text-xs text-slate-500\">{item.description}</p>}\n                  </td>\n                  <td className=\"px-3 py-3 text-center text-sm\">{item.quantity.toLocaleString('en-IN', { minimumFractionDigits: 2 })}</td>\n                  <td className=\"px-3 py-3 text-right text-sm\">{item.rate.toLocaleString('en-IN', { minimumFractionDigits: 2 })}</td>\n                  <td className=\"px-3 py-3 text-right text-sm font-medium\">{item.amount.toLocaleString('en-IN', { minimumFractionDigits: 2 })}</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n\n          <div className=\"flex justify-end mb-6\">\n            <div className=\"w-64 space-y-2\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-slate-500\">Sub Total</span>\n                <span>{bill.subTotal.toLocaleString('en-IN', { minimumFractionDigits: 2 })}</span>\n              </div>\n              {bill.taxAmount && bill.taxAmount > 0 && (\n                <div className=\"flex justify-between text-sm\">\n                  <span className=\"text-slate-500\">IGST18 (18%)</span>\n                  <span>{bill.taxAmount.toLocaleString('en-IN', { minimumFractionDigits: 2 })}</span>\n                </div>\n              )}\n              <div className=\"flex justify-between font-semibold border-t pt-2\">\n                <span>Total</span>\n                <span>{formatCurrency(bill.total)}</span>\n              </div>\n              <div className=\"flex justify-between bg-blue-50 p-2 rounded font-semibold\">\n                <span>Balance Due</span>\n                <span>{formatCurrency(bill.balanceDue)}</span>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"mt-12 border-t pt-4\">\n            <p className=\"text-sm text-slate-600\">Authorized Signature ____________________</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction BillDetailView({ bill }: { bill: Bill }) {\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-start justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold mb-1\">BILL</h2>\n          <p className=\"text-slate-600\">Bill# <span className=\"font-semibold\">{bill.billNumber}</span></p>\n          <Badge\n            className={`mt-2 ${bill.status === 'PAID' ? 'bg-green-500 text-white' :\n              bill.status === 'OVERDUE' ? 'bg-red-500 text-white' :\n                'bg-amber-500 text-white'\n              }`}\n          >\n            {bill.status}\n          </Badge>\n        </div>\n        <div className=\"text-right\">\n          <h4 className=\"text-sm text-slate-500\">VENDOR ADDRESS</h4>\n          <p className=\"font-semibold text-blue-600\">{bill.vendorName}</p>\n          {bill.vendorAddress && (\n            <div className=\"text-sm text-slate-600 mt-1\">\n              {bill.vendorAddress.street1 && <p>{bill.vendorAddress.street1}</p>}\n              <p>{bill.vendorAddress.city}, {bill.vendorAddress.state}</p>\n              <p>{bill.vendorAddress.country} - {bill.vendorAddress.pinCode}</p>\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-3 gap-4 text-sm border-t border-b py-4\">\n        <div>\n          <span className=\"text-slate-500 uppercase text-xs\">Bill Date</span>\n          <p className=\"font-medium\">{formatDate(bill.billDate)}</p>\n        </div>\n        <div>\n          <span className=\"text-slate-500 uppercase text-xs\">Due Date</span>\n          <p className=\"font-medium\">{formatDate(bill.dueDate)}</p>\n        </div>\n        <div>\n          <span className=\"text-slate-500 uppercase text-xs\">Payment Terms</span>\n          <p className=\"font-medium\">{bill.paymentTerms}</p>\n        </div>\n        <div className=\"col-span-3\">\n          <span className=\"text-slate-500 uppercase text-xs\">Total</span>\n          <p className=\"font-bold text-lg\">{formatCurrency(bill.total)}</p>\n        </div>\n      </div>\n\n      <div>\n        <Table>\n          <TableHeader>\n            <TableRow className=\"bg-slate-50\">\n              <TableHead className=\"text-xs\">ITEMS & DESCRIPTION</TableHead>\n              <TableHead className=\"text-xs\">ACCOUNT</TableHead>\n              <TableHead className=\"text-xs text-center\">QUANTITY</TableHead>\n              <TableHead className=\"text-xs text-right\">RATE</TableHead>\n              <TableHead className=\"text-xs text-right\">AMOUNT</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {bill.items.map((item) => (\n              <TableRow key={item.id}>\n                <TableCell className=\"text-blue-600\">{item.itemName}</TableCell>\n                <TableCell>{item.account}</TableCell>\n                <TableCell className=\"text-center\">{item.quantity}</TableCell>\n                <TableCell className=\"text-right\">{item.rate.toFixed(2)}</TableCell>\n                <TableCell className=\"text-right\">{item.amount.toFixed(2)}</TableCell>\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n      </div>\n\n      <div className=\"flex justify-end\">\n        <div className=\"w-72 space-y-2\">\n          <div className=\"flex justify-between text-sm\">\n            <span className=\"text-slate-600\">Sub Total</span>\n            <span>{formatCurrency(bill.subTotal)}</span>\n          </div>\n          {bill.discountAmount && bill.discountAmount > 0 && (\n            <div className=\"flex justify-between text-sm text-pink-600\">\n              <span>Discount</span>\n              <span>(-){formatCurrency(bill.discountAmount)}</span>\n            </div>\n          )}\n          {bill.taxAmount && bill.taxAmount > 0 && (\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"text-slate-600\">IGST18 (18%)</span>\n              <span>{formatCurrency(bill.taxAmount)}</span>\n            </div>\n          )}\n          <div className=\"flex justify-between font-bold border-t pt-2\">\n            <span>Total</span>\n            <span>{formatCurrency(bill.total)}</span>\n          </div>\n        </div>\n      </div>\n\n      {bill.journalEntries && bill.journalEntries.length > 0 && (\n        <div className=\"border-t pt-4\">\n          <Tabs defaultValue=\"journal\">\n            <TabsList>\n              <TabsTrigger value=\"journal\">Journal</TabsTrigger>\n            </TabsList>\n            <TabsContent value=\"journal\">\n              <p className=\"text-xs text-slate-500 mb-2\">\n                Amount is displayed in your base currency <Badge variant=\"outline\" className=\"text-xs\">INR</Badge>\n              </p>\n              <h4 className=\"font-semibold mb-2\">Bill</h4>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"text-xs\">ACCOUNT</TableHead>\n                    <TableHead className=\"text-xs text-right\">DEBIT</TableHead>\n                    <TableHead className=\"text-xs text-right\">CREDIT</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {bill.journalEntries.map((entry, index) => (\n                    <TableRow key={index}>\n                      <TableCell>{entry.account}</TableCell>\n                      <TableCell className=\"text-right\">{entry.debit.toFixed(2)}</TableCell>\n                      <TableCell className=\"text-right\">{entry.credit.toFixed(2)}</TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </TabsContent>\n          </Tabs>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction BillDetailPanel({\n  bill,\n  onClose,\n  onEdit,\n  onDelete,\n  onMarkPaid,\n  onRecordPayment,\n  onVoid,\n  onClone,\n  onCreateVendorCredits,\n  onViewJournal,\n  onExpectedPaymentDate\n}: {\n  bill: Bill;\n  onClose: () => void;\n  onEdit: () => void;\n  onDelete: () => void;\n  onMarkPaid: () => void;\n  onRecordPayment: () => void;\n  onVoid: () => void;\n  onClone: () => void;\n  onCreateVendorCredits: () => void;\n  onViewJournal: () => void;\n  onExpectedPaymentDate: () => void;\n}) {\n  const [showPdfView, setShowPdfView] = useState(false);\n\n  return (\n    <div className=\"h-full flex flex-col bg-white border-l border-slate-200 overflow-hidden\">\n      <div className=\"flex items-center justify-between px-4 py-3 border-b border-slate-200 bg-slate-50\">\n        <h2 className=\"text-lg font-semibold text-slate-900\" data-testid=\"text-bill-number\">{bill.billNumber}</h2>\n        <div className=\"flex items-center gap-1\">\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n            <Download className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n            <Printer className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n            <Eye className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={onClose} data-testid=\"button-close-panel\">\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"flex items-center gap-2 px-4 py-2 border-b border-slate-200 overflow-x-auto bg-white\">\n        <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\" onClick={onEdit} data-testid=\"button-edit-bill\">\n          <Pencil className=\"h-3.5 w-3.5\" />\n          Edit\n        </Button>\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\">\n              <FileText className=\"h-3.5 w-3.5\" />\n              PDF/Print\n              <ChevronDown className=\"h-3 w-3\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent>\n            <DropdownMenuItem>\n              <Download className=\"mr-2 h-4 w-4\" /> Download PDF\n            </DropdownMenuItem>\n            <DropdownMenuItem>\n              <Printer className=\"mr-2 h-4 w-4\" /> Print\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n        {bill.status !== 'PAID' && bill.status !== 'VOID' && (\n          <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\" onClick={onRecordPayment} data-testid=\"button-record-payment\">\n            <CreditCard className=\"h-3.5 w-3.5\" />\n            Record Payment\n          </Button>\n        )}\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\" data-testid=\"button-more-actions\">\n              <MoreHorizontal className=\"h-3.5 w-3.5\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\" className=\"w-56\">\n            {bill.status !== 'VOID' && (\n              <DropdownMenuItem onClick={onVoid} className=\"text-red-600\">\n                <Ban className=\"mr-2 h-4 w-4\" />\n                Void\n              </DropdownMenuItem>\n            )}\n            <DropdownMenuItem onClick={onExpectedPaymentDate}>\n              <Clock className=\"mr-2 h-4 w-4\" />\n              Expected Payment Date\n            </DropdownMenuItem>\n            <DropdownMenuItem onClick={onClone}>\n              <Copy className=\"mr-2 h-4 w-4\" />\n              Clone\n            </DropdownMenuItem>\n            <DropdownMenuItem onClick={onCreateVendorCredits}>\n              <CreditCard className=\"mr-2 h-4 w-4\" />\n              Create Vendor Credits\n            </DropdownMenuItem>\n            <DropdownMenuItem onClick={onViewJournal}>\n              <BookOpen className=\"mr-2 h-4 w-4\" />\n              View Journal\n            </DropdownMenuItem>\n            <DropdownMenuSeparator />\n            <DropdownMenuItem className=\"text-red-600\" onClick={onDelete}>\n              <Trash2 className=\"mr-2 h-4 w-4\" />\n              Delete\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n      </div>\n\n      <div className=\"px-4 py-3 border-b border-slate-200 flex items-center justify-end\">\n        <div className=\"flex items-center gap-2\">\n          <Label htmlFor=\"pdf-view\" className=\"text-sm text-slate-500\">Show PDF View</Label>\n          <Switch id=\"pdf-view\" checked={showPdfView} onCheckedChange={setShowPdfView} />\n        </div>\n      </div>\n\n      <div className=\"flex-1 overflow-auto p-4\">\n        {showPdfView ? (\n          <BillPDFView bill={bill} />\n        ) : (\n          <BillDetailView bill={bill} />\n        )}\n      </div>\n\n      <div className=\"border-t border-slate-200 p-3 text-center text-xs text-slate-500\">\n        PDF Template: <span className=\"text-blue-600\">{bill.pdfTemplate || 'Standard Template'}</span>\n        <button className=\"text-blue-600 ml-2\">Change</button>\n      </div>\n    </div>\n  );\n}\n\n// Record Payment Dialog Component\nfunction RecordPaymentDialog({\n  isOpen,\n  onClose,\n  bill,\n  onPaymentRecorded\n}: {\n  isOpen: boolean;\n  onClose: () => void;\n  bill: Bill | null;\n  onPaymentRecorded: () => void;\n}) {\n  const { toast } = useToast();\n  const [paymentAmount, setPaymentAmount] = useState(\"\");\n  const [paymentMode, setPaymentMode] = useState(\"Cash\");\n  const [paymentDate, setPaymentDate] = useState(new Date().toISOString().split('T')[0]);\n  const [paymentNumber, setPaymentNumber] = useState(\"1\");\n  const [paymentMadeOn, setPaymentMadeOn] = useState(\"\");\n  const [paidThrough, setPaidThrough] = useState(\"Petty Cash\");\n  const [reference, setReference] = useState(\"\");\n  const [notes, setNotes] = useState(\"\");\n  const [sendNotification, setSendNotification] = useState(false);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  useEffect(() => {\n    if (isOpen && bill) {\n      setPaymentAmount(String(bill.balanceDue || 0));\n      setPaymentDate(new Date().toISOString().split('T')[0]);\n      fetchNextPaymentNumber();\n    }\n  }, [isOpen, bill]);\n\n  const fetchNextPaymentNumber = async () => {\n    try {\n      const response = await fetch('/api/payments-made/next-number');\n      if (response.ok) {\n        const data = await response.json();\n        setPaymentNumber(data.data?.nextNumber || \"1\");\n      }\n    } catch (error) {\n      console.error('Failed to fetch next payment number:', error);\n    }\n  };\n\n  const incrementPaymentNumber = () => {\n    const num = parseInt(paymentNumber) || 0;\n    setPaymentNumber(String(num + 1));\n  };\n\n  const handleSave = async (status: 'DRAFT' | 'PAID') => {\n    if (!bill) return;\n\n    const amount = parseFloat(paymentAmount);\n    if (isNaN(amount) || amount <= 0) {\n      toast({ title: \"Please enter a valid payment amount\", variant: \"destructive\" });\n      return;\n    }\n    if (amount > (bill.balanceDue || 0)) {\n      toast({ title: \"Payment amount cannot exceed balance due\", variant: \"destructive\" });\n      return;\n    }\n\n    setIsSubmitting(true);\n    try {\n      // Record payment on the bill - this also creates a payment in Payments Made\n      const billResponse = await fetch(`/api/bills/${bill.id}/record-payment`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          amount,\n          paymentMode,\n          paymentDate,\n          paymentNumber,\n          paymentMadeOn,\n          paidThrough,\n          reference,\n          notes,\n          status,\n          sendNotification\n        })\n      });\n\n      if (!billResponse.ok) {\n        throw new Error('Failed to record payment');\n      }\n\n      toast({ title: status === 'DRAFT' ? \"Payment saved as draft\" : \"Payment recorded successfully\" });\n      onPaymentRecorded();\n      onClose();\n      resetForm();\n    } catch (error) {\n      toast({ title: \"Failed to record payment\", variant: \"destructive\" });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const resetForm = () => {\n    setPaymentAmount(\"\");\n    setPaymentMode(\"Cash\");\n    setPaymentDate(new Date().toISOString().split('T')[0]);\n    setPaymentNumber(\"1\");\n    setPaymentMadeOn(\"\");\n    setPaidThrough(\"Petty Cash\");\n    setReference(\"\");\n    setNotes(\"\");\n    setSendNotification(false);\n  };\n\n  if (!bill) return null;\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"text-xl font-semibold\" data-testid=\"text-payment-title\">\n            Payment for {bill.billNumber}\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-6 pt-4\">\n          {/* Payment Amount */}\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium text-red-600\">\n              Payment Made <span className=\"text-red-500\">*</span>(INR)\n            </Label>\n            <Input\n              type=\"number\"\n              value={paymentAmount}\n              onChange={(e) => setPaymentAmount(e.target.value)}\n              className=\"max-w-xs\"\n              data-testid=\"input-payment-amount\"\n            />\n          </div>\n\n          {/* Info Message */}\n\n\n          {/* Payment Mode */}\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium\">Payment Mode</Label>\n            <Select value={paymentMode} onValueChange={setPaymentMode}>\n              <SelectTrigger className=\"max-w-xs\" data-testid=\"select-payment-mode\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"Cash\">Cash</SelectItem>\n                <SelectItem value=\"Bank Transfer\">Bank Transfer</SelectItem>\n                <SelectItem value=\"Cheque\">Cheque</SelectItem>\n                <SelectItem value=\"Credit Card\">Credit Card</SelectItem>\n                <SelectItem value=\"UPI\">UPI</SelectItem>\n                <SelectItem value=\"NEFT\">NEFT</SelectItem>\n                <SelectItem value=\"RTGS\">RTGS</SelectItem>\n                <SelectItem value=\"IMPS\">IMPS</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          {/* Payment Date and Payment # */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium text-red-600\">\n                Payment Date<span className=\"text-red-500\">*</span>\n              </Label>\n              <Input\n                type=\"date\"\n                value={paymentDate}\n                onChange={(e) => setPaymentDate(e.target.value)}\n                data-testid=\"input-payment-date\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium text-red-600\">\n                Payment #<span className=\"text-red-500\">*</span>\n              </Label>\n              <div className=\"flex gap-2\">\n                <Input\n                  value={paymentNumber}\n                  onChange={(e) => setPaymentNumber(e.target.value)}\n                  className=\"flex-1\"\n                  data-testid=\"input-payment-number\"\n                />\n                <Button\n                  variant=\"outline\"\n                  size=\"icon\"\n                  onClick={incrementPaymentNumber}\n                  title=\"Generate next number\"\n                  data-testid=\"button-next-payment-number\"\n                >\n                  <RefreshCw className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          {/* Payment Made On, Paid Through, Reference */}\n          <div className=\"grid grid-cols-3 gap-4\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">Payment Made on</Label>\n              <Input\n                type=\"date\"\n                value={paymentMadeOn}\n                onChange={(e) => setPaymentMadeOn(e.target.value)}\n                placeholder=\"dd/MM/yyyy\"\n                data-testid=\"input-payment-made-on\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium text-red-600\">\n                Paid Through<span className=\"text-red-500\">*</span>\n              </Label>\n              <Select value={paidThrough} onValueChange={setPaidThrough}>\n                <SelectTrigger data-testid=\"select-paid-through\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"Petty Cash\">Petty Cash</SelectItem>\n                  <SelectItem value=\"Undeposited Funds\">Undeposited Funds</SelectItem>\n                  <SelectItem value=\"Bank Account\">Bank Account</SelectItem>\n                  <SelectItem value=\"Prepaid Expenses\">Prepaid Expenses</SelectItem>\n                  <SelectItem value=\"Accounts Payable\">Accounts Payable</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">Reference#</Label>\n              <Input\n                value={reference}\n                onChange={(e) => setReference(e.target.value)}\n                data-testid=\"input-reference\"\n              />\n            </div>\n          </div>\n\n          {/* Notes */}\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium\">Notes</Label>\n            <Textarea\n              value={notes}\n              onChange={(e) => setNotes(e.target.value)}\n              rows={3}\n              data-testid=\"input-notes\"\n            />\n          </div>\n\n          {/* Attachments */}\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium\">Attachments</Label>\n            <div>\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"outline\" className=\"gap-2\" data-testid=\"button-upload-file\">\n                    <Upload className=\"h-4 w-4\" />\n                    Upload File\n                    <ChevronDown className=\"h-4 w-4\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent>\n                  <DropdownMenuItem>Upload from Computer</DropdownMenuItem>\n                  <DropdownMenuItem>Attach from Cloud</DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n              <p className=\"text-xs text-slate-500 mt-1\">You can upload a maximum of 5 files, 10MB each</p>\n            </div>\n          </div>\n\n          {/* Email Notification */}\n          <div className=\"flex items-center gap-2\">\n            <Checkbox\n              id=\"send-notification\"\n              checked={sendNotification}\n              onCheckedChange={(checked) => setSendNotification(checked === true)}\n              data-testid=\"checkbox-send-notification\"\n            />\n            <Label htmlFor=\"send-notification\" className=\"text-sm cursor-pointer\">\n              Send a Payment Made email notification.\n            </Label>\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"flex items-center gap-3 pt-4 border-t\">\n            <Button\n              variant=\"outline\"\n              onClick={() => handleSave('DRAFT')}\n              disabled={isSubmitting}\n              data-testid=\"button-save-draft\"\n            >\n              Save as Draft\n            </Button>\n            <Button\n              onClick={() => handleSave('PAID')}\n              disabled={isSubmitting}\n              className=\"bg-blue-600 hover:bg-blue-700\"\n              data-testid=\"button-save-paid\"\n            >\n              Save as Paid\n            </Button>\n            <Button\n              variant=\"ghost\"\n              onClick={onClose}\n              disabled={isSubmitting}\n              data-testid=\"button-cancel\"\n            >\n              Cancel\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nexport default function Bills() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [bills, setBills] = useState<Bill[]>([]);\n  const [selectedBill, setSelectedBill] = useState<Bill | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [billToDelete, setBillToDelete] = useState<string | null>(null);\n  const [selectedBills, setSelectedBills] = useState<string[]>([]);\n  const [viewMode, setViewMode] = useState<'list' | 'table'>('table');\n  const [recordPaymentDialogOpen, setRecordPaymentDialogOpen] = useState(false);\n  const [voidDialogOpen, setVoidDialogOpen] = useState(false);\n  const [expectedPaymentDateDialogOpen, setExpectedPaymentDateDialogOpen] = useState(false);\n  const [expectedPaymentDate, setExpectedPaymentDate] = useState(\"\");\n  const [journalDialogOpen, setJournalDialogOpen] = useState(false);\n\n  useEffect(() => {\n    fetchBills();\n  }, []);\n\n  const fetchBills = async () => {\n    try {\n      const response = await fetch('/api/bills');\n      if (response.ok) {\n        const data = await response.json();\n        setBills(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch bills:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchBillDetail = async (id: string) => {\n    try {\n      const response = await fetch(`/api/bills/${id}`);\n      if (response.ok) {\n        const data = await response.json();\n        setSelectedBill(data.data);\n      }\n    } catch (error) {\n      console.error('Failed to fetch bill detail:', error);\n    }\n  };\n\n  const handleBillClick = (bill: Bill) => {\n    fetchBillDetail(bill.id);\n  };\n\n  const handleClosePanel = () => {\n    setSelectedBill(null);\n  };\n\n  const handleEditBill = () => {\n    if (selectedBill) {\n      setLocation(`/bills/${selectedBill.id}/edit`);\n    }\n  };\n\n  const handleDelete = (id: string) => {\n    setBillToDelete(id);\n    setDeleteDialogOpen(true);\n  };\n\n  const confirmDelete = async () => {\n    if (!billToDelete) return;\n    try {\n      const response = await fetch(`/api/bills/${billToDelete}`, { method: 'DELETE' });\n      if (response.ok) {\n        toast({ title: \"Bill deleted successfully\" });\n        fetchBills();\n        if (selectedBill?.id === billToDelete) {\n          handleClosePanel();\n        }\n      }\n    } catch (error) {\n      toast({ title: \"Failed to delete bill\", variant: \"destructive\" });\n    } finally {\n      setDeleteDialogOpen(false);\n      setBillToDelete(null);\n    }\n  };\n\n  const handleMarkPaid = async () => {\n    if (!selectedBill) return;\n    try {\n      const response = await fetch(`/api/bills/${selectedBill.id}/status`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ status: 'PAID' })\n      });\n      if (response.ok) {\n        toast({ title: \"Bill marked as paid\" });\n        fetchBills();\n        fetchBillDetail(selectedBill.id);\n      }\n    } catch (error) {\n      toast({ title: \"Failed to update bill status\", variant: \"destructive\" });\n    }\n  };\n\n  const handleRecordPayment = () => {\n    setRecordPaymentDialogOpen(true);\n  };\n\n  const handlePaymentRecorded = () => {\n    fetchBills();\n    if (selectedBill) {\n      fetchBillDetail(selectedBill.id);\n    }\n  };\n\n  const handleVoid = async () => {\n    if (!selectedBill) return;\n    setVoidDialogOpen(true);\n  };\n\n  const confirmVoid = async () => {\n    if (!selectedBill) return;\n    try {\n      const response = await fetch(`/api/bills/${selectedBill.id}/status`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ status: 'VOID' })\n      });\n      if (response.ok) {\n        toast({ title: \"Bill has been voided\" });\n        fetchBills();\n        fetchBillDetail(selectedBill.id);\n      }\n    } catch (error) {\n      toast({ title: \"Failed to void bill\", variant: \"destructive\" });\n    } finally {\n      setVoidDialogOpen(false);\n    }\n  };\n\n  const handleClone = () => {\n    if (selectedBill) {\n      setLocation(`/bills/new?clone=${selectedBill.id}`);\n    }\n  };\n\n  const handleCreateVendorCredits = () => {\n    if (selectedBill) {\n      setLocation(`/vendor-credits/new?billId=${selectedBill.id}&vendorId=${selectedBill.vendorId}`);\n    }\n  };\n\n  const handleViewJournal = () => {\n    setJournalDialogOpen(true);\n  };\n\n  const handleExpectedPaymentDate = () => {\n    if (selectedBill) {\n      setExpectedPaymentDate(selectedBill.dueDate || \"\");\n      setExpectedPaymentDateDialogOpen(true);\n    }\n  };\n\n  const confirmExpectedPaymentDate = async () => {\n    if (!selectedBill) return;\n    try {\n      const response = await fetch(`/api/bills/${selectedBill.id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ ...selectedBill, expectedPaymentDate })\n      });\n      if (response.ok) {\n        toast({ title: \"Expected payment date updated\" });\n        fetchBills();\n        fetchBillDetail(selectedBill.id);\n      }\n    } catch (error) {\n      toast({ title: \"Failed to update expected payment date\", variant: \"destructive\" });\n    } finally {\n      setExpectedPaymentDateDialogOpen(false);\n    }\n  };\n\n  const toggleSelectBill = (id: string, e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (selectedBills.includes(id)) {\n      setSelectedBills(selectedBills.filter(i => i !== id));\n    } else {\n      setSelectedBills([...selectedBills, id]);\n    }\n  };\n\n  const filteredBills = bills.filter(bill =>\n    bill.billNumber?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    bill.vendorName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    bill.orderNumber?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const { currentPage, totalPages, totalItems, itemsPerPage, paginatedItems, goToPage } = usePagination(filteredBills, 10);\n\n  const getStatusBadge = (status: string) => {\n    switch (status?.toUpperCase()) {\n      case 'PAID':\n        return <Badge variant=\"outline\" className=\"text-green-600 border-green-200 bg-green-50\">PAID</Badge>;\n      case 'OPEN':\n        return <Badge variant=\"outline\" className=\"text-blue-600 border-blue-200 bg-blue-50\">OPEN</Badge>;\n      case 'OVERDUE':\n        return <Badge variant=\"outline\" className=\"text-red-600 border-red-200 bg-red-50\">OVERDUE</Badge>;\n      case 'PARTIALLY_PAID':\n        return <Badge variant=\"outline\" className=\"text-amber-600 border-amber-200 bg-amber-50\">PARTIALLY PAID</Badge>;\n      case 'VOID':\n        return <Badge variant=\"outline\" className=\"text-slate-600 border-slate-200\">VOID</Badge>;\n      default:\n        return <Badge variant=\"outline\">{status}</Badge>;\n    }\n  };\n\n  return (\n    <div className=\"flex h-[calc(100vh-80px)] animate-in fade-in duration-300\">\n      <div className={`flex flex-col overflow-hidden transition-all duration-300 ${selectedBill ? 'flex-1 min-w-[400px]' : 'flex-1'}`}>\n        <div className=\"flex items-center justify-between p-4 border-b border-slate-200\">\n          <div className=\"flex items-center gap-2\">\n            <h1 className=\"text-xl font-semibold text-slate-900\">All Bills</h1>\n            <ChevronDown className=\"h-4 w-4 text-slate-500\" />\n          </div>\n          <div className=\"flex items-center gap-2\">\n            {!selectedBill && (\n              <>\n                <Button\n                  variant=\"outline\"\n                  size=\"icon\"\n                  className={`h-9 w-9 ${viewMode === 'list' ? 'bg-slate-100' : ''}`}\n                  onClick={() => setViewMode('list')}\n                  data-testid=\"button-list-view\"\n                >\n                  <List className=\"h-4 w-4\" />\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  size=\"icon\"\n                  className={`h-9 w-9 ${viewMode === 'table' ? 'bg-slate-100' : ''}`}\n                  onClick={() => setViewMode('table')}\n                  data-testid=\"button-table-view\"\n                >\n                  <Grid3X3 className=\"h-4 w-4\" />\n                </Button>\n              </>\n            )}\n            <Button\n              onClick={() => setLocation(\"/bills/new\")}\n              className=\"bg-blue-600 hover:bg-blue-700 gap-1.5 h-9\"\n              data-testid=\"button-new-bill\"\n            >\n              <Plus className=\"h-4 w-4\" /> New\n            </Button>\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"outline\" size=\"icon\" className=\"h-9 w-9\" data-testid=\"button-more-options\">\n                  <MoreHorizontal className=\"h-4 w-4\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <DropdownMenuItem>\n                  <Download className=\"mr-2 h-4 w-4\" /> Export\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={fetchBills}>\n                  Refresh List\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </div>\n\n        {!selectedBill && (\n          <div className=\"px-4 py-3 flex items-center gap-2 border-b border-slate-200\">\n            <div className=\"relative flex-1 max-w-sm\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400\" />\n              <Input\n                placeholder=\"Search bills...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-9\"\n                data-testid=\"input-search\"\n              />\n            </div>\n            <Button variant=\"outline\" className=\"gap-2\">\n              <Filter className=\"h-4 w-4\" /> Filter\n            </Button>\n          </div>\n        )}\n\n        <div className=\"flex-1 overflow-auto\">\n          {loading ? (\n            <div className=\"p-8 text-center text-slate-500\">Loading bills...</div>\n          ) : filteredBills.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center h-full text-center p-8\">\n              <div className=\"h-16 w-16 rounded-full bg-slate-100 flex items-center justify-center mb-4\">\n                <FileText className=\"h-8 w-8 text-slate-400\" />\n              </div>\n              <h3 className=\"text-lg font-semibold mb-2\">No bills found</h3>\n              <p className=\"text-slate-500 mb-4\">\n                {searchTerm ? 'Try adjusting your search criteria' : 'Create your first bill to get started'}\n              </p>\n              {!searchTerm && (\n                <Button onClick={() => setLocation(\"/bills/new\")} className=\"gap-2\" data-testid=\"button-create-first-bill\">\n                  <Plus className=\"h-4 w-4\" /> Create New Bill\n                </Button>\n              )}\n            </div>\n          ) : selectedBill ? (\n            // When a bill is selected, show only the table view (not the list view with names)\n            <Table>\n              <TableHeader>\n                <TableRow className=\"bg-slate-50\">\n                  <TableHead className=\"w-10\"></TableHead>\n                  <TableHead className=\"text-xs\">DATE</TableHead>\n                  <TableHead className=\"text-xs\">BILL#</TableHead>\n                  <TableHead className=\"text-xs\">REFERENCE NUMBER</TableHead>\n                  <TableHead className=\"text-xs\">VENDOR NAME</TableHead>\n                  <TableHead className=\"text-xs\">STATUS</TableHead>\n                  <TableHead className=\"text-xs\">DUE DATE</TableHead>\n                  <TableHead className=\"text-xs text-right\">AMOUNT</TableHead>\n                  <TableHead className=\"text-xs text-right\">BALANCE DUE</TableHead>\n                  <TableHead className=\"w-10\"></TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {paginatedItems.map((bill) => (\n                  <TableRow\n                    key={bill.id}\n                    onClick={() => handleBillClick(bill)}\n                    className={`cursor-pointer hover-elevate ${selectedBill?.id === bill.id ? 'bg-blue-50' : ''}`}\n                    data-testid={`row-bill-${bill.id}`}\n                  >\n                    <TableCell onClick={(e) => e.stopPropagation()}>\n                      <Checkbox\n                        checked={selectedBills.includes(bill.id)}\n                        onClick={(e) => toggleSelectBill(bill.id, e)}\n                      />\n                    </TableCell>\n                    <TableCell className=\"text-sm\">{formatDate(bill.billDate)}</TableCell>\n                    <TableCell className=\"text-sm text-blue-600 font-medium\">{bill.billNumber}</TableCell>\n                    <TableCell className=\"text-sm\">{bill.orderNumber || '-'}</TableCell>\n                    <TableCell className=\"text-sm\">{bill.vendorName}</TableCell>\n                    <TableCell>{getStatusBadge(bill.status)}</TableCell>\n                    <TableCell className=\"text-sm\">{formatDate(bill.dueDate)}</TableCell>\n                    <TableCell className=\"text-sm text-right font-medium\">{formatCurrency(bill.total)}</TableCell>\n                    <TableCell className=\"text-sm text-right\">{formatCurrency(bill.balanceDue)}</TableCell>\n                    <TableCell>\n                      <DropdownMenu>\n                        <DropdownMenuTrigger asChild onClick={(e) => e.stopPropagation()}>\n                          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n                            <MoreHorizontal className=\"h-4 w-4\" />\n                          </Button>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent align=\"end\">\n                          <DropdownMenuItem onClick={() => setLocation(`/bills/${bill.id}/edit`)}>\n                            <Pencil className=\"mr-2 h-4 w-4\" /> Edit\n                          </DropdownMenuItem>\n                          <DropdownMenuItem className=\"text-red-600\" onClick={() => handleDelete(bill.id)}>\n                            <Trash2 className=\"mr-2 h-4 w-4\" /> Delete\n                          </DropdownMenuItem>\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow className=\"bg-slate-50\">\n                  <TableHead className=\"w-10\"></TableHead>\n                  <TableHead className=\"text-xs\">DATE</TableHead>\n                  <TableHead className=\"text-xs\">BILL#</TableHead>\n                  <TableHead className=\"text-xs\">REFERENCE NUMBER</TableHead>\n                  <TableHead className=\"text-xs\">VENDOR NAME</TableHead>\n                  <TableHead className=\"text-xs\">STATUS</TableHead>\n                  <TableHead className=\"text-xs\">DUE DATE</TableHead>\n                  <TableHead className=\"text-xs text-right\">AMOUNT</TableHead>\n                  <TableHead className=\"text-xs text-right\">BALANCE DUE</TableHead>\n                  <TableHead className=\"w-10\"></TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {paginatedItems.map((bill) => (\n                  <TableRow\n                    key={bill.id}\n                    onClick={() => handleBillClick(bill)}\n                    className={`cursor-pointer hover-elevate ${selectedBill?.id === bill.id ? 'bg-blue-50' : ''}`}\n                    data-testid={`row-bill-${bill.id}`}\n                  >\n                    <TableCell onClick={(e) => e.stopPropagation()}>\n                      <Checkbox\n                        checked={selectedBills.includes(bill.id)}\n                        onClick={(e) => toggleSelectBill(bill.id, e)}\n                      />\n                    </TableCell>\n                    <TableCell className=\"text-sm\">{formatDate(bill.billDate)}</TableCell>\n                    <TableCell className=\"text-sm text-blue-600 font-medium\">{bill.billNumber}</TableCell>\n                    <TableCell className=\"text-sm\">{bill.orderNumber || '-'}</TableCell>\n                    <TableCell className=\"text-sm\">{bill.vendorName}</TableCell>\n                    <TableCell>{getStatusBadge(bill.status)}</TableCell>\n                    <TableCell className=\"text-sm\">{formatDate(bill.dueDate)}</TableCell>\n                    <TableCell className=\"text-sm text-right\">{formatCurrency(bill.total)}</TableCell>\n                    <TableCell className=\"text-sm text-right\">{formatCurrency(bill.balanceDue)}</TableCell>\n                    <TableCell>\n                      <DropdownMenu>\n                        <DropdownMenuTrigger asChild onClick={(e) => e.stopPropagation()}>\n                          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n                            <MoreHorizontal className=\"h-4 w-4\" />\n                          </Button>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent align=\"end\">\n                          <DropdownMenuItem onClick={(e) => { e.stopPropagation(); setLocation(`/bills/${bill.id}/edit`); }}>\n                            <Pencil className=\"mr-2 h-4 w-4\" /> Edit\n                          </DropdownMenuItem>\n                          <DropdownMenuSeparator />\n                          <DropdownMenuItem\n                            className=\"text-red-600\"\n                            onClick={(e) => { e.stopPropagation(); handleDelete(bill.id); }}\n                          >\n                            <Trash2 className=\"mr-2 h-4 w-4\" /> Delete\n                          </DropdownMenuItem>\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n          {filteredBills.length > 0 && (\n            <TablePagination\n              currentPage={currentPage}\n              totalPages={totalPages}\n              totalItems={totalItems}\n              itemsPerPage={itemsPerPage}\n              onPageChange={goToPage}\n            />\n          )}\n        </div>\n      </div>\n\n      {selectedBill && (\n        <div className=\"w-full max-w-[600px] lg:w-[600px] flex-shrink-0 border-l border-slate-200\">\n          <BillDetailPanel\n            bill={selectedBill}\n            onClose={handleClosePanel}\n            onEdit={handleEditBill}\n            onDelete={() => handleDelete(selectedBill.id)}\n            onMarkPaid={handleMarkPaid}\n            onRecordPayment={handleRecordPayment}\n            onVoid={handleVoid}\n            onClone={handleClone}\n            onCreateVendorCredits={handleCreateVendorCredits}\n            onViewJournal={handleViewJournal}\n            onExpectedPaymentDate={handleExpectedPaymentDate}\n          />\n        </div>\n      )}\n\n      {/* Record Payment Dialog */}\n      <RecordPaymentDialog\n        isOpen={recordPaymentDialogOpen}\n        onClose={() => setRecordPaymentDialogOpen(false)}\n        bill={selectedBill}\n        onPaymentRecorded={handlePaymentRecorded}\n      />\n\n      {/* Delete Bill Dialog */}\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Bill</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete this bill? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={confirmDelete} className=\"bg-red-600 hover:bg-red-700\">\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Void Bill Dialog */}\n      <AlertDialog open={voidDialogOpen} onOpenChange={setVoidDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Void Bill</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to void this bill? This will cancel the bill and it cannot be used for any transactions.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={confirmVoid} className=\"bg-red-600 hover:bg-red-700\">\n              Void Bill\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Expected Payment Date Dialog */}\n      <Dialog open={expectedPaymentDateDialogOpen} onOpenChange={setExpectedPaymentDateDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Expected Payment Date</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"space-y-2\">\n              <Label>Expected Payment Date</Label>\n              <Input\n                type=\"date\"\n                value={expectedPaymentDate}\n                onChange={(e) => setExpectedPaymentDate(e.target.value)}\n                data-testid=\"input-expected-payment-date\"\n              />\n            </div>\n            <div className=\"flex justify-end gap-2\">\n              <Button variant=\"outline\" onClick={() => setExpectedPaymentDateDialogOpen(false)}>\n                Cancel\n              </Button>\n              <Button onClick={confirmExpectedPaymentDate} className=\"bg-blue-600 hover:bg-blue-700\">\n                Save\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* View Journal Dialog */}\n      <Dialog open={journalDialogOpen} onOpenChange={setJournalDialogOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Journal Entries</DialogTitle>\n          </DialogHeader>\n          <div className=\"pt-4\">\n            <p className=\"text-xs text-slate-500 mb-2\">\n              Amount is displayed in your base currency <Badge variant=\"outline\" className=\"text-xs\">INR</Badge>\n            </p>\n            {selectedBill && (\n              <>\n                <h4 className=\"font-semibold mb-2\">Bill - {selectedBill.billNumber}</h4>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead className=\"text-xs\">ACCOUNT</TableHead>\n                      <TableHead className=\"text-xs text-right\">DEBIT</TableHead>\n                      <TableHead className=\"text-xs text-right\">CREDIT</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {selectedBill.journalEntries && selectedBill.journalEntries.length > 0 ? (\n                      selectedBill.journalEntries.map((entry, index) => (\n                        <TableRow key={index}>\n                          <TableCell>{entry.account}</TableCell>\n                          <TableCell className=\"text-right\">{entry.debit.toFixed(2)}</TableCell>\n                          <TableCell className=\"text-right\">{entry.credit.toFixed(2)}</TableCell>\n                        </TableRow>\n                      ))\n                    ) : (\n                      <>\n                        <TableRow>\n                          <TableCell>Purchases</TableCell>\n                          <TableCell className=\"text-right\">{selectedBill.subTotal.toFixed(2)}</TableCell>\n                          <TableCell className=\"text-right\">0.00</TableCell>\n                        </TableRow>\n                        {selectedBill.taxAmount && selectedBill.taxAmount > 0 && (\n                          <TableRow>\n                            <TableCell>Input Tax Credits (IGST)</TableCell>\n                            <TableCell className=\"text-right\">{selectedBill.taxAmount.toFixed(2)}</TableCell>\n                            <TableCell className=\"text-right\">0.00</TableCell>\n                          </TableRow>\n                        )}\n                        <TableRow>\n                          <TableCell>Accounts Payable</TableCell>\n                          <TableCell className=\"text-right\">0.00</TableCell>\n                          <TableCell className=\"text-right\">{selectedBill.total.toFixed(2)}</TableCell>\n                        </TableRow>\n                      </>\n                    )}\n                  </TableBody>\n                </Table>\n              </>\n            )}\n            <div className=\"flex justify-end mt-4\">\n              <Button variant=\"outline\" onClick={() => setJournalDialogOpen(false)}>\n                Close\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":56322,"size_tokens":null},"client/src/modules/customers/pages/CustomersPage.tsx":{"content":"export { default } from '@/pages/customers';\n","path":null,"size_bytes":45,"size_tokens":null},"client/src/store/index.ts":{"content":"export { useAuthStore } from './authStore';\nexport { useAppStore } from './appStore';\n","path":null,"size_bytes":86,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":649,"size_tokens":null},"client/src/index.css":{"content":"@import \"tailwindcss\";\n@import \"tw-animate-css\";\n\n@custom-variant dark (&:is(.dark *));\n\n@theme inline {\n  --radius-sm: calc(var(--radius) - 4px);\n  --radius-md: calc(var(--radius) - 2px);\n  --radius-lg: var(--radius);\n  --radius-xl: calc(var(--radius) + 4px);\n  \n  --color-background: hsl(var(--background));\n  --color-foreground: hsl(var(--foreground));\n  \n  --color-card: hsl(var(--card));\n  --color-card-foreground: hsl(var(--card-foreground));\n  \n  --color-popover: hsl(var(--popover));\n  --color-popover-foreground: hsl(var(--popover-foreground));\n  \n  --color-primary: hsl(var(--primary));\n  --color-primary-foreground: hsl(var(--primary-foreground));\n  \n  --color-secondary: hsl(var(--secondary));\n  --color-secondary-foreground: hsl(var(--secondary-foreground));\n  \n  --color-muted: hsl(var(--muted));\n  --color-muted-foreground: hsl(var(--muted-foreground));\n  \n  --color-accent: hsl(var(--accent));\n  --color-accent-foreground: hsl(var(--accent-foreground));\n  \n  --color-destructive: hsl(var(--destructive));\n  --color-destructive-foreground: hsl(var(--destructive-foreground));\n  \n  --color-border: hsl(var(--border));\n  --color-input: hsl(var(--input));\n  --color-ring: hsl(var(--ring));\n  \n  --color-sidebar: hsl(var(--sidebar));\n  --color-sidebar-foreground: hsl(var(--sidebar-foreground));\n  --color-sidebar-primary: hsl(var(--sidebar-primary));\n  --color-sidebar-primary-foreground: hsl(var(--sidebar-primary-foreground));\n  --color-sidebar-accent: hsl(var(--sidebar-accent));\n  --color-sidebar-accent-foreground: hsl(var(--sidebar-accent-foreground));\n  --color-sidebar-border: hsl(var(--sidebar-border));\n  --color-sidebar-ring: hsl(var(--sidebar-ring));\n\n  --font-sans: 'Inter', sans-serif;\n  --font-display: 'Plus Jakarta Sans', sans-serif;\n  \n  --radius: 0.75rem; /* 12px */\n}\n\n/* LIGHT MODE - Modern SaaS Palette */\n:root {\n  /* Base Colors - Clean, modern, high-contrast */\n  --background: 0 0% 100%; /* Pure white for better contrast */\n  --foreground: 222 47% 11%; /* Deep Navy */\n\n  /* Card Colors */\n  --card: 0 0% 100%;\n  --card-foreground: 222 47% 11%;\n\n  /* Primary Brand Color - Refined Royal Blue */\n  --primary: 221 83% 53%; /* Slightly more vibrant blue */\n  --primary-foreground: 210 40% 98%;\n\n  /* Secondary - Subtle Blue-Grey */\n  --secondary: 210 40% 96.1%;\n  --secondary-foreground: 222 47% 11.2%;\n\n  /* Muted */\n  --muted: 210 40% 96.1%;\n  --muted-foreground: 215 16% 47%;\n\n  /* Accent */\n  --accent: 210 40% 96.1%;\n  --accent-foreground: 222 47% 11.2%;\n\n  /* Destructive */\n  --destructive: 0 84.2% 60.2%;\n  --destructive-foreground: 210 40% 98%;\n\n  /* Borders & Inputs */\n  --border: 214 32% 91%;\n  --input: 214 32% 91%;\n  --ring: 221 83% 53%;\n\n  /* Sidebar - Dark theme for contrast and professional look */\n  --sidebar: 222 47% 11%;\n  --sidebar-foreground: 210 40% 98%;\n  --sidebar-primary: 221 83% 53%;\n  --sidebar-primary-foreground: 210 40% 98%;\n  --sidebar-accent: 217 33% 17%;\n  --sidebar-accent-foreground: 210 40% 98%;\n  --sidebar-border: 217 33% 17%;\n  --sidebar-ring: 221 83% 53%;\n}\n\n/* Dark mode handled but focusing on light mode as requested */\n.dark {\n  --background: 222 47% 11%;\n  --foreground: 210 40% 98%;\n  --card: 222 47% 11%;\n  --card-foreground: 210 40% 98%;\n  --popover: 222 47% 11%;\n  --popover-foreground: 210 40% 98%;\n  --primary: 217 91% 60%;\n  --primary-foreground: 222 47.4% 11.2%;\n  --secondary: 217.2 32.6% 17.5%;\n  --secondary-foreground: 210 40% 98%;\n  --muted: 217.2 32.6% 17.5%;\n  --muted-foreground: 215 20.2% 65.1%;\n  --accent: 217.2 32.6% 17.5%;\n  --accent-foreground: 210 40% 98%;\n  --destructive: 0 62.8% 30.6%;\n  --destructive-foreground: 210 40% 98%;\n  --border: 217.2 32.6% 17.5%;\n  --input: 217.2 32.6% 17.5%;\n  --ring: 224.3 76.3% 48%;\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n  h1, h2, h3, h4, h5, h6 {\n    @apply font-display tracking-tight;\n  }\n}\n\n/* Custom scrollbar styles for dropdowns */\n.custom-scrollbar,\n[cmdk-list],\n[data-radix-scroll-area-viewport] {\n  scrollbar-width: thin;\n  scrollbar-color: #cbd5e1 transparent;\n}\n\n.custom-scrollbar::-webkit-scrollbar,\n[cmdk-list]::-webkit-scrollbar,\n[data-radix-scroll-area-viewport]::-webkit-scrollbar {\n  width: 6px;\n  height: 6px;\n}\n\n.custom-scrollbar::-webkit-scrollbar-track,\n[cmdk-list]::-webkit-scrollbar-track,\n[data-radix-scroll-area-viewport]::-webkit-scrollbar-track {\n  background: #f1f5f9;\n  border-radius: 3px;\n}\n\n.custom-scrollbar::-webkit-scrollbar-thumb,\n[cmdk-list]::-webkit-scrollbar-thumb,\n[data-radix-scroll-area-viewport]::-webkit-scrollbar-thumb {\n  background: #cbd5e1;\n  border-radius: 3px;\n}\n\n.custom-scrollbar::-webkit-scrollbar-thumb:hover,\n[cmdk-list]::-webkit-scrollbar-thumb:hover,\n[data-radix-scroll-area-viewport]::-webkit-scrollbar-thumb:hover {\n  background: #94a3b8;\n}\n","path":null,"size_bytes":4835,"size_tokens":null},"client/src/pages/products.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Plus, MoreHorizontal, ChevronDown, ArrowUpDown, Import, Download, Settings, RefreshCw, RotateCcw, FileText, CheckSquare, History, Search } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n  DropdownMenuSub,\n  DropdownMenuSubTrigger,\n  DropdownMenuSubContent,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { usePagination } from \"@/hooks/use-pagination\";\nimport { TablePagination } from \"@/components/table-pagination\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\ninterface Item {\n  id: string;\n  name: string;\n  type: string;\n  hsnSac: string;\n  usageUnit: string;\n  rate: string;\n  purchaseRate: string;\n  description: string;\n  purchaseDescription: string;\n  taxPreference: string;\n  intraStateTax: string;\n  interStateTax: string;\n  salesAccount: string;\n  purchaseAccount: string;\n  isActive: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\ntype FilterStatus = 'all' | 'active' | 'inactive';\n\nconst filterOptions: { label: string; value: FilterStatus }[] = [\n  { label: \"All Items\", value: \"all\" },\n  { label: \"Active Items\", value: \"active\" },\n  { label: \"Inactive Items\", value: \"inactive\" },\n];\n\nexport default function Products() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [selectedItems, setSelectedItems] = useState<string[]>([]);\n  const [filterStatus, setFilterStatus] = useState<FilterStatus>(\"all\");\n  const [filterOpen, setFilterOpen] = useState(false);\n  const [selectedItem, setSelectedItem] = useState<Item | null>(null);\n  const [showItemDetail, setShowItemDetail] = useState(false);\n\n  // Fetch items from API with status filter\n  const { data: itemsData, isLoading, refetch } = useQuery<{ success: boolean; data: Item[] }>({\n    queryKey: ['/api/items', filterStatus],\n    queryFn: async () => {\n      const response = await fetch(`/api/items?status=${filterStatus}`);\n      return response.json();\n    }\n  });\n\n  const items = itemsData?.data || [];\n\n  // Clone item mutation\n  const cloneItemMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest('POST', `/api/items/${id}/clone`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/items'] });\n      toast({ title: \"Item cloned successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to clone item\", variant: \"destructive\" });\n    },\n  });\n\n  // Delete item mutation\n  const deleteItemMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest('DELETE', `/api/items/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/items'] });\n      toast({ title: \"Item deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete item\", variant: \"destructive\" });\n    },\n  });\n\n  // Toggle item status mutation\n  const toggleStatusMutation = useMutation({\n    mutationFn: async ({ id, isActive }: { id: string; isActive: boolean }) => {\n      return apiRequest('PATCH', `/api/items/${id}/status`, { isActive });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/items'] });\n      toast({ title: \"Item status updated\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to update item status\", variant: \"destructive\" });\n    },\n  });\n\n  const { currentPage, totalPages, totalItems, itemsPerPage, paginatedItems, goToPage } = usePagination(items, 10);\n\n  const toggleSelectAll = () => {\n    if (selectedItems.length === items.length) {\n      setSelectedItems([]);\n    } else {\n      setSelectedItems(items.map(item => item.id));\n    }\n  };\n\n  const toggleSelectItem = (id: string) => {\n    if (selectedItems.includes(id)) {\n      setSelectedItems(selectedItems.filter(i => i !== id));\n    } else {\n      setSelectedItems([...selectedItems, id]);\n    }\n  };\n\n  const handleItemClick = (item: Item) => {\n    setSelectedItem(item);\n    setShowItemDetail(true);\n  };\n\n  const formatCurrency = (value: string | number) => {\n    const num = typeof value === 'string' ? parseFloat(value) : value;\n    if (isNaN(num)) return '0.00';\n    return new Intl.NumberFormat('en-IN', {\n      style: 'currency',\n      currency: 'INR',\n    }).format(num);\n  };\n\n  const getCurrentFilterLabel = () => {\n    const option = filterOptions.find(o => o.value === filterStatus);\n    return option?.label || \"All Items\";\n  };\n\n  return (\n    <div className=\"flex h-[calc(100vh-80px)] animate-in fade-in duration-300\">\n      {/* Main Content */}\n      <div className={`flex flex-col overflow-hidden transition-all duration-300 ${showItemDetail ? 'w-[60%]' : 'w-full'}`}>\n        <div className=\"w-full space-y-4 p-4 overflow-y-auto\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              {/* Filter Dropdown */}\n              <DropdownMenu open={filterOpen} onOpenChange={setFilterOpen}>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"ghost\" className=\"text-xl font-semibold text-slate-900 gap-2 px-2\" data-testid=\"dropdown-items-filter\">\n                    {getCurrentFilterLabel()}\n                    <ChevronDown className=\"h-4 w-4 text-slate-500\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"start\" className=\"w-48\">\n                  {filterOptions.map((option) => (\n                    <DropdownMenuItem\n                      key={option.value}\n                      onClick={() => {\n                        setFilterStatus(option.value);\n                        setFilterOpen(false);\n                      }}\n                      className={filterStatus === option.value ? \"bg-blue-50 text-blue-600\" : \"\"}\n                      data-testid={`filter-option-${option.value}`}\n                    >\n                      {option.label}\n                    </DropdownMenuItem>\n                  ))}\n                </DropdownMenuContent>\n              </DropdownMenu>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Button \n                onClick={() => setLocation(\"/products/new\")} \n                className=\"bg-blue-600 hover:bg-blue-700 gap-1.5 h-9\"\n                data-testid=\"button-new-item\"\n              >\n                <Plus className=\"h-4 w-4\" /> New\n              </Button>\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"outline\" size=\"icon\" className=\"h-9 w-9\" data-testid=\"button-more-options\">\n                    <MoreHorizontal className=\"h-4 w-4\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"end\" className=\"w-56\">\n                  <DropdownMenuSub>\n                    <DropdownMenuSubTrigger>\n                      <ArrowUpDown className=\"mr-2 h-4 w-4\" />\n                      Sort by\n                    </DropdownMenuSubTrigger>\n                    <DropdownMenuSubContent>\n                      <DropdownMenuItem>Name</DropdownMenuItem>\n                      <DropdownMenuItem>Purchase Rate</DropdownMenuItem>\n                      <DropdownMenuItem>Rate</DropdownMenuItem>\n                      <DropdownMenuItem>HSN/SAC</DropdownMenuItem>\n                      <DropdownMenuItem>Last Modified Time</DropdownMenuItem>\n                      <DropdownMenuItem>Created Time</DropdownMenuItem>\n                    </DropdownMenuSubContent>\n                  </DropdownMenuSub>\n                  <DropdownMenuItem>\n                    <Import className=\"mr-2 h-4 w-4\" />\n                    Import Items\n                  </DropdownMenuItem>\n                  <DropdownMenuSub>\n                    <DropdownMenuSubTrigger>\n                      <Download className=\"mr-2 h-4 w-4\" />\n                      Export\n                    </DropdownMenuSubTrigger>\n                    <DropdownMenuSubContent>\n                      <DropdownMenuItem>Export as CSV</DropdownMenuItem>\n                      <DropdownMenuItem>Export as Excel</DropdownMenuItem>\n                    </DropdownMenuSubContent>\n                  </DropdownMenuSub>\n                  <DropdownMenuSeparator />\n                  <DropdownMenuItem onClick={() => refetch()}>\n                    <RefreshCw className=\"mr-2 h-4 w-4\" />\n                    Refresh List\n                  </DropdownMenuItem>\n                  <DropdownMenuItem>\n                    <Settings className=\"mr-2 h-4 w-4\" />\n                    Preferences\n                  </DropdownMenuItem>\n                  <DropdownMenuItem>\n                    <RotateCcw className=\"mr-2 h-4 w-4\" />\n                    Reset Column Width\n                  </DropdownMenuItem>\n                  <DropdownMenuSeparator />\n                  <DropdownMenuItem>\n                    <FileText className=\"mr-2 h-4 w-4\" />\n                    Update New GST Rates\n                  </DropdownMenuItem>\n                  <DropdownMenuItem>\n                    <CheckSquare className=\"mr-2 h-4 w-4\" />\n                    Validate HSN/SAC\n                  </DropdownMenuItem>\n                  <DropdownMenuItem>\n                    <History className=\"mr-2 h-4 w-4\" />\n                    HSN/SAC Update History\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            </div>\n          </div>\n\n          <div className=\"border border-slate-200 rounded-lg bg-white overflow-hidden\">\n            {isLoading ? (\n              <div className=\"p-4 space-y-3\">\n                {[1, 2, 3, 4, 5].map((i) => (\n                  <div key={i} className=\"flex gap-4\">\n                    <Skeleton className=\"h-4 w-4\" />\n                    <Skeleton className=\"h-4 w-32\" />\n                    <Skeleton className=\"h-4 w-48\" />\n                    <Skeleton className=\"h-4 w-20\" />\n                    <Skeleton className=\"h-4 w-48\" />\n                    <Skeleton className=\"h-4 w-20\" />\n                    <Skeleton className=\"h-4 w-24\" />\n                    <Skeleton className=\"h-4 w-16\" />\n                  </div>\n                ))}\n              </div>\n            ) : items.length === 0 ? (\n              <div className=\"p-12 text-center\">\n                <div className=\"text-slate-400 text-lg mb-2\">No items found</div>\n                <p className=\"text-slate-500 text-sm\">\n                  {filterStatus === 'active' \n                    ? \"No active items found. Try viewing all items.\" \n                    : filterStatus === 'inactive' \n                    ? \"No inactive items found. Try viewing all items.\"\n                    : \"Create your first item to get started.\"}\n                </p>\n                <Button \n                  onClick={() => setLocation(\"/products/new\")} \n                  className=\"mt-4 bg-blue-600 hover:bg-blue-700\"\n                  data-testid=\"button-create-first-item\"\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" /> Create Item\n                </Button>\n              </div>\n            ) : (\n              <>\n                <Table>\n                  <TableHeader>\n                    <TableRow className=\"bg-slate-50/80 hover:bg-slate-50/80\">\n                      <TableHead className=\"w-12\">\n                        <Checkbox \n                          checked={selectedItems.length === items.length && items.length > 0}\n                          onCheckedChange={toggleSelectAll}\n                          data-testid=\"checkbox-select-all\"\n                        />\n                      </TableHead>\n                      <TableHead className=\"font-medium text-slate-600\">\n                        <div className=\"flex items-center gap-1\">\n                          NAME\n                          <ArrowUpDown className=\"h-3 w-3\" />\n                        </div>\n                      </TableHead>\n                      <TableHead className=\"font-medium text-slate-600\">PURCHASE DESCRIPTION</TableHead>\n                      <TableHead className=\"font-medium text-slate-600\">PURCHASE RATE</TableHead>\n                      <TableHead className=\"font-medium text-slate-600\">DESCRIPTION</TableHead>\n                      <TableHead className=\"font-medium text-slate-600\">RATE</TableHead>\n                      <TableHead className=\"font-medium text-slate-600\">HSN/SAC</TableHead>\n                      <TableHead className=\"font-medium text-slate-600\">USAGE UNIT</TableHead>\n                      <TableHead className=\"w-10\"></TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {paginatedItems.map((item) => (\n                      <TableRow \n                        key={item.id} \n                        className={`hover:bg-slate-50/50 cursor-pointer ${!item.isActive ? 'opacity-50' : ''}`}\n                        onClick={() => handleItemClick(item)}\n                        data-testid={`row-item-${item.id}`}\n                      >\n                        <TableCell onClick={(e) => e.stopPropagation()}>\n                          <Checkbox \n                            checked={selectedItems.includes(item.id)}\n                            onCheckedChange={() => toggleSelectItem(item.id)}\n                            data-testid={`checkbox-item-${item.id}`}\n                          />\n                        </TableCell>\n                        <TableCell className=\"font-medium text-blue-600 hover:underline\">\n                          {item.name}\n                          {!item.isActive && <span className=\"ml-2 text-xs text-slate-500\">(Inactive)</span>}\n                        </TableCell>\n                        <TableCell className=\"text-slate-600\">{item.purchaseDescription || '-'}</TableCell>\n                        <TableCell className=\"text-slate-600\">{formatCurrency(item.purchaseRate)}</TableCell>\n                        <TableCell className=\"text-slate-600\">{item.description || '-'}</TableCell>\n                        <TableCell className=\"text-slate-600\">{formatCurrency(item.rate)}</TableCell>\n                        <TableCell className=\"text-slate-600\">{item.hsnSac || '-'}</TableCell>\n                        <TableCell className=\"text-slate-600\">{item.usageUnit || '-'}</TableCell>\n                        <TableCell onClick={(e) => e.stopPropagation()}>\n                          <DropdownMenu>\n                            <DropdownMenuTrigger asChild>\n                              <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" data-testid={`button-item-menu-${item.id}`}>\n                                <MoreHorizontal className=\"h-4 w-4\" />\n                              </Button>\n                            </DropdownMenuTrigger>\n                            <DropdownMenuContent align=\"end\">\n                              <DropdownMenuItem onClick={() => setLocation(`/products/${item.id}/edit`)}>\n                                Edit\n                              </DropdownMenuItem>\n                              <DropdownMenuItem onClick={() => cloneItemMutation.mutate(item.id)}>\n                                Clone Item\n                              </DropdownMenuItem>\n                              <DropdownMenuItem onClick={() => toggleStatusMutation.mutate({ id: item.id, isActive: !item.isActive })}>\n                                {item.isActive ? 'Mark as Inactive' : 'Mark as Active'}\n                              </DropdownMenuItem>\n                              <DropdownMenuSeparator />\n                              <DropdownMenuItem \n                                className=\"text-red-600\"\n                                onClick={() => deleteItemMutation.mutate(item.id)}\n                              >\n                                Delete\n                              </DropdownMenuItem>\n                            </DropdownMenuContent>\n                          </DropdownMenu>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n                <TablePagination\n                  currentPage={currentPage}\n                  totalPages={totalPages}\n                  totalItems={totalItems}\n                  itemsPerPage={itemsPerPage}\n                  onPageChange={goToPage}\n                />\n              </>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Item Detail Panel */}\n      {showItemDetail && selectedItem && (\n        <div className=\"w-[40%] border-l border-slate-200 bg-white overflow-y-auto\">\n          <div className=\"sticky top-0 bg-white border-b border-slate-200 p-4 z-10\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-lg font-semibold\" data-testid=\"item-detail-name\">{selectedItem.name}</h2>\n              <div className=\"flex items-center gap-2\">\n                <DropdownMenu>\n                  <DropdownMenuTrigger asChild>\n                    <Button variant=\"outline\" size=\"sm\" className=\"gap-1\" data-testid=\"button-item-detail-more\">\n                      More <ChevronDown className=\"h-3 w-3\" />\n                    </Button>\n                  </DropdownMenuTrigger>\n                  <DropdownMenuContent align=\"end\">\n                    <DropdownMenuItem onClick={() => cloneItemMutation.mutate(selectedItem.id)}>\n                      Clone Item\n                    </DropdownMenuItem>\n                    <DropdownMenuItem onClick={() => toggleStatusMutation.mutate({ id: selectedItem.id, isActive: !selectedItem.isActive })}>\n                      {selectedItem.isActive ? 'Mark as Inactive' : 'Mark as Active'}\n                    </DropdownMenuItem>\n                    <DropdownMenuSeparator />\n                    <DropdownMenuItem \n                      className=\"text-red-600\"\n                      onClick={() => {\n                        deleteItemMutation.mutate(selectedItem.id);\n                        setShowItemDetail(false);\n                        setSelectedItem(null);\n                      }}\n                    >\n                      Delete\n                    </DropdownMenuItem>\n                  </DropdownMenuContent>\n                </DropdownMenu>\n                <Button \n                  variant=\"ghost\" \n                  size=\"icon\" \n                  onClick={() => {\n                    setShowItemDetail(false);\n                    setSelectedItem(null);\n                  }}\n                  data-testid=\"button-close-detail\"\n                >\n                  <span className=\"sr-only\">Close</span>\n                  \n                </Button>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"p-4 space-y-6\">\n            {/* Overview Tab */}\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <p className=\"text-sm text-slate-500\">Item Type</p>\n                  <p className=\"font-medium capitalize\" data-testid=\"item-detail-type\">{selectedItem.type === 'goods' ? 'Sales and Purchase Items' : 'Service'}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-slate-500\">HSN Code</p>\n                  <p className=\"font-medium\" data-testid=\"item-detail-hsn\">{selectedItem.hsnSac || '-'}</p>\n                </div>\n              </div>\n              \n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <p className=\"text-sm text-slate-500\">Created Source</p>\n                  <p className=\"font-medium\">User</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-slate-500\">Tax Preference</p>\n                  <p className=\"font-medium capitalize\" data-testid=\"item-detail-tax-pref\">{selectedItem.taxPreference || 'taxable'}</p>\n                </div>\n              </div>\n              \n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <p className=\"text-sm text-slate-500\">Intra State Tax Rate</p>\n                  <p className=\"font-medium\" data-testid=\"item-detail-intra-tax\">{selectedItem.intraStateTax || '-'}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-slate-500\">Inter State Tax Rate</p>\n                  <p className=\"font-medium\" data-testid=\"item-detail-inter-tax\">{selectedItem.interStateTax || '-'}</p>\n                </div>\n              </div>\n\n              <div className=\"border-t pt-4 mt-4\">\n                <h3 className=\"font-medium mb-3\">Purchase Information</h3>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <p className=\"text-sm text-slate-500\">Cost Price</p>\n                    <p className=\"font-medium\" data-testid=\"item-detail-cost-price\">{formatCurrency(selectedItem.purchaseRate)}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-slate-500\">Purchase Account</p>\n                    <p className=\"font-medium\" data-testid=\"item-detail-purchase-account\">{selectedItem.purchaseAccount || '-'}</p>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"border-t pt-4\">\n                <h3 className=\"font-medium mb-3\">Sales Information</h3>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <p className=\"text-sm text-slate-500\">Selling Price</p>\n                    <p className=\"font-medium\" data-testid=\"item-detail-selling-price\">{formatCurrency(selectedItem.rate)}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-slate-500\">Sales Account</p>\n                    <p className=\"font-medium\" data-testid=\"item-detail-sales-account\">{selectedItem.salesAccount || '-'}</p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":22703,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"import * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload\n            .filter((item) => item.type !== \"none\")\n            .map((item, index) => {\n              const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n              const itemConfig = getPayloadConfigFromPayload(config, item, key)\n              const indicatorColor = color || item.payload.fill || item.color\n\n              return (\n                <div\n                  key={item.dataKey}\n                  className={cn(\n                    \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                    indicator === \"dot\" && \"items-center\"\n                  )}\n                >\n                  {formatter && item?.value !== undefined && item.name ? (\n                    formatter(item.value, item.name, item, index, item.payload)\n                  ) : (\n                    <>\n                      {itemConfig?.icon ? (\n                        <itemConfig.icon />\n                      ) : (\n                        !hideIndicator && (\n                          <div\n                            className={cn(\n                              \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                              {\n                                \"h-2.5 w-2.5\": indicator === \"dot\",\n                                \"w-1\": indicator === \"line\",\n                                \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                  indicator === \"dashed\",\n                                \"my-0.5\": nestLabel && indicator === \"dashed\",\n                              }\n                            )}\n                            style={\n                              {\n                                \"--color-bg\": indicatorColor,\n                                \"--color-border\": indicatorColor,\n                              } as React.CSSProperties\n                            }\n                          />\n                        )\n                      )}\n                      <div\n                        className={cn(\n                          \"flex flex-1 justify-between leading-none\",\n                          nestLabel ? \"items-end\" : \"items-center\"\n                        )}\n                      >\n                        <div className=\"grid gap-1.5\">\n                          {nestLabel ? tooltipLabel : null}\n                          <span className=\"text-muted-foreground\">\n                            {itemConfig?.label || item.name}\n                          </span>\n                        </div>\n                        {item.value && (\n                          <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                            {item.value.toLocaleString()}\n                          </span>\n                        )}\n                      </div>\n                    </>\n                  )}\n                </div>\n              )\n            })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload\n          .filter((item) => item.type !== \"none\")\n          .map((item) => {\n            const key = `${nameKey || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n            return (\n              <div\n                key={item.value}\n                className={cn(\n                  \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n                )}\n              >\n                {itemConfig?.icon && !hideIcon ? (\n                  <itemConfig.icon />\n                ) : (\n                  <div\n                    className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                    style={{\n                      backgroundColor: item.color,\n                    }}\n                  />\n                )}\n                {itemConfig?.label}\n              </div>\n            )\n          })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10763,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverAnchor = PopoverPrimitive.Anchor\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-[100] w-72 rounded-md border bg-white dark:bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }\n","path":null,"size_bytes":1359,"size_tokens":null},"client/src/components/MongoErrorPanel.tsx":{"content":"import { AlertCircle } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\n\nexport default function MongoErrorPanel() {\n  return (\n    <div className=\"bg-[#fff1f0] border border-[#ffccc7] rounded-md overflow-hidden shadow-sm max-w-xl mx-auto font-mono text-sm\">\n      <div className=\"bg-[#ff4d4f] text-white px-4 py-2 flex items-center gap-2 font-medium\">\n        <AlertCircle className=\"h-4 w-4\" />\n        <span>Connection Error</span>\n      </div>\n      <div className=\"p-4 space-y-3\">\n        <p className=\"text-[#a8071a]\">\n          connect ECONNREFUSED 127.0.0.1:27017\n        </p>\n        <div className=\"space-y-1\">\n          <label className=\"text-xs text-slate-500\">Connection String</label>\n          <Input\n            value=\"mongodb://127.0.0.1:27017/Billing_db\"\n            readOnly\n            className=\"font-mono text-xs bg-white border-slate-300 h-8\"\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":944,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":724,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-xl border bg-card text-card-foreground shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","path":null,"size_bytes":1828,"size_tokens":null},"client/src/modules/accounting/pages/FilingCompliancePage.tsx":{"content":"export { default } from '@/pages/filing-compliance';\n","path":null,"size_bytes":53,"size_tokens":null},"server/src/modules/items/routes/index.ts":{"content":"import { Router } from 'express';\nimport { ItemsController } from '../controller';\nimport { authenticate } from '../../../middleware';\n\nexport const itemsRouter = Router();\nconst controller = new ItemsController();\n\nitemsRouter.get('/', controller.getAll);\nitemsRouter.get('/:id', controller.getById);\nitemsRouter.post('/', authenticate, controller.create);\nitemsRouter.put('/:id', authenticate, controller.update);\nitemsRouter.delete('/:id', authenticate, controller.delete);\n\nexport default itemsRouter;\n","path":null,"size_bytes":506,"size_tokens":null},"client/src/modules/items/hooks/index.ts":{"content":"export * from './useItems';\n","path":null,"size_bytes":28,"size_tokens":null},"client/src/modules/expenses/pages/ExpensesPage.tsx":{"content":"export { default } from '@/pages/expenses';\n","path":null,"size_bytes":44,"size_tokens":null},"client/src/modules/settings/pages/SettingsPage.tsx":{"content":"export { default } from '@/pages/settings';\n","path":null,"size_bytes":44,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/pages/time-tracking.tsx":{"content":"import { Plus, Search, Filter, Clock } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent } from \"@/components/ui/card\";\n\nexport default function TimeTracking() {\n  return (\n    <div className=\"max-w-7xl mx-auto space-y-6 animate-in fade-in duration-500\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl sm:text-3xl font-display font-bold text-foreground tracking-tight\">Time Tracking</h1>\n          <p className=\"text-muted-foreground\">Track billable hours and project time for invoicing.</p>\n        </div>\n        <Button className=\"gap-2 shadow-lg shadow-primary/20\">\n          <Plus className=\"h-4 w-4\" /> Log Time\n        </Button>\n      </div>\n\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"relative flex-1\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input placeholder=\"Search time entries...\" className=\"pl-9\" />\n        </div>\n        <Button variant=\"outline\" className=\"gap-2\">\n          <Filter className=\"h-4 w-4\" /> Filter\n        </Button>\n      </div>\n\n      <Card className=\"border-dashed\">\n        <CardContent className=\"flex flex-col items-center justify-center py-16 text-center\">\n          <div className=\"h-16 w-16 rounded-full bg-muted flex items-center justify-center mb-4\">\n            <Clock className=\"h-8 w-8 text-muted-foreground\" />\n          </div>\n          <h3 className=\"text-lg font-semibold mb-2\">No time entries</h3>\n          <p className=\"text-muted-foreground mb-4 max-w-sm\">\n            Start tracking your time to accurately bill clients for your work.\n          </p>\n          <Button className=\"gap-2\">\n            <Plus className=\"h-4 w-4\" /> Log Your First Time Entry\n          </Button>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":1978,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Minus } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-9 w-9 items-center justify-center border-y border-r border-input text-sm shadow-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-1 ring-ring\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Minus />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2143,"size_tokens":null},"client/src/modules/customers/pages/index.ts":{"content":"export { default as CustomersPage } from './CustomersPage';\nexport { default as CustomerCreatePage } from './CustomerCreatePage';\n","path":null,"size_bytes":130,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/shared/components/PageHeader.tsx":{"content":"import { ReactNode } from 'react';\n\ninterface PageHeaderProps {\n  title: string;\n  description?: string;\n  actions?: ReactNode;\n}\n\nexport const PageHeader = ({ title, description, actions }: PageHeaderProps) => {\n  return (\n    <div className=\"flex items-center justify-between mb-6\">\n      <div>\n        <h1 className=\"text-2xl font-semibold text-slate-800\">{title}</h1>\n        {description && (\n          <p className=\"mt-1 text-sm text-slate-500\">{description}</p>\n        )}\n      </div>\n      {actions && <div className=\"flex items-center gap-3\">{actions}</div>}\n    </div>\n  );\n};\n\nexport default PageHeader;\n","path":null,"size_bytes":616,"size_tokens":null},"client/src/modules/settings/pages/index.ts":{"content":"export { default as SettingsPage } from './SettingsPage';\nexport { default as SupportPage } from './SupportPage';\n","path":null,"size_bytes":114,"size_tokens":null},"server/src/modules/expenses/routes/index.ts":{"content":"import { Router } from 'express';\n\nexport const expensesRouter = Router();\n\nexpensesRouter.get('/', (req, res) => {\n  res.json({ success: true, data: [], message: 'Expenses endpoint' });\n});\n\nexpensesRouter.get('/:id', (req, res) => {\n  res.json({ success: true, data: { id: req.params.id }, message: 'Expense detail endpoint' });\n});\n\nexpensesRouter.post('/', (req, res) => {\n  res.json({ success: true, data: req.body, message: 'Expense created' });\n});\n\nexport default expensesRouter;\n","path":null,"size_bytes":488,"size_tokens":null},"server/src/middleware/auth.ts":{"content":"import { Request, Response, NextFunction } from 'express';\n\nexport interface AuthenticatedRequest extends Request {\n  user?: {\n    id: string;\n    email: string;\n    role: string;\n  };\n}\n\nexport const authenticate = (req: AuthenticatedRequest, res: Response, next: NextFunction) => {\n  const authHeader = req.headers.authorization;\n\n  if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    return res.status(401).json({\n      success: false,\n      message: 'Authentication required',\n    });\n  }\n\n  const token = authHeader.split(' ')[1];\n\n  try {\n    // TODO: Implement actual JWT verification\n    // For now, pass through for development\n    req.user = {\n      id: '1',\n      email: 'admin@Billing.com',\n      role: 'admin',\n    };\n    next();\n  } catch (error) {\n    return res.status(401).json({\n      success: false,\n      message: 'Invalid or expired token',\n    });\n  }\n};\n\nexport const requireRole = (...roles: string[]) => {\n  return (req: AuthenticatedRequest, res: Response, next: NextFunction) => {\n    if (!req.user) {\n      return res.status(401).json({\n        success: false,\n        message: 'Authentication required',\n      });\n    }\n\n    if (!roles.includes(req.user.role)) {\n      return res.status(403).json({\n        success: false,\n        message: 'Insufficient permissions',\n      });\n    }\n\n    next();\n  };\n};\n\nexport const optionalAuth = (req: AuthenticatedRequest, res: Response, next: NextFunction) => {\n  const authHeader = req.headers.authorization;\n\n  if (authHeader && authHeader.startsWith('Bearer ')) {\n    const token = authHeader.split(' ')[1];\n    try {\n      // TODO: Implement actual JWT verification\n      req.user = {\n        id: '1',\n        email: 'admin@Billing.com',\n        role: 'admin',\n      };\n    } catch (error) {\n      // Ignore token errors for optional auth\n    }\n  }\n\n  next();\n};\n","path":null,"size_bytes":1844,"size_tokens":null},"client/src/shared/utils/validators.ts":{"content":"export const isValidEmail = (email: string): boolean => {\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return emailRegex.test(email);\n};\n\nexport const isValidPhone = (phone: string): boolean => {\n  const phoneRegex = /^[+]?[(]?[0-9]{1,4}[)]?[-\\s./0-9]*$/;\n  return phoneRegex.test(phone) && phone.replace(/\\D/g, '').length >= 10;\n};\n\nexport const isValidGST = (gst: string): boolean => {\n  const gstRegex = /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/;\n  return gstRegex.test(gst);\n};\n\nexport const isValidPAN = (pan: string): boolean => {\n  const panRegex = /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/;\n  return panRegex.test(pan);\n};\n\nexport const isValidPincode = (pincode: string): boolean => {\n  const pincodeRegex = /^[1-9][0-9]{5}$/;\n  return pincodeRegex.test(pincode);\n};\n\nexport const isValidURL = (url: string): boolean => {\n  try {\n    new URL(url);\n    return true;\n  } catch {\n    return false;\n  }\n};\n\nexport const isValidIFSC = (ifsc: string): boolean => {\n  const ifscRegex = /^[A-Z]{4}0[A-Z0-9]{6}$/;\n  return ifscRegex.test(ifsc);\n};\n\nexport const isValidAccountNumber = (accountNumber: string): boolean => {\n  const accountRegex = /^[0-9]{9,18}$/;\n  return accountRegex.test(accountNumber);\n};\n\nexport const isPositiveNumber = (value: number): boolean => {\n  return !isNaN(value) && value > 0;\n};\n\nexport const isNonNegativeNumber = (value: number): boolean => {\n  return !isNaN(value) && value >= 0;\n};\n","path":null,"size_bytes":1432,"size_tokens":null},"client/src/shared/hooks/useLocalStorage.ts":{"content":"import { useState, useEffect } from 'react';\n\nexport function useLocalStorage<T>(key: string, initialValue: T) {\n  const [storedValue, setStoredValue] = useState<T>(() => {\n    try {\n      const item = window.localStorage.getItem(key);\n      return item ? JSON.parse(item) : initialValue;\n    } catch (error) {\n      console.error(`Error reading localStorage key \"${key}\":`, error);\n      return initialValue;\n    }\n  });\n\n  const setValue = (value: T | ((val: T) => T)) => {\n    try {\n      const valueToStore = value instanceof Function ? value(storedValue) : value;\n      setStoredValue(valueToStore);\n      window.localStorage.setItem(key, JSON.stringify(valueToStore));\n    } catch (error) {\n      console.error(`Error setting localStorage key \"${key}\":`, error);\n    }\n  };\n\n  const removeValue = () => {\n    try {\n      window.localStorage.removeItem(key);\n      setStoredValue(initialValue);\n    } catch (error) {\n      console.error(`Error removing localStorage key \"${key}\":`, error);\n    }\n  };\n\n  return [storedValue, setValue, removeValue] as const;\n}\n\nexport default useLocalStorage;\n","path":null,"size_bytes":1098,"size_tokens":null},"client/src/pages/accountant.tsx":{"content":"import { Plus, UserPlus, Users, Mail, Shield } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\n\nexport default function Accountant() {\n  return (\n    <div className=\"max-w-7xl mx-auto space-y-6 animate-in fade-in duration-500\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl sm:text-3xl font-display font-bold text-foreground tracking-tight\">Accountant</h1>\n          <p className=\"text-muted-foreground\">Invite and collaborate with your accountant or CA.</p>\n        </div>\n        <Button className=\"gap-2 shadow-lg shadow-primary/20\">\n          <UserPlus className=\"h-4 w-4\" /> Invite Accountant\n        </Button>\n      </div>\n\n      <div className=\"grid gap-6 lg:grid-cols-2\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Users className=\"h-5 w-5 text-primary\" />\n              Collaborate with Your Accountant\n            </CardTitle>\n            <CardDescription>\n              Give your accountant secure access to review your books, generate reports, and file returns.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-start gap-3 p-3 rounded-lg bg-muted/50\">\n              <Shield className=\"h-5 w-5 text-green-600 mt-0.5\" />\n              <div>\n                <p className=\"font-medium text-sm\">Secure Access</p>\n                <p className=\"text-sm text-muted-foreground\">Your accountant gets read-only access with optional permissions for adjustments.</p>\n              </div>\n            </div>\n            <div className=\"flex items-start gap-3 p-3 rounded-lg bg-muted/50\">\n              <Mail className=\"h-5 w-5 text-blue-600 mt-0.5\" />\n              <div>\n                <p className=\"font-medium text-sm\">Easy Invitation</p>\n                <p className=\"text-sm text-muted-foreground\">Send an email invite and your accountant can access your books instantly.</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-dashed\">\n          <CardContent className=\"flex flex-col items-center justify-center py-16 text-center\">\n            <div className=\"h-16 w-16 rounded-full bg-muted flex items-center justify-center mb-4\">\n              <UserPlus className=\"h-8 w-8 text-muted-foreground\" />\n            </div>\n            <h3 className=\"text-lg font-semibold mb-2\">No accountant invited</h3>\n            <p className=\"text-muted-foreground mb-4 max-w-sm\">\n              Invite your chartered accountant or tax professional to collaborate on your books.\n            </p>\n            <Button className=\"gap-2\">\n              <UserPlus className=\"h-4 w-4\" /> Invite Your Accountant\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/pages/vendors.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useLocation } from \"wouter\";\nimport {\n  Plus, Search, ChevronDown, ChevronRight, MoreHorizontal, Pencil, Trash2,\n  X, Copy, Ban, FileText, ArrowUpDown, Download, Upload,\n  Settings, RefreshCw, Building2, Bold, Italic, Underline,\n  Printer, Calendar, Link2, Clock, User, Filter, Send, Mail,\n  Receipt, CreditCard, Wallet, BookOpen, Package, Paperclip\n} from \"lucide-react\";\nimport jsPDF from \"jspdf\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { usePagination } from \"@/hooks/use-pagination\";\nimport { TablePagination } from \"@/components/table-pagination\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n  DropdownMenuLabel,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Collapsible,\n  CollapsibleContent,\n  CollapsibleTrigger,\n} from \"@/components/ui/collapsible\";\n\ninterface Attachment {\n  id: string;\n  name: string;\n  size: number;\n  type: string;\n  uploadedAt: string;\n}\n\ninterface Vendor {\n  id: string;\n  salutation?: string;\n  firstName?: string;\n  lastName?: string;\n  companyName?: string;\n  displayName: string;\n  email?: string;\n  workPhone?: string;\n  mobile?: string;\n  gstTreatment?: string;\n  sourceOfSupply?: string;\n  pan?: string;\n  msmeRegistered?: boolean;\n  currency?: string;\n  openingBalance?: number;\n  paymentTerms?: string;\n  tds?: string;\n  payables?: number;\n  unusedCredits?: number;\n  status?: string;\n  attachments?: Attachment[];\n  billingAddress?: {\n    attention?: string;\n    countryRegion?: string;\n    street1?: string;\n    street2?: string;\n    city?: string;\n    state?: string;\n    pinCode?: string;\n    phone?: string;\n    faxNumber?: string;\n  };\n  shippingAddress?: {\n    attention?: string;\n    countryRegion?: string;\n    street1?: string;\n    street2?: string;\n    city?: string;\n    state?: string;\n    pinCode?: string;\n    phone?: string;\n    faxNumber?: string;\n  };\n  contactPersons?: Array<{\n    salutation?: string;\n    firstName?: string;\n    lastName?: string;\n    email?: string;\n    workPhone?: string;\n    mobile?: string;\n  }>;\n  bankDetails?: {\n    accountHolderName?: string;\n    bankName?: string;\n    accountNumber?: string;\n    ifscCode?: string;\n    swiftCode?: string;\n    branchName?: string;\n  };\n  remarks?: string;\n  createdAt?: string;\n  updatedAt?: string;\n}\n\ninterface Comment {\n  id: string;\n  text: string;\n  author: string;\n  createdAt: string;\n}\n\ninterface Transaction {\n  id: string;\n  type: string;\n  date: string;\n  number: string;\n  orderNumber?: string;\n  vendor?: string;\n  paidThrough?: string;\n  amount: number;\n  balance: number;\n  status: string;\n  referenceNumber?: string;\n  customer?: string;\n  invoiceNumber?: string;\n}\n\ninterface SystemMail {\n  id: string;\n  to: string;\n  subject: string;\n  description: string;\n  sentAt: string;\n}\n\ninterface ActivityItem {\n  id: string;\n  type: string;\n  title: string;\n  description: string;\n  user: string;\n  date: string;\n  time: string;\n}\n\nconst formatAddress = (address: any) => {\n  if (!address) return ['-'];\n  const parts = [address.street1, address.street2, address.city, address.state, address.pinCode, address.countryRegion].filter(Boolean);\n  return parts.length > 0 ? parts : ['-'];\n};\n\nconst formatDate = (dateString: string) => {\n  const date = new Date(dateString);\n  return date.toLocaleDateString('en-IN', { day: '2-digit', month: '2-digit', year: 'numeric' });\n};\n\nconst formatDateTime = (dateString: string) => {\n  const date = new Date(dateString);\n  return {\n    date: date.toLocaleDateString('en-IN', { day: '2-digit', month: '2-digit', year: 'numeric' }),\n    time: date.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', hour12: true })\n  };\n};\n\nconst formatCurrency = (amount: number) => {\n  return new Intl.NumberFormat('en-IN', {\n    style: 'currency',\n    currency: 'INR',\n    minimumFractionDigits: 2\n  }).format(amount);\n};\n\nfunction VendorDetailPanel({\n  vendor,\n  onClose,\n  onEdit,\n  onClone,\n  onToggleStatus,\n  onDelete\n}: {\n  vendor: Vendor;\n  onClose: () => void;\n  onEdit: () => void;\n  onClone: () => void;\n  onToggleStatus: () => void;\n  onDelete: () => void;\n}) {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState(\"overview\");\n\n  const [comments, setComments] = useState<Comment[]>([]);\n  const [newComment, setNewComment] = useState(\"\");\n  const [transactions, setTransactions] = useState<Record<string, Transaction[]>>({\n    bills: [],\n    billPayments: [],\n    expenses: [],\n    purchaseOrders: [],\n    vendorCredits: [],\n    journals: []\n  });\n  const [mails, setMails] = useState<SystemMail[]>([]);\n  const [activities, setActivities] = useState<ActivityItem[]>([]);\n\n  const [expandedSections, setExpandedSections] = useState<Record<string, boolean>>({\n    bills: true,\n    billPayments: true,\n    expenses: true,\n    purchaseOrders: false,\n    vendorCredits: false,\n    journals: false\n  });\n\n  const [statementPeriod, setStatementPeriod] = useState(\"this-month\");\n  const [statementFilter, setStatementFilter] = useState(\"all\");\n  const [showEmailDialog, setShowEmailDialog] = useState(false);\n  const [emailTo, setEmailTo] = useState(vendor.email || \"\");\n\n  useEffect(() => {\n    fetchVendorData();\n  }, [vendor.id]);\n\n  const fetchVendorData = async () => {\n    try {\n      const [commentsRes, transactionsRes, mailsRes, activitiesRes] = await Promise.all([\n        fetch(`/api/vendors/${vendor.id}/comments`),\n        fetch(`/api/vendors/${vendor.id}/transactions`),\n        fetch(`/api/vendors/${vendor.id}/mails`),\n        fetch(`/api/vendors/${vendor.id}/activities`)\n      ]);\n\n      if (commentsRes.ok) {\n        const data = await commentsRes.json();\n        setComments(data.data || []);\n      }\n      if (transactionsRes.ok) {\n        const data = await transactionsRes.json();\n        setTransactions(data.data || transactions);\n      }\n      if (mailsRes.ok) {\n        const data = await mailsRes.json();\n        setMails(data.data || []);\n      }\n      if (activitiesRes.ok) {\n        const data = await activitiesRes.json();\n        setActivities(data.data || []);\n      }\n    } catch (error) {\n      console.error('Error fetching vendor data:', error);\n    }\n  };\n\n  const handleAddComment = async () => {\n    if (!newComment.trim()) return;\n    try {\n      const response = await fetch(`/api/vendors/${vendor.id}/comments`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ text: newComment })\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setComments([...comments, data.data]);\n        setNewComment(\"\");\n        toast({ title: \"Comment added successfully\" });\n      }\n    } catch (error) {\n      toast({ title: \"Failed to add comment\", variant: \"destructive\" });\n    }\n  };\n\n  const toggleSection = (section: string) => {\n    setExpandedSections(prev => ({ ...prev, [section]: !prev[section] }));\n  };\n\n  const handlePrint = () => {\n    window.print();\n  };\n\n  const handleDownloadPDF = () => {\n    try {\n      const doc = new jsPDF();\n      const pageWidth = doc.internal.pageSize.getWidth();\n      let yPos = 10;\n\n      // Title\n      doc.setFontSize(14);\n      doc.setFont(undefined, 'bold');\n      doc.text(`Vendor Statement - ${vendor.displayName || ''}`, pageWidth / 2, yPos, { align: 'center' });\n      yPos += 8;\n\n      // Date Range\n      doc.setFontSize(10);\n      doc.setFont(undefined, 'normal');\n      doc.text('From 01/12/2025 To 31/12/2025', pageWidth / 2, yPos, { align: 'center' });\n      yPos += 12;\n\n      // Company Header (Two columns)\n      doc.setFontSize(11);\n      doc.setFont(undefined, 'bold');\n      doc.text('SkilltonIT', 20, yPos);\n\n      // Vendor info on right side\n      const vendorInfoX = 120;\n      doc.setFontSize(10);\n      doc.setFont(undefined, 'normal');\n      doc.text('SkilltonIT', vendorInfoX, yPos);\n      yPos += 6;\n\n      doc.setFontSize(9);\n      doc.text('Hinjewadi - Wakad road', vendorInfoX, yPos);\n      yPos += 5;\n      doc.text('Hinjewadi', vendorInfoX, yPos);\n      yPos += 5;\n      doc.text('Pune Maharashtra 411057', vendorInfoX, yPos);\n      yPos += 5;\n      doc.text('India', vendorInfoX, yPos);\n      yPos += 5;\n      doc.text('GSTIN 27AZCPA5145K1ZH', vendorInfoX, yPos);\n      yPos += 5;\n      doc.text('Sales.SkilltonIT@skilltonit.com', vendorInfoX, yPos);\n      yPos += 5;\n      doc.text('www.skilltonit.com', vendorInfoX, yPos);\n      yPos += 10;\n\n      // \"To:\" Section\n      doc.setFontSize(9);\n      doc.setFont(undefined, 'normal');\n      doc.text('To', 20, yPos);\n      yPos += 6;\n\n      doc.setFontSize(10);\n      doc.setFont(undefined, 'bold');\n      doc.text(vendor.displayName || '', 20, yPos);\n      yPos += 5;\n\n      doc.setFontSize(9);\n      doc.setFont(undefined, 'normal');\n      if (vendor.companyName) {\n        doc.text(vendor.companyName, 20, yPos);\n        yPos += 5;\n      }\n\n      // Address details\n      if (vendor.billingAddress?.street1) {\n        doc.text(vendor.billingAddress.street1, 20, yPos);\n        yPos += 5;\n      }\n      if (vendor.billingAddress?.street2) {\n        doc.text(vendor.billingAddress.street2, 20, yPos);\n        yPos += 5;\n      }\n      if (vendor.billingAddress?.city) {\n        doc.text(vendor.billingAddress.city, 20, yPos);\n        yPos += 5;\n      }\n      if (vendor.pan) {\n        doc.text(`PAN ${vendor.pan}`, 20, yPos);\n        yPos += 5;\n      }\n      yPos += 5;\n\n      // Account Summary Section\n      doc.setFontSize(11);\n      doc.setFont(undefined, 'bold');\n      doc.text('Account Summary', 20, yPos);\n      yPos += 8;\n\n      // Summary Table\n      doc.setFontSize(9);\n      doc.setFont(undefined, 'normal');\n\n      const summaryRows = [\n        ['Opening Balance', formatCurrency(vendor.openingBalance || 0)],\n        ['Billed Amount', formatCurrency(0)],\n        ['Amount Paid', formatCurrency(0)],\n        ['Balance Due', formatCurrency(vendor.payables || 0)]\n      ];\n\n      const leftCol = 30;\n      const rightCol = pageWidth - 30;\n\n      summaryRows.forEach(([label, value]) => {\n        doc.text(label || '', leftCol, yPos);\n        doc.text(value || '', rightCol, yPos, { align: 'right' });\n        yPos += 6;\n      });\n\n      yPos += 8;\n\n      // Transactions Table Header\n      doc.setFont(undefined, 'bold');\n      doc.setFontSize(9);\n      doc.text('Date', 20, yPos);\n      doc.text('Transactions', 40, yPos);\n      doc.text('Details', 80, yPos);\n      doc.text('Amount', 120, yPos, { align: 'right' });\n      doc.text('Payments', 150, yPos, { align: 'right' });\n      doc.text('Balance', pageWidth - 20, yPos, { align: 'right' });\n      yPos += 5;\n\n      // Draw line under header\n      doc.setDrawColor(200);\n      doc.line(20, yPos - 1, pageWidth - 20, yPos - 1);\n      yPos += 3;\n\n      // Opening Balance Row\n      doc.setFont(undefined, 'normal');\n      doc.setFontSize(9);\n      doc.text('01/12/2025', 20, yPos);\n      doc.text('***Opening Balance***', 40, yPos);\n      doc.text(String((vendor.openingBalance || 0).toFixed(2)), 120, yPos, { align: 'right' });\n      doc.text(String((vendor.openingBalance || 0).toFixed(2)), pageWidth - 20, yPos, { align: 'right' });\n\n      doc.save(`vendor-statement-${vendor.displayName}.pdf`);\n      toast({ title: \"Statement downloaded as PDF\" });\n    } catch (error) {\n      console.error('PDF generation error:', error);\n      toast({ title: \"Failed to download PDF\", variant: \"destructive\" });\n    }\n  };\n\n  const handleDownloadWord = () => {\n    try {\n      const content = `\nVENDOR STATEMENT\n${vendor.displayName}\n\nDate Range: 01/12/2025 To 31/12/2025\n\nFrom: SkilltonIT\nTo: ${vendor.displayName}\n${vendor.companyName ? `Company: ${vendor.companyName}` : ''}\n\nACCOUNT SUMMARY\nOpening Balance: ${formatCurrency(vendor.openingBalance || 0)}\nBilled Amount: ${formatCurrency(0)}\nAmount Paid: ${formatCurrency(0)}\nBalance Due: ${formatCurrency(vendor.payables || 0)}\n\nGenerated on ${new Date().toLocaleDateString('en-IN')}`;\n\n      const blob = new Blob([content], { type: 'application/msword' });\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `vendor-statement-${vendor.displayName}.doc`;\n      link.click();\n      window.URL.revokeObjectURL(url);\n      toast({ title: \"Statement downloaded as Word document\" });\n    } catch (error) {\n      toast({ title: \"Failed to download Word document\", variant: \"destructive\" });\n    }\n  };\n\n  const handleSendEmail = async () => {\n    try {\n      const response = await fetch(`/api/vendors/${vendor.id}/mails`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          to: emailTo,\n          subject: `Vendor Statement - ${vendor.displayName}`,\n          description: `Please find attached the vendor statement for ${vendor.displayName} from 01/12/2025 to 31/12/2025.`\n        })\n      });\n      if (response.ok) {\n        toast({ title: \"Statement sent via email\" });\n        setShowEmailDialog(false);\n        setEmailTo(vendor.email || \"\");\n        fetchVendorData();\n      } else {\n        toast({ title: \"Failed to send email\", variant: \"destructive\" });\n      }\n    } catch (error) {\n      toast({ title: \"Failed to send email\", variant: \"destructive\" });\n    }\n  };\n\n  const handleNewTransaction = (type: string) => {\n    const availableRoutes: Record<string, string> = {\n      bill: `/bills/new?vendorId=${vendor.id}`,\n      bills: `/bills/new?vendorId=${vendor.id}`,\n      expense: `/expenses?vendorId=${vendor.id}`,\n      expenses: `/expenses?vendorId=${vendor.id}`,\n      purchaseOrder: `/purchase-orders/new?vendorId=${vendor.id}`,\n      purchaseOrders: `/purchase-orders/new?vendorId=${vendor.id}`,\n      billPayment: `/payments-made/new?vendorId=${vendor.id}`,\n      billPayments: `/payments-made/new?vendorId=${vendor.id}`,\n      vendorCredit: `/vendor-credits/new?vendorId=${vendor.id}`,\n      vendorCredits: `/vendor-credits/new?vendorId=${vendor.id}`,\n    };\n    const unavailableTypes = [\"journal\", \"journals\"];\n\n    if (unavailableTypes.includes(type)) {\n      toast({\n        title: \"Feature coming soon\",\n        description: \"This feature is not yet available. Please check back later.\",\n      });\n      return;\n    }\n    setLocation(availableRoutes[type] || `/bills/new?vendorId=${vendor.id}`);\n  };\n\n  const transactionSections = [\n    { key: 'bills', label: 'Bills', columns: ['DATE', 'BILL#', 'ORDER ...', 'VENDOR', 'AMOUNT', 'BALANC...', 'STATUS'] },\n    { key: 'billPayments', label: 'Bill Payments', columns: ['DATE', 'PAYMEN...', 'REFERE...', 'PAYMEN...', 'AMOUN...', 'UNUSED...', 'STATUS'] },\n    { key: 'expenses', label: 'Expenses', columns: ['DATE', 'EXPE...', 'INVOI...', 'VEND...', 'PAID T...', 'CUST...', 'AMOU...', 'STATUS'] },\n    { key: 'purchaseOrders', label: 'Purchase Orders', columns: ['PURCHAS...', 'REFEREN...', 'DATE', 'DELIVERY D...', 'AMOUNT', 'STATUS'] },\n    { key: 'vendorCredits', label: 'Vendor Credits', columns: ['DATE', 'CREDIT NO...', 'ORDER NU...', 'BALANCE', 'AMOUNT', 'STATUS'] },\n    { key: 'journals', label: 'Journals', columns: ['DATE', 'JOURNAL NU...', 'REFERENCE NU...', 'DEBIT', 'CREDIT'] }\n  ];\n\n  return (\n    <div className=\"h-full flex flex-col bg-white dark:bg-slate-900 border-l border-slate-200 dark:border-slate-700\">\n      <div className=\"flex items-center justify-between px-6 py-4 border-b border-slate-200 dark:border-slate-700\">\n        <div className=\"flex items-center gap-3\">\n          <Button variant=\"ghost\" size=\"icon\" onClick={onClose} className=\"h-8 w-8\">\n            <ChevronDown className=\"h-4 w-4 rotate-90\" />\n          </Button>\n          <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white truncate\" data-testid=\"text-vendor-name\">{vendor.displayName}</h2>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button variant=\"outline\" size=\"sm\" onClick={onEdit} data-testid=\"button-edit-vendor\">\n            Edit\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n            <FileText className=\"h-4 w-4\" />\n          </Button>\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button className=\"bg-blue-600 hover:bg-blue-700 gap-1.5\" size=\"sm\" data-testid=\"button-new-transaction\">\n                New Transaction\n                <ChevronDown className=\"h-3 w-3\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\" className=\"w-56\">\n              <DropdownMenuLabel className=\"text-xs text-slate-500\">PURCHASES</DropdownMenuLabel>\n              <DropdownMenuItem onClick={() => handleNewTransaction(\"bill\")} data-testid=\"menu-item-bill\">\n                <Receipt className=\"mr-2 h-4 w-4\" /> Bill\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => handleNewTransaction(\"billPayment\")} data-testid=\"menu-item-bill-payment\">\n                <CreditCard className=\"mr-2 h-4 w-4\" /> Bill Payment\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => handleNewTransaction(\"purchaseOrder\")} data-testid=\"menu-item-purchase-order\">\n                <Package className=\"mr-2 h-4 w-4\" /> Purchase Order\n              </DropdownMenuItem>\n              <DropdownMenuSeparator />\n              <DropdownMenuItem onClick={() => handleNewTransaction(\"expense\")} data-testid=\"menu-item-expense\">\n                <Wallet className=\"mr-2 h-4 w-4\" /> Expense\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => handleNewTransaction(\"vendorCredit\")} data-testid=\"menu-item-vendor-credit\">\n                <CreditCard className=\"mr-2 h-4 w-4\" /> Vendor Credit\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => handleNewTransaction(\"journal\")} data-testid=\"menu-item-journal\">\n                <BookOpen className=\"mr-2 h-4 w-4\" /> Journal\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"outline\" size=\"sm\" className=\"gap-1.5\" data-testid=\"button-more-actions\">\n                More\n                <ChevronDown className=\"h-3 w-3\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\" className=\"w-48\">\n              <DropdownMenuItem onClick={onClone} data-testid=\"menu-item-clone\">\n                <Copy className=\"mr-2 h-4 w-4\" />\n                Clone Vendor\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={onToggleStatus} data-testid=\"menu-item-toggle-status\">\n                <Ban className=\"mr-2 h-4 w-4\" />\n                {vendor.status === 'active' ? 'Mark as Inactive' : 'Mark as Active'}\n              </DropdownMenuItem>\n              <DropdownMenuSeparator />\n              <DropdownMenuItem className=\"text-red-600\" onClick={onDelete} data-testid=\"menu-item-delete\">\n                <Trash2 className=\"mr-2 h-4 w-4\" />\n                Delete\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={onClose} data-testid=\"button-close-panel\">\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"flex-1 flex flex-col overflow-hidden\">\n        <div className=\"flex items-center px-6 border-b border-slate-200 dark:border-slate-700\">\n          <TabsList className=\"h-auto p-0 bg-transparent\">\n            <TabsTrigger\n              value=\"overview\"\n              className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n              data-testid=\"tab-overview\"\n            >\n              Overview\n            </TabsTrigger>\n            <TabsTrigger\n              value=\"comments\"\n              className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n              data-testid=\"tab-comments\"\n            >\n              Comments\n            </TabsTrigger>\n            <TabsTrigger\n              value=\"transactions\"\n              className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n              data-testid=\"tab-transactions\"\n            >\n              Transactions\n            </TabsTrigger>\n            <TabsTrigger\n              value=\"mails\"\n              className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n              data-testid=\"tab-mails\"\n            >\n              Mails\n            </TabsTrigger>\n            <TabsTrigger\n              value=\"statement\"\n              className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n              data-testid=\"tab-statement\"\n            >\n              Statement\n            </TabsTrigger>\n          </TabsList>\n        </div>\n\n        <TabsContent value=\"overview\" className=\"flex-1 overflow-auto mt-0\">\n          <div className=\"flex h-full\">\n            <div className=\"w-72 border-r border-slate-200 dark:border-slate-700 p-6 overflow-auto\">\n              <div className=\"space-y-6\">\n                <div>\n                  <h3 className=\"text-lg font-semibold text-slate-900 dark:text-white\">{vendor.displayName}</h3>\n                  {vendor.companyName && (\n                    <p className=\"text-sm text-slate-500 mt-1\">{vendor.companyName}</p>\n                  )}\n                  <div className=\"flex items-center gap-2 mt-3\">\n                    <div className=\"h-10 w-10 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center\">\n                      <User className=\"h-5 w-5 text-slate-500\" />\n                    </div>\n                    <div>\n                      <p className=\"text-sm font-medium\">{vendor.firstName} {vendor.lastName}</p>\n                      {vendor.email && <p className=\"text-xs text-blue-600\">{vendor.email}</p>}\n                    </div>\n                  </div>\n                  <button className=\"text-sm text-blue-600 mt-2\">Invite to Portal</button>\n                </div>\n\n                <Collapsible defaultOpen>\n                  <CollapsibleTrigger className=\"flex items-center justify-between w-full text-sm font-medium text-slate-500\">\n                    ADDRESS\n                    <ChevronDown className=\"h-4 w-4\" />\n                  </CollapsibleTrigger>\n                  <CollapsibleContent className=\"mt-3 space-y-4\">\n                    <div>\n                      <div className=\"flex items-center justify-between\">\n                        <p className=\"text-sm text-slate-500\">Billing Address</p>\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\">\n                          <Pencil className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                      <div className=\"text-sm mt-1\">\n                        {formatAddress(vendor.billingAddress).map((line, i) => (\n                          <p key={i}>{line}</p>\n                        ))}\n                      </div>\n                    </div>\n                    <div>\n                      <div className=\"flex items-center justify-between\">\n                        <p className=\"text-sm text-slate-500\">Shipping Address</p>\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\">\n                          <Pencil className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                      <div className=\"text-sm mt-1\">\n                        {formatAddress(vendor.shippingAddress).map((line, i) => (\n                          <p key={i}>{line}</p>\n                        ))}\n                      </div>\n                    </div>\n                    <button className=\"text-sm text-blue-600\">Add additional address</button>\n                  </CollapsibleContent>\n                </Collapsible>\n\n                <Collapsible defaultOpen>\n                  <CollapsibleTrigger className=\"flex items-center justify-between w-full text-sm font-medium text-slate-500\">\n                    OTHER DETAILS\n                    <ChevronDown className=\"h-4 w-4\" />\n                  </CollapsibleTrigger>\n                  <CollapsibleContent className=\"mt-3 space-y-3 text-sm\">\n                    <div>\n                      <p className=\"text-slate-500\">Vendor Type</p>\n                      <p className=\"font-medium\">Business</p>\n                    </div>\n                    <div>\n                      <p className=\"text-slate-500\">Default Currency</p>\n                      <p className=\"font-medium\">{vendor.currency || 'INR'}</p>\n                    </div>\n                    {vendor.gstTreatment && (\n                      <div>\n                        <p className=\"text-slate-500\">GST Treatment</p>\n                        <p className=\"font-medium\">{vendor.gstTreatment}</p>\n                      </div>\n                    )}\n                    {vendor.pan && (\n                      <div>\n                        <p className=\"text-slate-500\">PAN</p>\n                        <p className=\"font-medium\">{vendor.pan}</p>\n                      </div>\n                    )}\n                    {vendor.sourceOfSupply && (\n                      <div>\n                        <p className=\"text-slate-500\">Source of Supply</p>\n                        <p className=\"font-medium\">{vendor.sourceOfSupply}</p>\n                      </div>\n                    )}\n                    <div>\n                      <p className=\"text-slate-500\">Payment Terms</p>\n                      <p className=\"font-medium\">{vendor.paymentTerms || 'Due on Receipt'}</p>\n                    </div>\n                    {vendor.tds && (\n                      <div>\n                        <p className=\"text-slate-500\">TDS</p>\n                        <p className=\"font-medium\">{vendor.tds}</p>\n                      </div>\n                    )}\n                  </CollapsibleContent>\n                </Collapsible>\n              </div>\n            </div>\n\n            <div className=\"flex-1 p-6 overflow-auto\">\n              <div className=\"max-w-2xl\">\n                <div className=\"mb-6\">\n                  <p className=\"text-sm text-slate-500\">Payment due period</p>\n                  <p className=\"text-sm font-medium\">{vendor.paymentTerms || 'Due on Receipt'}</p>\n                </div>\n\n                <div className=\"mb-6\">\n                  <h4 className=\"text-lg font-semibold mb-4\">Payables</h4>\n                  <table className=\"w-full text-sm\">\n                    <thead>\n                      <tr className=\"text-left text-slate-500 border-b\">\n                        <th className=\"py-2\">CURRENCY</th>\n                        <th className=\"py-2 text-right\">OUTSTANDING PAYABLES</th>\n                        <th className=\"py-2 text-right\">UNUSED CREDITS</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      <tr>\n                        <td className=\"py-2\">INR- Indian Rupee</td>\n                        <td className=\"py-2 text-right\">{formatCurrency(vendor.payables || 0)}</td>\n                        <td className=\"py-2 text-right\">{formatCurrency(vendor.unusedCredits || 0)}</td>\n                      </tr>\n                    </tbody>\n                  </table>\n                  <button className=\"text-sm text-blue-600 mt-2\">Enter Opening Balance</button>\n                </div>\n\n                <div className=\"mb-6\">\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <h4 className=\"text-lg font-semibold\">Expenses</h4>\n                    <div className=\"flex items-center gap-2\">\n                      <Select defaultValue=\"last-6-months\">\n                        <SelectTrigger className=\"w-36 h-8 text-sm\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"last-6-months\">Last 6 Months</SelectItem>\n                          <SelectItem value=\"last-12-months\">Last 12 Months</SelectItem>\n                          <SelectItem value=\"this-year\">This Year</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <Select defaultValue=\"accrual\">\n                        <SelectTrigger className=\"w-28 h-8 text-sm\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"accrual\">Accrual</SelectItem>\n                          <SelectItem value=\"cash\">Cash</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n                  <p className=\"text-xs text-slate-500 mb-4\">This chart is displayed in the organization's base currency.</p>\n                  <div className=\"h-32 bg-slate-50 dark:bg-slate-800 rounded-lg flex items-end justify-around px-4 pb-2\">\n                    {['Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov'].map((month, i) => (\n                      <div key={month} className=\"flex flex-col items-center\">\n                        <div className=\"w-8 bg-orange-200 dark:bg-orange-800 rounded-t\" style={{ height: `${20 + i * 8}px` }}></div>\n                        <span className=\"text-xs text-slate-500 mt-1\">{month}</span>\n                      </div>\n                    ))}\n                  </div>\n                  <p className=\"text-sm mt-4\">Total Expenses ( Last 6 Months ) - {formatCurrency(0)}</p>\n                </div>\n\n                <div>\n                  <h4 className=\"text-lg font-semibold mb-4\">Activity Timeline</h4>\n                  <div className=\"space-y-4\">\n                    {activities.length === 0 ? (\n                      <div className=\"text-center py-8 text-slate-500\">\n                        <Clock className=\"h-8 w-8 mx-auto mb-2 text-slate-300\" />\n                        <p className=\"text-sm\">No activities yet</p>\n                      </div>\n                    ) : (\n                      activities.map((activity) => {\n                        const { date, time } = formatDateTime(activity.date);\n                        return (\n                          <div key={activity.id} className=\"flex gap-4\">\n                            <div className=\"text-right text-xs text-slate-500 w-24 flex-shrink-0\">\n                              <p>{date}</p>\n                              <p>{time}</p>\n                            </div>\n                            <div className=\"relative\">\n                              <div className=\"absolute top-0 bottom-0 left-1/2 -translate-x-1/2 w-0.5 bg-blue-200\"></div>\n                              <div className=\"relative z-10 h-4 w-4 bg-white border-2 border-blue-500 rounded\"></div>\n                            </div>\n                            <div className=\"flex-1 bg-slate-50 dark:bg-slate-800 rounded-lg p-3\">\n                              <h5 className=\"font-medium text-sm\">{activity.title}</h5>\n                              <p className=\"text-sm text-slate-600 dark:text-slate-400 mt-1\">{activity.description}</p>\n                              <p className=\"text-xs text-slate-500 mt-2\">\n                                by <span className=\"text-blue-600\">{activity.user}</span>\n                                <button className=\"text-blue-600 ml-2\">- View Details</button>\n                              </p>\n                            </div>\n                          </div>\n                        );\n                      })\n                    )}\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"comments\" className=\"flex-1 overflow-auto p-6 mt-0\">\n          <div className=\"max-w-2xl\">\n            <div className=\"border border-slate-200 dark:border-slate-700 rounded-lg mb-6\">\n              <div className=\"flex items-center gap-2 p-2 border-b border-slate-200 dark:border-slate-700\">\n                <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" data-testid=\"button-bold\">\n                  <Bold className=\"h-4 w-4\" />\n                </Button>\n                <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" data-testid=\"button-italic\">\n                  <Italic className=\"h-4 w-4\" />\n                </Button>\n                <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" data-testid=\"button-underline\">\n                  <Underline className=\"h-4 w-4\" />\n                </Button>\n              </div>\n              <Textarea\n                placeholder=\"Add a comment...\"\n                value={newComment}\n                onChange={(e) => setNewComment(e.target.value)}\n                className=\"border-0 focus-visible:ring-0 min-h-24 resize-none\"\n                data-testid=\"input-comment\"\n              />\n              <div className=\"p-2 border-t border-slate-200 dark:border-slate-700\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={handleAddComment}\n                  disabled={!newComment.trim()}\n                  data-testid=\"button-add-comment\"\n                >\n                  Add Comment\n                </Button>\n              </div>\n            </div>\n\n            <h4 className=\"text-sm font-medium text-slate-500 mb-4\">ALL COMMENTS</h4>\n            {comments.length === 0 ? (\n              <p className=\"text-center text-slate-500 py-8\">No comments yet.</p>\n            ) : (\n              <div className=\"space-y-4\">\n                {comments.map((comment) => (\n                  <div key={comment.id} className=\"border border-slate-200 dark:border-slate-700 rounded-lg p-4\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <span className=\"font-medium text-sm\">{comment.author}</span>\n                      <span className=\"text-xs text-slate-500\">{formatDate(comment.createdAt)}</span>\n                    </div>\n                    <p className=\"text-sm\">{comment.text}</p>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"transactions\" className=\"flex-1 overflow-auto mt-0\">\n          <div className=\"p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"outline\" size=\"sm\" className=\"gap-1.5\" data-testid=\"button-goto-transactions\">\n                    Go to transactions\n                    <ChevronDown className=\"h-3 w-3\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"start\" className=\"w-48\">\n                  <DropdownMenuItem>Bills</DropdownMenuItem>\n                  <DropdownMenuItem>Bill Payments</DropdownMenuItem>\n                  <DropdownMenuItem>Expenses</DropdownMenuItem>\n                  <DropdownMenuItem>Purchase Orders</DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            </div>\n\n            <div className=\"space-y-4\">\n              {transactionSections.map((section) => (\n                <Collapsible\n                  key={section.key}\n                  open={expandedSections[section.key]}\n                  onOpenChange={() => toggleSection(section.key)}\n                >\n                  <div className=\"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden\">\n                    <CollapsibleTrigger className=\"flex items-center justify-between w-full p-4 hover:bg-slate-50 dark:hover:bg-slate-800\">\n                      <div className=\"flex items-center gap-2\">\n                        {expandedSections[section.key] ? (\n                          <ChevronDown className=\"h-4 w-4\" />\n                        ) : (\n                          <ChevronRight className=\"h-4 w-4\" />\n                        )}\n                        <span className=\"font-medium\">{section.label}</span>\n                      </div>\n                      <div className=\"flex items-center gap-4\">\n                        <div className=\"flex items-center gap-2 text-sm text-slate-500\">\n                          <Filter className=\"h-4 w-4\" />\n                          Status: All\n                          <ChevronDown className=\"h-3 w-3\" />\n                        </div>\n                        <Button\n                          size=\"sm\"\n                          variant=\"ghost\"\n                          className=\"text-blue-600 gap-1\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            handleNewTransaction(section.key === 'bills' ? 'bill' : section.key);\n                          }}\n                          data-testid={`button-new-${section.key}`}\n                        >\n                          <Plus className=\"h-3 w-3\" />\n                          New\n                        </Button>\n                      </div>\n                    </CollapsibleTrigger>\n                    <CollapsibleContent>\n                      <div className=\"border-t border-slate-200 dark:border-slate-700\">\n                        <table className=\"w-full text-sm\">\n                          <thead className=\"bg-slate-50 dark:bg-slate-800\">\n                            <tr>\n                              {section.columns.map((col, i) => (\n                                <th key={i} className=\"px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase\">\n                                  {col}\n                                </th>\n                              ))}\n                            </tr>\n                          </thead>\n                          <tbody>\n                            {(transactions[section.key] || []).length === 0 ? (\n                              <tr>\n                                <td colSpan={section.columns.length} className=\"px-4 py-8 text-center text-slate-500\">\n                                  No {section.label.toLowerCase()} found. <button className=\"text-blue-600\" onClick={() => handleNewTransaction(section.key === 'bills' ? 'bill' : section.key)}>Add New</button>\n                                </td>\n                              </tr>\n                            ) : (\n                              (transactions[section.key] || []).map((tx) => (\n                                <tr key={tx.id} className=\"border-t border-slate-100 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800\">\n                                  <td className=\"px-4 py-3\">{formatDate(tx.date)}</td>\n                                  <td className=\"px-4 py-3 text-blue-600\">{tx.number}</td>\n                                  <td className=\"px-4 py-3\">{tx.orderNumber || '-'}</td>\n                                  <td className=\"px-4 py-3\">{tx.vendor || '-'}</td>\n                                  <td className=\"px-4 py-3\">{formatCurrency(tx.amount)}</td>\n                                  <td className=\"px-4 py-3\">{formatCurrency(tx.balance)}</td>\n                                  <td className=\"px-4 py-3\">\n                                    <Badge variant=\"outline\" className={tx.status === 'Paid' ? 'text-green-600' : tx.status === 'Draft' ? 'text-slate-500' : 'text-blue-600'}>\n                                      {tx.status}\n                                    </Badge>\n                                  </td>\n                                </tr>\n                              ))\n                            )}\n                          </tbody>\n                        </table>\n                      </div>\n                    </CollapsibleContent>\n                  </div>\n                </Collapsible>\n              ))}\n            </div>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"mails\" className=\"flex-1 overflow-auto p-6 mt-0\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <h4 className=\"text-lg font-medium\">System Mails</h4>\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"outline\" size=\"sm\" className=\"gap-1.5\" data-testid=\"button-link-email\">\n                  <Link2 className=\"h-4 w-4\" />\n                  Link Email account\n                  <ChevronDown className=\"h-3 w-3\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <DropdownMenuItem>Gmail</DropdownMenuItem>\n                <DropdownMenuItem>Outlook</DropdownMenuItem>\n                <DropdownMenuItem>Other</DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n\n          {mails.length === 0 ? (\n            <div className=\"text-center py-12 text-slate-500\">\n              <Mail className=\"h-12 w-12 mx-auto mb-4 text-slate-300\" />\n              <p className=\"text-lg font-medium mb-1\">No emails yet</p>\n              <p className=\"text-sm\">System emails sent to this vendor will appear here</p>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {mails.map((mail) => {\n                const { date, time } = formatDateTime(mail.sentAt);\n                return (\n                  <div key={mail.id} className=\"flex items-start gap-4 p-4 border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800\">\n                    <div className=\"h-10 w-10 rounded-full bg-red-100 flex items-center justify-center flex-shrink-0\">\n                      <span className=\"text-red-600 font-medium\">R</span>\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"text-sm\">To <span className=\"text-blue-600\">{mail.to}</span></p>\n                      <p className=\"font-medium text-sm mt-1\">{mail.subject}</p>\n                      <p className=\"text-sm text-slate-500 truncate\">{mail.description}</p>\n                    </div>\n                    <div className=\"text-right text-xs text-slate-500 flex-shrink-0\">\n                      <p>{date}</p>\n                      <p>{time}</p>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"statement\" className=\"flex-1 overflow-auto mt-0\">\n          <div className=\"p-6\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <div className=\"flex items-center gap-4\">\n                <Select value={statementPeriod} onValueChange={setStatementPeriod}>\n                  <SelectTrigger className=\"w-40 h-9\" data-testid=\"select-period\">\n                    <Calendar className=\"h-4 w-4 mr-2\" />\n                    <SelectValue placeholder=\"This Month\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"this-month\">This Month</SelectItem>\n                    <SelectItem value=\"last-month\">Last Month</SelectItem>\n                    <SelectItem value=\"this-quarter\">This Quarter</SelectItem>\n                    <SelectItem value=\"this-year\">This Year</SelectItem>\n                    <SelectItem value=\"custom\">Custom</SelectItem>\n                  </SelectContent>\n                </Select>\n                <Select value={statementFilter} onValueChange={setStatementFilter}>\n                  <SelectTrigger className=\"w-32 h-9\" data-testid=\"select-filter\">\n                    <SelectValue placeholder=\"Filter By: All\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">Filter By: All</SelectItem>\n                    <SelectItem value=\"outstanding\">Outstanding</SelectItem>\n                    <SelectItem value=\"paid\">Paid</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  variant=\"outline\"\n                  size=\"icon\"\n                  className=\"h-9 w-9\"\n                  onClick={handlePrint}\n                  data-testid=\"button-print\"\n                  title=\"Print Statement\"\n                >\n                  <Printer className=\"h-4 w-4\" />\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  size=\"icon\"\n                  className=\"h-9 w-9\"\n                  onClick={handleDownloadPDF}\n                  data-testid=\"button-download-pdf\"\n                  title=\"Download as PDF\"\n                >\n                  <Download className=\"h-4 w-4\" />\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  size=\"icon\"\n                  className=\"h-9 w-9\"\n                  onClick={handleDownloadWord}\n                  data-testid=\"button-download-word\"\n                  title=\"Download as Word\"\n                >\n                  <FileText className=\"h-4 w-4\" />\n                </Button>\n                <Button\n                  className=\"bg-blue-600 hover:bg-blue-700 gap-1.5\"\n                  size=\"sm\"\n                  onClick={() => setShowEmailDialog(true)}\n                  data-testid=\"button-send-email\"\n                >\n                  <Send className=\"h-4 w-4\" />\n                  Send Email\n                </Button>\n              </div>\n            </div>\n\n            <div className=\"text-center mb-6\">\n              <h3 className=\"text-lg font-semibold\">Vendor Statement for {vendor.displayName}</h3>\n              <p className=\"text-sm text-slate-500\">From 01/12/2025 To 31/12/2025</p>\n            </div>\n\n            <div className=\"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg shadow-sm p-8 max-w-4xl mx-auto\">\n              <div className=\"flex justify-between mb-8\">\n                <div>\n                  <h4 className=\"text-xl font-bold text-blue-600\">SkilltonIT</h4>\n                </div>\n                <div className=\"text-right text-sm\">\n                  <p className=\"font-medium\">SkilltonIT</p>\n                  <p>Hinjewadi - Wakad road</p>\n                  <p>Hinjewadi</p>\n                  <p>Pune Maharashtra 411057</p>\n                  <p>India</p>\n                  <p>GSTIN 27AZCPA5145K1ZH</p>\n                  <p>Sales.SkilltonIT@skilltonit.com</p>\n                  <p>www.skilltonit.com</p>\n                </div>\n              </div>\n\n              <div className=\"flex mb-8\">\n                <div className=\"w-1/2\">\n                  <p className=\"text-sm text-slate-500 mb-1\">To</p>\n                  <p className=\"font-medium text-blue-600\">{vendor.displayName}</p>\n                  {vendor.companyName && <p className=\"text-sm\">{vendor.companyName}</p>}\n                  <div className=\"text-sm\">\n                    {formatAddress(vendor.billingAddress).map((line, i) => (\n                      <p key={i}>{line}</p>\n                    ))}\n                  </div>\n                  {vendor.pan && <p className=\"text-sm\">PAN {vendor.pan}</p>}\n                </div>\n                <div className=\"w-1/2 text-right\">\n                  <h4 className=\"text-xl font-bold mb-2\">Statement of Accounts</h4>\n                  <p className=\"text-sm text-blue-600\">01/12/2025 To 31/12/2025</p>\n                </div>\n              </div>\n\n              <div className=\"mb-8\">\n                <h5 className=\"text-center font-semibold mb-4\">Account Summary</h5>\n                <table className=\"w-full max-w-sm mx-auto text-sm\">\n                  <tbody>\n                    <tr>\n                      <td className=\"py-1\">Opening Balance</td>\n                      <td className=\"py-1 text-right\">{formatCurrency(vendor.openingBalance || 0)}</td>\n                    </tr>\n                    <tr>\n                      <td className=\"py-1\">Billed Amount</td>\n                      <td className=\"py-1 text-right\">{formatCurrency(0)}</td>\n                    </tr>\n                    <tr>\n                      <td className=\"py-1\">Amount Paid</td>\n                      <td className=\"py-1 text-right text-green-600\">{formatCurrency(0)}</td>\n                    </tr>\n                    <tr className=\"border-t font-medium\">\n                      <td className=\"py-2\">Balance Due</td>\n                      <td className=\"py-2 text-right\">{formatCurrency(vendor.payables || 0)}</td>\n                    </tr>\n                  </tbody>\n                </table>\n              </div>\n\n              <table className=\"w-full text-sm\">\n                <thead>\n                  <tr className=\"border-b\">\n                    <th className=\"py-2 text-left\">Date</th>\n                    <th className=\"py-2 text-left\">Transactions</th>\n                    <th className=\"py-2 text-left\">Details</th>\n                    <th className=\"py-2 text-right\">Amount</th>\n                    <th className=\"py-2 text-right\">Payments</th>\n                    <th className=\"py-2 text-right\">Balance</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr>\n                    <td className=\"py-2\">01/12/2025</td>\n                    <td className=\"py-2\">***Opening Balance***</td>\n                    <td className=\"py-2\"></td>\n                    <td className=\"py-2 text-right\">{(vendor.openingBalance || 0).toFixed(2)}</td>\n                    <td className=\"py-2 text-right\"></td>\n                    <td className=\"py-2 text-right\">{(vendor.openingBalance || 0).toFixed(2)}</td>\n                  </tr>\n                </tbody>\n                <tfoot>\n                  <tr className=\"border-t font-medium\">\n                    <td colSpan={5} className=\"py-2 text-right\">Balance Due</td>\n                    <td className=\"py-2 text-right\">{formatCurrency(vendor.payables || 0)}</td>\n                  </tr>\n                </tfoot>\n              </table>\n            </div>\n          </div>\n        </TabsContent>\n      </Tabs>\n\n      <Dialog open={showEmailDialog} onOpenChange={setShowEmailDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Send Statement via Email</DialogTitle>\n            <DialogDescription>\n              Send the vendor statement to {vendor.displayName}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium text-slate-700\">Email Address</label>\n              <Input\n                type=\"email\"\n                value={emailTo}\n                onChange={(e) => setEmailTo(e.target.value)}\n                placeholder=\"Enter email address\"\n                data-testid=\"input-email\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowEmailDialog(false)}>\n              Cancel\n            </Button>\n            <Button\n              className=\"bg-blue-600 hover:bg-blue-700\"\n              onClick={handleSendEmail}\n              data-testid=\"button-send-email-confirm\"\n            >\n              Send\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\nexport default function VendorsPage() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [vendors, setVendors] = useState<Vendor[]>([]);\n  const [selectedVendors, setSelectedVendors] = useState<string[]>([]);\n  const [selectedVendor, setSelectedVendor] = useState<Vendor | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [vendorToDelete, setVendorToDelete] = useState<string | null>(null);\n  const [sortBy, setSortBy] = useState(\"name\");\n  const [showAttachmentsDialog, setShowAttachmentsDialog] = useState(false);\n  const [selectedVendorForAttachments, setSelectedVendorForAttachments] = useState<Vendor | null>(null);\n  const [newAttachments, setNewAttachments] = useState<File[]>([]);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    fetchVendors();\n  }, []);\n\n  const fetchVendors = async () => {\n    try {\n      const response = await fetch('/api/vendors');\n      if (response.ok) {\n        const data = await response.json();\n        setVendors(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch vendors:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchVendorDetail = async (id: string) => {\n    try {\n      const response = await fetch(`/api/vendors/${id}`);\n      if (response.ok) {\n        const data = await response.json();\n        setSelectedVendor(data.data);\n      }\n    } catch (error) {\n      console.error('Failed to fetch vendor detail:', error);\n    }\n  };\n\n  const handleVendorClick = (vendor: Vendor) => {\n    fetchVendorDetail(vendor.id);\n  };\n\n  const handleClosePanel = () => {\n    setSelectedVendor(null);\n  };\n\n  const handleEditVendor = () => {\n    if (selectedVendor) {\n      setLocation(`/vendors/${selectedVendor.id}/edit`);\n    }\n  };\n\n  const toggleSelectVendor = (id: string, e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (selectedVendors.includes(id)) {\n      setSelectedVendors(selectedVendors.filter(i => i !== id));\n    } else {\n      setSelectedVendors([...selectedVendors, id]);\n    }\n  };\n\n  const handleClone = async () => {\n    if (!selectedVendor) return;\n    try {\n      const response = await fetch(`/api/vendors/${selectedVendor.id}/clone`, { method: 'POST' });\n      if (response.ok) {\n        toast({ title: \"Vendor cloned successfully\" });\n        fetchVendors();\n        handleClosePanel();\n      }\n    } catch (error) {\n      toast({ title: \"Failed to clone vendor\", variant: \"destructive\" });\n    }\n  };\n\n  const handleToggleStatus = async () => {\n    if (!selectedVendor) return;\n    try {\n      const newStatus = selectedVendor.status === 'active' ? 'inactive' : 'active';\n      const response = await fetch(`/api/vendors/${selectedVendor.id}/status`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ status: newStatus })\n      });\n      if (response.ok) {\n        toast({ title: `Vendor marked as ${newStatus}` });\n        fetchVendors();\n        handleClosePanel();\n      }\n    } catch (error) {\n      toast({ title: \"Failed to update vendor status\", variant: \"destructive\" });\n    }\n  };\n\n  const handleDelete = (id: string) => {\n    setVendorToDelete(id);\n    setDeleteDialogOpen(true);\n  };\n\n  const confirmDelete = async () => {\n    if (!vendorToDelete) return;\n    try {\n      const response = await fetch(`/api/vendors/${vendorToDelete}`, { method: 'DELETE' });\n      if (response.ok) {\n        toast({ title: \"Vendor deleted successfully\" });\n        fetchVendors();\n        if (selectedVendor?.id === vendorToDelete) {\n          handleClosePanel();\n        }\n      }\n    } catch (error) {\n      toast({ title: \"Failed to delete vendor\", variant: \"destructive\" });\n    } finally {\n      setDeleteDialogOpen(false);\n      setVendorToDelete(null);\n    }\n  };\n\n  const handleAttachmentUpload = (e: React.ChangeEvent<HTMLInputElement>, vendorId: string) => {\n    const files = e.target.files;\n    if (files) {\n      const fileArray = Array.from(files);\n      const selectedAttachments = selectedVendorForAttachments?.attachments || [];\n      const totalFiles = selectedAttachments.length + newAttachments.length + fileArray.length;\n\n      if (totalFiles > 10) {\n        toast({ title: \"Maximum 10 files allowed\", variant: \"destructive\" });\n        return;\n      }\n\n      const validFiles = fileArray.filter(file => {\n        if (file.size > 10 * 1024 * 1024) {\n          toast({ title: `${file.name} exceeds 10MB limit`, variant: \"destructive\" });\n          return false;\n        }\n        return true;\n      });\n\n      setNewAttachments(prev => [...prev, ...validFiles]);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  const handleDeleteAttachment = async (vendorId: string, attachmentId: string) => {\n    try {\n      const response = await fetch(`/api/vendors/${vendorId}/attachments/${attachmentId}`, {\n        method: 'DELETE'\n      });\n      if (response.ok) {\n        toast({ title: \"Attachment deleted successfully\" });\n        fetchVendors();\n        if (selectedVendor?.id === vendorId) {\n          fetchVendorDetail(vendorId);\n        }\n      }\n    } catch (error) {\n      toast({ title: \"Failed to delete attachment\", variant: \"destructive\" });\n    }\n  };\n\n  const handleSaveAttachments = async (vendorId: string) => {\n    if (newAttachments.length === 0) return;\n\n    try {\n      const formData = new FormData();\n      newAttachments.forEach(file => {\n        formData.append('files', file);\n      });\n\n      const response = await fetch(`/api/vendors/${vendorId}/attachments`, {\n        method: 'POST',\n        body: formData\n      });\n\n      if (response.ok) {\n        toast({ title: \"Attachments saved successfully\" });\n        setNewAttachments([]);\n        setShowAttachmentsDialog(false);\n        setSelectedVendorForAttachments(null);\n        fetchVendors();\n        if (selectedVendor?.id === vendorId) {\n          fetchVendorDetail(vendorId);\n        }\n      }\n    } catch (error) {\n      toast({ title: \"Failed to save attachments\", variant: \"destructive\" });\n    }\n  };\n\n  const filteredVendors = vendors.filter(vendor =>\n    vendor.displayName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    vendor.companyName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    vendor.email?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const sortedVendors = [...filteredVendors].sort((a, b) => {\n    switch (sortBy) {\n      case 'name':\n        return (a.displayName || '').localeCompare(b.displayName || '');\n      case 'companyName':\n        return (a.companyName || '').localeCompare(b.companyName || '');\n      case 'payables':\n        return (b.payables || 0) - (a.payables || 0);\n      case 'unusedCredits':\n        return (b.unusedCredits || 0) - (a.unusedCredits || 0);\n      default:\n        return 0;\n    }\n  });\n\n  const { currentPage, totalPages, totalItems, itemsPerPage, paginatedItems, goToPage } = usePagination(sortedVendors, 10);\n\n  const formatCurrencyLocal = (amount: number) => {\n    return new Intl.NumberFormat('en-IN', {\n      style: 'currency',\n      currency: 'INR',\n      minimumFractionDigits: 2\n    }).format(amount);\n  };\n\n  return (\n    <div className=\"flex h-[calc(100vh-80px)] animate-in fade-in duration-300\">\n      <div className={`flex-1 flex flex-col overflow-hidden transition-all duration-300 ${selectedVendor ? 'w-80' : 'w-full'}`}>\n        <div className=\"flex items-center justify-between p-4\">\n          <div className=\"flex items-center gap-2\">\n            <h1 className=\"text-xl font-semibold text-slate-900 dark:text-white\">Active Vendors</h1>\n            <ChevronDown className=\"h-4 w-4 text-slate-500\" />\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              onClick={() => setLocation(\"/vendors/new\")}\n              className=\"bg-blue-600 hover:bg-blue-700 gap-1.5 h-9\"\n              data-testid=\"button-new-vendor\"\n            >\n              <Plus className=\"h-4 w-4\" />\n            </Button>\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"outline\" size=\"icon\" className=\"h-9 w-9\" data-testid=\"button-more-options\">\n                  <MoreHorizontal className=\"h-4 w-4\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\" className=\"w-48\">\n                <DropdownMenuLabel className=\"text-xs text-slate-500\">SORT BY</DropdownMenuLabel>\n                <DropdownMenuItem onClick={() => setSortBy('name')} className={sortBy === 'name' ? 'bg-blue-50' : ''}>\n                  <ArrowUpDown className=\"mr-2 h-4 w-4\" /> Name\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setSortBy('companyName')} className={sortBy === 'companyName' ? 'bg-blue-50' : ''}>\n                  <ArrowUpDown className=\"mr-2 h-4 w-4\" /> Company Name\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setSortBy('payables')} className={sortBy === 'payables' ? 'bg-blue-50' : ''}>\n                  <ArrowUpDown className=\"mr-2 h-4 w-4\" /> Payables (BCY)\n                </DropdownMenuItem>\n                <DropdownMenuSeparator />\n                <DropdownMenuItem>\n                  <Upload className=\"mr-2 h-4 w-4\" /> Import\n                </DropdownMenuItem>\n                <DropdownMenuItem>\n                  <Download className=\"mr-2 h-4 w-4\" /> Export\n                </DropdownMenuItem>\n                <DropdownMenuSeparator />\n                <DropdownMenuItem>\n                  <Settings className=\"mr-2 h-4 w-4\" /> Preferences\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={fetchVendors}>\n                  <RefreshCw className=\"mr-2 h-4 w-4\" /> Refresh List\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </div>\n\n        <div className=\"flex-1 overflow-auto\">\n          {loading ? (\n            <div className=\"p-8 text-center text-slate-500\">Loading vendors...</div>\n          ) : sortedVendors.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-16 text-center\">\n              <div className=\"h-16 w-16 rounded-full bg-slate-100 flex items-center justify-center mb-4\">\n                <Building2 className=\"h-8 w-8 text-slate-400\" />\n              </div>\n              <h3 className=\"text-lg font-semibold mb-2\">No vendors yet</h3>\n              <p className=\"text-slate-500 mb-4 max-w-sm\">\n                Add your first vendor to start tracking purchases and managing supplier relationships.\n              </p>\n              <Button\n                onClick={() => setLocation(\"/vendors/new\")}\n                className=\"bg-blue-600 hover:bg-blue-700\"\n                data-testid=\"button-add-first-vendor\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" /> Add Your First Vendor\n              </Button>\n            </div>\n          ) : (\n            <table className=\"w-full text-sm\">\n              <thead className=\"bg-slate-50 dark:bg-slate-800 sticky top-0 z-10\">\n                <tr className=\"border-b border-slate-200 dark:border-slate-700\">\n                  <th className=\"w-10 px-3 py-3 text-left\">\n                    <Checkbox\n                      checked={selectedVendors.length === sortedVendors.length && sortedVendors.length > 0}\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        if (selectedVendors.length === sortedVendors.length) {\n                          setSelectedVendors([]);\n                        } else {\n                          setSelectedVendors(sortedVendors.map(v => v.id));\n                        }\n                      }}\n                    />\n                  </th>\n                  <th className=\"px-3 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Name</th>\n                  <th className=\"px-3 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Company Name</th>\n                  <th className=\"px-3 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Email</th>\n                  <th className=\"px-3 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Work Phone</th>\n                  <th className=\"px-3 py-3 text-right text-xs font-semibold text-slate-500 uppercase tracking-wider\">Payables (BCY)</th>\n                  <th className=\"px-3 py-3 text-right text-xs font-semibold text-slate-500 uppercase tracking-wider\">Unused Credits (BCY)</th>\n                  <th className=\"w-10 px-3 py-3\"></th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-slate-100 dark:divide-slate-700\">\n                {paginatedItems.map((vendor) => (\n                  <tr\n                    key={vendor.id}\n                    className={`hover:bg-slate-50 dark:hover:bg-slate-800 cursor-pointer transition-colors ${selectedVendor?.id === vendor.id ? 'bg-blue-50 dark:bg-blue-900/20' : ''\n                      }`}\n                    onClick={() => handleVendorClick(vendor)}\n                    data-testid={`row-vendor-${vendor.id}`}\n                  >\n                    <td className=\"px-3 py-3\">\n                      <Checkbox\n                        checked={selectedVendors.includes(vendor.id)}\n                        onClick={(e) => toggleSelectVendor(vendor.id, e)}\n                      />\n                    </td>\n                    <td className=\"px-3 py-3\">\n                      <span className=\"font-medium text-blue-600 dark:text-blue-400\">{vendor.displayName}</span>\n                    </td>\n                    <td className=\"px-3 py-3 text-slate-600 dark:text-slate-400\">\n                      {vendor.companyName || '-'}\n                    </td>\n                    <td className=\"px-3 py-3 text-slate-600 dark:text-slate-400\">\n                      {vendor.email || '-'}\n                    </td>\n                    <td className=\"px-3 py-3 text-slate-600 dark:text-slate-400\">\n                      {vendor.workPhone || '-'}\n                    </td>\n                    <td className=\"px-3 py-3 text-right text-slate-600 dark:text-slate-400\">\n                      {formatCurrencyLocal(vendor.payables || 0)}\n                    </td>\n                    <td className=\"px-3 py-3 text-right text-slate-600 dark:text-slate-400\">\n                      {formatCurrencyLocal(vendor.unusedCredits || 0)}\n                    </td>\n                    <td className=\"px-3 py-3\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"h-8 w-8\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setSelectedVendorForAttachments(vendor);\n                          setShowAttachmentsDialog(true);\n                        }}\n                        data-testid={`button-attachments-${vendor.id}`}\n                      >\n                        <Paperclip className={`h-4 w-4 ${vendor.attachments && vendor.attachments.length > 0 ? 'text-blue-600' : 'text-slate-400'}`} />\n                      </Button>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          )}\n          {sortedVendors.length > 0 && (\n            <TablePagination\n              currentPage={currentPage}\n              totalPages={totalPages}\n              totalItems={totalItems}\n              itemsPerPage={itemsPerPage}\n              onPageChange={goToPage}\n            />\n          )}\n        </div>\n      </div>\n\n      {selectedVendor && (\n        <div className=\"flex-1 min-w-0\">\n          <VendorDetailPanel\n            vendor={selectedVendor}\n            onClose={handleClosePanel}\n            onEdit={handleEditVendor}\n            onClone={handleClone}\n            onToggleStatus={handleToggleStatus}\n            onDelete={() => handleDelete(selectedVendor.id)}\n          />\n        </div>\n      )}\n\n      {showAttachmentsDialog && selectedVendorForAttachments && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\n          <div className=\"bg-white dark:bg-slate-900 rounded-lg w-full max-w-md p-6 max-h-[80vh] overflow-y-auto\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-lg font-semibold\">Attachments - {selectedVendorForAttachments.displayName}</h3>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-6 w-6\"\n                onClick={() => {\n                  setShowAttachmentsDialog(false);\n                  setNewAttachments([]);\n                  setSelectedVendorForAttachments(null);\n                }}\n              >\n                <X className=\"h-4 w-4\" />\n              </Button>\n            </div>\n\n            <div className=\"space-y-4\">\n              {selectedVendorForAttachments.attachments && selectedVendorForAttachments.attachments.length > 0 && (\n                <div>\n                  <p className=\"text-sm font-medium text-slate-700 mb-2\">Uploaded Files ({selectedVendorForAttachments.attachments.length}/10)</p>\n                  <div className=\"space-y-2\">\n                    {selectedVendorForAttachments.attachments.map((attachment) => (\n                      <div key={attachment.id} className=\"flex items-center justify-between bg-slate-50 dark:bg-slate-800 p-3 rounded-md border border-slate-200 dark:border-slate-700\">\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"text-sm text-slate-900 dark:text-white truncate\">{attachment.name}</p>\n                          <p className=\"text-xs text-slate-500\">{(attachment.size / 1024).toFixed(2)} KB</p>\n                        </div>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"h-8 w-8 text-slate-400 hover:text-red-600 flex-shrink-0\"\n                          onClick={() => handleDeleteAttachment(selectedVendorForAttachments.id, attachment.id)}\n                          data-testid={`button-delete-attachment-${attachment.id}`}\n                          type=\"button\"\n                        >\n                          <X className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              <Button\n                variant=\"outline\"\n                className=\"gap-2 w-full\"\n                onClick={() => fileInputRef.current?.click()}\n                data-testid=\"button-upload-new-attachment\"\n                type=\"button\"\n              >\n                <Upload className=\"h-4 w-4\" />\n                Upload your Files\n              </Button>\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                multiple\n                hidden\n                onChange={(e) => handleAttachmentUpload(e, selectedVendorForAttachments.id)}\n                accept=\"*/*\"\n              />\n\n              {newAttachments.length > 0 && (\n                <div>\n                  <p className=\"text-sm font-medium text-slate-700 mb-2\">New Files to Upload</p>\n                  <div className=\"space-y-2\">\n                    {newAttachments.map((file, index) => (\n                      <div key={index} className=\"flex items-center justify-between bg-blue-50 dark:bg-blue-900/20 p-3 rounded-md border border-blue-200 dark:border-blue-700\">\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"text-sm text-slate-900 dark:text-white truncate\">{file.name}</p>\n                          <p className=\"text-xs text-slate-500\">{(file.size / 1024).toFixed(2)} KB</p>\n                        </div>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"h-8 w-8 text-slate-400 hover:text-red-600 flex-shrink-0\"\n                          onClick={() => setNewAttachments(prev => prev.filter((_, i) => i !== index))}\n                          type=\"button\"\n                        >\n                          <X className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              <p className=\"text-xs text-slate-500\">You can upload a maximum of 10 files, 10MB each</p>\n\n              <div className=\"flex gap-2 pt-4 border-t border-slate-200 dark:border-slate-700\">\n                <Button\n                  variant=\"outline\"\n                  className=\"flex-1\"\n                  onClick={() => {\n                    setShowAttachmentsDialog(false);\n                    setNewAttachments([]);\n                    setSelectedVendorForAttachments(null);\n                  }}\n                  type=\"button\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  className=\"flex-1 bg-blue-600 hover:bg-blue-700\"\n                  onClick={() => handleSaveAttachments(selectedVendorForAttachments.id)}\n                  data-testid=\"button-save-attachments\"\n                  type=\"button\"\n                  disabled={newAttachments.length === 0}\n                >\n                  Save\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Vendor</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete this vendor? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={confirmDelete} className=\"bg-red-600 hover:bg-red-700\">\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":75434,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/config/index.ts":{"content":"export const config = {\n  apiBaseUrl: import.meta.env.VITE_API_URL || '/api/v1',\n  appName: 'Billing Accounting',\n  version: '1.0.0',\n  defaultPageSize: 10,\n  maxPageSize: 100,\n  dateFormat: 'dd/MM/yyyy',\n  currency: {\n    code: 'INR',\n    symbol: '',\n    locale: 'en-IN',\n  },\n  fiscalYear: {\n    startMonth: 4,\n    endMonth: 3,\n  },\n} as const;\n\nexport const endpoints = {\n  auth: {\n    login: '/auth/login',\n    logout: '/auth/logout',\n    register: '/auth/register',\n    refresh: '/auth/refresh',\n    me: '/auth/me',\n  },\n  items: {\n    base: '/items',\n    byId: (id: string) => `/items/${id}`,\n  },\n  sales: {\n    invoices: '/sales/invoices',\n    estimates: '/sales/estimates',\n    payments: '/sales/payments',\n  },\n  purchases: {\n    orders: '/purchases/orders',\n    bills: '/purchases/bills',\n    vendorCredits: '/purchases/vendor-credits',\n  },\n  customers: {\n    base: '/customers',\n    byId: (id: string) => `/customers/${id}`,\n  },\n  vendors: {\n    base: '/vendors',\n    byId: (id: string) => `/vendors/${id}`,\n  },\n  expenses: {\n    base: '/expenses',\n    byId: (id: string) => `/expenses/${id}`,\n  },\n  banking: {\n    accounts: '/banking/accounts',\n    transactions: '/banking/transactions',\n  },\n  reports: {\n    base: '/reports',\n    profitLoss: '/reports/profit-loss',\n    balanceSheet: '/reports/balance-sheet',\n    cashFlow: '/reports/cash-flow',\n  },\n} as const;\n","path":null,"size_bytes":1385,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    port,\n    \"0.0.0.0\",\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2514,"size_tokens":null},"client/src/shared/hooks/index.ts":{"content":"export { useDebounce } from './useDebounce';\nexport { useLocalStorage } from './useLocalStorage';\n","path":null,"size_bytes":98,"size_tokens":null},"client/src/components/ui/sonner.tsx":{"content":"\"use client\"\n\nimport { useTheme } from \"next-themes\"\nimport { Toaster as Sonner } from \"sonner\"\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme()\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  )\n}\n\nexport { Toaster }\n","path":null,"size_bytes":894,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // @replit\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \",\n  {\n    variants: {\n      variant: {\n        default:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary:\n          // @replit no hover because we use hover-elevate\n          \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n          // @replit shadow-xs\" - use badge outline variable\n        outline: \"text-foreground border [border-color:var(--badge-outline)]\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1522,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-[100] max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border border-slate-200 bg-white p-1 text-popover-foreground shadow-lg\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7624,"size_tokens":null},"client/src/pages/vendor-credits.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Plus, Search, MoreHorizontal, Trash2, Edit, FileText, ChevronDown, X, Printer, Receipt, Copy, Ban, BookOpen, RotateCcw } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Separator } from \"@/components/ui/separator\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { usePagination } from \"@/hooks/use-pagination\";\nimport { TablePagination } from \"@/components/table-pagination\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface VendorCreditItem {\n  id: string;\n  itemId: string;\n  itemName: string;\n  description: string;\n  hsnSac?: string;\n  account: string;\n  quantity: number;\n  rate: string | number;\n  tax: string;\n  amount: number;\n}\n\ninterface VendorCredit {\n  id: string;\n  creditNumber: string;\n  vendorId: string;\n  vendorName: string;\n  referenceNumber?: string;\n  orderNumber?: string;\n  date: string;\n  subject?: string;\n  reverseCharge?: boolean;\n  taxType?: string;\n  tdsTcs?: string;\n  items: VendorCreditItem[];\n  subTotal: number;\n  discountType?: string;\n  discountValue?: string;\n  discountAmount?: number;\n  cgst?: number;\n  sgst?: number;\n  igst?: number;\n  tdsTcsAmount?: number;\n  adjustment?: number;\n  amount: number;\n  balance: number;\n  notes?: string;\n  status: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface Vendor {\n  id: string;\n  displayName: string;\n  companyName?: string;\n  billingAddress?: {\n    attention?: string;\n    street1?: string;\n    street2?: string;\n    city?: string;\n    state?: string;\n    pinCode?: string;\n    countryRegion?: string;\n  };\n  gstin?: string;\n  sourceOfSupply?: string;\n}\n\nexport default function VendorCredits() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedCredit, setSelectedCredit] = useState<VendorCredit | null>(null);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [creditToDelete, setCreditToDelete] = useState<string | null>(null);\n  const [refundDialogOpen, setRefundDialogOpen] = useState(false);\n  const [voidDialogOpen, setVoidDialogOpen] = useState(false);\n  const [refundAmount, setRefundAmount] = useState(\"\");\n  const [refundReason, setRefundReason] = useState(\"\");\n  const [activeTab, setActiveTab] = useState(\"document\");\n  const journalTabRef = useRef<HTMLButtonElement>(null);\n\n  const { data: vendorCreditsData, isLoading, refetch } = useQuery<{ success: boolean; data: VendorCredit[] }>({\n    queryKey: ['/api/vendor-credits'],\n  });\n\n  const { data: vendorsData } = useQuery<{ success: boolean; data: Vendor[] }>({\n    queryKey: ['/api/vendors'],\n  });\n\n  const vendors = vendorsData?.data || [];\n\n  const handleDelete = (id: string) => {\n    setCreditToDelete(id);\n    setDeleteDialogOpen(true);\n  };\n\n  const confirmDelete = async () => {\n    if (!creditToDelete) return;\n    try {\n      const response = await fetch(`/api/vendor-credits/${creditToDelete}`, { method: 'DELETE' });\n      if (response.ok) {\n        toast({ title: \"Vendor credit deleted successfully\" });\n        if (selectedCredit?.id === creditToDelete) {\n          setSelectedCredit(null);\n        }\n        refetch();\n      } else {\n        toast({ title: \"Failed to delete vendor credit\", variant: \"destructive\" });\n      }\n    } catch (error) {\n      toast({ title: \"Failed to delete vendor credit\", variant: \"destructive\" });\n    } finally {\n      setDeleteDialogOpen(false);\n      setCreditToDelete(null);\n    }\n  };\n\n  const handleRefund = () => {\n    if (selectedCredit) {\n      setRefundAmount(selectedCredit.balance.toString());\n      setRefundReason(\"\");\n      setRefundDialogOpen(true);\n    }\n  };\n\n  const confirmRefund = async () => {\n    if (!selectedCredit) return;\n    const amount = parseFloat(refundAmount);\n    if (isNaN(amount) || amount <= 0 || amount > selectedCredit.balance) {\n      toast({ title: \"Invalid refund amount\", variant: \"destructive\" });\n      return;\n    }\n    try {\n      const response = await fetch(`/api/vendor-credits/${selectedCredit.id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          balance: selectedCredit.balance - amount,\n          status: selectedCredit.balance - amount <= 0 ? 'REFUNDED' : selectedCredit.status,\n        }),\n      });\n      if (response.ok) {\n        toast({ title: \"Refund processed successfully\" });\n        refetch();\n        setRefundDialogOpen(false);\n        const updatedCredit = await response.json();\n        if (updatedCredit.data) {\n          setSelectedCredit(updatedCredit.data);\n        }\n      } else {\n        toast({ title: \"Failed to process refund\", variant: \"destructive\" });\n      }\n    } catch (error) {\n      toast({ title: \"Failed to process refund\", variant: \"destructive\" });\n    }\n  };\n\n  const handleVoid = () => {\n    if (selectedCredit) {\n      setVoidDialogOpen(true);\n    }\n  };\n\n  const confirmVoid = async () => {\n    if (!selectedCredit) return;\n    try {\n      const response = await fetch(`/api/vendor-credits/${selectedCredit.id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ status: 'VOID' }),\n      });\n      if (response.ok) {\n        toast({ title: \"Vendor credit voided successfully\" });\n        refetch();\n        setVoidDialogOpen(false);\n        const updatedCredit = await response.json();\n        if (updatedCredit.data) {\n          setSelectedCredit(updatedCredit.data);\n        }\n      } else {\n        toast({ title: \"Failed to void vendor credit\", variant: \"destructive\" });\n      }\n    } catch (error) {\n      toast({ title: \"Failed to void vendor credit\", variant: \"destructive\" });\n    }\n  };\n\n  const handleClone = async () => {\n    if (!selectedCredit) return;\n    try {\n      const clonedData = {\n        vendorId: selectedCredit.vendorId,\n        vendorName: selectedCredit.vendorName,\n        orderNumber: selectedCredit.orderNumber,\n        referenceNumber: selectedCredit.referenceNumber,\n        vendorCreditDate: new Date().toISOString().split('T')[0],\n        subject: selectedCredit.subject,\n        reverseCharge: selectedCredit.reverseCharge,\n        taxType: selectedCredit.taxType,\n        tdsTcs: selectedCredit.tdsTcs,\n        items: selectedCredit.items,\n        subTotal: selectedCredit.subTotal,\n        discountType: selectedCredit.discountType,\n        discountValue: selectedCredit.discountValue,\n        discountAmount: selectedCredit.discountAmount,\n        cgst: selectedCredit.cgst,\n        sgst: selectedCredit.sgst,\n        igst: selectedCredit.igst,\n        tdsTcsAmount: selectedCredit.tdsTcsAmount,\n        adjustment: selectedCredit.adjustment,\n        total: selectedCredit.amount,\n        notes: selectedCredit.notes,\n        status: 'DRAFT',\n      };\n      const response = await fetch('/api/vendor-credits', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(clonedData),\n      });\n      if (response.ok) {\n        const result = await response.json();\n        toast({ title: `Vendor credit cloned as ${result.data.creditNumber}` });\n        refetch();\n        setSelectedCredit(result.data);\n      } else {\n        toast({ title: \"Failed to clone vendor credit\", variant: \"destructive\" });\n      }\n    } catch (error) {\n      toast({ title: \"Failed to clone vendor credit\", variant: \"destructive\" });\n    }\n  };\n\n  const handleViewJournal = () => {\n    setActiveTab(\"journal\");\n  };\n\n  const vendorCredits = vendorCreditsData?.data || [];\n\n  const filteredVendorCredits = vendorCredits.filter(credit =>\n    credit.creditNumber?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    credit.vendorName?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    credit.referenceNumber?.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  const { currentPage, totalPages, totalItems, itemsPerPage, paginatedItems, goToPage } = usePagination(filteredVendorCredits, 10);\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('en-IN', {\n      style: 'currency',\n      currency: 'INR',\n      minimumFractionDigits: 2,\n    }).format(amount);\n  };\n\n  const formatDate = (dateString: string) => {\n    if (!dateString) return '';\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-IN', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric'\n    });\n  };\n\n  const getVendorDetails = (vendorId: string) => {\n    return vendors.find(v => v.id === vendorId);\n  };\n\n  const calculateTaxDetails = (credit: VendorCredit) => {\n    let cgst = 0;\n    let sgst = 0;\n    \n    credit.items.forEach(item => {\n      if (item.tax && item.tax.includes('gst')) {\n        const rate = parseFloat(item.rate.toString());\n        const quantity = item.quantity;\n        const baseAmount = rate * quantity;\n        \n        if (item.tax === 'gst_18') {\n          cgst += baseAmount * 0.09;\n          sgst += baseAmount * 0.09;\n        } else if (item.tax === 'gst_12') {\n          cgst += baseAmount * 0.06;\n          sgst += baseAmount * 0.06;\n        } else if (item.tax === 'gst_5') {\n          cgst += baseAmount * 0.025;\n          sgst += baseAmount * 0.025;\n        }\n      }\n    });\n    \n    return { cgst, sgst };\n  };\n\n  const getJournalEntries = (credit: VendorCredit) => {\n    const { cgst, sgst } = calculateTaxDetails(credit);\n    const costOfGoodsSold = credit.subTotal - (credit.discountAmount || 0);\n    \n    const entries = [\n      { account: \"Accounts Payable\", debit: credit.amount, credit: 0 },\n      { account: \"Input SGST\", debit: 0, credit: sgst },\n      { account: \"Input CGST\", debit: 0, credit: cgst },\n      { account: \"Cost of Goods Sold\", debit: 0, credit: costOfGoodsSold },\n    ];\n    \n    const totalDebit = entries.reduce((sum, e) => sum + e.debit, 0);\n    const totalCredit = entries.reduce((sum, e) => sum + e.credit, 0);\n    \n    return { entries, totalDebit, totalCredit };\n  };\n\n  return (\n    <div className=\"h-full flex animate-in fade-in duration-500\">\n      <div className={`${selectedCredit ? 'w-80' : 'w-full'} flex flex-col border-r bg-background transition-all duration-300`}>\n        <div className=\"flex items-center justify-between gap-2 p-4 border-b\">\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"ghost\" className=\"gap-1 text-lg font-semibold\" data-testid=\"dropdown-all-vendor-credits\">\n                All Vendor Credits\n                <ChevronDown className=\"h-4 w-4\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"start\">\n              <DropdownMenuItem>All Vendor Credits</DropdownMenuItem>\n              <DropdownMenuItem>Open</DropdownMenuItem>\n              <DropdownMenuItem>Closed</DropdownMenuItem>\n              <DropdownMenuItem>Draft</DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n          \n          <div className=\"flex items-center gap-2\">\n            <Button \n              size=\"sm\"\n              className=\"gap-1\" \n              onClick={() => setLocation('/vendor-credits/new')}\n              data-testid=\"button-add-vendor-credit\"\n            >\n              <Plus className=\"h-4 w-4\" /> New\n            </Button>\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"outline\" size=\"icon\" data-testid=\"button-more-options\">\n                  <MoreHorizontal className=\"h-4 w-4\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <DropdownMenuItem>Import Vendor Credits</DropdownMenuItem>\n                <DropdownMenuItem>Export Vendor Credits</DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </div>\n\n        {!selectedCredit && (\n          <div className=\"p-4 border-b\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search vendor credits...\"\n                className=\"pl-9\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                data-testid=\"input-search-vendor-credits\"\n              />\n            </div>\n          </div>\n        )}\n\n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-16\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n          </div>\n        ) : vendorCredits.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center py-16 text-center px-4\">\n            <div className=\"h-16 w-16 rounded-full bg-muted flex items-center justify-center mb-4\">\n              <Receipt className=\"h-8 w-8 text-muted-foreground\" />\n            </div>\n            <h3 className=\"text-lg font-semibold mb-2\" data-testid=\"text-vendor-credits-empty\">No vendor credits</h3>\n            <p className=\"text-muted-foreground mb-4 max-w-sm text-sm\">\n              Record credits from vendors for returns or adjustments to apply against future bills.\n            </p>\n            <Button \n              className=\"gap-2\" \n              onClick={() => setLocation('/vendor-credits/new')}\n              data-testid=\"button-add-first-vendor-credit\"\n            >\n              <Plus className=\"h-4 w-4\" /> Add Your First Vendor Credit\n            </Button>\n          </div>\n        ) : selectedCredit ? (\n          <div className=\"flex-1 overflow-auto\">\n            {paginatedItems.map((credit) => (\n              <div\n                key={credit.id}\n                className={`p-3 border-b cursor-pointer transition-colors ${\n                  selectedCredit?.id === credit.id ? 'bg-primary/5 border-l-2 border-l-primary' : 'hover:bg-muted/50'\n                }`}\n                onClick={() => setSelectedCredit(credit)}\n                data-testid={`row-vendor-credit-${credit.id}`}\n              >\n                <div className=\"flex items-start justify-between gap-2\">\n                  <div className=\"flex items-start gap-2\">\n                    <Checkbox \n                      onClick={(e) => e.stopPropagation()} \n                      data-testid={`checkbox-vendor-credit-${credit.id}`}\n                    />\n                    <div>\n                      <p className=\"font-medium text-sm\">{credit.vendorName}</p>\n                      <p className=\"text-primary text-xs\">{credit.creditNumber} | {formatDate(credit.date)}</p>\n                      <Badge \n                        variant=\"outline\" \n                        className={`mt-1 text-xs ${\n                          credit.status === 'OPEN' ? 'text-blue-600 border-blue-200' : \n                          credit.status === 'CLOSED' ? 'text-gray-600 border-gray-200' : \n                          'text-yellow-600 border-yellow-200'\n                        }`}\n                      >\n                        {credit.status}\n                      </Badge>\n                    </div>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"font-semibold text-sm\">{formatCurrency(credit.amount)}</p>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        ) : (\n          <div className=\"flex-1 overflow-auto\">\n            <table className=\"w-full\">\n              <thead className=\"bg-muted/50 sticky top-0\">\n                <tr>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase\">\n                    <Checkbox data-testid=\"checkbox-select-all\" />\n                  </th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase\">Date</th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase\">Credit Note#</th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase\">Reference Number</th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase\">Vendor Name</th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase\">Status</th>\n                  <th className=\"px-4 py-3 text-right text-xs font-medium text-muted-foreground uppercase\">Amount</th>\n                  <th className=\"px-4 py-3 text-right text-xs font-medium text-muted-foreground uppercase\">Balance</th>\n                  <th className=\"px-4 py-3 text-center text-xs font-medium text-muted-foreground uppercase\">\n                    <Search className=\"h-4 w-4 mx-auto\" />\n                  </th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y\">\n                {paginatedItems.map((credit) => (\n                  <tr\n                    key={credit.id}\n                    className=\"hover:bg-muted/30 cursor-pointer transition-colors\"\n                    onClick={() => setSelectedCredit(credit)}\n                    data-testid={`row-vendor-credit-${credit.id}`}\n                  >\n                    <td className=\"px-4 py-3\" onClick={(e) => e.stopPropagation()}>\n                      <Checkbox data-testid={`checkbox-vendor-credit-${credit.id}`} />\n                    </td>\n                    <td className=\"px-4 py-3 text-sm\">{formatDate(credit.date)}</td>\n                    <td className=\"px-4 py-3 text-sm font-medium text-primary\">{credit.creditNumber}</td>\n                    <td className=\"px-4 py-3 text-sm text-muted-foreground\">{credit.referenceNumber || credit.orderNumber || '-'}</td>\n                    <td className=\"px-4 py-3 text-sm uppercase\">{credit.vendorName}</td>\n                    <td className=\"px-4 py-3 text-sm\">\n                      <Badge \n                        variant=\"outline\"\n                        className={`${\n                          credit.status === 'OPEN' ? 'text-blue-600 border-blue-200 bg-blue-50' : \n                          credit.status === 'CLOSED' ? 'text-gray-600 border-gray-200 bg-gray-50' : \n                          'text-yellow-600 border-yellow-200 bg-yellow-50'\n                        }`}\n                      >\n                        {credit.status}\n                      </Badge>\n                    </td>\n                    <td className=\"px-4 py-3 text-sm text-right font-medium\">\n                      {formatCurrency(credit.amount)}\n                    </td>\n                    <td className=\"px-4 py-3 text-sm text-right\">\n                      {formatCurrency(credit.balance)}\n                    </td>\n                    <td className=\"px-4 py-3 text-center\" onClick={(e) => e.stopPropagation()}>\n                      <DropdownMenu>\n                        <DropdownMenuTrigger asChild>\n                          <Button variant=\"ghost\" size=\"icon\" data-testid={`button-vendor-credit-actions-${credit.id}`}>\n                            <MoreHorizontal className=\"h-4 w-4\" />\n                          </Button>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent align=\"end\">\n                          <DropdownMenuItem \n                            onClick={() => setLocation(`/vendor-credits/${credit.id}/edit`)}\n                            data-testid={`action-edit-${credit.id}`}\n                          >\n                            <Edit className=\"mr-2 h-4 w-4\" />\n                            Edit\n                          </DropdownMenuItem>\n                          <DropdownMenuItem data-testid={`action-clone-${credit.id}`}>\n                            <FileText className=\"mr-2 h-4 w-4\" />\n                            Clone\n                          </DropdownMenuItem>\n                          <DropdownMenuSeparator />\n                          <DropdownMenuItem\n                            className=\"text-destructive\"\n                            onClick={() => handleDelete(credit.id)}\n                            data-testid={`action-delete-${credit.id}`}\n                          >\n                            <Trash2 className=\"mr-2 h-4 w-4\" />\n                            Delete\n                          </DropdownMenuItem>\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n            <TablePagination\n              currentPage={currentPage}\n              totalPages={totalPages}\n              totalItems={totalItems}\n              itemsPerPage={itemsPerPage}\n              onPageChange={goToPage}\n            />\n          </div>\n        )}\n      </div>\n\n      {selectedCredit && (\n        <div className=\"flex-1 flex flex-col overflow-hidden bg-muted/20\">\n          <div className=\"flex items-center justify-between gap-2 p-3 border-b bg-background\">\n            <h2 className=\"font-semibold text-lg\">{selectedCredit.creditNumber}</h2>\n            <div className=\"flex items-center gap-2\">\n              <Button \n                variant=\"outline\" \n                size=\"sm\" \n                className=\"gap-1\"\n                onClick={() => setLocation(`/vendor-credits/${selectedCredit.id}/edit`)}\n                data-testid=\"button-edit-credit\"\n              >\n                <Edit className=\"h-4 w-4\" /> Edit\n              </Button>\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"outline\" size=\"sm\" className=\"gap-1\" data-testid=\"button-pdf-print\">\n                    <Printer className=\"h-4 w-4\" /> PDF/Print\n                    <ChevronDown className=\"h-3 w-3\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent>\n                  <DropdownMenuItem>Print</DropdownMenuItem>\n                  <DropdownMenuItem>Download PDF</DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n              <Button variant=\"outline\" size=\"sm\" data-testid=\"button-apply-to-bills\">\n                Apply to Bills\n              </Button>\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-more-actions\">\n                    <MoreHorizontal className=\"h-4 w-4\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"end\" className=\"w-40\">\n                  <DropdownMenuItem \n                    onClick={handleRefund}\n                    className=\"text-primary font-medium\"\n                    data-testid=\"menu-refund\"\n                  >\n                    Refund\n                  </DropdownMenuItem>\n                  <DropdownMenuItem \n                    onClick={handleVoid}\n                    data-testid=\"menu-void\"\n                  >\n                    Void\n                  </DropdownMenuItem>\n                  <DropdownMenuItem \n                    onClick={handleClone}\n                    data-testid=\"menu-clone\"\n                  >\n                    Clone\n                  </DropdownMenuItem>\n                  <DropdownMenuItem \n                    onClick={handleViewJournal}\n                    data-testid=\"menu-view-journal\"\n                  >\n                    View Journal\n                  </DropdownMenuItem>\n                  <DropdownMenuItem \n                    className=\"text-destructive\"\n                    onClick={() => handleDelete(selectedCredit.id)}\n                    data-testid=\"menu-delete\"\n                  >\n                    Delete\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n              <Button \n                variant=\"ghost\" \n                size=\"icon\"\n                onClick={() => setSelectedCredit(null)}\n                data-testid=\"button-close-detail\"\n              >\n                <X className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"flex-1 overflow-auto p-4\">\n            <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n              <TabsList className=\"mb-4\">\n                <TabsTrigger value=\"document\">Document</TabsTrigger>\n                <TabsTrigger value=\"journal\" ref={journalTabRef}>Journal</TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"document\">\n                <Card className=\"bg-white dark:bg-card\">\n                  <CardContent className=\"p-0\">\n                    <div className=\"relative\">\n                      <div className=\"absolute top-0 left-0 -rotate-45 origin-center transform -translate-x-6 translate-y-8\">\n                        <Badge className=\"bg-blue-500 text-white px-6 py-1 text-xs\">\n                          {selectedCredit.status}\n                        </Badge>\n                      </div>\n                      \n                      <div className=\"p-6 pt-12\">\n                        <div className=\"flex justify-between items-start mb-8\">\n                          <div>\n                            <h2 className=\"text-2xl font-bold text-primary mb-2\">SkilltonIT</h2>\n                            <p className=\"text-sm text-muted-foreground\">SkilltonIT</p>\n                            <p className=\"text-sm text-muted-foreground\">Hinjewadi - Wakad road</p>\n                            <p className=\"text-sm text-muted-foreground\">Hinjawadi</p>\n                            <p className=\"text-sm text-muted-foreground\">Pune Maharashtra 411057</p>\n                            <p className=\"text-sm text-muted-foreground\">India</p>\n                            <p className=\"text-sm text-muted-foreground\">GSTIN 27AATPM4585L1ZH</p>\n                            <p className=\"text-sm text-muted-foreground\">Sales.SkilltonIT@skilltonit.com</p>\n                            <p className=\"text-sm text-muted-foreground\">www.skilltonit.com</p>\n                          </div>\n                          <div className=\"text-right\">\n                            <h1 className=\"text-2xl font-bold text-muted-foreground mb-2\">VENDOR CREDITS</h1>\n                            <p className=\"text-sm text-muted-foreground\">CreditNote# {selectedCredit.creditNumber}</p>\n                            <div className=\"mt-4 bg-primary/10 px-4 py-3 rounded\">\n                              <p className=\"text-xs text-muted-foreground\">Credits Remaining</p>\n                              <p className=\"text-xl font-bold\">{formatCurrency(selectedCredit.balance)}</p>\n                            </div>\n                          </div>\n                        </div>\n\n                        <Separator className=\"my-6\" />\n\n                        <div className=\"grid grid-cols-2 gap-8 mb-8\">\n                          <div>\n                            <h3 className=\"text-sm font-medium text-muted-foreground mb-2\">Vendor Address</h3>\n                            <p className=\"text-sm font-semibold text-primary uppercase\">{selectedCredit.vendorName}</p>\n                            {(() => {\n                              const vendor = getVendorDetails(selectedCredit.vendorId);\n                              if (vendor?.billingAddress) {\n                                return (\n                                  <>\n                                    {vendor.billingAddress.attention && (\n                                      <p className=\"text-sm text-muted-foreground\">{vendor.billingAddress.attention}</p>\n                                    )}\n                                    {vendor.billingAddress.street1 && (\n                                      <p className=\"text-sm text-muted-foreground\">{vendor.billingAddress.street1}</p>\n                                    )}\n                                    {vendor.billingAddress.city && (\n                                      <p className=\"text-sm text-muted-foreground\">{vendor.billingAddress.city}</p>\n                                    )}\n                                    {vendor.billingAddress.state && (\n                                      <p className=\"text-sm text-muted-foreground\">{vendor.billingAddress.state}</p>\n                                    )}\n                                    {vendor.billingAddress.pinCode && (\n                                      <p className=\"text-sm text-muted-foreground\">{vendor.billingAddress.pinCode}</p>\n                                    )}\n                                    <p className=\"text-sm text-muted-foreground\">India</p>\n                                    {vendor.gstin && (\n                                      <p className=\"text-sm text-muted-foreground\">GSTIN {vendor.gstin}</p>\n                                    )}\n                                  </>\n                                );\n                              }\n                              return <p className=\"text-sm text-muted-foreground\">India</p>;\n                            })()}\n                          </div>\n                          <div className=\"text-right\">\n                            <div className=\"inline-block text-left\">\n                              <p className=\"text-sm\"><span className=\"text-muted-foreground\">Date:</span> {formatDate(selectedCredit.date)}</p>\n                            </div>\n                          </div>\n                        </div>\n\n                        <div className=\"border rounded-lg overflow-hidden mb-6\">\n                          <table className=\"w-full\">\n                            <thead className=\"bg-primary text-primary-foreground\">\n                              <tr>\n                                <th className=\"px-4 py-2 text-left text-xs font-medium\">#</th>\n                                <th className=\"px-4 py-2 text-left text-xs font-medium\">Item & Description</th>\n                                <th className=\"px-4 py-2 text-center text-xs font-medium\">HSN/SAC</th>\n                                <th className=\"px-4 py-2 text-center text-xs font-medium\">Qty</th>\n                                <th className=\"px-4 py-2 text-right text-xs font-medium\">Rate</th>\n                                <th className=\"px-4 py-2 text-right text-xs font-medium\">Amount</th>\n                              </tr>\n                            </thead>\n                            <tbody>\n                              {selectedCredit.items.map((item, index) => (\n                                <tr key={item.id} className=\"border-b\">\n                                  <td className=\"px-4 py-3 text-sm\">{index + 1}</td>\n                                  <td className=\"px-4 py-3 text-sm\">\n                                    <div>\n                                      <p className=\"font-medium\">{item.itemName}</p>\n                                      {item.description && (\n                                        <p className=\"text-xs text-muted-foreground\">{item.description}</p>\n                                      )}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-4 py-3 text-sm text-center\">{item.hsnSac || '-'}</td>\n                                  <td className=\"px-4 py-3 text-sm text-center\">{item.quantity}</td>\n                                  <td className=\"px-4 py-3 text-sm text-right\">{formatCurrency(parseFloat(item.rate.toString()))}</td>\n                                  <td className=\"px-4 py-3 text-sm text-right\">{formatCurrency(item.amount)}</td>\n                                </tr>\n                              ))}\n                            </tbody>\n                          </table>\n                        </div>\n\n                        <div className=\"flex justify-end mb-6\">\n                          <div className=\"w-72\">\n                            <div className=\"flex justify-between py-2 text-sm\">\n                              <span className=\"text-muted-foreground\">Sub Total</span>\n                              <span className=\"font-medium\">{formatCurrency(selectedCredit.subTotal)}</span>\n                            </div>\n                            {(() => {\n                              const { cgst, sgst } = calculateTaxDetails(selectedCredit);\n                              return (\n                                <>\n                                  {cgst > 0 && (\n                                    <div className=\"flex justify-between py-2 text-sm\">\n                                      <span className=\"text-muted-foreground\">CGST (9%)</span>\n                                      <span className=\"font-medium\">{formatCurrency(cgst)}</span>\n                                    </div>\n                                  )}\n                                  {sgst > 0 && (\n                                    <div className=\"flex justify-between py-2 text-sm\">\n                                      <span className=\"text-muted-foreground\">SGST (9%)</span>\n                                      <span className=\"font-medium\">{formatCurrency(sgst)}</span>\n                                    </div>\n                                  )}\n                                </>\n                              );\n                            })()}\n                            {(selectedCredit.discountAmount || 0) > 0 && (\n                              <div className=\"flex justify-between py-2 text-sm\">\n                                <span className=\"text-muted-foreground\">Discount</span>\n                                <span className=\"font-medium text-red-500\">-{formatCurrency(selectedCredit.discountAmount || 0)}</span>\n                              </div>\n                            )}\n                            <Separator className=\"my-2\" />\n                            <div className=\"flex justify-between py-2 text-sm font-semibold\">\n                              <span>Total</span>\n                              <span className=\"text-primary\">{formatCurrency(selectedCredit.amount)}</span>\n                            </div>\n                            <div className=\"flex justify-between py-2 bg-green-50 dark:bg-green-950 px-3 rounded text-sm\">\n                              <span className=\"font-medium\">Credits Remaining</span>\n                              <span className=\"font-bold text-green-600\">{formatCurrency(selectedCredit.balance)}</span>\n                            </div>\n                          </div>\n                        </div>\n\n                        <div className=\"mt-12 border-t pt-4\">\n                          <p className=\"text-sm text-muted-foreground\">Authorized Signature ____________________</p>\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </TabsContent>\n\n              <TabsContent value=\"journal\">\n                <Card>\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center gap-2 mb-4\">\n                      <Badge variant=\"outline\" className=\"bg-blue-50 text-blue-600 border-blue-200\">INR</Badge>\n                      <span className=\"text-sm text-muted-foreground\">Amount is displayed in your base currency</span>\n                    </div>\n                    \n                    <h3 className=\"font-semibold mb-4\">Vendor Credits</h3>\n                    \n                    <div className=\"border rounded-lg overflow-hidden\">\n                      <table className=\"w-full\">\n                        <thead className=\"bg-muted/50\">\n                          <tr>\n                            <th className=\"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase\">Account</th>\n                            <th className=\"px-4 py-3 text-right text-xs font-medium text-muted-foreground uppercase\">Debit</th>\n                            <th className=\"px-4 py-3 text-right text-xs font-medium text-muted-foreground uppercase\">Credit</th>\n                          </tr>\n                        </thead>\n                        <tbody>\n                          {(() => {\n                            const { entries, totalDebit, totalCredit } = getJournalEntries(selectedCredit);\n                            return (\n                              <>\n                                {entries.map((entry, index) => (\n                                  <tr key={index} className=\"border-b\">\n                                    <td className=\"px-4 py-3 text-sm\">{entry.account}</td>\n                                    <td className=\"px-4 py-3 text-sm text-right\">\n                                      {entry.debit > 0 ? formatCurrency(entry.debit) : '0.00'}\n                                    </td>\n                                    <td className=\"px-4 py-3 text-sm text-right\">\n                                      {entry.credit > 0 ? formatCurrency(entry.credit) : '0.00'}\n                                    </td>\n                                  </tr>\n                                ))}\n                                <tr className=\"bg-muted/30 font-semibold\">\n                                  <td className=\"px-4 py-3 text-sm\"></td>\n                                  <td className=\"px-4 py-3 text-sm text-right\">{formatCurrency(totalDebit)}</td>\n                                  <td className=\"px-4 py-3 text-sm text-right\">{formatCurrency(totalCredit)}</td>\n                                </tr>\n                              </>\n                            );\n                          })()}\n                        </tbody>\n                      </table>\n                    </div>\n                  </CardContent>\n                </Card>\n              </TabsContent>\n            </Tabs>\n          </div>\n        </div>\n      )}\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Vendor Credit</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete this vendor credit? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={confirmDelete} className=\"bg-red-600 hover:bg-red-700\">\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      <AlertDialog open={refundDialogOpen} onOpenChange={setRefundDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Refund Vendor Credit</AlertDialogTitle>\n            <AlertDialogDescription>\n              Enter the amount to refund from this vendor credit.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Amount</label>\n              <Input\n                type=\"number\"\n                step=\"0.01\"\n                value={refundAmount}\n                onChange={(e) => setRefundAmount(e.target.value)}\n                placeholder=\"Enter refund amount\"\n                data-testid=\"input-refund-amount\"\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                Maximum: {selectedCredit ? formatCurrency(selectedCredit.balance) : '0.00'}\n              </p>\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Reason (optional)</label>\n              <Input\n                value={refundReason}\n                onChange={(e) => setRefundReason(e.target.value)}\n                placeholder=\"Enter reason for refund\"\n                data-testid=\"input-refund-reason\"\n              />\n            </div>\n          </div>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={confirmRefund}>\n              Process Refund\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      <AlertDialog open={voidDialogOpen} onOpenChange={setVoidDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Void Vendor Credit</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to void this vendor credit ({selectedCredit?.creditNumber})? \n              This will mark the credit as void and it cannot be applied to any bills.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={confirmVoid} className=\"bg-orange-600 hover:bg-orange-700\">\n              Void Credit\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":41967,"size_tokens":null},"server/src/config/database.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from 'ws';\n\nneonConfig.webSocketConstructor = ws;\n\nconst connectionString = process.env.DATABASE_URL;\n\nif (!connectionString) {\n  console.warn('DATABASE_URL not set. Database features will be unavailable.');\n}\n\nexport const pool = connectionString ? new Pool({ connectionString }) : null;\nexport const db = pool ? drizzle(pool) : null;\n\nexport const getDb = () => {\n  if (!db) {\n    throw new Error('Database not configured. Please set DATABASE_URL environment variable.');\n  }\n  return db;\n};\n\nexport default db;\n","path":null,"size_bytes":640,"size_tokens":null},"client/src/modules/sales/pages/InvoiceCreatePage.tsx":{"content":"export { default } from '@/pages/invoice-create';\n","path":null,"size_bytes":50,"size_tokens":null},"client/src/components/FileUpload.tsx":{"content":"import { Upload, ChevronDown } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\nexport default function FileUpload() {\n  return (\n    <div className=\"border-2 border-dashed border-slate-300 rounded-lg p-6 flex flex-col items-center justify-center bg-slate-50 hover:bg-slate-100 transition-colors cursor-pointer group\">\n      <div className=\"flex items-center gap-2 bg-white border border-slate-200 rounded-md px-4 py-2 shadow-sm mb-3 group-hover:border-blue-300 group-hover:shadow-md transition-all\">\n        <Upload className=\"h-4 w-4 text-slate-500 group-hover:text-blue-600\" />\n        <span className=\"text-sm font-medium text-slate-700 group-hover:text-blue-700\">Upload File</span>\n        <ChevronDown className=\"h-4 w-4 text-slate-400 ml-2\" />\n      </div>\n      <p className=\"text-xs text-slate-500 text-center\">\n        You can upload a maximum of 10 files, 10MB each\n      </p>\n    </div>\n  );\n}\n","path":null,"size_bytes":928,"size_tokens":null},"client/src/layouts/AuthLayout.tsx":{"content":"import { ReactNode } from 'react';\n\ninterface AuthLayoutProps {\n  children: ReactNode;\n}\n\nexport const AuthLayout = ({ children }: AuthLayoutProps) => {\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n      <div className=\"max-w-md w-full space-y-8 p-8\">\n        <div className=\"text-center\">\n          <h1 className=\"text-3xl font-bold text-gray-900\">Bill</h1>\n          <p className=\"mt-2 text-sm text-gray-600\">App</p>\n        </div>\n        {children}\n      </div>\n    </div>\n  );\n};\n\nexport default AuthLayout;\n","path":null,"size_bytes":558,"size_tokens":null},"client/src/pages/reports.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { \n  BarChart3, \n  PieChart as PieChartIcon, \n  ArrowUpRight, \n  Download,\n  TrendingUp,\n  TrendingDown,\n  FileText,\n  Users,\n  DollarSign,\n  Receipt,\n  ChevronDown\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from \"@/components/ui/tabs\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  PieChart,\n  Pie,\n  Cell,\n  LineChart,\n  Line,\n  Legend,\n  AreaChart,\n  Area\n} from \"recharts\";\n\ninterface ReportsData {\n  profitAndLoss: {\n    totalIncome: number;\n    totalExpenses: number;\n    grossProfit: number;\n    netProfit: number;\n    monthlyData: Array<{ month: string; income: number; expense: number; profit: number }>;\n  };\n  salesByCustomer: Array<{ customer: string; totalSales: number; invoiceCount: number; percentage: number }>;\n  salesByProduct: Array<{ product: string; totalSales: number; quantity: number; percentage: number }>;\n  expenseBreakdown: Array<{ category: string; amount: number; percentage: number; color: string }>;\n  taxSummary: {\n    gstCollected: number;\n    gstPaid: number;\n    netGstPayable: number;\n    tdsDeducted: number;\n    monthlyGst: Array<{ month: string; collected: number; paid: number }>;\n  };\n  receivablesAging: Array<{ range: string; amount: number; count: number }>;\n  payablesAging: Array<{ range: string; amount: number; count: number }>;\n  invoiceSummary: {\n    totalInvoiced: number;\n    totalPaid: number;\n    totalOutstanding: number;\n    overdueAmount: number;\n    invoiceCount: number;\n    paidCount: number;\n    outstandingCount: number;\n    overdueCount: number;\n  };\n  billSummary: {\n    totalBilled: number;\n    totalPaid: number;\n    totalOutstanding: number;\n    overdueAmount: number;\n    billCount: number;\n    paidCount: number;\n    outstandingCount: number;\n    overdueCount: number;\n  };\n}\n\nconst COLORS = ['#4F46E5', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899', '#06B6D4', '#6B7280'];\n\nexport default function Reports() {\n  const [activeTab, setActiveTab] = useState(\"overview\");\n  const [dateRange] = useState(\"This Fiscal Year\");\n\n  const { data: reportsResponse, isLoading } = useQuery<{ success: boolean; data: ReportsData }>({\n    queryKey: ['/api/reports'],\n  });\n\n  const reports = reportsResponse?.data;\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('en-IN', {\n      style: 'currency',\n      currency: 'INR',\n      minimumFractionDigits: 2\n    }).format(amount);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"max-w-7xl mx-auto flex items-center justify-center h-64\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-7xl mx-auto space-y-6 animate-in fade-in duration-500\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-reports-title\">Reports</h1>\n          <p className=\"text-muted-foreground mt-1\">Insights into your business performance.</p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"outline\" className=\"gap-2\">\n                {dateRange} <ChevronDown className=\"h-4 w-4\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\">\n              <DropdownMenuItem>This Fiscal Year</DropdownMenuItem>\n              <DropdownMenuItem>Last Fiscal Year</DropdownMenuItem>\n              <DropdownMenuItem>This Quarter</DropdownMenuItem>\n              <DropdownMenuItem>Last Quarter</DropdownMenuItem>\n              <DropdownMenuItem>This Month</DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n          <Button variant=\"outline\" className=\"gap-2\" data-testid=\"button-export-all\">\n            <Download className=\"h-4 w-4\" /> Export All\n          </Button>\n        </div>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n        <TabsList className=\"bg-transparent border-b w-full justify-start rounded-none h-auto p-0 gap-0 flex-wrap\">\n          <TabsTrigger \n            value=\"overview\" \n            className=\"data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=active]:text-indigo-600 rounded-none px-4 py-3 font-medium text-muted-foreground data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n            data-testid=\"tab-overview\"\n          >\n            Overview\n          </TabsTrigger>\n          <TabsTrigger \n            value=\"sales\"\n            className=\"data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=active]:text-indigo-600 rounded-none px-4 py-3 font-medium text-muted-foreground data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n            data-testid=\"tab-sales\"\n          >\n            Sales\n          </TabsTrigger>\n          <TabsTrigger \n            value=\"expenses\"\n            className=\"data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=active]:text-indigo-600 rounded-none px-4 py-3 font-medium text-muted-foreground data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n            data-testid=\"tab-expenses\"\n          >\n            Expenses\n          </TabsTrigger>\n          <TabsTrigger \n            value=\"receivables\"\n            className=\"data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=active]:text-indigo-600 rounded-none px-4 py-3 font-medium text-muted-foreground data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n            data-testid=\"tab-receivables\"\n          >\n            Receivables\n          </TabsTrigger>\n          <TabsTrigger \n            value=\"payables\"\n            className=\"data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=active]:text-indigo-600 rounded-none px-4 py-3 font-medium text-muted-foreground data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n            data-testid=\"tab-payables\"\n          >\n            Payables\n          </TabsTrigger>\n          <TabsTrigger \n            value=\"taxes\"\n            className=\"data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=active]:text-indigo-600 rounded-none px-4 py-3 font-medium text-muted-foreground data-[state=active]:bg-transparent data-[state=active]:shadow-none\"\n            data-testid=\"tab-taxes\"\n          >\n            Taxes\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"overview\" className=\"mt-6 space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n            <Card>\n              <CardContent className=\"pt-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Total Income</p>\n                    <p className=\"text-2xl font-bold text-green-600\" data-testid=\"value-total-income\">\n                      {formatCurrency(reports?.profitAndLoss?.totalIncome || 0)}\n                    </p>\n                  </div>\n                  <div className=\"h-10 w-10 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center\">\n                    <TrendingUp className=\"h-5 w-5 text-green-600\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"pt-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Total Expenses</p>\n                    <p className=\"text-2xl font-bold text-red-500\" data-testid=\"value-total-expenses\">\n                      {formatCurrency(reports?.profitAndLoss?.totalExpenses || 0)}\n                    </p>\n                  </div>\n                  <div className=\"h-10 w-10 rounded-full bg-red-100 dark:bg-red-900 flex items-center justify-center\">\n                    <TrendingDown className=\"h-5 w-5 text-red-500\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"pt-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Net Profit</p>\n                    <p className=\"text-2xl font-bold text-indigo-600\" data-testid=\"value-net-profit\">\n                      {formatCurrency(reports?.profitAndLoss?.netProfit || 0)}\n                    </p>\n                  </div>\n                  <div className=\"h-10 w-10 rounded-full bg-indigo-100 dark:bg-indigo-900 flex items-center justify-center\">\n                    <DollarSign className=\"h-5 w-5 text-indigo-600\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"pt-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">GST Payable</p>\n                    <p className=\"text-2xl font-bold text-amber-600\" data-testid=\"value-gst-payable\">\n                      {formatCurrency(reports?.taxSummary?.netGstPayable || 0)}\n                    </p>\n                  </div>\n                  <div className=\"h-10 w-10 rounded-full bg-amber-100 dark:bg-amber-900 flex items-center justify-center\">\n                    <Receipt className=\"h-5 w-5 text-amber-600\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <ArrowUpRight className=\"h-5 w-5 text-green-500\" />\n                Profit & Loss Trend\n              </CardTitle>\n              <CardDescription>Monthly income, expense, and profit overview</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-72\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <AreaChart data={reports?.profitAndLoss?.monthlyData || []}>\n                    <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                    <XAxis \n                      dataKey=\"month\" \n                      tick={{ fontSize: 11 }}\n                      tickFormatter={(value) => value.split(' ')[0]}\n                      className=\"fill-muted-foreground\"\n                    />\n                    <YAxis \n                      tick={{ fontSize: 11 }}\n                      tickFormatter={(value) => `${(value / 1000).toFixed(0)}K`}\n                      className=\"fill-muted-foreground\"\n                    />\n                    <Tooltip \n                      formatter={(value: number) => formatCurrency(value)}\n                      contentStyle={{ backgroundColor: 'var(--background)', border: '1px solid var(--border)' }}\n                    />\n                    <Legend />\n                    <Area type=\"monotone\" dataKey=\"income\" name=\"Income\" stroke=\"#22c55e\" fill=\"#dcfce7\" stackId=\"1\" />\n                    <Area type=\"monotone\" dataKey=\"expense\" name=\"Expense\" stroke=\"#ef4444\" fill=\"#fee2e2\" stackId=\"2\" />\n                    <Line type=\"monotone\" dataKey=\"profit\" name=\"Profit\" stroke=\"#6366f1\" strokeWidth={2} dot={false} />\n                  </AreaChart>\n                </ResponsiveContainer>\n              </div>\n            </CardContent>\n          </Card>\n\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Users className=\"h-5 w-5 text-indigo-500\" />\n                  Top Customers by Sales\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  {reports?.salesByCustomer?.slice(0, 5).map((customer, index) => (\n                    <div key={customer.customer} className=\"flex items-center gap-4\">\n                      <div \n                        className=\"w-3 h-3 rounded-full flex-shrink-0\" \n                        style={{ backgroundColor: COLORS[index % COLORS.length] }}\n                      />\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center justify-between mb-1\">\n                          <span className=\"font-medium truncate\">{customer.customer}</span>\n                          <span className=\"text-sm font-medium\">{formatCurrency(customer.totalSales)}</span>\n                        </div>\n                        <div className=\"w-full h-2 bg-muted rounded-full overflow-hidden\">\n                          <div \n                            className=\"h-full rounded-full\" \n                            style={{ \n                              width: `${customer.percentage}%`,\n                              backgroundColor: COLORS[index % COLORS.length]\n                            }}\n                          />\n                        </div>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          {customer.invoiceCount} invoices ({customer.percentage.toFixed(1)}%)\n                        </p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <PieChartIcon className=\"h-5 w-5 text-purple-500\" />\n                  Expense Distribution\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex gap-4\">\n                  <div className=\"w-44 h-44\">\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <PieChart>\n                        <Pie\n                          data={reports?.expenseBreakdown || []}\n                          dataKey=\"percentage\"\n                          nameKey=\"category\"\n                          cx=\"50%\"\n                          cy=\"50%\"\n                          innerRadius={35}\n                          outerRadius={70}\n                        >\n                          {reports?.expenseBreakdown?.map((entry, index) => (\n                            <Cell key={`cell-${index}`} fill={entry.color || COLORS[index % COLORS.length]} />\n                          ))}\n                        </Pie>\n                        <Tooltip formatter={(value: number) => `${value.toFixed(1)}%`} />\n                      </PieChart>\n                    </ResponsiveContainer>\n                  </div>\n                  <div className=\"flex-1 space-y-2 max-h-44 overflow-y-auto\">\n                    {reports?.expenseBreakdown?.slice(0, 6).map((expense, index) => (\n                      <div key={expense.category} className=\"flex items-center justify-between text-sm\">\n                        <div className=\"flex items-center gap-2\">\n                          <div \n                            className=\"w-3 h-3 rounded-full flex-shrink-0\" \n                            style={{ backgroundColor: expense.color || COLORS[index % COLORS.length] }}\n                          />\n                          <span className=\"truncate max-w-28\">{expense.category}</span>\n                        </div>\n                        <span className=\"font-medium\">{expense.percentage.toFixed(1)}%</span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"sales\" className=\"mt-6 space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <Card>\n              <CardContent className=\"pt-6\">\n                <p className=\"text-sm text-muted-foreground\">Total Invoiced</p>\n                <p className=\"text-2xl font-bold\">{formatCurrency(reports?.invoiceSummary?.totalInvoiced || 0)}</p>\n                <p className=\"text-xs text-muted-foreground mt-1\">{reports?.invoiceSummary?.invoiceCount || 0} invoices</p>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"pt-6\">\n                <p className=\"text-sm text-muted-foreground\">Total Paid</p>\n                <p className=\"text-2xl font-bold text-green-600\">{formatCurrency(reports?.invoiceSummary?.totalPaid || 0)}</p>\n                <p className=\"text-xs text-muted-foreground mt-1\">{reports?.invoiceSummary?.paidCount || 0} paid</p>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"pt-6\">\n                <p className=\"text-sm text-muted-foreground\">Outstanding</p>\n                <p className=\"text-2xl font-bold text-amber-600\">{formatCurrency(reports?.invoiceSummary?.totalOutstanding || 0)}</p>\n                <p className=\"text-xs text-muted-foreground mt-1\">{reports?.invoiceSummary?.outstandingCount || 0} pending</p>\n              </CardContent>\n            </Card>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Sales by Product/Service</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-64\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <BarChart data={reports?.salesByProduct || []} layout=\"vertical\">\n                    <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                    <XAxis type=\"number\" tickFormatter={(value) => `${(value / 1000).toFixed(0)}K`} />\n                    <YAxis type=\"category\" dataKey=\"product\" width={120} tick={{ fontSize: 12 }} />\n                    <Tooltip formatter={(value: number) => formatCurrency(value)} />\n                    <Bar dataKey=\"totalSales\" fill=\"#6366f1\" radius={[0, 4, 4, 0]} />\n                  </BarChart>\n                </ResponsiveContainer>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"expenses\" className=\"mt-6 space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Expense Breakdown by Category</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-72\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <BarChart data={reports?.expenseBreakdown || []}>\n                    <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                    <XAxis \n                      dataKey=\"category\" \n                      tick={{ fontSize: 10 }}\n                      interval={0}\n                      angle={-45}\n                      textAnchor=\"end\"\n                      height={80}\n                    />\n                    <YAxis tickFormatter={(value) => `${(value / 1000).toFixed(0)}K`} />\n                    <Tooltip formatter={(value: number) => formatCurrency(value)} />\n                    <Bar dataKey=\"amount\" fill=\"#6366f1\" radius={[4, 4, 0, 0]}>\n                      {reports?.expenseBreakdown?.map((entry, index) => (\n                        <Cell key={`cell-${index}`} fill={entry.color || COLORS[index % COLORS.length]} />\n                      ))}\n                    </Bar>\n                  </BarChart>\n                </ResponsiveContainer>\n              </div>\n            </CardContent>\n          </Card>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            {reports?.expenseBreakdown?.map((expense, index) => (\n              <Card key={expense.category}>\n                <CardContent className=\"pt-6\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <div \n                        className=\"w-4 h-4 rounded\" \n                        style={{ backgroundColor: expense.color || COLORS[index % COLORS.length] }}\n                      />\n                      <div>\n                        <p className=\"font-medium\">{expense.category}</p>\n                        <p className=\"text-sm text-muted-foreground\">{expense.percentage.toFixed(1)}% of total</p>\n                      </div>\n                    </div>\n                    <p className=\"text-xl font-bold\">{formatCurrency(expense.amount)}</p>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"receivables\" className=\"mt-6 space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Receivables Aging Summary</CardTitle>\n              <CardDescription>Outstanding invoices by age</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-64\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <BarChart data={reports?.receivablesAging || []}>\n                    <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                    <XAxis dataKey=\"range\" />\n                    <YAxis tickFormatter={(value) => `${(value / 1000).toFixed(0)}K`} />\n                    <Tooltip formatter={(value: number) => formatCurrency(value)} />\n                    <Bar dataKey=\"amount\" fill=\"#22c55e\" radius={[4, 4, 0, 0]} />\n                  </BarChart>\n                </ResponsiveContainer>\n              </div>\n            </CardContent>\n          </Card>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            {reports?.receivablesAging?.map((aging) => (\n              <Card key={aging.range}>\n                <CardContent className=\"pt-6\">\n                  <p className=\"text-sm text-muted-foreground\">{aging.range}</p>\n                  <p className=\"text-xl font-bold\">{formatCurrency(aging.amount)}</p>\n                  <p className=\"text-xs text-muted-foreground\">{aging.count} invoices</p>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"payables\" className=\"mt-6 space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <Card>\n              <CardContent className=\"pt-6\">\n                <p className=\"text-sm text-muted-foreground\">Total Billed</p>\n                <p className=\"text-2xl font-bold\">{formatCurrency(reports?.billSummary?.totalBilled || 0)}</p>\n                <p className=\"text-xs text-muted-foreground mt-1\">{reports?.billSummary?.billCount || 0} bills</p>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"pt-6\">\n                <p className=\"text-sm text-muted-foreground\">Total Paid</p>\n                <p className=\"text-2xl font-bold text-green-600\">{formatCurrency(reports?.billSummary?.totalPaid || 0)}</p>\n                <p className=\"text-xs text-muted-foreground mt-1\">{reports?.billSummary?.paidCount || 0} paid</p>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"pt-6\">\n                <p className=\"text-sm text-muted-foreground\">Outstanding</p>\n                <p className=\"text-2xl font-bold text-amber-600\">{formatCurrency(reports?.billSummary?.totalOutstanding || 0)}</p>\n                <p className=\"text-xs text-muted-foreground mt-1\">{reports?.billSummary?.outstandingCount || 0} pending</p>\n              </CardContent>\n            </Card>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Payables Aging Summary</CardTitle>\n              <CardDescription>Outstanding bills by age</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-64\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <BarChart data={reports?.payablesAging || []}>\n                    <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                    <XAxis dataKey=\"range\" />\n                    <YAxis tickFormatter={(value) => `${(value / 1000).toFixed(0)}K`} />\n                    <Tooltip formatter={(value: number) => formatCurrency(value)} />\n                    <Bar dataKey=\"amount\" fill=\"#f59e0b\" radius={[4, 4, 0, 0]} />\n                  </BarChart>\n                </ResponsiveContainer>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"taxes\" className=\"mt-6 space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            <Card>\n              <CardContent className=\"pt-6\">\n                <p className=\"text-sm text-muted-foreground\">GST Collected</p>\n                <p className=\"text-2xl font-bold text-green-600\">{formatCurrency(reports?.taxSummary?.gstCollected || 0)}</p>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"pt-6\">\n                <p className=\"text-sm text-muted-foreground\">GST Paid (Input)</p>\n                <p className=\"text-2xl font-bold text-red-500\">{formatCurrency(reports?.taxSummary?.gstPaid || 0)}</p>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"pt-6\">\n                <p className=\"text-sm text-muted-foreground\">Net GST Payable</p>\n                <p className=\"text-2xl font-bold text-amber-600\">{formatCurrency(reports?.taxSummary?.netGstPayable || 0)}</p>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"pt-6\">\n                <p className=\"text-sm text-muted-foreground\">TDS Deducted</p>\n                <p className=\"text-2xl font-bold\">{formatCurrency(reports?.taxSummary?.tdsDeducted || 0)}</p>\n              </CardContent>\n            </Card>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Monthly GST Summary</CardTitle>\n              <CardDescription>GST collected vs paid by month</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-64\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <BarChart data={reports?.taxSummary?.monthlyGst || []}>\n                    <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                    <XAxis \n                      dataKey=\"month\" \n                      tick={{ fontSize: 10 }}\n                      tickFormatter={(value) => value.split(' ')[0]}\n                    />\n                    <YAxis tickFormatter={(value) => `${(value / 1000).toFixed(0)}K`} />\n                    <Tooltip formatter={(value: number) => formatCurrency(value)} />\n                    <Legend />\n                    <Bar dataKey=\"collected\" name=\"Collected\" fill=\"#22c55e\" radius={[4, 4, 0, 0]} />\n                    <Bar dataKey=\"paid\" name=\"Paid\" fill=\"#ef4444\" radius={[4, 4, 0, 0]} />\n                  </BarChart>\n                </ResponsiveContainer>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":27879,"size_tokens":null},"client/src/modules/items/pages/ItemDetailPage.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation, useRoute } from \"wouter\";\nimport { ArrowLeft, Edit, Trash2, MoreHorizontal } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\ninterface Item {\n  id: string;\n  name: string;\n  purchaseDescription: string;\n  purchaseRate: string;\n  description: string;\n  rate: string;\n  hsnSac: string;\n  usageUnit: string;\n  type: string;\n  isActive: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport default function ItemDetailPage() {\n  const [, setLocation] = useLocation();\n  const [, params] = useRoute(\"/items/:id\");\n  const [item, setItem] = useState<Item | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n\n  useEffect(() => {\n    if (params?.id) {\n      fetchItem(params.id);\n    }\n  }, [params?.id]);\n\n  const fetchItem = async (id: string) => {\n    try {\n      const response = await fetch(`/api/items/${id}`);\n      if (response.ok) {\n        const data = await response.json();\n        setItem(data);\n      } else {\n        setLocation(\"/items\");\n      }\n    } catch (error) {\n      console.error(\"Failed to fetch item:\", error);\n      setLocation(\"/items\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!item) return;\n    try {\n      const response = await fetch(`/api/items/${item.id}`, {\n        method: \"DELETE\",\n      });\n      if (response.ok) {\n        setLocation(\"/items\");\n      }\n    } catch (error) {\n      console.error(\"Failed to delete item:\", error);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <div className=\"text-slate-500\">Loading item details...</div>\n      </div>\n    );\n  }\n\n  if (!item) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <div className=\"text-slate-500\">Item not found</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6 animate-in fade-in duration-300\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setLocation(\"/items\")}\n          >\n            <ArrowLeft className=\"h-5 w-5\" />\n          </Button>\n          <div>\n            <h1 className=\"text-2xl font-semibold text-slate-900\">{item.name}</h1>\n            <p className=\"text-sm text-slate-500 capitalize\">{item.type || \"Item\"}</p>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={() => setLocation(`/items/${item.id}/edit`)}\n          >\n            <Edit className=\"h-4 w-4 mr-2\" />\n            Edit\n          </Button>\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"outline\" size=\"icon\">\n                <MoreHorizontal className=\"h-4 w-4\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\">\n              <DropdownMenuItem>Clone Item</DropdownMenuItem>\n              <DropdownMenuItem>Mark as Inactive</DropdownMenuItem>\n              <DropdownMenuItem\n                className=\"text-red-600\"\n                onClick={() => setShowDeleteDialog(true)}\n              >\n                <Trash2 className=\"h-4 w-4 mr-2\" />\n                Delete\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Sales Information</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex justify-between\">\n              <span className=\"text-slate-500\">Selling Price</span>\n              <span className=\"font-medium\">{item.rate || \"0.00\"}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-slate-500\">Description</span>\n              <span className=\"font-medium text-right max-w-[200px]\">\n                {item.description || \"-\"}\n              </span>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Purchase Information</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex justify-between\">\n              <span className=\"text-slate-500\">Purchase Price</span>\n              <span className=\"font-medium\">{item.purchaseRate || \"0.00\"}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-slate-500\">Description</span>\n              <span className=\"font-medium text-right max-w-[200px]\">\n                {item.purchaseDescription || \"-\"}\n              </span>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Tax & Compliance</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex justify-between\">\n              <span className=\"text-slate-500\">HSN/SAC Code</span>\n              <span className=\"font-medium\">{item.hsnSac || \"-\"}</span>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Other Details</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex justify-between\">\n              <span className=\"text-slate-500\">Usage Unit</span>\n              <span className=\"font-medium\">{item.usageUnit || \"-\"}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-slate-500\">Status</span>\n              <span className={`font-medium ${item.isActive ? \"text-green-600\" : \"text-slate-500\"}`}>\n                {item.isActive ? \"Active\" : \"Inactive\"}\n              </span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-slate-500\">Created</span>\n              <span className=\"font-medium\">\n                {item.createdAt ? new Date(item.createdAt).toLocaleDateString() : \"-\"}\n              </span>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Item</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete \"{item.name}\"? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleDelete}\n              className=\"bg-red-600 hover:bg-red-700\"\n            >\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":7769,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/modules/accounting/pages/TimeTrackingPage.tsx":{"content":"export { default } from '@/pages/time-tracking';\n","path":null,"size_bytes":49,"size_tokens":null},"client/src/modules/purchases/pages/index.ts":{"content":"export { default as PurchaseOrdersPage } from './PurchaseOrdersPage';\nexport { default as BillsPage } from './BillsPage';\nexport { default as PaymentsMadePage } from './PaymentsMadePage';\nexport { default as VendorCreditsPage } from './VendorCreditsPage';\n","path":null,"size_bytes":256,"size_tokens":null},"server/src/app.ts":{"content":"import express, { Express } from 'express';\nimport cors from 'cors';\nimport { env } from './config';\nimport { requestLogger, errorHandler, notFoundHandler } from './middleware';\nimport { apiRouter } from './api/v1';\n\nexport const createApp = (): Express => {\n  const app = express();\n\n  // Middleware\n  app.use(cors({ origin: env.CORS_ORIGIN }));\n  app.use(express.json());\n  app.use(express.urlencoded({ extended: true }));\n  app.use(requestLogger);\n\n  // Health check\n  app.get('/health', (req, res) => {\n    res.json({ status: 'ok', timestamp: new Date().toISOString() });\n  });\n\n  // API routes\n  app.use('/api/v1', apiRouter);\n\n  // Error handling\n  app.use(notFoundHandler);\n  app.use(errorHandler);\n\n  return app;\n};\n\nexport default createApp;\n","path":null,"size_bytes":751,"size_tokens":null},"client/src/modules/items/components/ItemDetailPanel.tsx":{"content":"import { useState } from \"react\";\nimport { X, Edit, MoreHorizontal, ChevronDown } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\n\ninterface Item {\n  id: string;\n  name: string;\n  purchaseDescription: string;\n  purchaseRate: string;\n  description: string;\n  rate: string;\n  hsnSac: string;\n  usageUnit: string;\n  type?: string;\n  createdSource?: string;\n  taxPreference?: string;\n  intraStateTax?: string;\n  interStateTax?: string;\n  purchaseAccount?: string;\n  salesAccount?: string;\n  isActive?: boolean;\n  createdAt?: string;\n  updatedAt?: string;\n}\n\ninterface Transaction {\n  id: string;\n  date: string;\n  quoteNumber: string;\n  customerName: string;\n  quantitySold: number;\n  price: number;\n  total: number;\n  status: string;\n}\n\ninterface HistoryEntry {\n  id: string;\n  date: string;\n  details: string;\n}\n\ninterface ItemDetailPanelProps {\n  item: Item;\n  onClose: () => void;\n  onEdit?: () => void;\n  onClone?: (item: Item) => void;\n  onToggleActive?: (item: Item) => void;\n  onDelete?: (item: Item) => void;\n}\n\nconst sampleTransactions: Transaction[] = [\n  {\n    id: \"1\",\n    date: \"08/10/2025\",\n    quoteNumber: \"QT-000003\",\n    customerName: \"Ashtvinayak Education Society\",\n    quantitySold: 43.00,\n    price: 700.00,\n    total: 30100.00,\n    status: \"Sent\"\n  }\n];\n\nconst getHistoryEntries = (item: Item): HistoryEntry[] => {\n  return [\n    {\n      id: \"1\",\n      date: item.createdAt \n        ? new Date(item.createdAt).toLocaleString('en-IN', { \n            month: '2-digit', \n            day: '2-digit', \n            year: 'numeric',\n            hour: '2-digit',\n            minute: '2-digit',\n            hour12: true \n          })\n        : new Date().toLocaleString('en-IN', { \n            month: '2-digit', \n            day: '2-digit', \n            year: 'numeric',\n            hour: '2-digit',\n            minute: '2-digit',\n            hour12: true \n          }),\n      details: \"created by - Rohan Bhosale\"\n    }\n  ];\n};\n\nexport default function ItemDetailPanel({ item, onClose, onEdit, onClone, onToggleActive, onDelete }: ItemDetailPanelProps) {\n  const [activeTab, setActiveTab] = useState(\"overview\");\n  const [filterBy, setFilterBy] = useState(\"quotes\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n\n  const transactions = sampleTransactions;\n  const historyEntries = getHistoryEntries(item);\n\n  const handleClone = () => {\n    if (onClone) {\n      onClone(item);\n    }\n  };\n\n  const handleToggleActive = () => {\n    if (onToggleActive) {\n      onToggleActive(item);\n    }\n  };\n\n  const handleDelete = () => {\n    if (onDelete) {\n      onDelete(item);\n    }\n  };\n\n  return (\n    <div className=\"h-full flex flex-col bg-white border-l border-slate-200\">\n      <div className=\"flex items-center justify-between px-6 py-4 border-b border-slate-200\">\n        <h2 className=\"text-xl font-semibold text-slate-900\">{item.name}</h2>\n        <div className=\"flex items-center gap-2\">\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={onEdit}>\n            <Edit className=\"h-4 w-4\" />\n          </Button>\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1\">\n                More <ChevronDown className=\"h-3 w-3\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\">\n              <DropdownMenuItem onClick={handleClone} data-testid=\"dropdown-clone-item\">Clone Item</DropdownMenuItem>\n              <DropdownMenuItem onClick={handleToggleActive} data-testid=\"dropdown-toggle-active\">\n                {item.isActive !== false ? \"Mark as Inactive\" : \"Mark as Active\"}\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={handleDelete} className=\"text-red-600\" data-testid=\"dropdown-delete-item\">Delete</DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={onClose}>\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"flex-1 flex flex-col\">\n        <TabsList className=\"w-full justify-start rounded-none border-b border-slate-200 bg-transparent h-auto p-0\">\n          <TabsTrigger \n            value=\"overview\" \n            className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n          >\n            Overview\n          </TabsTrigger>\n          <TabsTrigger \n            value=\"transactions\" \n            className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n          >\n            Transactions\n          </TabsTrigger>\n          <TabsTrigger \n            value=\"history\" \n            className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n          >\n            History\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"overview\" className=\"flex-1 overflow-auto p-6 mt-0\">\n          <div className=\"space-y-6\">\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-[160px_1fr] gap-y-3 text-sm\">\n                <span className=\"text-slate-500\">Item Type</span>\n                <span className=\"text-slate-900\">Sales and Purchase Items</span>\n                \n                <span className=\"text-slate-500\">HSN Code</span>\n                <span className=\"text-slate-900\">{item.hsnSac || \"-\"}</span>\n                \n                <span className=\"text-slate-500\">Created Source</span>\n                <span className=\"text-slate-900\">{item.createdSource || \"User\"}</span>\n                \n                <span className=\"text-slate-500\">Tax Preference</span>\n                <span className=\"text-slate-900\">{item.taxPreference || \"Taxable\"}</span>\n                \n                <span className=\"text-slate-500\">Intra State Tax Rate</span>\n                <span className=\"text-slate-900\">{item.intraStateTax || \"GST18 (18 %)\"}</span>\n                \n                <span className=\"text-slate-500\">Inter State Tax Rate</span>\n                <span className=\"text-slate-900\">{item.interStateTax || \"IGST18 (18 %)\"}</span>\n              </div>\n            </div>\n\n            <div className=\"border-t border-slate-200 pt-6\">\n              <h3 className=\"text-base font-medium text-slate-900 mb-4\">Purchase Information</h3>\n              <div className=\"grid grid-cols-[160px_1fr] gap-y-3 text-sm\">\n                <span className=\"text-slate-500\">Cost Price</span>\n                <span className=\"text-slate-900\">{item.purchaseRate || \"0.00\"}</span>\n                \n                <span className=\"text-slate-500\">Purchase Account</span>\n                <span className=\"text-slate-900\">{item.purchaseAccount || \"Cost of Goods Sold\"}</span>\n              </div>\n            </div>\n\n            <div className=\"border-t border-slate-200 pt-6\">\n              <h3 className=\"text-base font-medium text-slate-900 mb-4\">Sales Information</h3>\n              <div className=\"grid grid-cols-[160px_1fr] gap-y-3 text-sm\">\n                <span className=\"text-slate-500\">Selling Price</span>\n                <span className=\"text-slate-900\">{item.rate || \"0.00\"}</span>\n                \n                <span className=\"text-slate-500\">Sales Account</span>\n                <span className=\"text-slate-900\">{item.salesAccount || \"Sales\"}</span>\n              </div>\n            </div>\n\n            <div className=\"border-t border-slate-200 pt-6\">\n              <h3 className=\"text-base font-medium text-slate-900 mb-4\">Reporting Tags</h3>\n              <p className=\"text-sm text-slate-500\">No reporting tag has been associated with this item.</p>\n            </div>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"transactions\" className=\"flex-1 overflow-auto mt-0\">\n          <div className=\"p-4 border-b border-slate-200 flex items-center gap-4\">\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm text-slate-500\">Filter By:</span>\n              <Select value={filterBy} onValueChange={setFilterBy}>\n                <SelectTrigger className=\"w-[120px] h-8\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"quotes\">Quotes</SelectItem>\n                  <SelectItem value=\"invoices\">Invoices</SelectItem>\n                  <SelectItem value=\"orders\">Orders</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm text-slate-500\">Status:</span>\n              <Select value={statusFilter} onValueChange={setStatusFilter}>\n                <SelectTrigger className=\"w-[100px] h-8\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All</SelectItem>\n                  <SelectItem value=\"sent\">Sent</SelectItem>\n                  <SelectItem value=\"draft\">Draft</SelectItem>\n                  <SelectItem value=\"accepted\">Accepted</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n          <Table>\n            <TableHeader>\n              <TableRow className=\"bg-slate-50/80\">\n                <TableHead className=\"text-xs font-medium text-slate-500\">DATE</TableHead>\n                <TableHead className=\"text-xs font-medium text-slate-500\">QUOTE NUMBER</TableHead>\n                <TableHead className=\"text-xs font-medium text-slate-500\">CUSTOMER NAME</TableHead>\n                <TableHead className=\"text-xs font-medium text-slate-500\">QUANTITY SOLD</TableHead>\n                <TableHead className=\"text-xs font-medium text-slate-500 text-right\">PRICE</TableHead>\n                <TableHead className=\"text-xs font-medium text-slate-500 text-right\">TOTAL</TableHead>\n                <TableHead className=\"text-xs font-medium text-slate-500\">STATUS</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {transactions.length === 0 ? (\n                <TableRow>\n                  <TableCell colSpan={7} className=\"text-center text-slate-500 py-8\">\n                    No transactions found\n                  </TableCell>\n                </TableRow>\n              ) : (\n                transactions.map((transaction) => (\n                  <TableRow key={transaction.id}>\n                    <TableCell className=\"text-sm\">{transaction.date}</TableCell>\n                    <TableCell className=\"text-sm text-blue-600\">{transaction.quoteNumber}</TableCell>\n                    <TableCell className=\"text-sm\">{transaction.customerName}</TableCell>\n                    <TableCell className=\"text-sm\">{transaction.quantitySold.toFixed(2)}</TableCell>\n                    <TableCell className=\"text-sm text-right\">{transaction.price.toFixed(2)}</TableCell>\n                    <TableCell className=\"text-sm text-right\">{transaction.total.toFixed(2)}</TableCell>\n                    <TableCell>\n                      <Badge \n                        variant=\"outline\" \n                        className=\"text-blue-600 border-blue-200 bg-blue-50\"\n                      >\n                        {transaction.status}\n                      </Badge>\n                    </TableCell>\n                  </TableRow>\n                ))\n              )}\n            </TableBody>\n          </Table>\n        </TabsContent>\n\n        <TabsContent value=\"history\" className=\"flex-1 overflow-auto mt-0\">\n          <Table>\n            <TableHeader>\n              <TableRow className=\"bg-slate-50/80\">\n                <TableHead className=\"text-xs font-medium text-slate-500 w-[200px]\">DATE</TableHead>\n                <TableHead className=\"text-xs font-medium text-slate-500\">DETAILS</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {historyEntries.length === 0 ? (\n                <TableRow>\n                  <TableCell colSpan={2} className=\"text-center text-slate-500 py-8\">\n                    No history found\n                  </TableCell>\n                </TableRow>\n              ) : (\n                historyEntries.map((entry) => (\n                  <TableRow key={entry.id}>\n                    <TableCell className=\"text-sm\">{entry.date}</TableCell>\n                    <TableCell className=\"text-sm\">{entry.details}</TableCell>\n                  </TableRow>\n                ))\n              )}\n            </TableBody>\n          </Table>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":13448,"size_tokens":null},"client/src/modules/items/pages/ItemCreatePage.tsx":{"content":"export { default } from '@/pages/products-create';\n","path":null,"size_bytes":51,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Portal>\n    <TooltipPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </TooltipPrimitive.Portal>\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1267,"size_tokens":null},"client/src/pages/filing-compliance.tsx":{"content":"import { Search, Filter, FileCheck, Calendar, AlertCircle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\n\nexport default function FilingCompliance() {\n  return (\n    <div className=\"max-w-7xl mx-auto space-y-6 animate-in fade-in duration-500\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl sm:text-3xl font-display font-bold text-foreground tracking-tight\">Filing & Compliance</h1>\n          <p className=\"text-muted-foreground\">Stay on top of tax filings and regulatory compliance.</p>\n        </div>\n      </div>\n\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"relative flex-1\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input placeholder=\"Search filings...\" className=\"pl-9\" />\n        </div>\n        <Button variant=\"outline\" className=\"gap-2\">\n          <Filter className=\"h-4 w-4\" /> Filter\n        </Button>\n      </div>\n\n      <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\n        <Card className=\"border-orange-200 bg-orange-50/50\">\n          <CardHeader className=\"pb-3\">\n            <div className=\"flex items-center gap-2\">\n              <AlertCircle className=\"h-5 w-5 text-orange-600\" />\n              <CardTitle className=\"text-lg text-orange-900\">GST Return</CardTitle>\n            </div>\n            <CardDescription className=\"text-orange-700\">Due in 15 days</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center gap-2 text-sm text-orange-600\">\n              <Calendar className=\"h-4 w-4\" />\n              <span>Due: Dec 20, 2024</span>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-green-200 bg-green-50/50\">\n          <CardHeader className=\"pb-3\">\n            <div className=\"flex items-center gap-2\">\n              <FileCheck className=\"h-5 w-5 text-green-600\" />\n              <CardTitle className=\"text-lg text-green-900\">TDS Filing</CardTitle>\n            </div>\n            <CardDescription className=\"text-green-700\">Filed on time</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center gap-2 text-sm text-green-600\">\n              <Calendar className=\"h-4 w-4\" />\n              <span>Filed: Nov 30, 2024</span>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-dashed\">\n          <CardContent className=\"flex flex-col items-center justify-center py-8 text-center\">\n            <FileCheck className=\"h-8 w-8 text-muted-foreground mb-2\" />\n            <p className=\"text-sm text-muted-foreground\">All other filings up to date</p>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":3010,"size_tokens":null},"server/src/middleware/errorHandler.ts":{"content":"import { Request, Response, NextFunction } from 'express';\nimport { env } from '../config/env';\n\nexport class AppError extends Error {\n  statusCode: number;\n  isOperational: boolean;\n  code?: string;\n\n  constructor(message: string, statusCode: number = 500, code?: string) {\n    super(message);\n    this.statusCode = statusCode;\n    this.isOperational = true;\n    this.code = code;\n    \n    Error.captureStackTrace(this, this.constructor);\n  }\n}\n\nexport class ValidationError extends AppError {\n  errors: Record<string, string[]>;\n\n  constructor(message: string, errors: Record<string, string[]> = {}) {\n    super(message, 400, 'VALIDATION_ERROR');\n    this.errors = errors;\n  }\n}\n\nexport class NotFoundError extends AppError {\n  constructor(resource: string = 'Resource') {\n    super(`${resource} not found`, 404, 'NOT_FOUND');\n  }\n}\n\nexport class UnauthorizedError extends AppError {\n  constructor(message: string = 'Unauthorized') {\n    super(message, 401, 'UNAUTHORIZED');\n  }\n}\n\nexport class ForbiddenError extends AppError {\n  constructor(message: string = 'Access denied') {\n    super(message, 403, 'FORBIDDEN');\n  }\n}\n\nexport const errorHandler = (\n  err: Error | AppError,\n  req: Request,\n  res: Response,\n  next: NextFunction\n) => {\n  console.error('Error:', err);\n\n  if (err instanceof AppError) {\n    const response: any = {\n      success: false,\n      message: err.message,\n      code: err.code,\n    };\n\n    if (err instanceof ValidationError) {\n      response.errors = err.errors;\n    }\n\n    if (env.NODE_ENV === 'development') {\n      response.stack = err.stack;\n    }\n\n    return res.status(err.statusCode).json(response);\n  }\n\n  // Handle unexpected errors\n  const statusCode = 500;\n  const response: any = {\n    success: false,\n    message: env.NODE_ENV === 'production' \n      ? 'An unexpected error occurred' \n      : err.message,\n    code: 'INTERNAL_ERROR',\n  };\n\n  if (env.NODE_ENV === 'development') {\n    response.stack = err.stack;\n  }\n\n  return res.status(statusCode).json(response);\n};\n\nexport const notFoundHandler = (req: Request, res: Response) => {\n  res.status(404).json({\n    success: false,\n    message: `Route ${req.method} ${req.path} not found`,\n    code: 'ROUTE_NOT_FOUND',\n  });\n};\n","path":null,"size_bytes":2221,"size_tokens":null},"client/src/modules/vendors/pages/index.ts":{"content":"export { default as VendorsPage } from './VendorsPage';\n","path":null,"size_bytes":56,"size_tokens":null},"server/src/common/constants/index.ts":{"content":"export const HTTP_STATUS = {\n  OK: 200,\n  CREATED: 201,\n  NO_CONTENT: 204,\n  BAD_REQUEST: 400,\n  UNAUTHORIZED: 401,\n  FORBIDDEN: 403,\n  NOT_FOUND: 404,\n  CONFLICT: 409,\n  UNPROCESSABLE_ENTITY: 422,\n  INTERNAL_SERVER_ERROR: 500,\n  SERVICE_UNAVAILABLE: 503,\n} as const;\n\nexport const ERROR_CODES = {\n  VALIDATION_ERROR: 'VALIDATION_ERROR',\n  NOT_FOUND: 'NOT_FOUND',\n  UNAUTHORIZED: 'UNAUTHORIZED',\n  FORBIDDEN: 'FORBIDDEN',\n  CONFLICT: 'CONFLICT',\n  INTERNAL_ERROR: 'INTERNAL_ERROR',\n  DATABASE_ERROR: 'DATABASE_ERROR',\n} as const;\n\nexport const ROLES = {\n  ADMIN: 'admin',\n  ACCOUNTANT: 'accountant',\n  MANAGER: 'manager',\n  VIEWER: 'viewer',\n} as const;\n\nexport const PERMISSIONS = {\n  CREATE: 'create',\n  READ: 'read',\n  UPDATE: 'update',\n  DELETE: 'delete',\n  MANAGE: 'manage',\n} as const;\n\nexport const STATUS = {\n  ACTIVE: 'active',\n  INACTIVE: 'inactive',\n  DELETED: 'deleted',\n  DRAFT: 'draft',\n  PENDING: 'pending',\n  APPROVED: 'approved',\n  REJECTED: 'rejected',\n} as const;\n\nexport const INVOICE_STATUS = {\n  DRAFT: 'draft',\n  SENT: 'sent',\n  VIEWED: 'viewed',\n  PAID: 'paid',\n  PARTIALLY_PAID: 'partially_paid',\n  OVERDUE: 'overdue',\n  CANCELLED: 'cancelled',\n} as const;\n\nexport const PAYMENT_STATUS = {\n  UNPAID: 'unpaid',\n  PARTIAL: 'partial',\n  PAID: 'paid',\n} as const;\n\nexport const PAGINATION = {\n  DEFAULT_PAGE: 1,\n  DEFAULT_LIMIT: 10,\n  MAX_LIMIT: 100,\n} as const;\n","path":null,"size_bytes":1384,"size_tokens":null},"client/src/api/index.ts":{"content":"export { apiClient } from './client';\nexport * from './client';\n","path":null,"size_bytes":64,"size_tokens":null},"client/src/modules/items/types/index.ts":{"content":"import { BaseEntity } from '@/shared/types';\n\nexport interface Item extends BaseEntity {\n  name: string;\n  description?: string;\n  type: 'goods' | 'service';\n  sku?: string;\n  hsnSac?: string;\n  unit?: string;\n  sellingPrice: number;\n  purchasePrice: number;\n  taxRate?: number;\n  isActive: boolean;\n}\n\nexport interface CreateItemDto {\n  name: string;\n  description?: string;\n  type: 'goods' | 'service';\n  sku?: string;\n  hsnSac?: string;\n  unit?: string;\n  sellingPrice: number;\n  purchasePrice: number;\n  taxRate?: number;\n}\n\nexport interface UpdateItemDto extends Partial<CreateItemDto> {\n  isActive?: boolean;\n}\n\nexport interface ItemFilters {\n  search?: string;\n  type?: 'goods' | 'service';\n  isActive?: boolean;\n}\n","path":null,"size_bytes":722,"size_tokens":null},"client/src/shared/components/StatusBadge.tsx":{"content":"import { Badge } from '@/components/ui/badge';\n\ninterface StatusBadgeProps {\n  status: string;\n  variant?: 'default' | 'success' | 'warning' | 'error' | 'info';\n}\n\nconst statusVariantMap: Record<string, 'default' | 'success' | 'warning' | 'error' | 'info'> = {\n  draft: 'default',\n  pending: 'warning',\n  sent: 'info',\n  viewed: 'info',\n  paid: 'success',\n  partially_paid: 'warning',\n  overdue: 'error',\n  cancelled: 'error',\n  active: 'success',\n  inactive: 'default',\n  approved: 'success',\n  rejected: 'error',\n  accepted: 'success',\n  expired: 'error',\n  converted: 'success',\n};\n\nconst variantClassMap: Record<string, string> = {\n  default: 'bg-slate-100 text-slate-700',\n  success: 'bg-green-100 text-green-700',\n  warning: 'bg-yellow-100 text-yellow-700',\n  error: 'bg-red-100 text-red-700',\n  info: 'bg-blue-100 text-blue-700',\n};\n\nexport const StatusBadge = ({ status, variant }: StatusBadgeProps) => {\n  const resolvedVariant = variant || statusVariantMap[status.toLowerCase()] || 'default';\n  const className = variantClassMap[resolvedVariant];\n\n  return (\n    <Badge className={className}>\n      {status.replace(/_/g, ' ').replace(/\\b\\w/g, (l) => l.toUpperCase())}\n    </Badge>\n  );\n};\n\nexport default StatusBadge;\n","path":null,"size_bytes":1228,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n\" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n           // @replit: no hover, and add primary border\n           \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-sm border-destructive-border\",\n        outline:\n          // @replit Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color. Uses shadow-xs. no shadow on active\n          // No hover state\n          \" border [border-color:var(--button-outline)] shadow-xs active:shadow-none \",\n        secondary:\n          // @replit border, no hover, no shadow, secondary border.\n          \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // @replit no hover, transparent border\n        ghost: \"border border-transparent\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        // @replit changed sizes\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2356,"size_tokens":null},"server/src/modules/items/repository/index.ts":{"content":"export interface Item {\n  id: string;\n  name: string;\n  description?: string;\n  type: 'goods' | 'service';\n  sku?: string;\n  hsnSac?: string;\n  unit?: string;\n  sellingPrice: number;\n  purchasePrice: number;\n  taxRate?: number;\n  isActive: boolean;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nexport class ItemsRepository {\n  private items: Item[] = [];\n\n  async findAll(limit: number, offset: number, filters?: Record<string, any>) {\n    let filtered = [...this.items];\n    \n    if (filters?.search) {\n      const search = filters.search.toLowerCase();\n      filtered = filtered.filter(item => \n        item.name.toLowerCase().includes(search) ||\n        item.description?.toLowerCase().includes(search)\n      );\n    }\n    \n    if (filters?.type) {\n      filtered = filtered.filter(item => item.type === filters.type);\n    }\n    \n    if (typeof filters?.isActive === 'boolean') {\n      filtered = filtered.filter(item => item.isActive === filters.isActive);\n    }\n    \n    const total = filtered.length;\n    const items = filtered.slice(offset, offset + limit);\n    \n    return { items, total };\n  }\n\n  async findById(id: string) {\n    return this.items.find(item => item.id === id) || null;\n  }\n\n  async create(data: Omit<Item, 'id' | 'isActive' | 'createdAt' | 'updatedAt'>) {\n    const item: Item = {\n      id: Date.now().toString(),\n      ...data,\n      isActive: true,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    this.items.push(item);\n    return item;\n  }\n\n  async update(id: string, data: Partial<Item>) {\n    const index = this.items.findIndex(item => item.id === id);\n    if (index === -1) return null;\n    \n    this.items[index] = {\n      ...this.items[index],\n      ...data,\n      updatedAt: new Date(),\n    };\n    \n    return this.items[index];\n  }\n\n  async delete(id: string) {\n    const index = this.items.findIndex(item => item.id === id);\n    if (index === -1) return false;\n    \n    this.items.splice(index, 1);\n    return true;\n  }\n}\n\nexport default ItemsRepository;\n","path":null,"size_bytes":2008,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/modules/reports/pages/index.ts":{"content":"export { default as ReportsPage } from './ReportsPage';\n","path":null,"size_bytes":56,"size_tokens":null},"client/src/modules/items/pages/ItemsPage.tsx":{"content":"import { useState, useEffect, type MouseEvent } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Plus, MoreHorizontal, ChevronDown, ArrowUpDown, Import, Download, Settings, RefreshCw, RotateCcw, FileText, CheckSquare, History } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n  DropdownMenuSub,\n  DropdownMenuSubTrigger,\n  DropdownMenuSubContent,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport ItemDetailPanel from \"../components/ItemDetailPanel\";\n\ninterface Item {\n  id: string;\n  name: string;\n  purchaseDescription: string;\n  purchaseRate: string;\n  description: string;\n  rate: string;\n  hsnSac: string;\n  usageUnit: string;\n  type?: string;\n  createdSource?: string;\n  taxPreference?: string;\n  intraStateTax?: string;\n  interStateTax?: string;\n  purchaseAccount?: string;\n  salesAccount?: string;\n  isActive?: boolean;\n  createdAt?: string;\n  updatedAt?: string;\n}\n\nexport default function ItemsPage() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [items, setItems] = useState<Item[]>([]);\n  const [selectedItems, setSelectedItems] = useState<string[]>([]);\n  const [selectedItem, setSelectedItem] = useState<Item | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n  const [itemToDelete, setItemToDelete] = useState<Item | null>(null);\n\n  useEffect(() => {\n    fetchItems();\n  }, []);\n\n  const fetchItems = async () => {\n    try {\n      const response = await fetch('/api/items');\n      if (response.ok) {\n        const data = await response.json();\n        setItems(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch items:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const toggleSelectAll = () => {\n    if (selectedItems.length === items.length) {\n      setSelectedItems([]);\n    } else {\n      setSelectedItems(items.map(item => item.id));\n    }\n  };\n\n  const toggleSelectItem = (id: string, e: MouseEvent) => {\n    e.stopPropagation();\n    if (selectedItems.includes(id)) {\n      setSelectedItems(selectedItems.filter(i => i !== id));\n    } else {\n      setSelectedItems([...selectedItems, id]);\n    }\n  };\n\n  const handleItemClick = (item: Item) => {\n    setSelectedItem(item);\n  };\n\n  const handleClosePanel = () => {\n    setSelectedItem(null);\n  };\n\n  const handleEditItem = () => {\n    if (selectedItem) {\n      setLocation(`/items/${selectedItem.id}/edit`);\n    }\n  };\n\n  const handleCloneItem = async (item: Item) => {\n    try {\n      const response = await fetch(`/api/items/${item.id}/clone`, {\n        method: 'POST',\n      });\n      if (response.ok) {\n        toast({\n          title: \"Item Cloned\",\n          description: `\"${item.name}\" has been cloned successfully.`,\n        });\n        setSelectedItem(null);\n        fetchItems();\n      } else {\n        throw new Error(\"Failed to clone item\");\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to clone item. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleToggleActive = async (item: Item) => {\n    try {\n      const newStatus = item.isActive === false ? true : false;\n      const response = await fetch(`/api/items/${item.id}/status`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ isActive: newStatus }),\n      });\n      if (response.ok) {\n        const updatedItem = await response.json();\n        toast({\n          title: newStatus ? \"Item Activated\" : \"Item Deactivated\",\n          description: `\"${item.name}\" has been marked as ${newStatus ? \"active\" : \"inactive\"}.`,\n        });\n        setSelectedItem(updatedItem);\n        fetchItems();\n      } else {\n        throw new Error(\"Failed to update item status\");\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update item status. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleDeleteItem = (item: Item) => {\n    setItemToDelete(item);\n    setShowDeleteDialog(true);\n  };\n\n  const confirmDelete = async () => {\n    if (!itemToDelete) return;\n    try {\n      const response = await fetch(`/api/items/${itemToDelete.id}`, {\n        method: 'DELETE',\n      });\n      if (response.ok) {\n        toast({\n          title: \"Item Deleted\",\n          description: `\"${itemToDelete.name}\" has been deleted.`,\n        });\n        setSelectedItem(null);\n        setShowDeleteDialog(false);\n        setItemToDelete(null);\n        fetchItems();\n      } else {\n        throw new Error(\"Failed to delete item\");\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete item. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"flex h-[calc(100vh-80px)] animate-in fade-in duration-300\">\n      <div className={`flex-1 flex flex-col overflow-hidden ${selectedItem ? 'border-r border-slate-200' : ''}`}>\n        <div className=\"flex items-center justify-between p-4\">\n          <div className=\"flex items-center gap-2\">\n            <h1 className=\"text-xl font-semibold text-slate-900\">All Items</h1>\n            <ChevronDown className=\"h-4 w-4 text-slate-500\" />\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button \n              onClick={() => setLocation(\"/items/create\")} \n              className=\"bg-blue-600 hover:bg-blue-700 gap-1.5 h-9\"\n            >\n              <Plus className=\"h-4 w-4\" /> New\n            </Button>\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"outline\" size=\"icon\" className=\"h-9 w-9\">\n                  <MoreHorizontal className=\"h-4 w-4\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\" className=\"w-56\">\n                <DropdownMenuSub>\n                  <DropdownMenuSubTrigger>\n                    <ArrowUpDown className=\"mr-2 h-4 w-4\" />\n                    Sort by\n                  </DropdownMenuSubTrigger>\n                  <DropdownMenuSubContent>\n                    <DropdownMenuItem>Name</DropdownMenuItem>\n                    <DropdownMenuItem>Purchase Rate</DropdownMenuItem>\n                    <DropdownMenuItem>Rate</DropdownMenuItem>\n                    <DropdownMenuItem>HSN/SAC</DropdownMenuItem>\n                    <DropdownMenuItem>Last Modified Time</DropdownMenuItem>\n                    <DropdownMenuItem>Created Time</DropdownMenuItem>\n                  </DropdownMenuSubContent>\n                </DropdownMenuSub>\n                <DropdownMenuItem>\n                  <Import className=\"mr-2 h-4 w-4\" />\n                  Import Items\n                </DropdownMenuItem>\n                <DropdownMenuSub>\n                  <DropdownMenuSubTrigger>\n                    <Download className=\"mr-2 h-4 w-4\" />\n                    Export\n                  </DropdownMenuSubTrigger>\n                  <DropdownMenuSubContent>\n                    <DropdownMenuItem>Export as CSV</DropdownMenuItem>\n                    <DropdownMenuItem>Export as Excel</DropdownMenuItem>\n                  </DropdownMenuSubContent>\n                </DropdownMenuSub>\n                <DropdownMenuSeparator />\n                <DropdownMenuItem>\n                  <Settings className=\"mr-2 h-4 w-4\" />\n                  Preferences\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={fetchItems}>\n                  <RefreshCw className=\"mr-2 h-4 w-4\" />\n                  Refresh List\n                </DropdownMenuItem>\n                <DropdownMenuItem>\n                  <RotateCcw className=\"mr-2 h-4 w-4\" />\n                  Reset Column Width\n                </DropdownMenuItem>\n                <DropdownMenuSeparator />\n                <DropdownMenuItem>\n                  <FileText className=\"mr-2 h-4 w-4\" />\n                  Update New GST Rates\n                </DropdownMenuItem>\n                <DropdownMenuItem>\n                  <CheckSquare className=\"mr-2 h-4 w-4\" />\n                  Validate HSN/SAC\n                </DropdownMenuItem>\n                <DropdownMenuItem>\n                  <History className=\"mr-2 h-4 w-4\" />\n                  HSN/SAC Update History\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </div>\n\n        <div className=\"flex-1 overflow-auto border-t border-slate-200\">\n          {loading ? (\n            <div className=\"p-8 text-center text-slate-500\">Loading items...</div>\n          ) : items.length === 0 ? (\n            <div className=\"p-8 text-center text-slate-500\">\n              <p>No items found.</p>\n              <Button \n                onClick={() => setLocation(\"/items/create\")} \n                className=\"mt-4 bg-blue-600 hover:bg-blue-700\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" /> Create your first item\n              </Button>\n            </div>\n          ) : (\n            <table className=\"w-full\">\n              <thead className=\"bg-slate-50 border-b border-slate-200 sticky top-0\">\n                <tr>\n                  <th className=\"w-10 px-4 py-3\">\n                    <Checkbox \n                      checked={selectedItems.length === items.length}\n                      onCheckedChange={toggleSelectAll}\n                    />\n                  </th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-600 uppercase tracking-wider\">\n                    NAME \n                  </th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-600 uppercase tracking-wider\">\n                    PURCHASE DESCRIPTION\n                  </th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-600 uppercase tracking-wider\">\n                    PURCHASE RATE\n                  </th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-600 uppercase tracking-wider\">\n                    DESCRIPTION\n                  </th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-600 uppercase tracking-wider\">\n                    RATE\n                  </th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-600 uppercase tracking-wider\">\n                    HSN/SAC\n                  </th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-600 uppercase tracking-wider\">\n                    USAGE UNIT\n                  </th>\n                </tr>\n              </thead>\n              <tbody className=\"bg-white divide-y divide-slate-100\">\n                {items.map((item) => (\n                  <tr \n                    key={item.id}\n                    className={`hover:bg-slate-50 cursor-pointer transition-colors ${\n                      selectedItem?.id === item.id ? 'bg-blue-50' : ''\n                    }`}\n                    onClick={() => handleItemClick(item)}\n                  >\n                    <td className=\"px-4 py-3\">\n                      <Checkbox \n                        checked={selectedItems.includes(item.id)}\n                        onCheckedChange={() => {}}\n                        onClick={(e) => toggleSelectItem(item.id, e as MouseEvent)}\n                      />\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <div className=\"text-sm font-medium text-blue-600 hover:text-blue-700\">\n                        {item.name}\n                      </div>\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <div className=\"text-sm text-slate-600\">\n                        {item.purchaseDescription || '-'}\n                      </div>\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <div className=\"text-sm text-slate-900\">\n                        {item.purchaseRate ? `${item.purchaseRate}` : '-'}\n                      </div>\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <div className=\"text-sm text-slate-600\">\n                        {item.description || '-'}\n                      </div>\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <div className=\"text-sm text-slate-900\">\n                        {item.rate ? `${item.rate}` : '0.00'}\n                      </div>\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <div className=\"text-sm text-slate-900\">\n                        {item.hsnSac || '-'}\n                      </div>\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <div className=\"text-sm text-slate-600\">\n                        {item.usageUnit || '-'}\n                      </div>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          )}\n        </div>\n      </div>\n\n      {selectedItem && (\n        <div className=\"w-[600px] flex-shrink-0 overflow-hidden\">\n          <ItemDetailPanel \n            item={selectedItem} \n            onClose={handleClosePanel}\n            onEdit={handleEditItem}\n            onClone={handleCloneItem}\n            onToggleActive={handleToggleActive}\n            onDelete={handleDeleteItem}\n          />\n        </div>\n      )}\n\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Item</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete \"{itemToDelete?.name}\"? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel onClick={() => setItemToDelete(null)}>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={confirmDelete}\n              className=\"bg-red-600 hover:bg-red-700\"\n              data-testid=\"button-confirm-delete\"\n            >\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":14905,"size_tokens":null},"client/src/pages/sales-order-create.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Plus, X, Search, Upload, Pencil, ArrowLeft, AlertCircle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { ManageSalespersonsDialog } from \"@/components/ManageSalespersonsDialog\";\nimport { useTransactionBootstrap } from \"@/hooks/use-transaction-bootstrap\";\nimport { formatAddressDisplay } from \"@/lib/customer-snapshot\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Badge } from \"@/components/ui/badge\";\n\ninterface Customer {\n  id: string;\n  name: string;\n  email: string;\n  billingAddress: any;\n  shippingAddress: any;\n}\n\ninterface Item {\n  id: string;\n  name: string;\n  description: string;\n  rate: string;\n  hsnSac: string;\n}\n\ninterface SalesOrderItem {\n  id: string;\n  itemId: string;\n  name: string;\n  description: string;\n  hsnSac: string;\n  quantity: number;\n  unit: string;\n  rate: number;\n  discount: number;\n  discountType: string;\n  tax: string;\n  amount: number;\n}\n\nconst taxOptions = [\n  { value: \"none\", label: \"No Tax\" },\n  { value: \"GST0\", label: \"GST (0%)\" },\n  { value: \"GST5\", label: \"GST (5%)\" },\n  { value: \"GST12\", label: \"GST (12%)\" },\n  { value: \"GST18\", label: \"GST (18%)\" },\n  { value: \"GST28\", label: \"GST (28%)\" },\n];\n\nconst getTaxRate = (taxValue: string): number => {\n  const rates: Record<string, number> = {\n    \"none\": 0,\n    \"GST0\": 0,\n    \"GST5\": 5,\n    \"GST12\": 12,\n    \"GST18\": 18,\n    \"GST28\": 28,\n  };\n  return rates[taxValue] || 0;\n};\n\nconst paymentTermsOptions = [\n  { value: \"due_on_receipt\", label: \"Due on Receipt\" },\n  { value: \"net_15\", label: \"Net 15\" },\n  { value: \"net_30\", label: \"Net 30\" },\n  { value: \"net_45\", label: \"Net 45\" },\n  { value: \"net_60\", label: \"Net 60\" },\n];\n\nconst deliveryMethodOptions = [\n  { value: \"standard\", label: \"Standard Delivery\" },\n  { value: \"express\", label: \"Express Delivery\" },\n  { value: \"pickup\", label: \"Customer Pickup\" },\n];\n\nexport default function SalesOrderCreatePage() {\n  const [location, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  // Transaction bootstrap for auto-population\n  const {\n    customerId: bootstrapCustomerId,\n    customerSnapshot,\n    taxRegime,\n    isLoadingCustomer,\n    customerError,\n    formData: bootstrapFormData,\n    onCustomerChange\n  } = useTransactionBootstrap({ transactionType: 'sales_order' });\n\n  const [customers, setCustomers] = useState<Customer[]>([]);\n  const [customerSearchTerm, setCustomerSearchTerm] = useState(\"\");\n  const [items, setItems] = useState<Item[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [nextOrderNumber, setNextOrderNumber] = useState(\"SO-00001\");\n  const [showManageSalespersons, setShowManageSalespersons] = useState(false);\n  const [salespersons, setSalespersons] = useState<{ id: string; name: string }[]>([]);\n  const [customerIdFromUrl, setCustomerIdFromUrl] = useState<string | null>(null);\n\n  const [formData, setFormData] = useState({\n    customerId: \"\",\n    customerName: \"\",\n    salesOrderNumber: \"\",\n    referenceNumber: \"\",\n    orderDate: new Date().toISOString().split('T')[0],\n    expectedShipmentDate: \"\",\n    paymentTerms: \"due_on_receipt\",\n    deliveryMethod: \"standard\",\n    salesperson: \"\",\n    placeOfSupply: \"\",\n    customerNotes: \"Looking forward to your business.\",\n    termsAndConditions: \"\",\n    shippingCharges: 0,\n    adjustment: 0,\n    adjustmentDescription: \"\",\n  });\n\n  // Sync with bootstrap customer\n  useEffect(() => {\n    if (bootstrapCustomerId && !formData.customerId) {\n      setFormData(prev => ({ ...prev, customerId: bootstrapCustomerId }));\n    }\n  }, [bootstrapCustomerId]);\n\n  // Update form data when customer snapshot changes\n  useEffect(() => {\n    if (customerSnapshot) {\n      setFormData(prev => ({\n        ...prev,\n        customerName: customerSnapshot.displayName || customerSnapshot.customerName,\n        placeOfSupply: customerSnapshot.placeOfSupply || prev.placeOfSupply,\n        paymentTerms: customerSnapshot.paymentTerms ?\n          (customerSnapshot.paymentTerms.toLowerCase().includes('15') ? 'net_15' :\n            customerSnapshot.paymentTerms.toLowerCase().includes('30') ? 'net_30' :\n              customerSnapshot.paymentTerms.toLowerCase().includes('45') ? 'net_45' :\n                customerSnapshot.paymentTerms.toLowerCase().includes('60') ? 'net_60' : 'due_on_receipt')\n          : prev.paymentTerms\n      }));\n    }\n  }, [customerSnapshot]);\n\n  const [orderItems, setOrderItems] = useState<SalesOrderItem[]>([\n    {\n      id: \"1\",\n      itemId: \"\",\n      name: \"\",\n      description: \"\",\n      hsnSac: \"\",\n      quantity: 1,\n      unit: \"pcs\",\n      rate: 0,\n      discount: 0,\n      discountType: \"percentage\",\n      tax: \"none\",\n      amount: 0,\n    }\n  ]);\n\n  useEffect(() => {\n    fetchCustomers();\n    fetchItems();\n    fetchNextOrderNumber();\n    fetchSalespersons();\n\n    // Parse customerId from URL\n    const params = new URLSearchParams(location.split('?')[1]);\n    const urlCustomerId = params.get('customerId');\n    if (urlCustomerId) {\n      setCustomerIdFromUrl(urlCustomerId);\n    }\n  }, [location]);\n\n  // Set customer from URL after customers are loaded\n  useEffect(() => {\n    if (customerIdFromUrl && customers.length > 0) {\n      const customer = customers.find(c => c.id === customerIdFromUrl);\n      if (customer) {\n        setFormData(prev => ({\n          ...prev,\n          customerId: customer.id,\n          customerName: customer.name\n        }));\n        setCustomerIdFromUrl(null);\n      }\n    }\n  }, [customerIdFromUrl, customers]);\n\n  const fetchSalespersons = async () => {\n    try {\n      const response = await fetch('/api/salespersons');\n      if (response.ok) {\n        const data = await response.json();\n        setSalespersons(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch salespersons:', error);\n    }\n  };\n\n  const fetchCustomers = async () => {\n    try {\n      const response = await fetch('/api/customers');\n      if (response.ok) {\n        const data = await response.json();\n        setCustomers(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch customers:', error);\n    }\n  };\n\n  const fetchItems = async () => {\n    try {\n      const response = await fetch('/api/items');\n      if (response.ok) {\n        const data = await response.json();\n        setItems(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch items:', error);\n    }\n  };\n\n  const fetchNextOrderNumber = async () => {\n    try {\n      const response = await fetch('/api/sales-orders/next-number');\n      if (response.ok) {\n        const data = await response.json();\n        const orderNumber = data.data?.salesOrderNumber || \"SO-00001\";\n        setNextOrderNumber(orderNumber);\n        setFormData(prev => ({ ...prev, salesOrderNumber: orderNumber }));\n      }\n    } catch (error) {\n      console.error('Failed to fetch next order number:', error);\n    }\n  };\n\n  const filteredCustomers = customers.filter(customer => {\n    const customerName = customer.name || \"\";\n    return customerName.toLowerCase().includes(customerSearchTerm.toLowerCase());\n  });\n\n  const handleCustomerChange = (customerId: string) => {\n    if (customerId === \"__add_new_customer__\") {\n      setLocation(\"/customers/new\");\n      return;\n    }\n\n    const customer = customers.find(c => c.id === customerId);\n    if (customer) {\n      setFormData(prev => ({\n        ...prev,\n        customerId,\n        customerName: customer.name\n      }));\n    }\n  };\n\n  const handleItemChange = (index: number, itemId: string) => {\n    const item = items.find(i => i.id === itemId);\n    if (item) {\n      const updatedItems = [...orderItems];\n      const rate = parseFloat(item.rate.replace(/[,]/g, '')) || 0;\n      updatedItems[index] = {\n        ...updatedItems[index],\n        itemId,\n        name: item.name,\n        description: item.description || '',\n        hsnSac: item.hsnSac || '',\n        rate,\n        amount: rate * updatedItems[index].quantity\n      };\n      setOrderItems(updatedItems);\n    }\n  };\n\n  const updateOrderItem = (index: number, field: string, value: any) => {\n    const updatedItems = [...orderItems];\n    updatedItems[index] = { ...updatedItems[index], [field]: value };\n\n    const quantity = updatedItems[index].quantity;\n    const rate = updatedItems[index].rate;\n    const discount = updatedItems[index].discount;\n    const discountType = updatedItems[index].discountType;\n\n    let subtotal = quantity * rate;\n    if (discountType === 'percentage') {\n      subtotal = subtotal - (subtotal * discount / 100);\n    } else {\n      subtotal = subtotal - discount;\n    }\n\n    updatedItems[index].amount = Math.max(0, subtotal);\n    setOrderItems(updatedItems);\n  };\n\n  const addNewRow = () => {\n    setOrderItems([\n      ...orderItems,\n      {\n        id: String(Date.now()),\n        itemId: \"\",\n        name: \"\",\n        description: \"\",\n        hsnSac: \"\",\n        quantity: 1,\n        unit: \"pcs\",\n        rate: 0,\n        discount: 0,\n        discountType: \"percentage\",\n        tax: \"none\",\n        amount: 0,\n      }\n    ]);\n  };\n\n  const removeRow = (index: number) => {\n    if (orderItems.length > 1) {\n      setOrderItems(orderItems.filter((_, i) => i !== index));\n    }\n  };\n\n  const calculateSubTotal = () => {\n    return orderItems.reduce((sum, item) => sum + item.amount, 0);\n  };\n\n  const calculateTax = () => {\n    return orderItems.reduce((sum, item) => {\n      const taxRate = getTaxRate(item.tax);\n      return sum + (item.amount * taxRate / 100);\n    }, 0);\n  };\n\n  const calculateTotal = () => {\n    const subTotal = calculateSubTotal();\n    const tax = calculateTax();\n    const shipping = formData.shippingCharges || 0;\n    const adjustment = formData.adjustment || 0;\n    return subTotal + tax + shipping + adjustment;\n  };\n\n  const handleSubmit = async (status: string) => {\n    if (!formData.customerId) {\n      toast({ title: \"Please select a customer\", variant: \"destructive\" });\n      return;\n    }\n\n    const validItems = orderItems.filter(item => item.itemId);\n    if (validItems.length === 0) {\n      toast({ title: \"Please add at least one item\", variant: \"destructive\" });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const subTotal = calculateSubTotal();\n      const taxAmount = calculateTax();\n\n      const customer = customers.find(c => c.id === formData.customerId);\n      const customerState = customer?.billingAddress?.state?.toLowerCase() || '';\n      const supplyState = formData.placeOfSupply?.toLowerCase() || '';\n      const isInterState = customerState && supplyState && customerState !== supplyState;\n\n      const orderData = {\n        salesOrderNumber: formData.salesOrderNumber || nextOrderNumber,\n        customerId: formData.customerId,\n        customerName: formData.customerName,\n        referenceNumber: formData.referenceNumber,\n        date: formData.orderDate,\n        expectedShipmentDate: formData.expectedShipmentDate,\n        paymentTerms: paymentTermsOptions.find(p => p.value === formData.paymentTerms)?.label || \"Due on Receipt\",\n        deliveryMethod: deliveryMethodOptions.find(d => d.value === formData.deliveryMethod)?.label || \"Standard Delivery\",\n        salesperson: formData.salesperson,\n        placeOfSupply: formData.placeOfSupply,\n        billingAddress: customer?.billingAddress || { street: \"\", city: \"\", state: \"\", country: \"\", pincode: \"\" },\n        shippingAddress: customer?.shippingAddress || { street: \"\", city: \"\", state: \"\", country: \"\", pincode: \"\" },\n        items: validItems.map(item => ({\n          id: item.id,\n          itemId: item.itemId,\n          name: item.name,\n          description: item.description,\n          hsnSac: item.hsnSac,\n          quantity: item.quantity,\n          unit: item.unit,\n          rate: item.rate,\n          discount: item.discount,\n          discountType: item.discountType,\n          tax: getTaxRate(item.tax),\n          taxName: item.tax,\n          amount: item.amount,\n          ordered: item.quantity,\n          invoicedQty: 0,\n          invoiceStatus: \"Not Invoiced\"\n        })),\n        subTotal,\n        shippingCharges: formData.shippingCharges,\n        cgst: isInterState ? 0 : taxAmount / 2,\n        sgst: isInterState ? 0 : taxAmount / 2,\n        igst: isInterState ? taxAmount : 0,\n        adjustment: formData.adjustment,\n        total: calculateTotal(),\n        customerNotes: formData.customerNotes,\n        termsAndConditions: formData.termsAndConditions,\n        orderStatus: status === 'draft' ? 'Draft' : 'Confirmed',\n        invoiceStatus: \"Not Invoiced\",\n        paymentStatus: \"Unpaid\",\n        shipmentStatus: \"Pending\",\n        invoices: [],\n        createdBy: \"Admin User\"\n      };\n\n      const response = await fetch('/api/sales-orders', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(orderData)\n      });\n\n      if (response.ok) {\n        toast({ title: `Sales order ${status === 'draft' ? 'saved as draft' : 'created'} successfully` });\n        setLocation('/sales-orders');\n      } else {\n        toast({ title: \"Failed to create sales order\", variant: \"destructive\" });\n      }\n    } catch (error) {\n      console.error('Error creating sales order:', error);\n      toast({ title: \"Error creating sales order\", variant: \"destructive\" });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const formatCurrency = (amount: number) => {\n    return amount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n  };\n\n  return (\n    <div className=\"max-w-5xl mx-auto py-6 animate-in fade-in duration-300\">\n      <div className=\"flex items-center gap-4 mb-6\">\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          onClick={() => setLocation('/sales-orders')}\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"h-4 w-4\" />\n        </Button>\n        <h1 className=\"text-2xl font-semibold text-slate-900 dark:text-white\">New Sales Order</h1>\n      </div>\n\n      <div className=\"space-y-6\">\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-red-600\">Customer Name*</Label>\n            <Select value={formData.customerId} onValueChange={handleCustomerChange}>\n              <SelectTrigger className=\"bg-blue-50 dark:bg-blue-950 border-blue-200 dark:border-blue-800\" data-testid=\"select-customer\">\n                <SelectValue placeholder=\"Select or add a customer\" />\n              </SelectTrigger>\n              <SelectContent>\n                <div className=\"p-2\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <Search className=\"h-4 w-4 text-gray-400\" />\n                    <Input\n                      placeholder=\"Search customers...\"\n                      className=\"h-8\"\n                      value={customerSearchTerm}\n                      onChange={(e) => setCustomerSearchTerm(e.target.value)}\n                    />\n                  </div>\n                </div>\n                {filteredCustomers.map(customer => (\n                  <SelectItem key={customer.id} value={customer.id} data-testid={`option-customer-${customer.id}`}>\n                    {customer.name}\n                  </SelectItem>\n                ))}\n                <div className=\"border-t mt-1 pt-1\">\n                  <SelectItem value=\"__add_new_customer__\">\n                    <div className=\"flex items-center gap-2 text-blue-600\">\n                      <Plus className=\"h-4 w-4\" />\n                      Add New Customer\n                    </div>\n                  </SelectItem>\n                </div>\n              </SelectContent>\n            </Select>\n          </div>\n          <div className=\"flex justify-end\">\n            <Button variant=\"outline\" size=\"icon\" data-testid=\"button-search-customer\">\n              <Search className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-red-600\">Sales Order#*</Label>\n            <div className=\"flex gap-2\">\n              <Input\n                value={formData.salesOrderNumber || nextOrderNumber}\n                onChange={(e) => setFormData(prev => ({ ...prev, salesOrderNumber: e.target.value }))}\n                className=\"flex-1\"\n                data-testid=\"input-order-number\"\n              />\n              <Button variant=\"outline\" size=\"icon\" data-testid=\"button-edit-order-number\">\n                <Pencil className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Reference#</Label>\n            <Input\n              value={formData.referenceNumber}\n              onChange={(e) => setFormData(prev => ({ ...prev, referenceNumber: e.target.value }))}\n              data-testid=\"input-reference-number\"\n            />\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-red-600\">Sales Order Date*</Label>\n            <Input\n              type=\"date\"\n              value={formData.orderDate}\n              onChange={(e) => setFormData(prev => ({ ...prev, orderDate: e.target.value }))}\n              data-testid=\"input-order-date\"\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Expected Shipment Date</Label>\n            <Input\n              type=\"date\"\n              value={formData.expectedShipmentDate}\n              onChange={(e) => setFormData(prev => ({ ...prev, expectedShipmentDate: e.target.value }))}\n              data-testid=\"input-shipment-date\"\n            />\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-2\">\n            <Label>Payment Terms</Label>\n            <Select value={formData.paymentTerms} onValueChange={(v) => setFormData(prev => ({ ...prev, paymentTerms: v }))}>\n              <SelectTrigger data-testid=\"select-payment-terms\">\n                <SelectValue placeholder=\"Select payment terms\" />\n              </SelectTrigger>\n              <SelectContent>\n                {paymentTermsOptions.map(option => (\n                  <SelectItem key={option.value} value={option.value}>{option.label}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Delivery Method</Label>\n            <Select value={formData.deliveryMethod} onValueChange={(v) => setFormData(prev => ({ ...prev, deliveryMethod: v }))}>\n              <SelectTrigger data-testid=\"select-delivery-method\">\n                <SelectValue placeholder=\"Select delivery method\" />\n              </SelectTrigger>\n              <SelectContent>\n                {deliveryMethodOptions.map(option => (\n                  <SelectItem key={option.value} value={option.value}>{option.label}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-2\">\n            <Label>Salesperson</Label>\n            <Select value={formData.salesperson} onValueChange={(v) => {\n              if (v === \"manage_salespersons\") {\n                setShowManageSalespersons(true);\n              } else {\n                setFormData(prev => ({ ...prev, salesperson: v }));\n              }\n            }}>\n              <SelectTrigger data-testid=\"select-salesperson\">\n                <SelectValue placeholder=\"Select or Add Salesperson\" />\n              </SelectTrigger>\n              <SelectContent>\n                <div className=\"p-2\">\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\n                    <Input placeholder=\"Search\" className=\"pl-8 h-9\" />\n                  </div>\n                </div>\n                {salespersons.map(sp => (\n                  <SelectItem key={sp.id} value={sp.name}>{sp.name}</SelectItem>\n                ))}\n                <div\n                  className=\"flex items-center gap-2 p-2 text-sm text-blue-600 cursor-pointer hover:bg-slate-100 border-t mt-1\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    setShowManageSalespersons(true);\n                  }}\n                >\n                  <Plus className=\"h-4 w-4\" />\n                  Manage Salespersons\n                </div>\n              </SelectContent>\n            </Select>\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Place of Supply</Label>\n            <Select value={formData.placeOfSupply} onValueChange={(v) => setFormData(prev => ({ ...prev, placeOfSupply: v }))}>\n              <SelectTrigger data-testid=\"select-place-of-supply\">\n                <SelectValue placeholder=\"Select place of supply\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"maharashtra\">Maharashtra</SelectItem>\n                <SelectItem value=\"gujarat\">Gujarat</SelectItem>\n                <SelectItem value=\"karnataka\">Karnataka</SelectItem>\n                <SelectItem value=\"delhi\">Delhi</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        <div className=\"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden\">\n          <div className=\"bg-slate-50 dark:bg-slate-800 px-4 py-2 font-medium text-sm text-slate-700 dark:text-slate-300\">\n            Item Table\n          </div>\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead className=\"bg-slate-50 dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700\">\n                <tr>\n                  <th className=\"px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase w-8\"></th>\n                  <th className=\"px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase\">Item Details</th>\n                  <th className=\"px-4 py-2 text-center text-xs font-medium text-slate-500 uppercase w-24\">Quantity</th>\n                  <th className=\"px-4 py-2 text-right text-xs font-medium text-slate-500 uppercase w-28\">Rate ()</th>\n                  <th className=\"px-4 py-2 text-center text-xs font-medium text-slate-500 uppercase w-28\">Discount</th>\n                  <th className=\"px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase w-32\">Tax</th>\n                  <th className=\"px-4 py-2 text-right text-xs font-medium text-slate-500 uppercase w-28\">Amount</th>\n                  <th className=\"px-4 py-2 w-10\"></th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-slate-100 dark:divide-slate-700\">\n                {orderItems.map((item, index) => (\n                  <tr key={item.id} data-testid={`row-item-${index}`}>\n                    <td className=\"px-4 py-2 text-slate-400\">::</td>\n                    <td className=\"px-4 py-2\">\n                      <Select value={item.itemId} onValueChange={(v) => handleItemChange(index, v)}>\n                        <SelectTrigger className=\"border-dashed\" data-testid={`select-item-${index}`}>\n                          <SelectValue placeholder=\"Type or click to select an item.\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {items.map(i => (\n                            <SelectItem key={i.id} value={i.id}>{i.name}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <Input\n                        type=\"number\"\n                        min=\"1\"\n                        value={item.quantity}\n                        onChange={(e) => updateOrderItem(index, 'quantity', parseFloat(e.target.value) || 1)}\n                        className=\"text-center\"\n                        data-testid={`input-quantity-${index}`}\n                      />\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <Input\n                        type=\"number\"\n                        min=\"0\"\n                        step=\"0.01\"\n                        value={item.rate}\n                        onChange={(e) => updateOrderItem(index, 'rate', parseFloat(e.target.value) || 0)}\n                        className=\"text-right\"\n                        data-testid={`input-rate-${index}`}\n                      />\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <div className=\"flex items-center gap-1\">\n                        <Input\n                          type=\"number\"\n                          min=\"0\"\n                          value={item.discount}\n                          onChange={(e) => updateOrderItem(index, 'discount', parseFloat(e.target.value) || 0)}\n                          className=\"w-16 text-center\"\n                          data-testid={`input-discount-${index}`}\n                        />\n                        <Select\n                          value={item.discountType}\n                          onValueChange={(v) => updateOrderItem(index, 'discountType', v)}\n                        >\n                          <SelectTrigger className=\"w-14\" data-testid={`select-discount-type-${index}`}>\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"percentage\">%</SelectItem>\n                            <SelectItem value=\"amount\"></SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <Select value={item.tax} onValueChange={(v) => updateOrderItem(index, 'tax', v)}>\n                        <SelectTrigger data-testid={`select-tax-${index}`}>\n                          <SelectValue placeholder=\"Select a Tax\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {taxOptions.map(tax => (\n                            <SelectItem key={tax.value} value={tax.value}>{tax.label}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </td>\n                    <td className=\"px-4 py-2 text-right font-medium text-slate-900 dark:text-white\">\n                      {formatCurrency(item.amount)}\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"text-red-500\"\n                        onClick={() => removeRow(index)}\n                        data-testid={`button-remove-item-${index}`}\n                      >\n                        <X className=\"h-4 w-4\" />\n                      </Button>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n          <div className=\"px-4 py-3 flex gap-4 border-t border-slate-200 dark:border-slate-700\">\n            <Button variant=\"link\" className=\"text-blue-600 p-0 h-auto\" onClick={addNewRow} data-testid=\"button-add-row\">\n              <Plus className=\"h-4 w-4 mr-1\" />\n              Add New Row\n            </Button>\n            <Button variant=\"link\" className=\"text-blue-600 p-0 h-auto\" data-testid=\"button-add-bulk\">\n              <Plus className=\"h-4 w-4 mr-1\" />\n              Add Items in Bulk\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-8\">\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label>Customer Notes</Label>\n              <Textarea\n                value={formData.customerNotes}\n                onChange={(e) => setFormData(prev => ({ ...prev, customerNotes: e.target.value }))}\n                placeholder=\"Looking forward for your business.\"\n                className=\"min-h-20\"\n                data-testid=\"textarea-customer-notes\"\n              />\n            </div>\n          </div>\n\n          <div className=\"space-y-3\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-slate-600 dark:text-slate-400\">Sub Total</span>\n              <span className=\"font-medium text-slate-900 dark:text-white\" data-testid=\"text-subtotal\">{formatCurrency(calculateSubTotal())}</span>\n            </div>\n            <div className=\"flex justify-between items-center gap-2\">\n              <span className=\"text-slate-600 dark:text-slate-400\">Shipping Charges</span>\n              <Input\n                type=\"number\"\n                min=\"0\"\n                step=\"0.01\"\n                value={formData.shippingCharges}\n                onChange={(e) => setFormData(prev => ({ ...prev, shippingCharges: parseFloat(e.target.value) || 0 }))}\n                className=\"w-32 text-right\"\n                data-testid=\"input-shipping-charges\"\n              />\n            </div>\n            <div className=\"flex justify-between items-center gap-2\">\n              <div className=\"flex items-center gap-2\">\n                <Checkbox id=\"tds\" data-testid=\"checkbox-tds\" />\n                <Label htmlFor=\"tds\" className=\"text-slate-600 dark:text-slate-400\">TDS</Label>\n                <Checkbox id=\"tcs\" data-testid=\"checkbox-tcs\" />\n                <Label htmlFor=\"tcs\" className=\"text-slate-600 dark:text-slate-400\">TCS</Label>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Select>\n                  <SelectTrigger className=\"w-32\" data-testid=\"select-tds-tcs\">\n                    <SelectValue placeholder=\"Select a Tax\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"none\">None</SelectItem>\n                  </SelectContent>\n                </Select>\n                <span className=\"text-slate-500\">- 0.00</span>\n              </div>\n            </div>\n            <div className=\"flex justify-between items-center gap-2\">\n              <span className=\"text-slate-600 dark:text-slate-400\">Adjustment</span>\n              <Input\n                type=\"number\"\n                step=\"0.01\"\n                value={formData.adjustment}\n                onChange={(e) => setFormData(prev => ({ ...prev, adjustment: parseFloat(e.target.value) || 0 }))}\n                className=\"w-32 text-right\"\n                data-testid=\"input-adjustment\"\n              />\n            </div>\n            <div className=\"flex justify-between items-center pt-3 border-t border-slate-200 dark:border-slate-700\">\n              <span className=\"font-semibold text-slate-900 dark:text-white\">Total (  )</span>\n              <span className=\"font-bold text-lg text-slate-900 dark:text-white\" data-testid=\"text-total\">{formatCurrency(calculateTotal())}</span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"border-t border-slate-200 dark:border-slate-700 pt-6\">\n          <div className=\"grid grid-cols-2 gap-8\">\n            <div className=\"space-y-2\">\n              <Label>Terms & Conditions</Label>\n              <Textarea\n                value={formData.termsAndConditions}\n                onChange={(e) => setFormData(prev => ({ ...prev, termsAndConditions: e.target.value }))}\n                placeholder=\"Enter the terms and conditions of your business to be displayed in your transaction\"\n                className=\"min-h-[100px]\"\n                data-testid=\"textarea-terms\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Attach File(s) to Sales Order</Label>\n              <div className=\"border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-lg p-4 text-center\">\n                <Button variant=\"outline\" className=\"gap-2\" data-testid=\"button-upload-file\">\n                  <Upload className=\"h-4 w-4\" />\n                  Upload File\n                </Button>\n                <p className=\"text-xs text-slate-500 mt-2\">You can upload a maximum of 5 files, 10MB each</p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-3 pt-4 border-t border-slate-200 dark:border-slate-700\">\n          <Button\n            variant=\"outline\"\n            onClick={() => handleSubmit('draft')}\n            disabled={loading}\n            data-testid=\"button-save-draft\"\n          >\n            Save as Draft\n          </Button>\n          <Button\n            onClick={() => handleSubmit('confirmed')}\n            disabled={loading}\n            data-testid=\"button-save-send\"\n          >\n            {loading ? 'Saving...' : 'Save and Send'}\n          </Button>\n          <Button\n            variant=\"ghost\"\n            onClick={() => setLocation('/sales-orders')}\n            data-testid=\"button-cancel\"\n          >\n            Cancel\n          </Button>\n        </div>\n      </div>\n\n      <ManageSalespersonsDialog\n        open={showManageSalespersons}\n        onOpenChange={setShowManageSalespersons}\n        onSalespersonChange={fetchSalespersons}\n      />\n    </div >\n  );\n}\n","path":null,"size_bytes":34035,"size_tokens":null},"client/src/shared/components/ConfirmDialog.tsx":{"content":"import {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from '@/components/ui/alert-dialog';\n\ninterface ConfirmDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  title: string;\n  description?: string;\n  confirmLabel?: string;\n  cancelLabel?: string;\n  onConfirm: () => void;\n  variant?: 'default' | 'destructive';\n}\n\nexport const ConfirmDialog = ({\n  open,\n  onOpenChange,\n  title,\n  description,\n  confirmLabel = 'Confirm',\n  cancelLabel = 'Cancel',\n  onConfirm,\n  variant = 'default',\n}: ConfirmDialogProps) => {\n  return (\n    <AlertDialog open={open} onOpenChange={onOpenChange}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>{title}</AlertDialogTitle>\n          {description && (\n            <AlertDialogDescription>{description}</AlertDialogDescription>\n          )}\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel>{cancelLabel}</AlertDialogCancel>\n          <AlertDialogAction\n            onClick={onConfirm}\n            className={\n              variant === 'destructive'\n                ? 'bg-red-600 hover:bg-red-700'\n                : ''\n            }\n          >\n            {confirmLabel}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n};\n\nexport default ConfirmDialog;\n","path":null,"size_bytes":1468,"size_tokens":null},"client/src/pages/expenses.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport {\n  Plus,\n  Search,\n  MoreHorizontal,\n  Receipt,\n  Upload,\n  Download,\n  Settings,\n  RefreshCw,\n  ChevronDown,\n  X,\n  Calendar,\n  Inbox,\n  FileText,\n  Tag,\n  Car,\n  Check\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { AccountSelectDropdown, getAccountLabel } from \"@/components/AccountSelectDropdown\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { usePagination } from \"@/hooks/use-pagination\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { format } from \"date-fns\";\nimport ExpenseDetailPanel from \"@/modules/expenses/components/ExpenseDetailPanel\";\nimport { TablePagination } from \"@/components/table-pagination\";\n\ninterface Expense {\n  id: string;\n  expenseNumber: string;\n  date: string;\n  expenseAccount: string;\n  amount: number;\n  currency: string;\n  paidThrough: string;\n  expenseType: string;\n  sac: string;\n  vendorId: string;\n  vendorName: string;\n  gstTreatment: string;\n  sourceOfSupply: string;\n  destinationOfSupply: string;\n  reverseCharge: boolean;\n  tax: string;\n  taxAmount: number;\n  amountIs: string;\n  invoiceNumber: string;\n  notes: string;\n  customerId: string;\n  customerName: string;\n  reportingTags: string[];\n  isBillable: boolean;\n  status: string;\n  attachments: string[];\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface MileageSettings {\n  associateEmployeesToExpenses: boolean;\n  defaultMileageCategory: string;\n  defaultUnit: string;\n  mileageRates: Array<{\n    id: string;\n    startDate: string;\n    rate: number;\n    currency: string;\n  }>;\n}\n\ninterface Vendor {\n  id: string;\n  name: string;\n  displayName: string;\n}\n\ninterface Customer {\n  id: string;\n  name: string;\n  displayName: string;\n}\n\nconst INDIAN_STATES = [\n  \"Andhra Pradesh\", \"Arunachal Pradesh\", \"Assam\", \"Bihar\", \"Chhattisgarh\",\n  \"Goa\", \"Gujarat\", \"Haryana\", \"Himachal Pradesh\", \"Jharkhand\", \"Karnataka\",\n  \"Kerala\", \"Madhya Pradesh\", \"Maharashtra\", \"Manipur\", \"Meghalaya\", \"Mizoram\",\n  \"Nagaland\", \"Odisha\", \"Punjab\", \"Rajasthan\", \"Sikkim\", \"Tamil Nadu\",\n  \"Telangana\", \"Tripura\", \"Uttar Pradesh\", \"Uttarakhand\", \"West Bengal\",\n  \"Delhi\", \"Jammu and Kashmir\", \"Ladakh\", \"Puducherry\", \"Chandigarh\",\n  \"Dadra and Nagar Haveli\", \"Daman and Diu\", \"Lakshadweep\", \"Andaman and Nicobar\"\n];\n\nconst EXPENSE_ACCOUNTS = [\n  \"Cost Of Goods Sold\",\n  \"Cost of Goods Sold\",\n  \"Job Costing\",\n  \"Labor\",\n  \"Materials\",\n  \"Subcontractor\",\n  \"Expense\",\n  \"Advertising And Marketing\",\n  \"Automobile Expense\",\n  \"Bad Debt\",\n  \"Bank Fees and Charges\",\n  \"Consultant Expense\",\n  \"Contract Assets\",\n  \"Credit Card Charges\",\n  \"Depreciation And Amortisation\",\n  \"Depreciation Expense\",\n  \"IT and Internet Expenses\",\n  \"Janitorial Expense\",\n  \"Lodging\",\n  \"Meals and Entertainment\",\n  \"Merchandise\",\n  \"Office Supplies\",\n  \"Other Expenses\",\n  \"Postage\",\n  \"Printing and Stationery\",\n  \"Purchase Discounts\",\n  \"Raw Materials And Consumables\",\n  \"Rent Expense\",\n  \"Repairs and Maintenance\",\n  \"Salaries and Employee Wages\",\n  \"Telephone Expense\",\n  \"Transportation Expense\",\n  \"Travel Expense\",\n  \"Non Current Liability\",\n  \"Construction Loans\",\n  \"Mortgages\",\n  \"Other Current Liability\",\n  \"Employee Reimbursements\",\n  \"GST Payable\",\n  \"Output CGST\",\n  \"Output IGST\",\n  \"Output SGST\",\n  \"Tax Payable\",\n  \"TDS Payable\",\n  \"Fixed Asset\",\n  \"Furniture and Equipment\",\n  \"Other Current Asset\",\n  \"Advance Tax\",\n  \"Employee Advance\",\n  \"Input Tax Credits\",\n  \"Input CGST\",\n  \"Input IGST\",\n  \"Input SGST\",\n  \"Prepaid Expenses\",\n  \"TDS Receivable\"\n];\n\nconst PAID_THROUGH_ACCOUNTS = [\n  \"Cash\",\n  \"Petty Cash\",\n  \"Undeposited Funds\",\n  \"Other Current Asset\",\n  \"Advance Tax\",\n  \"Employee Advance\",\n  \"Input Tax Credits\",\n  \"Input CGST\",\n  \"Input IGST\",\n  \"Input SGST\",\n  \"Prepaid Expenses\",\n  \"Reverse Charge Tax Input but not due\",\n  \"TDS Receivable\",\n  \"Fixed Asset\",\n  \"Furniture and Equipment\",\n  \"Other Current Liability\",\n  \"Employee Reimbursements\",\n  \"GST Payable\",\n  \"Output CGST\",\n  \"Output IGST\",\n  \"Output SGST\",\n  \"TDS Payable\",\n  \"Non Current Liability\",\n  \"Construction Loans\",\n  \"Mortgages\",\n  \"Equity\",\n  \"Capital Stock\",\n  \"Distributions\",\n  \"Dividends Paid\",\n  \"Drawings\",\n  \"Investments\",\n  \"Opening Balance Offset\",\n  \"Owner's Equity\"\n];\n\nconst TAX_OPTIONS = [\n  { value: \"gst_5\", label: \"GST 5%\", rate: 5 },\n  { value: \"gst_12\", label: \"GST 12%\", rate: 12 },\n  { value: \"gst_18\", label: \"GST 18%\", rate: 18 },\n  { value: \"gst_28\", label: \"GST 28%\", rate: 28 },\n  { value: \"igst_5\", label: \"IGST 5%\", rate: 5 },\n  { value: \"igst_12\", label: \"IGST 12%\", rate: 12 },\n  { value: \"igst_18\", label: \"IGST 18%\", rate: 18 },\n  { value: \"igst_28\", label: \"IGST 28%\", rate: 28 },\n  { value: \"exempt\", label: \"Exempt\", rate: 0 },\n  { value: \"none\", label: \"None\", rate: 0 },\n];\n\nconst GST_TREATMENTS = [\n  \"Registered Business - Regular\",\n  \"Registered Business - Composition\",\n  \"Unregistered Business\",\n  \"Consumer\",\n  \"Overseas\",\n  \"Special Economic Zone\",\n  \"Deemed Export\"\n];\n\nexport default function Expenses() {\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState(\"all-expenses\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [sortBy, setSortBy] = useState(\"createdTime\");\n  const [showRecordExpense, setShowRecordExpense] = useState(false);\n  const [showImportDialog, setShowImportDialog] = useState(false);\n  const [showMileageSettings, setShowMileageSettings] = useState(false);\n  const [expenseTab, setExpenseTab] = useState(\"record-expense\");\n  const [selectedExpense, setSelectedExpense] = useState<Expense | null>(null);\n  const [isEditMode, setIsEditMode] = useState(false);\n  const [editingExpenseId, setEditingExpenseId] = useState<string | null>(null);\n  const [expenseAccountOpen, setExpenseAccountOpen] = useState(false);\n  const [paidThroughOpen, setPaidThroughOpen] = useState(false);\n  const [gstTreatmentOpen, setGstTreatmentOpen] = useState(false);\n  const [sourceOfSupplyOpen, setSourceOfSupplyOpen] = useState(false);\n  const [destinationOfSupplyOpen, setDestinationOfSupplyOpen] = useState(false);\n  const [showCreateExpenseAccountDialog, setShowCreateExpenseAccountDialog] = useState(false);\n  const [showCreatePaidThroughDialog, setShowCreatePaidThroughDialog] = useState(false);\n  const [newExpenseAccountName, setNewExpenseAccountName] = useState(\"\");\n  const [newPaidThroughName, setNewPaidThroughName] = useState(\"\");\n\n  const [expenseForm, setExpenseForm] = useState({\n    date: format(new Date(), 'yyyy-MM-dd'),\n    expenseAccount: \"\",\n    amount: \"\",\n    currency: \"INR\",\n    paidThrough: \"\",\n    expenseType: \"services\",\n    hsn: \"\",\n    sac: \"\",\n    vendorId: \"\",\n    vendorName: \"\",\n    gstTreatment: \"\",\n    sourceOfSupply: \"\",\n    destinationOfSupply: \"[MH] - Maharashtra\",\n    reverseCharge: false,\n    tax: \"\",\n    amountIs: \"tax_exclusive\",\n    invoiceNumber: \"\",\n    notes: \"\",\n    customerId: \"\",\n    customerName: \"\",\n    reportingTags: [] as string[],\n  });\n\n  const [mileageForm, setMileageForm] = useState({\n    date: format(new Date(), 'yyyy-MM-dd'),\n    employee: \"\",\n    calculationMethod: \"distance_travelled\",\n    distance: \"\",\n    unit: \"km\",\n    startOdometer: \"\",\n    endOdometer: \"\",\n    amount: \"\",\n    currency: \"INR\",\n    paidThrough: \"\",\n    vendorId: \"\",\n    vendorName: \"\",\n    invoiceNumber: \"\",\n    notes: \"\",\n    customerId: \"\",\n    customerName: \"\",\n    reportingTags: [] as string[],\n  });\n\n  const [mileageSettingsForm, setMileageSettingsForm] = useState({\n    associateEmployeesToExpenses: false,\n    defaultMileageCategory: \"Fuel/Mileage Expense\",\n    defaultUnit: \"km\",\n    newRateDate: \"\",\n    newRateValue: \"\",\n  });\n\n  const { data: expensesData, isLoading } = useQuery<{ success: boolean; data: Expense[] }>({\n    queryKey: ['/api/expenses'],\n  });\n\n  const { data: vendorsData } = useQuery<{ success: boolean; data: Vendor[] }>({\n    queryKey: ['/api/vendors'],\n  });\n\n  const { data: customersData } = useQuery<{ success: boolean; data: Customer[] }>({\n    queryKey: ['/api/customers'],\n  });\n\n  const { data: mileageSettingsData } = useQuery<{ success: boolean; data: MileageSettings }>({\n    queryKey: ['/api/mileage-settings'],\n  });\n\n  // Read vendorId from URL params (when navigating from vendor page)\n  const urlParams = new URLSearchParams(window.location.search);\n  const vendorIdFromUrl = urlParams.get('vendorId');\n\n  // Pre-fill vendor data when coming from vendor page\n  useEffect(() => {\n    if (vendorIdFromUrl && vendorsData?.data && vendorsData.data.length > 0 && !expenseForm.vendorId) {\n      const vendor = vendorsData.data.find(v => v.id === vendorIdFromUrl);\n      if (vendor) {\n        setExpenseForm(prev => ({\n          ...prev,\n          vendorId: vendor.id,\n          vendorName: vendor.displayName || vendor.name || ''\n        }));\n        // Also open the Record Expense dialog\n        setShowRecordExpense(true);\n        setExpenseTab(\"record-expense\");\n      }\n    }\n  }, [vendorIdFromUrl, vendorsData?.data]);\n\n  const createExpenseMutation = useMutation({\n    mutationFn: async (expense: any) => {\n      return apiRequest('POST', '/api/expenses', expense);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/expenses'] });\n      setShowRecordExpense(false);\n      resetExpenseForm();\n      toast({ title: \"Expense recorded successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to record expense\", variant: \"destructive\" });\n    },\n  });\n\n  const createMileageMutation = useMutation({\n    mutationFn: async (mileage: any) => {\n      return apiRequest('POST', '/api/mileage', mileage);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/mileage'] });\n      setShowRecordExpense(false);\n      resetMileageForm();\n      toast({ title: \"Mileage recorded successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to record mileage\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteExpenseMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest('DELETE', `/api/expenses/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/expenses'] });\n      toast({ title: \"Expense deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete expense\", variant: \"destructive\" });\n    },\n  });\n\n  const updateExpenseMutation = useMutation({\n    mutationFn: async ({ id, expense }: { id: string; expense: any }) => {\n      return apiRequest('PUT', `/api/expenses/${id}`, expense);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/expenses'] });\n      setShowRecordExpense(false);\n      setIsEditMode(false);\n      setEditingExpenseId(null);\n      resetExpenseForm();\n      toast({ title: \"Expense updated successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to update expense\", variant: \"destructive\" });\n    },\n  });\n\n  const updateMileageSettingsMutation = useMutation({\n    mutationFn: async (settings: any) => {\n      return apiRequest('PUT', '/api/mileage-settings', settings);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/mileage-settings'] });\n      toast({ title: \"Mileage settings updated\" });\n    },\n  });\n\n  const addMileageRateMutation = useMutation({\n    mutationFn: async (rate: any) => {\n      return apiRequest('POST', '/api/mileage-settings/rates', rate);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/mileage-settings'] });\n      setMileageSettingsForm(prev => ({ ...prev, newRateDate: \"\", newRateValue: \"\" }));\n      toast({ title: \"Mileage rate added\" });\n    },\n  });\n\n  const handleCreateExpenseAccount = () => {\n    if (!newExpenseAccountName.trim()) {\n      toast({ title: \"Account name is required\", variant: \"destructive\" });\n      return;\n    }\n    setExpenseForm(prev => ({ ...prev, expenseAccount: newExpenseAccountName }));\n    setShowCreateExpenseAccountDialog(false);\n    setNewExpenseAccountName(\"\");\n    toast({ title: \"Expense account created and selected\" });\n  };\n\n  const handleCreatePaidThrough = () => {\n    if (!newPaidThroughName.trim()) {\n      toast({ title: \"Account name is required\", variant: \"destructive\" });\n      return;\n    }\n    setExpenseForm(prev => ({ ...prev, paidThrough: newPaidThroughName }));\n    setShowCreatePaidThroughDialog(false);\n    setNewPaidThroughName(\"\");\n    toast({ title: \"Paid Through account created and selected\" });\n  };\n\n  const handleCreateMileagePaidThrough = () => {\n    if (!newPaidThroughName.trim()) {\n      toast({ title: \"Account name is required\", variant: \"destructive\" });\n      return;\n    }\n    setMileageForm(prev => ({ ...prev, paidThrough: newPaidThroughName }));\n    setShowCreatePaidThroughDialog(false);\n    setNewPaidThroughName(\"\");\n    toast({ title: \"Paid Through account created and selected\" });\n  };\n\n  const resetExpenseForm = () => {\n    setExpenseForm({\n      date: format(new Date(), 'yyyy-MM-dd'),\n      expenseAccount: \"\",\n      amount: \"\",\n      currency: \"INR\",\n      paidThrough: \"\",\n      expenseType: \"services\",\n      hsn: \"\",\n      sac: \"\",\n      vendorId: \"\",\n      vendorName: \"\",\n      gstTreatment: \"\",\n      sourceOfSupply: \"\",\n      destinationOfSupply: \"[MH] - Maharashtra\",\n      reverseCharge: false,\n      tax: \"\",\n      amountIs: \"tax_exclusive\",\n      invoiceNumber: \"\",\n      notes: \"\",\n      customerId: \"\",\n      customerName: \"\",\n      reportingTags: [],\n    });\n  };\n\n  const resetMileageForm = () => {\n    setMileageForm({\n      date: format(new Date(), 'yyyy-MM-dd'),\n      employee: \"\",\n      calculationMethod: \"distance_travelled\",\n      distance: \"\",\n      unit: \"km\",\n      startOdometer: \"\",\n      endOdometer: \"\",\n      amount: \"\",\n      currency: \"INR\",\n      paidThrough: \"\",\n      vendorId: \"\",\n      vendorName: \"\",\n      invoiceNumber: \"\",\n      notes: \"\",\n      customerId: \"\",\n      customerName: \"\",\n      reportingTags: [],\n    });\n  };\n\n  const handleSubmitExpense = () => {\n    if (!expenseForm.expenseAccount || !expenseForm.amount) {\n      toast({ title: \"Please fill in required fields\", variant: \"destructive\" });\n      return;\n    }\n    const expenseData = {\n      ...expenseForm,\n      amount: parseFloat(expenseForm.amount) || 0,\n    };\n\n    if (isEditMode && editingExpenseId) {\n      updateExpenseMutation.mutate({ id: editingExpenseId, expense: expenseData });\n    } else {\n      createExpenseMutation.mutate(expenseData);\n    }\n  };\n\n  const handleSubmitMileage = () => {\n    if (!mileageForm.amount) {\n      toast({ title: \"Please fill in required fields\", variant: \"destructive\" });\n      return;\n    }\n    createMileageMutation.mutate({\n      ...mileageForm,\n      distance: parseFloat(mileageForm.distance) || 0,\n      amount: parseFloat(mileageForm.amount) || 0,\n      startOdometer: parseFloat(mileageForm.startOdometer) || 0,\n      endOdometer: parseFloat(mileageForm.endOdometer) || 0,\n    });\n  };\n\n  const handleSaveAndNew = () => {\n    if (expenseTab === \"record-expense\") {\n      if (!expenseForm.expenseAccount || !expenseForm.amount) {\n        toast({ title: \"Please fill in required fields\", variant: \"destructive\" });\n        return;\n      }\n      createExpenseMutation.mutate({\n        ...expenseForm,\n        amount: parseFloat(expenseForm.amount) || 0,\n      }, {\n        onSuccess: () => {\n          resetExpenseForm();\n        }\n      });\n    } else {\n      if (!mileageForm.amount) {\n        toast({ title: \"Please fill in required fields\", variant: \"destructive\" });\n        return;\n      }\n      createMileageMutation.mutate({\n        ...mileageForm,\n        distance: parseFloat(mileageForm.distance) || 0,\n        amount: parseFloat(mileageForm.amount) || 0,\n        startOdometer: parseFloat(mileageForm.startOdometer) || 0,\n        endOdometer: parseFloat(mileageForm.endOdometer) || 0,\n      }, {\n        onSuccess: () => {\n          resetMileageForm();\n        }\n      });\n    }\n  };\n\n  const expenses = expensesData?.data || [];\n  const vendors = vendorsData?.data || [];\n  const customers = customersData?.data || [];\n  const mileageSettings = mileageSettingsData?.data;\n\n  const sortedExpenses = [...expenses].sort((a, b) => {\n    let aVal: any = a[sortBy as keyof Expense];\n    let bVal: any = b[sortBy as keyof Expense];\n    if (sortBy === 'amount') {\n      aVal = parseFloat(String(aVal)) || 0;\n      bVal = parseFloat(String(bVal)) || 0;\n    }\n    if (aVal > bVal) return -1;\n    if (aVal < bVal) return 1;\n    return 0;\n  });\n\n  const filteredExpenses = sortedExpenses.filter(expense =>\n    expense.expenseNumber?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    expense.vendorName?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    expense.expenseAccount?.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  const { currentPage, totalPages, totalItems, itemsPerPage, paginatedItems, goToPage } = usePagination(filteredExpenses, 10);\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('en-IN', {\n      style: 'currency',\n      currency: 'INR',\n      minimumFractionDigits: 2,\n    }).format(amount);\n  };\n\n  const handleExpenseClick = (expense: Expense) => {\n    setSelectedExpense(expense);\n  };\n\n  const handleClosePanel = () => {\n    setSelectedExpense(null);\n  };\n\n  const handleEditExpense = () => {\n    if (selectedExpense) {\n      setExpenseForm({\n        date: selectedExpense.date || format(new Date(), 'yyyy-MM-dd'),\n        expenseAccount: selectedExpense.expenseAccount || \"\",\n        amount: String(selectedExpense.amount || \"\"),\n        currency: selectedExpense.currency || \"INR\",\n        paidThrough: selectedExpense.paidThrough || \"\",\n        expenseType: selectedExpense.expenseType || \"services\",\n        hsn: (selectedExpense as any).hsn || \"\",\n        sac: selectedExpense.sac || \"\",\n        vendorId: selectedExpense.vendorId || \"\",\n        vendorName: selectedExpense.vendorName || \"\",\n        gstTreatment: selectedExpense.gstTreatment || \"\",\n        sourceOfSupply: selectedExpense.sourceOfSupply || \"\",\n        destinationOfSupply: selectedExpense.destinationOfSupply || \"[MH] - Maharashtra\",\n        reverseCharge: selectedExpense.reverseCharge || false,\n        tax: selectedExpense.tax || \"\",\n        amountIs: selectedExpense.amountIs || \"tax_exclusive\",\n        invoiceNumber: selectedExpense.invoiceNumber || \"\",\n        notes: selectedExpense.notes || \"\",\n        customerId: selectedExpense.customerId || \"\",\n        customerName: selectedExpense.customerName || \"\",\n        reportingTags: selectedExpense.reportingTags || [],\n      });\n      setIsEditMode(true);\n      setEditingExpenseId(selectedExpense.id);\n      setExpenseTab(\"record-expense\");\n      setShowRecordExpense(true);\n    }\n  };\n\n  const handleDeleteExpense = () => {\n    if (selectedExpense) {\n      deleteExpenseMutation.mutate(selectedExpense.id);\n      setSelectedExpense(null);\n    }\n  };\n\n  return (\n    <div className=\"flex h-[calc(100vh-80px)] animate-in fade-in duration-300\">\n      {/* Left side - Expense List */}\n      <div className={`flex flex-col overflow-hidden transition-all duration-300 ${selectedExpense ? 'w-[60%]' : 'w-full'}`}>\n        <div className=\"w-full space-y-4 p-4 overflow-y-auto\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n            <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n              <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                <TabsList className=\"bg-transparent gap-6 p-0\">\n                  <TabsTrigger\n                    value=\"receipts-inbox\"\n                    className=\"data-[state=active]:bg-transparent data-[state=active]:shadow-none data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-1 pb-2\"\n                    data-testid=\"tab-receipts-inbox\"\n                  >\n                    Receipts Inbox\n                  </TabsTrigger>\n                  <TabsTrigger\n                    value=\"all-expenses\"\n                    className=\"data-[state=active]:bg-transparent data-[state=active]:shadow-none data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-1 pb-2 flex items-center gap-1\"\n                    data-testid=\"tab-all-expenses\"\n                  >\n                    All Expenses <ChevronDown className=\"h-4 w-4\" />\n                  </TabsTrigger>\n                </TabsList>\n\n                <div className=\"flex items-center gap-2\">\n                  <Button\n                    className=\"gap-2 bg-indigo-600 hover:bg-indigo-700\"\n                    onClick={() => setShowRecordExpense(true)}\n                    data-testid=\"button-new-expense\"\n                  >\n                    <Plus className=\"h-4 w-4\" /> New\n                  </Button>\n                  <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                      <Button variant=\"outline\" size=\"icon\" data-testid=\"button-more-options\">\n                        <MoreHorizontal className=\"h-4 w-4\" />\n                      </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent align=\"end\">\n                      <DropdownMenuItem data-testid=\"sort-by-label\" className=\"font-semibold text-muted-foreground text-xs\">\n                        Sort by\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => setSortBy('createdTime')} data-testid=\"sort-created-time\">\n                        Created Time {sortBy === 'createdTime' && ''}\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => setSortBy('date')} data-testid=\"sort-date\">\n                        Date {sortBy === 'date' && ''}\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => setSortBy('expenseAccount')} data-testid=\"sort-expense-account\">\n                        Expense Account {sortBy === 'expenseAccount' && ''}\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => setSortBy('vendorName')} data-testid=\"sort-vendor-name\">\n                        Vendor Name {sortBy === 'vendorName' && ''}\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => setSortBy('paidThrough')} data-testid=\"sort-paid-through\">\n                        Paid Through {sortBy === 'paidThrough' && ''}\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => setSortBy('customerName')} data-testid=\"sort-customer-name\">\n                        Customer Name {sortBy === 'customerName' && ''}\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => setSortBy('amount')} data-testid=\"sort-amount\">\n                        Amount {sortBy === 'amount' && ''}\n                      </DropdownMenuItem>\n                      <DropdownMenuSeparator />\n                      <DropdownMenuItem onClick={() => setShowImportDialog(true)} data-testid=\"menu-import\">\n                        <Upload className=\"h-4 w-4 mr-2\" /> Import Expenses\n                      </DropdownMenuItem>\n                      <DropdownMenuItem data-testid=\"menu-export\">\n                        <Download className=\"h-4 w-4 mr-2\" /> Export\n                      </DropdownMenuItem>\n                      <DropdownMenuSeparator />\n                      <DropdownMenuItem data-testid=\"menu-preferences\">\n                        <Settings className=\"h-4 w-4 mr-2\" /> Preferences\n                      </DropdownMenuItem>\n                      <DropdownMenuItem data-testid=\"menu-custom-fields\">\n                        <FileText className=\"h-4 w-4 mr-2\" /> Manage Custom Fields\n                      </DropdownMenuItem>\n                      <DropdownMenuItem data-testid=\"menu-refresh\">\n                        <RefreshCw className=\"h-4 w-4 mr-2\" /> Refresh List\n                      </DropdownMenuItem>\n                      <DropdownMenuItem data-testid=\"menu-reset-columns\">\n                        Reset Column Width\n                      </DropdownMenuItem>\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n                </div>\n              </div>\n\n              <TabsContent value=\"receipts-inbox\" className=\"mt-6\">\n                <Card className=\"border-dashed\">\n                  <CardContent className=\"flex flex-col items-center justify-center py-16 text-center\">\n                    <div className=\"h-16 w-16 rounded-full bg-muted flex items-center justify-center mb-4\">\n                      <Inbox className=\"h-8 w-8 text-muted-foreground\" />\n                    </div>\n                    <h3 className=\"text-lg font-semibold mb-2\" data-testid=\"text-receipts-empty\">No receipts in inbox</h3>\n                    <p className=\"text-muted-foreground mb-4 max-w-sm\">\n                      Upload receipts and documents here to automatically extract expense information.\n                    </p>\n                    <Button className=\"gap-2\" data-testid=\"button-upload-receipt\">\n                      <Upload className=\"h-4 w-4\" /> Upload Receipt\n                    </Button>\n                  </CardContent>\n                </Card>\n              </TabsContent>\n\n              <TabsContent value=\"all-expenses\" className=\"mt-6\">\n                {isLoading ? (\n                  <div className=\"flex items-center justify-center py-16\">\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600\"></div>\n                  </div>\n                ) : expenses.length === 0 ? (\n                  <Card className=\"border-dashed\">\n                    <CardContent className=\"flex flex-col items-center justify-center py-16 text-center\">\n                      <div className=\"h-24 w-24 rounded-lg bg-slate-100 flex items-center justify-center mb-6\">\n                        <Receipt className=\"h-12 w-12 text-slate-400\" />\n                      </div>\n                      <h2 className=\"text-xl font-semibold mb-2\" data-testid=\"text-expenses-empty-title\">Time To Manage Your Expenses!</h2>\n                      <p className=\"text-muted-foreground mb-6 max-w-md\">\n                        Create and manage expenses that are part of your organization's operating costs.\n                      </p>\n                      <div className=\"flex flex-col gap-3\">\n                        <Button\n                          className=\"gap-2 bg-indigo-600 hover:bg-indigo-700\"\n                          onClick={() => setShowRecordExpense(true)}\n                          data-testid=\"button-record-expense-empty\"\n                        >\n                          RECORD EXPENSE\n                        </Button>\n                        <Button\n                          variant=\"link\"\n                          className=\"text-indigo-600\"\n                          onClick={() => setShowImportDialog(true)}\n                          data-testid=\"button-import-expenses\"\n                        >\n                          Import Expenses\n                        </Button>\n                      </div>\n\n                      <div className=\"mt-12 w-full max-w-2xl\">\n                        <h3 className=\"text-lg font-semibold mb-6\" data-testid=\"text-lifecycle-title\">Life cycle of an Expense</h3>\n                        <div className=\"flex items-center justify-center gap-4 flex-wrap\">\n                          <div className=\"flex items-center gap-2 px-4 py-2 border rounded-full\">\n                            <Receipt className=\"h-4 w-4 text-indigo-600\" />\n                            <span className=\"text-sm\">BILLABLE</span>\n                          </div>\n                          <div className=\"text-muted-foreground\">...</div>\n                          <div className=\"flex items-center gap-2 px-4 py-2 border rounded-full\">\n                            <FileText className=\"h-4 w-4 text-green-600\" />\n                            <span className=\"text-sm\">CONVERT TO INVOICE</span>\n                          </div>\n                          <div className=\"text-muted-foreground\">...</div>\n                          <div className=\"flex items-center gap-2 px-4 py-2 border rounded-full\">\n                            <Tag className=\"h-4 w-4 text-amber-600\" />\n                            <span className=\"text-sm\">GET REIMBURSED</span>\n                          </div>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ) : (\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center gap-4\">\n                      <div className=\"relative flex-1 max-w-md\">\n                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                        <Input\n                          placeholder=\"Search expenses...\"\n                          className=\"pl-9\"\n                          value={searchQuery}\n                          onChange={(e) => setSearchQuery(e.target.value)}\n                          data-testid=\"input-search-expenses\"\n                        />\n                      </div>\n                    </div>\n\n                    <div className=\"border rounded-lg overflow-hidden\">\n                      <table className=\"w-full\">\n                        <thead className=\"bg-slate-50\">\n                          <tr>\n                            <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">\n                              <Checkbox data-testid=\"checkbox-select-all\" />\n                            </th>\n                            <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Date</th>\n                            <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Expense Account</th>\n                            <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Vendor Name</th>\n                            <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Paid Through</th>\n                            <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Customer Name</th>\n                            <th className=\"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase\">Amount</th>\n                            <th className=\"px-4 py-3 text-center text-xs font-medium text-slate-500 uppercase\">Actions</th>\n                          </tr>\n                        </thead>\n                        <tbody className=\"divide-y\">\n                          {paginatedItems.map((expense) => (\n                            <tr\n                              key={expense.id}\n                              className={`hover:bg-slate-50 cursor-pointer transition-colors ${selectedExpense?.id === expense.id ? 'bg-blue-50' : ''\n                                }`}\n                              onClick={() => handleExpenseClick(expense)}\n                              data-testid={`row-expense-${expense.id}`}\n                            >\n                              <td className=\"px-4 py-3\" onClick={(e) => e.stopPropagation()}>\n                                <Checkbox data-testid={`checkbox-expense-${expense.id}`} />\n                              </td>\n                              <td className=\"px-4 py-3 text-sm\">{expense.date}</td>\n                              <td className=\"px-4 py-3 text-sm\">{expense.expenseAccount}</td>\n                              <td className=\"px-4 py-3 text-sm\">{expense.vendorName || '-'}</td>\n                              <td className=\"px-4 py-3 text-sm\">{expense.paidThrough || '-'}</td>\n                              <td className=\"px-4 py-3 text-sm\">{expense.customerName || '-'}</td>\n                              <td className=\"px-4 py-3 text-sm text-right font-medium\">\n                                {formatCurrency(expense.amount)}\n                              </td>\n                              <td className=\"px-4 py-3 text-center\">\n                                <DropdownMenu>\n                                  <DropdownMenuTrigger asChild>\n                                    <Button variant=\"ghost\" size=\"icon\" data-testid={`button-expense-actions-${expense.id}`}>\n                                      <MoreHorizontal className=\"h-4 w-4\" />\n                                    </Button>\n                                  </DropdownMenuTrigger>\n                                  <DropdownMenuContent align=\"end\">\n                                    <DropdownMenuItem data-testid={`action-edit-${expense.id}`}>Edit</DropdownMenuItem>\n                                    <DropdownMenuItem data-testid={`action-clone-${expense.id}`}>Clone</DropdownMenuItem>\n                                    <DropdownMenuSeparator />\n                                    <DropdownMenuItem\n                                      className=\"text-destructive\"\n                                      onClick={() => deleteExpenseMutation.mutate(expense.id)}\n                                      data-testid={`action-delete-${expense.id}`}\n                                    >\n                                      Delete\n                                    </DropdownMenuItem>\n                                  </DropdownMenuContent>\n                                </DropdownMenu>\n                              </td>\n                            </tr>\n                          ))}\n                        </tbody>\n                      </table>\n                      <TablePagination\n                        currentPage={currentPage}\n                        totalPages={totalPages}\n                        totalItems={totalItems}\n                        itemsPerPage={itemsPerPage}\n                        onPageChange={goToPage}\n                      />\n                    </div>\n                  </div>\n                )}\n              </TabsContent>\n            </Tabs>\n          </div>\n        </div>\n      </div>\n\n      {/* Right side - Expense Detail Panel */}\n      {selectedExpense && (\n        <div className=\"w-[40%] border-l border-slate-200 flex-shrink-0 overflow-hidden bg-white\">\n          <ExpenseDetailPanel\n            expense={selectedExpense}\n            onClose={handleClosePanel}\n            onEdit={handleEditExpense}\n            onDelete={handleDeleteExpense}\n          />\n        </div>\n      )}\n\n\n      <Dialog open={showRecordExpense} onOpenChange={(open) => {\n        setShowRecordExpense(open);\n        if (!open) {\n          setIsEditMode(false);\n          setEditingExpenseId(null);\n          resetExpenseForm();\n        }\n      }}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <div className=\"flex items-center justify-between\">\n              {isEditMode ? (\n                <DialogTitle data-testid=\"dialog-title-edit-expense\">Edit Expense</DialogTitle>\n              ) : (\n                <Tabs value={expenseTab} onValueChange={setExpenseTab}>\n                  <TabsList>\n                    <TabsTrigger value=\"record-expense\" data-testid=\"tab-record-expense\">Record Expense</TabsTrigger>\n                    <TabsTrigger value=\"record-mileage\" data-testid=\"tab-record-mileage\">Record Mileage</TabsTrigger>\n                  </TabsList>\n                </Tabs>\n              )}\n            </div>\n          </DialogHeader>\n\n          {expenseTab === \"record-expense\" ? (\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n              <div className=\"lg:col-span-2 space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-slate-700 font-medium\">\n                      Date\n                      <span className=\"text-red-500 ml-0.5\">*</span>\n                    </Label>\n                    <Input\n                      type=\"date\"\n                      value={expenseForm.date}\n                      onChange={(e) => setExpenseForm(prev => ({ ...prev, date: e.target.value }))}\n                      className=\"h-10 border-slate-300 hover:border-blue-400 focus:border-blue-500 transition-colors\"\n                      data-testid=\"input-expense-date\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-slate-700 font-medium\">\n                      Expense Account\n                      <span className=\"text-red-500 ml-0.5\">*</span>\n                    </Label>\n                    <AccountSelectDropdown\n                      value={expenseForm.expenseAccount}\n                      onValueChange={(value) => setExpenseForm(prev => ({ ...prev, expenseAccount: value }))}\n                      placeholder=\"Select expense account\"\n                      triggerClassName=\"h-10 px-3 border-slate-300 hover:border-blue-400 hover:bg-slate-50 transition-colors\"\n                      testId=\"select-expense-account\"\n                    />\n                    <button className=\"text-blue-600 hover:text-blue-700 text-sm font-medium transition-colors\" data-testid=\"button-itemize\">Itemize</button>\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-slate-700\">\n                      Amount\n                      <span className=\"text-red-600\">*</span>\n                    </Label>\n                    <div className=\"flex gap-2\">\n                      <Select\n                        value={expenseForm.currency}\n                        onValueChange={(value) => setExpenseForm(prev => ({ ...prev, currency: value }))}\n                      >\n                        <SelectTrigger className=\"w-20\" data-testid=\"select-currency\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"INR\">INR</SelectItem>\n                          <SelectItem value=\"USD\">USD</SelectItem>\n                          <SelectItem value=\"EUR\">EUR</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <Input\n                        type=\"number\"\n                        placeholder=\"0.00\"\n                        value={expenseForm.amount}\n                        onChange={(e) => setExpenseForm(prev => ({ ...prev, amount: e.target.value }))}\n                        data-testid=\"input-expense-amount\"\n                      />\n                    </div>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-slate-700\">\n                      Paid Through\n                      <span className=\"text-red-600\">*</span>\n                    </Label>\n                    <Popover open={paidThroughOpen} onOpenChange={setPaidThroughOpen}>\n                      <PopoverTrigger asChild>\n                        <Button\n                          variant=\"outline\"\n                          role=\"combobox\"\n                          aria-expanded={paidThroughOpen}\n                          className={`w-full justify-between font-normal h-10 px-3 border-slate-300 hover:border-blue-400 hover:bg-slate-50 transition-colors ${expenseForm.paidThrough ? 'text-slate-900' : 'text-slate-500'}`}\n                          data-testid=\"select-paid-through\"\n                        >\n                          <span className=\"truncate\">{expenseForm.paidThrough || \"Select paid through account\"}</span>\n                          <ChevronDown className={`ml-2 h-4 w-4 shrink-0 text-slate-400 transition-transform ${paidThroughOpen ? 'rotate-180' : ''}`} />\n                        </Button>ACCOUNT\n                      </PopoverTrigger>\n                      <PopoverContent className=\"w-[400px] p-0 shadow-lg border-slate-200\" align=\"start\">\n                        <Command className=\"rounded-lg\">\n                          <div className=\"flex items-center border-b px-3 py-2 bg-slate-50\">\n                            <Search className=\"mr-2 h-4 w-4 shrink-0 text-slate-400\" />\n                            <CommandInput placeholder=\"Search accounts...\" className=\"h-9 border-0 focus:ring-0 bg-transparent\" />\n                          </div>\n                          <CommandList className=\"max-h-[280px] overflow-y-auto overscroll-contain\" style={{ scrollBehavior: 'auto' }}>\n                            <CommandEmpty className=\"py-6 text-center text-sm text-slate-500\">No account found.</CommandEmpty>\n                            <CommandGroup>\n                              {PAID_THROUGH_ACCOUNTS.map((account) => (\n                                <CommandItem\n                                  key={account}\n                                  value={account}\n                                  onSelect={() => {\n                                    setExpenseForm(prev => ({ ...prev, paidThrough: account }));\n                                    setPaidThroughOpen(false);\n                                  }}\n                                  className=\"cursor-pointer hover:bg-blue-50 px-3 py-2.5\"\n                                >\n                                  <Check\n                                    className={`mr-2 h-4 w-4 text-blue-600 ${expenseForm.paidThrough === account ? \"opacity-100\" : \"opacity-0\"}`}\n                                  />\n                                  <span className=\"text-slate-700\">{account}</span>\n                                </CommandItem>\n                              ))}\n                            </CommandGroup>\n                            <div className=\"border-t px-3 py-2 bg-slate-50\">\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                className=\"w-full justify-start gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50\"\n                                onClick={() => {\n                                  setShowCreatePaidThroughDialog(true);\n                                  setPaidThroughOpen(false);\n                                }}\n                                type=\"button\"\n                              >\n                                <Plus className=\"h-4 w-4\" />\n                                Create New Account\n                              </Button>\n                            </div>\n                          </CommandList>\n                        </Command>\n                      </PopoverContent>\n                    </Popover>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label className=\"text-slate-700 font-medium\">\n                    Expense Type\n                    <span className=\"text-red-500 ml-0.5\">*</span>\n                  </Label>\n                  <RadioGroup\n                    value={expenseForm.expenseType}\n                    onValueChange={(value) => setExpenseForm(prev => ({ ...prev, expenseType: value }))}\n                    className=\"flex gap-4\"\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      <RadioGroupItem value=\"goods\" id=\"goods\" data-testid=\"radio-goods\" />\n                      <Label htmlFor=\"goods\">Goods</Label>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <RadioGroupItem value=\"services\" id=\"services\" data-testid=\"radio-services\" />\n                      <Label htmlFor=\"services\">Services</Label>\n                    </div>\n                  </RadioGroup>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  {expenseForm.expenseType === \"goods\" && (\n                    <div className=\"space-y-2\">\n                      <Label>HSN Code</Label>\n                      <Input\n                        value={expenseForm.hsn}\n                        onChange={(e) => setExpenseForm(prev => ({ ...prev, hsn: e.target.value }))}\n                        data-testid=\"input-hsn\"\n                      />\n                    </div>\n                  )}\n                  {expenseForm.expenseType === \"services\" && (\n                    <div className=\"space-y-2\">\n                      <Label>SAC Code</Label>\n                      <Input\n                        value={expenseForm.sac}\n                        onChange={(e) => setExpenseForm(prev => ({ ...prev, sac: e.target.value }))}\n                        data-testid=\"input-sac\"\n                      />\n                    </div>\n                  )}\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-slate-700 font-medium\">Vendor</Label>\n                    <Select\n                      value={expenseForm.vendorId}\n                      onValueChange={(value) => {\n                        const vendor = vendors.find(v => v.id === value);\n                        setExpenseForm(prev => ({\n                          ...prev,\n                          vendorId: value,\n                          vendorName: vendor?.displayName || vendor?.name || ''\n                        }));\n                      }}\n                    >\n                      <SelectTrigger className=\"w-full h-10 border-slate-300 hover:border-blue-400 hover:bg-slate-50 transition-colors\" data-testid=\"select-vendor\">\n                        <SelectValue placeholder=\"Select a vendor\" />\n                      </SelectTrigger>\n                      <SelectContent className=\"max-h-[280px]\">\n                        {vendors.map(vendor => (\n                          <SelectItem key={vendor.id} value={vendor.id} className=\"cursor-pointer\">\n                            {vendor.displayName || vendor.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-slate-700 font-medium\">\n                      GST Treatment\n                      <span className=\"text-red-500 ml-0.5\">*</span>\n                    </Label>\n                    <Popover open={gstTreatmentOpen} onOpenChange={setGstTreatmentOpen}>\n                      <PopoverTrigger asChild>\n                        <Button\n                          variant=\"outline\"\n                          role=\"combobox\"\n                          aria-expanded={gstTreatmentOpen}\n                          className={`w-full justify-between font-normal h-10 px-3 border-slate-300 hover:border-blue-400 hover:bg-slate-50 transition-colors ${expenseForm.gstTreatment ? 'text-slate-900' : 'text-slate-500'}`}\n                          data-testid=\"select-gst-treatment\"\n                        >\n                          <span className=\"truncate\">{expenseForm.gstTreatment || \"Select GST treatment\"}</span>\n                          <ChevronDown className={`ml-2 h-4 w-4 shrink-0 text-slate-400 transition-transform ${gstTreatmentOpen ? 'rotate-180' : ''}`} />\n                        </Button>\n                      </PopoverTrigger>\n                      <PopoverContent className=\"w-[400px] p-0 shadow-lg border-slate-200\" align=\"start\">\n                        <Command className=\"rounded-lg\">\n                          <div className=\"flex items-center border-b px-3 py-2 bg-slate-50\">\n                            <Search className=\"mr-2 h-4 w-4 shrink-0 text-slate-400\" />\n                            <CommandInput placeholder=\"Search treatments...\" className=\"h-9 border-0 focus:ring-0 bg-transparent\" />\n                          </div>\n                          <CommandList className=\"max-h-[280px] overflow-y-auto overscroll-contain\" style={{ scrollBehavior: 'auto' }}>\n                            <CommandEmpty className=\"py-6 text-center text-sm text-slate-500\">No treatment found.</CommandEmpty>\n                            <CommandGroup>\n                              {GST_TREATMENTS.map((treatment) => (\n                                <CommandItem\n                                  key={treatment}\n                                  value={treatment}\n                                  onSelect={() => {\n                                    setExpenseForm(prev => ({ ...prev, gstTreatment: treatment }));\n                                    setGstTreatmentOpen(false);\n                                  }}\n                                  className=\"cursor-pointer hover:bg-blue-50 px-3 py-2.5\"\n                                >\n                                  <Check\n                                    className={`mr-2 h-4 w-4 text-blue-600 ${expenseForm.gstTreatment === treatment ? \"opacity-100\" : \"opacity-0\"}`}\n                                  />\n                                  <span className=\"text-slate-700\">{treatment}</span>\n                                </CommandItem>\n                              ))}\n                            </CommandGroup>\n                          </CommandList>\n                        </Command>\n                      </PopoverContent>\n                    </Popover>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-slate-700 font-medium\">\n                      Source of Supply\n                      <span className=\"text-red-500 ml-0.5\">*</span>\n                    </Label>\n                    <Popover open={sourceOfSupplyOpen} onOpenChange={setSourceOfSupplyOpen}>\n                      <PopoverTrigger asChild>\n                        <Button\n                          variant=\"outline\"\n                          role=\"combobox\"\n                          aria-expanded={sourceOfSupplyOpen}\n                          className={`w-full justify-between font-normal h-10 px-3 border-slate-300 hover:border-blue-400 hover:bg-slate-50 transition-colors ${expenseForm.sourceOfSupply ? 'text-slate-900' : 'text-slate-500'}`}\n                          data-testid=\"select-source-supply\"\n                        >\n                          <span className=\"truncate\">{expenseForm.sourceOfSupply || \"Select source state\"}</span>\n                          <ChevronDown className={`ml-2 h-4 w-4 shrink-0 text-slate-400 transition-transform ${sourceOfSupplyOpen ? 'rotate-180' : ''}`} />\n                        </Button>\n                      </PopoverTrigger>\n                      <PopoverContent className=\"w-[400px] p-0 shadow-lg border-slate-200\" align=\"start\">\n                        <Command className=\"rounded-lg\">\n                          <div className=\"flex items-center border-b px-3 py-2 bg-slate-50\">\n                            <Search className=\"mr-2 h-4 w-4 shrink-0 text-slate-400\" />\n                            <CommandInput placeholder=\"Search states...\" className=\"h-9 border-0 focus:ring-0 bg-transparent\" />\n                          </div>\n                          <CommandList className=\"max-h-[280px] overflow-y-auto overscroll-contain\" style={{ scrollBehavior: 'auto' }}>\n                            <CommandEmpty className=\"py-6 text-center text-sm text-slate-500\">No state found.</CommandEmpty>\n                            <CommandGroup>\n                              {INDIAN_STATES.map((state) => (\n                                <CommandItem\n                                  key={state}\n                                  value={state}\n                                  onSelect={() => {\n                                    setExpenseForm(prev => ({ ...prev, sourceOfSupply: state }));\n                                    setSourceOfSupplyOpen(false);\n                                  }}\n                                  className=\"cursor-pointer hover:bg-blue-50 px-3 py-2.5\"\n                                >\n                                  <Check\n                                    className={`mr-2 h-4 w-4 text-blue-600 ${expenseForm.sourceOfSupply === state ? \"opacity-100\" : \"opacity-0\"}`}\n                                  />\n                                  <span className=\"text-slate-700\">{state}</span>\n                                </CommandItem>\n                              ))}\n                            </CommandGroup>\n                          </CommandList>\n                        </Command>\n                      </PopoverContent>\n                    </Popover>\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-slate-700 font-medium\">\n                      Destination of Supply\n                      <span className=\"text-red-500 ml-0.5\">*</span>\n                    </Label>\n                    <Popover open={destinationOfSupplyOpen} onOpenChange={setDestinationOfSupplyOpen}>\n                      <PopoverTrigger asChild>\n                        <Button\n                          variant=\"outline\"\n                          role=\"combobox\"\n                          aria-expanded={destinationOfSupplyOpen}\n                          className={`w-full justify-between font-normal h-10 px-3 border-slate-300 hover:border-blue-400 hover:bg-slate-50 transition-colors ${expenseForm.destinationOfSupply ? 'text-slate-900' : 'text-slate-500'}`}\n                          data-testid=\"select-destination-supply\"\n                        >\n                          <span className=\"truncate\">{expenseForm.destinationOfSupply || \"Select destination state\"}</span>\n                          <ChevronDown className={`ml-2 h-4 w-4 shrink-0 text-slate-400 transition-transform ${destinationOfSupplyOpen ? 'rotate-180' : ''}`} />\n                        </Button>\n                      </PopoverTrigger>\n                      <PopoverContent className=\"w-[400px] p-0 shadow-lg border-slate-200\" align=\"start\">\n                        <Command className=\"rounded-lg\">\n                          <div className=\"flex items-center border-b px-3 py-2 bg-slate-50\">\n                            <Search className=\"mr-2 h-4 w-4 shrink-0 text-slate-400\" />\n                            <CommandInput placeholder=\"Search states...\" className=\"h-9 border-0 focus:ring-0 bg-transparent\" />\n                          </div>\n                          <CommandList className=\"max-h-[280px] overflow-y-auto overscroll-contain\" style={{ scrollBehavior: 'auto' }}>\n                            <CommandEmpty className=\"py-6 text-center text-sm text-slate-500\">No state found.</CommandEmpty>\n                            <CommandGroup>\n                              {INDIAN_STATES.map((state) => (\n                                <CommandItem\n                                  key={state}\n                                  value={`[${state.substring(0, 2).toUpperCase()}] - ${state}`}\n                                  onSelect={() => {\n                                    setExpenseForm(prev => ({ ...prev, destinationOfSupply: `[${state.substring(0, 2).toUpperCase()}] - ${state}` }));\n                                    setDestinationOfSupplyOpen(false);\n                                  }}\n                                  className=\"cursor-pointer hover:bg-blue-50 px-3 py-2.5\"\n                                >\n                                  <Check\n                                    className={`mr-2 h-4 w-4 text-blue-600 ${expenseForm.destinationOfSupply === `[${state.substring(0, 2).toUpperCase()}] - ${state}` ? \"opacity-100\" : \"opacity-0\"}`}\n                                  />\n                                  <span className=\"text-slate-700\">[{state.substring(0, 2).toUpperCase()}] - {state}</span>\n                                </CommandItem>\n                              ))}\n                            </CommandGroup>\n                          </CommandList>\n                        </Command>\n                      </PopoverContent>\n                    </Popover>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>Reverse Charge</Label>\n                    <div className=\"flex items-center gap-2 h-10\">\n                      <Checkbox\n                        checked={expenseForm.reverseCharge}\n                        onCheckedChange={(checked) => setExpenseForm(prev => ({\n                          ...prev,\n                          reverseCharge: checked as boolean\n                        }))}\n                        data-testid=\"checkbox-reverse-charge\"\n                      />\n                      <span className=\"text-sm text-muted-foreground\">\n                        This transaction is applicable for reverse charge\n                      </span>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label>Tax</Label>\n                    <Select\n                      value={expenseForm.tax}\n                      onValueChange={(value) => setExpenseForm(prev => ({ ...prev, tax: value }))}\n                    >\n                      <SelectTrigger data-testid=\"select-tax\">\n                        <SelectValue placeholder=\"Select a Tax\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {TAX_OPTIONS.map(tax => (\n                          <SelectItem key={tax.value} value={tax.value}>{tax.label}</SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  {expenseForm.reverseCharge && (\n                    <div className=\"space-y-2\">\n                      <Label className=\"text-slate-700\">Amount Is</Label>\n                      <RadioGroup\n                        value={expenseForm.amountIs}\n                        onValueChange={(value) => setExpenseForm(prev => ({ ...prev, amountIs: value }))}\n                        className=\"flex gap-4\"\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          <RadioGroupItem value=\"tax_inclusive\" id=\"tax_inclusive\" data-testid=\"radio-tax-inclusive\" />\n                          <Label htmlFor=\"tax_inclusive\">Tax Inclusive</Label>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <RadioGroupItem value=\"tax_exclusive\" id=\"tax_exclusive\" data-testid=\"radio-tax-exclusive\" />\n                          <Label htmlFor=\"tax_exclusive\">Tax Exclusive</Label>\n                        </div>\n                      </RadioGroup>\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-red-500\">Invoice#*</Label>\n                    <Input\n                      value={expenseForm.invoiceNumber}\n                      onChange={(e) => setExpenseForm(prev => ({ ...prev, invoiceNumber: e.target.value }))}\n                      data-testid=\"input-invoice-number\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Notes</Label>\n                  <Textarea\n                    placeholder=\"Max. 500 characters\"\n                    value={expenseForm.notes}\n                    onChange={(e) => setExpenseForm(prev => ({ ...prev, notes: e.target.value }))}\n                    maxLength={500}\n                    data-testid=\"textarea-notes\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label className=\"text-slate-700 font-medium\">Customer Name</Label>\n                  <Select\n                    value={expenseForm.customerId}\n                    onValueChange={(value) => {\n                      const customer = customers.find(c => c.id === value);\n                      setExpenseForm(prev => ({\n                        ...prev,\n                        customerId: value,\n                        customerName: customer?.displayName || customer?.name || ''\n                      }));\n                    }}\n                  >\n                    <SelectTrigger className=\"w-full h-10 border-slate-300 hover:border-blue-400 hover:bg-slate-50 transition-colors\" data-testid=\"select-customer\">\n                      <SelectValue placeholder=\"Select or add a customer\" />\n                    </SelectTrigger>\n                    <SelectContent className=\"max-h-[280px]\">\n                      {customers.map(customer => (\n                        <SelectItem key={customer.id} value={customer.id} className=\"cursor-pointer\">\n                          {customer.displayName || customer.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Reporting Tags</Label>\n                  <button className=\"text-indigo-600 text-sm flex items-center gap-1\" data-testid=\"button-associate-tags\">\n                    <Tag className=\"h-4 w-4\" /> Associate Tags\n                  </button>\n                </div>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div className=\"border-2 border-dashed rounded-lg p-8 text-center\">\n                  <div className=\"h-16 w-16 mx-auto mb-4 bg-slate-100 rounded-lg flex items-center justify-center\">\n                    <Upload className=\"h-8 w-8 text-slate-400\" />\n                  </div>\n                  <p className=\"font-medium mb-1\">Drag or Drop your Receipts</p>\n                  <p className=\"text-xs text-muted-foreground mb-4\">Maximum file size allowed is 10MB</p>\n                  <Button variant=\"outline\" className=\"gap-2\" data-testid=\"button-upload-files\">\n                    <Upload className=\"h-4 w-4\" /> Upload your Files\n                  </Button>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n              <div className=\"lg:col-span-2 space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-red-500\">Date*</Label>\n                    <Input\n                      type=\"date\"\n                      value={mileageForm.date}\n                      onChange={(e) => setMileageForm(prev => ({ ...prev, date: e.target.value }))}\n                      data-testid=\"input-mileage-date\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>Employee</Label>\n                    <Input\n                      value={mileageForm.employee}\n                      onChange={(e) => setMileageForm(prev => ({ ...prev, employee: e.target.value }))}\n                      data-testid=\"input-employee\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label className=\"text-indigo-600\">Calculate mileage using*</Label>\n                  <RadioGroup\n                    value={mileageForm.calculationMethod}\n                    onValueChange={(value) => setMileageForm(prev => ({ ...prev, calculationMethod: value }))}\n                    className=\"flex gap-4\"\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      <RadioGroupItem value=\"distance_travelled\" id=\"distance_travelled\" data-testid=\"radio-distance\" />\n                      <Label htmlFor=\"distance_travelled\">Distance travelled</Label>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <RadioGroupItem value=\"odometer_reading\" id=\"odometer_reading\" data-testid=\"radio-odometer\" />\n                      <Label htmlFor=\"odometer_reading\">Odometer reading</Label>\n                    </div>\n                  </RadioGroup>\n                </div>\n\n                {mileageForm.calculationMethod === \"distance_travelled\" ? (\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label className=\"text-red-500\">Distance*</Label>\n                      <Input\n                        type=\"number\"\n                        value={mileageForm.distance}\n                        onChange={(e) => setMileageForm(prev => ({ ...prev, distance: e.target.value }))}\n                        data-testid=\"input-distance\"\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label>Unit</Label>\n                      <RadioGroup\n                        value={mileageForm.unit}\n                        onValueChange={(value) => setMileageForm(prev => ({ ...prev, unit: value }))}\n                        className=\"flex gap-4 h-10 items-center\"\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          <RadioGroupItem value=\"km\" id=\"km\" data-testid=\"radio-km\" />\n                          <Label htmlFor=\"km\">Km</Label>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <RadioGroupItem value=\"mile\" id=\"mile\" data-testid=\"radio-mile\" />\n                          <Label htmlFor=\"mile\">Mile</Label>\n                        </div>\n                      </RadioGroup>\n                    </div>\n                  </div>\n                ) : (\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label className=\"text-red-500\">Start Odometer*</Label>\n                      <Input\n                        type=\"number\"\n                        value={mileageForm.startOdometer}\n                        onChange={(e) => setMileageForm(prev => ({ ...prev, startOdometer: e.target.value }))}\n                        data-testid=\"input-start-odometer\"\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label className=\"text-red-500\">End Odometer*</Label>\n                      <Input\n                        type=\"number\"\n                        value={mileageForm.endOdometer}\n                        onChange={(e) => setMileageForm(prev => ({ ...prev, endOdometer: e.target.value }))}\n                        data-testid=\"input-end-odometer\"\n                      />\n                    </div>\n                  </div>\n                )}\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-slate-700\">\n                      Amount\n                      <span className=\"text-red-600\">*</span>\n                    </Label>\n                    <div className=\"flex gap-2\">\n                      <Select\n                        value={mileageForm.currency}\n                        onValueChange={(value) => setMileageForm(prev => ({ ...prev, currency: value }))}\n                      >\n                        <SelectTrigger className=\"w-20\" data-testid=\"select-mileage-currency\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"INR\">INR</SelectItem>\n                          <SelectItem value=\"USD\">USD</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <Input\n                        type=\"number\"\n                        placeholder=\"0.00\"\n                        value={mileageForm.amount}\n                        onChange={(e) => setMileageForm(prev => ({ ...prev, amount: e.target.value }))}\n                        data-testid=\"input-mileage-amount\"\n                      />\n                    </div>\n                    <button\n                      className=\"text-indigo-600 text-sm flex items-center gap-1\"\n                      onClick={() => setShowMileageSettings(true)}\n                      data-testid=\"button-add-mileage-rate\"\n                    >\n                      <Plus className=\"h-3 w-3\" /> Add Mileage Rate\n                    </button>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-slate-700\">\n                      Paid Through\n                      <span className=\"text-red-600\">*</span>\n                    </Label>\n                    <Popover open={paidThroughOpen} onOpenChange={setPaidThroughOpen}>\n                      <PopoverTrigger asChild>\n                        <Button\n                          variant=\"outline\"\n                          role=\"combobox\"\n                          aria-expanded={paidThroughOpen}\n                          className=\"w-full justify-between font-normal\"\n                          data-testid=\"select-mileage-paid-through\"\n                        >\n                          {mileageForm.paidThrough || \"Search and select account...\"}\n                          <Search className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                        </Button>\n                      </PopoverTrigger>\n                      <PopoverContent className=\"w-[400px] p-0\" align=\"start\">\n                        <Command>\n                          <CommandInput placeholder=\"Search accounts...\" />\n                          <CommandList>\n                            <CommandEmpty>No account found.</CommandEmpty>\n                            <CommandGroup>\n                              {PAID_THROUGH_ACCOUNTS.map((account) => (\n                                <CommandItem\n                                  key={account}\n                                  value={account}\n                                  onSelect={() => {\n                                    setMileageForm(prev => ({ ...prev, paidThrough: account }));\n                                    setPaidThroughOpen(false);\n                                  }}\n                                >\n                                  <Check\n                                    className={`mr-2 h-4 w-4 ${mileageForm.paidThrough === account ? \"opacity-100\" : \"opacity-0\"\n                                      }`}\n                                  />\n                                  {account}\n                                </CommandItem>\n                              ))}\n                            </CommandGroup>\n                            <div className=\"border-t px-2 py-2\">\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                className=\"w-full justify-start gap-2\"\n                                onClick={() => {\n                                  setShowCreatePaidThroughDialog(true);\n                                  setPaidThroughOpen(false);\n                                }}\n                                type=\"button\"\n                              >\n                                <Plus className=\"h-4 w-4\" />\n                                Create New Account\n                              </Button>\n                            </div>\n                          </CommandList>\n                        </Command>\n                      </PopoverContent>\n                    </Popover>\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label>Vendor</Label>\n                    <Select\n                      value={mileageForm.vendorId}\n                      onValueChange={(value) => {\n                        const vendor = vendors.find(v => v.id === value);\n                        setMileageForm(prev => ({\n                          ...prev,\n                          vendorId: value,\n                          vendorName: vendor?.displayName || vendor?.name || ''\n                        }));\n                      }}\n                    >\n                      <SelectTrigger data-testid=\"select-mileage-vendor\">\n                        <SelectValue placeholder=\"Select a vendor\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {vendors.map(vendor => (\n                          <SelectItem key={vendor.id} value={vendor.id}>\n                            {vendor.displayName || vendor.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>Invoice#</Label>\n                    <Input\n                      value={mileageForm.invoiceNumber}\n                      onChange={(e) => setMileageForm(prev => ({ ...prev, invoiceNumber: e.target.value }))}\n                      data-testid=\"input-mileage-invoice\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Notes</Label>\n                  <Textarea\n                    placeholder=\"Max. 500 characters\"\n                    value={mileageForm.notes}\n                    onChange={(e) => setMileageForm(prev => ({ ...prev, notes: e.target.value }))}\n                    maxLength={500}\n                    data-testid=\"textarea-mileage-notes\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Customer Name</Label>\n                  <div className=\"flex gap-2\">\n                    <Select\n                      value={mileageForm.customerId}\n                      onValueChange={(value) => {\n                        const customer = customers.find(c => c.id === value);\n                        setMileageForm(prev => ({\n                          ...prev,\n                          customerId: value,\n                          customerName: customer?.displayName || customer?.name || ''\n                        }));\n                      }}\n                    >\n                      <SelectTrigger className=\"flex-1\" data-testid=\"select-mileage-customer\">\n                        <SelectValue placeholder=\"Select or add a customer\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {customers.map(customer => (\n                          <SelectItem key={customer.id} value={customer.id}>\n                            {customer.displayName || customer.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <Button variant=\"outline\" size=\"icon\" data-testid=\"button-add-mileage-customer\">\n                      <Search className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Reporting Tags</Label>\n                  <button className=\"text-indigo-600 text-sm flex items-center gap-1\" data-testid=\"button-mileage-associate-tags\">\n                    <Tag className=\"h-4 w-4\" /> Associate Tags\n                  </button>\n                </div>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div className=\"border-2 border-dashed rounded-lg p-8 text-center\">\n                  <div className=\"h-16 w-16 mx-auto mb-4 bg-slate-100 rounded-lg flex items-center justify-center\">\n                    <Upload className=\"h-8 w-8 text-slate-400\" />\n                  </div>\n                  <p className=\"font-medium mb-1\">Drag or Drop your Receipts</p>\n                  <p className=\"text-xs text-muted-foreground mb-4\">Maximum file size allowed is 10MB</p>\n                  <Button variant=\"outline\" className=\"gap-2\" data-testid=\"button-upload-mileage-files\">\n                    <Upload className=\"h-4 w-4\" /> Upload your Files\n                  </Button>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"flex items-center gap-2 pt-4 border-t\">\n            <Button\n              className=\"bg-indigo-600 hover:bg-indigo-700\"\n              onClick={expenseTab === \"record-expense\" ? handleSubmitExpense : handleSubmitMileage}\n              disabled={createExpenseMutation.isPending || createMileageMutation.isPending || updateExpenseMutation.isPending}\n              data-testid=\"button-save-expense\"\n            >\n              {isEditMode ? \"Save Changes (Alt+S)\" : \"Save (Alt+S)\"}\n            </Button>\n            {!isEditMode && (\n              <Button\n                variant=\"outline\"\n                onClick={handleSaveAndNew}\n                disabled={createExpenseMutation.isPending || createMileageMutation.isPending}\n                data-testid=\"button-save-and-new\"\n              >\n                Save and New (Alt+N)\n              </Button>\n            )}\n            <Button\n              variant=\"ghost\"\n              onClick={() => setShowRecordExpense(false)}\n              data-testid=\"button-cancel-expense\"\n            >\n              Cancel\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showMileageSettings} onOpenChange={setShowMileageSettings}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle data-testid=\"dialog-title-mileage-settings\">Set your mileage preferences</DialogTitle>\n          </DialogHeader>\n\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center gap-2\">\n              <Checkbox\n                checked={mileageSettingsForm.associateEmployeesToExpenses}\n                onCheckedChange={(checked) => setMileageSettingsForm(prev => ({\n                  ...prev,\n                  associateEmployeesToExpenses: checked as boolean\n                }))}\n                data-testid=\"checkbox-associate-employees\"\n              />\n              <Label>Associate employees to expenses</Label>\n            </div>\n\n            <div className=\"space-y-4 border-t pt-4\">\n              <h4 className=\"font-medium\">Mileage Preference</h4>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label>Default Mileage Category</Label>\n                  <Select\n                    value={mileageSettingsForm.defaultMileageCategory}\n                    onValueChange={(value) => setMileageSettingsForm(prev => ({\n                      ...prev,\n                      defaultMileageCategory: value\n                    }))}\n                  >\n                    <SelectTrigger data-testid=\"select-default-mileage-category\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {EXPENSE_ACCOUNTS.map(account => (\n                        <SelectItem key={account} value={account}>{account}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>Default Unit</Label>\n                  <RadioGroup\n                    value={mileageSettingsForm.defaultUnit}\n                    onValueChange={(value) => setMileageSettingsForm(prev => ({\n                      ...prev,\n                      defaultUnit: value\n                    }))}\n                    className=\"flex gap-4\"\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      <RadioGroupItem value=\"km\" id=\"default_km\" data-testid=\"radio-default-km\" />\n                      <Label htmlFor=\"default_km\">Km</Label>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <RadioGroupItem value=\"mile\" id=\"default_mile\" data-testid=\"radio-default-mile\" />\n                      <Label htmlFor=\"default_mile\">Mile</Label>\n                    </div>\n                  </RadioGroup>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-4 border-t pt-4\">\n              <h4 className=\"font-medium\">MILEAGE RATES</h4>\n              <p className=\"text-sm text-muted-foreground\">\n                Any mileage expense recorded on or after the start date will have the corresponding mileage rate.\n                You can create a default rate (created without specifying a date), which will be applicable for\n                mileage expenses recorded before the initial start date.\n              </p>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label>START DATE</Label>\n                  <Input\n                    type=\"date\"\n                    placeholder=\"dd/MM/yyyy\"\n                    value={mileageSettingsForm.newRateDate}\n                    onChange={(e) => setMileageSettingsForm(prev => ({\n                      ...prev,\n                      newRateDate: e.target.value\n                    }))}\n                    data-testid=\"input-rate-start-date\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>MILEAGE RATE</Label>\n                  <div className=\"flex gap-2\">\n                    <Input\n                      type=\"number\"\n                      placeholder=\"0.00\"\n                      value={mileageSettingsForm.newRateValue}\n                      onChange={(e) => setMileageSettingsForm(prev => ({\n                        ...prev,\n                        newRateValue: e.target.value\n                      }))}\n                      data-testid=\"input-mileage-rate-value\"\n                    />\n                    <span className=\"flex items-center text-sm text-muted-foreground\">INR</span>\n                  </div>\n                </div>\n              </div>\n\n              <button\n                className=\"text-indigo-600 text-sm flex items-center gap-1\"\n                onClick={() => {\n                  if (mileageSettingsForm.newRateValue) {\n                    addMileageRateMutation.mutate({\n                      startDate: mileageSettingsForm.newRateDate,\n                      rate: parseFloat(mileageSettingsForm.newRateValue),\n                      currency: 'INR'\n                    });\n                  }\n                }}\n                data-testid=\"button-add-rate\"\n              >\n                <Plus className=\"h-3 w-3\" /> Add Mileage Rate\n              </button>\n\n              {mileageSettings?.mileageRates && mileageSettings.mileageRates.length > 0 && (\n                <div className=\"border rounded-lg overflow-hidden\">\n                  <table className=\"w-full\">\n                    <thead className=\"bg-slate-50\">\n                      <tr>\n                        <th className=\"px-3 py-2 text-left text-xs font-medium text-slate-500\">Start Date</th>\n                        <th className=\"px-3 py-2 text-left text-xs font-medium text-slate-500\">Rate</th>\n                        <th className=\"px-3 py-2\"></th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {mileageSettings.mileageRates.map((rate) => (\n                        <tr key={rate.id}>\n                          <td className=\"px-3 py-2 text-sm\">{rate.startDate || 'Default'}</td>\n                          <td className=\"px-3 py-2 text-sm\">{rate.rate} {rate.currency}</td>\n                          <td className=\"px-3 py-2 text-right\">\n                            <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\">\n                              <X className=\"h-3 w-3\" />\n                            </Button>\n                          </td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                </div>\n              )}\n            </div>\n          </div>\n\n          <div className=\"flex items-center gap-2 pt-4 border-t\">\n            <Button\n              className=\"bg-indigo-600 hover:bg-indigo-700\"\n              onClick={() => {\n                updateMileageSettingsMutation.mutate({\n                  associateEmployeesToExpenses: mileageSettingsForm.associateEmployeesToExpenses,\n                  defaultMileageCategory: mileageSettingsForm.defaultMileageCategory,\n                  defaultUnit: mileageSettingsForm.defaultUnit,\n                });\n                setShowMileageSettings(false);\n              }}\n              data-testid=\"button-save-mileage-settings\"\n            >\n              Save\n            </Button>\n            <Button\n              variant=\"ghost\"\n              onClick={() => setShowMileageSettings(false)}\n              data-testid=\"button-cancel-mileage-settings\"\n            >\n              Cancel\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showCreateExpenseAccountDialog} onOpenChange={setShowCreateExpenseAccountDialog}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Create New Expense Account</DialogTitle>\n            <DialogDescription>Enter the name for the new expense account</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <Input\n              placeholder=\"Account Name\"\n              value={newExpenseAccountName}\n              onChange={(e) => setNewExpenseAccountName(e.target.value)}\n              onKeyDown={(e) => {\n                if (e.key === 'Enter') {\n                  handleCreateExpenseAccount();\n                }\n              }}\n              data-testid=\"input-new-expense-account\"\n            />\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowCreateExpenseAccountDialog(false)}>\n              Cancel\n            </Button>\n            <Button onClick={handleCreateExpenseAccount} className=\"bg-blue-600 hover:bg-blue-700\">\n              Save and Select\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showCreatePaidThroughDialog} onOpenChange={setShowCreatePaidThroughDialog}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Create New Account</DialogTitle>\n            <DialogDescription>Enter the name for the new paid through account</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <Input\n              placeholder=\"Account Name\"\n              value={newPaidThroughName}\n              onChange={(e) => setNewPaidThroughName(e.target.value)}\n              onKeyDown={(e) => {\n                if (e.key === 'Enter') {\n                  expenseTab === 'record-mileage' ? handleCreateMileagePaidThrough() : handleCreatePaidThrough();\n                }\n              }}\n              data-testid=\"input-new-paid-through\"\n            />\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowCreatePaidThroughDialog(false)}>\n              Cancel\n            </Button>\n            <Button onClick={() => {\n              expenseTab === 'record-mileage' ? handleCreateMileagePaidThrough() : handleCreatePaidThrough();\n            }} className=\"bg-blue-600 hover:bg-blue-700\">\n              Save and Select\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showImportDialog} onOpenChange={setShowImportDialog}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle className=\"text-center text-xl\" data-testid=\"dialog-title-import\">Expenses - Select File</DialogTitle>\n          </DialogHeader>\n\n          <div className=\"flex items-center justify-center gap-8 py-4\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"h-8 w-8 rounded-full bg-indigo-600 flex items-center justify-center text-white text-sm\">1</div>\n              <span className=\"font-medium\">Configure</span>\n            </div>\n            <div className=\"h-px w-12 bg-slate-200\"></div>\n            <div className=\"flex items-center gap-2 text-muted-foreground\">\n              <div className=\"h-8 w-8 rounded-full bg-slate-200 flex items-center justify-center text-sm\">2</div>\n              <span>Map Fields</span>\n            </div>\n            <div className=\"h-px w-12 bg-slate-200\"></div>\n            <div className=\"flex items-center gap-2 text-muted-foreground\">\n              <div className=\"h-8 w-8 rounded-full bg-slate-200 flex items-center justify-center text-sm\">3</div>\n              <span>Preview</span>\n            </div>\n          </div>\n\n          <div className=\"border-2 border-dashed rounded-lg p-12 text-center\">\n            <div className=\"h-12 w-12 mx-auto mb-4 flex items-center justify-center\">\n              <Download className=\"h-8 w-8 text-slate-400\" />\n            </div>\n            <p className=\"font-medium mb-4\">Drag and drop file to import</p>\n            <Button className=\"bg-indigo-600 hover:bg-indigo-700\" data-testid=\"button-choose-file\">\n              Choose File\n            </Button>\n            <p className=\"text-xs text-muted-foreground mt-4\">\n              Maximum File Size: 25 MB - File Format: CSV or TSV or XLS\n            </p>\n          </div>\n\n          <p className=\"text-sm text-center text-muted-foreground\">\n            Download a <a href=\"#\" className=\"text-indigo-600\">sample csv file</a> or <a href=\"#\" className=\"text-indigo-600\">sample xls file</a> and compare it to your import file to ensure you have the file perfect for the import.\n          </p>\n\n          <div className=\"space-y-2\">\n            <Label>Character Encoding</Label>\n            <Select defaultValue=\"utf-8\">\n              <SelectTrigger data-testid=\"select-encoding\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"utf-8\">UTF-8 (Unicode)</SelectItem>\n                <SelectItem value=\"ascii\">ASCII</SelectItem>\n                <SelectItem value=\"iso-8859-1\">ISO-8859-1</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4\">\n            <h4 className=\"font-medium text-amber-800 mb-2 flex items-center gap-2\">\n              <FileText className=\"h-4 w-4\" /> Page Tips\n            </h4>\n            <ul className=\"text-sm text-amber-700 space-y-1 list-disc pl-5\">\n              <li>Import data with the details of GST Treatment by referring these <a href=\"#\" className=\"text-indigo-600\">accepted formats</a>.</li>\n              <li>You can download the <a href=\"#\" className=\"text-indigo-600\">sample xls file</a> to get detailed information about the data fields used while importing.</li>\n              <li>If you have files in other formats, you can convert it to an accepted file format using any online/offline converter.</li>\n              <li>You can configure your import settings and save them for future too!</li>\n            </ul>\n          </div>\n\n          <div className=\"flex items-center justify-between pt-4 border-t\">\n            <Button\n              variant=\"ghost\"\n              onClick={() => setShowImportDialog(false)}\n              data-testid=\"button-cancel-import\"\n            >\n              Cancel\n            </Button>\n            <Button\n              className=\"bg-indigo-600 hover:bg-indigo-700\"\n              data-testid=\"button-next-import\"\n            >\n              Next\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","path":null,"size_bytes":93449,"size_tokens":null},"client/src/modules/items/index.ts":{"content":"export * from './pages';\nexport * from './types';\nexport * from './api';\nexport * from './services';\nexport * from './hooks';\n","path":null,"size_bytes":126,"size_tokens":null},"client/src/routes/ProtectedRoute.tsx":{"content":"import { ReactNode } from 'react';\nimport { Redirect } from 'wouter';\nimport { useAuthStore } from '@/store/authStore';\nimport { APP_CONSTANTS } from '@/constants';\n\ninterface ProtectedRouteProps {\n  children: ReactNode;\n  requiredRoles?: string[];\n  requiredPermissions?: string[];\n}\n\nexport const ProtectedRoute = ({\n  children,\n  requiredRoles = [],\n  requiredPermissions = [],\n}: ProtectedRouteProps) => {\n  const { isAuthenticated, user } = useAuthStore();\n\n  if (!isAuthenticated) {\n    return <Redirect to=\"/login\" />;\n  }\n\n  if (requiredRoles.length > 0 && user) {\n    const hasRequiredRole = requiredRoles.some(role => user.role === role);\n    if (!hasRequiredRole) {\n      return <Redirect to=\"/unauthorized\" />;\n    }\n  }\n\n  if (requiredPermissions.length > 0 && user) {\n    const hasRequiredPermission = requiredPermissions.every(\n      permission => user.permissions?.includes(permission)\n    );\n    if (!hasRequiredPermission) {\n      return <Redirect to=\"/unauthorized\" />;\n    }\n  }\n\n  return <>{children}</>;\n};\n\nexport const AdminRoute = ({ children }: { children: ReactNode }) => (\n  <ProtectedRoute requiredRoles={[APP_CONSTANTS.ROLES.ADMIN]}>\n    {children}\n  </ProtectedRoute>\n);\n\nexport const ManagerRoute = ({ children }: { children: ReactNode }) => (\n  <ProtectedRoute requiredRoles={[APP_CONSTANTS.ROLES.ADMIN, APP_CONSTANTS.ROLES.MANAGER]}>\n    {children}\n  </ProtectedRoute>\n);\n\nexport default ProtectedRoute;\n","path":null,"size_bytes":1438,"size_tokens":null},"vite-plugin-meta-images.ts":{"content":"import type { Plugin } from 'vite';\nimport fs from 'fs';\nimport path from 'path';\n\n/**\n * Vite plugin that updates og:image and twitter:image meta tags\n * to point to the app's opengraph image with the correct Replit domain.\n */\nexport function metaImagesPlugin(): Plugin {\n  return {\n    name: 'vite-plugin-meta-images',\n    transformIndexHtml(html) {\n      const baseUrl = getDeploymentUrl();\n      if (!baseUrl) {\n        log('[meta-images] no Replit deployment domain found, skipping meta tag updates');\n        return html;\n      }\n\n      // Check if opengraph image exists in public directory\n      const publicDir = path.resolve(process.cwd(), 'client', 'public');\n      const opengraphPngPath = path.join(publicDir, 'opengraph.png');\n      const opengraphJpgPath = path.join(publicDir, 'opengraph.jpg');\n      const opengraphJpegPath = path.join(publicDir, 'opengraph.jpeg');\n\n      let imageExt: string | null = null;\n      if (fs.existsSync(opengraphPngPath)) {\n        imageExt = 'png';\n      } else if (fs.existsSync(opengraphJpgPath)) {\n        imageExt = 'jpg';\n      } else if (fs.existsSync(opengraphJpegPath)) {\n        imageExt = 'jpeg';\n      }\n\n      if (!imageExt) {\n        log('[meta-images] OpenGraph image not found, skipping meta tag updates');\n        return html;\n      }\n\n      const imageUrl = `${baseUrl}/opengraph.${imageExt}`;\n\n      log('[meta-images] updating meta image tags to:', imageUrl);\n\n      html = html.replace(\n        /<meta\\s+property=\"og:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta property=\"og:image\" content=\"${imageUrl}\" />`\n      );\n\n      html = html.replace(\n        /<meta\\s+name=\"twitter:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta name=\"twitter:image\" content=\"${imageUrl}\" />`\n      );\n\n      return html;\n    },\n  };\n}\n\nfunction getDeploymentUrl(): string | null {\n  if (process.env.REPLIT_INTERNAL_APP_DOMAIN) {\n    const url = `https://${process.env.REPLIT_INTERNAL_APP_DOMAIN}`;\n    log('[meta-images] using internal app domain:', url);\n    return url;\n  }\n\n  if (process.env.REPLIT_DEV_DOMAIN) {\n    const url = `https://${process.env.REPLIT_DEV_DOMAIN}`;\n    log('[meta-images] using dev domain:', url);\n    return url;\n  }\n\n  return null;\n}\n\nfunction log(...args: any[]): void {\n  if (process.env.NODE_ENV === 'production') {\n    console.log(...args);\n  }\n}\n","path":null,"size_bytes":2333,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"import * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8608,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-9 px-2 min-w-9\",\n        sm: \"h-8 px-1.5 min-w-8\",\n        lg: \"h-10 px-2.5 min-w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1486,"size_tokens":null},"client/src/modules/reports/pages/ReportsPage.tsx":{"content":"export { default } from '@/pages/reports';\n","path":null,"size_bytes":43,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5124,"size_tokens":null},"client/src/modules/sales/types/index.ts":{"content":"import { BaseEntity } from '@/shared/types';\n\nexport interface InvoiceLineItem {\n  itemId: string;\n  itemName: string;\n  description?: string;\n  quantity: number;\n  rate: number;\n  discount?: number;\n  taxRate?: number;\n  amount: number;\n}\n\nexport interface Invoice extends BaseEntity {\n  invoiceNumber: string;\n  customerId: string;\n  customerName: string;\n  invoiceDate: string;\n  dueDate: string;\n  status: 'draft' | 'sent' | 'viewed' | 'paid' | 'partially_paid' | 'overdue' | 'cancelled';\n  lineItems: InvoiceLineItem[];\n  subtotal: number;\n  discountTotal: number;\n  taxTotal: number;\n  total: number;\n  amountPaid: number;\n  balance: number;\n  notes?: string;\n  terms?: string;\n}\n\nexport interface CreateInvoiceDto {\n  customerId: string;\n  invoiceDate: string;\n  dueDate: string;\n  lineItems: Omit<InvoiceLineItem, 'amount'>[];\n  notes?: string;\n  terms?: string;\n}\n\nexport interface Estimate extends BaseEntity {\n  estimateNumber: string;\n  customerId: string;\n  customerName: string;\n  estimateDate: string;\n  expiryDate: string;\n  status: 'draft' | 'sent' | 'accepted' | 'rejected' | 'expired' | 'converted';\n  lineItems: InvoiceLineItem[];\n  subtotal: number;\n  discountTotal: number;\n  taxTotal: number;\n  total: number;\n  notes?: string;\n  terms?: string;\n}\n","path":null,"size_bytes":1271,"size_tokens":null},"server/src/modules/auth/routes/index.ts":{"content":"import { Router } from 'express';\n\nexport const authRouter = Router();\n\nauthRouter.post('/login', (req, res) => {\n  const { email, password } = req.body;\n  // TODO: Implement actual authentication\n  res.json({\n    success: true,\n    data: {\n      user: {\n        id: '1',\n        email: email || 'admin@Billing.com',\n        name: 'Admin User',\n        role: 'admin',\n      },\n      token: 'mock-jwt-token',\n    },\n    message: 'Login successful',\n  });\n});\n\nauthRouter.post('/register', (req, res) => {\n  const { email, password, name } = req.body;\n  // TODO: Implement actual registration\n  res.json({\n    success: true,\n    data: {\n      user: {\n        id: '1',\n        email,\n        name,\n        role: 'viewer',\n      },\n    },\n    message: 'Registration successful',\n  });\n});\n\nauthRouter.post('/logout', (req, res) => {\n  res.json({ success: true, message: 'Logout successful' });\n});\n\nauthRouter.get('/me', (req, res) => {\n  // TODO: Get from JWT token\n  res.json({\n    success: true,\n    data: {\n      id: '1',\n      email: 'admin@Billing.com',\n      name: 'Admin User',\n      role: 'admin',\n    },\n  });\n});\n\nexport default authRouter;\n","path":null,"size_bytes":1148,"size_tokens":null},"client/src/pages/delivery-challan-create.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport {\n  Calendar as CalendarIcon,\n  ChevronDown,\n  Plus,\n  Trash2,\n  Save,\n  X,\n  Search,\n  HelpCircle,\n  AlertCircle\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { cn } from \"@/lib/utils\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useTransactionBootstrap } from \"@/hooks/use-transaction-bootstrap\";\nimport { formatAddressDisplay } from \"@/lib/customer-snapshot\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Badge } from \"@/components/ui/badge\";\n\ninterface ChallanItem {\n  id: number;\n  name: string;\n  description: string;\n  hsnSac: string;\n  qty: number;\n  rate: number;\n  discountType: 'percentage' | 'flat';\n  discountValue: number;\n  gstRate: number;\n}\n\ninterface Customer {\n  id: string;\n  displayName: string;\n  companyName: string;\n  email: string;\n  gstin?: string;\n  billingAddress?: any;\n  shippingAddress?: any;\n}\n\ninterface InventoryItem {\n  id: string;\n  name: string;\n  description?: string;\n  hsnSac?: string;\n  rate?: string | number;\n  sellingPrice?: number;\n  unit?: string;\n  type?: string;\n  intraStateTax?: string;\n}\n\nconst CHALLAN_TYPES = [\n  { value: \"supply_on_approval\", label: \"Supply on Approval\" },\n  { value: \"supply_for_job_work\", label: \"Supply for Job Work\" },\n  { value: \"supply_for_repair\", label: \"Supply for Repair\" },\n  { value: \"removal_for_own_use\", label: \"Removal for Own Use\" },\n  { value: \"others\", label: \"Others\" }\n];\n\nconst TAX_OPTIONS = [\n  { label: \"Non-taxable\", value: -1 },\n  { label: \"GST0 [0%]\", value: 0 },\n  { label: \"GST5 [5%]\", value: 5 },\n  { label: \"GST12 [12%]\", value: 12 },\n  { label: \"GST18 [18%]\", value: 18 },\n  { label: \"GST28 [28%]\", value: 28 },\n];\n\nexport default function DeliveryChallanCreate() {\n  const [location, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  // Transaction bootstrap for auto-population\n  const {\n    customerId: bootstrapCustomerId,\n    customerSnapshot,\n    taxRegime,\n    isLoadingCustomer,\n    customerError,\n    formData: bootstrapFormData,\n    onCustomerChange\n  } = useTransactionBootstrap({ transactionType: 'delivery_challan' });\n\n  const [date, setDate] = useState<Date>(new Date());\n  const [challanNumber, setChallanNumber] = useState(\"\");\n  const [referenceNumber, setReferenceNumber] = useState(\"\");\n  const [selectedCustomerId, setSelectedCustomerId] = useState<string>(\"\");\n  const [challanType, setChallanType] = useState<string>(\"\");\n  const [customers, setCustomers] = useState<Customer[]>([]);\n  const [inventoryItems, setInventoryItems] = useState<InventoryItem[]>([]);\n  const [customerNotes, setCustomerNotes] = useState(\"\");\n  const [termsAndConditions, setTermsAndConditions] = useState(\"\");\n  const [adjustment, setAdjustment] = useState(0);\n  const [saving, setSaving] = useState(false);\n  const [customerIdFromUrl, setCustomerIdFromUrl] = useState<string | null>(null);\n  const [shippingAddress, setShippingAddress] = useState(\"\");\n\n  // Sync with bootstrap customer\n  useEffect(() => {\n    if (bootstrapCustomerId && !selectedCustomerId) {\n      setSelectedCustomerId(bootstrapCustomerId);\n    }\n  }, [bootstrapCustomerId]);\n\n  // Update shipping address when customer snapshot changes  \n  useEffect(() => {\n    if (customerSnapshot) {\n      const shippingAddr = formatAddressDisplay(customerSnapshot.shippingAddress);\n      if (shippingAddr) {\n        setShippingAddress(shippingAddr);\n      } else {\n        // Fallback to billing address\n        setShippingAddress(formatAddressDisplay(customerSnapshot.billingAddress));\n      }\n    }\n  }, [customerSnapshot]);\n\n  const [items, setItems] = useState<ChallanItem[]>([\n    {\n      id: 1,\n      name: \"\",\n      description: \"\",\n      hsnSac: \"\",\n      qty: 1,\n      rate: 0,\n      discountType: 'percentage',\n      discountValue: 0,\n      gstRate: 18\n    }\n  ]);\n\n  useEffect(() => {\n    fetchNextChallanNumber();\n    fetchCustomers();\n    fetchInventoryItems();\n\n    // Parse customerId from URL\n    const params = new URLSearchParams(location.split('?')[1]);\n    const urlCustomerId = params.get('customerId');\n    if (urlCustomerId) {\n      setCustomerIdFromUrl(urlCustomerId);\n    }\n  }, [location]);\n\n  // Set customer from URL after customers are loaded\n  useEffect(() => {\n    if (customerIdFromUrl && customers.length > 0) {\n      const customer = customers.find(c => c.id === customerIdFromUrl);\n      if (customer) {\n        setSelectedCustomerId(customer.id);\n        setCustomerIdFromUrl(null);\n      }\n    }\n  }, [customerIdFromUrl, customers]);\n\n  const fetchInventoryItems = async () => {\n    try {\n      const response = await fetch('/api/items');\n      if (response.ok) {\n        const data = await response.json();\n        setInventoryItems(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch items:', error);\n    }\n  };\n\n  const handleItemSelect = (challanItemId: number, inventoryItemId: string) => {\n    const inventoryItem = inventoryItems.find(i => i.id === inventoryItemId);\n    if (inventoryItem) {\n      // Parse rate - use rate field (for selling), handle string or number\n      const itemRate = typeof inventoryItem.rate === 'string'\n        ? parseFloat(inventoryItem.rate) || 0\n        : (inventoryItem.rate || inventoryItem.sellingPrice || 0);\n\n      // Parse GST rate from intraStateTax field (e.g., \"gst18\" -> 18)\n      let gstRate = 0;\n      if (inventoryItem.intraStateTax) {\n        const match = inventoryItem.intraStateTax.match(/\\d+/);\n        if (match) gstRate = parseInt(match[0]);\n      }\n\n      setItems(items.map(item => {\n        if (item.id === challanItemId) {\n          return {\n            ...item,\n            name: inventoryItem.name,\n            description: inventoryItem.description || \"\",\n            hsnSac: inventoryItem.hsnSac || \"\",\n            rate: itemRate,\n            gstRate: gstRate\n          };\n        }\n        return item;\n      }));\n    }\n  };\n\n  const fetchNextChallanNumber = async () => {\n    try {\n      const response = await fetch('/api/delivery-challans/next-number');\n      if (response.ok) {\n        const data = await response.json();\n        setChallanNumber(data.data.challanNumber.replace(\"DC-\", \"\"));\n      }\n    } catch (error) {\n      console.error('Failed to fetch next challan number:', error);\n    }\n  };\n\n  const fetchCustomers = async () => {\n    try {\n      const response = await fetch('/api/customers');\n      if (response.ok) {\n        const data = await response.json();\n        setCustomers(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch customers:', error);\n    }\n  };\n\n  const selectedCustomer = customers.find(c => c.id === selectedCustomerId);\n\n  const calculateLineItem = (item: ChallanItem) => {\n    const baseAmount = item.qty * item.rate;\n    let discountAmount = 0;\n    if (item.discountType === 'percentage') {\n      discountAmount = baseAmount * (Math.min(item.discountValue, 100) / 100);\n    } else {\n      discountAmount = item.discountValue;\n    }\n    discountAmount = Math.min(discountAmount, baseAmount);\n    const taxableAmount = baseAmount - discountAmount;\n    let taxAmount = 0;\n    if (item.gstRate > 0) {\n      taxAmount = taxableAmount * (item.gstRate / 100);\n    }\n    return {\n      baseAmount,\n      discountAmount,\n      taxableAmount,\n      taxAmount,\n      total: taxableAmount + taxAmount\n    };\n  };\n\n  const totals = items.reduce((acc, item) => {\n    const line = calculateLineItem(item);\n    return {\n      taxableSubtotal: acc.taxableSubtotal + line.taxableAmount,\n      totalTax: acc.totalTax + line.taxAmount,\n      grandTotal: acc.grandTotal + line.total\n    };\n  }, { taxableSubtotal: 0, totalTax: 0, grandTotal: 0 });\n\n  const finalTotal = totals.grandTotal + adjustment;\n\n  const updateItem = (id: number, field: keyof ChallanItem, value: any) => {\n    setItems(items.map(item => {\n      if (item.id === id) {\n        return { ...item, [field]: value };\n      }\n      return item;\n    }));\n  };\n\n  const addItem = () => {\n    setItems([...items, {\n      id: Math.random(),\n      name: \"\",\n      description: \"\",\n      hsnSac: \"\",\n      qty: 1,\n      rate: 0,\n      discountType: 'percentage',\n      discountValue: 0,\n      gstRate: 18\n    }]);\n  };\n\n  const removeItem = (id: number) => {\n    if (items.length > 1) {\n      setItems(items.filter(i => i.id !== id));\n    }\n  };\n\n  const handleCustomerChange = (value: string) => {\n    if (value === \"add_new_customer\") {\n      setLocation(\"/customers/new?returnTo=delivery-challans/new\");\n    } else {\n      setSelectedCustomerId(value);\n    }\n  };\n\n  const formatAddress = (address: any) => {\n    if (!address) return '';\n    if (typeof address === 'string') return address;\n    const parts = [address.street, address.city, address.state, address.country, address.pincode].filter(Boolean);\n    return parts.join('\\n');\n  };\n\n  const handleSave = async (status: 'DRAFT' | 'OPEN' = 'DRAFT') => {\n    if (!selectedCustomerId) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please select a customer.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    if (!challanType) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please select a challan type.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    const validItems = items.filter(item => item.name.trim() !== '');\n    if (validItems.length === 0) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please add at least one item with a name.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    const invalidItems = validItems.filter(item => item.qty <= 0 || item.rate < 0);\n    if (invalidItems.length > 0) {\n      toast({\n        title: \"Validation Error\",\n        description: \"All items must have a positive quantity and non-negative rate.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setSaving(true);\n\n    const challanItems = validItems.map(item => {\n      const lineCalc = calculateLineItem(item);\n      return {\n        id: String(item.id),\n        itemId: String(item.id),\n        name: item.name,\n        description: item.description,\n        hsnSac: item.hsnSac,\n        quantity: item.qty,\n        unit: 'pcs',\n        rate: item.rate,\n        discount: lineCalc.discountAmount,\n        discountType: item.discountType,\n        tax: lineCalc.taxAmount,\n        taxName: item.gstRate > 0 ? `GST${item.gstRate}` : 'Non-taxable',\n        amount: lineCalc.total\n      };\n    });\n\n    const challanData = {\n      date: format(date, \"yyyy-MM-dd\"),\n      referenceNumber,\n      customerId: selectedCustomerId,\n      customerName: selectedCustomer?.displayName || \"Unknown Customer\",\n      challanType,\n      billingAddress: selectedCustomer?.billingAddress || {},\n      shippingAddress: selectedCustomer?.shippingAddress || selectedCustomer?.billingAddress || {},\n      placeOfSupply: '',\n      gstin: selectedCustomer?.gstin || '',\n      items: challanItems,\n      subTotal: totals.taxableSubtotal,\n      cgst: totals.totalTax / 2,\n      sgst: totals.totalTax / 2,\n      igst: 0,\n      adjustment: adjustment,\n      total: finalTotal,\n      customerNotes,\n      termsAndConditions,\n      status\n    };\n\n    try {\n      const response = await fetch('/api/delivery-challans', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(challanData)\n      });\n\n      if (response.ok) {\n        const result = await response.json();\n        toast({\n          title: status === 'DRAFT' ? \"Saved as Draft\" : \"Delivery Challan Created\",\n          description: `Delivery Challan ${result.data.challanNumber} has been ${status === 'DRAFT' ? 'saved as draft' : 'created'}.`,\n        });\n        setLocation(\"/delivery-challans\");\n      } else {\n        throw new Error('Failed to create delivery challan');\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create delivery challan. Please try again.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const formatCurrency = (amount: number) => {\n    return `${amount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n  };\n\n  return (\n    <div className=\"max-w-6xl mx-auto space-y-6 pb-32 px-4 sm:px-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-foreground\">New Delivery Challan</h1>\n        </div>\n        <Button variant=\"ghost\" size=\"icon\" onClick={() => setLocation(\"/delivery-challans\")} data-testid=\"button-close\">\n          <X className=\"h-5 w-5\" />\n        </Button>\n      </div>\n\n      <Card className=\"border-border/60\">\n        <CardContent className=\"p-6 space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium text-destructive\">Customer Name*</Label>\n                <Select value={selectedCustomerId} onValueChange={handleCustomerChange}>\n                  <SelectTrigger className=\"w-full\" data-testid=\"select-customer\">\n                    <SelectValue placeholder=\"Select or add a customer\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {customers.map((customer) => (\n                      <SelectItem key={customer.id} value={customer.id}>\n                        {customer.displayName}\n                      </SelectItem>\n                    ))}\n                    <Separator className=\"my-1\" />\n                    <SelectItem value=\"add_new_customer\" className=\"text-primary font-medium\">\n                      <div className=\"flex items-center gap-2\">\n                        <Plus className=\"h-4 w-4\" />\n                        New Customer\n                      </div>\n                    </SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium text-destructive\">Delivery Challan#*</Label>\n                <div className=\"flex items-center\">\n                  <span className=\"bg-muted border border-r-0 border-border rounded-l-md px-3 py-2 text-sm text-muted-foreground\">DC-</span>\n                  <Input\n                    value={challanNumber}\n                    onChange={(e) => setChallanNumber(e.target.value)}\n                    className=\"rounded-l-none\"\n                    data-testid=\"input-challan-number\"\n                  />\n                  <Button variant=\"ghost\" size=\"icon\" className=\"ml-1\">\n                    <HelpCircle className=\"h-4 w-4 text-muted-foreground\" />\n                  </Button>\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium\">Reference#</Label>\n                <Input\n                  value={referenceNumber}\n                  onChange={(e) => setReferenceNumber(e.target.value)}\n                  placeholder=\"\"\n                  data-testid=\"input-reference-number\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium text-destructive\">Delivery Challan Date*</Label>\n                <Popover>\n                  <PopoverTrigger asChild>\n                    <Button\n                      variant=\"outline\"\n                      className={cn(\"w-full justify-start text-left font-normal\", !date && \"text-muted-foreground\")}\n                      data-testid=\"button-date\"\n                    >\n                      <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                      {date ? format(date, \"dd/MM/yyyy\") : \"Select date\"}\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                    <Calendar\n                      mode=\"single\"\n                      selected={date}\n                      onSelect={(d) => d && setDate(d)}\n                      initialFocus\n                    />\n                  </PopoverContent>\n                </Popover>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium text-destructive\">Challan Type*</Label>\n                <Select value={challanType} onValueChange={setChallanType}>\n                  <SelectTrigger className=\"w-full\" data-testid=\"select-challan-type\">\n                    <SelectValue placeholder=\"Choose a proper challan type.\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {CHALLAN_TYPES.map((type) => (\n                      <SelectItem key={type.value} value={type.value}>\n                        {type.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"mt-8\">\n            <div className=\"bg-muted/50 rounded-t-lg p-3\">\n              <h3 className=\"font-medium\">Item Table</h3>\n            </div>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead className=\"w-[300px]\">Item Details</TableHead>\n                  <TableHead className=\"text-center\">Quantity</TableHead>\n                  <TableHead className=\"text-center\">Rate</TableHead>\n                  <TableHead className=\"text-center\">Discount</TableHead>\n                  <TableHead className=\"text-center\">Tax</TableHead>\n                  <TableHead className=\"text-right\">Amount</TableHead>\n                  <TableHead className=\"w-10\"></TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {items.map((item, index) => {\n                  const lineCalc = calculateLineItem(item);\n                  return (\n                    <TableRow key={item.id}>\n                      <TableCell>\n                        <Select\n                          value={inventoryItems.find(inv => inv.name === item.name)?.id || \"\"}\n                          onValueChange={(v) => handleItemSelect(item.id, v)}\n                        >\n                          <SelectTrigger className=\"w-full\" data-testid={`select-item-${index}`}>\n                            <SelectValue placeholder=\"Select an item\">\n                              {item.name || \"Select an item\"}\n                            </SelectValue>\n                          </SelectTrigger>\n                          <SelectContent>\n                            {inventoryItems.map((invItem) => (\n                              <SelectItem key={invItem.id} value={invItem.id}>\n                                {invItem.name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </TableCell>\n                      <TableCell>\n                        <Input\n                          type=\"number\"\n                          value={item.qty}\n                          onChange={(e) => updateItem(item.id, 'qty', parseFloat(e.target.value) || 0)}\n                          className=\"w-20 text-center\"\n                          data-testid={`input-qty-${index}`}\n                        />\n                      </TableCell>\n                      <TableCell>\n                        <Input\n                          type=\"number\"\n                          value={item.rate}\n                          onChange={(e) => updateItem(item.id, 'rate', parseFloat(e.target.value) || 0)}\n                          className=\"w-24 text-right\"\n                          data-testid={`input-rate-${index}`}\n                        />\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-1\">\n                          <Input\n                            type=\"number\"\n                            value={item.discountValue}\n                            onChange={(e) => updateItem(item.id, 'discountValue', parseFloat(e.target.value) || 0)}\n                            className=\"w-16 text-right\"\n                            data-testid={`input-discount-${index}`}\n                          />\n                          <Select\n                            value={item.discountType}\n                            onValueChange={(v) => updateItem(item.id, 'discountType', v)}\n                          >\n                            <SelectTrigger className=\"w-14 px-1\">\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"percentage\">%</SelectItem>\n                              <SelectItem value=\"flat\">Rs</SelectItem>\n                            </SelectContent>\n                          </Select>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Select\n                          value={String(item.gstRate)}\n                          onValueChange={(v) => updateItem(item.id, 'gstRate', parseInt(v))}\n                        >\n                          <SelectTrigger className=\"w-32\" data-testid={`select-tax-${index}`}>\n                            <SelectValue placeholder=\"Select a Tax\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {TAX_OPTIONS.map((tax) => (\n                              <SelectItem key={tax.value} value={String(tax.value)}>\n                                {tax.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </TableCell>\n                      <TableCell className=\"text-right font-medium\">\n                        {formatCurrency(lineCalc.total)}\n                      </TableCell>\n                      <TableCell>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => removeItem(item.id)}\n                          disabled={items.length === 1}\n                          data-testid={`button-remove-item-${index}`}\n                        >\n                          <X className=\"h-4 w-4 text-destructive\" />\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  );\n                })}\n              </TableBody>\n            </Table>\n\n            <div className=\"flex gap-4 mt-4\">\n              <Button variant=\"outline\" size=\"sm\" onClick={addItem} className=\"gap-1\" data-testid=\"button-add-row\">\n                <Plus className=\"h-4 w-4\" />\n                Add New Row\n              </Button>\n              <Button variant=\"outline\" size=\"sm\" className=\"gap-1\" data-testid=\"button-add-bulk\">\n                <Plus className=\"h-4 w-4\" />\n                Add Items in Bulk\n              </Button>\n            </div>\n\n            <div className=\"flex justify-between mt-8\">\n              <div className=\"w-1/2 pr-8 space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label className=\"text-sm font-medium\">Customer Notes</Label>\n                  <Textarea\n                    value={customerNotes}\n                    onChange={(e) => setCustomerNotes(e.target.value)}\n                    placeholder=\"Enter any notes to be displayed in your transaction\"\n                    className=\"min-h-[80px]\"\n                    data-testid=\"textarea-customer-notes\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"w-1/2 space-y-3\">\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-sm font-medium\">Sub Total</span>\n                  <span className=\"font-semibold\">{formatCurrency(totals.taxableSubtotal)}</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm\">Adjustment</span>\n                  <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\">\n                    <HelpCircle className=\"h-4 w-4 text-muted-foreground\" />\n                  </Button>\n                  <Input\n                    type=\"number\"\n                    value={adjustment}\n                    onChange={(e) => setAdjustment(parseFloat(e.target.value) || 0)}\n                    className=\"w-28 text-right\"\n                    data-testid=\"input-adjustment\"\n                  />\n                  <span className=\"text-sm\">{formatCurrency(adjustment)}</span>\n                </div>\n                <Separator />\n                <div className=\"flex justify-between items-center text-lg font-bold\">\n                  <span>Total ()</span>\n                  <span>{formatCurrency(finalTotal)}</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <Separator />\n\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">Terms & Conditions</Label>\n              <Textarea\n                value={termsAndConditions}\n                onChange={(e) => setTermsAndConditions(e.target.value)}\n                placeholder=\"Enter the terms and conditions of your business to be displayed in your transaction\"\n                className=\"min-h-[80px]\"\n                data-testid=\"textarea-terms\"\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"fixed bottom-0 left-0 right-0 bg-background border-t border-border p-4\">\n        <div className=\"max-w-6xl mx-auto flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => handleSave('DRAFT')}\n              disabled={saving}\n              data-testid=\"button-save-draft\"\n            >\n              Save as Draft\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={() => setLocation(\"/delivery-challans\")}\n              data-testid=\"button-cancel\"\n            >\n              Cancel\n            </Button>\n          </div>\n          <div className=\"text-sm text-muted-foreground\">\n            PDF Template: 'Standard Template' <span className=\"text-primary cursor-pointer\">Change</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":27526,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/api/client.ts":{"content":"import { config } from '@/config';\n\ninterface RequestOptions extends RequestInit {\n  params?: Record<string, string | number | boolean | undefined>;\n}\n\ninterface ApiResponse<T> {\n  data: T;\n  message?: string;\n  success: boolean;\n}\n\nclass ApiClient {\n  private baseUrl: string;\n  private defaultHeaders: HeadersInit;\n\n  constructor(baseUrl: string) {\n    this.baseUrl = baseUrl;\n    this.defaultHeaders = {\n      'Content-Type': 'application/json',\n    };\n  }\n\n  private getAuthToken(): string | null {\n    const authStorage = localStorage.getItem('auth-storage');\n    if (authStorage) {\n      const parsed = JSON.parse(authStorage);\n      return parsed?.state?.token || null;\n    }\n    return null;\n  }\n\n  private buildUrl(endpoint: string, params?: Record<string, string | number | boolean | undefined>): string {\n    const url = new URL(`${this.baseUrl}${endpoint}`, window.location.origin);\n    if (params) {\n      Object.entries(params).forEach(([key, value]) => {\n        if (value !== undefined) {\n          url.searchParams.append(key, String(value));\n        }\n      });\n    }\n    return url.toString();\n  }\n\n  private async request<T>(endpoint: string, options: RequestOptions = {}): Promise<T> {\n    const { params, ...fetchOptions } = options;\n    const url = this.buildUrl(endpoint, params);\n    const token = this.getAuthToken();\n\n    const headers: HeadersInit = {\n      ...this.defaultHeaders,\n      ...options.headers,\n    };\n\n    if (token) {\n      (headers as Record<string, string>)['Authorization'] = `Bearer ${token}`;\n    }\n\n    const response = await fetch(url, {\n      ...fetchOptions,\n      headers,\n    });\n\n    if (!response.ok) {\n      const error = await response.json().catch(() => ({ message: 'An error occurred' }));\n      throw new Error(error.message || `HTTP error! status: ${response.status}`);\n    }\n\n    return response.json();\n  }\n\n  async get<T>(endpoint: string, options?: RequestOptions): Promise<T> {\n    return this.request<T>(endpoint, { ...options, method: 'GET' });\n  }\n\n  async post<T>(endpoint: string, data?: unknown, options?: RequestOptions): Promise<T> {\n    return this.request<T>(endpoint, {\n      ...options,\n      method: 'POST',\n      body: data ? JSON.stringify(data) : undefined,\n    });\n  }\n\n  async put<T>(endpoint: string, data?: unknown, options?: RequestOptions): Promise<T> {\n    return this.request<T>(endpoint, {\n      ...options,\n      method: 'PUT',\n      body: data ? JSON.stringify(data) : undefined,\n    });\n  }\n\n  async patch<T>(endpoint: string, data?: unknown, options?: RequestOptions): Promise<T> {\n    return this.request<T>(endpoint, {\n      ...options,\n      method: 'PATCH',\n      body: data ? JSON.stringify(data) : undefined,\n    });\n  }\n\n  async delete<T>(endpoint: string, options?: RequestOptions): Promise<T> {\n    return this.request<T>(endpoint, { ...options, method: 'DELETE' });\n  }\n}\n\nexport const apiClient = new ApiClient(config.apiBaseUrl);\nexport default apiClient;\n","path":null,"size_bytes":2964,"size_tokens":null},"client/src/modules/documents/pages/DocumentsPage.tsx":{"content":"export { default } from '@/pages/documents';\n","path":null,"size_bytes":45,"size_tokens":null},"client/src/modules/sales/pages/InvoicesPage.tsx":{"content":"export { default } from '@/pages/invoices';\n","path":null,"size_bytes":44,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7406,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"server/src/config/index.ts":{"content":"export { db, pool, getDb } from './database';\nexport { env, isDev, isProd, isTest } from './env';\n","path":null,"size_bytes":98,"size_tokens":null},"client/src/pages/documents.tsx":{"content":"import { Plus, Search, Filter, FolderOpen, Upload, FileText, Image, File } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent } from \"@/components/ui/card\";\n\nexport default function Documents() {\n  return (\n    <div className=\"max-w-7xl mx-auto space-y-6 animate-in fade-in duration-500\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl sm:text-3xl font-display font-bold text-foreground tracking-tight\">Documents</h1>\n          <p className=\"text-muted-foreground\">Store and organize all your business documents in one place.</p>\n        </div>\n        <Button className=\"gap-2 shadow-lg shadow-primary/20\">\n          <Upload className=\"h-4 w-4\" /> Upload Document\n        </Button>\n      </div>\n\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"relative flex-1\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input placeholder=\"Search documents...\" className=\"pl-9\" />\n        </div>\n        <Button variant=\"outline\" className=\"gap-2\">\n          <Filter className=\"h-4 w-4\" /> Filter\n        </Button>\n      </div>\n\n      <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\n        <Card className=\"cursor-pointer hover:shadow-md transition-shadow\">\n          <CardContent className=\"flex flex-col items-center justify-center py-8 text-center\">\n            <div className=\"h-12 w-12 rounded-lg bg-blue-100 flex items-center justify-center mb-3\">\n              <FileText className=\"h-6 w-6 text-blue-600\" />\n            </div>\n            <p className=\"font-medium\">Invoices</p>\n            <p className=\"text-sm text-muted-foreground\">0 files</p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"cursor-pointer hover:shadow-md transition-shadow\">\n          <CardContent className=\"flex flex-col items-center justify-center py-8 text-center\">\n            <div className=\"h-12 w-12 rounded-lg bg-green-100 flex items-center justify-center mb-3\">\n              <File className=\"h-6 w-6 text-green-600\" />\n            </div>\n            <p className=\"font-medium\">Receipts</p>\n            <p className=\"text-sm text-muted-foreground\">0 files</p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"cursor-pointer hover:shadow-md transition-shadow\">\n          <CardContent className=\"flex flex-col items-center justify-center py-8 text-center\">\n            <div className=\"h-12 w-12 rounded-lg bg-purple-100 flex items-center justify-center mb-3\">\n              <Image className=\"h-6 w-6 text-purple-600\" />\n            </div>\n            <p className=\"font-medium\">Contracts</p>\n            <p className=\"text-sm text-muted-foreground\">0 files</p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"cursor-pointer hover:shadow-md transition-shadow border-dashed\">\n          <CardContent className=\"flex flex-col items-center justify-center py-8 text-center\">\n            <div className=\"h-12 w-12 rounded-lg bg-muted flex items-center justify-center mb-3\">\n              <FolderOpen className=\"h-6 w-6 text-muted-foreground\" />\n            </div>\n            <p className=\"font-medium text-muted-foreground\">New Folder</p>\n            <p className=\"text-sm text-muted-foreground\">Create folder</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card className=\"border-dashed\">\n        <CardContent className=\"flex flex-col items-center justify-center py-16 text-center\">\n          <div className=\"h-16 w-16 rounded-full bg-muted flex items-center justify-center mb-4\">\n            <Upload className=\"h-8 w-8 text-muted-foreground\" />\n          </div>\n          <h3 className=\"text-lg font-semibold mb-2\">Drop files here to upload</h3>\n          <p className=\"text-muted-foreground mb-4 max-w-sm\">\n            Drag and drop files or click the upload button to add documents.\n          </p>\n          <Button variant=\"outline\" className=\"gap-2\">\n            <Upload className=\"h-4 w-4\" /> Browse Files\n          </Button>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":4226,"size_tokens":null},"client/src/pages/customers.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { \n  Plus, \n  Search, \n  Filter, \n  MoreHorizontal, \n  Pencil, \n  Trash2, \n  ChevronDown,\n  ChevronRight,\n  X,\n  Copy,\n  UserMinus,\n  UserCheck,\n  Mail,\n  Phone,\n  MapPin,\n  Building2,\n  FileText,\n  Receipt,\n  CreditCard,\n  FileCheck,\n  Package,\n  Truck,\n  RefreshCw,\n  Wallet,\n  BookOpen,\n  FolderKanban,\n  BadgeIndianRupee,\n  Send,\n  Bold,\n  Italic,\n  Underline,\n  Printer,\n  Download,\n  Calendar,\n  Link2,\n  Clock,\n  User\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n  DropdownMenuLabel\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Collapsible,\n  CollapsibleContent,\n  CollapsibleTrigger,\n} from \"@/components/ui/collapsible\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { usePagination } from \"@/hooks/use-pagination\";\nimport { TablePagination } from \"@/components/table-pagination\";\n\ninterface CustomerListItem {\n  id: string;\n  name: string;\n  email: string;\n  phone: string;\n  status?: string;\n  companyName?: string;\n  placeOfSupply?: string;\n  outstandingReceivables?: number;\n  unusedCredits?: number;\n  billingAddress?: {\n    street: string;\n    city: string;\n    state: string;\n    country: string;\n    pincode: string;\n  };\n}\n\ninterface CustomerDetail {\n  id: string;\n  name: string;\n  email: string;\n  phone: string;\n  status?: string;\n  contactPerson?: string;\n  gstin?: string;\n  gstTreatment?: string;\n  paymentTerms?: string;\n  currency?: string;\n  businessLegalName?: string;\n  placeOfSupply?: string;\n  billingAddress?: {\n    street: string;\n    city: string;\n    state: string;\n    country: string;\n    pincode: string;\n  };\n  shippingAddress?: {\n    street: string;\n    city: string;\n    state: string;\n    country: string;\n    pincode: string;\n  };\n  createdAt?: string;\n  outstandingReceivables?: number;\n  unusedCredits?: number;\n}\n\ninterface Comment {\n  id: string;\n  text: string;\n  author: string;\n  createdAt: string;\n}\n\ninterface Transaction {\n  id: string;\n  type: string;\n  date: string;\n  number: string;\n  orderNumber?: string;\n  amount: number;\n  balance: number;\n  status: string;\n  referenceNumber?: string;\n}\n\ninterface SystemMail {\n  id: string;\n  to: string;\n  subject: string;\n  description: string;\n  sentAt: string;\n}\n\ninterface ActivityItem {\n  id: string;\n  type: string;\n  title: string;\n  description: string;\n  user: string;\n  date: string;\n  time: string;\n}\n\nconst formatAddress = (address: any) => {\n  if (!address) return ['-'];\n  const parts = [address.street, address.city, address.state, address.country, address.pincode].filter(Boolean);\n  return parts.length > 0 ? parts : ['-'];\n};\n\nconst formatDate = (dateString: string) => {\n  const date = new Date(dateString);\n  return date.toLocaleDateString('en-IN', { day: '2-digit', month: '2-digit', year: 'numeric' });\n};\n\nconst formatDateTime = (dateString: string) => {\n  const date = new Date(dateString);\n  return {\n    date: date.toLocaleDateString('en-IN', { day: '2-digit', month: '2-digit', year: 'numeric' }),\n    time: date.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', hour12: true })\n  };\n};\n\nconst formatCurrency = (amount: number) => {\n  return new Intl.NumberFormat('en-IN', {\n    style: 'currency',\n    currency: 'INR',\n    minimumFractionDigits: 2\n  }).format(amount);\n};\n\ninterface CustomerDetailPanelProps {\n  customer: CustomerDetail;\n  onClose: () => void;\n  onEdit: () => void;\n  onClone: () => void;\n  onToggleStatus: () => void;\n  onDelete: () => void;\n}\n\nfunction CustomerDetailPanel({ customer, onClose, onEdit, onClone, onToggleStatus, onDelete }: CustomerDetailPanelProps) {\n  const [, setLocation] = useLocation();\n  const [activeTab, setActiveTab] = useState(\"overview\");\n  const { toast } = useToast();\n  \n  const [comments, setComments] = useState<Comment[]>([]);\n  const [newComment, setNewComment] = useState(\"\");\n  const [transactions, setTransactions] = useState<Record<string, Transaction[]>>({\n    invoices: [],\n    customerPayments: [],\n    quotes: [],\n    salesOrders: [],\n    deliveryChallans: [],\n    recurringInvoices: [],\n    expenses: [],\n    projects: [],\n    journals: [],\n    bills: [],\n    creditNotes: []\n  });\n  const [mails, setMails] = useState<SystemMail[]>([]);\n  const [activities, setActivities] = useState<ActivityItem[]>([]);\n  \n  const [expandedSections, setExpandedSections] = useState<Record<string, boolean>>({\n    invoices: true,\n    customerPayments: true,\n    quotes: false,\n    salesOrders: false,\n    deliveryChallans: false,\n    recurringInvoices: false,\n    expenses: false,\n    projects: false,\n    journals: false,\n    bills: false,\n    creditNotes: false\n  });\n  \n  const [statementPeriod, setStatementPeriod] = useState(\"this-month\");\n  const [statementFilter, setStatementFilter] = useState(\"all\");\n\n  useEffect(() => {\n    fetchCustomerData();\n  }, [customer.id]);\n\n  const fetchCustomerData = async () => {\n    try {\n      const [commentsRes, transactionsRes, mailsRes, activitiesRes] = await Promise.all([\n        fetch(`/api/customers/${customer.id}/comments`),\n        fetch(`/api/customers/${customer.id}/transactions`),\n        fetch(`/api/customers/${customer.id}/mails`),\n        fetch(`/api/customers/${customer.id}/activities`)\n      ]);\n      \n      if (commentsRes.ok) {\n        const data = await commentsRes.json();\n        setComments(data.data || []);\n      }\n      if (transactionsRes.ok) {\n        const data = await transactionsRes.json();\n        setTransactions(data.data || transactions);\n      }\n      if (mailsRes.ok) {\n        const data = await mailsRes.json();\n        setMails(data.data || []);\n      }\n      if (activitiesRes.ok) {\n        const data = await activitiesRes.json();\n        setActivities(data.data || []);\n      }\n    } catch (error) {\n      console.error('Error fetching customer data:', error);\n    }\n  };\n\n  const handleAddComment = async () => {\n    if (!newComment.trim()) return;\n    try {\n      const response = await fetch(`/api/customers/${customer.id}/comments`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ text: newComment })\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setComments([...comments, data.data]);\n        setNewComment(\"\");\n        toast({ title: \"Comment added successfully\" });\n      }\n    } catch (error) {\n      toast({ title: \"Failed to add comment\", variant: \"destructive\" });\n    }\n  };\n\n  const toggleSection = (section: string) => {\n    setExpandedSections(prev => ({ ...prev, [section]: !prev[section] }));\n  };\n\n  const handleNewTransaction = (type: string) => {\n    const availableRoutes: Record<string, string> = {\n      invoice: `/invoices/create?customerId=${customer.id}`,\n      quote: `/quotes/create?customerId=${customer.id}`,\n      \"sales-order\": `/sales-orders/create?customerId=${customer.id}`,\n      \"delivery-challan\": `/delivery-challans/create?customerId=${customer.id}`,\n      payment: `/payments-received/create?customerId=${customer.id}`,\n      \"credit-note\": `/credit-notes/create?customerId=${customer.id}`,\n      expense: `/expenses?customerId=${customer.id}`,\n    };\n    const unavailableTypes = [\"recurring-invoice\", \"journal\", \"project\"];\n    \n    if (unavailableTypes.includes(type)) {\n      toast({ \n        title: \"Feature coming soon\", \n        description: \"This feature is not yet available. Please check back later.\",\n      });\n      return;\n    }\n    setLocation(availableRoutes[type] || `/invoices/create?customerId=${customer.id}`);\n  };\n\n  const transactionSections = [\n    { key: 'invoices', label: 'Invoices', columns: ['DATE', 'INVOICE N...', 'ORDER NU...', 'AMOUNT', 'BALANCE D...', 'STATUS'] },\n    { key: 'customerPayments', label: 'Customer Payments', columns: ['DATE', 'PAYMEN...', 'REFERE...', 'PAYMEN...', 'AMOUNT', 'UNUSED...', 'STATUS'] },\n    { key: 'quotes', label: 'Quotes', columns: ['DATE', 'QUOTE N...', 'REFERENCE', 'AMOUNT', 'STATUS'] },\n    { key: 'salesOrders', label: 'Sales Orders', columns: ['DATE', 'SO N...', 'REFERENCE', 'AMOUNT', 'STATUS'] },\n    { key: 'deliveryChallans', label: 'Delivery Challans', columns: ['DATE', 'CHALLAN N...', 'REFERENCE', 'STATUS'] },\n    // { key: 'recurringInvoices', label: 'Recurring Invoices', columns: ['PROFILE NAME', 'FREQUENCY', 'LAST INVOICE', 'NEXT INVOICE', 'STATUS'] },\n    { key: 'expenses', label: 'Expenses', columns: ['DATE', 'EXPENSE N...', 'CATEGORY', 'AMOUNT', 'STATUS'] },\n    // { key: 'projects', label: 'Projects', columns: ['PROJECT NAME', 'BILLING METHOD', 'STATUS'] },\n    // { key: 'journals', label: 'Journals', columns: ['DATE', 'JOURNAL N...', 'REFERENCE', 'NOTES'] },\n    { key: 'bills', label: 'Bills', columns: ['DATE', 'BILL N...', 'VENDOR', 'AMOUNT', 'STATUS'] },\n    { key: 'creditNotes', label: 'Credit Notes', columns: ['DATE', 'CREDIT NOTE N...', 'AMOUNT', 'BALANCE', 'STATUS'] }\n  ];\n\n  return (\n    <div className=\"h-full flex flex-col bg-white dark:bg-slate-900 border-l border-slate-200 dark:border-slate-700\">\n      <div className=\"flex items-center justify-between px-6 py-4 border-b border-slate-200 dark:border-slate-700\">\n        <div className=\"flex items-center gap-3\">\n          <Button variant=\"ghost\" size=\"icon\" onClick={onClose} className=\"h-8 w-8\">\n            <ChevronDown className=\"h-4 w-4 rotate-90\" />\n          </Button>\n          <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white truncate\" data-testid=\"text-customer-name\">{customer.name}</h2>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button variant=\"outline\" size=\"sm\" onClick={onEdit} data-testid=\"button-edit-customer\">\n            Edit\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n            <FileText className=\"h-4 w-4\" />\n          </Button>\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button className=\"bg-blue-600 hover:bg-blue-700 gap-1.5\" size=\"sm\" data-testid=\"button-new-transaction\">\n                New Transaction\n                <ChevronDown className=\"h-3 w-3\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\" className=\"w-56\">\n              <DropdownMenuLabel className=\"text-xs text-slate-500\">SALES</DropdownMenuLabel>\n              <DropdownMenuItem onClick={() => handleNewTransaction(\"invoice\")} data-testid=\"menu-item-invoice\">\n                <Receipt className=\"mr-2 h-4 w-4\" /> Invoice\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => handleNewTransaction(\"payment\")} data-testid=\"menu-item-payment\">\n                <CreditCard className=\"mr-2 h-4 w-4\" /> Customer Payment\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => handleNewTransaction(\"quote\")} data-testid=\"menu-item-quote\">\n                <FileCheck className=\"mr-2 h-4 w-4\" /> Quote\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => handleNewTransaction(\"sales-order\")} data-testid=\"menu-item-sales-order\">\n                <Package className=\"mr-2 h-4 w-4\" /> Sales Order\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => handleNewTransaction(\"delivery-challan\")} data-testid=\"menu-item-delivery-challan\">\n                <Truck className=\"mr-2 h-4 w-4\" /> Delivery Challan\n              </DropdownMenuItem>\n              {/* <DropdownMenuItem onClick={() => handleNewTransaction(\"recurring-invoice\")} data-testid=\"menu-item-recurring-invoice\">\n                <RefreshCw className=\"mr-2 h-4 w-4\" /> Recurring Invoice\n              </DropdownMenuItem> */}\n              <DropdownMenuSeparator />\n              <DropdownMenuItem onClick={() => handleNewTransaction(\"expense\")} data-testid=\"menu-item-expense\">\n                <Wallet className=\"mr-2 h-4 w-4\" /> Expense\n              </DropdownMenuItem>\n              {/* <DropdownMenuItem onClick={() => handleNewTransaction(\"journal\")} data-testid=\"menu-item-journal\">\n                <BookOpen className=\"mr-2 h-4 w-4\" /> Journal\n              </DropdownMenuItem> */}\n              <DropdownMenuItem onClick={() => handleNewTransaction(\"credit-note\")} data-testid=\"menu-item-credit-note\">\n                <BadgeIndianRupee className=\"mr-2 h-4 w-4\" /> Credit Note\n              </DropdownMenuItem>\n              {/* <DropdownMenuItem onClick={() => handleNewTransaction(\"project\")} data-testid=\"menu-item-project\">\n                <FolderKanban className=\"mr-2 h-4 w-4\" /> Project\n              </DropdownMenuItem> */}\n            </DropdownMenuContent>\n          </DropdownMenu>\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"outline\" size=\"sm\" className=\"gap-1.5\" data-testid=\"button-more-options\">\n                More\n                <ChevronDown className=\"h-3 w-3\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\" className=\"w-48\">\n              <DropdownMenuItem onClick={onClone} data-testid=\"menu-item-clone\">\n                <Copy className=\"mr-2 h-4 w-4\" /> Clone\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={onToggleStatus} data-testid=\"menu-item-toggle-status\">\n                {customer.status === \"active\" ? (\n                  <><UserMinus className=\"mr-2 h-4 w-4\" /> Mark as Inactive</>\n                ) : (\n                  <><UserCheck className=\"mr-2 h-4 w-4\" /> Mark as Active</>\n                )}\n              </DropdownMenuItem>\n              <DropdownMenuSeparator />\n              <DropdownMenuItem onClick={onDelete} className=\"text-destructive focus:text-destructive\" data-testid=\"menu-item-delete\">\n                <Trash2 className=\"mr-2 h-4 w-4\" /> Delete\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={onClose} data-testid=\"button-close-panel\">\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"flex-1 flex flex-col overflow-hidden\">\n        <div className=\"flex items-center px-6 border-b border-slate-200 dark:border-slate-700\">\n          <TabsList className=\"h-auto p-0 bg-transparent\">\n            <TabsTrigger \n              value=\"overview\" \n              className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n              data-testid=\"tab-overview\"\n            >\n              Overview\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"comments\" \n              className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n              data-testid=\"tab-comments\"\n            >\n              Comments\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"transactions\" \n              className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n              data-testid=\"tab-transactions\"\n            >\n              Transactions\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"mails\" \n              className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n              data-testid=\"tab-mails\"\n            >\n              Mails\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"statement\" \n              className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent px-4 py-3\"\n              data-testid=\"tab-statement\"\n            >\n              Statement\n            </TabsTrigger>\n          </TabsList>\n        </div>\n\n        <TabsContent value=\"overview\" className=\"flex-1 overflow-auto mt-0\">\n          <div className=\"flex h-full\">\n            <div className=\"w-72 border-r border-slate-200 dark:border-slate-700 p-6 overflow-auto\">\n              <div className=\"space-y-6\">\n                <div>\n                  <h3 className=\"text-lg font-semibold text-slate-900 dark:text-white\">{customer.name}</h3>\n                  {customer.contactPerson && (\n                    <div className=\"flex items-center gap-2 mt-3\">\n                      <div className=\"h-10 w-10 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center\">\n                        <User className=\"h-5 w-5 text-slate-500\" />\n                      </div>\n                      <div>\n                        <p className=\"text-sm font-medium\">{customer.contactPerson}</p>\n                        <p className=\"text-xs text-blue-600\">{customer.email}</p>\n                      </div>\n                    </div>\n                  )}\n                  {!customer.contactPerson && customer.email && (\n                    <p className=\"text-sm text-blue-600 mt-2\">{customer.email}</p>\n                  )}\n                  <button className=\"text-sm text-blue-600 mt-1\">Invite to Portal</button>\n                </div>\n\n                <Collapsible defaultOpen>\n                  <CollapsibleTrigger className=\"flex items-center justify-between w-full text-sm font-medium text-slate-500\">\n                    ADDRESS\n                    <ChevronDown className=\"h-4 w-4\" />\n                  </CollapsibleTrigger>\n                  <CollapsibleContent className=\"mt-3 space-y-4\">\n                    <div>\n                      <div className=\"flex items-center justify-between\">\n                        <p className=\"text-sm text-slate-500\">Billing Address</p>\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\">\n                          <Pencil className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                      <div className=\"text-sm mt-1\">\n                        {formatAddress(customer.billingAddress).map((line, i) => (\n                          <p key={i}>{line}</p>\n                        ))}\n                      </div>\n                    </div>\n                    <div>\n                      <div className=\"flex items-center justify-between\">\n                        <p className=\"text-sm text-slate-500\">Shipping Address</p>\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\">\n                          <Pencil className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                      <div className=\"text-sm mt-1\">\n                        {formatAddress(customer.shippingAddress).map((line, i) => (\n                          <p key={i}>{line}</p>\n                        ))}\n                      </div>\n                    </div>\n                    <button className=\"text-sm text-blue-600\">Add additional address</button>\n                  </CollapsibleContent>\n                </Collapsible>\n\n                <Collapsible defaultOpen>\n                  <CollapsibleTrigger className=\"flex items-center justify-between w-full text-sm font-medium text-slate-500\">\n                    OTHER DETAILS\n                    <ChevronDown className=\"h-4 w-4\" />\n                  </CollapsibleTrigger>\n                  <CollapsibleContent className=\"mt-3 space-y-3 text-sm\">\n                    <div>\n                      <p className=\"text-slate-500\">Customer Type</p>\n                      <p className=\"font-medium\">Business</p>\n                    </div>\n                    <div>\n                      <p className=\"text-slate-500\">Default Currency</p>\n                      <p className=\"font-medium\">{customer.currency || 'INR'}</p>\n                    </div>\n                    {customer.businessLegalName && (\n                      <div>\n                        <p className=\"text-slate-500\">Business Legal Name</p>\n                        <p className=\"font-medium\">{customer.businessLegalName}</p>\n                      </div>\n                    )}\n                    {customer.gstTreatment && (\n                      <div>\n                        <p className=\"text-slate-500\">GST Treatment</p>\n                        <p className=\"font-medium\">{customer.gstTreatment}</p>\n                      </div>\n                    )}\n                    {customer.gstin && (\n                      <div>\n                        <p className=\"text-slate-500\">GSTIN</p>\n                        <p className=\"font-medium\">{customer.gstin}</p>\n                      </div>\n                    )}\n                    {customer.placeOfSupply && (\n                      <div>\n                        <p className=\"text-slate-500\">Place of Supply</p>\n                        <p className=\"font-medium\">{customer.placeOfSupply}</p>\n                      </div>\n                    )}\n                  </CollapsibleContent>\n                </Collapsible>\n              </div>\n            </div>\n\n            <div className=\"flex-1 p-6 overflow-auto\">\n              <div className=\"max-w-2xl\">\n                <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6\">\n                  <p className=\"text-sm text-blue-800 dark:text-blue-200\">\n                    You can request your contact to directly update the GSTIN by sending an email.{' '}\n                    <button className=\"text-blue-600 font-medium\">Send email</button>\n                  </p>\n                </div>\n\n                <div className=\"mb-6\">\n                  <p className=\"text-sm text-slate-500\">Payment due period</p>\n                  <p className=\"text-sm font-medium\">{customer.paymentTerms || 'Due on Receipt'}</p>\n                </div>\n\n                <div className=\"mb-6\">\n                  <h4 className=\"text-lg font-semibold mb-4\">Receivables</h4>\n                  <table className=\"w-full text-sm\">\n                    <thead>\n                      <tr className=\"text-left text-slate-500 border-b\">\n                        <th className=\"py-2\">CURRENCY</th>\n                        <th className=\"py-2 text-right\">OUTSTANDING RECEIVABLES</th>\n                        <th className=\"py-2 text-right\">UNUSED CREDITS</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      <tr>\n                        <td className=\"py-2\">INR- Indian Rupee</td>\n                        <td className=\"py-2 text-right\">{formatCurrency(customer.outstandingReceivables || 0)}</td>\n                        <td className=\"py-2 text-right\">{formatCurrency(customer.unusedCredits || 0)}</td>\n                      </tr>\n                    </tbody>\n                  </table>\n                  <button className=\"text-sm text-blue-600 mt-2\">Enter Opening Balance</button>\n                </div>\n\n                <div className=\"mb-6\">\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <h4 className=\"text-lg font-semibold\">Income</h4>\n                    <div className=\"flex items-center gap-2\">\n                      <Select defaultValue=\"last-6-months\">\n                        <SelectTrigger className=\"w-36 h-8 text-sm\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"last-6-months\">Last 6 Months</SelectItem>\n                          <SelectItem value=\"last-12-months\">Last 12 Months</SelectItem>\n                          <SelectItem value=\"this-year\">This Year</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <Select defaultValue=\"accrual\">\n                        <SelectTrigger className=\"w-28 h-8 text-sm\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"accrual\">Accrual</SelectItem>\n                          <SelectItem value=\"cash\">Cash</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n                  <p className=\"text-xs text-slate-500 mb-4\">This chart is displayed in the organization's base currency.</p>\n                  <div className=\"h-32 bg-slate-50 dark:bg-slate-800 rounded-lg flex items-end justify-around px-4 pb-2\">\n                    {['Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov'].map((month, i) => (\n                      <div key={month} className=\"flex flex-col items-center\">\n                        <div className=\"w-8 bg-blue-200 dark:bg-blue-800 rounded-t\" style={{ height: `${20 + i * 10}px` }}></div>\n                        <span className=\"text-xs text-slate-500 mt-1\">{month}</span>\n                      </div>\n                    ))}\n                  </div>\n                  <p className=\"text-sm mt-4\">Total Income ( Last 6 Months ) - {formatCurrency(0)}</p>\n                </div>\n\n                <div>\n                  <h4 className=\"text-lg font-semibold mb-4\">Activity Timeline</h4>\n                  <div className=\"space-y-4\">\n                    {activities.length === 0 ? (\n                      <div className=\"text-center py-8 text-slate-500\">\n                        <Clock className=\"h-8 w-8 mx-auto mb-2 text-slate-300\" />\n                        <p className=\"text-sm\">No activities yet</p>\n                      </div>\n                    ) : (\n                      activities.map((activity) => {\n                        const { date, time } = formatDateTime(activity.date);\n                        return (\n                          <div key={activity.id} className=\"flex gap-4\">\n                            <div className=\"text-right text-xs text-slate-500 w-24 flex-shrink-0\">\n                              <p>{date}</p>\n                              <p>{time}</p>\n                            </div>\n                            <div className=\"relative\">\n                              <div className=\"absolute top-0 bottom-0 left-1/2 -translate-x-1/2 w-0.5 bg-blue-200\"></div>\n                              <div className=\"relative z-10 h-4 w-4 bg-white border-2 border-blue-500 rounded\"></div>\n                            </div>\n                            <div className=\"flex-1 bg-slate-50 dark:bg-slate-800 rounded-lg p-3\">\n                              <h5 className=\"font-medium text-sm\">{activity.title}</h5>\n                              <p className=\"text-sm text-slate-600 dark:text-slate-400 mt-1\">{activity.description}</p>\n                              <p className=\"text-xs text-slate-500 mt-2\">\n                                by <span className=\"text-blue-600\">{activity.user}</span>\n                                {activity.type === 'invoice' && (\n                                  <button className=\"text-blue-600 ml-2\">- View Details</button>\n                                )}\n                              </p>\n                            </div>\n                          </div>\n                        );\n                      })\n                    )}\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"comments\" className=\"flex-1 overflow-auto p-6 mt-0\">\n          <div className=\"max-w-2xl\">\n            <div className=\"border border-slate-200 dark:border-slate-700 rounded-lg mb-6\">\n              <div className=\"flex items-center gap-2 p-2 border-b border-slate-200 dark:border-slate-700\">\n                <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" data-testid=\"button-bold\">\n                  <Bold className=\"h-4 w-4\" />\n                </Button>\n                <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" data-testid=\"button-italic\">\n                  <Italic className=\"h-4 w-4\" />\n                </Button>\n                <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" data-testid=\"button-underline\">\n                  <Underline className=\"h-4 w-4\" />\n                </Button>\n              </div>\n              <Textarea\n                placeholder=\"Add a comment...\"\n                value={newComment}\n                onChange={(e) => setNewComment(e.target.value)}\n                className=\"border-0 focus-visible:ring-0 min-h-24 resize-none\"\n                data-testid=\"input-comment\"\n              />\n              <div className=\"p-2 border-t border-slate-200 dark:border-slate-700\">\n                <Button \n                  variant=\"ghost\" \n                  size=\"sm\" \n                  onClick={handleAddComment}\n                  disabled={!newComment.trim()}\n                  data-testid=\"button-add-comment\"\n                >\n                  Add Comment\n                </Button>\n              </div>\n            </div>\n\n            <h4 className=\"text-sm font-medium text-slate-500 mb-4\">ALL COMMENTS</h4>\n            {comments.length === 0 ? (\n              <p className=\"text-center text-slate-500 py-8\">No comments yet.</p>\n            ) : (\n              <div className=\"space-y-4\">\n                {comments.map((comment) => (\n                  <div key={comment.id} className=\"border border-slate-200 dark:border-slate-700 rounded-lg p-4\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <span className=\"font-medium text-sm\">{comment.author}</span>\n                      <span className=\"text-xs text-slate-500\">{formatDate(comment.createdAt)}</span>\n                    </div>\n                    <p className=\"text-sm\">{comment.text}</p>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"transactions\" className=\"flex-1 overflow-auto mt-0\">\n          <div className=\"p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"outline\" size=\"sm\" className=\"gap-1.5\" data-testid=\"button-goto-transactions\">\n                    Go to transactions\n                    <ChevronDown className=\"h-3 w-3\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"start\" className=\"w-48\">\n                  <DropdownMenuItem>Invoices</DropdownMenuItem>\n                  <DropdownMenuItem>Quotes</DropdownMenuItem>\n                  <DropdownMenuItem>Sales Orders</DropdownMenuItem>\n                  <DropdownMenuItem>Payments Received</DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            </div>\n\n            <div className=\"space-y-4\">\n              {transactionSections.map((section) => (\n                <Collapsible\n                  key={section.key}\n                  open={expandedSections[section.key]}\n                  onOpenChange={() => toggleSection(section.key)}\n                >\n                  <div className=\"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden\">\n                    <CollapsibleTrigger className=\"flex items-center justify-between w-full p-4 hover:bg-slate-50 dark:hover:bg-slate-800\">\n                      <div className=\"flex items-center gap-2\">\n                        {expandedSections[section.key] ? (\n                          <ChevronDown className=\"h-4 w-4\" />\n                        ) : (\n                          <ChevronRight className=\"h-4 w-4\" />\n                        )}\n                        <span className=\"font-medium\">{section.label}</span>\n                      </div>\n                      <div className=\"flex items-center gap-4\">\n                        <div className=\"flex items-center gap-2 text-sm text-slate-500\">\n                          <Filter className=\"h-4 w-4\" />\n                          Status: All\n                          <ChevronDown className=\"h-3 w-3\" />\n                        </div>\n                        <Button \n                          size=\"sm\" \n                          variant=\"ghost\" \n                          className=\"text-blue-600 gap-1\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            handleNewTransaction(section.key === 'customerPayments' ? 'payment' : section.key.slice(0, -1));\n                          }}\n                          data-testid={`button-new-${section.key}`}\n                        >\n                          <Plus className=\"h-3 w-3\" />\n                          New\n                        </Button>\n                      </div>\n                    </CollapsibleTrigger>\n                    <CollapsibleContent>\n                      <div className=\"border-t border-slate-200 dark:border-slate-700\">\n                        <table className=\"w-full text-sm\">\n                          <thead className=\"bg-slate-50 dark:bg-slate-800\">\n                            <tr>\n                              {section.columns.map((col, i) => (\n                                <th key={i} className=\"px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase\">\n                                  {col}\n                                </th>\n                              ))}\n                            </tr>\n                          </thead>\n                          <tbody>\n                            {(transactions[section.key] || []).length === 0 ? (\n                              <tr>\n                                <td colSpan={section.columns.length} className=\"px-4 py-8 text-center text-slate-500\">\n                                  No {section.label.toLowerCase()} found. <button className=\"text-blue-600\" onClick={() => handleNewTransaction(section.key === 'customerPayments' ? 'payment' : section.key.slice(0, -1))}>Add New</button>\n                                </td>\n                              </tr>\n                            ) : (\n                              (transactions[section.key] || []).map((tx) => (\n                                <tr key={tx.id} className=\"border-t border-slate-100 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800\">\n                                  <td className=\"px-4 py-3\">{formatDate(tx.date)}</td>\n                                  <td className=\"px-4 py-3 text-blue-600\">{tx.number}</td>\n                                  <td className=\"px-4 py-3\">{tx.orderNumber || '-'}</td>\n                                  <td className=\"px-4 py-3\">{formatCurrency(tx.amount)}</td>\n                                  <td className=\"px-4 py-3\">{formatCurrency(tx.balance)}</td>\n                                  <td className=\"px-4 py-3\">\n                                    <Badge variant=\"outline\" className={tx.status === 'Draft' ? 'text-slate-500' : 'text-green-600'}>\n                                      {tx.status}\n                                    </Badge>\n                                  </td>\n                                </tr>\n                              ))\n                            )}\n                          </tbody>\n                        </table>\n                      </div>\n                    </CollapsibleContent>\n                  </div>\n                </Collapsible>\n              ))}\n            </div>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"mails\" className=\"flex-1 overflow-auto p-6 mt-0\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <h4 className=\"text-lg font-medium\">System Mails</h4>\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"outline\" size=\"sm\" className=\"gap-1.5\" data-testid=\"button-link-email\">\n                  <Link2 className=\"h-4 w-4\" />\n                  Link Email account\n                  <ChevronDown className=\"h-3 w-3\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <DropdownMenuItem>Gmail</DropdownMenuItem>\n                <DropdownMenuItem>Outlook</DropdownMenuItem>\n                <DropdownMenuItem>Other</DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n\n          {mails.length === 0 ? (\n            <div className=\"text-center py-12 text-slate-500\">\n              <Mail className=\"h-12 w-12 mx-auto mb-4 text-slate-300\" />\n              <p className=\"text-lg font-medium mb-1\">No emails yet</p>\n              <p className=\"text-sm\">System emails sent to this customer will appear here</p>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {mails.map((mail) => {\n                const { date, time } = formatDateTime(mail.sentAt);\n                return (\n                  <div key={mail.id} className=\"flex items-start gap-4 p-4 border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800\">\n                    <div className=\"h-10 w-10 rounded-full bg-red-100 flex items-center justify-center flex-shrink-0\">\n                      <span className=\"text-red-600 font-medium\">R</span>\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"text-sm\">To <span className=\"text-blue-600\">{mail.to}</span></p>\n                      <p className=\"font-medium text-sm mt-1\">{mail.subject}</p>\n                      <p className=\"text-sm text-slate-500 truncate\">{mail.description}</p>\n                    </div>\n                    <div className=\"text-right text-xs text-slate-500 flex-shrink-0\">\n                      <p>{date}</p>\n                      <p>{time}</p>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"statement\" className=\"flex-1 overflow-auto mt-0\">\n          <div className=\"p-6\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <div className=\"flex items-center gap-4\">\n                <Select value={statementPeriod} onValueChange={setStatementPeriod}>\n                  <SelectTrigger className=\"w-40 h-9\" data-testid=\"select-period\">\n                    <Calendar className=\"h-4 w-4 mr-2\" />\n                    <SelectValue placeholder=\"This Month\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"this-month\">This Month</SelectItem>\n                    <SelectItem value=\"last-month\">Last Month</SelectItem>\n                    <SelectItem value=\"this-quarter\">This Quarter</SelectItem>\n                    <SelectItem value=\"this-year\">This Year</SelectItem>\n                    <SelectItem value=\"custom\">Custom</SelectItem>\n                  </SelectContent>\n                </Select>\n                <Select value={statementFilter} onValueChange={setStatementFilter}>\n                  <SelectTrigger className=\"w-32 h-9\" data-testid=\"select-filter\">\n                    <SelectValue placeholder=\"Filter By: All\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">Filter By: All</SelectItem>\n                    <SelectItem value=\"outstanding\">Outstanding</SelectItem>\n                    <SelectItem value=\"paid\">Paid</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Button variant=\"outline\" size=\"icon\" className=\"h-9 w-9\" data-testid=\"button-print\">\n                  <Printer className=\"h-4 w-4\" />\n                </Button>\n                <Button variant=\"outline\" size=\"icon\" className=\"h-9 w-9\" data-testid=\"button-download-pdf\">\n                  <Download className=\"h-4 w-4\" />\n                </Button>\n                <Button variant=\"outline\" size=\"icon\" className=\"h-9 w-9\" data-testid=\"button-download-excel\">\n                  <FileText className=\"h-4 w-4\" />\n                </Button>\n                <Button className=\"bg-blue-600 hover:bg-blue-700 gap-1.5\" size=\"sm\" data-testid=\"button-send-email\">\n                  <Send className=\"h-4 w-4\" />\n                  Send Email\n                </Button>\n              </div>\n            </div>\n\n            <div className=\"text-center mb-6\">\n              <h3 className=\"text-lg font-semibold\">Customer Statement for {customer.name}</h3>\n              <p className=\"text-sm text-slate-500\">From 01/12/2025 To 31/12/2025</p>\n            </div>\n\n            <div className=\"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg shadow-sm p-8 max-w-4xl mx-auto\">\n              <div className=\"flex justify-between mb-8\">\n                <div>\n                  <h4 className=\"text-xl font-bold text-blue-600\">SkilltonIT</h4>\n                </div>\n                <div className=\"text-right text-sm\">\n                  <p className=\"font-medium\">SkilltonIT</p>\n                  <p>Hinjewadi - Wakad road</p>\n                  <p>Hinjewadi</p>\n                  <p>Pune Maharashtra 411057</p>\n                  <p>India</p>\n                  <p>GSTIN 27AZCPA5145K1ZH</p>\n                  <p>Sales.SkilltonIT@skilltonit.com</p>\n                  <p>www.skilltonit.com</p>\n                </div>\n              </div>\n\n              <div className=\"flex mb-8\">\n                <div className=\"w-1/2\">\n                  <p className=\"text-sm text-slate-500 mb-1\">To</p>\n                  <p className=\"font-medium text-blue-600\">{customer.name}</p>\n                  <div className=\"text-sm\">\n                    {formatAddress(customer.billingAddress).map((line, i) => (\n                      <p key={i}>{line}</p>\n                    ))}\n                  </div>\n                  {customer.gstin && <p className=\"text-sm\">GSTIN {customer.gstin}</p>}\n                </div>\n                <div className=\"w-1/2 text-right\">\n                  <h4 className=\"text-xl font-bold mb-2\">Statement of Accounts</h4>\n                  <p className=\"text-sm text-blue-600\">01/12/2025 To 31/12/2025</p>\n                </div>\n              </div>\n\n              <div className=\"mb-8\">\n                <h5 className=\"text-center font-semibold mb-4\">Account Summary</h5>\n                <table className=\"w-full max-w-sm mx-auto text-sm\">\n                  <tbody>\n                    <tr>\n                      <td className=\"py-1\">Opening Balance</td>\n                      <td className=\"py-1 text-right\">{formatCurrency(0)}</td>\n                    </tr>\n                    <tr>\n                      <td className=\"py-1\">Invoiced Amount</td>\n                      <td className=\"py-1 text-right\">{formatCurrency(0)}</td>\n                    </tr>\n                    <tr>\n                      <td className=\"py-1\">Amount Received</td>\n                      <td className=\"py-1 text-right text-green-600\">{formatCurrency(0)}</td>\n                    </tr>\n                    <tr className=\"border-t font-medium\">\n                      <td className=\"py-2\">Balance Due</td>\n                      <td className=\"py-2 text-right\">{formatCurrency(0)}</td>\n                    </tr>\n                  </tbody>\n                </table>\n              </div>\n\n              <table className=\"w-full text-sm\">\n                <thead>\n                  <tr className=\"border-b\">\n                    <th className=\"py-2 text-left\">Date</th>\n                    <th className=\"py-2 text-left\">Transactions</th>\n                    <th className=\"py-2 text-left\">Details</th>\n                    <th className=\"py-2 text-right\">Amount</th>\n                    <th className=\"py-2 text-right\">Payments</th>\n                    <th className=\"py-2 text-right\">Balance</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr>\n                    <td className=\"py-2\">01/12/2025</td>\n                    <td className=\"py-2\">***Opening Balance***</td>\n                    <td className=\"py-2\"></td>\n                    <td className=\"py-2 text-right\">0.00</td>\n                    <td className=\"py-2 text-right\"></td>\n                    <td className=\"py-2 text-right\">0.00</td>\n                  </tr>\n                </tbody>\n                <tfoot>\n                  <tr className=\"border-t font-medium\">\n                    <td colSpan={5} className=\"py-2 text-right\">Balance Due</td>\n                    <td className=\"py-2 text-right\">{formatCurrency(0)}</td>\n                  </tr>\n                </tfoot>\n              </table>\n            </div>\n          </div>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n\nexport default function CustomersPage() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [customers, setCustomers] = useState<CustomerListItem[]>([]);\n  const [selectedCustomers, setSelectedCustomers] = useState<string[]>([]);\n  const [selectedCustomer, setSelectedCustomer] = useState<CustomerDetail | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [customerToDelete, setCustomerToDelete] = useState<string | null>(null);\n  const [activeFilter, setActiveFilter] = useState(\"all\");\n  const [filterDropdownOpen, setFilterDropdownOpen] = useState(false);\n  const [favoriteFilters, setFavoriteFilters] = useState<string[]>([]);\n\n  const CUSTOMER_FILTERS = [\n    { id: \"all\", label: \"All Customers\" },\n    { id: \"active\", label: \"Active Customers\" },\n    { id: \"crm\", label: \"CRM Customers\" },\n    { id: \"duplicate\", label: \"Duplicate Customers\" },\n    { id: \"inactive\", label: \"Inactive Customers\" },\n    { id: \"portal_enabled\", label: \"Customer Portal Enabled\" },\n    { id: \"portal_disabled\", label: \"Customer Portal Disabled\" },\n    { id: \"overdue\", label: \"Overdue Customers\" },\n    { id: \"unpaid\", label: \"Unpaid Customers\" },\n  ];\n\n  const getFilterLabel = () => {\n    const filter = CUSTOMER_FILTERS.find(f => f.id === activeFilter);\n    return filter?.label || \"All Customers\";\n  };\n\n  const toggleFavorite = (filterId: string, e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (favoriteFilters.includes(filterId)) {\n      setFavoriteFilters(favoriteFilters.filter(f => f !== filterId));\n    } else {\n      setFavoriteFilters([...favoriteFilters, filterId]);\n    }\n  };\n\n  useEffect(() => {\n    fetchCustomers();\n  }, []);\n\n  const fetchCustomers = async () => {\n    try {\n      const response = await fetch('/api/customers');\n      if (response.ok) {\n        const data = await response.json();\n        setCustomers(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch customers:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchCustomerDetail = async (id: string) => {\n    try {\n      const response = await fetch(`/api/customers/${id}`);\n      if (response.ok) {\n        const data = await response.json();\n        setSelectedCustomer(data.data);\n      }\n    } catch (error) {\n      console.error('Failed to fetch customer detail:', error);\n    }\n  };\n\n  const handleCustomerClick = (customer: CustomerListItem) => {\n    fetchCustomerDetail(customer.id);\n  };\n\n  const handleClosePanel = () => {\n    setSelectedCustomer(null);\n  };\n\n  const handleEditCustomer = () => {\n    if (selectedCustomer) {\n      setLocation(`/customers/${selectedCustomer.id}/edit`);\n    }\n  };\n\n  const toggleSelectCustomer = (id: string, e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (selectedCustomers.includes(id)) {\n      setSelectedCustomers(selectedCustomers.filter(i => i !== id));\n    } else {\n      setSelectedCustomers([...selectedCustomers, id]);\n    }\n  };\n\n  const handleClone = async () => {\n    if (!selectedCustomer) return;\n    try {\n      const response = await fetch(`/api/customers/${selectedCustomer.id}/clone`, { method: 'POST' });\n      if (response.ok) {\n        toast({ title: \"Customer cloned successfully\" });\n        fetchCustomers();\n        handleClosePanel();\n      }\n    } catch (error) {\n      toast({ title: \"Failed to clone customer\", variant: \"destructive\" });\n    }\n  };\n\n  const handleToggleStatus = async () => {\n    if (!selectedCustomer) return;\n    const newStatus = selectedCustomer.status === \"active\" ? \"inactive\" : \"active\";\n    try {\n      const response = await fetch(`/api/customers/${selectedCustomer.id}/status`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ status: newStatus })\n      });\n      if (response.ok) {\n        toast({ title: `Customer marked as ${newStatus}` });\n        fetchCustomers();\n        fetchCustomerDetail(selectedCustomer.id);\n      }\n    } catch (error) {\n      toast({ title: \"Failed to update status\", variant: \"destructive\" });\n    }\n  };\n\n  const handleDeleteClick = () => {\n    if (selectedCustomer) {\n      setCustomerToDelete(selectedCustomer.id);\n      setDeleteDialogOpen(true);\n    }\n  };\n\n  const confirmDelete = async () => {\n    if (!customerToDelete) return;\n    try {\n      const response = await fetch(`/api/customers/${customerToDelete}`, { method: 'DELETE' });\n      if (response.ok) {\n        toast({ title: \"Customer deleted successfully\" });\n        handleClosePanel();\n        fetchCustomers();\n      }\n    } catch (error) {\n      toast({ title: \"Failed to delete customer\", variant: \"destructive\" });\n    } finally {\n      setDeleteDialogOpen(false);\n      setCustomerToDelete(null);\n    }\n  };\n\n  const applyFilter = (customerList: CustomerListItem[]) => {\n    let filtered = customerList;\n    \n    switch (activeFilter) {\n      case \"active\":\n        filtered = customerList.filter(c => c.status === \"active\" || !c.status);\n        break;\n      case \"inactive\":\n        filtered = customerList.filter(c => c.status === \"inactive\");\n        break;\n      case \"portal_enabled\":\n        filtered = customerList.filter(c => (c as any).portalStatus === \"enabled\");\n        break;\n      case \"portal_disabled\":\n        filtered = customerList.filter(c => (c as any).portalStatus !== \"enabled\");\n        break;\n      case \"overdue\":\n        filtered = customerList.filter(c => (c.outstandingReceivables || 0) > 0);\n        break;\n      case \"unpaid\":\n        filtered = customerList.filter(c => (c.outstandingReceivables || 0) > 0);\n        break;\n      case \"duplicate\":\n        const emailCounts: Record<string, number> = {};\n        const phoneCounts: Record<string, number> = {};\n        customerList.forEach(c => {\n          if (c.email) emailCounts[c.email] = (emailCounts[c.email] || 0) + 1;\n          if (c.phone) phoneCounts[c.phone] = (phoneCounts[c.phone] || 0) + 1;\n        });\n        filtered = customerList.filter(c => \n          (c.email && emailCounts[c.email] > 1) ||\n          (c.phone && phoneCounts[c.phone] > 1)\n        );\n        break;\n      case \"crm\":\n        filtered = customerList.filter(c => (c as any).source === \"crm\");\n        break;\n      default:\n        filtered = customerList;\n    }\n    \n    return filtered;\n  };\n\n  const filteredCustomers = applyFilter(customers).filter(customer => \n    customer.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    (customer.email && customer.email.toLowerCase().includes(searchTerm.toLowerCase()))\n  );\n\n  const { currentPage, totalPages, totalItems, itemsPerPage, paginatedItems, goToPage } = usePagination(filteredCustomers, 10);\n\n  return (\n    <div className=\"flex h-[calc(100vh-80px)] animate-in fade-in duration-300\">\n      <div className={`flex-1 flex flex-col overflow-hidden transition-all duration-300 ${selectedCustomer ? 'w-80' : 'w-full'}`}>\n        <div className=\"flex items-center justify-between p-4\">\n          <div className=\"flex items-center gap-2\">\n            <DropdownMenu open={filterDropdownOpen} onOpenChange={setFilterDropdownOpen}>\n              <DropdownMenuTrigger asChild>\n                <Button \n                  variant=\"ghost\" \n                  className=\"gap-1.5 text-xl font-semibold text-slate-900 dark:text-white p-0 h-auto\"\n                  data-testid=\"button-filter-dropdown\"\n                >\n                  {getFilterLabel()}\n                  <ChevronDown className={`h-4 w-4 text-slate-500 transition-transform ${filterDropdownOpen ? 'rotate-180' : ''}`} />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"start\" className=\"w-64\">\n                {CUSTOMER_FILTERS.map((filter) => (\n                  <DropdownMenuItem \n                    key={filter.id}\n                    className={`flex items-center justify-between ${activeFilter === filter.id ? 'bg-blue-50 dark:bg-blue-900/20' : ''}`}\n                    onClick={() => {\n                      setActiveFilter(filter.id);\n                      setFilterDropdownOpen(false);\n                    }}\n                    data-testid={`filter-${filter.id}`}\n                  >\n                    <span className={activeFilter === filter.id ? 'font-medium text-blue-600' : ''}>\n                      {filter.label}\n                    </span>\n                    <button\n                      className=\"ml-2 text-slate-400 hover:text-yellow-500\"\n                      onClick={(e) => toggleFavorite(filter.id, e)}\n                      data-testid={`favorite-${filter.id}`}\n                    >\n                      {favoriteFilters.includes(filter.id) ? (\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" className=\"w-4 h-4 text-yellow-500\">\n                          <path fillRule=\"evenodd\" d=\"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z\" clipRule=\"evenodd\" />\n                        </svg>\n                      ) : (\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-4 h-4\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z\" />\n                        </svg>\n                      )}\n                    </button>\n                  </DropdownMenuItem>\n                ))}\n                <DropdownMenuSeparator />\n                <DropdownMenuItem className=\"text-blue-600\" data-testid=\"filter-new-custom-view\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  New Custom View\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button \n              onClick={() => setLocation(\"/customers/new\")} \n              className=\"bg-blue-600 hover:bg-blue-700 gap-1.5 h-9\"\n              data-testid=\"button-new-customer\"\n            >\n              <Plus className=\"h-4 w-4\" />\n            </Button>\n            <Button variant=\"outline\" size=\"icon\" className=\"h-9 w-9\">\n              <MoreHorizontal className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"flex-1 overflow-auto\">\n          {loading ? (\n            <div className=\"p-8 text-center text-slate-500\">Loading customers...</div>\n          ) : filteredCustomers.length === 0 ? (\n            <div className=\"p-8 text-center text-slate-500\">\n              <p>No customers found.</p>\n              <Button \n                onClick={() => setLocation(\"/customers/new\")} \n                className=\"mt-4 bg-blue-600 hover:bg-blue-700\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" /> Create your first customer\n              </Button>\n            </div>\n          ) : (\n            <>\n            <table className=\"w-full text-sm\">\n              <thead className=\"bg-slate-50 dark:bg-slate-800 sticky top-0 z-10\">\n                <tr className=\"border-b border-slate-200 dark:border-slate-700\">\n                  <th className=\"w-10 px-3 py-3 text-left\">\n                    <Checkbox \n                      checked={selectedCustomers.length === filteredCustomers.length && filteredCustomers.length > 0}\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        if (selectedCustomers.length === filteredCustomers.length) {\n                          setSelectedCustomers([]);\n                        } else {\n                          setSelectedCustomers(filteredCustomers.map(c => c.id));\n                        }\n                      }}\n                    />\n                  </th>\n                  <th className=\"px-3 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Name</th>\n                  <th className=\"px-3 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Company Name</th>\n                  <th className=\"px-3 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Email</th>\n                  <th className=\"px-3 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Work Phone</th>\n                  <th className=\"px-3 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Place of Supply</th>\n                  <th className=\"px-3 py-3 text-right text-xs font-semibold text-slate-500 uppercase tracking-wider\">Receivables (BCY)</th>\n                  <th className=\"px-3 py-3 text-right text-xs font-semibold text-slate-500 uppercase tracking-wider\">Unused Credits (BCY)</th>\n                  <th className=\"w-10 px-3 py-3\"></th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-slate-100 dark:divide-slate-700\">\n                {paginatedItems.map((customer) => (\n                  <tr \n                    key={customer.id} \n                    className={`hover:bg-slate-50 dark:hover:bg-slate-800 cursor-pointer transition-colors ${\n                      selectedCustomer?.id === customer.id ? 'bg-blue-50 dark:bg-blue-900/20' : ''\n                    }`}\n                    onClick={() => handleCustomerClick(customer)}\n                    data-testid={`row-customer-${customer.id}`}\n                  >\n                    <td className=\"px-3 py-3\">\n                      <Checkbox \n                        checked={selectedCustomers.includes(customer.id)}\n                        onClick={(e) => toggleSelectCustomer(customer.id, e)}\n                      />\n                    </td>\n                    <td className=\"px-3 py-3\">\n                      <span className=\"font-medium text-blue-600 dark:text-blue-400\">{customer.name}</span>\n                    </td>\n                    <td className=\"px-3 py-3 text-slate-600 dark:text-slate-400\">\n                      {customer.companyName || '-'}\n                    </td>\n                    <td className=\"px-3 py-3 text-slate-600 dark:text-slate-400\">\n                      {customer.email || '-'}\n                    </td>\n                    <td className=\"px-3 py-3 text-slate-600 dark:text-slate-400\">\n                      {customer.phone || '-'}\n                    </td>\n                    <td className=\"px-3 py-3 text-slate-600 dark:text-slate-400\">\n                      {customer.placeOfSupply || '-'}\n                    </td>\n                    <td className=\"px-3 py-3 text-right text-slate-600 dark:text-slate-400\">\n                      {formatCurrency(customer.outstandingReceivables || 0)}\n                    </td>\n                    <td className=\"px-3 py-3 text-right text-slate-600 dark:text-slate-400\">\n                      {formatCurrency(customer.unusedCredits || 0)}\n                    </td>\n                    <td className=\"px-3 py-3\">\n                      <DropdownMenu>\n                        <DropdownMenuTrigger asChild onClick={(e) => e.stopPropagation()}>\n                          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n                            <Search className=\"h-4 w-4 text-slate-400\" />\n                          </Button>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent align=\"end\">\n                          <DropdownMenuItem onClick={(e) => { e.stopPropagation(); handleCustomerClick(customer); }}>\n                            View Details\n                          </DropdownMenuItem>\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n            <TablePagination\n              currentPage={currentPage}\n              totalPages={totalPages}\n              totalItems={totalItems}\n              itemsPerPage={itemsPerPage}\n              onPageChange={goToPage}\n            />\n            </>\n          )}\n        </div>\n      </div>\n\n      {selectedCustomer && (\n        <div className=\"flex-1 min-w-0\">\n          <CustomerDetailPanel\n            customer={selectedCustomer}\n            onClose={handleClosePanel}\n            onEdit={handleEditCustomer}\n            onClone={handleClone}\n            onToggleStatus={handleToggleStatus}\n            onDelete={handleDeleteClick}\n          />\n        </div>\n      )}\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Customer</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete this customer? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={confirmDelete} className=\"bg-red-600 hover:bg-red-700\">\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":63633,"size_tokens":null},"client/src/components/ui/button-group.tsx":{"content":"import { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nconst buttonGroupVariants = cva(\n  \"flex w-fit items-stretch has-[>[data-slot=button-group]]:gap-2 [&>*]:focus-visible:relative [&>*]:focus-visible:z-10 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1\",\n  {\n    variants: {\n      orientation: {\n        horizontal:\n          \"[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none\",\n        vertical:\n          \"flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none\",\n      },\n    },\n    defaultVariants: {\n      orientation: \"horizontal\",\n    },\n  }\n)\n\nfunction ButtonGroup({\n  className,\n  orientation,\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof buttonGroupVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"button-group\"\n      data-orientation={orientation}\n      className={cn(buttonGroupVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupText({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  asChild?: boolean\n}) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      className={cn(\n        \"bg-muted shadow-xs flex items-center gap-2 rounded-md border px-4 text-sm font-medium [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupSeparator({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"button-group-separator\"\n      orientation={orientation}\n      className={cn(\n        \"bg-input relative !m-0 self-stretch data-[orientation=vertical]:h-auto\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  ButtonGroup,\n  ButtonGroupSeparator,\n  ButtonGroupText,\n  buttonGroupVariants,\n}\n","path":null,"size_bytes":2209,"size_tokens":null},"client/src/modules/items/pages/index.ts":{"content":"export { default as ItemsPage } from './ItemsPage';\nexport { default as ItemCreatePage } from './ItemCreatePage';\nexport { default as ItemDetailPage } from './ItemDetailPage';\n","path":null,"size_bytes":176,"size_tokens":null},"client/src/components/ui/kbd.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Kbd({ className, ...props }: React.ComponentProps<\"kbd\">) {\n  return (\n    <kbd\n      data-slot=\"kbd\"\n      className={cn(\n        \"bg-muted text-muted-foreground pointer-events-none inline-flex h-5 w-fit min-w-5 select-none items-center justify-center gap-1 rounded-sm px-1 font-sans text-xs font-medium\",\n        \"[&_svg:not([class*='size-'])]:size-3\",\n        \"[[data-slot=tooltip-content]_&]:bg-background/20 [[data-slot=tooltip-content]_&]:text-background dark:[[data-slot=tooltip-content]_&]:bg-background/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction KbdGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <kbd\n      data-slot=\"kbd-group\"\n      className={cn(\"inline-flex items-center gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Kbd, KbdGroup }\n","path":null,"size_bytes":862,"size_tokens":null},"server/storage.ts":{"content":"import { type User, type InsertUser } from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\n\n// modify the interface with any CRUD methods\n// you might need\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n}\n\nexport class MemStorage implements IStorage {\n  private users: Map<string, User>;\n\n  constructor() {\n    this.users = new Map();\n  }\n\n  async getUser(id: string): Promise<User | undefined> {\n    return this.users.get(id);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(\n      (user) => user.username === username,\n    );\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const id = randomUUID();\n    const user: User = { ...insertUser, id };\n    this.users.set(id, user);\n    return user;\n  }\n}\n\nexport const storage = new MemStorage();\n","path":null,"size_bytes":993,"size_tokens":null},"client/src/modules/expenses/pages/index.ts":{"content":"export { default as ExpensesPage } from './ExpensesPage';\n","path":null,"size_bytes":58,"size_tokens":null},"client/src/components/ui/field.tsx":{"content":"\"use client\"\n\nimport { useMemo } from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction FieldSet({ className, ...props }: React.ComponentProps<\"fieldset\">) {\n  return (\n    <fieldset\n      data-slot=\"field-set\"\n      className={cn(\n        \"flex flex-col gap-6\",\n        \"has-[>[data-slot=checkbox-group]]:gap-3 has-[>[data-slot=radio-group]]:gap-3\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLegend({\n  className,\n  variant = \"legend\",\n  ...props\n}: React.ComponentProps<\"legend\"> & { variant?: \"legend\" | \"label\" }) {\n  return (\n    <legend\n      data-slot=\"field-legend\"\n      data-variant={variant}\n      className={cn(\n        \"mb-3 font-medium\",\n        \"data-[variant=legend]:text-base\",\n        \"data-[variant=label]:text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-group\"\n      className={cn(\n        \"group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst fieldVariants = cva(\n  \"group/field data-[invalid=true]:text-destructive flex w-full gap-3\",\n  {\n    variants: {\n      orientation: {\n        vertical: [\"flex-col [&>*]:w-full [&>.sr-only]:w-auto\"],\n        horizontal: [\n          \"flex-row items-center\",\n          \"[&>[data-slot=field-label]]:flex-auto\",\n          \"has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px has-[>[data-slot=field-content]]:items-start\",\n        ],\n        responsive: [\n          \"@md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto flex-col [&>*]:w-full [&>.sr-only]:w-auto\",\n          \"@md/field-group:[&>[data-slot=field-label]]:flex-auto\",\n          \"@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px\",\n        ],\n      },\n    },\n    defaultVariants: {\n      orientation: \"vertical\",\n    },\n  }\n)\n\nfunction Field({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof fieldVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"field\"\n      data-orientation={orientation}\n      className={cn(fieldVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction FieldContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-content\"\n      className={cn(\n        \"group/field-content flex flex-1 flex-col gap-1.5 leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLabel({\n  className,\n  ...props\n}: React.ComponentProps<typeof Label>) {\n  return (\n    <Label\n      data-slot=\"field-label\"\n      className={cn(\n        \"group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50\",\n        \"has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>[data-slot=field]]:p-4\",\n        \"has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-label\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug group-data-[disabled=true]/field:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"field-description\"\n      className={cn(\n        \"text-muted-foreground text-sm font-normal leading-normal group-has-[[data-orientation=horizontal]]/field:text-balance\",\n        \"nth-last-2:-mt-1 last:mt-0 [[data-variant=legend]+&]:-mt-1.5\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldSeparator({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  children?: React.ReactNode\n}) {\n  return (\n    <div\n      data-slot=\"field-separator\"\n      data-content={!!children}\n      className={cn(\n        \"relative -my-2 h-5 text-sm group-data-[variant=outline]/field-group:-mb-2\",\n        className\n      )}\n      {...props}\n    >\n      <Separator className=\"absolute inset-0 top-1/2\" />\n      {children && (\n        <span\n          className=\"bg-background text-muted-foreground relative mx-auto block w-fit px-2\"\n          data-slot=\"field-separator-content\"\n        >\n          {children}\n        </span>\n      )}\n    </div>\n  )\n}\n\nfunction FieldError({\n  className,\n  children,\n  errors,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  errors?: Array<{ message?: string } | undefined>\n}) {\n  const content = useMemo(() => {\n    if (children) {\n      return children\n    }\n\n    if (!errors) {\n      return null\n    }\n\n    if (errors?.length === 1 && errors[0]?.message) {\n      return errors[0].message\n    }\n\n    return (\n      <ul className=\"ml-4 flex list-disc flex-col gap-1\">\n        {errors.map(\n          (error, index) =>\n            error?.message && <li key={index}>{error.message}</li>\n        )}\n      </ul>\n    )\n  }, [children, errors])\n\n  if (!content) {\n    return null\n  }\n\n  return (\n    <div\n      role=\"alert\"\n      data-slot=\"field-error\"\n      className={cn(\"text-destructive text-sm font-normal\", className)}\n      {...props}\n    >\n      {content}\n    </div>\n  )\n}\n\nexport {\n  Field,\n  FieldLabel,\n  FieldDescription,\n  FieldError,\n  FieldGroup,\n  FieldLegend,\n  FieldSeparator,\n  FieldSet,\n  FieldContent,\n  FieldTitle,\n}\n","path":null,"size_bytes":6044,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue | null>(null)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  if (!itemContext) {\n    throw new Error(\"useFormField should be used within <FormItem>\")\n  }\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue | null>(null)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-[0.8rem] text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-[0.8rem] font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4175,"size_tokens":null},"client/src/pages/products-create.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useForm } from \"react-hook-form\";\nimport { z } from \"zod\";\nimport { X, Check, ChevronsUpDown, Search, HelpCircle, Settings, Plus, Trash2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n  CommandSeparator,\n} from \"@/components/ui/command\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { cn } from \"@/lib/utils\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\n\ninterface Unit {\n  id: string;\n  name: string;\n  uqc: string;\n}\n\ninterface TaxRate {\n  id: string;\n  name: string;\n  rate: number;\n  label: string;\n}\n\nconst itemSchema = z.object({\n  type: z.enum([\"goods\", \"service\"]),\n  name: z.string().min(1, \"Item Name is required\"),\n  unit: z.string().optional(),\n  hsnSac: z.string().optional(),\n  taxPreference: z.string().default(\"taxable\"),\n  exemptionReason: z.string().optional(),\n  sellable: z.boolean().default(true),\n  sellingPrice: z.string().optional(),\n  salesAccount: z.string().default(\"sales\"),\n  salesDescription: z.string().optional(),\n  purchasable: z.boolean().default(true),\n  costPrice: z.string().optional(),\n  purchaseAccount: z.string().default(\"cost_of_goods\"),\n  purchaseDescription: z.string().optional(),\n  preferredVendor: z.string().optional(),\n  intraStateTaxRate: z.string().default(\"gst18\"),\n  interStateTaxRate: z.string().default(\"igst18\"),\n});\n\ntype ItemFormValues = z.infer<typeof itemSchema>;\n\nconst taxPreferences = [\n  { label: \"Taxable\", value: \"taxable\" },\n  { label: \"Non-Taxable\", value: \"non_taxable\" },\n  { label: \"Out of Scope\", value: \"out_of_scope\" },\n  { label: \"Non-GST Supply\", value: \"non_gst\" },\n];\n\nconst exemptionReasons = [\n  { label: \"Exempt under section 10\", value: \"section_10\" },\n  { label: \"Exempt under section 11\", value: \"section_11\" },\n  { label: \"Exempt supply under notification\", value: \"notification\" },\n  { label: \"Other exemption\", value: \"other\" },\n];\n\n// Hierarchical account structure\nconst ACCOUNT_HIERARCHY = [\n  {\n    category: \"Other Current Asset\",\n    accounts: [\n      { label: \"Advance Tax\", value: \"advance_tax\" },\n      { label: \"Employee Advance\", value: \"employee_advance\" },\n      { label: \"Input Tax Credits\", value: \"input_tax_credits\", children: [\n        { label: \"Input CGST\", value: \"input_cgst\" },\n        { label: \"Input IGST\", value: \"input_igst\" },\n        { label: \"Input SGST\", value: \"input_sgst\" },\n      ]},\n      { label: \"Prepaid Expenses\", value: \"prepaid_expenses\" },\n      { label: \"Reverse Charge Tax Input but not due\", value: \"reverse_charge_input\" },\n      { label: \"TDS Receivable\", value: \"tds_receivable\" },\n    ]\n  },\n  {\n    category: \"Fixed Asset\",\n    accounts: [\n      { label: \"Furniture and Equipment\", value: \"furniture_equipment\" },\n    ]\n  },\n  {\n    category: \"Other Current Liability\",\n    accounts: [\n      { label: \"Employee Reimbursements\", value: \"employee_reimbursements\" },\n      { label: \"GST Payable\", value: \"gst_payable\", children: [\n        { label: \"Output CGST\", value: \"output_cgst\" },\n        { label: \"Output IGST\", value: \"output_igst\" },\n        { label: \"Output SGST\", value: \"output_sgst\" },\n      ]},\n      { label: \"Opening Balance Adjustments\", value: \"opening_balance_adjustments\" },\n      { label: \"Tax Payable\", value: \"tax_payable\" },\n      { label: \"TDS Payable\", value: \"tds_payable\" },\n      { label: \"Unearned Revenue\", value: \"unearned_revenue\" },\n    ]\n  },\n  {\n    category: \"Income\",\n    accounts: [\n      { label: \"Discount\", value: \"discount\" },\n      { label: \"General Income\", value: \"general_income\" },\n      { label: \"Interest Income\", value: \"interest_income\" },\n      { label: \"Late Fee Income\", value: \"late_fee_income\" },\n      { label: \"Other Charges\", value: \"other_charges\" },\n      { label: \"Sales\", value: \"sales\" },\n      { label: \"Shipping Charge\", value: \"shipping_charge\" },\n    ]\n  },\n  {\n    category: \"Cost of Goods Sold\",\n    accounts: [\n      { label: \"Cost of Goods Sold\", value: \"cost_of_goods\" },\n      { label: \"Job Costing\", value: \"job_costing\" },\n      { label: \"Materials\", value: \"materials\" },\n      { label: \"Subcontractor\", value: \"subcontractor\" },\n    ]\n  },\n  {\n    category: \"Expense\",\n    accounts: [\n      { label: \"Advertising And Marketing\", value: \"advertising_marketing\" },\n      { label: \"Automobile Expense\", value: \"automobile_expense\" },\n      { label: \"Bank Fees and Charges\", value: \"bank_fees\" },\n      { label: \"Consultant Expense\", value: \"consultant_expense\" },\n      { label: \"Office Supplies\", value: \"office_supplies\" },\n      { label: \"Rent Expense\", value: \"rent_expense\" },\n      { label: \"Travel Expense\", value: \"travel_expense\" },\n    ]\n  }\n];\n\n// Flatten accounts for search\nconst flattenAccounts = () => {\n  const flat: { label: string; value: string; category: string; indent: number }[] = [];\n  ACCOUNT_HIERARCHY.forEach(cat => {\n    cat.accounts.forEach(acc => {\n      flat.push({ label: acc.label, value: acc.value, category: cat.category, indent: 0 });\n      if ('children' in acc && acc.children) {\n        acc.children.forEach((child: any) => {\n          flat.push({ label: child.label, value: child.value, category: cat.category, indent: 1 });\n        });\n      }\n    });\n  });\n  return flat;\n};\n\nconst ALL_ACCOUNTS = flattenAccounts();\n\nexport default function ProductCreate() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [unitOpen, setUnitOpen] = useState(false);\n  const [showConfigureUnits, setShowConfigureUnits] = useState(false);\n  const [salesAccountOpen, setSalesAccountOpen] = useState(false);\n  const [purchaseAccountOpen, setPurchaseAccountOpen] = useState(false);\n  const [intraStateTaxOpen, setIntraStateTaxOpen] = useState(false);\n  const [interStateTaxOpen, setInterStateTaxOpen] = useState(false);\n  const [newUnitName, setNewUnitName] = useState(\"\");\n  const [newUnitUqc, setNewUnitUqc] = useState(\"\");\n  const [vendors, setVendors] = useState<{ label: string; value: string }[]>([]);\n  const [vendorsLoading, setVendorsLoading] = useState(true);\n\n  // Fetch units from API\n  const { data: unitsData, refetch: refetchUnits } = useQuery<{ success: boolean; data: Unit[] }>({\n    queryKey: ['/api/units'],\n  });\n  const units = unitsData?.data || [];\n\n  // Fetch tax rates from API\n  const { data: taxRatesData } = useQuery<{ success: boolean; data: TaxRate[] }>({\n    queryKey: ['/api/taxRates'],\n  });\n  const taxRates = taxRatesData?.data || [];\n\n  // Separate GST and IGST rates\n  const gstRates = taxRates.filter(t => t.name.startsWith('GST') || t.name === 'Exempt');\n  const igstRates = taxRates.filter(t => t.name.startsWith('IGST') || t.name === 'Exempt');\n\n  // Create unit mutation\n  const createUnitMutation = useMutation({\n    mutationFn: async (unit: { name: string; uqc: string }) => {\n      return apiRequest('POST', '/api/units', unit);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/units'] });\n      setNewUnitName(\"\");\n      setNewUnitUqc(\"\");\n      toast({ title: \"Unit created successfully\" });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Failed to create unit\", \n        description: error.message || \"Please try again\",\n        variant: \"destructive\" \n      });\n    },\n  });\n\n  // Delete unit mutation\n  const deleteUnitMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest('DELETE', `/api/units/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/units'] });\n      toast({ title: \"Unit deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete unit\", variant: \"destructive\" });\n    },\n  });\n\n  // Fetch vendors from API\n  useEffect(() => {\n    const fetchVendors = async () => {\n      try {\n        const response = await fetch('/api/vendors');\n        if (response.ok) {\n          const result = await response.json();\n          const vendorOptions = result.data.map((vendor: any) => ({\n            label: vendor.displayName || vendor.companyName || `${vendor.firstName} ${vendor.lastName}`.trim(),\n            value: vendor.id,\n          }));\n          setVendors(vendorOptions);\n        }\n      } catch (error) {\n        console.error('Failed to fetch vendors:', error);\n      } finally {\n        setVendorsLoading(false);\n      }\n    };\n    fetchVendors();\n  }, []);\n\n  const form = useForm<ItemFormValues>({\n    resolver: zodResolver(itemSchema),\n    defaultValues: {\n      type: \"goods\",\n      name: \"\",\n      taxPreference: \"taxable\",\n      sellable: true,\n      purchasable: true,\n      salesAccount: \"sales\",\n      purchaseAccount: \"cost_of_goods\",\n      intraStateTaxRate: \"GST18\",\n      interStateTaxRate: \"IGST18\",\n    },\n  });\n\n  const itemType = form.watch(\"type\");\n  const taxPreference = form.watch(\"taxPreference\");\n  const sellable = form.watch(\"sellable\");\n  const purchasable = form.watch(\"purchasable\");\n\n  const onSubmit = async (data: ItemFormValues) => {\n    try {\n      const itemData = {\n        name: data.name,\n        type: data.type,\n        hsnSac: data.hsnSac || \"\",\n        usageUnit: data.unit || \"\",\n        rate: data.sellingPrice || \"0.00\",\n        purchaseRate: data.costPrice || \"0.00\",\n        description: data.salesDescription || \"\",\n        purchaseDescription: data.purchaseDescription || \"\",\n        taxPreference: data.taxPreference,\n        intraStateTax: data.intraStateTaxRate,\n        interStateTax: data.interStateTaxRate,\n        salesAccount: data.salesAccount,\n        purchaseAccount: data.purchaseAccount,\n      };\n\n      const response = await fetch('/api/items', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(itemData),\n      });\n\n      if (response.ok) {\n        queryClient.invalidateQueries({ queryKey: ['/api/items'] });\n        toast({\n          title: \"Item Created\",\n          description: \"The item has been successfully added.\",\n        });\n        setLocation(\"/items\");\n      } else {\n        throw new Error(\"Failed to create item\");\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create item. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleAddUnit = () => {\n    if (!newUnitName.trim() || !newUnitUqc.trim()) {\n      toast({ title: \"Both Unit name and UQC code are required\", variant: \"destructive\" });\n      return;\n    }\n    createUnitMutation.mutate({ name: newUnitName, uqc: newUnitUqc });\n  };\n\n  const getAccountLabel = (value: string) => {\n    const acc = ALL_ACCOUNTS.find(a => a.value === value);\n    return acc?.label || value;\n  };\n\n  const getTaxRateLabel = (value: string) => {\n    const tax = taxRates.find(t => t.name === value);\n    return tax?.label || value;\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 bg-black/20\">\n      <div className=\"fixed inset-y-0 right-0 w-full max-w-2xl bg-white shadow-xl overflow-hidden flex flex-col animate-in slide-in-from-right duration-300\">\n        <div className=\"flex items-center justify-between p-4 border-b border-slate-200\">\n          <h1 className=\"text-xl font-semibold text-slate-900\">New Item</h1>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setLocation(\"/products\")}\n            className=\"h-8 w-8\"\n            data-testid=\"button-close-form\"\n          >\n            <X className=\"h-5 w-5\" />\n          </Button>\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n\n              <FormField\n                control={form.control}\n                name=\"type\"\n                render={({ field }) => (\n                  <FormItem className=\"flex items-center gap-8\">\n                    <div className=\"text-slate-600 min-w-[100px] flex items-center gap-1 text-sm font-medium\">\n                      Type\n                      <Tooltip>\n                        <TooltipTrigger asChild>\n                          <HelpCircle className=\"h-3.5 w-3.5 text-slate-400\" />\n                        </TooltipTrigger>\n                        <TooltipContent>\n                          <p>Select whether this is a physical product (Goods) or a service</p>\n                        </TooltipContent>\n                      </Tooltip>\n                    </div>\n                    <FormControl>\n                      <RadioGroup\n                        onValueChange={field.onChange}\n                        defaultValue={field.value}\n                        className=\"flex gap-6\"\n                      >\n                        <div className=\"flex items-center space-x-2\">\n                          <RadioGroupItem value=\"goods\" id=\"goods\" className=\"border-blue-600 text-blue-600\" data-testid=\"radio-goods\" />\n                          <Label htmlFor=\"goods\" className=\"font-normal cursor-pointer\">Goods</Label>\n                        </div>\n                        <div className=\"flex items-center space-x-2\">\n                          <RadioGroupItem value=\"service\" id=\"service\" className=\"border-blue-600 text-blue-600\" data-testid=\"radio-service\" />\n                          <Label htmlFor=\"service\" className=\"font-normal cursor-pointer\">Service</Label>\n                        </div>\n                      </RadioGroup>\n                    </FormControl>\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem className=\"grid grid-cols-[120px_1fr] items-start gap-4\">\n                    <FormLabel className=\"text-slate-700 pt-2.5\">\n                      Name<span className=\"text-red-600\">*</span>\n                    </FormLabel>\n                    <div>\n                      <FormControl>\n                        <Input {...field} className=\"bg-white border-blue-500 focus:border-blue-600\" autoFocus data-testid=\"input-item-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </div>\n                  </FormItem>\n                )}\n              />\n\n              {/* Unit Dropdown with API data */}\n              <FormField\n                control={form.control}\n                name=\"unit\"\n                render={({ field }) => (\n                  <FormItem className=\"grid grid-cols-[120px_1fr] items-start gap-4\">\n                    <div className=\"text-slate-600 pt-2.5 flex items-center gap-1 text-sm font-medium\">\n                      Unit\n                      <Tooltip>\n                        <TooltipTrigger asChild>\n                          <HelpCircle className=\"h-3.5 w-3.5 text-slate-400\" />\n                        </TooltipTrigger>\n                        <TooltipContent>\n                          <p>Select the unit of measurement for this item</p>\n                        </TooltipContent>\n                      </Tooltip>\n                    </div>\n                    <div>\n                      <Popover open={unitOpen} onOpenChange={setUnitOpen}>\n                        <PopoverTrigger asChild>\n                          <FormControl>\n                            <Button\n                              variant=\"outline\"\n                              role=\"combobox\"\n                              className={cn(\n                                \"w-full justify-between font-normal bg-white\",\n                                !field.value && \"text-muted-foreground\"\n                              )}\n                              data-testid=\"select-unit\"\n                            >\n                              {field.value\n                                ? units.find((u) => u.name === field.value)\n                                  ? `${field.value} (${units.find((u) => u.name === field.value)?.uqc || ''})`\n                                  : field.value\n                                : \"Select unit...\"}\n                              <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                            </Button>\n                          </FormControl>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-[300px] p-0\" align=\"start\">\n                          <Command>\n                            <CommandInput placeholder=\"Search\" />\n                            <CommandList className=\"max-h-[200px] overflow-y-auto\">\n                              <CommandEmpty>No unit found.</CommandEmpty>\n                              <CommandGroup>\n                                {units.map((unit) => (\n                                  <CommandItem\n                                    value={`${unit.name} (${unit.uqc})`}\n                                    key={unit.id}\n                                    onSelect={() => {\n                                      form.setValue(\"unit\", unit.name);\n                                      setUnitOpen(false);\n                                    }}\n                                    data-testid={`unit-option-${unit.name}`}\n                                  >\n                                    <Check\n                                      className={cn(\n                                        \"mr-2 h-4 w-4\",\n                                        unit.name === field.value ? \"opacity-100\" : \"opacity-0\"\n                                      )}\n                                    />\n                                    {unit.name} ({unit.uqc})\n                                  </CommandItem>\n                                ))}\n                              </CommandGroup>\n                              <CommandSeparator />\n                              <CommandGroup>\n                                <CommandItem\n                                  className=\"text-blue-600 cursor-pointer\"\n                                  onSelect={() => {\n                                    setUnitOpen(false);\n                                    setShowConfigureUnits(true);\n                                  }}\n                                  data-testid=\"button-configure-units\"\n                                >\n                                  <Settings className=\"mr-2 h-4 w-4\" />\n                                  Configure Units\n                                </CommandItem>\n                              </CommandGroup>\n                            </CommandList>\n                          </Command>\n                        </PopoverContent>\n                      </Popover>\n                    </div>\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"hsnSac\"\n                render={({ field }) => (\n                  <FormItem className=\"grid grid-cols-[120px_1fr] items-start gap-4\">\n                    <FormLabel className=\"text-slate-600 pt-2.5\">\n                      {itemType === \"goods\" ? \"HSN Code\" : \"SAC\"}\n                    </FormLabel>\n                    <div className=\"relative\">\n                      <FormControl>\n                        <Input {...field} className=\"bg-white pr-10\" data-testid=\"input-hsn-sac\" />\n                      </FormControl>\n                      <Search className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-blue-500 cursor-pointer\" />\n                    </div>\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"taxPreference\"\n                render={({ field }) => (\n                  <FormItem className=\"grid grid-cols-[120px_1fr] items-start gap-4\">\n                    <FormLabel className=\"text-slate-700 pt-2.5\">\n                      Tax Preference<span className=\"text-red-600\">*</span>\n                    </FormLabel>\n                    <div>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger className=\"bg-white\" data-testid=\"select-tax-preference\">\n                            <SelectValue placeholder=\"Select tax preference\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {taxPreferences.map((pref) => (\n                            <SelectItem key={pref.value} value={pref.value}>\n                              {pref.label}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </FormItem>\n                )}\n              />\n\n              {taxPreference === \"non_gst\" && (\n                <FormField\n                  control={form.control}\n                  name=\"exemptionReason\"\n                  render={({ field }) => (\n                    <FormItem className=\"grid grid-cols-[120px_1fr] items-start gap-4\">\n                      <div className=\"text-slate-700 pt-2.5 flex items-center gap-1 text-sm font-medium\">\n                        Exemption Reason<span className=\"text-red-600\">*</span>\n                      </div>\n                      <div>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger className=\"bg-white\">\n                              <SelectValue placeholder=\"Select exemption reason\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {exemptionReasons.map((reason) => (\n                              <SelectItem key={reason.value} value={reason.value}>\n                                {reason.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </FormItem>\n                  )}\n                />\n              )}\n\n              {/* Default Tax Rates Section */}\n              <div className=\"border-t pt-4 mt-4\">\n                <h3 className=\"font-semibold text-slate-800 mb-4\">Default Tax Rates</h3>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  {/* Intra State Tax Dropdown */}\n                  <FormField\n                    control={form.control}\n                    name=\"intraStateTaxRate\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-slate-700\">Intra State Tax</FormLabel>\n                        <Popover open={intraStateTaxOpen} onOpenChange={setIntraStateTaxOpen}>\n                          <PopoverTrigger asChild>\n                            <FormControl>\n                              <Button\n                                variant=\"outline\"\n                                role=\"combobox\"\n                                className=\"w-full justify-between font-normal bg-white\"\n                                data-testid=\"select-intra-state-tax\"\n                              >\n                                {getTaxRateLabel(field.value)}\n                                <Search className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                              </Button>\n                            </FormControl>\n                          </PopoverTrigger>\n                          <PopoverContent className=\"w-[250px] p-0\" align=\"start\">\n                            <Command>\n                              <CommandInput placeholder=\"Search tax rates...\" />\n                              <CommandList>\n                                <CommandEmpty>No tax rate found.</CommandEmpty>\n                                <CommandGroup>\n                                  {gstRates.map((tax) => (\n                                    <CommandItem\n                                      key={tax.id}\n                                      value={tax.label}\n                                      onSelect={() => {\n                                        form.setValue(\"intraStateTaxRate\", tax.name);\n                                        setIntraStateTaxOpen(false);\n                                      }}\n                                    >\n                                      <Check\n                                        className={cn(\n                                          \"mr-2 h-4 w-4\",\n                                          tax.name === field.value ? \"opacity-100\" : \"opacity-0\"\n                                        )}\n                                      />\n                                      {tax.label}\n                                    </CommandItem>\n                                  ))}\n                                </CommandGroup>\n                              </CommandList>\n                            </Command>\n                          </PopoverContent>\n                        </Popover>\n                      </FormItem>\n                    )}\n                  />\n\n                  {/* Inter State Tax Dropdown */}\n                  <FormField\n                    control={form.control}\n                    name=\"interStateTaxRate\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-slate-700\">Inter State Tax</FormLabel>\n                        <Popover open={interStateTaxOpen} onOpenChange={setInterStateTaxOpen}>\n                          <PopoverTrigger asChild>\n                            <FormControl>\n                              <Button\n                                variant=\"outline\"\n                                role=\"combobox\"\n                                className=\"w-full justify-between font-normal bg-white\"\n                                data-testid=\"select-inter-state-tax\"\n                              >\n                                {getTaxRateLabel(field.value)}\n                                <Search className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                              </Button>\n                            </FormControl>\n                          </PopoverTrigger>\n                          <PopoverContent className=\"w-[250px] p-0\" align=\"start\">\n                            <Command>\n                              <CommandInput placeholder=\"Search tax rates...\" />\n                              <CommandList>\n                                <CommandEmpty>No tax rate found.</CommandEmpty>\n                                <CommandGroup>\n                                  {igstRates.map((tax) => (\n                                    <CommandItem\n                                      key={tax.id}\n                                      value={tax.label}\n                                      onSelect={() => {\n                                        form.setValue(\"interStateTaxRate\", tax.name);\n                                        setInterStateTaxOpen(false);\n                                      }}\n                                    >\n                                      <Check\n                                        className={cn(\n                                          \"mr-2 h-4 w-4\",\n                                          tax.name === field.value ? \"opacity-100\" : \"opacity-0\"\n                                        )}\n                                      />\n                                      {tax.label}\n                                    </CommandItem>\n                                  ))}\n                                </CommandGroup>\n                              </CommandList>\n                            </Command>\n                          </PopoverContent>\n                        </Popover>\n                      </FormItem>\n                    )}\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-8 pt-4\">\n                {/* Sales Information */}\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"font-semibold text-slate-800\">Sales Information</h3>\n                    <FormField\n                      control={form.control}\n                      name=\"sellable\"\n                      render={({ field }) => (\n                        <FormItem className=\"flex items-center space-x-2 space-y-0\">\n                          <FormControl>\n                            <Checkbox\n                              checked={field.value}\n                              onCheckedChange={field.onChange}\n                              data-testid=\"checkbox-sellable\"\n                            />\n                          </FormControl>\n                          <Label className=\"font-normal text-sm\">Sellable</Label>\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  {sellable && (\n                    <>\n                      <FormField\n                        control={form.control}\n                        name=\"sellingPrice\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-slate-700\">\n                              Selling Price<span className=\"text-red-600\">*</span>\n                            </FormLabel>\n                            <div className=\"flex\">\n                              <span className=\"bg-slate-100 border border-r-0 border-slate-300 rounded-l-md px-3 py-2 text-sm text-slate-600\">INR</span>\n                              <FormControl>\n                                <Input {...field} className=\"rounded-l-none bg-white\" placeholder=\"0.00\" data-testid=\"input-selling-price\" />\n                              </FormControl>\n                            </div>\n                          </FormItem>\n                        )}\n                      />\n\n                      {/* Sales Account - Searchable Hierarchical */}\n                      <FormField\n                        control={form.control}\n                        name=\"salesAccount\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-slate-700\">\n                              Account<span className=\"text-red-600\">*</span>\n                            </FormLabel>\n                            <Popover open={salesAccountOpen} onOpenChange={setSalesAccountOpen}>\n                              <PopoverTrigger asChild>\n                                <FormControl>\n                                  <Button\n                                    variant=\"outline\"\n                                    role=\"combobox\"\n                                    className=\"w-full justify-between font-normal bg-white\"\n                                    data-testid=\"select-sales-account\"\n                                  >\n                                    {getAccountLabel(field.value)}\n                                    <Search className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                                  </Button>\n                                </FormControl>\n                              </PopoverTrigger>\n                              <PopoverContent className=\"w-[350px] p-0\" align=\"start\">\n                                <Command>\n                                  <CommandInput placeholder=\"Search accounts...\" />\n                                  <CommandList className=\"max-h-[300px] overflow-y-auto\">\n                                    <CommandEmpty>No account found.</CommandEmpty>\n                                    {ACCOUNT_HIERARCHY.map((category) => (\n                                      <CommandGroup key={category.category} heading={category.category}>\n                                        {category.accounts.map((acc) => (\n                                          <div key={acc.value}>\n                                            <CommandItem\n                                              value={acc.label}\n                                              onSelect={() => {\n                                                form.setValue(\"salesAccount\", acc.value);\n                                                setSalesAccountOpen(false);\n                                              }}\n                                            >\n                                              <Check\n                                                className={cn(\n                                                  \"mr-2 h-4 w-4\",\n                                                  acc.value === field.value ? \"opacity-100\" : \"opacity-0\"\n                                                )}\n                                              />\n                                              {acc.label}\n                                            </CommandItem>\n                                            {'children' in acc && acc.children && acc.children.map((child: any) => (\n                                              <CommandItem\n                                                key={child.value}\n                                                value={child.label}\n                                                onSelect={() => {\n                                                  form.setValue(\"salesAccount\", child.value);\n                                                  setSalesAccountOpen(false);\n                                                }}\n                                                className=\"pl-8\"\n                                              >\n                                                <Check\n                                                  className={cn(\n                                                    \"mr-2 h-4 w-4\",\n                                                    child.value === field.value ? \"opacity-100\" : \"opacity-0\"\n                                                  )}\n                                                />\n                                                 {child.label}\n                                              </CommandItem>\n                                            ))}\n                                          </div>\n                                        ))}\n                                      </CommandGroup>\n                                    ))}\n                                  </CommandList>\n                                </Command>\n                              </PopoverContent>\n                            </Popover>\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={form.control}\n                        name=\"salesDescription\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-slate-600\">Description</FormLabel>\n                            <FormControl>\n                              <Textarea {...field} className=\"bg-white min-h-[80px] resize-none\" data-testid=\"textarea-sales-description\" />\n                            </FormControl>\n                          </FormItem>\n                        )}\n                      />\n                    </>\n                  )}\n                </div>\n\n                {/* Purchase Information */}\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"font-semibold text-slate-800\">Purchase Information</h3>\n                    <FormField\n                      control={form.control}\n                      name=\"purchasable\"\n                      render={({ field }) => (\n                        <FormItem className=\"flex items-center space-x-2 space-y-0\">\n                          <FormControl>\n                            <Checkbox\n                              checked={field.value}\n                              onCheckedChange={field.onChange}\n                              data-testid=\"checkbox-purchasable\"\n                            />\n                          </FormControl>\n                          <Label className=\"font-normal text-sm\">Purchasable</Label>\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  {purchasable && (\n                    <>\n                      <FormField\n                        control={form.control}\n                        name=\"costPrice\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-slate-700\">\n                              Cost Price<span className=\"text-red-600\">*</span>\n                            </FormLabel>\n                            <div className=\"flex\">\n                              <span className=\"bg-slate-100 border border-r-0 border-slate-300 rounded-l-md px-3 py-2 text-sm text-slate-600\">INR</span>\n                              <FormControl>\n                                <Input {...field} className=\"rounded-l-none bg-white\" placeholder=\"0.00\" data-testid=\"input-cost-price\" />\n                              </FormControl>\n                            </div>\n                          </FormItem>\n                        )}\n                      />\n\n                      {/* Purchase Account - Searchable Hierarchical */}\n                      <FormField\n                        control={form.control}\n                        name=\"purchaseAccount\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-slate-700\">\n                              Account<span className=\"text-red-600\">*</span>\n                            </FormLabel>\n                            <Popover open={purchaseAccountOpen} onOpenChange={setPurchaseAccountOpen}>\n                              <PopoverTrigger asChild>\n                                <FormControl>\n                                  <Button\n                                    variant=\"outline\"\n                                    role=\"combobox\"\n                                    className=\"w-full justify-between font-normal bg-white\"\n                                    data-testid=\"select-purchase-account\"\n                                  >\n                                    {getAccountLabel(field.value)}\n                                    <Search className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                                  </Button>\n                                </FormControl>\n                              </PopoverTrigger>\n                              <PopoverContent className=\"w-[350px] p-0\" align=\"start\">\n                                <Command>\n                                  <CommandInput placeholder=\"Search accounts...\" />\n                                  <CommandList className=\"max-h-[300px] overflow-y-auto\">\n                                    <CommandEmpty>No account found.</CommandEmpty>\n                                    {ACCOUNT_HIERARCHY.map((category) => (\n                                      <CommandGroup key={category.category} heading={category.category}>\n                                        {category.accounts.map((acc) => (\n                                          <div key={acc.value}>\n                                            <CommandItem\n                                              value={acc.label}\n                                              onSelect={() => {\n                                                form.setValue(\"purchaseAccount\", acc.value);\n                                                setPurchaseAccountOpen(false);\n                                              }}\n                                            >\n                                              <Check\n                                                className={cn(\n                                                  \"mr-2 h-4 w-4\",\n                                                  acc.value === field.value ? \"opacity-100\" : \"opacity-0\"\n                                                )}\n                                              />\n                                              {acc.label}\n                                            </CommandItem>\n                                            {'children' in acc && acc.children && acc.children.map((child: any) => (\n                                              <CommandItem\n                                                key={child.value}\n                                                value={child.label}\n                                                onSelect={() => {\n                                                  form.setValue(\"purchaseAccount\", child.value);\n                                                  setPurchaseAccountOpen(false);\n                                                }}\n                                                className=\"pl-8\"\n                                              >\n                                                <Check\n                                                  className={cn(\n                                                    \"mr-2 h-4 w-4\",\n                                                    child.value === field.value ? \"opacity-100\" : \"opacity-0\"\n                                                  )}\n                                                />\n                                                 {child.label}\n                                              </CommandItem>\n                                            ))}\n                                          </div>\n                                        ))}\n                                      </CommandGroup>\n                                    ))}\n                                  </CommandList>\n                                </Command>\n                              </PopoverContent>\n                            </Popover>\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={form.control}\n                        name=\"purchaseDescription\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-slate-600\">Description</FormLabel>\n                            <FormControl>\n                              <Textarea {...field} className=\"bg-white min-h-[80px] resize-none\" data-testid=\"textarea-purchase-description\" />\n                            </FormControl>\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={form.control}\n                        name=\"preferredVendor\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-slate-600\">Preferred Vendor</FormLabel>\n                            <Select onValueChange={field.onChange} defaultValue={field.value}>\n                              <FormControl>\n                                <SelectTrigger className=\"bg-white\" data-testid=\"select-preferred-vendor\">\n                                  <SelectValue placeholder=\"Select a vendor\" />\n                                </SelectTrigger>\n                              </FormControl>\n                              <SelectContent>\n                                {vendors.map((vendor) => (\n                                  <SelectItem key={vendor.value} value={vendor.value}>\n                                    {vendor.label}\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          </FormItem>\n                        )}\n                      />\n                    </>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"flex justify-end gap-3 pt-4 border-t mt-6\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setLocation(\"/products\")}\n                  data-testid=\"button-cancel\"\n                >\n                  Cancel\n                </Button>\n                <Button type=\"submit\" className=\"bg-blue-600 hover:bg-blue-700\" data-testid=\"button-save-item\">\n                  Save\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </div>\n      </div>\n\n      {/* Configure Units Modal */}\n      <Dialog open={showConfigureUnits} onOpenChange={setShowConfigureUnits}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Configure Units</DialogTitle>\n          </DialogHeader>\n          \n          <div className=\"space-y-4 max-h-[400px] overflow-y-auto\">\n            <div className=\"grid grid-cols-2 gap-4 pb-2 border-b\">\n              <Label className=\"text-red-600\">Unit*</Label>\n              <Label className=\"text-slate-600\">Unique Quantity Code (UQC)</Label>\n            </div>\n            \n            {units.map((unit) => (\n              <div key={unit.id} className=\"grid grid-cols-2 gap-4 items-center\">\n                <Input value={unit.name} disabled className=\"bg-slate-50\" />\n                <div className=\"flex items-center gap-2\">\n                  <Input value={unit.uqc} disabled className=\"bg-slate-50 flex-1\" />\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"h-8 w-8 text-red-500 hover:text-red-600\"\n                    onClick={() => deleteUnitMutation.mutate(unit.id)}\n                    data-testid={`button-delete-unit-${unit.id}`}\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            ))}\n            \n            {/* Add New Unit Row */}\n            <div className=\"grid grid-cols-2 gap-4 items-center pt-2 border-t\">\n              <Input\n                placeholder=\"Unit name\"\n                value={newUnitName}\n                onChange={(e) => setNewUnitName(e.target.value)}\n                data-testid=\"input-new-unit-name\"\n              />\n              <div className=\"flex items-center gap-2\">\n                <Input\n                  placeholder=\"UQC code\"\n                  value={newUnitUqc}\n                  onChange={(e) => setNewUnitUqc(e.target.value.toUpperCase())}\n                  data-testid=\"input-new-unit-uqc\"\n                />\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"h-8 w-8 text-green-500 hover:text-green-600\"\n                  onClick={handleAddUnit}\n                  data-testid=\"button-add-unit\"\n                >\n                  <Plus className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowConfigureUnits(false)} data-testid=\"button-cancel-units\">\n              Cancel\n            </Button>\n            <Button \n              className=\"bg-blue-600 hover:bg-blue-700\" \n              onClick={() => setShowConfigureUnits(false)}\n              data-testid=\"button-save-units\"\n            >\n              Save\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":48858,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationLink,\n  PaginationItem,\n  PaginationPrevious,\n  PaginationNext,\n  PaginationEllipsis,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"server/src/modules/items/service/index.ts":{"content":"import { ItemsRepository } from '../repository';\nimport { NotFoundError } from '../../../middleware';\n\nexport interface CreateItemDto {\n  name: string;\n  description?: string;\n  type: 'goods' | 'service';\n  sku?: string;\n  hsnSac?: string;\n  unit?: string;\n  sellingPrice: number;\n  purchasePrice: number;\n  taxRate?: number;\n}\n\nexport interface UpdateItemDto extends Partial<CreateItemDto> {\n  isActive?: boolean;\n}\n\nexport class ItemsService {\n  private repository: ItemsRepository;\n\n  constructor() {\n    this.repository = new ItemsRepository();\n  }\n\n  async findAll(page = 1, limit = 10, filters?: Record<string, any>) {\n    const offset = (page - 1) * limit;\n    const { items, total } = await this.repository.findAll(limit, offset, filters);\n    \n    return {\n      data: items,\n      meta: {\n        page,\n        limit,\n        total,\n        totalPages: Math.ceil(total / limit),\n      },\n    };\n  }\n\n  async findById(id: string) {\n    const item = await this.repository.findById(id);\n    if (!item) {\n      throw new NotFoundError('Item');\n    }\n    return item;\n  }\n\n  async create(data: CreateItemDto) {\n    return this.repository.create(data);\n  }\n\n  async update(id: string, data: UpdateItemDto) {\n    const existing = await this.repository.findById(id);\n    if (!existing) {\n      throw new NotFoundError('Item');\n    }\n    return this.repository.update(id, data);\n  }\n\n  async delete(id: string) {\n    const existing = await this.repository.findById(id);\n    if (!existing) {\n      throw new NotFoundError('Item');\n    }\n    return this.repository.delete(id);\n  }\n}\n\nexport default ItemsService;\n","path":null,"size_bytes":1612,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/modules/expenses/components/ExpenseDetailPanel.tsx":{"content":"import { X, Edit, Printer, MoreHorizontal, Upload, Trash2, FileText, Maximize2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuSeparator,\n    DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\n\ninterface Expense {\n    id: string;\n    expenseNumber: string;\n    date: string;\n    expenseAccount: string;\n    amount: number;\n    currency: string;\n    paidThrough: string;\n    expenseType: string;\n    sac: string;\n    vendorId: string;\n    vendorName: string;\n    gstTreatment: string;\n    sourceOfSupply: string;\n    destinationOfSupply: string;\n    reverseCharge: boolean;\n    tax: string;\n    taxAmount: number;\n    amountIs: string;\n    invoiceNumber: string;\n    notes: string;\n    customerId: string;\n    customerName: string;\n    reportingTags: string[];\n    isBillable: boolean;\n    status: string;\n    attachments: string[];\n    createdAt: string;\n    updatedAt: string;\n    gstin?: string;\n}\n\ninterface ExpenseDetailPanelProps {\n    expense: Expense;\n    onClose: () => void;\n    onEdit: () => void;\n    onDelete: () => void;\n}\n\nexport default function ExpenseDetailPanel({\n    expense,\n    onClose,\n    onEdit,\n    onDelete,\n}: ExpenseDetailPanelProps) {\n    const formatCurrency = (amount: number) => {\n        return new Intl.NumberFormat('en-IN', {\n            style: 'currency',\n            currency: 'INR',\n            minimumFractionDigits: 2,\n        }).format(amount);\n    };\n\n    const formatDate = (dateString: string) => {\n        return new Date(dateString).toLocaleDateString('en-IN', {\n            day: '2-digit',\n            month: '2-digit',\n            year: 'numeric',\n        });\n    };\n\n    const getTaxLabel = (tax: string) => {\n        const taxMap: Record<string, string> = {\n            'gst_5': 'GST5 [5%]',\n            'gst_12': 'GST12 [12%]',\n            'gst_18': 'GST18 [18%]',\n            'gst_28': 'GST28 [28%]',\n            'igst_5': 'IGST5 [5%]',\n            'igst_12': 'IGST12 [12%]',\n            'igst_18': 'IGST18 [18%]',\n            'igst_28': 'IGST28 [28%]',\n            'exempt': 'Exempt [0%]',\n            'none': 'None [0%]',\n        };\n        return taxMap[tax] || 'IGST0 [0%]';\n    };\n\n    return (\n        <div className=\"h-full flex flex-col bg-background dark:bg-background\">\n            <div className=\"flex items-center justify-between px-6 py-4 border-b\">\n                <h2 className=\"text-lg font-semibold\">Expense Details</h2>\n                <div className=\"flex items-center gap-1\">\n                    <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-expand\">\n                        <Maximize2 className=\"h-4 w-4\" />\n                    </Button>\n                    <Button variant=\"ghost\" size=\"icon\" onClick={onClose} data-testid=\"button-close-panel\">\n                        <X className=\"h-4 w-4\" />\n                    </Button>\n                </div>\n            </div>\n\n            <div className=\"flex items-center gap-2 px-6 py-3 border-b\">\n                <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\" onClick={onEdit} data-testid=\"button-edit-expense\">\n                    <Edit className=\"h-4 w-4\" />\n                    Edit\n                </Button>\n                <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\" data-testid=\"button-print-expense\">\n                    <Printer className=\"h-4 w-4\" />\n                    Print\n                </Button>\n                <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                        <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-more-actions\">\n                            <MoreHorizontal className=\"h-4 w-4\" />\n                        </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent align=\"start\">\n                        <DropdownMenuItem data-testid=\"action-clone\">\n                            <FileText className=\"h-4 w-4 mr-2\" />\n                            Clone\n                        </DropdownMenuItem>\n                        <DropdownMenuSeparator />\n                        <DropdownMenuItem className=\"text-destructive\" onClick={onDelete} data-testid=\"action-delete\">\n                            <Trash2 className=\"h-4 w-4 mr-2\" />\n                            Delete\n                        </DropdownMenuItem>\n                    </DropdownMenuContent>\n                </DropdownMenu>\n            </div>\n\n            <div className=\"flex-1 overflow-y-auto\">\n                <div className=\"flex gap-6 p-6\">\n                    <div className=\"flex-1 space-y-5\">\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">Paid Through</p>\n                            <p className=\"font-medium\">{expense.paidThrough || 'Undeposited Funds'}</p>\n                        </div>\n\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">Tax</p>\n                            <p className=\"font-medium\">{getTaxLabel(expense.tax)}</p>\n                        </div>\n\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">Tax Amount</p>\n                            <p className=\"font-medium\">{formatCurrency(expense.taxAmount || 0)} ( {expense.amountIs === 'tax_inclusive' ? 'Inclusive' : 'Exclusive'} )</p>\n                        </div>\n\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">Ref #</p>\n                            <p className=\"font-medium\">{expense.invoiceNumber || expense.expenseNumber}</p>\n                        </div>\n\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">Paid To</p>\n                            <p className=\"font-medium text-blue-600 hover:underline cursor-pointer\" data-testid=\"link-vendor\">\n                                {expense.vendorName || '-'}\n                            </p>\n                        </div>\n\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">GST Treatment</p>\n                            <p className=\"font-medium\">{expense.gstTreatment || 'Registered Business - Regular'}</p>\n                        </div>\n\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">GSTIN / UIN</p>\n                            <p className=\"font-medium\">{expense.gstin || expense.vendorId || '09AACCI9016K1ZB'}</p>\n                        </div>\n\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">Source of Supply</p>\n                            <p className=\"font-medium\">{expense.sourceOfSupply || 'Uttar Pradesh'}</p>\n                        </div>\n\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">Destination of Supply</p>\n                            <p className=\"font-medium\">{expense.destinationOfSupply || 'Maharashtra'}</p>\n                        </div>\n                    </div>\n\n                    <div className=\"w-52\">\n                        <div className=\"border-2 border-dashed rounded-lg p-6 text-center bg-muted/30\">\n                            <div className=\"h-12 w-12 mx-auto mb-3 border-2 border-dashed rounded flex items-center justify-center\">\n                                <Upload className=\"h-5 w-5 text-muted-foreground\" />\n                            </div>\n                            <p className=\"text-sm text-muted-foreground\">Upload your Files</p>\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"px-6 pb-6\">\n                    <Tabs defaultValue=\"journal\" className=\"w-full\">\n                        <TabsList className=\"bg-transparent border-b w-full justify-start rounded-none h-auto p-0\">\n                            <TabsTrigger \n                                value=\"journal\" \n                                className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-600 data-[state=active]:bg-transparent data-[state=active]:shadow-none px-4 py-2\"\n                                data-testid=\"tab-journal\"\n                            >\n                                Journal\n                            </TabsTrigger>\n                        </TabsList>\n                        <TabsContent value=\"journal\" className=\"mt-4 space-y-4\">\n                            <div className=\"flex items-center gap-2\">\n                                <span className=\"text-sm text-muted-foreground\">Amount is displayed in your base currency</span>\n                                <Badge variant=\"secondary\" className=\"bg-green-600 text-white hover:bg-green-600\">\n                                    INR\n                                </Badge>\n                            </div>\n\n                            <div className=\"space-y-4\">\n                                <h3 className=\"font-semibold text-lg\">Expense</h3>\n                                <div className=\"border rounded-lg overflow-hidden\">\n                                    <table className=\"w-full text-sm\">\n                                        <thead className=\"bg-muted/50\">\n                                            <tr>\n                                                <th className=\"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider\">ACCOUNT</th>\n                                                <th className=\"px-4 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider\">DEBIT</th>\n                                                <th className=\"px-4 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider\">CREDIT</th>\n                                            </tr>\n                                        </thead>\n                                        <tbody className=\"divide-y\">\n                                            <tr>\n                                                <td className=\"px-4 py-3\">{expense.paidThrough || 'Undeposited Funds'}</td>\n                                                <td className=\"px-4 py-3 text-right\">0.00</td>\n                                                <td className=\"px-4 py-3 text-right\">{expense.amount.toFixed(2)}</td>\n                                            </tr>\n                                            <tr>\n                                                <td className=\"px-4 py-3\">Input IGST</td>\n                                                <td className=\"px-4 py-3 text-right\">0.00</td>\n                                                <td className=\"px-4 py-3 text-right\">0.00</td>\n                                            </tr>\n                                            <tr>\n                                                <td className=\"px-4 py-3\">{expense.expenseAccount}</td>\n                                                <td className=\"px-4 py-3 text-right\">{expense.amount.toFixed(2)}</td>\n                                                <td className=\"px-4 py-3 text-right\">0.00</td>\n                                            </tr>\n                                            <tr className=\"font-semibold bg-muted/30\">\n                                                <td className=\"px-4 py-3\"></td>\n                                                <td className=\"px-4 py-3 text-right\">{expense.amount.toFixed(2)}</td>\n                                                <td className=\"px-4 py-3 text-right\">{expense.amount.toFixed(2)}</td>\n                                            </tr>\n                                        </tbody>\n                                    </table>\n                                </div>\n                            </div>\n                        </TabsContent>\n                    </Tabs>\n                </div>\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":12205,"size_tokens":null},"client/src/pages/purchase-order-create.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Plus, X, Search, Upload, ChevronDown, HelpCircle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { AccountSelectDropdown } from \"@/components/AccountSelectDropdown\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n} from \"@/components/ui/command\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\n\ninterface Vendor {\n  id: string;\n  displayName: string;\n  companyName?: string;\n  billingAddress?: {\n    street1?: string;\n    street2?: string;\n    city?: string;\n    state?: string;\n    pinCode?: string;\n    countryRegion?: string;\n  };\n  gstin?: string;\n}\n\ninterface Customer {\n  id: string;\n  name: string;\n  displayName: string;\n  email?: string;\n  phone?: string;\n  billingAddress?: {\n    street?: string;\n    city?: string;\n    state?: string;\n    country?: string;\n    pincode?: string;\n  };\n  shippingAddress?: {\n    street?: string;\n    city?: string;\n    state?: string;\n    country?: string;\n    pincode?: string;\n  };\n}\n\ninterface Item {\n  id: string;\n  name: string;\n  description?: string;\n  purchaseDescription?: string;\n  rate?: string | number;\n  purchaseRate?: string | number;\n  sellingPrice?: number;\n  purchasePrice?: number;\n  hsnSac?: string;\n  hsn?: string;\n  sku?: string;\n  usageUnit?: string;\n  unit?: string;\n  intraStateTax?: string;\n  interStateTax?: string;\n  tax?: number;\n}\n\ninterface LineItem {\n  id: string;\n  itemId: string;\n  itemName: string;\n  description: string;\n  account: string;\n  quantity: number;\n  rate: number;\n  tax: string;\n  taxAmount: number;\n  amount: number;\n}\n\nconst PAYMENT_TERMS = [\n  \"Due on Receipt\",\n  \"Net 15\",\n  \"Net 30\",\n  \"Net 45\",\n  \"Net 60\",\n  \"Due end of the month\",\n  \"Due end of next month\"\n];\n\nconst SHIPMENT_PREFERENCES = [\n  \"Standard Shipping\",\n  \"Express Shipping\",\n  \"Overnight Shipping\",\n  \"Local Pickup\",\n  \"Freight Shipping\"\n];\n\nconst TAX_OPTIONS = [\n  { value: \"none\", label: \"Select a Tax\" },\n  { value: \"gst5\", label: \"GST 5%\" },\n  { value: \"gst12\", label: \"GST 12%\" },\n  { value: \"gst18\", label: \"GST 18%\" },\n  { value: \"gst28\", label: \"GST 28%\" },\n  { value: \"igst5\", label: \"IGST 5%\" },\n  { value: \"igst12\", label: \"IGST 12%\" },\n  { value: \"igst18\", label: \"IGST 18%\" },\n  { value: \"igst28\", label: \"IGST 28%\" }\n];\n\n// Account dropdown is now handled by AccountSelectDropdown component\n\nexport default function PurchaseOrderCreate() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [loading, setLoading] = useState(false);\n  const [vendors, setVendors] = useState<Vendor[]>([]);\n  const [items, setItems] = useState<Item[]>([]);\n  const [purchaseOrderNumber, setPurchaseOrderNumber] = useState(\"\");\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [uploadedFiles, setUploadedFiles] = useState<File[]>([]);\n\n  const [formData, setFormData] = useState({\n    vendorId: \"\",\n    vendorName: \"\",\n    deliveryAddressType: \"organization\",\n    deliveryAddress: {\n      attention: \"\",\n      street1: \"\",\n      street2: \"\",\n      city: \"\",\n      state: \"\",\n      pinCode: \"\",\n      countryRegion: \"India\"\n    },\n    organizationDetails: {\n      name: \"Rohan Bhosale\",\n      address: \"Hinjewadi - Wakad road\\nHinjewadi\\nPune, Maharashtra\\nIndia, 411057\"\n    },\n    selectedCustomer: null as Customer | null,\n    customerSearchQuery: \"\",\n    referenceNumber: \"\",\n    date: new Date().toISOString().split('T')[0],\n    deliveryDate: \"\",\n    paymentTerms: \"Due on Receipt\",\n    shipmentPreference: \"\",\n    reverseCharge: false,\n    notes: \"\",\n    termsAndConditions: \"\",\n    discountType: \"percent\",\n    discountValue: 0,\n    taxType: \"TDS\",\n    taxCategory: \"\",\n    adjustment: 0,\n    adjustmentDescription: \"\"\n  });\n\n  const [lineItems, setLineItems] = useState<LineItem[]>([\n    {\n      id: \"1\",\n      itemId: \"\",\n      itemName: \"\",\n      description: \"\",\n      account: \"\",\n      quantity: 1,\n      rate: 0,\n      tax: \"none\",\n      taxAmount: 0,\n      amount: 0\n    }\n  ]);\n\n  const [selectedVendor, setSelectedVendor] = useState<Vendor | null>(null);\n  const [customers, setCustomers] = useState<Customer[]>([]);\n  const [customerDropdownOpen, setCustomerDropdownOpen] = useState(false);\n  const [filteredCustomers, setFilteredCustomers] = useState<Customer[]>([]);\n  const [vendorDropdownOpen, setVendorDropdownOpen] = useState(false);\n\n  // Get vendorId from URL params\n  const urlParams = new URLSearchParams(window.location.search);\n  const vendorIdFromUrl = urlParams.get('vendorId');\n\n  useEffect(() => {\n    fetchInitialData();\n  }, []);\n\n  // Pre-fill vendor data if vendorId is in URL\n  useEffect(() => {\n    if (vendorIdFromUrl && vendors.length > 0 && !formData.vendorId) {\n      const vendor = vendors.find(v => v.id === vendorIdFromUrl);\n      if (vendor) {\n        setSelectedVendor(vendor);\n        setFormData(prev => ({\n          ...prev,\n          vendorId: vendor.id,\n          vendorName: vendor.displayName || `${vendor.firstName} ${vendor.lastName}`.trim() || vendor.companyName || \"\"\n        }));\n      }\n    }\n  }, [vendorIdFromUrl, vendors]);\n\n  const fetchInitialData = async () => {\n    try {\n      const [vendorsRes, itemsRes, nextNumberRes, customersRes] = await Promise.all([\n        fetch('/api/vendors'),\n        fetch('/api/items'),\n        fetch('/api/purchase-orders/next-number'),\n        fetch('/api/customers')\n      ]);\n\n      if (vendorsRes.ok) {\n        const data = await vendorsRes.json();\n        setVendors(data.data || []);\n      }\n\n      if (itemsRes.ok) {\n        const data = await itemsRes.json();\n        setItems(data.data || []);\n      }\n\n      if (nextNumberRes.ok) {\n        const data = await nextNumberRes.json();\n        setPurchaseOrderNumber(data.data.purchaseOrderNumber);\n      }\n\n      if (customersRes.ok) {\n        const data = await customersRes.json();\n        const customersList = data.customers || data.data || [];\n        setCustomers(customersList);\n        setFilteredCustomers(customersList);\n      }\n    } catch (error) {\n      console.error('Failed to fetch initial data:', error);\n    }\n  };\n\n  const handleVendorChange = (vendorId: string) => {\n    const vendor = vendors.find(v => v.id === vendorId);\n    if (vendor) {\n      setSelectedVendor(vendor);\n      setFormData({\n        ...formData,\n        vendorId: vendor.id,\n        vendorName: vendor.displayName\n      });\n      setVendorDropdownOpen(false);\n    }\n  };\n\n  const handleCustomerSearch = (query: string) => {\n    setFormData({ ...formData, customerSearchQuery: query });\n    if (!query.trim()) {\n      setFilteredCustomers(customers);\n    } else {\n      const filtered = customers.filter(customer =>\n        customer.name?.toLowerCase().includes(query.toLowerCase()) ||\n        customer.displayName?.toLowerCase().includes(query.toLowerCase())\n      );\n      setFilteredCustomers(filtered);\n    }\n  };\n\n  const handleCustomerSelect = (customer: Customer) => {\n    setFormData({\n      ...formData,\n      selectedCustomer: customer,\n      customerSearchQuery: customer.displayName\n    });\n    setCustomerDropdownOpen(false);\n  };\n\n  const updateLineItem = (id: string, field: keyof LineItem, value: any) => {\n    setLineItems(prev => prev.map(item => {\n      if (item.id === id) {\n        const updated = { ...item, [field]: value };\n\n        if (field === 'quantity' || field === 'rate' || field === 'tax') {\n          const baseAmount = updated.quantity * updated.rate;\n          let taxRate = 0;\n          if (updated.tax && updated.tax !== 'none') {\n            taxRate = parseInt(updated.tax.replace(/\\D/g, '')) || 0;\n          }\n          updated.taxAmount = (baseAmount * taxRate) / 100;\n          updated.amount = baseAmount + updated.taxAmount;\n        }\n\n        return updated;\n      }\n      return item;\n    }));\n  };\n\n  const addLineItem = () => {\n    setLineItems([\n      ...lineItems,\n      {\n        id: String(Date.now()),\n        itemId: \"\",\n        itemName: \"\",\n        description: \"\",\n        account: \"\",\n        quantity: 1,\n        rate: 0,\n        tax: \"none\",\n        taxAmount: 0,\n        amount: 0\n      }\n    ]);\n  };\n\n  const removeLineItem = (id: string) => {\n    if (lineItems.length > 1) {\n      setLineItems(lineItems.filter(item => item.id !== id));\n    }\n  };\n\n  const selectItem = (lineItemId: string, itemId: string) => {\n    const item = items.find(i => i.id === itemId);\n    if (item) {\n      // Parse rate - prioritize purchaseRate, then rate, then purchasePrice, then sellingPrice\n      const purchaseRate = item.purchaseRate !== undefined ? parseFloat(String(item.purchaseRate)) : 0;\n      const rate = item.rate !== undefined ? parseFloat(String(item.rate)) : 0;\n      const finalRate = purchaseRate || item.purchasePrice || rate || item.sellingPrice || 0;\n\n      // Get description - prioritize purchaseDescription for purchase orders\n      const description = item.purchaseDescription || item.description || '';\n\n      // Get tax rate from item\n      let taxValue = 'none';\n      if (item.intraStateTax) {\n        // Convert tax string like 'gst18' to proper format\n        const taxMatch = item.intraStateTax.match(/(gst|igst)(\\d+)/i);\n        if (taxMatch) {\n          taxValue = `gst_${taxMatch[2]}`;\n        }\n      }\n\n      setLineItems(prev => prev.map(lineItem => {\n        if (lineItem.id === lineItemId) {\n          const baseAmount = lineItem.quantity * finalRate;\n          let taxRate = 0;\n          if (taxValue && taxValue !== 'none') {\n            taxRate = parseInt(taxValue.replace(/\\D/g, '')) || 0;\n          }\n          const taxAmount = (baseAmount * taxRate) / 100;\n          return {\n            ...lineItem,\n            itemId: item.id,\n            itemName: item.name,\n            description: description,\n            rate: finalRate,\n            tax: taxValue,\n            taxAmount: taxAmount,\n            amount: baseAmount + taxAmount\n          };\n        }\n        return lineItem;\n      }));\n    }\n  };\n\n  const calculateSubTotal = (): number => {\n    return lineItems.reduce((sum, item) => sum + (item.quantity * item.rate), 0);\n  };\n\n  const calculateDiscount = (): number => {\n    const subTotal = calculateSubTotal();\n    if (formData.discountType === 'percent') {\n      return (subTotal * formData.discountValue) / 100;\n    }\n    return formData.discountValue;\n  };\n\n  const calculateTaxTotal = (): number => {\n    return lineItems.reduce((sum, item) => sum + item.taxAmount, 0);\n  };\n\n  const calculateTotal = (): number => {\n    const subTotal = calculateSubTotal();\n    const discount = calculateDiscount();\n    const taxTotal = calculateTaxTotal();\n    return subTotal - discount + taxTotal + formData.adjustment;\n  };\n\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(e.target.files || []);\n    if (uploadedFiles.length + files.length > 10) {\n      toast({ title: \"Maximum 10 files allowed\", variant: \"destructive\" });\n      return;\n    }\n    const validFiles = files.filter(f => f.size <= 10 * 1024 * 1024);\n    setUploadedFiles([...uploadedFiles, ...validFiles]);\n  };\n\n  const handleSubmit = async (saveAsDraft: boolean = false) => {\n    if (!formData.vendorId) {\n      toast({ title: \"Please select a vendor\", variant: \"destructive\" });\n      return;\n    }\n\n    const validItems = lineItems.filter(item => item.itemName && item.quantity > 0);\n    if (validItems.length === 0) {\n      toast({ title: \"Please add at least one item\", variant: \"destructive\" });\n      return;\n    }\n\n    setLoading(true);\n\n    try {\n      const response = await fetch('/api/purchase-orders', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          ...formData,\n          purchaseOrderNumber,\n          items: validItems,\n          subTotal: calculateSubTotal(),\n          discountAmount: calculateDiscount(),\n          taxAmount: calculateTaxTotal(),\n          total: calculateTotal(),\n          status: saveAsDraft ? 'DRAFT' : 'ISSUED'\n        })\n      });\n\n      if (response.ok) {\n        toast({ title: saveAsDraft ? \"Draft saved successfully\" : \"Purchase order created successfully\" });\n        setLocation('/purchase-orders');\n      } else {\n        toast({ title: \"Failed to create purchase order\", variant: \"destructive\" });\n      }\n    } catch (error) {\n      toast({ title: \"Failed to create purchase order\", variant: \"destructive\" });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 bg-black/20\">\n      <div className=\"fixed inset-y-0 left-0 right-0 bg-slate-50 shadow-xl overflow-hidden flex flex-col animate-in slide-in-from-right duration-300\" style={{ marginLeft: 'calc(100vw - 80vw)' }}>\n        {/* Header */}\n        <div className=\"flex items-center justify-between px-6 py-4 bg-white border-b border-slate-200\">\n          <h1 className=\"text-xl font-semibold text-slate-900 flex items-center gap-2\">\n            <span className=\"text-slate-400\">\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n              </svg>\n            </span>\n            New Purchase Order\n          </h1>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setLocation('/purchase-orders')}\n            className=\"h-8 w-8\"\n            data-testid=\"button-close\"\n          >\n            <X className=\"h-5 w-5\" />\n          </Button>\n        </div>\n\n        {/* Scrollable Content */}\n        <div className=\"flex-1 overflow-y-auto\">\n          <div className=\"p-6 space-y-6\">\n            {/* Vendor Section */}\n            <div className=\"grid grid-cols-[140px_1fr] gap-4 items-start\">\n              <Label className=\"text-blue-600 pt-2.5\">Vendor Name<span className=\"text-red-500\">*</span></Label>\n              <div className=\"flex gap-2\">\n                <Popover open={vendorDropdownOpen} onOpenChange={setVendorDropdownOpen}>\n                  <PopoverTrigger asChild>\n                    <Button\n                      variant=\"outline\"\n                      role=\"combobox\"\n                      className=\"flex-1 justify-between bg-white\"\n                      data-testid=\"select-vendor\"\n                    >\n                      {selectedVendor ? selectedVendor.displayName : \"Select a Vendor\"}\n                      <ChevronDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-[400px] p-0\" align=\"start\">\n                    <Command>\n                      <CommandInput placeholder=\"Search vendors...\" />\n                      <CommandEmpty>No vendor found.</CommandEmpty>\n                      <CommandGroup className=\"max-h-[200px] overflow-y-auto\">\n                        {vendors.map(vendor => (\n                          <CommandItem\n                            key={vendor.id}\n                            onSelect={() => handleVendorChange(vendor.id)}\n                          >\n                            {vendor.displayName}\n                          </CommandItem>\n                        ))}\n                      </CommandGroup>\n                    </Command>\n                  </PopoverContent>\n                </Popover>\n                <Button\n                  variant=\"outline\"\n                  size=\"icon\"\n                  className=\"bg-blue-600 text-white hover:bg-blue-700\"\n                  onClick={() => setLocation('/vendors/new')}\n                  data-testid=\"button-add-vendor\"\n                >\n                  <Search className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n\n            {/* Delivery Address Section */}\n            <div className=\"grid grid-cols-[140px_1fr] gap-4 items-start\">\n              <Label className=\"text-blue-600 pt-2.5\">Delivery Address<span className=\"text-red-500\">*</span></Label>\n              <div className=\"space-y-3\">\n                <RadioGroup\n                  value={formData.deliveryAddressType}\n                  onValueChange={(value) => setFormData({ ...formData, deliveryAddressType: value, selectedCustomer: null, customerSearchQuery: \"\" })}\n                  className=\"flex gap-6\"\n                >\n                  <div className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value=\"organization\" id=\"org\" className=\"border-blue-600 text-blue-600\" />\n                    <Label htmlFor=\"org\" className=\"cursor-pointer\">Organization</Label>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value=\"customer\" id=\"customer\" className=\"border-blue-600 text-blue-600\" />\n                    <Label htmlFor=\"customer\" className=\"cursor-pointer\">Customer</Label>\n                  </div>\n                </RadioGroup>\n\n                {formData.deliveryAddressType === \"organization\" && (\n                  <div className=\"bg-white border border-slate-200 rounded-lg p-4 space-y-3\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"orgName\" className=\"text-sm font-medium\">Organization Name</Label>\n                      <Input\n                        id=\"orgName\"\n                        value={formData.organizationDetails.name}\n                        onChange={(e) => setFormData({\n                          ...formData,\n                          organizationDetails: {\n                            ...formData.organizationDetails,\n                            name: e.target.value\n                          }\n                        })}\n                        placeholder=\"Enter organization name\"\n                        className=\"bg-white\"\n                        data-testid=\"input-org-name\"\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"orgAddress\" className=\"text-sm font-medium\">Organization Address</Label>\n                      <Textarea\n                        id=\"orgAddress\"\n                        value={formData.organizationDetails.address}\n                        onChange={(e) => setFormData({\n                          ...formData,\n                          organizationDetails: {\n                            ...formData.organizationDetails,\n                            address: e.target.value\n                          }\n                        })}\n                        placeholder=\"Enter complete address\"\n                        className=\"bg-white min-h-[80px]\"\n                        rows={4}\n                        data-testid=\"input-org-address\"\n                      />\n                    </div>\n                  </div>\n                )}\n\n                {formData.deliveryAddressType === \"customer\" && (\n                  <div className=\"space-y-3\">\n                    <Popover open={customerDropdownOpen} onOpenChange={setCustomerDropdownOpen}>\n                      <PopoverTrigger asChild>\n                        <Button\n                          variant=\"outline\"\n                          role=\"combobox\"\n                          className=\"w-full justify-between bg-white\"\n                        >\n                          {formData.selectedCustomer ? formData.selectedCustomer.displayName : \"Select a Customer\"}\n                          <ChevronDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                        </Button>\n                      </PopoverTrigger>\n                      <PopoverContent className=\"w-[400px] p-0\" align=\"start\">\n                        <Command>\n                          <CommandInput\n                            placeholder=\"Search customers...\"\n                            value={formData.customerSearchQuery}\n                            onValueChange={handleCustomerSearch}\n                          />\n                          <div className=\"p-2 border-b\">\n                            <Button\n                              size=\"sm\"\n                              className=\"w-full bg-blue-600 hover:bg-blue-700\"\n                              onClick={() => {\n                                setCustomerDropdownOpen(false);\n                                setLocation('/customers/new');\n                              }}\n                            >\n                              <Plus className=\"h-4 w-4 mr-2\" />\n                              Create Customer\n                            </Button>\n                          </div>\n                          <CommandEmpty>No customers found.</CommandEmpty>\n                          <CommandGroup className=\"max-h-[200px] overflow-y-auto\">\n                            {filteredCustomers.map((customer) => (\n                              <CommandItem\n                                key={customer.id}\n                                onSelect={() => handleCustomerSelect(customer)}\n                              >\n                                <div className=\"flex flex-col\">\n                                  <span className=\"font-medium\">{customer.displayName || customer.name}</span>\n                                  {customer.email && <span className=\"text-sm text-slate-500\">{customer.email}</span>}\n                                </div>\n                              </CommandItem>\n                            ))}\n                          </CommandGroup>\n                        </Command>\n                      </PopoverContent>\n                    </Popover>\n\n                    {formData.selectedCustomer && (\n                      <div className=\"bg-white border border-slate-200 rounded-lg p-4 text-sm text-slate-600\">\n                        <div className=\"font-medium text-slate-900 mb-1\">{formData.selectedCustomer.displayName}</div>\n                        {formData.selectedCustomer.billingAddress && (\n                          <div className=\"whitespace-pre-line\">\n                            {[\n                              formData.selectedCustomer.billingAddress.street,\n                              formData.selectedCustomer.billingAddress.city,\n                              formData.selectedCustomer.billingAddress.state,\n                              formData.selectedCustomer.billingAddress.country,\n                              formData.selectedCustomer.billingAddress.pincode\n                            ].filter(Boolean).join('\\n')}\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Form Fields Row */}\n            <div className=\"grid grid-cols-3 gap-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"text-blue-600 font-medium text-sm\">Purchase Order#<span className=\"text-red-500\">*</span></Label>\n                <div className=\"relative\">\n                  <Input\n                    value={purchaseOrderNumber}\n                    readOnly\n                    className=\"bg-white pr-8 text-sm\"\n                    data-testid=\"input-po-number\"\n                  />\n                  <button className=\"absolute right-2 top-1/2 -translate-y-1/2\">\n                    <svg className=\"w-4 h-4 text-blue-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <circle cx=\"12\" cy=\"12\" r=\"10\" strokeWidth={2} />\n                      <path strokeLinecap=\"round\" strokeWidth={2} d=\"M12 6v6l4 2\" />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <Label className=\"font-medium text-sm\">Reference#</Label>\n                <Input\n                  value={formData.referenceNumber}\n                  onChange={(e) => setFormData({ ...formData, referenceNumber: e.target.value })}\n                  className=\"bg-white text-sm\"\n                  data-testid=\"input-reference\"\n                />\n              </div>\n              <div></div>\n            </div>\n\n            <div className=\"grid grid-cols-3 gap-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"font-medium text-sm\">Date</Label>\n                <Input\n                  type=\"date\"\n                  value={formData.date}\n                  onChange={(e) => setFormData({ ...formData, date: e.target.value })}\n                  className=\"bg-white text-sm\"\n                  data-testid=\"input-date\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label className=\"font-medium text-sm\">Delivery Date</Label>\n                <Input\n                  type=\"date\"\n                  value={formData.deliveryDate}\n                  onChange={(e) => setFormData({ ...formData, deliveryDate: e.target.value })}\n                  className=\"bg-white text-sm\"\n                  placeholder=\"dd/MM/yyyy\"\n                  data-testid=\"input-delivery-date\"\n                />\n              </div>\n              <div></div>\n            </div>\n\n            <div className=\"grid grid-cols-3 gap-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"font-medium text-sm\">Payment Terms</Label>\n                <Select\n                  value={formData.paymentTerms}\n                  onValueChange={(value) => setFormData({ ...formData, paymentTerms: value })}\n                >\n                  <SelectTrigger className=\"bg-white text-sm\" data-testid=\"select-payment-terms\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {PAYMENT_TERMS.map(term => (\n                      <SelectItem key={term} value={term}>{term}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"space-y-2\">\n                <Label className=\"font-medium text-sm\">Shipment Preference</Label>\n                <Select\n                  value={formData.shipmentPreference}\n                  onValueChange={(value) => setFormData({ ...formData, shipmentPreference: value })}\n                >\n                  <SelectTrigger className=\"bg-white text-sm\" data-testid=\"select-shipment\">\n                    <SelectValue placeholder=\"Choose the shipment preference...\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {SHIPMENT_PREFERENCES.map(pref => (\n                      <SelectItem key={pref} value={pref}>{pref}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div></div>\n            </div>\n\n            {/* TDS/TCS and Reverse Charge Section */}\n            <div className=\"space-y-4 p-4 bg-slate-50 border border-slate-200 rounded-lg\">\n              <div className=\"flex items-center gap-6\">\n                <RadioGroup value={formData.taxType} onValueChange={(value) => setFormData({ ...formData, taxType: value })} className=\"flex gap-6\">\n                  <div className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value=\"TDS\" id=\"tds\" className=\"border-blue-600 text-blue-600\" />\n                    <Label htmlFor=\"tds\" className=\"cursor-pointer font-medium text-sm\">TDS</Label>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value=\"TCS\" id=\"tcs\" className=\"border-blue-600 text-blue-600\" />\n                    <Label htmlFor=\"tcs\" className=\"cursor-pointer font-medium text-sm\">TCS</Label>\n                  </div>\n                </RadioGroup>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Checkbox\n                  id=\"reverseCharge\"\n                  checked={formData.reverseCharge}\n                  onCheckedChange={(checked) => setFormData({ ...formData, reverseCharge: checked as boolean })}\n                />\n                <Label htmlFor=\"reverseCharge\" className=\"text-sm cursor-pointer\">\n                  This transaction is applicable for reverse charge\n                </Label>\n              </div>\n            </div>\n\n            {/* Item Table Section */}\n            <div className=\"bg-white border border-slate-200 rounded-lg overflow-hidden\">\n              {/* Table Header Controls */}\n              <div className=\"flex items-center justify-between p-4 border-b border-slate-200\">\n                <div className=\"flex items-center gap-4\">\n                  <RadioGroup defaultValue=\"item\" className=\"flex gap-4\">\n                    <div className=\"flex items-center space-x-2\">\n                      <RadioGroupItem value=\"item\" id=\"item-level\" className=\"border-blue-600 text-blue-600\" />\n                      <Label htmlFor=\"item-level\" className=\"cursor-pointer text-sm\">At Transaction Level</Label>\n                    </div>\n                  </RadioGroup>\n                </div>\n              </div>\n\n              {/* Item Table */}\n              <div className=\"p-4\">\n                <div className=\"flex items-center justify-between mb-3\">\n                  <h3 className=\"font-semibold text-slate-800\">Item Table</h3>\n                  <Button variant=\"link\" className=\"text-blue-600 text-sm p-0 h-auto\">\n                    Bulk Actions\n                  </Button>\n                </div>\n\n                <div className=\"border border-slate-200 rounded-lg overflow-hidden\">\n                  {/* Table Header */}\n                  <div className=\"grid grid-cols-[40px_1fr_140px_80px_80px_120px_100px_40px] bg-blue-600 text-white text-sm font-medium\">\n                    <div className=\"p-2 text-center\">#</div>\n                    <div className=\"p-2\">ITEM DETAILS</div>\n                    <div className=\"p-2\">ACCOUNT</div>\n                    <div className=\"p-2 text-center\">QUANTITY</div>\n                    <div className=\"p-2 text-right\">RATE</div>\n                    <div className=\"p-2\">TAX</div>\n                    <div className=\"p-2 text-right\">AMOUNT</div>\n                    <div className=\"p-2\"></div>\n                  </div>\n\n                  {/* Table Rows */}\n                  {lineItems.map((item, index) => (\n                    <div key={item.id} className=\"grid grid-cols-[40px_1fr_140px_80px_80px_120px_100px_40px] border-t border-slate-200 items-center\">\n                      <div className=\"p-2 text-center text-slate-500\">{index + 1}</div>\n                      <div className=\"p-2\">\n                        <Select\n                          value={item.itemId}\n                          onValueChange={(value) => selectItem(item.id, value)}\n                        >\n                          <SelectTrigger className=\"border-0 shadow-none h-8 text-sm\" data-testid={`select-item-${index}`}>\n                            <SelectValue placeholder=\"Type or click to select an item.\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {items.map(i => (\n                              <SelectItem key={i.id} value={i.id}>\n                                {i.name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div className=\"p-2\">\n                        <AccountSelectDropdown\n                          value={item.account}\n                          onValueChange={(value) => updateLineItem(item.id, 'account', value)}\n                          placeholder=\"Select an account\"\n                          triggerClassName=\"border-0 shadow-none h-8 text-sm\"\n                          testId={`select-account-${index}`}\n                        />\n                      </div>\n                      <div className=\"p-2\">\n                        <Input\n                          type=\"number\"\n                          value={item.quantity}\n                          onChange={(e) => updateLineItem(item.id, 'quantity', parseFloat(e.target.value) || 0)}\n                          className=\"text-center h-8 text-sm\"\n                          data-testid={`input-quantity-${index}`}\n                        />\n                      </div>\n                      <div className=\"p-2\">\n                        <Input\n                          type=\"number\"\n                          value={item.rate}\n                          onChange={(e) => updateLineItem(item.id, 'rate', parseFloat(e.target.value) || 0)}\n                          className=\"text-right h-8 text-sm\"\n                          data-testid={`input-rate-${index}`}\n                        />\n                      </div>\n                      <div className=\"p-2\">\n                        <Select\n                          value={item.tax}\n                          onValueChange={(value) => updateLineItem(item.id, 'tax', value)}\n                        >\n                          <SelectTrigger className=\"border-0 shadow-none h-8 text-sm\" data-testid={`select-tax-${index}`}>\n                            <SelectValue placeholder=\"Select a Tax\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {TAX_OPTIONS.map(tax => (\n                              <SelectItem key={tax.value} value={tax.value}>{tax.label}</SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div className=\"p-2 text-right font-medium text-sm\">\n                        {item.amount.toFixed(2)}\n                      </div>\n                      <div className=\"p-2\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"text-red-500 h-6 w-6\"\n                          onClick={() => removeLineItem(item.id)}\n                          data-testid={`button-remove-item-${index}`}\n                        >\n                          <X className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n\n                {/* Add Row Buttons */}\n                <div className=\"flex gap-2 mt-3\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"text-blue-600 border-blue-600\"\n                    onClick={addLineItem}\n                    data-testid=\"button-add-row\"\n                  >\n                    <Plus className=\"h-4 w-4 mr-1\" /> Add New Row\n                  </Button>\n                  <Button variant=\"outline\" size=\"sm\" className=\"text-blue-600 border-blue-600\">\n                    <Plus className=\"h-4 w-4 mr-1\" /> Add Items in Bulk\n                  </Button>\n                </div>\n              </div>\n\n              {/* Summary Section */}\n              <div className=\"grid grid-cols-2 gap-8 p-4 border-t border-slate-200\">\n                <div></div>\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-slate-600\">Sub Total</span>\n                    <span className=\"font-medium\">{calculateSubTotal().toFixed(2)}</span>\n                  </div>\n\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-slate-600 w-24\">Discount</span>\n                    <Input\n                      type=\"number\"\n                      value={formData.discountValue}\n                      onChange={(e) => setFormData({ ...formData, discountValue: parseFloat(e.target.value) || 0 })}\n                      className=\"w-16 text-center h-8 text-sm\"\n                      data-testid=\"input-discount\"\n                    />\n                    <Select\n                      value={formData.discountType}\n                      onValueChange={(value) => setFormData({ ...formData, discountType: value })}\n                    >\n                      <SelectTrigger className=\"w-14 h-8\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"percent\">%</SelectItem>\n                        <SelectItem value=\"flat\">Rs.</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <span className=\"ml-auto text-red-500\">-{calculateDiscount().toFixed(2)}</span>\n                  </div>\n\n                  <div className=\"flex items-center gap-3\">\n                    <RadioGroup\n                      value={formData.taxType}\n                      onValueChange={(value) => setFormData({ ...formData, taxType: value })}\n                      className=\"flex gap-3\"\n                    >\n                      <div className=\"flex items-center space-x-1\">\n                        <RadioGroupItem value=\"TDS\" id=\"tds\" className=\"h-3.5 w-3.5\" />\n                        <Label htmlFor=\"tds\" className=\"text-sm\">TDS</Label>\n                      </div>\n                      <div className=\"flex items-center space-x-1\">\n                        <RadioGroupItem value=\"TCS\" id=\"tcs\" className=\"h-3.5 w-3.5\" />\n                        <Label htmlFor=\"tcs\" className=\"text-sm\">TCS</Label>\n                      </div>\n                    </RadioGroup>\n                    <Select\n                      value={formData.taxCategory}\n                      onValueChange={(value) => setFormData({ ...formData, taxCategory: value })}\n                    >\n                      <SelectTrigger className=\"flex-1 h-8\">\n                        <SelectValue placeholder=\"Select a Tax\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"none\">No Tax</SelectItem>\n                        <SelectItem value=\"tds194c\">194C - 1%</SelectItem>\n                        <SelectItem value=\"tds194j\">194J - 10%</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <span className=\"text-red-500\">-0.00</span>\n                  </div>\n\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-slate-600 w-24\">Adjustment</span>\n                    <Input\n                      type=\"number\"\n                      value={formData.adjustment}\n                      onChange={(e) => setFormData({ ...formData, adjustment: parseFloat(e.target.value) || 0 })}\n                      className=\"w-20 text-right h-8 text-sm\"\n                      data-testid=\"input-adjustment\"\n                    />\n                    <Tooltip>\n                      <TooltipTrigger>\n                        <HelpCircle className=\"h-4 w-4 text-slate-400\" />\n                      </TooltipTrigger>\n                      <TooltipContent>\n                        <p>Add any adjustments to the total</p>\n                      </TooltipContent>\n                    </Tooltip>\n                    <span className=\"ml-auto\">{formData.adjustment.toFixed(2)}</span>\n                  </div>\n\n                  <div className=\"flex items-center justify-between pt-3 border-t border-slate-200\">\n                    <span className=\"font-semibold text-lg\">Total</span>\n                    <span className=\"font-semibold text-lg\">{calculateTotal().toFixed(2)}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Notes Section */}\n            <div className=\"grid grid-cols-[140px_1fr] gap-4 items-start\">\n              <Label>Notes</Label>\n              <Textarea\n                placeholder=\"Will be displayed on purchase order\"\n                value={formData.notes}\n                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                className=\"bg-white min-h-[80px]\"\n                data-testid=\"input-notes\"\n              />\n            </div>\n\n            {/* Terms & Conditions and File Upload */}\n            <div className=\"grid grid-cols-2 gap-6\">\n              <div className=\"space-y-2\">\n                <Label className=\"font-semibold\">Terms & Conditions</Label>\n                <Textarea\n                  placeholder=\"Enter the terms and conditions of your business to be displayed in your transaction\"\n                  value={formData.termsAndConditions}\n                  onChange={(e) => setFormData({ ...formData, termsAndConditions: e.target.value })}\n                  className=\"bg-white min-h-[100px]\"\n                  data-testid=\"input-terms\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label className=\"font-semibold\">Attach File(s) to Purchase Order</Label>\n                <div className=\"bg-white border border-slate-200 rounded-lg p-4 text-center\">\n                  <input\n                    type=\"file\"\n                    ref={fileInputRef}\n                    onChange={handleFileUpload}\n                    multiple\n                    className=\"hidden\"\n                  />\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"gap-2\"\n                    onClick={() => fileInputRef.current?.click()}\n                  >\n                    <Upload className=\"h-4 w-4\" /> Upload File\n                  </Button>\n                  <p className=\"text-xs text-slate-500 mt-2\">\n                    You can upload a maximum of 10 files, 10MB each\n                  </p>\n                  {uploadedFiles.length > 0 && (\n                    <div className=\"mt-2 text-sm text-slate-600\">\n                      {uploadedFiles.length} file(s) selected\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n\n            {/* Additional Fields Info */}\n            <div className=\"text-sm text-slate-500\">\n              <span className=\"font-medium text-blue-600\">Additional Fields:</span> Start adding custom fields for your purchase orders by going to Settings - Purchases - Purchase Orders.\n            </div>\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"flex items-center justify-between px-6 py-4 bg-white border-t border-slate-200\">\n          <div className=\"flex items-center gap-3\">\n            <Button\n              variant=\"outline\"\n              onClick={() => handleSubmit(true)}\n              disabled={loading}\n              data-testid=\"button-save-draft\"\n            >\n              Save as Draft\n            </Button>\n            <Button\n              onClick={() => handleSubmit(false)}\n              disabled={loading}\n              className=\"bg-blue-600 hover:bg-blue-700\"\n              data-testid=\"button-save-send\"\n            >\n              {loading ? \"Saving...\" : \"Save and Send\"}\n            </Button>\n            <Button\n              variant=\"ghost\"\n              onClick={() => setLocation('/purchase-orders')}\n              data-testid=\"button-cancel\"\n            >\n              Cancel\n            </Button>\n          </div>\n          <div className=\"text-sm text-slate-500\">\n            PDF Template: <span className=\"text-blue-600 cursor-pointer\">Standard Template</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":44265,"size_tokens":null},"client/src/pages/purchase-order-edit.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useLocation, useParams } from \"wouter\";\nimport { Plus, X, Search, Upload, ChevronDown, HelpCircle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { AccountSelectDropdown } from \"@/components/AccountSelectDropdown\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n} from \"@/components/ui/command\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\n\ninterface Customer {\n  id: string;\n  name: string;\n  displayName: string;\n  email?: string;\n  phone?: string;\n  billingAddress?: {\n    street?: string;\n    city?: string;\n    state?: string;\n    country?: string;\n    pincode?: string;\n  };\n  shippingAddress?: {\n    street?: string;\n    city?: string;\n    state?: string;\n    country?: string;\n    pincode?: string;\n  };\n}\n\ninterface Vendor {\n  id: string;\n  displayName: string;\n  companyName?: string;\n  billingAddress?: {\n    street1?: string;\n    street2?: string;\n    city?: string;\n    state?: string;\n    pinCode?: string;\n    countryRegion?: string;\n  };\n}\n\ninterface Item {\n  id: string;\n  name: string;\n  description?: string;\n  sellingPrice?: number;\n  purchasePrice?: number;\n}\n\ninterface LineItem {\n  id: string;\n  itemId: string;\n  itemName: string;\n  description: string;\n  account: string;\n  quantity: number;\n  rate: number;\n  tax: string;\n  taxAmount: number;\n  amount: number;\n}\n\nconst PAYMENT_TERMS = [\n  \"Due on Receipt\",\n  \"Net 15\",\n  \"Net 30\",\n  \"Net 45\",\n  \"Net 60\",\n  \"Due end of the month\",\n  \"Due end of next month\"\n];\n\nconst SHIPMENT_PREFERENCES = [\n  \"Standard Shipping\",\n  \"Express Shipping\",\n  \"Overnight Shipping\",\n  \"Local Pickup\",\n  \"Freight Shipping\"\n];\n\nconst TAX_OPTIONS = [\n  { value: \"none\", label: \"Select a Tax\" },\n  { value: \"gst5\", label: \"GST 5%\" },\n  { value: \"gst12\", label: \"GST 12%\" },\n  { value: \"gst18\", label: \"GST 18%\" },\n  { value: \"gst28\", label: \"GST 28%\" },\n  { value: \"igst5\", label: \"IGST 5%\" },\n  { value: \"igst12\", label: \"IGST 12%\" },\n  { value: \"igst18\", label: \"IGST 18%\" },\n  { value: \"igst28\", label: \"IGST 28%\" }\n];\n\n// Account dropdown is now handled by AccountSelectDropdown component\n\nconst INDIAN_STATES = [\n  \"AN - Andaman and Nicobar Islands\",\n  \"AP - Andhra Pradesh\",\n  \"AR - Arunachal Pradesh\",\n  \"AS - Assam\",\n  \"BR - Bihar\",\n  \"CH - Chandigarh\",\n  \"CT - Chhattisgarh\",\n  \"DD - Daman and Diu\",\n  \"DL - Delhi\",\n  \"GA - Goa\",\n  \"GJ - Gujarat\",\n  \"HP - Himachal Pradesh\",\n  \"HR - Haryana\",\n  \"JH - Jharkhand\",\n  \"JK - Jammu and Kashmir\",\n  \"KA - Karnataka\",\n  \"KL - Kerala\",\n  \"LA - Ladakh\",\n  \"LD - Lakshadweep\",\n  \"MH - Maharashtra\",\n  \"ML - Meghalaya\",\n  \"MN - Manipur\",\n  \"MP - Madhya Pradesh\",\n  \"MZ - Mizoram\",\n  \"NL - Nagaland\",\n  \"OR - Odisha\",\n  \"PB - Punjab\",\n  \"PY - Puducherry\",\n  \"RJ - Rajasthan\",\n  \"SK - Sikkim\",\n  \"TN - Tamil Nadu\",\n  \"TR - Tripura\",\n  \"TS - Telangana\",\n  \"UK - Uttarakhand\",\n  \"UP - Uttar Pradesh\",\n  \"WB - West Bengal\"\n];\n\nconst GST_TREATMENTS = [\n  \"Registered Business - Regular\",\n  \"Registered Business - Composition\",\n  \"Unregistered Business\",\n  \"Consumer\",\n  \"Overseas\",\n  \"Special Economic Zone\",\n  \"Deemed Export\"\n];\n\nexport default function PurchaseOrderEdit() {\n  const [, setLocation] = useLocation();\n  const params = useParams();\n  const { toast } = useToast();\n  const [loading, setLoading] = useState(false);\n  const [loadingData, setLoadingData] = useState(true);\n  const [vendors, setVendors] = useState<Vendor[]>([]);\n  const [items, setItems] = useState<Item[]>([]);\n  const [purchaseOrderNumber, setPurchaseOrderNumber] = useState(\"\");\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [uploadedFiles, setUploadedFiles] = useState<File[]>([]);\n\n  const [formData, setFormData] = useState({\n    vendorId: \"\",\n    vendorName: \"\",\n    gstTreatment: \"Unregistered Business\",\n    sourceOfSupply: \"MH - Maharashtra\",\n    destinationOfSupply: \"MH - Maharashtra\",\n    deliveryAddressType: \"organization\",\n    deliveryAddress: {\n      attention: \"\",\n      street1: \"\",\n      street2: \"\",\n      city: \"\",\n      state: \"\",\n      pinCode: \"\",\n      countryRegion: \"India\"\n    },\n    organizationDetails: {\n      name: \"Ganesh Kale\",\n      address: \"Hinjewadi - Wakad road\\nHinjewadi\\nPune, Maharashtra\\nIndia, 411057\"\n    },\n    selectedCustomer: null as Customer | null,\n    customerSearchQuery: \"\",\n    referenceNumber: \"\",\n    date: new Date().toISOString().split('T')[0],\n    deliveryDate: \"\",\n    paymentTerms: \"Due on Receipt\",\n    shipmentPreference: \"\",\n    reverseCharge: false,\n    notes: \"\",\n    termsAndConditions: \"\",\n    discountType: \"percent\",\n    discountValue: 0,\n    taxType: \"TDS\",\n    taxCategory: \"\",\n    adjustment: 0,\n    adjustmentDescription: \"\",\n    emailCommunications: [] as string[]\n  });\n\n  const [lineItems, setLineItems] = useState<LineItem[]>([]);\n  const [selectedVendor, setSelectedVendor] = useState<Vendor | null>(null);\n  const [customers, setCustomers] = useState<Customer[]>([]);\n  const [customerDropdownOpen, setCustomerDropdownOpen] = useState(false);\n  const [filteredCustomers, setFilteredCustomers] = useState<Customer[]>([]);\n  const [vendorDropdownOpen, setVendorDropdownOpen] = useState(false);\n\n  useEffect(() => {\n    fetchInitialData();\n  }, [params.id]);\n\n  const fetchInitialData = async () => {\n    try {\n      const [vendorsRes, itemsRes, poRes, customersRes] = await Promise.all([\n        fetch('/api/vendors'),\n        fetch('/api/items'),\n        fetch(`/api/purchase-orders/${params.id}`),\n        fetch('/api/customers')\n      ]);\n\n      let vendorsList: Vendor[] = [];\n      if (vendorsRes.ok) {\n        const data = await vendorsRes.json();\n        vendorsList = data.data || [];\n        setVendors(vendorsList);\n      }\n\n      if (itemsRes.ok) {\n        const data = await itemsRes.json();\n        setItems(data.data || []);\n      }\n\n      if (customersRes.ok) {\n        const data = await customersRes.json();\n        const customersList = data.customers || data.data || [];\n        setCustomers(customersList);\n        setFilteredCustomers(customersList);\n      }\n\n      if (poRes.ok) {\n        const data = await poRes.json();\n        const po = data.data;\n\n        setPurchaseOrderNumber(po.purchaseOrderNumber);\n        setFormData({\n          vendorId: po.vendorId || \"\",\n          vendorName: po.vendorName || \"\",\n          gstTreatment: po.gstTreatment || \"Unregistered Business\",\n          sourceOfSupply: po.sourceOfSupply || \"MH - Maharashtra\",\n          destinationOfSupply: po.destinationOfSupply || \"MH - Maharashtra\",\n          deliveryAddressType: po.deliveryAddressType || \"organization\",\n          deliveryAddress: po.deliveryAddress || {},\n          organizationDetails: po.organizationDetails || {\n            name: \"Ganesh Kale\",\n            address: \"Hinjewadi - Wakad road\\nHinjewadi\\nPune, Maharashtra\\nIndia, 411057\"\n          },\n          selectedCustomer: null,\n          customerSearchQuery: \"\",\n          referenceNumber: po.referenceNumber || \"\",\n          date: po.date || new Date().toISOString().split('T')[0],\n          deliveryDate: po.deliveryDate || \"\",\n          paymentTerms: po.paymentTerms || \"Due on Receipt\",\n          shipmentPreference: po.shipmentPreference || \"\",\n          reverseCharge: po.reverseCharge || false,\n          notes: po.notes || \"\",\n          termsAndConditions: po.termsAndConditions || \"\",\n          discountType: po.discountType || \"percent\",\n          discountValue: po.discountValue || 0,\n          taxType: po.taxType || \"TDS\",\n          taxCategory: po.taxCategory || \"\",\n          adjustment: po.adjustment || 0,\n          adjustmentDescription: po.adjustmentDescription || \"\",\n          emailCommunications: po.emailCommunications || []\n        });\n\n        setLineItems(po.items?.length > 0 ? po.items : [{\n          id: \"1\",\n          itemId: \"\",\n          itemName: \"\",\n          description: \"\",\n          account: \"\",\n          quantity: 1,\n          rate: 0,\n          tax: \"none\",\n          taxAmount: 0,\n          amount: 0\n        }]);\n\n        const vendor = vendorsList.find((v: Vendor) => v.id === po.vendorId);\n        if (vendor) setSelectedVendor(vendor);\n      }\n    } catch (error) {\n      console.error('Failed to fetch data:', error);\n      toast({ title: \"Failed to load purchase order\", variant: \"destructive\" });\n    } finally {\n      setLoadingData(false);\n    }\n  };\n\n  const handleVendorChange = (vendorId: string) => {\n    const vendor = vendors.find(v => v.id === vendorId);\n    if (vendor) {\n      setSelectedVendor(vendor);\n      setFormData({\n        ...formData,\n        vendorId: vendor.id,\n        vendorName: vendor.displayName\n      });\n      setVendorDropdownOpen(false);\n    }\n  };\n\n  const handleCustomerSearch = (query: string) => {\n    setFormData({ ...formData, customerSearchQuery: query });\n    if (!query.trim()) {\n      setFilteredCustomers(customers);\n    } else {\n      const filtered = customers.filter(customer =>\n        customer.name?.toLowerCase().includes(query.toLowerCase()) ||\n        customer.displayName?.toLowerCase().includes(query.toLowerCase())\n      );\n      setFilteredCustomers(filtered);\n    }\n  };\n\n  const handleCustomerSelect = (customer: Customer) => {\n    setFormData({\n      ...formData,\n      selectedCustomer: customer,\n      customerSearchQuery: customer.displayName\n    });\n    setCustomerDropdownOpen(false);\n  };\n\n  const updateLineItem = (id: string, field: keyof LineItem, value: any) => {\n    setLineItems(prev => prev.map(item => {\n      if (item.id === id) {\n        const updated = { ...item, [field]: value };\n\n        if (field === 'quantity' || field === 'rate' || field === 'tax') {\n          const baseAmount = updated.quantity * updated.rate;\n          let taxRate = 0;\n          if (updated.tax && updated.tax !== 'none') {\n            taxRate = parseInt(updated.tax.replace(/\\D/g, '')) || 0;\n          }\n          updated.taxAmount = (baseAmount * taxRate) / 100;\n          updated.amount = baseAmount + updated.taxAmount;\n        }\n\n        return updated;\n      }\n      return item;\n    }));\n  };\n\n  const addLineItem = () => {\n    setLineItems([\n      ...lineItems,\n      {\n        id: String(Date.now()),\n        itemId: \"\",\n        itemName: \"\",\n        description: \"\",\n        account: \"\",\n        quantity: 1,\n        rate: 0,\n        tax: \"none\",\n        taxAmount: 0,\n        amount: 0\n      }\n    ]);\n  };\n\n  const removeLineItem = (id: string) => {\n    if (lineItems.length > 1) {\n      setLineItems(lineItems.filter(item => item.id !== id));\n    }\n  };\n\n  const selectItem = (lineItemId: string, itemId: string) => {\n    const item = items.find(i => i.id === itemId);\n    if (item) {\n      const rate = item.purchasePrice || item.sellingPrice || 0;\n      setLineItems(prev => prev.map(lineItem => {\n        if (lineItem.id === lineItemId) {\n          const baseAmount = lineItem.quantity * rate;\n          let taxRate = 0;\n          if (lineItem.tax && lineItem.tax !== 'none') {\n            taxRate = parseInt(lineItem.tax.replace(/\\D/g, '')) || 0;\n          }\n          const taxAmount = (baseAmount * taxRate) / 100;\n          return {\n            ...lineItem,\n            itemId: item.id,\n            itemName: item.name,\n            description: item.description || '',\n            rate: rate,\n            taxAmount: taxAmount,\n            amount: baseAmount + taxAmount\n          };\n        }\n        return lineItem;\n      }));\n    }\n  };\n\n  const calculateSubTotal = (): number => {\n    return lineItems.reduce((sum, item) => sum + (item.quantity * item.rate), 0);\n  };\n\n  const calculateDiscount = (): number => {\n    const subTotal = calculateSubTotal();\n    if (formData.discountType === 'percent') {\n      return (subTotal * formData.discountValue) / 100;\n    }\n    return formData.discountValue;\n  };\n\n  const calculateTaxTotal = (): number => {\n    return lineItems.reduce((sum, item) => sum + item.taxAmount, 0);\n  };\n\n  const calculateTotal = (): number => {\n    const subTotal = calculateSubTotal();\n    const discount = calculateDiscount();\n    const taxTotal = calculateTaxTotal();\n    return subTotal - discount + taxTotal + formData.adjustment;\n  };\n\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(e.target.files || []);\n    if (uploadedFiles.length + files.length > 10) {\n      toast({ title: \"Maximum 10 files allowed\", variant: \"destructive\" });\n      return;\n    }\n    const validFiles = files.filter(f => f.size <= 10 * 1024 * 1024);\n    setUploadedFiles([...uploadedFiles, ...validFiles]);\n  };\n\n  const handleSubmit = async () => {\n    if (!formData.vendorId) {\n      toast({ title: \"Please select a vendor\", variant: \"destructive\" });\n      return;\n    }\n\n    const validItems = lineItems.filter(item => item.itemName && item.quantity > 0);\n    if (validItems.length === 0) {\n      toast({ title: \"Please add at least one item\", variant: \"destructive\" });\n      return;\n    }\n\n    setLoading(true);\n\n    try {\n      const response = await fetch(`/api/purchase-orders/${params.id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          ...formData,\n          items: validItems,\n          subTotal: calculateSubTotal(),\n          discountAmount: calculateDiscount(),\n          taxAmount: calculateTaxTotal(),\n          total: calculateTotal()\n        })\n      });\n\n      if (response.ok) {\n        toast({ title: \"Purchase order updated successfully\" });\n        setLocation('/purchase-orders');\n      } else {\n        toast({ title: \"Failed to update purchase order\", variant: \"destructive\" });\n      }\n    } catch (error) {\n      toast({ title: \"Failed to update purchase order\", variant: \"destructive\" });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (loadingData) {\n    return (\n      <div className=\"fixed inset-0 z-50 bg-black/20 flex items-center justify-center\">\n        <div className=\"bg-white p-8 rounded-lg shadow-xl\">\n          <p className=\"text-slate-600\">Loading purchase order...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"fixed inset-0 z-50 bg-black/20\">\n      <div className=\"fixed inset-y-0 left-0 right-0 bg-slate-50 shadow-xl overflow-hidden flex flex-col animate-in slide-in-from-right duration-300\" style={{ marginLeft: 'calc(100vw - 85vw)' }}>\n        {/* Header */}\n        <div className=\"flex items-center justify-between px-6 py-3 bg-white border-b border-slate-200\">\n          <h1 className=\"text-lg font-semibold text-slate-900 flex items-center gap-2\">\n            <svg className=\"w-5 h-5 text-slate-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n            </svg>\n            Edit Purchase Order\n          </h1>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setLocation('/purchase-orders')}\n            className=\"h-8 w-8\"\n            data-testid=\"button-close\"\n          >\n            <X className=\"h-5 w-5\" />\n          </Button>\n        </div>\n\n        {/* Scrollable Content */}\n        <div className=\"flex-1 overflow-y-auto\">\n          <div className=\"p-6 space-y-5\">\n            {/* Vendor Section with Action Buttons */}\n            <div className=\"flex items-center gap-4\">\n              <Label className=\"text-blue-600 font-medium w-28 shrink-0\">Vendor Name<span className=\"text-red-500\">*</span></Label>\n              <div className=\"flex-1 flex gap-2\">\n                <Popover open={vendorDropdownOpen} onOpenChange={setVendorDropdownOpen}>\n                  <PopoverTrigger asChild>\n                    <Button\n                      variant=\"outline\"\n                      role=\"combobox\"\n                      className=\"flex-1 max-w-sm justify-between bg-white text-sm\"\n                      data-testid=\"select-vendor\"\n                    >\n                      {selectedVendor ? selectedVendor.displayName : \"Select a Vendor\"}\n                      <ChevronDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-[350px] p-0\" align=\"start\">\n                    <Command>\n                      <CommandInput placeholder=\"Search vendors...\" />\n                      <CommandEmpty>No vendor found.</CommandEmpty>\n                      <CommandGroup className=\"max-h-[200px] overflow-y-auto\">\n                        {vendors.map(vendor => (\n                          <CommandItem\n                            key={vendor.id}\n                            onSelect={() => handleVendorChange(vendor.id)}\n                          >\n                            {vendor.displayName}\n                          </CommandItem>\n                        ))}\n                      </CommandGroup>\n                    </Command>\n                  </PopoverContent>\n                </Popover>\n                <Button size=\"icon\" variant=\"outline\" className=\"bg-blue-600 text-white hover:bg-blue-700\" data-testid=\"button-search-vendor\">\n                  <Search className=\"h-4 w-4\" />\n                </Button>\n                <Button size=\"sm\" variant=\"outline\" className=\"text-slate-600\">\n                  <svg className=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\" /></svg>\n                  IN-E\n                </Button>\n              </div>\n              {selectedVendor && (\n                <Button variant=\"link\" className=\"text-blue-600 text-sm ml-auto\" data-testid=\"link-vendor-details\">\n                  {selectedVendor.displayName}'s Details <span className=\"ml-1\"></span>\n                </Button>\n              )}\n            </div>\n\n            {/* Billing and Shipping Address */}\n            {selectedVendor && (\n              <div className=\"grid grid-cols-2 gap-6 bg-slate-100 rounded-lg p-4\">\n                <div>\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <span className=\"text-sm font-medium text-slate-700\">BILLING ADDRESS</span>\n                    <button className=\"text-blue-600 text-xs\"></button>\n                  </div>\n                  <div className=\"text-sm text-slate-600 space-y-0.5\">\n                    {selectedVendor.billingAddress ? (\n                      <>\n                        {selectedVendor.billingAddress.attention && <div className=\"font-medium\">{selectedVendor.billingAddress.attention}</div>}\n                        {selectedVendor.billingAddress.street && <div>{selectedVendor.billingAddress.street}</div>}\n                        {selectedVendor.billingAddress.street2 && <div>{selectedVendor.billingAddress.street2}</div>}\n                        {selectedVendor.billingAddress.city && <div>{selectedVendor.billingAddress.city}</div>}\n                        {selectedVendor.billingAddress.state && selectedVendor.billingAddress.pincode && (\n                          <div>{selectedVendor.billingAddress.state} {selectedVendor.billingAddress.pincode}</div>\n                        )}\n                        {selectedVendor.billingAddress.country && <div>{selectedVendor.billingAddress.country}</div>}\n                        {selectedVendor.phone && <div>Phone: {selectedVendor.phone}</div>}\n                      </>\n                    ) : (\n                      <div className=\"text-slate-400 italic\">No billing address on file</div>\n                    )}\n                  </div>\n                </div>\n                <div>\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <span className=\"text-sm font-medium text-slate-700\">SHIPPING ADDRESS</span>\n                    <button className=\"text-blue-600 text-xs\"></button>\n                  </div>\n                  <div className=\"text-sm text-slate-600 space-y-0.5\">\n                    {selectedVendor.shippingAddress ? (\n                      <>\n                        {selectedVendor.shippingAddress.attention && <div className=\"font-medium\">{selectedVendor.shippingAddress.attention}</div>}\n                        {selectedVendor.shippingAddress.street && <div>{selectedVendor.shippingAddress.street}</div>}\n                        {selectedVendor.shippingAddress.street2 && <div>{selectedVendor.shippingAddress.street2}</div>}\n                        {selectedVendor.shippingAddress.city && <div>{selectedVendor.shippingAddress.city}</div>}\n                        {selectedVendor.shippingAddress.state && selectedVendor.shippingAddress.pincode && (\n                          <div>{selectedVendor.shippingAddress.state} {selectedVendor.shippingAddress.pincode}</div>\n                        )}\n                        {selectedVendor.shippingAddress.country && <div>{selectedVendor.shippingAddress.country}</div>}\n                        {selectedVendor.phone && <div>Phone: {selectedVendor.phone}</div>}\n                      </>\n                    ) : (\n                      <div className=\"text-slate-400 italic\">No shipping address on file</div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* GST Treatment */}\n            <div className=\"flex items-center gap-4\">\n              <Label className=\"w-28 shrink-0 text-sm\">GST Treatment:</Label>\n              <span className=\"text-blue-600 text-sm\">{formData.gstTreatment} </span>\n            </div>\n\n            {/* Source of Supply */}\n            <div className=\"flex items-center gap-4\">\n              <Label className=\"text-blue-600 font-medium w-28 shrink-0 text-sm\">Source of Supply<span className=\"text-red-500\">*</span></Label>\n              <Select value={formData.sourceOfSupply} onValueChange={(value) => setFormData({ ...formData, sourceOfSupply: value })}>\n                <SelectTrigger className=\"max-w-xs bg-white text-sm\" data-testid=\"select-source-supply\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {INDIAN_STATES.map(state => (\n                    <SelectItem key={state} value={state}>{state}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Destination of Supply */}\n            <div className=\"flex items-center gap-4\">\n              <Label className=\"text-blue-600 font-medium w-28 shrink-0 text-sm\">Destination of Supply<span className=\"text-red-500\">*</span></Label>\n              <Select value={formData.destinationOfSupply} onValueChange={(value) => setFormData({ ...formData, destinationOfSupply: value })}>\n                <SelectTrigger className=\"max-w-xs bg-white text-sm\" data-testid=\"select-dest-supply\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {INDIAN_STATES.map(state => (\n                    <SelectItem key={state} value={state}>{state}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Delivery Address Section */}\n            <div className=\"grid grid-cols-[140px_1fr] gap-4 items-start\">\n              <Label className=\"text-blue-600 pt-2.5\">Delivery Address<span className=\"text-red-500\">*</span></Label>\n              <div className=\"space-y-3\">\n                <RadioGroup\n                  value={formData.deliveryAddressType}\n                  onValueChange={(value) => setFormData({ ...formData, deliveryAddressType: value, selectedCustomer: null, customerSearchQuery: \"\" })}\n                  className=\"flex gap-6\"\n                >\n                  <div className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value=\"organization\" id=\"org\" className=\"border-blue-600 text-blue-600\" />\n                    <Label htmlFor=\"org\" className=\"cursor-pointer\">Organization</Label>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value=\"customer\" id=\"customer\" className=\"border-blue-600 text-blue-600\" />\n                    <Label htmlFor=\"customer\" className=\"cursor-pointer\">Customer</Label>\n                  </div>\n                </RadioGroup>\n\n                {formData.deliveryAddressType === \"organization\" && (\n                  <div className=\"bg-white border border-slate-200 rounded-lg p-4 space-y-3\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"orgName\" className=\"text-sm font-medium\">Organization Name</Label>\n                      <Input\n                        id=\"orgName\"\n                        value={formData.organizationDetails.name}\n                        onChange={(e) => setFormData({\n                          ...formData,\n                          organizationDetails: {\n                            ...formData.organizationDetails,\n                            name: e.target.value\n                          }\n                        })}\n                        placeholder=\"Enter organization name\"\n                        className=\"bg-white\"\n                        data-testid=\"input-org-name\"\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"orgAddress\" className=\"text-sm font-medium\">Organization Address</Label>\n                      <Textarea\n                        id=\"orgAddress\"\n                        value={formData.organizationDetails.address}\n                        onChange={(e) => setFormData({\n                          ...formData,\n                          organizationDetails: {\n                            ...formData.organizationDetails,\n                            address: e.target.value\n                          }\n                        })}\n                        placeholder=\"Enter complete address\"\n                        className=\"bg-white min-h-[80px]\"\n                        rows={4}\n                        data-testid=\"input-org-address\"\n                      />\n                    </div>\n                  </div>\n                )}\n\n                {formData.deliveryAddressType === \"customer\" && (\n                  <div className=\"space-y-3\">\n                    <Popover open={customerDropdownOpen} onOpenChange={setCustomerDropdownOpen}>\n                      <PopoverTrigger asChild>\n                        <Button\n                          variant=\"outline\"\n                          role=\"combobox\"\n                          className=\"w-full justify-between bg-white\"\n                        >\n                          {formData.selectedCustomer ? formData.selectedCustomer.displayName : \"Select a Customer\"}\n                          <ChevronDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                        </Button>\n                      </PopoverTrigger>\n                      <PopoverContent className=\"w-[400px] p-0\" align=\"start\">\n                        <Command>\n                          <CommandInput\n                            placeholder=\"Search customers...\"\n                            value={formData.customerSearchQuery}\n                            onValueChange={handleCustomerSearch}\n                          />\n                          <div className=\"p-2 border-b\">\n                            <Button\n                              size=\"sm\"\n                              className=\"w-full bg-blue-600 hover:bg-blue-700\"\n                              onClick={() => {\n                                setCustomerDropdownOpen(false);\n                                setLocation('/customers/new');\n                              }}\n                            >\n                              <Plus className=\"h-4 w-4 mr-2\" />\n                              Create Customer\n                            </Button>\n                          </div>\n                          <CommandEmpty>No customers found.</CommandEmpty>\n                          <CommandGroup className=\"max-h-[200px] overflow-y-auto\">\n                            {filteredCustomers.map((customer) => (\n                              <CommandItem\n                                key={customer.id}\n                                onSelect={() => handleCustomerSelect(customer)}\n                              >\n                                <div className=\"flex flex-col\">\n                                  <span className=\"font-medium\">{customer.displayName || customer.name}</span>\n                                  {customer.email && <span className=\"text-sm text-slate-500\">{customer.email}</span>}\n                                </div>\n                              </CommandItem>\n                            ))}\n                          </CommandGroup>\n                        </Command>\n                      </PopoverContent>\n                    </Popover>\n\n                    {formData.selectedCustomer && (\n                      <div className=\"bg-white border border-slate-200 rounded-lg p-4 text-sm text-slate-600\">\n                        <div className=\"font-medium text-slate-900 mb-1\">{formData.selectedCustomer.displayName}</div>\n                        {formData.selectedCustomer.billingAddress && (\n                          <div className=\"whitespace-pre-line\">\n                            {[\n                              formData.selectedCustomer.billingAddress.street,\n                              formData.selectedCustomer.billingAddress.city,\n                              formData.selectedCustomer.billingAddress.state,\n                              formData.selectedCustomer.billingAddress.country,\n                              formData.selectedCustomer.billingAddress.pincode\n                            ].filter(Boolean).join('\\n')}\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Form Fields Row */}\n            <div className=\"grid grid-cols-3 gap-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"text-blue-600 font-medium text-sm\">Purchase Order#<span className=\"text-red-500\">*</span></Label>\n                <div className=\"relative\">\n                  <Input\n                    value={purchaseOrderNumber}\n                    readOnly\n                    className=\"bg-slate-100 pr-8 text-sm\"\n                    data-testid=\"input-po-number\"\n                  />\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <Label className=\"font-medium text-sm\">Reference#</Label>\n                <Input\n                  value={formData.referenceNumber}\n                  onChange={(e) => setFormData({ ...formData, referenceNumber: e.target.value })}\n                  className=\"bg-white text-sm\"\n                  data-testid=\"input-reference\"\n                />\n              </div>\n              <div></div>\n            </div>\n\n            <div className=\"grid grid-cols-3 gap-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"font-medium text-sm\">Date</Label>\n                <Input\n                  type=\"date\"\n                  value={formData.date}\n                  onChange={(e) => setFormData({ ...formData, date: e.target.value })}\n                  className=\"bg-white text-sm\"\n                  data-testid=\"input-date\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label className=\"font-medium text-sm\">Delivery Date</Label>\n                <Input\n                  type=\"date\"\n                  value={formData.deliveryDate}\n                  onChange={(e) => setFormData({ ...formData, deliveryDate: e.target.value })}\n                  className=\"bg-white text-sm\"\n                  data-testid=\"input-delivery-date\"\n                />\n              </div>\n              <div></div>\n            </div>\n\n            <div className=\"grid grid-cols-3 gap-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"font-medium text-sm\">Payment Terms</Label>\n                <Select\n                  value={formData.paymentTerms}\n                  onValueChange={(value) => setFormData({ ...formData, paymentTerms: value })}\n                >\n                  <SelectTrigger className=\"bg-white text-sm\" data-testid=\"select-payment-terms\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {PAYMENT_TERMS.map(term => (\n                      <SelectItem key={term} value={term}>{term}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"space-y-2\">\n                <Label className=\"font-medium text-sm\">Shipment Preference</Label>\n                <Select\n                  value={formData.shipmentPreference}\n                  onValueChange={(value) => setFormData({ ...formData, shipmentPreference: value })}\n                >\n                  <SelectTrigger className=\"bg-white text-sm\" data-testid=\"select-shipment\">\n                    <SelectValue placeholder=\"Choose the shipment preference...\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {SHIPMENT_PREFERENCES.map(pref => (\n                      <SelectItem key={pref} value={pref}>{pref}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div></div>\n            </div>\n\n            {/* TDS/TCS and Reverse Charge Section */}\n            <div className=\"space-y-4 p-4 bg-slate-50 border border-slate-200 rounded-lg\">\n              <div className=\"flex items-center gap-6\">\n                <RadioGroup value={formData.taxType} onValueChange={(value) => setFormData({ ...formData, taxType: value })} className=\"flex gap-6\">\n                  <div className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value=\"TDS\" id=\"tds\" className=\"border-blue-600 text-blue-600\" />\n                    <Label htmlFor=\"tds\" className=\"cursor-pointer font-medium text-sm\">TDS</Label>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value=\"TCS\" id=\"tcs\" className=\"border-blue-600 text-blue-600\" />\n                    <Label htmlFor=\"tcs\" className=\"cursor-pointer font-medium text-sm\">TCS</Label>\n                  </div>\n                </RadioGroup>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Checkbox\n                  id=\"reverseCharge\"\n                  checked={formData.reverseCharge}\n                  onCheckedChange={(checked) => setFormData({ ...formData, reverseCharge: checked as boolean })}\n                />\n                <Label htmlFor=\"reverseCharge\" className=\"text-sm cursor-pointer\">\n                  This transaction is applicable for reverse charge\n                </Label>\n              </div>\n            </div>\n\n            {/* Item Table Section */}\n            <div className=\"bg-white border border-slate-200 rounded-lg overflow-hidden\">\n              {/* Table Header Controls */}\n              <div className=\"flex items-center justify-between p-4 border-b border-slate-200\">\n                <div className=\"flex items-center gap-4\">\n                  <RadioGroup defaultValue=\"item\" className=\"flex gap-4\">\n                    <div className=\"flex items-center space-x-2\">\n                      <RadioGroupItem value=\"item\" id=\"item-level\" className=\"border-blue-600 text-blue-600\" />\n                      <Label htmlFor=\"item-level\" className=\"cursor-pointer text-sm\">At Transaction Level</Label>\n                    </div>\n                  </RadioGroup>\n                </div>\n              </div>\n\n              {/* Item Table */}\n              <div className=\"p-4\">\n                <div className=\"flex items-center justify-between mb-3\">\n                  <h3 className=\"font-semibold text-slate-800\">Item Table</h3>\n                  <Button variant=\"link\" className=\"text-blue-600 text-sm p-0 h-auto\">\n                    Bulk Actions\n                  </Button>\n                </div>\n\n                <div className=\"border border-slate-200 rounded-lg overflow-hidden\">\n                  {/* Table Header */}\n                  <div className=\"grid grid-cols-[40px_1fr_140px_80px_80px_120px_100px_40px] bg-blue-600 text-white text-sm font-medium\">\n                    <div className=\"p-2 text-center\">#</div>\n                    <div className=\"p-2\">ITEM DETAILS</div>\n                    <div className=\"p-2\">ACCOUNT</div>\n                    <div className=\"p-2 text-center\">QUANTITY</div>\n                    <div className=\"p-2 text-right\">RATE</div>\n                    <div className=\"p-2\">TAX</div>\n                    <div className=\"p-2 text-right\">AMOUNT</div>\n                    <div className=\"p-2\"></div>\n                  </div>\n\n                  {/* Table Rows */}\n                  {lineItems.map((item, index) => (\n                    <div key={item.id} className=\"grid grid-cols-[40px_1fr_140px_80px_80px_120px_100px_40px] border-t border-slate-200 items-center\">\n                      <div className=\"p-2 text-center text-slate-500\">{index + 1}</div>\n                      <div className=\"p-2\">\n                        <Select\n                          value={item.itemId}\n                          onValueChange={(value) => selectItem(item.id, value)}\n                        >\n                          <SelectTrigger className=\"border-0 shadow-none h-8 text-sm\" data-testid={`select-item-${index}`}>\n                            <SelectValue placeholder=\"Type or click to select an item.\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {items.map(i => (\n                              <SelectItem key={i.id} value={i.id}>\n                                {i.name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div className=\"p-2\">\n                        <AccountSelectDropdown\n                          value={item.account}\n                          onValueChange={(value) => updateLineItem(item.id, 'account', value)}\n                          placeholder=\"Select an account\"\n                          triggerClassName=\"border-0 shadow-none h-8 text-sm\"\n                          testId={`select-account-${index}`}\n                        />\n                      </div>\n                      <div className=\"p-2\">\n                        <Input\n                          type=\"number\"\n                          value={item.quantity}\n                          onChange={(e) => updateLineItem(item.id, 'quantity', parseFloat(e.target.value) || 0)}\n                          className=\"text-center h-8 text-sm\"\n                          data-testid={`input-quantity-${index}`}\n                        />\n                      </div>\n                      <div className=\"p-2\">\n                        <Input\n                          type=\"number\"\n                          value={item.rate}\n                          onChange={(e) => updateLineItem(item.id, 'rate', parseFloat(e.target.value) || 0)}\n                          className=\"text-right h-8 text-sm\"\n                          data-testid={`input-rate-${index}`}\n                        />\n                      </div>\n                      <div className=\"p-2\">\n                        <Select\n                          value={item.tax}\n                          onValueChange={(value) => updateLineItem(item.id, 'tax', value)}\n                        >\n                          <SelectTrigger className=\"border-0 shadow-none h-8 text-sm\" data-testid={`select-tax-${index}`}>\n                            <SelectValue placeholder=\"Select a Tax\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {TAX_OPTIONS.map(tax => (\n                              <SelectItem key={tax.value} value={tax.value}>{tax.label}</SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div className=\"p-2 text-right font-medium text-sm\">\n                        {item.amount.toFixed(2)}\n                      </div>\n                      <div className=\"p-2\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"text-red-500 h-6 w-6\"\n                          onClick={() => removeLineItem(item.id)}\n                          data-testid={`button-remove-item-${index}`}\n                        >\n                          <X className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n\n                {/* Add Row Buttons */}\n                <div className=\"flex gap-2 mt-3\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"text-blue-600 border-blue-600\"\n                    onClick={addLineItem}\n                    data-testid=\"button-add-row\"\n                  >\n                    <Plus className=\"h-4 w-4 mr-1\" /> Add New Row\n                  </Button>\n                  <Button variant=\"outline\" size=\"sm\" className=\"text-blue-600 border-blue-600\">\n                    <Plus className=\"h-4 w-4 mr-1\" /> Add Items in Bulk\n                  </Button>\n                </div>\n              </div>\n\n              {/* Summary Section */}\n              <div className=\"grid grid-cols-2 gap-8 p-4 border-t border-slate-200\">\n                <div></div>\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-slate-600\">Sub Total</span>\n                    <span className=\"font-medium\">{calculateSubTotal().toFixed(2)}</span>\n                  </div>\n\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-slate-600 w-24\">Discount</span>\n                    <Input\n                      type=\"number\"\n                      value={formData.discountValue}\n                      onChange={(e) => setFormData({ ...formData, discountValue: parseFloat(e.target.value) || 0 })}\n                      className=\"w-16 text-center h-8 text-sm\"\n                      data-testid=\"input-discount\"\n                    />\n                    <Select\n                      value={formData.discountType}\n                      onValueChange={(value) => setFormData({ ...formData, discountType: value })}\n                    >\n                      <SelectTrigger className=\"w-14 h-8\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"percent\">%</SelectItem>\n                        <SelectItem value=\"flat\">Rs.</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <span className=\"ml-auto text-red-500\">-{calculateDiscount().toFixed(2)}</span>\n                  </div>\n\n                  <div className=\"flex items-center gap-3\">\n                    <RadioGroup\n                      value={formData.taxType}\n                      onValueChange={(value) => setFormData({ ...formData, taxType: value })}\n                      className=\"flex gap-3\"\n                    >\n                      <div className=\"flex items-center space-x-1\">\n                        <RadioGroupItem value=\"TDS\" id=\"tds\" className=\"h-3.5 w-3.5\" />\n                        <Label htmlFor=\"tds\" className=\"text-sm\">TDS</Label>\n                      </div>\n                      <div className=\"flex items-center space-x-1\">\n                        <RadioGroupItem value=\"TCS\" id=\"tcs\" className=\"h-3.5 w-3.5\" />\n                        <Label htmlFor=\"tcs\" className=\"text-sm\">TCS</Label>\n                      </div>\n                    </RadioGroup>\n                    <Select\n                      value={formData.taxCategory}\n                      onValueChange={(value) => setFormData({ ...formData, taxCategory: value })}\n                    >\n                      <SelectTrigger className=\"flex-1 h-8\">\n                        <SelectValue placeholder=\"Select a Tax\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"none\">No Tax</SelectItem>\n                        <SelectItem value=\"tds194c\">194C - 1%</SelectItem>\n                        <SelectItem value=\"tds194j\">194J - 10%</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <span className=\"text-red-500\">-0.00</span>\n                  </div>\n\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-slate-600 w-24\">Adjustment</span>\n                    <Input\n                      type=\"number\"\n                      value={formData.adjustment}\n                      onChange={(e) => setFormData({ ...formData, adjustment: parseFloat(e.target.value) || 0 })}\n                      className=\"w-20 text-right h-8 text-sm\"\n                      data-testid=\"input-adjustment\"\n                    />\n                    <Tooltip>\n                      <TooltipTrigger>\n                        <HelpCircle className=\"h-4 w-4 text-slate-400\" />\n                      </TooltipTrigger>\n                      <TooltipContent>\n                        <p>Add any adjustments to the total</p>\n                      </TooltipContent>\n                    </Tooltip>\n                    <span className=\"ml-auto\">{formData.adjustment.toFixed(2)}</span>\n                  </div>\n\n                  <div className=\"flex items-center justify-between pt-3 border-t border-slate-200\">\n                    <span className=\"font-semibold text-lg\">Total</span>\n                    <span className=\"font-semibold text-lg\">{calculateTotal().toFixed(2)}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Notes Section */}\n            <div className=\"grid grid-cols-[140px_1fr] gap-4 items-start\">\n              <Label>Notes</Label>\n              <Textarea\n                placeholder=\"Will be displayed on purchase order\"\n                value={formData.notes}\n                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                className=\"bg-white min-h-[80px]\"\n                data-testid=\"input-notes\"\n              />\n            </div>\n\n            {/* Terms & Conditions and File Upload */}\n            <div className=\"bg-slate-100 rounded-lg p-4\">\n              <div className=\"grid grid-cols-2 gap-6\">\n                <div className=\"space-y-2\">\n                  <Label className=\"font-semibold text-sm\">Terms & Conditions</Label>\n                  <Textarea\n                    placeholder=\"Enter the terms and conditions of your business to be displayed in your transaction\"\n                    value={formData.termsAndConditions}\n                    onChange={(e) => setFormData({ ...formData, termsAndConditions: e.target.value })}\n                    className=\"bg-white min-h-[100px] text-sm\"\n                    data-testid=\"input-terms\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label className=\"font-semibold text-sm\">Attach File(s) to Purchase Order</Label>\n                  <div className=\"bg-white border border-slate-200 rounded-lg p-4 text-center\">\n                    <input\n                      type=\"file\"\n                      ref={fileInputRef}\n                      onChange={handleFileUpload}\n                      multiple\n                      className=\"hidden\"\n                    />\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"gap-2\"\n                      onClick={() => fileInputRef.current?.click()}\n                    >\n                      <Upload className=\"h-4 w-4\" /> Upload File\n                    </Button>\n                    <p className=\"text-xs text-slate-500 mt-2\">\n                      You can upload a maximum of 10 files, 10MB each\n                    </p>\n                    {uploadedFiles.length > 0 && (\n                      <div className=\"mt-2 text-sm text-slate-600\">\n                        {uploadedFiles.length} file(s) selected\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Email Communications */}\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center gap-2\">\n                <Label className=\"font-semibold text-sm\">Email Communications</Label>\n                <span\n                  className=\"text-blue-600 text-sm cursor-pointer\"\n                  onClick={() => {\n                    const allEmails = selectedVendor?.email ? [selectedVendor.email] : [];\n                    setFormData({ ...formData, emailCommunications: allEmails });\n                  }}\n                >\n                  Select All\n                </span>\n              </div>\n              <div className=\"flex flex-wrap gap-2\">\n                <Button size=\"sm\" variant=\"outline\" className=\"text-blue-600 border-blue-600\">\n                  <Plus className=\"h-4 w-4 mr-1\" /> Add New\n                </Button>\n                {selectedVendor?.email && (\n                  <div className=\"flex items-center gap-2 px-3 py-1.5 bg-slate-100 rounded-md text-sm\">\n                    <Checkbox\n                      id=\"vendorEmail\"\n                      checked={formData.emailCommunications.includes(selectedVendor.email)}\n                      onCheckedChange={(checked) => {\n                        if (checked) {\n                          setFormData({ ...formData, emailCommunications: [...formData.emailCommunications, selectedVendor.email] });\n                        } else {\n                          setFormData({ ...formData, emailCommunications: formData.emailCommunications.filter(e => e !== selectedVendor.email) });\n                        }\n                      }}\n                    />\n                    <label htmlFor=\"vendorEmail\">{selectedVendor.displayName} &lt;{selectedVendor.email}&gt;</label>\n                  </div>\n                )}\n                {!selectedVendor?.email && (\n                  <span className=\"text-sm text-slate-400 italic\">No vendor email available</span>\n                )}\n              </div>\n            </div>\n\n            {/* Additional Fields Info */}\n            <div className=\"text-sm text-slate-500\">\n              <span className=\"font-medium text-blue-600\">Additional Fields:</span> Start adding custom fields for your purchase orders by going to Settings  Purchases  Purchase Orders.\n            </div>\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"flex items-center justify-between px-6 py-3 bg-white border-t border-slate-200\">\n          <div className=\"flex items-center gap-3\">\n            <Button\n              onClick={() => handleSubmit()}\n              disabled={loading}\n              variant=\"outline\"\n              className=\"text-slate-700\"\n              data-testid=\"button-save-draft\"\n            >\n              Save\n            </Button>\n            <Button\n              onClick={handleSubmit}\n              disabled={loading}\n              className=\"bg-blue-600 hover:bg-blue-700\"\n              data-testid=\"button-save-send\"\n            >\n              {loading ? \"Saving...\" : \"Save and Send\"}\n            </Button>\n            <Button\n              variant=\"ghost\"\n              onClick={() => setLocation('/purchase-orders')}\n              data-testid=\"button-cancel\"\n            >\n              Cancel\n            </Button>\n          </div>\n          <div className=\"text-sm text-slate-500\">\n            PDF Template: <span className=\"text-blue-600 cursor-pointer\">Standard Template</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":53462,"size_tokens":null},"client/src/pages/bill-create.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport {\n  FileText, Plus, Trash2, ChevronDown, Search,\n  Upload, Info, X\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { AccountSelectDropdown } from \"@/components/AccountSelectDropdown\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\n\ninterface Vendor {\n  id: string;\n  name: string;\n  companyName?: string;\n  email?: string;\n  phone?: string;\n  gstin?: string;\n  billingAddress?: {\n    street1?: string;\n    street2?: string;\n    city?: string;\n    state?: string;\n    pinCode?: string;\n    country?: string;\n  };\n}\n\ninterface BillItem {\n  id: string;\n  itemName: string;\n  description?: string;\n  account: string;\n  quantity: number;\n  rate: number;\n  tax?: string;\n  taxAmount?: number;\n  customerDetails?: string;\n  amount: number;\n}\n\ninterface Account {\n  id: string;\n  name: string;\n  type: string;\n}\n\ninterface Tax {\n  id: string;\n  name: string;\n  rate: number;\n}\n\ninterface Product {\n  id: string;\n  name: string;\n  sku?: string;\n  type?: string;\n  unit?: string;\n  usageUnit?: string;\n  sellingPrice?: number;\n  costPrice?: number;\n  rate?: string | number;\n  purchaseRate?: string | number;\n  description?: string;\n  purchaseDescription?: string;\n  hsnCode?: string;\n  hsnSac?: string;\n  sacCode?: string;\n  taxPreference?: string;\n}\n\ninterface Customer {\n  id: string;\n  name: string;\n  displayName?: string;\n  companyName?: string;\n}\n\nexport default function BillCreate() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [vendors, setVendors] = useState<Vendor[]>([]);\n  const [vendorSearchTerm, setVendorSearchTerm] = useState(\"\");\n  const [accounts, setAccounts] = useState<Account[]>([]);\n  const [taxes, setTaxes] = useState<Tax[]>([]);\n  const [products, setProducts] = useState<Product[]>([]);\n  const [customers, setCustomers] = useState<Customer[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [loadingProducts, setLoadingProducts] = useState(true);\n  const [loadingPO, setLoadingPO] = useState(false);\n  const [poDataLoaded, setPoDataLoaded] = useState(false);\n\n  // Get query params from URL\n  const urlParams = new URLSearchParams(window.location.search);\n  const purchaseOrderId = urlParams.get('purchaseOrderId');\n  const vendorIdFromUrl = urlParams.get('vendorId');\n\n  const [formData, setFormData] = useState({\n    vendorId: \"\",\n    vendorName: \"\",\n    vendorAddress: {\n      street1: \"\",\n      street2: \"\",\n      city: \"\",\n      state: \"\",\n      pinCode: \"\",\n      country: \"India\",\n      gstin: \"\"\n    },\n    billNumber: \"\",\n    orderNumber: \"\",\n    billDate: new Date().toISOString().split('T')[0],\n    dueDate: new Date().toISOString().split('T')[0],\n    paymentTerms: \"Due on Receipt\",\n    reverseCharge: false,\n    subject: \"\",\n    notes: \"\",\n    items: [] as BillItem[],\n    subTotal: 0,\n    discountType: \"percent\",\n    discountValue: 0,\n    discountAmount: 0,\n    taxType: \"TDS\",\n    taxCategory: \"\",\n    taxAmount: 0,\n    adjustment: 0,\n    adjustmentDescription: \"\",\n    total: 0\n  });\n\n  useEffect(() => {\n    fetchVendors();\n    fetchAccounts();\n    fetchTaxes();\n    fetchProducts();\n    fetchNextBillNumber();\n    fetchCustomers();\n    if (purchaseOrderId) {\n      fetchPurchaseOrderData(purchaseOrderId);\n    }\n  }, [purchaseOrderId]);\n\n  // Pre-fill vendor data if vendorId is in URL\n  useEffect(() => {\n    if (vendorIdFromUrl && vendors.length > 0 && !formData.vendorId) {\n      const vendor = vendors.find(v => v.id === vendorIdFromUrl);\n      if (vendor) {\n        setFormData(prev => ({\n          ...prev,\n          vendorId: vendor.id,\n          vendorName: vendor.displayName || `${vendor.firstName} ${vendor.lastName}`.trim() || vendor.companyName || \"\",\n          vendorAddress: {\n            street1: vendor.billingAddress?.street1 || \"\",\n            street2: vendor.billingAddress?.street2 || \"\",\n            city: vendor.billingAddress?.city || \"\",\n            state: vendor.billingAddress?.state || \"\",\n            pinCode: vendor.billingAddress?.pinCode || \"\",\n            country: vendor.billingAddress?.country || \"India\",\n            gstin: vendor.gstin || \"\"\n          }\n        }));\n      }\n    }\n  }, [vendorIdFromUrl, vendors]);\n\n  const fetchCustomers = async () => {\n    try {\n      const response = await fetch('/api/customers');\n      if (response.ok) {\n        const data = await response.json();\n        setCustomers(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch customers:', error);\n    }\n  };\n\n  const getCustomerDisplayName = (customerId: string) => {\n    if (!customerId || customerId === 'none') return 'None';\n    const customer = customers.find(c => c.id === customerId);\n    return customer ? (customer.displayName || customer.name) : 'None';\n  };\n\n  const filteredVendors = vendors.filter(vendor => {\n    const vendorName = vendor.displayName || `${vendor.firstName} ${vendor.lastName}`.trim() || vendor.companyName || \"\";\n    return vendorName.toLowerCase().includes(vendorSearchTerm.toLowerCase());\n  });\n\n  const fetchPurchaseOrderData = async (poId: string) => {\n    try {\n      setLoadingPO(true);\n      const response = await fetch(`/api/purchase-orders/${poId}`);\n      if (response.ok) {\n        const data = await response.json();\n        const po = data.data;\n        if (po && !poDataLoaded) {\n          // Map PO items to bill items\n          const billItems: BillItem[] = (po.items || []).map((item: any, index: number) => ({\n            id: `item-${Date.now()}-${index}`,\n            itemName: item.itemName || item.name || \"\",\n            description: item.description || \"\",\n            account: item.account || \"Cost of Goods Sold\",\n            quantity: item.quantity || 1,\n            rate: item.rate || 0,\n            tax: item.tax || \"\",\n            taxAmount: item.taxAmount || 0,\n            customerDetails: \"none\",\n            amount: (item.quantity || 1) * (item.rate || 0)\n          }));\n\n          // Calculate totals\n          const subTotal = billItems.reduce((sum, item) => sum + item.amount, 0);\n          const taxAmount = billItems.reduce((sum, item) => sum + (item.taxAmount || 0), 0);\n          const total = subTotal + taxAmount;\n\n          setFormData(prev => ({\n            ...prev,\n            vendorId: po.vendorId || \"\",\n            vendorName: po.vendorName || \"\",\n            vendorAddress: po.vendorAddress || prev.vendorAddress,\n            orderNumber: po.purchaseOrderNumber || \"\",\n            subject: `Bill for Purchase Order #${po.purchaseOrderNumber}`,\n            notes: po.notes || \"\",\n            items: billItems,\n            subTotal,\n            taxAmount,\n            total\n          }));\n          setPoDataLoaded(true);\n          toast({ title: `Loaded data from Purchase Order #${po.purchaseOrderNumber}` });\n        }\n      }\n    } catch (error) {\n      console.error('Failed to fetch purchase order:', error);\n      toast({ title: \"Failed to load purchase order data\", variant: \"destructive\" });\n    } finally {\n      setLoadingPO(false);\n    }\n  };\n\n  const fetchProducts = async () => {\n    try {\n      setLoadingProducts(true);\n      const response = await fetch('/api/items');\n      if (response.ok) {\n        const data = await response.json();\n        setProducts(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch products:', error);\n    } finally {\n      setLoadingProducts(false);\n    }\n  };\n\n  const fetchVendors = async () => {\n    try {\n      const response = await fetch('/api/vendors');\n      if (response.ok) {\n        const data = await response.json();\n        setVendors(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch vendors:', error);\n    }\n  };\n\n  const fetchAccounts = async () => {\n    try {\n      const response = await fetch('/api/bills/accounts');\n      if (response.ok) {\n        const data = await response.json();\n        setAccounts(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch accounts:', error);\n    }\n  };\n\n  const fetchTaxes = async () => {\n    try {\n      const response = await fetch('/api/bills/taxes');\n      if (response.ok) {\n        const data = await response.json();\n        setTaxes(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch taxes:', error);\n    }\n  };\n\n  const fetchNextBillNumber = async () => {\n    try {\n      const response = await fetch('/api/bills/next-number');\n      if (response.ok) {\n        const data = await response.json();\n        setFormData(prev => ({ ...prev, billNumber: data.data.billNumber }));\n      }\n    } catch (error) {\n      console.error('Failed to fetch next bill number:', error);\n    }\n  };\n\n  const handleVendorChange = (vendorId: string) => {\n    if (vendorId === \"__add_new_vendor__\") {\n      setLocation(\"/vendors/new\");\n      return;\n    }\n\n    const vendor = vendors.find(v => v.id === vendorId);\n    if (vendor) {\n      setFormData(prev => ({\n        ...prev,\n        vendorId: vendor.id,\n        vendorName: vendor.displayName || `${vendor.firstName} ${vendor.lastName}`.trim() || vendor.companyName || \"\",\n        vendorAddress: {\n          street1: vendor.billingAddress?.street1 || \"\",\n          street2: vendor.billingAddress?.street2 || \"\",\n          city: vendor.billingAddress?.city || \"\",\n          state: vendor.billingAddress?.state || \"\",\n          pinCode: vendor.billingAddress?.pinCode || \"\",\n          country: vendor.billingAddress?.country || \"India\",\n          gstin: vendor.gstin || \"\"\n        }\n      }));\n    }\n  };\n\n  const addItem = () => {\n    const newItem: BillItem = {\n      id: String(Date.now()),\n      itemName: \"\",\n      description: \"\",\n      account: \"\",\n      quantity: 1,\n      rate: 0,\n      tax: \"\",\n      taxAmount: 0,\n      customerDetails: \"none\",\n      amount: 0\n    };\n    setFormData(prev => ({\n      ...prev,\n      items: [...prev.items, newItem]\n    }));\n  };\n\n  const updateItem = (id: string, field: keyof BillItem, value: any) => {\n    setFormData(prev => {\n      const updatedItems = prev.items.map(item => {\n        if (item.id === id) {\n          const updatedItem = { ...item, [field]: value };\n          if (field === 'quantity' || field === 'rate') {\n            updatedItem.amount = updatedItem.quantity * updatedItem.rate;\n            if (updatedItem.tax) {\n              const taxRate = taxes.find(t => t.name === updatedItem.tax)?.rate || 0;\n              updatedItem.taxAmount = (updatedItem.amount * taxRate) / 100;\n            }\n          }\n          if (field === 'tax') {\n            const taxRate = taxes.find(t => t.name === value)?.rate || 0;\n            updatedItem.taxAmount = (updatedItem.amount * taxRate) / 100;\n          }\n          return updatedItem;\n        }\n        return item;\n      });\n\n      const subTotal = updatedItems.reduce((sum, item) => sum + item.amount, 0);\n      const taxAmount = updatedItems.reduce((sum, item) => sum + (item.taxAmount || 0), 0);\n      const discountAmount = prev.discountType === 'percent'\n        ? (subTotal * prev.discountValue) / 100\n        : prev.discountValue;\n      const total = subTotal - discountAmount + taxAmount + prev.adjustment;\n\n      return {\n        ...prev,\n        items: updatedItems,\n        subTotal,\n        taxAmount,\n        discountAmount,\n        total\n      };\n    });\n  };\n\n  const removeItem = (id: string) => {\n    setFormData(prev => {\n      const updatedItems = prev.items.filter(item => item.id !== id);\n      const subTotal = updatedItems.reduce((sum, item) => sum + item.amount, 0);\n      const taxAmount = updatedItems.reduce((sum, item) => sum + (item.taxAmount || 0), 0);\n      const discountAmount = prev.discountType === 'percent'\n        ? (subTotal * prev.discountValue) / 100\n        : prev.discountValue;\n      const total = subTotal - discountAmount + taxAmount + prev.adjustment;\n\n      return {\n        ...prev,\n        items: updatedItems,\n        subTotal,\n        taxAmount,\n        discountAmount,\n        total\n      };\n    });\n  };\n\n  const handleProductSelect = (itemId: string, productId: string) => {\n    const product = products.find(p => p.id === productId);\n    if (product) {\n      setFormData(prev => {\n        const updatedItems = prev.items.map(item => {\n          if (item.id === itemId) {\n            // For bills (purchases), use purchaseRate first, then rate, then costPrice/sellingPrice\n            const rate = Number(product.purchaseRate) || Number(product.rate) || product.costPrice || product.sellingPrice || 0;\n            const amount = item.quantity * rate;\n            return {\n              ...item,\n              itemName: product.name,\n              description: product.purchaseDescription || product.description || \"\",\n              rate: rate,\n              amount: amount\n            };\n          }\n          return item;\n        });\n\n        const subTotal = updatedItems.reduce((sum, item) => sum + item.amount, 0);\n        const taxAmount = updatedItems.reduce((sum, item) => sum + (item.taxAmount || 0), 0);\n        const discountAmount = prev.discountType === 'percent'\n          ? (subTotal * prev.discountValue) / 100\n          : prev.discountValue;\n        const total = subTotal - discountAmount + taxAmount + prev.adjustment;\n\n        return {\n          ...prev,\n          items: updatedItems,\n          subTotal,\n          taxAmount,\n          discountAmount,\n          total\n        };\n      });\n    }\n  };\n\n  const handleDiscountChange = (type: string, value: number) => {\n    setFormData(prev => {\n      const discountAmount = type === 'percent'\n        ? (prev.subTotal * value) / 100\n        : value;\n      const total = prev.subTotal - discountAmount + prev.taxAmount + prev.adjustment;\n      return {\n        ...prev,\n        discountType: type,\n        discountValue: value,\n        discountAmount,\n        total\n      };\n    });\n  };\n\n  const handleAdjustmentChange = (value: number) => {\n    setFormData(prev => {\n      const total = prev.subTotal - prev.discountAmount + prev.taxAmount + value;\n      return {\n        ...prev,\n        adjustment: value,\n        total\n      };\n    });\n  };\n\n  const handleSubmit = async (status: string) => {\n    if (!formData.vendorId) {\n      toast({ title: \"Please select a vendor\", variant: \"destructive\" });\n      return;\n    }\n    if (!formData.billNumber) {\n      toast({ title: \"Please enter a bill number\", variant: \"destructive\" });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const response = await fetch('/api/bills', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          ...formData,\n          status,\n          balanceDue: formData.total\n        })\n      });\n\n      if (response.ok) {\n        toast({ title: status === 'DRAFT' ? \"Bill saved as draft\" : \"Bill created successfully\" });\n        setLocation(\"/bills\");\n      } else {\n        throw new Error('Failed to create bill');\n      }\n    } catch (error) {\n      toast({ title: \"Failed to create bill\", variant: \"destructive\" });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-slate-50\">\n      <div className=\"max-w-6xl mx-auto p-6\">\n        <div className=\"flex items-center gap-3 mb-6\">\n          <FileText className=\"h-6 w-6 text-slate-600\" />\n          <h1 className=\"text-2xl font-semibold text-slate-900\" data-testid=\"text-page-title\">New Bill</h1>\n        </div>\n\n        {purchaseOrderId && (\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4 flex items-center gap-3\">\n            <FileText className=\"h-5 w-5 text-blue-600\" />\n            <div>\n              <p className=\"text-sm font-medium text-blue-800\">\n                {loadingPO ? \"Loading purchase order data...\" : `Creating bill from Purchase Order`}\n              </p>\n              {formData.orderNumber && (\n                <p className=\"text-xs text-blue-600\">PO# {formData.orderNumber}</p>\n              )}\n            </div>\n          </div>\n        )}\n\n        <div className=\"bg-white rounded-lg shadow-sm border border-slate-200 p-6\">\n          <div className=\"grid gap-6\">\n            <div className=\"grid grid-cols-2 gap-6\">\n              <div>\n                <Label className=\"text-red-600\">Vendor Name*</Label>\n                <div className=\"flex gap-2 mt-1\">\n                  <Select onValueChange={handleVendorChange} value={formData.vendorId}>\n                    <SelectTrigger className=\"flex-1\" data-testid=\"select-vendor\">\n                      <SelectValue placeholder=\"Select a Vendor\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <div className=\"p-2\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                          <Search className=\"h-4 w-4 text-gray-400\" />\n                          <Input\n                            placeholder=\"Search vendors...\"\n                            className=\"h-8\"\n                            value={vendorSearchTerm}\n                            onChange={(e) => setVendorSearchTerm(e.target.value)}\n                          />\n                        </div>\n                      </div>\n                      {filteredVendors.map(vendor => (\n                        <SelectItem key={vendor.id} value={vendor.id}>\n                          {vendor.displayName || `${vendor.firstName} ${vendor.lastName}`.trim() || vendor.companyName}\n                        </SelectItem>\n                      ))}\n                      <div className=\"border-t mt-1 pt-1\">\n                        <SelectItem\n                          value=\"__add_new_vendor__\"\n                          onSelect={() => {\n                            setLocation(\"/vendors/new\");\n                          }}\n                        >\n                          <div className=\"flex items-center gap-2 text-blue-600\">\n                            <Plus className=\"h-4 w-4\" />\n                            Add New Vendor\n                          </div>\n                        </SelectItem>\n                      </div>\n                    </SelectContent>\n                  </Select>\n                  <Button variant=\"outline\" size=\"icon\" onClick={() => setLocation(\"/vendors/new\")} data-testid=\"button-add-vendor\">\n                    <Plus className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n              <div></div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-6\">\n              <div>\n                <Label className=\"text-red-600\">Bill#*</Label>\n                <Input\n                  value={formData.billNumber}\n                  onChange={(e) => setFormData(prev => ({ ...prev, billNumber: e.target.value }))}\n                  className=\"mt-1\"\n                  data-testid=\"input-bill-number\"\n                />\n              </div>\n              <div>\n                <Label>Order Number</Label>\n                <Input\n                  value={formData.orderNumber}\n                  onChange={(e) => setFormData(prev => ({ ...prev, orderNumber: e.target.value }))}\n                  className=\"mt-1\"\n                  data-testid=\"input-order-number\"\n                />\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-6\">\n              <div>\n                <Label className=\"text-red-600\">Bill Date*</Label>\n                <Input\n                  type=\"date\"\n                  value={formData.billDate}\n                  onChange={(e) => setFormData(prev => ({ ...prev, billDate: e.target.value }))}\n                  className=\"mt-1\"\n                  data-testid=\"input-bill-date\"\n                />\n              </div>\n              <div className=\"flex gap-4\">\n                <div className=\"flex-1\">\n                  <Label>Due Date</Label>\n                  <Input\n                    type=\"date\"\n                    value={formData.dueDate}\n                    onChange={(e) => setFormData(prev => ({ ...prev, dueDate: e.target.value }))}\n                    className=\"mt-1\"\n                    data-testid=\"input-due-date\"\n                  />\n                </div>\n                <div className=\"flex-1\">\n                  <Label>Payment Terms</Label>\n                  <Select\n                    value={formData.paymentTerms}\n                    onValueChange={(value) => setFormData(prev => ({ ...prev, paymentTerms: value }))}\n                  >\n                    <SelectTrigger className=\"mt-1\" data-testid=\"select-payment-terms\">\n                      <SelectValue placeholder=\"Select terms\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"Due on Receipt\">Due on Receipt</SelectItem>\n                      <SelectItem value=\"Net 15\">Net 15</SelectItem>\n                      <SelectItem value=\"Net 30\">Net 30</SelectItem>\n                      <SelectItem value=\"Net 45\">Net 45</SelectItem>\n                      <SelectItem value=\"Net 60\">Net 60</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"flex items-center gap-2\">\n              <Checkbox\n                id=\"reverse-charge\"\n                checked={formData.reverseCharge}\n                onCheckedChange={(checked) => setFormData(prev => ({ ...prev, reverseCharge: checked as boolean }))}\n              />\n              <Label htmlFor=\"reverse-charge\" className=\"text-sm\">\n                This transaction is applicable for reverse charge\n              </Label>\n            </div>\n\n            <div>\n              <Label className=\"flex items-center gap-1\">\n                Subject <Info className=\"h-3 w-3 text-slate-400\" />\n              </Label>\n              <Textarea\n                value={formData.subject}\n                onChange={(e) => setFormData(prev => ({ ...prev, subject: e.target.value }))}\n                placeholder=\"Enter a subject within 250 characters\"\n                className=\"mt-1 resize-none\"\n                maxLength={250}\n                data-testid=\"input-subject\"\n              />\n            </div>\n\n            <div className=\"flex items-center gap-2 text-sm text-slate-500\">\n              <span>At Transaction Level</span>\n              <ChevronDown className=\"h-4 w-4\" />\n            </div>\n\n            <div className=\"border rounded-lg overflow-hidden\">\n              <div className=\"bg-slate-50 px-4 py-2 flex items-center justify-between border-b\">\n                <h3 className=\"font-medium text-slate-700\">Item Table</h3>\n                <Button variant=\"link\" size=\"sm\" className=\"text-blue-600\">\n                  Bulk Actions\n                </Button>\n              </div>\n              <Table>\n                <TableHeader>\n                  <TableRow className=\"bg-slate-50\">\n                    <TableHead className=\"w-[200px] text-xs\">ITEM DETAILS</TableHead>\n                    <TableHead className=\"w-[150px] text-xs\">ACCOUNT</TableHead>\n                    <TableHead className=\"w-[100px] text-xs text-center\">QUANTITY</TableHead>\n                    <TableHead className=\"w-[140px] text-xs text-right\">RATE ()</TableHead>\n                    <TableHead className=\"w-[120px] text-xs\">TAX</TableHead>\n                    <TableHead className=\"w-[150px] text-xs\">CUSTOMER DETAILS</TableHead>\n                    <TableHead className=\"w-[100px] text-xs text-right\">AMOUNT</TableHead>\n                    <TableHead className=\"w-[50px]\"></TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {formData.items.length === 0 ? (\n                    <TableRow>\n                      <TableCell colSpan={8} className=\"text-center py-8 text-slate-500\">\n                        No items added yet. Click \"Add New Row\" to add items.\n                      </TableCell>\n                    </TableRow>\n                  ) : (\n                    formData.items.map((item) => (\n                      <TableRow key={item.id}>\n                        <TableCell>\n                          <Select\n                            value={item.itemName || \"\"}\n                            onValueChange={(value) => {\n                              const product = products.find(p => p.name === value);\n                              if (product) {\n                                handleProductSelect(item.id, product.id);\n                              }\n                            }}\n                          >\n                            <SelectTrigger className=\"text-sm\" data-testid={`select-item-${item.id}`}>\n                              <SelectValue placeholder={loadingProducts ? \"Loading items...\" : \"Select an item\"} />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {loadingProducts ? (\n                                <SelectItem value=\"loading\" disabled>Loading items...</SelectItem>\n                              ) : products.length === 0 ? (\n                                <SelectItem value=\"none\" disabled>No items available</SelectItem>\n                              ) : (\n                                products.map(product => {\n                                  const displayPrice = Number(product.purchaseRate) || Number(product.rate) || product.costPrice || product.sellingPrice || 0;\n                                  return (\n                                    <SelectItem key={product.id} value={product.name}>\n                                      {product.name} {product.usageUnit ? `(${product.usageUnit})` : ''} - {displayPrice}\n                                    </SelectItem>\n                                  );\n                                })\n                              )}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <AccountSelectDropdown\n                            value={item.account}\n                            onValueChange={(value) => updateItem(item.id, 'account', value)}\n                            placeholder=\"Select an account\"\n                            triggerClassName=\"text-sm\"\n                            testId={`select-account-${item.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Input\n                            type=\"number\"\n                            value={item.quantity}\n                            onChange={(e) => updateItem(item.id, 'quantity', parseFloat(e.target.value) || 0)}\n                            className=\"text-sm text-center\"\n                            min={0}\n                            step={0.01}\n                            data-testid={`input-quantity-${item.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Input\n                            type=\"number\"\n                            value={item.rate}\n                            onChange={(e) => updateItem(item.id, 'rate', parseFloat(e.target.value) || 0)}\n                            className=\"text-sm text-right\"\n                            min={0}\n                            step={0.01}\n                            data-testid={`input-rate-${item.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={item.tax || \"\"}\n                            onValueChange={(value) => updateItem(item.id, 'tax', value)}\n                          >\n                            <SelectTrigger className=\"text-sm\" data-testid={`select-tax-${item.id}`}>\n                              <SelectValue placeholder=\"Select a Tax\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"none\">No Tax</SelectItem>\n                              {taxes.map(tax => (\n                                <SelectItem key={tax.id} value={tax.name}>\n                                  {tax.name} ({tax.rate}%)\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={item.customerDetails || \"none\"}\n                            onValueChange={(value) => {\n                              updateItem(item.id, 'customerDetails', value);\n                            }}\n                          >\n                            <SelectTrigger className=\"text-sm\">\n                              <SelectValue placeholder=\"Select Customer\">\n                                {getCustomerDisplayName(item.customerDetails || \"none\")}\n                              </SelectValue>\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"none\">None</SelectItem>\n                              {customers.map(customer => (\n                                <SelectItem key={customer.id} value={customer.id}>\n                                  {customer.displayName || customer.name}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell className=\"text-right font-medium\">\n                          {item.amount.toFixed(2)}\n                        </TableCell>\n                        <TableCell>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            className=\"h-8 w-8 text-red-500\"\n                            onClick={() => removeItem(item.id)}\n                            data-testid={`button-remove-item-${item.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    ))\n                  )}\n                </TableBody>\n              </Table>\n              <div className=\"p-3 border-t\">\n                <DropdownMenu>\n                  <DropdownMenuTrigger asChild>\n                    <Button variant=\"outline\" size=\"sm\" className=\"gap-1.5\" data-testid=\"button-add-new-row\">\n                      <Plus className=\"h-4 w-4\" />\n                      Add New Row\n                      <ChevronDown className=\"h-3 w-3\" />\n                    </Button>\n                  </DropdownMenuTrigger>\n                  <DropdownMenuContent>\n                    <DropdownMenuItem onClick={addItem}>Add Item</DropdownMenuItem>\n                  </DropdownMenuContent>\n                </DropdownMenu>\n              </div>\n            </div>\n\n            <div className=\"flex justify-end\">\n              <div className=\"w-80 space-y-3\">\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-slate-600\">Sub Total</span>\n                  <span className=\"font-medium\">{formData.subTotal.toFixed(2)}</span>\n                </div>\n\n                <div className=\"flex justify-between items-center gap-2\">\n                  <span className=\"text-slate-600\">Discount</span>\n                  <div className=\"flex items-center gap-2\">\n                    <Input\n                      type=\"number\"\n                      value={formData.discountValue}\n                      onChange={(e) => handleDiscountChange(formData.discountType, parseFloat(e.target.value) || 0)}\n                      className=\"w-16 text-sm text-right\"\n                      min={0}\n                      data-testid=\"input-discount\"\n                    />\n                    <Select\n                      value={formData.discountType}\n                      onValueChange={(value) => handleDiscountChange(value, formData.discountValue)}\n                    >\n                      <SelectTrigger className=\"w-16\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"percent\">%</SelectItem>\n                        <SelectItem value=\"amount\"></SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <span className=\"text-pink-600 w-20 text-right\">-{formData.discountAmount.toFixed(2)}</span>\n                  </div>\n                </div>\n\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"flex items-center gap-2\">\n                    <input\n                      type=\"radio\"\n                      id=\"tds\"\n                      name=\"taxType\"\n                      value=\"TDS\"\n                      checked={formData.taxType === 'TDS'}\n                      onChange={() => setFormData(prev => ({ ...prev, taxType: 'TDS' }))}\n                    />\n                    <Label htmlFor=\"tds\">TDS</Label>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <input\n                      type=\"radio\"\n                      id=\"tcs\"\n                      name=\"taxType\"\n                      value=\"TCS\"\n                      checked={formData.taxType === 'TCS'}\n                      onChange={() => setFormData(prev => ({ ...prev, taxType: 'TCS' }))}\n                    />\n                    <Label htmlFor=\"tcs\">TCS</Label>\n                  </div>\n                  <Select\n                    value={formData.taxCategory}\n                    onValueChange={(value) => setFormData(prev => ({ ...prev, taxCategory: value }))}\n                  >\n                    <SelectTrigger className=\"flex-1\">\n                      <SelectValue placeholder=\"Select a Tax\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"none\">No Tax</SelectItem>\n                      {taxes.map(tax => (\n                        <SelectItem key={tax.id} value={tax.name}>\n                          {tax.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"flex justify-between items-center gap-2\">\n                  <span className=\"text-slate-600\">Adjustment</span>\n                  <div className=\"flex items-center gap-2\">\n                    <Input\n                      value={formData.adjustmentDescription}\n                      onChange={(e) => setFormData(prev => ({ ...prev, adjustmentDescription: e.target.value }))}\n                      placeholder=\"Description\"\n                      className=\"w-32 text-sm\"\n                    />\n                    <Input\n                      type=\"number\"\n                      value={formData.adjustment}\n                      onChange={(e) => handleAdjustmentChange(parseFloat(e.target.value) || 0)}\n                      className=\"w-24 text-sm text-right\"\n                      data-testid=\"input-adjustment\"\n                    />\n                    <Info className=\"h-4 w-4 text-slate-400\" />\n                  </div>\n                </div>\n\n                <div className=\"flex justify-between items-center pt-3 border-t font-semibold text-lg\">\n                  <span>Total</span>\n                  <span data-testid=\"text-total\">{formData.total.toFixed(2)}</span>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-6 mt-6 p-4 bg-slate-50 rounded-lg\">\n              <div>\n                <Label>Notes</Label>\n                <Textarea\n                  value={formData.notes}\n                  onChange={(e) => setFormData(prev => ({ ...prev, notes: e.target.value }))}\n                  placeholder=\"Enter notes\"\n                  className=\"mt-1 resize-none bg-white\"\n                  data-testid=\"input-notes\"\n                />\n                <p className=\"text-xs text-slate-500 mt-1\">It will not be shown in PDF</p>\n              </div>\n              <div>\n                <Label>Attach File(s) to Bill</Label>\n                <div className=\"mt-1 border-2 border-dashed border-slate-200 rounded-lg p-4 text-center bg-white\">\n                  <Button variant=\"outline\" size=\"sm\" className=\"gap-1.5\">\n                    <Upload className=\"h-4 w-4\" />\n                    Upload File\n                  </Button>\n                  <p className=\"text-xs text-slate-500 mt-2\">You can upload a maximum of 5 files, 10MB each</p>\n                </div>\n              </div>\n            </div>\n\n            <p className=\"text-sm text-slate-500\">\n              Additional Fields: Start adding custom fields for your payments made by going to Settings - Purchases - Bills.\n            </p>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-3 mt-6 p-4 bg-white rounded-lg shadow-sm border border-slate-200\">\n          <Button\n            variant=\"outline\"\n            onClick={() => handleSubmit('DRAFT')}\n            disabled={loading}\n            data-testid=\"button-save-draft\"\n          >\n            Save as Draft\n          </Button>\n          <Button\n            className=\"bg-blue-600 hover:bg-blue-700\"\n            onClick={() => handleSubmit('OPEN')}\n            disabled={loading}\n            data-testid=\"button-save-open\"\n          >\n            Save as Open\n          </Button>\n          <Button\n            variant=\"outline\"\n            onClick={() => setLocation(\"/bills\")}\n            data-testid=\"button-cancel\"\n          >\n            Cancel\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":38689,"size_tokens":null},"client/src/pages/bill-edit.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation, useParams } from \"wouter\";\nimport {\n  FileText, Plus, Trash2, ChevronDown, Search,\n  Upload, Info\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { AccountSelectDropdown } from \"@/components/AccountSelectDropdown\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\n\ninterface Vendor {\n  id: string;\n  name: string;\n  companyName?: string;\n  email?: string;\n  phone?: string;\n  gstin?: string;\n  billingAddress?: {\n    street1?: string;\n    street2?: string;\n    city?: string;\n    state?: string;\n    pinCode?: string;\n    country?: string;\n  };\n}\n\ninterface BillItem {\n  id: string;\n  itemName: string;\n  description?: string;\n  account: string;\n  quantity: number;\n  rate: number;\n  tax?: string;\n  taxAmount?: number;\n  customerDetails?: string;\n  amount: number;\n}\n\ninterface Account {\n  id: string;\n  name: string;\n  type: string;\n}\n\ninterface Tax {\n  id: string;\n  name: string;\n  rate: number;\n}\n\ninterface Product {\n  id: string;\n  name: string;\n  sku?: string;\n  type?: string;\n  unit?: string;\n  usageUnit?: string;\n  sellingPrice?: number;\n  costPrice?: number;\n  rate?: string | number;\n  purchaseRate?: string | number;\n  description?: string;\n  purchaseDescription?: string;\n  hsnCode?: string;\n  hsnSac?: string;\n  sacCode?: string;\n  taxPreference?: string;\n}\n\ninterface Customer {\n  id: string;\n  name: string;\n  displayName?: string;\n  companyName?: string;\n}\n\nexport default function BillEdit() {\n  const params = useParams();\n  const billId = params.id;\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [vendors, setVendors] = useState<Vendor[]>([]);\n  const [vendorSearchTerm, setVendorSearchTerm] = useState(\"\");\n  const [accounts, setAccounts] = useState<Account[]>([]);\n  const [taxes, setTaxes] = useState<Tax[]>([]);\n  const [products, setProducts] = useState<Product[]>([]);\n  const [customers, setCustomers] = useState<Customer[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [loadingBill, setLoadingBill] = useState(true);\n  const [loadingProducts, setLoadingProducts] = useState(true);\n\n  const [formData, setFormData] = useState({\n    vendorId: \"\",\n    vendorName: \"\",\n    vendorAddress: {\n      street1: \"\",\n      street2: \"\",\n      city: \"\",\n      state: \"\",\n      pinCode: \"\",\n      country: \"India\",\n      gstin: \"\"\n    },\n    billNumber: \"\",\n    orderNumber: \"\",\n    billDate: new Date().toISOString().split('T')[0],\n    dueDate: new Date().toISOString().split('T')[0],\n    paymentTerms: \"Due on Receipt\",\n    reverseCharge: false,\n    subject: \"\",\n    notes: \"\",\n    items: [] as BillItem[],\n    subTotal: 0,\n    discountType: \"percent\",\n    discountValue: 0,\n    discountAmount: 0,\n    taxType: \"TDS\",\n    taxCategory: \"\",\n    taxAmount: 0,\n    adjustment: 0,\n    adjustmentDescription: \"\",\n    total: 0,\n    status: \"OPEN\"\n  });\n\n  useEffect(() => {\n    fetchVendors();\n    fetchAccounts();\n    fetchTaxes();\n    fetchProducts();\n    fetchCustomers();\n    if (billId) {\n      fetchBill();\n    }\n  }, [billId]);\n\n  const fetchProducts = async () => {\n    try {\n      setLoadingProducts(true);\n      const response = await fetch('/api/items');\n      if (response.ok) {\n        const data = await response.json();\n        setProducts(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch products:', error);\n    } finally {\n      setLoadingProducts(false);\n    }\n  };\n\n  const fetchBill = async () => {\n    try {\n      const response = await fetch(`/api/bills/${billId}`);\n      if (response.ok) {\n        const data = await response.json();\n        const bill = data.data;\n        setFormData({\n          vendorId: bill.vendorId || \"\",\n          vendorName: bill.vendorName || \"\",\n          vendorAddress: bill.vendorAddress || {\n            street1: \"\",\n            street2: \"\",\n            city: \"\",\n            state: \"\",\n            pinCode: \"\",\n            country: \"India\",\n            gstin: \"\"\n          },\n          billNumber: bill.billNumber || \"\",\n          orderNumber: bill.orderNumber || \"\",\n          billDate: bill.billDate || new Date().toISOString().split('T')[0],\n          dueDate: bill.dueDate || new Date().toISOString().split('T')[0],\n          paymentTerms: bill.paymentTerms || \"Due on Receipt\",\n          reverseCharge: bill.reverseCharge || false,\n          subject: bill.subject || \"\",\n          notes: bill.notes || \"\",\n          items: bill.items || [],\n          subTotal: bill.subTotal || 0,\n          discountType: bill.discountType || \"percent\",\n          discountValue: bill.discountValue || 0,\n          discountAmount: bill.discountAmount || 0,\n          taxType: bill.taxType || \"TDS\",\n          taxCategory: bill.taxCategory || \"\",\n          taxAmount: bill.taxAmount || 0,\n          adjustment: bill.adjustment || 0,\n          adjustmentDescription: bill.adjustmentDescription || \"\",\n          total: bill.total || 0,\n          status: bill.status || \"OPEN\"\n        });\n      }\n    } catch (error) {\n      console.error('Failed to fetch bill:', error);\n      toast({ title: \"Failed to load bill\", variant: \"destructive\" });\n    } finally {\n      setLoadingBill(false);\n    }\n  };\n\n  const fetchVendors = async () => {\n    try {\n      const response = await fetch('/api/vendors');\n      if (response.ok) {\n        const data = await response.json();\n        setVendors(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch vendors:', error);\n    }\n  };\n\n  const fetchAccounts = async () => {\n    try {\n      const response = await fetch('/api/bills/accounts');\n      if (response.ok) {\n        const data = await response.json();\n        setAccounts(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch accounts:', error);\n    }\n  };\n\n  const fetchTaxes = async () => {\n    try {\n      const response = await fetch('/api/bills/taxes');\n      if (response.ok) {\n        const data = await response.json();\n        setTaxes(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch taxes:', error);\n    }\n  };\n\n  const fetchCustomers = async () => {\n    try {\n      const response = await fetch('/api/customers');\n      if (response.ok) {\n        const data = await response.json();\n        setCustomers(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch customers:', error);\n    }\n  };\n\n  const getCustomerDisplayName = (customerId: string) => {\n    if (!customerId || customerId === 'none') return 'None';\n    const customer = customers.find(c => c.id === customerId);\n    return customer ? (customer.displayName || customer.name) : 'None';\n  };\n\n  const filteredVendors = vendors.filter(vendor => {\n    const vendorName = vendor.displayName || `${vendor.firstName} ${vendor.lastName}`.trim() || vendor.companyName || \"\";\n    return vendorName.toLowerCase().includes(vendorSearchTerm.toLowerCase());\n  });\n\n  const handleVendorChange = (vendorId: string) => {\n    if (vendorId === \"__add_new_vendor__\") {\n      setLocation(\"/vendors/new\");\n      return;\n    }\n\n    const vendor = vendors.find(v => v.id === vendorId);\n    if (vendor) {\n      setFormData(prev => ({\n        ...prev,\n        vendorId: vendor.id,\n        vendorName: vendor.displayName || `${vendor.firstName} ${vendor.lastName}`.trim() || vendor.companyName || \"\",\n        vendorAddress: {\n          street1: vendor.billingAddress?.street1 || \"\",\n          street2: vendor.billingAddress?.street2 || \"\",\n          city: vendor.billingAddress?.city || \"\",\n          state: vendor.billingAddress?.state || \"\",\n          pinCode: vendor.billingAddress?.pinCode || \"\",\n          country: vendor.billingAddress?.country || \"India\",\n          gstin: vendor.gstin || \"\"\n        }\n      }));\n    }\n  };\n\n  const addItem = () => {\n    const newItem: BillItem = {\n      id: String(Date.now()),\n      itemName: \"\",\n      description: \"\",\n      account: \"\",\n      quantity: 1,\n      rate: 0,\n      tax: \"\",\n      taxAmount: 0,\n      customerDetails: \"none\",\n      amount: 0\n    };\n    setFormData(prev => ({\n      ...prev,\n      items: [...prev.items, newItem]\n    }));\n  };\n\n  const updateItem = (id: string, field: keyof BillItem, value: any) => {\n    setFormData(prev => {\n      const updatedItems = prev.items.map(item => {\n        if (item.id === id) {\n          const updatedItem = { ...item, [field]: value };\n          if (field === 'quantity' || field === 'rate') {\n            updatedItem.amount = updatedItem.quantity * updatedItem.rate;\n            if (updatedItem.tax) {\n              const taxRate = taxes.find(t => t.name === updatedItem.tax)?.rate || 0;\n              updatedItem.taxAmount = (updatedItem.amount * taxRate) / 100;\n            }\n          }\n          if (field === 'tax') {\n            const taxRate = taxes.find(t => t.name === value)?.rate || 0;\n            updatedItem.taxAmount = (updatedItem.amount * taxRate) / 100;\n          }\n          return updatedItem;\n        }\n        return item;\n      });\n\n      const subTotal = updatedItems.reduce((sum, item) => sum + item.amount, 0);\n      const taxAmount = updatedItems.reduce((sum, item) => sum + (item.taxAmount || 0), 0);\n      const discountAmount = prev.discountType === 'percent'\n        ? (subTotal * prev.discountValue) / 100\n        : prev.discountValue;\n      const total = subTotal - discountAmount + taxAmount + prev.adjustment;\n\n      return {\n        ...prev,\n        items: updatedItems,\n        subTotal,\n        taxAmount,\n        discountAmount,\n        total\n      };\n    });\n  };\n\n  const removeItem = (id: string) => {\n    setFormData(prev => {\n      const updatedItems = prev.items.filter(item => item.id !== id);\n      const subTotal = updatedItems.reduce((sum, item) => sum + item.amount, 0);\n      const taxAmount = updatedItems.reduce((sum, item) => sum + (item.taxAmount || 0), 0);\n      const discountAmount = prev.discountType === 'percent'\n        ? (subTotal * prev.discountValue) / 100\n        : prev.discountValue;\n      const total = subTotal - discountAmount + taxAmount + prev.adjustment;\n\n      return {\n        ...prev,\n        items: updatedItems,\n        subTotal,\n        taxAmount,\n        discountAmount,\n        total\n      };\n    });\n  };\n\n  const handleProductSelect = (itemId: string, productId: string) => {\n    const product = products.find(p => p.id === productId);\n    if (product) {\n      setFormData(prev => {\n        const updatedItems = prev.items.map(item => {\n          if (item.id === itemId) {\n            // For bills (purchases), use purchaseRate first, then rate, then costPrice/sellingPrice\n            const rate = Number(product.purchaseRate) || Number(product.rate) || product.costPrice || product.sellingPrice || 0;\n            const amount = item.quantity * rate;\n            return {\n              ...item,\n              itemName: product.name,\n              description: product.purchaseDescription || product.description || \"\",\n              rate: rate,\n              amount: amount\n            };\n          }\n          return item;\n        });\n\n        const subTotal = updatedItems.reduce((sum, item) => sum + item.amount, 0);\n        const taxAmount = updatedItems.reduce((sum, item) => sum + (item.taxAmount || 0), 0);\n        const discountAmount = prev.discountType === 'percent'\n          ? (subTotal * prev.discountValue) / 100\n          : prev.discountValue;\n        const total = subTotal - discountAmount + taxAmount + prev.adjustment;\n\n        return {\n          ...prev,\n          items: updatedItems,\n          subTotal,\n          taxAmount,\n          discountAmount,\n          total\n        };\n      });\n    }\n  };\n\n  const handleDiscountChange = (type: string, value: number) => {\n    setFormData(prev => {\n      const discountAmount = type === 'percent'\n        ? (prev.subTotal * value) / 100\n        : value;\n      const total = prev.subTotal - discountAmount + prev.taxAmount + prev.adjustment;\n      return {\n        ...prev,\n        discountType: type,\n        discountValue: value,\n        discountAmount,\n        total\n      };\n    });\n  };\n\n  const handleAdjustmentChange = (value: number) => {\n    setFormData(prev => {\n      const total = prev.subTotal - prev.discountAmount + prev.taxAmount + value;\n      return {\n        ...prev,\n        adjustment: value,\n        total\n      };\n    });\n  };\n\n  const handleSubmit = async () => {\n    if (!formData.vendorId) {\n      toast({ title: \"Please select a vendor\", variant: \"destructive\" });\n      return;\n    }\n    if (!formData.billNumber) {\n      toast({ title: \"Please enter a bill number\", variant: \"destructive\" });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const response = await fetch(`/api/bills/${billId}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          ...formData,\n          balanceDue: formData.total\n        })\n      });\n\n      if (response.ok) {\n        toast({ title: \"Bill updated successfully\" });\n        setLocation(\"/bills\");\n      } else {\n        throw new Error('Failed to update bill');\n      }\n    } catch (error) {\n      toast({ title: \"Failed to update bill\", variant: \"destructive\" });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (loadingBill) {\n    return (\n      <div className=\"min-h-screen bg-slate-50 flex items-center justify-center\">\n        <p className=\"text-slate-500\">Loading bill...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-slate-50\">\n      <div className=\"max-w-6xl mx-auto p-6\">\n        <div className=\"flex items-center gap-3 mb-6\">\n          <FileText className=\"h-6 w-6 text-slate-600\" />\n          <h1 className=\"text-2xl font-semibold text-slate-900\" data-testid=\"text-page-title\">Edit Bill - {formData.billNumber}</h1>\n        </div>\n\n        <div className=\"bg-white rounded-lg shadow-sm border border-slate-200 p-6\">\n          <div className=\"grid gap-6\">\n            <div className=\"grid grid-cols-2 gap-6\">\n              <div>\n                <Label className=\"text-red-600\">Vendor Name*</Label>\n                <div className=\"flex gap-2 mt-1\">\n                  <Select onValueChange={handleVendorChange} value={formData.vendorId}>\n                    <SelectTrigger className=\"flex-1\" data-testid=\"select-vendor\">\n                      <SelectValue placeholder=\"Select a Vendor\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <div className=\"p-2\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                          <Search className=\"h-4 w-4 text-gray-400\" />\n                          <Input\n                            placeholder=\"Search vendors...\"\n                            className=\"h-8\"\n                            value={vendorSearchTerm}\n                            onChange={(e) => setVendorSearchTerm(e.target.value)}\n                          />\n                        </div>\n                      </div>\n                      {filteredVendors.map(vendor => (\n                        <SelectItem key={vendor.id} value={vendor.id}>\n                          {vendor.displayName || `${vendor.firstName} ${vendor.lastName}`.trim() || vendor.companyName}\n                        </SelectItem>\n                      ))}\n                      <div className=\"border-t mt-1 pt-1\">\n                        <SelectItem\n                          value=\"__add_new_vendor__\"\n                          onSelect={() => {\n                            setLocation(\"/vendors/new\");\n                          }}\n                        >\n                          <div className=\"flex items-center gap-2 text-blue-600\">\n                            <Plus className=\"h-4 w-4\" />\n                            Add New Vendor\n                          </div>\n                        </SelectItem>\n                      </div>\n                    </SelectContent>\n                  </Select>\n                  <Button variant=\"outline\" size=\"icon\" onClick={() => setLocation(\"/vendors/new\")} data-testid=\"button-add-vendor\">\n                    <Plus className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n              <div></div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-6\">\n              <div>\n                <Label className=\"text-red-600\">Bill#*</Label>\n                <Input\n                  value={formData.billNumber}\n                  onChange={(e) => setFormData(prev => ({ ...prev, billNumber: e.target.value }))}\n                  className=\"mt-1\"\n                  data-testid=\"input-bill-number\"\n                  disabled\n                />\n              </div>\n              <div>\n                <Label>Order Number</Label>\n                <Input\n                  value={formData.orderNumber}\n                  onChange={(e) => setFormData(prev => ({ ...prev, orderNumber: e.target.value }))}\n                  className=\"mt-1\"\n                  data-testid=\"input-order-number\"\n                />\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-6\">\n              <div>\n                <Label className=\"text-red-600\">Bill Date*</Label>\n                <Input\n                  type=\"date\"\n                  value={formData.billDate}\n                  onChange={(e) => setFormData(prev => ({ ...prev, billDate: e.target.value }))}\n                  className=\"mt-1\"\n                  data-testid=\"input-bill-date\"\n                />\n              </div>\n              <div className=\"flex gap-4\">\n                <div className=\"flex-1\">\n                  <Label>Due Date</Label>\n                  <Input\n                    type=\"date\"\n                    value={formData.dueDate}\n                    onChange={(e) => setFormData(prev => ({ ...prev, dueDate: e.target.value }))}\n                    className=\"mt-1\"\n                    data-testid=\"input-due-date\"\n                  />\n                </div>\n                <div className=\"flex-1\">\n                  <Label>Payment Terms</Label>\n                  <Select\n                    value={formData.paymentTerms}\n                    onValueChange={(value) => setFormData(prev => ({ ...prev, paymentTerms: value }))}\n                  >\n                    <SelectTrigger className=\"mt-1\" data-testid=\"select-payment-terms\">\n                      <SelectValue placeholder=\"Select terms\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"Due on Receipt\">Due on Receipt</SelectItem>\n                      <SelectItem value=\"Net 15\">Net 15</SelectItem>\n                      <SelectItem value=\"Net 30\">Net 30</SelectItem>\n                      <SelectItem value=\"Net 45\">Net 45</SelectItem>\n                      <SelectItem value=\"Net 60\">Net 60</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"flex items-center gap-2\">\n              <Checkbox\n                id=\"reverse-charge\"\n                checked={formData.reverseCharge}\n                onCheckedChange={(checked) => setFormData(prev => ({ ...prev, reverseCharge: checked as boolean }))}\n              />\n              <Label htmlFor=\"reverse-charge\" className=\"text-sm\">\n                This transaction is applicable for reverse charge\n              </Label>\n            </div>\n\n            <div>\n              <Label className=\"flex items-center gap-1\">\n                Subject <Info className=\"h-3 w-3 text-slate-400\" />\n              </Label>\n              <Textarea\n                value={formData.subject}\n                onChange={(e) => setFormData(prev => ({ ...prev, subject: e.target.value }))}\n                placeholder=\"Enter a subject within 250 characters\"\n                className=\"mt-1 resize-none\"\n                maxLength={250}\n                data-testid=\"input-subject\"\n              />\n            </div>\n\n            <div className=\"flex items-center gap-2 text-sm text-slate-500\">\n              <span>At Transaction Level</span>\n              <ChevronDown className=\"h-4 w-4\" />\n            </div>\n\n            <div className=\"border rounded-lg overflow-hidden\">\n              <div className=\"bg-slate-50 px-4 py-2 flex items-center justify-between border-b\">\n                <h3 className=\"font-medium text-slate-700\">Item Table</h3>\n                <Button variant=\"link\" size=\"sm\" className=\"text-blue-600\">\n                  Bulk Actions\n                </Button>\n              </div>\n              <Table>\n                <TableHeader>\n                  <TableRow className=\"bg-slate-50\">\n                    <TableHead className=\"w-[200px] text-xs\">ITEM DETAILS</TableHead>\n                    <TableHead className=\"w-[150px] text-xs\">ACCOUNT</TableHead>\n                    <TableHead className=\"w-[100px] text-xs text-center\">QUANTITY</TableHead>\n                    <TableHead className=\"w-[100px] text-xs text-right\">RATE ()</TableHead>\n                    <TableHead className=\"w-[120px] text-xs\">TAX</TableHead>\n                    <TableHead className=\"w-[150px] text-xs\">CUSTOMER DETAILS</TableHead>\n                    <TableHead className=\"w-[100px] text-xs text-right\">AMOUNT</TableHead>\n                    <TableHead className=\"w-[50px]\"></TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {formData.items.length === 0 ? (\n                    <TableRow>\n                      <TableCell colSpan={8} className=\"text-center py-8 text-slate-500\">\n                        No items added yet. Click \"Add New Row\" to add items.\n                      </TableCell>\n                    </TableRow>\n                  ) : (\n                    formData.items.map((item) => (\n                      <TableRow key={item.id}>\n                        <TableCell>\n                          <Select\n                            value={item.itemName || \"\"}\n                            onValueChange={(value) => {\n                              const product = products.find(p => p.name === value);\n                              if (product) {\n                                handleProductSelect(item.id, product.id);\n                              }\n                            }}\n                          >\n                            <SelectTrigger className=\"text-sm\" data-testid={`select-item-${item.id}`}>\n                              <SelectValue placeholder={loadingProducts ? \"Loading items...\" : \"Select an item\"} />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {loadingProducts ? (\n                                <SelectItem value=\"loading\" disabled>Loading items...</SelectItem>\n                              ) : products.length === 0 ? (\n                                <SelectItem value=\"none\" disabled>No items available</SelectItem>\n                              ) : (\n                                products.map(product => {\n                                  const displayPrice = Number(product.purchaseRate) || Number(product.rate) || product.costPrice || product.sellingPrice || 0;\n                                  return (\n                                    <SelectItem key={product.id} value={product.name}>\n                                      {product.name} {product.usageUnit ? `(${product.usageUnit})` : ''} - {displayPrice}\n                                    </SelectItem>\n                                  );\n                                })\n                              )}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <AccountSelectDropdown\n                            value={item.account}\n                            onValueChange={(value) => updateItem(item.id, 'account', value)}\n                            placeholder=\"Select an account\"\n                            triggerClassName=\"text-sm\"\n                            testId={`select-account-${item.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Input\n                            type=\"number\"\n                            value={item.quantity}\n                            onChange={(e) => updateItem(item.id, 'quantity', parseFloat(e.target.value) || 0)}\n                            className=\"text-sm text-center\"\n                            min={0}\n                            step={0.01}\n                            data-testid={`input-quantity-${item.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Input\n                            type=\"number\"\n                            value={item.rate}\n                            onChange={(e) => updateItem(item.id, 'rate', parseFloat(e.target.value) || 0)}\n                            className=\"text-sm text-right\"\n                            min={0}\n                            step={0.01}\n                            data-testid={`input-rate-${item.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={item.tax || \"\"}\n                            onValueChange={(value) => updateItem(item.id, 'tax', value)}\n                          >\n                            <SelectTrigger className=\"text-sm\" data-testid={`select-tax-${item.id}`}>\n                              <SelectValue placeholder=\"Select a Tax\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"none\">No Tax</SelectItem>\n                              {taxes.map(tax => (\n                                <SelectItem key={tax.id} value={tax.name}>\n                                  {tax.name} ({tax.rate}%)\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={item.customerDetails || \"none\"}\n                            onValueChange={(value) => updateItem(item.id, 'customerDetails', value)}\n                          >\n                            <SelectTrigger className=\"text-sm\">\n                              <SelectValue placeholder=\"Select Customer\">\n                                {getCustomerDisplayName(item.customerDetails || \"none\")}\n                              </SelectValue>\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"none\">None</SelectItem>\n                              {customers.map(customer => (\n                                <SelectItem key={customer.id} value={customer.id}>\n                                  {customer.displayName || customer.name}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell className=\"text-right font-medium\">\n                          {item.amount.toFixed(2)}\n                        </TableCell>\n                        <TableCell>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            className=\"h-8 w-8 text-red-500\"\n                            onClick={() => removeItem(item.id)}\n                            data-testid={`button-remove-item-${item.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    ))\n                  )}\n                </TableBody>\n              </Table>\n              <div className=\"p-3 border-t\">\n                <DropdownMenu>\n                  <DropdownMenuTrigger asChild>\n                    <Button variant=\"outline\" size=\"sm\" className=\"gap-1.5\" data-testid=\"button-add-new-row\">\n                      <Plus className=\"h-4 w-4\" />\n                      Add New Row\n                      <ChevronDown className=\"h-3 w-3\" />\n                    </Button>\n                  </DropdownMenuTrigger>\n                  <DropdownMenuContent>\n                    <DropdownMenuItem onClick={addItem}>Add Item</DropdownMenuItem>\n                  </DropdownMenuContent>\n                </DropdownMenu>\n              </div>\n            </div>\n\n            <div className=\"flex justify-end\">\n              <div className=\"w-80 space-y-3\">\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-slate-600\">Sub Total</span>\n                  <span className=\"font-medium\">{formData.subTotal.toFixed(2)}</span>\n                </div>\n\n                <div className=\"flex justify-between items-center gap-2\">\n                  <span className=\"text-slate-600\">Discount</span>\n                  <div className=\"flex items-center gap-2\">\n                    <Input\n                      type=\"number\"\n                      value={formData.discountValue}\n                      onChange={(e) => handleDiscountChange(formData.discountType, parseFloat(e.target.value) || 0)}\n                      className=\"w-16 text-sm text-right\"\n                      min={0}\n                      data-testid=\"input-discount\"\n                    />\n                    <Select\n                      value={formData.discountType}\n                      onValueChange={(value) => handleDiscountChange(value, formData.discountValue)}\n                    >\n                      <SelectTrigger className=\"w-16\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"percent\">%</SelectItem>\n                        <SelectItem value=\"amount\"></SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <span className=\"text-pink-600 w-20 text-right\">-{formData.discountAmount.toFixed(2)}</span>\n                  </div>\n                </div>\n\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"flex items-center gap-2\">\n                    <input\n                      type=\"radio\"\n                      id=\"tds\"\n                      name=\"taxType\"\n                      value=\"TDS\"\n                      checked={formData.taxType === 'TDS'}\n                      onChange={() => setFormData(prev => ({ ...prev, taxType: 'TDS' }))}\n                    />\n                    <Label htmlFor=\"tds\">TDS</Label>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <input\n                      type=\"radio\"\n                      id=\"tcs\"\n                      name=\"taxType\"\n                      value=\"TCS\"\n                      checked={formData.taxType === 'TCS'}\n                      onChange={() => setFormData(prev => ({ ...prev, taxType: 'TCS' }))}\n                    />\n                    <Label htmlFor=\"tcs\">TCS</Label>\n                  </div>\n                  <Select\n                    value={formData.taxCategory}\n                    onValueChange={(value) => setFormData(prev => ({ ...prev, taxCategory: value }))}\n                  >\n                    <SelectTrigger className=\"flex-1\">\n                      <SelectValue placeholder=\"Select a Tax\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"none\">No Tax</SelectItem>\n                      {taxes.map(tax => (\n                        <SelectItem key={tax.id} value={tax.name}>\n                          {tax.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"flex justify-between items-center gap-2\">\n                  <span className=\"text-slate-600\">Adjustment</span>\n                  <div className=\"flex items-center gap-2\">\n                    <Input\n                      value={formData.adjustmentDescription}\n                      onChange={(e) => setFormData(prev => ({ ...prev, adjustmentDescription: e.target.value }))}\n                      placeholder=\"Description\"\n                      className=\"w-32 text-sm\"\n                    />\n                    <Input\n                      type=\"number\"\n                      value={formData.adjustment}\n                      onChange={(e) => handleAdjustmentChange(parseFloat(e.target.value) || 0)}\n                      className=\"w-24 text-sm text-right\"\n                      data-testid=\"input-adjustment\"\n                    />\n                    <Info className=\"h-4 w-4 text-slate-400\" />\n                  </div>\n                </div>\n\n                <div className=\"flex justify-between items-center pt-3 border-t font-semibold text-lg\">\n                  <span>Total</span>\n                  <span data-testid=\"text-total\">{formData.total.toFixed(2)}</span>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-6 mt-6 p-4 bg-slate-50 rounded-lg\">\n              <div>\n                <Label>Notes</Label>\n                <Textarea\n                  value={formData.notes}\n                  onChange={(e) => setFormData(prev => ({ ...prev, notes: e.target.value }))}\n                  placeholder=\"Enter notes\"\n                  className=\"mt-1 resize-none bg-white\"\n                  data-testid=\"input-notes\"\n                />\n                <p className=\"text-xs text-slate-500 mt-1\">It will not be shown in PDF</p>\n              </div>\n              <div>\n                <Label>Attach File(s) to Bill</Label>\n                <div className=\"mt-1 border-2 border-dashed border-slate-200 rounded-lg p-4 text-center bg-white\">\n                  <Button variant=\"outline\" size=\"sm\" className=\"gap-1.5\">\n                    <Upload className=\"h-4 w-4\" />\n                    Upload File\n                  </Button>\n                  <p className=\"text-xs text-slate-500 mt-2\">You can upload a maximum of 5 files, 10MB each</p>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-3 mt-6 p-4 bg-white rounded-lg shadow-sm border border-slate-200\">\n          <Button\n            className=\"bg-blue-600 hover:bg-blue-700\"\n            onClick={handleSubmit}\n            disabled={loading}\n            data-testid=\"button-save\"\n          >\n            Save Changes\n          </Button>\n          <Button\n            variant=\"outline\"\n            onClick={() => setLocation(\"/bills\")}\n            data-testid=\"button-cancel\"\n          >\n            Cancel\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":35985,"size_tokens":null},"client/src/components/ManageSalespersonsDialog.tsx":{"content":"import { useState, useEffect } from \"react\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Search, Plus, Trash2, X } from \"lucide-react\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\n\r\ninterface Salesperson {\r\n    id: string;\r\n    name: string;\r\n    email: string;\r\n}\r\n\r\ninterface ManageSalespersonsDialogProps {\r\n    open: boolean;\r\n    onOpenChange: (open: boolean) => void;\r\n    onSalespersonChange?: () => void;\r\n}\r\n\r\nexport function ManageSalespersonsDialog({ open, onOpenChange, onSalespersonChange }: ManageSalespersonsDialogProps) {\r\n    const { toast } = useToast();\r\n    const [salespersons, setSalespersons] = useState<Salesperson[]>([]);\r\n    const [searchQuery, setSearchQuery] = useState(\"\");\r\n    const [showAddForm, setShowAddForm] = useState(false);\r\n    const [newSalesperson, setNewSalesperson] = useState({ name: \"\", email: \"\" });\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (open) {\r\n            fetchSalespersons();\r\n        }\r\n    }, [open]);\r\n\r\n    const fetchSalespersons = async () => {\r\n        try {\r\n            const response = await fetch('/api/salespersons');\r\n            if (response.ok) {\r\n                const data = await response.json();\r\n                setSalespersons(data.data || []);\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to fetch salespersons:', error);\r\n        }\r\n    };\r\n\r\n    const handleAddSalesperson = async () => {\r\n        if (!newSalesperson.name) {\r\n            toast({ title: \"Name is required\", variant: \"destructive\" });\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        try {\r\n            const response = await fetch('/api/salespersons', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(newSalesperson)\r\n            });\r\n\r\n            if (response.ok) {\r\n                toast({ title: \"Salesperson added successfully\" });\r\n                setNewSalesperson({ name: \"\", email: \"\" });\r\n                setShowAddForm(false);\r\n                fetchSalespersons();\r\n                if (onSalespersonChange) onSalespersonChange();\r\n            } else {\r\n                toast({ title: \"Failed to add salesperson\", variant: \"destructive\" });\r\n            }\r\n        } catch (error) {\r\n            console.error('Error adding salesperson:', error);\r\n            toast({ title: \"Error adding salesperson\", variant: \"destructive\" });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDeleteSalesperson = async (id: string) => {\r\n        try {\r\n            const response = await fetch(`/api/salespersons/${id}`, {\r\n                method: 'DELETE'\r\n            });\r\n\r\n            if (response.ok) {\r\n                toast({ title: \"Salesperson deleted successfully\" });\r\n                fetchSalespersons();\r\n                if (onSalespersonChange) onSalespersonChange();\r\n            } else {\r\n                toast({ title: \"Failed to delete salesperson\", variant: \"destructive\" });\r\n            }\r\n        } catch (error) {\r\n            console.error('Error deleting salesperson:', error);\r\n            toast({ title: \"Error deleting salesperson\", variant: \"destructive\" });\r\n        }\r\n    };\r\n\r\n    const filteredSalespersons = salespersons.filter(sp =>\r\n        sp.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        sp.email.toLowerCase().includes(searchQuery.toLowerCase())\r\n    );\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"max-w-2xl z-[9999]\">\r\n                <DialogHeader>\r\n                    <DialogTitle>Manage Salespersons</DialogTitle>\r\n                </DialogHeader>\r\n\r\n                <div className=\"space-y-4\">\r\n                    <div className=\"flex items-center justify-between gap-4\">\r\n                        <div className=\"relative flex-1\">\r\n                            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n                            <Input\r\n                                placeholder=\"Search Salesperson\"\r\n                                className=\"pl-9\"\r\n                                value={searchQuery}\r\n                                onChange={(e) => setSearchQuery(e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <Button className=\"bg-blue-600 hover:bg-blue-700\" onClick={() => setShowAddForm(true)}>\r\n                            <Plus className=\"h-4 w-4 mr-2\" /> New Salesperson\r\n                        </Button>\r\n                    </div>\r\n\r\n                    {showAddForm && (\r\n                        <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200 space-y-4 animate-in slide-in-from-top-2\">\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-sm font-medium\">Name*</label>\r\n                                    <Input\r\n                                        value={newSalesperson.name}\r\n                                        onChange={(e) => setNewSalesperson(prev => ({ ...prev, name: e.target.value }))}\r\n                                        placeholder=\"Enter name\"\r\n                                    />\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-sm font-medium\">Email</label>\r\n                                    <Input\r\n                                        value={newSalesperson.email}\r\n                                        onChange={(e) => setNewSalesperson(prev => ({ ...prev, email: e.target.value }))}\r\n                                        placeholder=\"Enter email\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"flex justify-end gap-2\">\r\n                                <Button variant=\"ghost\" size=\"sm\" onClick={() => setShowAddForm(false)}>Cancel</Button>\r\n                                <Button size=\"sm\" onClick={handleAddSalesperson} disabled={loading}>Save</Button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"border rounded-lg overflow-hidden\">\r\n                        <div className=\"bg-slate-50 px-4 py-2 border-b grid grid-cols-12 gap-4 text-xs font-medium text-slate-500 uppercase\">\r\n                            <div className=\"col-span-1 flex items-center justify-center\">\r\n                                <Checkbox />\r\n                            </div>\r\n                            <div className=\"col-span-5\">Salesperson Name</div>\r\n                            <div className=\"col-span-5\">Email</div>\r\n                            <div className=\"col-span-1\"></div>\r\n                        </div>\r\n                        <div className=\"max-h-[300px] overflow-y-auto divide-y\">\r\n                            {filteredSalespersons.length === 0 ? (\r\n                                <div className=\"p-8 text-center text-slate-500 text-sm\">\r\n                                    No salespersons found. Add a new salesperson to get started.\r\n                                </div>\r\n                            ) : (\r\n                                filteredSalespersons.map(sp => (\r\n                                    <div key={sp.id} className=\"px-4 py-3 grid grid-cols-12 gap-4 items-center hover:bg-slate-50 group\">\r\n                                        <div className=\"col-span-1 flex items-center justify-center\">\r\n                                            <Checkbox />\r\n                                        </div>\r\n                                        <div className=\"col-span-5 text-sm font-medium\">{sp.name}</div>\r\n                                        <div className=\"col-span-5 text-sm text-slate-500\">{sp.email}</div>\r\n                                        <div className=\"col-span-1 flex justify-end opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                            <Button\r\n                                                variant=\"ghost\"\r\n                                                size=\"icon\"\r\n                                                className=\"h-8 w-8 text-red-500 hover:text-red-700 hover:bg-red-50\"\r\n                                                onClick={() => handleDeleteSalesperson(sp.id)}\r\n                                            >\r\n                                                <Trash2 className=\"h-4 w-4\" />\r\n                                            </Button>\r\n                                        </div>\r\n                                    </div>\r\n                                ))\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","path":null,"size_bytes":9328,"size_tokens":null},"client/src/pages/credit-note-create.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { ArrowLeft, Plus, Trash2, Search, X, HelpCircle, AlertCircle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTransactionBootstrap } from \"@/hooks/use-transaction-bootstrap\";\nimport { formatAddressDisplay } from \"@/lib/customer-snapshot\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Badge } from \"@/components/ui/badge\";\n\ninterface Customer {\n  id: string;\n  name: string;\n  displayName?: string;\n  email?: string;\n  billingAddress?: any;\n  gstin?: string;\n  placeOfSupply?: string;\n}\n\ninterface Item {\n  id: string;\n  name: string;\n  type: string;\n  unit: string;\n  sellingPrice: number;\n  hsnSac?: string;\n  description?: string;\n}\n\ninterface Salesperson {\n  id: string;\n  name: string;\n  email?: string;\n}\n\ninterface LineItem {\n  id: string;\n  itemId: string;\n  name: string;\n  description: string;\n  account: string;\n  quantity: number;\n  rate: number;\n  discount: number;\n  discountType: string;\n  tax: number;\n  taxName: string;\n  amount: number;\n}\n\nconst INDIAN_STATES = [\n  \"Andhra Pradesh\", \"Arunachal Pradesh\", \"Assam\", \"Bihar\", \"Chhattisgarh\",\n  \"Goa\", \"Gujarat\", \"Haryana\", \"Himachal Pradesh\", \"Jharkhand\", \"Karnataka\",\n  \"Kerala\", \"Madhya Pradesh\", \"Maharashtra\", \"Manipur\", \"Meghalaya\", \"Mizoram\",\n  \"Nagaland\", \"Odisha\", \"Punjab\", \"Rajasthan\", \"Sikkim\", \"Tamil Nadu\",\n  \"Telangana\", \"Tripura\", \"Uttar Pradesh\", \"Uttarakhand\", \"West Bengal\",\n  \"Andaman and Nicobar Islands\", \"Chandigarh\", \"Dadra and Nagar Haveli\",\n  \"Daman and Diu\", \"Delhi\", \"Jammu and Kashmir\", \"Ladakh\", \"Lakshadweep\", \"Puducherry\"\n];\n\nconst TAX_OPTIONS = [\n  { value: \"none\", label: \"None\", rate: 0 },\n  { value: \"GST0\", label: \"GST 0%\", rate: 0 },\n  { value: \"GST5\", label: \"GST 5%\", rate: 5 },\n  { value: \"GST12\", label: \"GST 12%\", rate: 12 },\n  { value: \"GST18\", label: \"GST 18%\", rate: 18 },\n  { value: \"GST28\", label: \"GST 28%\", rate: 28 },\n  { value: \"IGST0\", label: \"IGST 0%\", rate: 0 },\n  { value: \"IGST5\", label: \"IGST 5%\", rate: 5 },\n  { value: \"IGST12\", label: \"IGST 12%\", rate: 12 },\n  { value: \"IGST18\", label: \"IGST 18%\", rate: 18 },\n  { value: \"IGST28\", label: \"IGST 28%\", rate: 28 },\n];\n\nexport default function CreditNoteCreate() {\n  const [location, setLocation] = useLocation();\n  const { toast } = useToast();\n  \n  // Transaction bootstrap for auto-population\n  const {\n    customerId: bootstrapCustomerId,\n    customerSnapshot,\n    taxRegime,\n    isLoadingCustomer,\n    customerError,\n    formData: bootstrapFormData,\n    onCustomerChange\n  } = useTransactionBootstrap({ transactionType: 'credit_note' });\n\n  const [customers, setCustomers] = useState<Customer[]>([]);\n  const [items, setItems] = useState<Item[]>([]);\n  const [salespersons, setSalespersons] = useState<Salesperson[]>([]);\n  const [nextCreditNoteNumber, setNextCreditNoteNumber] = useState(\"\");\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const [customerId, setCustomerId] = useState(\"\");\n  const [customerName, setCustomerName] = useState(\"\");\n  const [reason, setReason] = useState(\"\");\n  const [creditNoteNumber, setCreditNoteNumber] = useState(\"\");\n  const [referenceNumber, setReferenceNumber] = useState(\"\");\n  const [creditNoteDate, setCreditNoteDate] = useState(new Date().toISOString().split('T')[0]);\n  const [salesperson, setSalesperson] = useState(\"\");\n  const [subject, setSubject] = useState(\"\");\n  const [billingAddress, setBillingAddress] = useState({\n    street: \"\", city: \"\", state: \"\", country: \"India\", pincode: \"\"\n  });\n  const [gstin, setGstin] = useState(\"\");\n  const [placeOfSupply, setPlaceOfSupply] = useState(\"\");\n  \n  // Sync with bootstrap customer\n  useEffect(() => {\n    if (bootstrapCustomerId && !customerId) {\n      setCustomerId(bootstrapCustomerId);\n    }\n  }, [bootstrapCustomerId]);\n  \n  // Update form data when customer snapshot changes\n  useEffect(() => {\n    if (customerSnapshot) {\n      setCustomerName(customerSnapshot.displayName || customerSnapshot.customerName);\n      if (customerSnapshot.billingAddress) {\n        setBillingAddress(customerSnapshot.billingAddress);\n      }\n      if (customerSnapshot.gstin) setGstin(customerSnapshot.gstin);\n      if (customerSnapshot.placeOfSupply) setPlaceOfSupply(customerSnapshot.placeOfSupply);\n    }\n  }, [customerSnapshot]);\n\n  const [lineItems, setLineItems] = useState<LineItem[]>([\n    { id: \"1\", itemId: \"\", name: \"\", description: \"\", account: \"\", quantity: 1, rate: 0, discount: 0, discountType: \"percentage\", tax: 0, taxName: \"none\", amount: 0 }\n  ]);\n\n  const [subTotal, setSubTotal] = useState(0);\n  const [shippingCharges, setShippingCharges] = useState(0);\n  const [tdsType, setTdsType] = useState(\"TDS\");\n  const [tdsTax, setTdsTax] = useState(\"\");\n  const [adjustment, setAdjustment] = useState(0);\n  const [total, setTotal] = useState(0);\n  const [customerNotes, setCustomerNotes] = useState(\"\");\n  const [termsAndConditions, setTermsAndConditions] = useState(\"\");\n\n  const [salespersonDialogOpen, setSalespersonDialogOpen] = useState(false);\n  const [newSalespersonName, setNewSalespersonName] = useState(\"\");\n  const [newSalespersonEmail, setNewSalespersonEmail] = useState(\"\");\n  const [fromInvoiceId, setFromInvoiceId] = useState<string | null>(null);\n  const [fromInvoiceNumber, setFromInvoiceNumber] = useState<string | null>(null);\n\n  useEffect(() => {\n    fetchData();\n    // Check for fromInvoice parameter\n    const params = new URLSearchParams(location.split('?')[1]);\n    const invoiceId = params.get('fromInvoice');\n    if (invoiceId) {\n      setFromInvoiceId(invoiceId);\n      fetchInvoiceData(invoiceId);\n    }\n  }, [location]);\n  \n  const fetchInvoiceData = async (invoiceId: string) => {\n    try {\n      const response = await fetch(`/api/invoices/${invoiceId}`);\n      if (response.ok) {\n        const data = await response.json();\n        const invoice = data.data;\n        \n        // Pre-populate form with invoice data\n        setFromInvoiceNumber(invoice.invoiceNumber);\n        setCustomerId(invoice.customerId);\n        setCustomerName(invoice.customerName);\n        if (invoice.billingAddress) {\n          setBillingAddress(invoice.billingAddress);\n        }\n        if (invoice.placeOfSupply) setPlaceOfSupply(invoice.placeOfSupply);\n        setSubject(`Credit Note for Invoice #${invoice.invoiceNumber}`);\n        setReason(\"sales_return\");\n        if (invoice.salesperson) setSalesperson(invoice.salesperson);\n        \n        // Pre-populate items from invoice\n        if (invoice.items && invoice.items.length > 0) {\n          const invoiceItems: LineItem[] = invoice.items.map((item: any, index: number) => ({\n            id: String(index + 1),\n            itemId: item.itemId || \"\",\n            name: item.name || \"\",\n            description: item.description || \"\",\n            account: item.account || \"Sales\",\n            quantity: item.quantity || 1,\n            rate: item.rate || 0,\n            discount: item.discount || 0,\n            discountType: item.discountType || \"percentage\",\n            tax: item.tax || 0,\n            taxName: item.taxName || \"GST18\",\n            amount: (item.quantity || 1) * (item.rate || 0) - (item.discount || 0)\n          }));\n          setLineItems(invoiceItems);\n        }\n      }\n    } catch (error) {\n      console.error('Failed to fetch invoice data:', error);\n      toast({ title: \"Error\", description: \"Failed to load invoice data\", variant: \"destructive\" });\n    }\n  };\n\n  useEffect(() => {\n    calculateTotals();\n  }, [lineItems, shippingCharges, adjustment]);\n\n  const fetchData = async () => {\n    try {\n      const [customersRes, itemsRes, salespersonsRes, nextNumberRes] = await Promise.all([\n        fetch('/api/customers'),\n        fetch('/api/items'),\n        fetch('/api/salespersons'),\n        fetch('/api/credit-notes/next-number')\n      ]);\n\n      const customersData = await customersRes.json();\n      const itemsData = await itemsRes.json();\n      const salespersonsData = await salespersonsRes.json();\n      const nextNumberData = await nextNumberRes.json();\n\n      if (customersData.success) setCustomers(customersData.data);\n      if (itemsData.success) setItems(itemsData.data);\n      if (salespersonsData.success) setSalespersons(salespersonsData.data);\n      if (nextNumberData.success) {\n        setNextCreditNoteNumber(nextNumberData.data);\n        setCreditNoteNumber(nextNumberData.data);\n      }\n    } catch (error) {\n      toast({ title: \"Error\", description: \"Failed to load data\", variant: \"destructive\" });\n    }\n  };\n\n  const handleCustomerChange = (customerId: string) => {\n    const customer = customers.find(c => c.id === customerId);\n    if (customer) {\n      setCustomerId(customer.id);\n      setCustomerName(customer.displayName || customer.name);\n      if (customer.billingAddress) {\n        setBillingAddress(customer.billingAddress);\n      }\n      if (customer.gstin) setGstin(customer.gstin);\n      if (customer.placeOfSupply) setPlaceOfSupply(customer.placeOfSupply);\n    }\n  };\n\n  const handleItemChange = (lineItemId: string, itemId: string) => {\n    const item = items.find(i => i.id === itemId);\n    if (item) {\n      updateLineItem(lineItemId, {\n        itemId: item.id,\n        name: item.name,\n        description: item.description || \"\",\n        rate: item.sellingPrice || 0,\n        amount: (item.sellingPrice || 0) * 1\n      });\n    }\n  };\n\n  const updateLineItem = (id: string, updates: Partial<LineItem>) => {\n    setLineItems(prev => prev.map(item => {\n      if (item.id === id) {\n        const updated = { ...item, ...updates };\n        const quantity = updated.quantity || 0;\n        const rate = updated.rate || 0;\n        const discount = updated.discount || 0;\n        const discountType = updated.discountType || 'percentage';\n        \n        let discountAmount = discountType === 'percentage' \n          ? (quantity * rate * discount / 100) \n          : discount;\n        \n        updated.amount = quantity * rate - discountAmount;\n        return updated;\n      }\n      return item;\n    }));\n  };\n\n  const addLineItem = () => {\n    const newId = String(Date.now());\n    setLineItems(prev => [...prev, {\n      id: newId, itemId: \"\", name: \"\", description: \"\", account: \"\", quantity: 1, rate: 0, discount: 0, discountType: \"percentage\", tax: 0, taxName: \"none\", amount: 0\n    }]);\n  };\n\n  const removeLineItem = (id: string) => {\n    if (lineItems.length > 1) {\n      setLineItems(prev => prev.filter(item => item.id !== id));\n    }\n  };\n\n  const calculateTotals = () => {\n    const subTotalAmount = lineItems.reduce((sum, item) => sum + item.amount, 0);\n    setSubTotal(subTotalAmount);\n    setTotal(subTotalAmount + shippingCharges + adjustment);\n  };\n\n  const handleAddSalesperson = async () => {\n    if (!newSalespersonName.trim()) return;\n    try {\n      const response = await fetch('/api/salespersons', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ name: newSalespersonName, email: newSalespersonEmail })\n      });\n      const data = await response.json();\n      if (data.success) {\n        setSalespersons(prev => [...prev, data.data]);\n        setSalesperson(data.data.name);\n        setSalespersonDialogOpen(false);\n        setNewSalespersonName(\"\");\n        setNewSalespersonEmail(\"\");\n        toast({ title: \"Success\", description: \"Salesperson added successfully\" });\n      }\n    } catch (error) {\n      toast({ title: \"Error\", description: \"Failed to add salesperson\", variant: \"destructive\" });\n    }\n  };\n\n  const handleSubmit = async (status: string) => {\n    if (!customerId) {\n      toast({ title: \"Error\", description: \"Please select a customer\", variant: \"destructive\" });\n      return;\n    }\n\n    setIsSubmitting(true);\n    try {\n      const response = await fetch('/api/credit-notes', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          customerId,\n          customerName,\n          reason,\n          referenceNumber,\n          date: creditNoteDate,\n          salesperson,\n          subject,\n          billingAddress,\n          gstin,\n          placeOfSupply,\n          items: lineItems,\n          subTotal,\n          shippingCharges,\n          tdsType,\n          tdsAmount: 0,\n          cgst: 0,\n          sgst: 0,\n          igst: 0,\n          adjustment,\n          total,\n          customerNotes,\n          termsAndConditions,\n          status\n        })\n      });\n\n      const data = await response.json();\n      if (data.success) {\n        toast({ title: \"Success\", description: \"Credit note created successfully\" });\n        setLocation('/credit-notes');\n      } else {\n        toast({ title: \"Error\", description: data.message || \"Failed to create credit note\", variant: \"destructive\" });\n      }\n    } catch (error) {\n      toast({ title: \"Error\", description: \"Failed to create credit note\", variant: \"destructive\" });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"max-w-5xl mx-auto p-4 pb-24\">\n      <div className=\"flex items-center gap-4 mb-6\">\n        <Button variant=\"ghost\" size=\"icon\" onClick={() => setLocation('/credit-notes')} data-testid=\"button-back\">\n          <ArrowLeft className=\"h-4 w-4\" />\n        </Button>\n        <h1 className=\"text-2xl font-bold\" data-testid=\"text-page-title\">New Credit Note</h1>\n        {fromInvoiceNumber && (\n          <Badge className=\"bg-blue-100 text-blue-700 border-blue-200\">\n            From Invoice #{fromInvoiceNumber}\n          </Badge>\n        )}\n      </div>\n\n      <div className=\"space-y-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <div>\n            <Label className=\"text-red-500\">Customer Name*</Label>\n            <div className=\"flex gap-2\">\n              <Select value={customerId} onValueChange={handleCustomerChange}>\n                <SelectTrigger className=\"flex-1\" data-testid=\"select-customer\">\n                  <SelectValue placeholder=\"Select or add a customer\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {customers.map(customer => (\n                    <SelectItem key={customer.id} value={customer.id}>{customer.displayName || customer.name}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              <Button variant=\"default\" size=\"icon\" data-testid=\"button-search-customer\">\n                <Search className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n          <div>\n            <Label>Reason</Label>\n            <Select value={reason} onValueChange={setReason}>\n              <SelectTrigger data-testid=\"select-reason\">\n                <SelectValue placeholder=\"Select a reason\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"sales_return\">Sales Return</SelectItem>\n                <SelectItem value=\"post_sale_discount\">Post Sale Discount</SelectItem>\n                <SelectItem value=\"deficiency_in_services\">Deficiency in Services</SelectItem>\n                <SelectItem value=\"correction_in_invoice\">Correction in Invoice</SelectItem>\n                <SelectItem value=\"change_in_pos\">Change in POS</SelectItem>\n                <SelectItem value=\"finalization_of_amount\">Finalization of Provisional Assessment</SelectItem>\n                <SelectItem value=\"others\">Others</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <div>\n            <Label className=\"text-red-500\">Credit Note#*</Label>\n            <div className=\"flex items-center gap-2\">\n              <Input value={creditNoteNumber} onChange={(e) => setCreditNoteNumber(e.target.value)} data-testid=\"input-credit-note-number\" />\n              <Button variant=\"ghost\" size=\"icon\">\n                <HelpCircle className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n          <div>\n            <Label>Reference#</Label>\n            <Input value={referenceNumber} onChange={(e) => setReferenceNumber(e.target.value)} data-testid=\"input-reference-number\" />\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <div>\n            <Label className=\"text-red-500\">Credit Note Date*</Label>\n            <Input type=\"date\" value={creditNoteDate} onChange={(e) => setCreditNoteDate(e.target.value)} data-testid=\"input-credit-note-date\" />\n          </div>\n          <div>\n            <Label>Salesperson</Label>\n            <div className=\"flex gap-2\">\n              <Select value={salesperson} onValueChange={setSalesperson}>\n                <SelectTrigger className=\"flex-1\" data-testid=\"select-salesperson\">\n                  <SelectValue placeholder=\"Select or Add Salesperson\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {salespersons.map(sp => (\n                    <SelectItem key={sp.id} value={sp.name}>{sp.name}</SelectItem>\n                  ))}\n                  <div className=\"border-t my-1\" />\n                  <Button \n                    variant=\"ghost\" \n                    className=\"w-full justify-start text-blue-600\" \n                    onClick={() => setSalespersonDialogOpen(true)}\n                    data-testid=\"button-add-salesperson\"\n                  >\n                    <Plus className=\"h-4 w-4 mr-2\" /> Add Salesperson\n                  </Button>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </div>\n\n        <div>\n          <Label className=\"flex items-center gap-1\">Subject <HelpCircle className=\"h-3 w-3 text-slate-400\" /></Label>\n          <Textarea \n            value={subject} \n            onChange={(e) => setSubject(e.target.value)} \n            placeholder=\"Let your customer know what this Credit Note is for\"\n            className=\"resize-none\"\n            data-testid=\"input-subject\"\n          />\n        </div>\n\n        <div className=\"border border-slate-200 dark:border-slate-700 rounded-md\">\n          <div className=\"flex items-center justify-between px-4 py-3 bg-slate-50 dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700\">\n            <h3 className=\"font-medium\">Item Table</h3>\n            <Button variant=\"link\" size=\"sm\" className=\"text-blue-600\">Bulk Actions</Button>\n          </div>\n          \n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead>\n                <tr className=\"text-xs font-medium text-slate-500 uppercase border-b border-slate-200 dark:border-slate-700\">\n                  <th className=\"px-4 py-3 text-left w-8\"></th>\n                  <th className=\"px-4 py-3 text-left\">Item Details</th>\n                  <th className=\"px-4 py-3 text-left\">Account</th>\n                  <th className=\"px-4 py-3 text-right\">Quantity</th>\n                  <th className=\"px-4 py-3 text-right\">Rate</th>\n                  <th className=\"px-4 py-3 text-right\">Discount</th>\n                  <th className=\"px-4 py-3 text-left\">Tax(%)</th>\n                  <th className=\"px-4 py-3 text-right\">Amount</th>\n                  <th className=\"px-4 py-3 w-10\"></th>\n                </tr>\n              </thead>\n              <tbody>\n                {lineItems.map((item, index) => (\n                  <tr key={item.id} className=\"border-b border-slate-200 dark:border-slate-700\">\n                    <td className=\"px-4 py-3 text-slate-400\">{index + 1}</td>\n                    <td className=\"px-4 py-3\">\n                      <Select value={item.itemId} onValueChange={(val) => handleItemChange(item.id, val)}>\n                        <SelectTrigger className=\"w-48\" data-testid={`select-item-${index}`}>\n                          <SelectValue placeholder=\"Type or click to select an Item.\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {items.map(i => (\n                            <SelectItem key={i.id} value={i.id}>\n                              {i.name} - {i.sellingPrice || 0}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <Select value={item.account} onValueChange={(val) => updateLineItem(item.id, { account: val })}>\n                        <SelectTrigger className=\"w-32\" data-testid={`select-account-${index}`}>\n                          <SelectValue placeholder=\"Select an account\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"sales\">Sales</SelectItem>\n                          <SelectItem value=\"service\">Service Revenue</SelectItem>\n                          <SelectItem value=\"other\">Other Income</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <Input \n                        type=\"number\" \n                        value={item.quantity} \n                        onChange={(e) => updateLineItem(item.id, { quantity: parseFloat(e.target.value) || 0 })}\n                        className=\"w-20 text-right\"\n                        data-testid={`input-quantity-${index}`}\n                      />\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <Input \n                        type=\"number\" \n                        value={item.rate} \n                        onChange={(e) => updateLineItem(item.id, { rate: parseFloat(e.target.value) || 0 })}\n                        className=\"w-24 text-right\"\n                        data-testid={`input-rate-${index}`}\n                      />\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <div className=\"flex items-center gap-1\">\n                        <Input \n                          type=\"number\" \n                          value={item.discount} \n                          onChange={(e) => updateLineItem(item.id, { discount: parseFloat(e.target.value) || 0 })}\n                          className=\"w-16 text-right\"\n                          data-testid={`input-discount-${index}`}\n                        />\n                        <span className=\"text-slate-500\">%</span>\n                      </div>\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <Select \n                        value={item.taxName} \n                        onValueChange={(val) => {\n                          const taxOption = TAX_OPTIONS.find(t => t.value === val);\n                          updateLineItem(item.id, { taxName: val, tax: taxOption?.rate || 0 });\n                        }}\n                      >\n                        <SelectTrigger className=\"w-28\" data-testid={`select-tax-${index}`}>\n                          <SelectValue placeholder=\"Select a Tax\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {TAX_OPTIONS.map(tax => (\n                            <SelectItem key={tax.value} value={tax.value}>{tax.label}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </td>\n                    <td className=\"px-4 py-3 text-right font-medium\">{item.amount.toFixed(2)}</td>\n                    <td className=\"px-4 py-3\">\n                      <Button \n                        variant=\"ghost\" \n                        size=\"icon\" \n                        onClick={() => removeLineItem(item.id)}\n                        className=\"text-red-500\"\n                        disabled={lineItems.length === 1}\n                        data-testid={`button-remove-item-${index}`}\n                      >\n                        <X className=\"h-4 w-4\" />\n                      </Button>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n\n          <div className=\"px-4 py-3 border-t border-slate-200 dark:border-slate-700 flex gap-4\">\n            <Button variant=\"link\" className=\"text-blue-600 gap-1\" onClick={addLineItem} data-testid=\"button-add-row\">\n              <Plus className=\"h-4 w-4\" /> Add New Row\n            </Button>\n            <Button variant=\"link\" className=\"text-blue-600 gap-1\" data-testid=\"button-add-bulk\">\n              <Plus className=\"h-4 w-4\" /> Add Items in Bulk\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <div>\n            <Label>Customer Notes</Label>\n            <Textarea \n              value={customerNotes} \n              onChange={(e) => setCustomerNotes(e.target.value)} \n              placeholder=\"Will be displayed on the credit note\"\n              className=\"resize-none\"\n              data-testid=\"input-customer-notes\"\n            />\n          </div>\n          <div className=\"space-y-3\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-slate-600\">Sub Total</span>\n              <span className=\"font-medium\">{subTotal.toFixed(2)}</span>\n            </div>\n            <div className=\"flex justify-between items-center gap-2\">\n              <span className=\"text-slate-600\">Shipping Charges</span>\n              <div className=\"flex items-center gap-1\">\n                <Input \n                  type=\"number\" \n                  value={shippingCharges} \n                  onChange={(e) => setShippingCharges(parseFloat(e.target.value) || 0)}\n                  className=\"w-24 text-right\"\n                  data-testid=\"input-shipping-charges\"\n                />\n                <HelpCircle className=\"h-4 w-4 text-slate-400\" />\n              </div>\n            </div>\n            <div className=\"flex justify-between items-center gap-2\">\n              <RadioGroup value={tdsType} onValueChange={setTdsType} className=\"flex gap-4\">\n                <div className=\"flex items-center gap-2\">\n                  <RadioGroupItem value=\"TDS\" id=\"tds\" />\n                  <Label htmlFor=\"tds\">TDS</Label>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <RadioGroupItem value=\"TCS\" id=\"tcs\" />\n                  <Label htmlFor=\"tcs\">TCS</Label>\n                </div>\n              </RadioGroup>\n              <Select value={tdsTax} onValueChange={setTdsTax}>\n                <SelectTrigger className=\"w-32\" data-testid=\"select-tds-tax\">\n                  <SelectValue placeholder=\"Select a Tax\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"none\">None</SelectItem>\n                  <SelectItem value=\"tds1\">TDS 1%</SelectItem>\n                  <SelectItem value=\"tds2\">TDS 2%</SelectItem>\n                </SelectContent>\n              </Select>\n              <span className=\"w-20 text-right\">- 0.00</span>\n            </div>\n            <div className=\"flex justify-between items-center gap-2\">\n              <span className=\"text-slate-600\">Adjustment</span>\n              <div className=\"flex items-center gap-1\">\n                <Input \n                  type=\"number\" \n                  value={adjustment} \n                  onChange={(e) => setAdjustment(parseFloat(e.target.value) || 0)}\n                  className=\"w-24 text-right\"\n                  data-testid=\"input-adjustment\"\n                />\n                <HelpCircle className=\"h-4 w-4 text-slate-400\" />\n              </div>\n              <span className=\"w-20 text-right\">{adjustment.toFixed(2)}</span>\n            </div>\n            <div className=\"flex justify-between items-center pt-3 border-t border-slate-200 dark:border-slate-700\">\n              <span className=\"font-semibold\">Total (  )</span>\n              <span className=\"font-bold text-lg\">{total.toFixed(2)}</span>\n            </div>\n          </div>\n        </div>\n\n        <div>\n          <Label>Terms & Conditions</Label>\n          <Textarea \n            value={termsAndConditions} \n            onChange={(e) => setTermsAndConditions(e.target.value)} \n            placeholder=\"Enter the terms and conditions of your business to be displayed in your transaction\"\n            className=\"resize-none min-h-[100px]\"\n            data-testid=\"input-terms\"\n          />\n        </div>\n\n        <div className=\"text-sm text-slate-500\">\n          Additional Fields: Start adding custom fields for your credit notes by going to Settings &gt; Sales &gt; Credit Notes.\n        </div>\n      </div>\n\n      <div className=\"fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-700 px-4 py-3 flex items-center gap-3\">\n        <span className=\"text-slate-500 mr-auto\"></span>\n        <Button variant=\"outline\" onClick={() => handleSubmit('DRAFT')} disabled={isSubmitting} data-testid=\"button-save-draft\">\n          Save as Draft\n        </Button>\n        <Button onClick={() => handleSubmit('OPEN')} disabled={isSubmitting} data-testid=\"button-save-open\">\n          Save as Open\n        </Button>\n        <Button variant=\"ghost\" onClick={() => setLocation('/credit-notes')} data-testid=\"button-cancel\">\n          Cancel\n        </Button>\n      </div>\n\n      <Dialog open={salespersonDialogOpen} onOpenChange={setSalespersonDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Add Salesperson</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <Label>Name *</Label>\n              <Input \n                value={newSalespersonName} \n                onChange={(e) => setNewSalespersonName(e.target.value)} \n                placeholder=\"Enter salesperson name\"\n                data-testid=\"input-new-salesperson-name\"\n              />\n            </div>\n            <div>\n              <Label>Email</Label>\n              <Input \n                type=\"email\"\n                value={newSalespersonEmail} \n                onChange={(e) => setNewSalespersonEmail(e.target.value)} \n                placeholder=\"Enter email (optional)\"\n                data-testid=\"input-new-salesperson-email\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setSalespersonDialogOpen(false)}>Cancel</Button>\n            <Button onClick={handleAddSalesperson} data-testid=\"button-confirm-add-salesperson\">Add</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":31423,"size_tokens":null},"client/src/pages/credit-notes.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { \n  Plus, \n  Search, \n  Filter, \n  MoreHorizontal, \n  Pencil, \n  Trash2, \n  ChevronDown,\n  X,\n  Send,\n  FileText,\n  Printer,\n  ChevronLeft,\n  ChevronRight\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { usePagination } from \"@/hooks/use-pagination\";\nimport { TablePagination } from \"@/components/table-pagination\";\nimport { Input } from \"@/components/ui/input\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface CreditNoteListItem {\n  id: string;\n  date: string;\n  creditNoteNumber: string;\n  referenceNumber: string;\n  customerName: string;\n  invoiceNumber: string;\n  status: string;\n  total: number;\n  creditsRemaining: number;\n}\n\ninterface CreditNoteItem {\n  id: string;\n  itemId: string;\n  name: string;\n  description: string;\n  account: string;\n  quantity: number;\n  rate: number;\n  discount: number;\n  discountType: string;\n  tax: number;\n  taxName: string;\n  amount: number;\n}\n\ninterface CreditNoteDetail {\n  id: string;\n  creditNoteNumber: string;\n  referenceNumber: string;\n  date: string;\n  customerId: string;\n  customerName: string;\n  invoiceId: string;\n  invoiceNumber: string;\n  reason: string;\n  salesperson: string;\n  subject: string;\n  billingAddress: {\n    street: string;\n    city: string;\n    state: string;\n    country: string;\n    pincode: string;\n  };\n  gstin: string;\n  placeOfSupply: string;\n  items: CreditNoteItem[];\n  subTotal: number;\n  shippingCharges: number;\n  tdsType: string;\n  tdsAmount: number;\n  cgst: number;\n  sgst: number;\n  igst: number;\n  adjustment: number;\n  total: number;\n  creditsRemaining: number;\n  customerNotes: string;\n  termsAndConditions: string;\n  status: string;\n  pdfTemplate: string;\n  createdAt: string;\n  createdBy: string;\n}\n\nconst formatCurrency = (amount: number) => {\n  return `${amount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n};\n\nconst formatDate = (dateString: string) => {\n  if (!dateString) return '-';\n  const date = new Date(dateString);\n  return date.toLocaleDateString('en-IN', { day: '2-digit', month: '2-digit', year: 'numeric' });\n};\n\nconst formatAddress = (address: any) => {\n  if (!address) return ['-'];\n  const parts = [address.street, address.city, address.state, address.country, address.pincode].filter(Boolean);\n  return parts.length > 0 ? parts : ['-'];\n};\n\nconst getStatusBadgeStyles = (status: string) => {\n  const statusLower = status?.toLowerCase() || '';\n  if (statusLower === 'closed' || statusLower === 'applied') {\n    return 'bg-green-100 text-green-700 border-green-200';\n  }\n  if (statusLower === 'open' || statusLower === 'draft') {\n    return 'bg-amber-100 text-amber-700 border-amber-200';\n  }\n  if (statusLower === 'void') {\n    return 'bg-red-100 text-red-700 border-red-200';\n  }\n  return 'bg-slate-100 text-slate-600 border-slate-200';\n};\n\nfunction CreditNotePdfPreview({ creditNote }: { creditNote: CreditNoteDetail }) {\n  return (\n    <div id=\"pdf-content\" className=\"bg-white p-8 text-black min-h-full\" style={{ fontFamily: 'Arial, sans-serif' }}>\n      <div className=\"max-w-3xl mx-auto\">\n        <div className=\"relative mb-8\">\n          {creditNote.status === 'CLOSED' && (\n            <div className=\"absolute top-0 left-0 transform -rotate-12\">\n              <span className=\"inline-block bg-green-500 text-white px-4 py-1 text-sm font-bold rounded\">CLOSED</span>\n            </div>\n          )}\n          <div className=\"flex justify-between items-start border-b-2 border-green-600 pb-4\">\n            <div>\n              <h1 className=\"text-xl font-bold text-green-700\">SkilltonIT</h1>\n              <p className=\"text-sm text-gray-600\">Hinjewadi - Wakad road</p>\n              <p className=\"text-sm text-gray-600\">Pune Maharashtra 411057</p>\n              <p className=\"text-sm text-gray-600\">India</p>\n              <p className=\"text-sm text-gray-600\">GSTIN: 27A3CPA51SK1Z8</p>\n            </div>\n            <div className=\"text-right\">\n              <h2 className=\"text-2xl font-bold text-green-700\">CREDIT NOTE</h2>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-8 mb-6\">\n          <div>\n            <div className=\"text-sm mb-2\">\n              <span className=\"text-gray-500\">#</span>\n              <span className=\"ml-2 font-medium\">{creditNote.creditNoteNumber}</span>\n            </div>\n            <div className=\"text-sm mb-2\">\n              <span className=\"text-gray-500\">Credit Date</span>\n              <span className=\"ml-2\">: {formatDate(creditNote.date)}</span>\n            </div>\n            <div className=\"text-sm\">\n              <span className=\"text-gray-500\">Ref</span>\n              <span className=\"ml-2\">: {creditNote.referenceNumber || '-'}</span>\n            </div>\n          </div>\n          <div className=\"text-right\">\n            <div className=\"text-sm mb-2\">\n              <span className=\"text-gray-500\">Place Of Supply</span>\n              <span className=\"ml-2\">{creditNote.placeOfSupply || '-'}</span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"mb-6\">\n          <h3 className=\"text-sm font-semibold text-gray-500 uppercase mb-2\">Bill To</h3>\n          <p className=\"font-semibold text-blue-600\">{creditNote.customerName}</p>\n          <div className=\"text-sm text-gray-600\">\n            {formatAddress(creditNote.billingAddress).map((line, i) => (\n              <p key={i}>{line}</p>\n            ))}\n          </div>\n          {creditNote.gstin && <p className=\"text-sm text-gray-600\">GSTIN: {creditNote.gstin}</p>}\n        </div>\n\n        <table className=\"w-full mb-6 text-sm\">\n          <thead>\n            <tr className=\"bg-gray-100 border-b border-gray-300\">\n              <th className=\"px-3 py-2 text-left font-semibold\">#</th>\n              <th className=\"px-3 py-2 text-left font-semibold\">Item & Description</th>\n              <th className=\"px-3 py-2 text-left font-semibold\">HSN/SAC</th>\n              <th className=\"px-3 py-2 text-right font-semibold\">Qty</th>\n              <th className=\"px-3 py-2 text-right font-semibold\">Rate</th>\n              <th className=\"px-3 py-2 text-right font-semibold\">Amount</th>\n            </tr>\n          </thead>\n          <tbody>\n            {creditNote.items.map((item, index) => (\n              <tr key={item.id} className=\"border-b border-gray-200\">\n                <td className=\"px-3 py-2\">{index + 1}</td>\n                <td className=\"px-3 py-2\">\n                  <p className=\"font-medium\">{item.name}</p>\n                  {item.description && <p className=\"text-gray-600 text-xs\">{item.description}</p>}\n                </td>\n                <td className=\"px-3 py-2\">-</td>\n                <td className=\"px-3 py-2 text-right\">{item.quantity}</td>\n                <td className=\"px-3 py-2 text-right\">{formatCurrency(item.rate)}</td>\n                <td className=\"px-3 py-2 text-right font-medium\">{formatCurrency(item.amount)}</td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n\n        <div className=\"flex justify-end mb-8\">\n          <div className=\"w-72\">\n            <div className=\"flex justify-between py-2 border-b border-gray-200\">\n              <span className=\"text-gray-600\">Sub Total</span>\n              <span className=\"font-medium\">{formatCurrency(creditNote.subTotal)}</span>\n            </div>\n            {creditNote.cgst > 0 && (\n              <div className=\"flex justify-between py-2 border-b border-gray-200\">\n                <span className=\"text-gray-600\">CGST 9%</span>\n                <span className=\"font-medium\">{formatCurrency(creditNote.cgst)}</span>\n              </div>\n            )}\n            {creditNote.sgst > 0 && (\n              <div className=\"flex justify-between py-2 border-b border-gray-200\">\n                <span className=\"text-gray-600\">SGST 9%</span>\n                <span className=\"font-medium\">{formatCurrency(creditNote.sgst)}</span>\n              </div>\n            )}\n            <div className=\"flex justify-between py-3 font-bold\">\n              <span>Total</span>\n              <span>{formatCurrency(creditNote.total)}</span>\n            </div>\n            <div className=\"flex justify-between py-2 bg-amber-50 px-2\">\n              <span className=\"font-medium\">Credits Remaining</span>\n              <span className=\"font-bold text-amber-600\">{formatCurrency(creditNote.creditsRemaining)}</span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"mt-12 pt-4 text-right text-sm text-gray-500\">\n          <p>Authorized Signature</p>\n        </div>\n      </div>\n    </div>\n  );\n}\n\ninterface CreditNoteDetailPanelProps {\n  creditNote: CreditNoteDetail;\n  onClose: () => void;\n  onEdit: () => void;\n  onDelete: () => void;\n}\n\nfunction CreditNoteDetailPanel({ creditNote, onClose, onEdit, onDelete }: CreditNoteDetailPanelProps) {\n  const [showPdfPreview, setShowPdfPreview] = useState(true);\n\n  const handlePrint = () => {\n    const printContent = document.getElementById('pdf-content');\n    if (printContent) {\n      const printWindow = window.open('', '_blank');\n      if (printWindow) {\n        printWindow.document.write(`\n          <html>\n            <head>\n              <title>${creditNote.creditNoteNumber} - Credit Note</title>\n              <style>\n                body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }\n                table { width: 100%; border-collapse: collapse; }\n                th, td { padding: 8px 12px; text-align: left; }\n                th { background-color: #f3f4f6; }\n                .text-right { text-align: right; }\n                .font-medium { font-weight: 500; }\n                .font-bold { font-weight: 700; }\n                @media print { body { padding: 0; } }\n              </style>\n            </head>\n            <body>${printContent.innerHTML}</body>\n          </html>\n        `);\n        printWindow.document.close();\n        printWindow.print();\n      }\n    }\n  };\n\n  return (\n    <div className=\"h-full flex flex-col bg-white dark:bg-slate-900 border-l border-slate-200 dark:border-slate-700\">\n      <div className=\"flex items-center justify-between gap-2 px-4 py-3 border-b border-slate-200 dark:border-slate-700\">\n        <div className=\"flex items-center gap-3 min-w-0\">\n          <h2 className=\"text-lg font-semibold text-slate-900 dark:text-white truncate\" data-testid=\"text-credit-note-number\">\n            {creditNote.creditNoteNumber}\n          </h2>\n        </div>\n        <div className=\"flex items-center gap-1 flex-shrink-0\">\n          <Button variant=\"ghost\" size=\"icon\" onClick={onClose} data-testid=\"button-close-panel\">\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"flex items-center gap-2 px-4 py-2 border-b border-slate-200 dark:border-slate-700 overflow-x-auto flex-wrap\">\n        <Button variant=\"ghost\" size=\"sm\" className=\"gap-1.5\" onClick={onEdit} data-testid=\"button-edit-credit-note\">\n          <Pencil className=\"h-3.5 w-3.5\" />\n          Edit\n        </Button>\n        <Button variant=\"ghost\" size=\"sm\" className=\"gap-1.5\" data-testid=\"button-send-email\">\n          <Send className=\"h-3.5 w-3.5\" />\n          Email\n        </Button>\n        <Button \n          variant=\"ghost\" \n          size=\"sm\" \n          className=\"gap-1.5 text-blue-600\" \n          onClick={() => window.location.href = `/e-way-bills?creditNoteId=${creditNote.id}`}\n          data-testid=\"button-add-eway-bill\"\n        >\n          <FileText className=\"h-3.5 w-3.5\" />\n          Add e-Way Bill Details\n        </Button>\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" size=\"sm\" className=\"gap-1.5\" data-testid=\"button-pdf-print\">\n              <FileText className=\"h-3.5 w-3.5\" />\n              PDF/Print\n              <ChevronDown className=\"h-3 w-3\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"start\">\n            <DropdownMenuItem onClick={handlePrint}>\n              <Printer className=\"mr-2 h-4 w-4\" /> Print\n            </DropdownMenuItem>\n            <DropdownMenuItem>\n              <FileText className=\"mr-2 h-4 w-4\" /> Download PDF\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-more-options\">\n              <MoreHorizontal className=\"h-4 w-4\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\">\n            <DropdownMenuItem>Clone</DropdownMenuItem>\n            <DropdownMenuSeparator />\n            <DropdownMenuItem onClick={onDelete} className=\"text-destructive focus:text-destructive\">\n              <Trash2 className=\"mr-2 h-4 w-4\" /> Delete\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n      </div>\n\n      <div className=\"flex-1 overflow-auto\">\n        <div className=\"bg-slate-100 dark:bg-slate-800 p-4\">\n          <div className=\"bg-white rounded-md shadow-sm p-2\">\n            <CreditNotePdfPreview creditNote={creditNote} />\n          </div>\n        </div>\n\n        <div className=\"p-4 border-t border-slate-200 dark:border-slate-700\">\n          <h3 className=\"text-sm font-medium text-slate-900 dark:text-white mb-3\">More Information</h3>\n          <div className=\"text-sm text-slate-600 dark:text-slate-400\">\n            <div className=\"flex justify-between py-2 border-b border-slate-100 dark:border-slate-700\">\n              <span>Salesperson</span>\n              <span className=\"text-blue-600\">{creditNote.salesperson || '-'}</span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"p-4 border-t border-slate-200 dark:border-slate-700\">\n          <h3 className=\"text-sm font-medium text-slate-900 dark:text-white mb-3\">Journal</h3>\n          <p className=\"text-xs text-slate-500 mb-2\">Amount is displayed in your base currency <Badge variant=\"secondary\">INR</Badge></p>\n          \n          <h4 className=\"text-sm font-medium mb-2\">Credit Note</h4>\n          <table className=\"w-full text-xs\">\n            <thead>\n              <tr className=\"border-b border-slate-200 dark:border-slate-700\">\n                <th className=\"text-left py-2 font-medium text-slate-500\">ACCOUNT</th>\n                <th className=\"text-right py-2 font-medium text-slate-500\">DEBIT</th>\n                <th className=\"text-right py-2 font-medium text-slate-500\">CREDIT</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr className=\"border-b border-slate-100 dark:border-slate-700\">\n                <td className=\"py-2\">Accounts Receivable</td>\n                <td className=\"text-right py-2\">{formatCurrency(0)}</td>\n                <td className=\"text-right py-2\">{formatCurrency(0)}</td>\n              </tr>\n              <tr className=\"border-b border-slate-100 dark:border-slate-700\">\n                <td className=\"py-2\">Output SGST</td>\n                <td className=\"text-right py-2\">{formatCurrency(0)}</td>\n                <td className=\"text-right py-2\">{formatCurrency(0)}</td>\n              </tr>\n              <tr className=\"border-b border-slate-100 dark:border-slate-700\">\n                <td className=\"py-2\">Output CGST</td>\n                <td className=\"text-right py-2\">{formatCurrency(0)}</td>\n                <td className=\"text-right py-2\">{formatCurrency(0)}</td>\n              </tr>\n              <tr className=\"border-b border-slate-100 dark:border-slate-700\">\n                <td className=\"py-2\">Sales</td>\n                <td className=\"text-right py-2\">{formatCurrency(0)}</td>\n                <td className=\"text-right py-2\">{formatCurrency(0)}</td>\n              </tr>\n              <tr className=\"font-medium\">\n                <td className=\"py-2\"></td>\n                <td className=\"text-right py-2\">{formatCurrency(0)}</td>\n                <td className=\"text-right py-2\">{formatCurrency(0)}</td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default function CreditNotes() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [creditNotes, setCreditNotes] = useState<CreditNoteListItem[]>([]);\n  const [selectedCreditNote, setSelectedCreditNote] = useState<CreditNoteDetail | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [creditNoteToDelete, setCreditNoteToDelete] = useState<string | null>(null);\n  const [activeFilter, setActiveFilter] = useState(\"all\");\n\n  useEffect(() => {\n    fetchCreditNotes();\n  }, []);\n\n  const fetchCreditNotes = async () => {\n    try {\n      const response = await fetch('/api/credit-notes');\n      const data = await response.json();\n      if (data.success) {\n        setCreditNotes(data.data);\n      }\n    } catch (error) {\n      toast({ title: \"Error\", description: \"Failed to fetch credit notes\", variant: \"destructive\" });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const fetchCreditNoteDetail = async (id: string) => {\n    try {\n      const response = await fetch(`/api/credit-notes/${id}`);\n      const data = await response.json();\n      if (data.success) {\n        setSelectedCreditNote(data.data);\n      }\n    } catch (error) {\n      toast({ title: \"Error\", description: \"Failed to fetch credit note details\", variant: \"destructive\" });\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!creditNoteToDelete) return;\n    try {\n      const response = await fetch(`/api/credit-notes/${creditNoteToDelete}`, { method: 'DELETE' });\n      const data = await response.json();\n      if (data.success) {\n        toast({ title: \"Success\", description: \"Credit note deleted successfully\" });\n        fetchCreditNotes();\n        if (selectedCreditNote?.id === creditNoteToDelete) {\n          setSelectedCreditNote(null);\n        }\n      }\n    } catch (error) {\n      toast({ title: \"Error\", description: \"Failed to delete credit note\", variant: \"destructive\" });\n    } finally {\n      setDeleteDialogOpen(false);\n      setCreditNoteToDelete(null);\n    }\n  };\n\n  const filteredCreditNotes = creditNotes.filter(cn => {\n    const matchesSearch = \n      cn.creditNoteNumber.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      cn.customerName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      cn.referenceNumber?.toLowerCase().includes(searchQuery.toLowerCase());\n    \n    if (activeFilter === \"all\") return matchesSearch;\n    return matchesSearch && cn.status.toLowerCase() === activeFilter.toLowerCase();\n  });\n\n  const { currentPage, totalPages, totalItems, itemsPerPage, paginatedItems, goToPage } = usePagination(filteredCreditNotes, 10);\n\n  const toggleSelect = (id: string) => {\n    const newSelected = new Set(selectedIds);\n    if (newSelected.has(id)) {\n      newSelected.delete(id);\n    } else {\n      newSelected.add(id);\n    }\n    setSelectedIds(newSelected);\n  };\n\n  const toggleSelectAll = () => {\n    if (selectedIds.size === filteredCreditNotes.length) {\n      setSelectedIds(new Set());\n    } else {\n      setSelectedIds(new Set(filteredCreditNotes.map(cn => cn.id)));\n    }\n  };\n\n  return (\n    <div className=\"h-full flex\">\n      <div className={`flex-1 flex flex-col min-w-0 ${selectedCreditNote ? 'hidden lg:flex lg:w-1/2' : ''}`}>\n        <div className=\"flex items-center justify-between gap-4 p-4 border-b border-slate-200 dark:border-slate-700\">\n          <div className=\"flex items-center gap-2\">\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"ghost\" className=\"gap-2 text-lg font-semibold\" data-testid=\"dropdown-filter\">\n                  All Credit Notes\n                  <ChevronDown className=\"h-4 w-4\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"start\">\n                <DropdownMenuItem onClick={() => setActiveFilter(\"all\")}>All Credit Notes</DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setActiveFilter(\"open\")}>Open</DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setActiveFilter(\"closed\")}>Closed</DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setActiveFilter(\"void\")}>Void</DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button onClick={() => setLocation('/credit-notes/create')} className=\"gap-2\" data-testid=\"button-new-credit-note\">\n              <Plus className=\"h-4 w-4\" /> New\n            </Button>\n            <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-more-actions\">\n              <MoreHorizontal className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"overflow-auto flex-1\">\n          <table className=\"w-full\">\n            <thead className=\"bg-slate-50 dark:bg-slate-800 sticky top-0\">\n              <tr className=\"text-left text-xs font-medium text-slate-500 uppercase\">\n                <th className=\"px-4 py-3 w-10\">\n                  <Checkbox \n                    checked={selectedIds.size === filteredCreditNotes.length && filteredCreditNotes.length > 0}\n                    onCheckedChange={toggleSelectAll}\n                    data-testid=\"checkbox-select-all\"\n                  />\n                </th>\n                <th className=\"px-4 py-3\">Date</th>\n                <th className=\"px-4 py-3\">Credit Note#</th>\n                <th className=\"px-4 py-3\">Reference Number</th>\n                <th className=\"px-4 py-3\">Customer Name</th>\n                <th className=\"px-4 py-3\">Invoice#</th>\n                <th className=\"px-4 py-3\">Status</th>\n                <th className=\"px-4 py-3 text-right\">Amount</th>\n                <th className=\"px-4 py-3 text-right\">Balance</th>\n                <th className=\"px-4 py-3 w-10\">\n                  <Search className=\"h-4 w-4 text-slate-400\" />\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-slate-200 dark:divide-slate-700\">\n              {isLoading ? (\n                <tr>\n                  <td colSpan={10} className=\"px-4 py-8 text-center text-slate-500\">Loading...</td>\n                </tr>\n              ) : filteredCreditNotes.length === 0 ? (\n                <tr>\n                  <td colSpan={10} className=\"px-4 py-8 text-center text-slate-500\">No credit notes found</td>\n                </tr>\n              ) : (\n                paginatedItems.map((cn) => (\n                  <tr \n                    key={cn.id} \n                    className={`hover-elevate cursor-pointer ${selectedCreditNote?.id === cn.id ? 'bg-blue-50 dark:bg-blue-900/20' : ''}`}\n                    onClick={() => fetchCreditNoteDetail(cn.id)}\n                    data-testid={`row-credit-note-${cn.id}`}\n                  >\n                    <td className=\"px-4 py-3\" onClick={(e) => e.stopPropagation()}>\n                      <Checkbox \n                        checked={selectedIds.has(cn.id)}\n                        onCheckedChange={() => toggleSelect(cn.id)}\n                      />\n                    </td>\n                    <td className=\"px-4 py-3 text-sm\">{formatDate(cn.date)}</td>\n                    <td className=\"px-4 py-3 text-sm text-blue-600 font-medium\">{cn.creditNoteNumber}</td>\n                    <td className=\"px-4 py-3 text-sm\">{cn.referenceNumber || '-'}</td>\n                    <td className=\"px-4 py-3 text-sm\">{cn.customerName}</td>\n                    <td className=\"px-4 py-3 text-sm\">{cn.invoiceNumber || '-'}</td>\n                    <td className=\"px-4 py-3\">\n                      <Badge className={getStatusBadgeStyles(cn.status)}>\n                        {cn.status}\n                      </Badge>\n                    </td>\n                    <td className=\"px-4 py-3 text-sm text-right\">{formatCurrency(cn.total)}</td>\n                    <td className=\"px-4 py-3 text-sm text-right\">{formatCurrency(cn.creditsRemaining)}</td>\n                    <td className=\"px-4 py-3\"></td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n          {filteredCreditNotes.length > 0 && (\n            <TablePagination\n              currentPage={currentPage}\n              totalPages={totalPages}\n              totalItems={totalItems}\n              itemsPerPage={itemsPerPage}\n              onPageChange={goToPage}\n            />\n          )}\n        </div>\n      </div>\n\n      {selectedCreditNote && (\n        <div className=\"w-full lg:w-1/2 border-l border-slate-200 dark:border-slate-700\">\n          <CreditNoteDetailPanel\n            creditNote={selectedCreditNote}\n            onClose={() => setSelectedCreditNote(null)}\n            onEdit={() => setLocation(`/credit-notes/${selectedCreditNote.id}/edit`)}\n            onDelete={() => {\n              setCreditNoteToDelete(selectedCreditNote.id);\n              setDeleteDialogOpen(true);\n            }}\n          />\n        </div>\n      )}\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Credit Note?</AlertDialogTitle>\n            <AlertDialogDescription>\n              This action cannot be undone. This will permanently delete the credit note.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={handleDelete} className=\"bg-destructive text-destructive-foreground\">\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":26670,"size_tokens":null},"client/src/modules/sales/pages/QuoteEditPage.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useLocation, useRoute } from \"wouter\";\nimport { Plus, X, Search, Upload, Pencil, ArrowLeft, Loader2, FileText, Trash2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { ManageSalespersonsDialog } from \"@/components/ManageSalespersonsDialog\";\n\ninterface AttachedFile {\n  id: string;\n  name: string;\n  size: number;\n  type: string;\n  data?: string;\n}\n\ninterface Customer {\n  id: string;\n  name: string;\n  email: string;\n  billingAddress: any;\n  shippingAddress: any;\n}\n\ninterface Item {\n  id: string;\n  name: string;\n  description: string;\n  rate: string;\n  hsnSac: string;\n}\n\ninterface QuoteItem {\n  id: string;\n  itemId: string;\n  name: string;\n  description: string;\n  quantity: number;\n  rate: number;\n  discount: number;\n  discountType: string;\n  tax: string;\n  amount: number;\n}\n\nconst taxOptions = [\n  { value: \"none\", label: \"No Tax\" },\n  { value: \"GST0\", label: \"GST (0%)\" },\n  { value: \"GST5\", label: \"GST (5%)\" },\n  { value: \"GST12\", label: \"GST (12%)\" },\n  { value: \"GST18\", label: \"GST (18%)\" },\n  { value: \"GST28\", label: \"GST (28%)\" },\n];\n\nconst getTaxRate = (taxValue: string): number => {\n  const rates: Record<string, number> = {\n    \"none\": 0,\n    \"GST0\": 0,\n    \"GST5\": 5,\n    \"GST12\": 12,\n    \"GST18\": 18,\n    \"GST28\": 28,\n  };\n  return rates[taxValue] || 0;\n};\n\nconst getTaxValueFromRate = (rate: number): string => {\n  const rateMap: Record<number, string> = {\n    0: \"none\",\n    5: \"GST5\",\n    12: \"GST12\",\n    18: \"GST18\",\n    28: \"GST28\",\n  };\n  return rateMap[rate] || \"none\";\n};\n\nexport default function QuoteEditPage() {\n  const [, estimateParams] = useRoute(\"/estimates/:id/edit\");\n  const [, quoteParams] = useRoute(\"/quotes/:id/edit\");\n  const quoteId = estimateParams?.id || quoteParams?.id;\n  const isFromEstimates = !!estimateParams?.id;\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [customers, setCustomers] = useState<Customer[]>([]);\n  const [items, setItems] = useState<Item[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [initialLoading, setInitialLoading] = useState(true);\n  const [showManageSalespersons, setShowManageSalespersons] = useState(false);\n  const [salespersons, setSalespersons] = useState<{ id: string; name: string }[]>([]);\n  const [attachedFiles, setAttachedFiles] = useState<AttachedFile[]>([]);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const [formData, setFormData] = useState({\n    customerId: \"\",\n    customerName: \"\",\n    quoteNumber: \"\",\n    referenceNumber: \"\",\n    quoteDate: new Date().toISOString().split('T')[0],\n    expiryDate: \"\",\n    salesperson: \"\",\n    projectName: \"\",\n    subject: \"\",\n    customerNotes: \"Looking forward for your business.\",\n    termsAndConditions: \"\",\n    shippingCharges: 0,\n    tdsType: \"\",\n    adjustment: 0,\n    adjustmentDescription: \"\",\n    status: \"DRAFT\",\n  });\n\n  const [quoteItems, setQuoteItems] = useState<QuoteItem[]>([\n    {\n      id: \"1\",\n      itemId: \"\",\n      name: \"\",\n      description: \"\",\n      quantity: 1,\n      rate: 0,\n      discount: 0,\n      discountType: \"percentage\",\n      tax: \"none\",\n      amount: 0,\n    }\n  ]);\n\n  useEffect(() => {\n    fetchCustomers();\n    fetchItems();\n    fetchSalespersons();\n  }, []);\n\n  useEffect(() => {\n    if (quoteId) {\n      fetchQuoteData();\n    }\n  }, [quoteId]);\n\n  const fetchSalespersons = async () => {\n    try {\n      const response = await fetch('/api/salespersons');\n      if (response.ok) {\n        const data = await response.json();\n        setSalespersons(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch salespersons:', error);\n    }\n  };\n\n  const fetchCustomers = async () => {\n    try {\n      const response = await fetch('/api/customers');\n      if (response.ok) {\n        const data = await response.json();\n        setCustomers(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch customers:', error);\n    }\n  };\n\n  const fetchItems = async () => {\n    try {\n      const response = await fetch('/api/items');\n      if (response.ok) {\n        const data = await response.json();\n        setItems(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch items:', error);\n    }\n  };\n\n  const fetchQuoteData = async () => {\n    try {\n      const response = await fetch(`/api/quotes/${quoteId}`);\n      if (response.ok) {\n        const data = await response.json();\n        const quote = data.data;\n\n        setFormData({\n          customerId: quote.customerId || \"\",\n          customerName: quote.customerName || \"\",\n          quoteNumber: quote.quoteNumber || \"\",\n          referenceNumber: quote.referenceNumber || \"\",\n          quoteDate: quote.date || new Date().toISOString().split('T')[0],\n          expiryDate: quote.expiryDate || \"\",\n          salesperson: quote.salesperson || \"\",\n          projectName: quote.projectName || \"\",\n          subject: quote.subject || \"\",\n          customerNotes: quote.customerNotes || \"Looking forward for your business.\",\n          termsAndConditions: quote.termsAndConditions || \"\",\n          shippingCharges: quote.shippingCharges || 0,\n          tdsType: quote.tdsType || \"\",\n          adjustment: quote.adjustment || 0,\n          adjustmentDescription: quote.adjustmentDescription || \"\",\n          status: quote.status || \"DRAFT\",\n        });\n\n        if (quote.items && quote.items.length > 0) {\n          setQuoteItems(quote.items.map((item: any) => ({\n            id: item.id || String(Date.now()),\n            itemId: item.itemId || \"\",\n            name: item.name || \"\",\n            description: item.description || \"\",\n            quantity: item.quantity || 1,\n            rate: item.rate || 0,\n            discount: item.discount || 0,\n            discountType: item.discountType || \"percentage\",\n            tax: item.taxName || getTaxValueFromRate(item.tax || 0),\n            amount: item.amount || 0,\n          })));\n        }\n\n        if (quote.attachments && quote.attachments.length > 0) {\n          setAttachedFiles(quote.attachments.map((att: any) => ({\n            id: att.id || String(Date.now()),\n            name: att.name,\n            size: att.size || 0,\n            type: att.type || 'application/octet-stream',\n            data: att.data\n          })));\n        }\n      } else {\n        toast({\n          title: \"Error\",\n          description: \"Failed to load quote data\",\n          variant: \"destructive\",\n        });\n        setLocation(isFromEstimates ? '/estimates' : '/quotes');\n      }\n    } catch (error) {\n      console.error('Failed to fetch quote:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to load quote data\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setInitialLoading(false);\n    }\n  };\n\n  const handleCustomerChange = (customerId: string) => {\n    const customer = customers.find(c => c.id === customerId);\n    if (customer) {\n      setFormData(prev => ({\n        ...prev,\n        customerId,\n        customerName: customer.name\n      }));\n    }\n  };\n\n  const handleItemChange = (index: number, itemId: string) => {\n    const item = items.find(i => i.id === itemId);\n    if (item) {\n      const updatedItems = [...quoteItems];\n      const rate = parseFloat(item.rate.replace(/[,]/g, '')) || 0;\n      updatedItems[index] = {\n        ...updatedItems[index],\n        itemId,\n        name: item.name,\n        description: item.description || '',\n        rate,\n        amount: rate * updatedItems[index].quantity\n      };\n      setQuoteItems(updatedItems);\n    }\n  };\n\n  const updateQuoteItem = (index: number, field: string, value: any) => {\n    const updatedItems = [...quoteItems];\n    updatedItems[index] = { ...updatedItems[index], [field]: value };\n\n    const quantity = updatedItems[index].quantity;\n    const rate = updatedItems[index].rate;\n    const discount = updatedItems[index].discount;\n    const discountType = updatedItems[index].discountType;\n\n    let subtotal = quantity * rate;\n    if (discountType === 'percentage') {\n      subtotal = subtotal - (subtotal * discount / 100);\n    } else {\n      subtotal = subtotal - discount;\n    }\n\n    updatedItems[index].amount = Math.max(0, subtotal);\n    setQuoteItems(updatedItems);\n  };\n\n  const addNewRow = () => {\n    setQuoteItems([\n      ...quoteItems,\n      {\n        id: String(Date.now()),\n        itemId: \"\",\n        name: \"\",\n        description: \"\",\n        quantity: 1,\n        rate: 0,\n        discount: 0,\n        discountType: \"percentage\",\n        tax: \"none\",\n        amount: 0,\n      }\n    ]);\n  };\n\n  const removeRow = (index: number) => {\n    if (quoteItems.length > 1) {\n      setQuoteItems(quoteItems.filter((_, i) => i !== index));\n    }\n  };\n\n  const calculateSubTotal = () => {\n    return quoteItems.reduce((sum, item) => sum + item.amount, 0);\n  };\n\n  const calculateTax = () => {\n    return quoteItems.reduce((sum, item) => {\n      const taxRate = getTaxRate(item.tax);\n      return sum + (item.amount * taxRate / 100);\n    }, 0);\n  };\n\n  const calculateTotal = () => {\n    const subTotal = calculateSubTotal();\n    const tax = calculateTax();\n    const shipping = formData.shippingCharges || 0;\n    const adjustment = formData.adjustment || 0;\n    return subTotal + tax + shipping + adjustment;\n  };\n\n  const handleSubmit = async (status: string) => {\n    setLoading(true);\n    try {\n      const subTotal = calculateSubTotal();\n      const taxAmount = calculateTax();\n\n      const quoteData = {\n        customerId: formData.customerId,\n        customerName: formData.customerName,\n        referenceNumber: formData.referenceNumber,\n        date: formData.quoteDate,\n        expiryDate: formData.expiryDate,\n        salesperson: formData.salesperson,\n        projectName: formData.projectName,\n        subject: formData.subject,\n        items: quoteItems.filter(item => item.itemId || item.name).map(item => ({\n          id: item.id,\n          itemId: item.itemId,\n          name: item.name,\n          description: item.description,\n          quantity: item.quantity,\n          unit: \"\",\n          rate: item.rate,\n          discount: item.discount,\n          discountType: item.discountType,\n          tax: getTaxRate(item.tax),\n          taxName: item.tax,\n          amount: item.amount\n        })),\n        subTotal,\n        shippingCharges: formData.shippingCharges,\n        cgst: taxAmount / 2,\n        sgst: taxAmount / 2,\n        igst: 0,\n        adjustment: formData.adjustment,\n        total: calculateTotal(),\n        customerNotes: formData.customerNotes,\n        termsAndConditions: formData.termsAndConditions,\n        status,\n        updatedBy: \"Admin User\",\n        attachments: attachedFiles.map(f => ({ id: f.id, name: f.name, size: f.size, type: f.type, data: f.data }))\n      };\n\n      const response = await fetch(`/api/quotes/${quoteId}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(quoteData)\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Quote Updated\",\n          description: \"The quote has been successfully updated.\",\n        });\n        setLocation(isFromEstimates ? '/estimates' : '/quotes');\n      } else {\n        toast({\n          title: \"Error\",\n          description: \"Failed to update quote\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      console.error('Error updating quote:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to update quote\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const formatCurrency = (amount: number) => {\n    return amount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n  };\n\n  const handleFileUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = event.target.files;\n    if (!files) return;\n\n    const maxFiles = 5;\n    const maxSize = 10 * 1024 * 1024;\n\n    if (attachedFiles.length + files.length > maxFiles) {\n      toast({\n        title: \"Too many files\",\n        description: `You can only upload a maximum of ${maxFiles} files`,\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    Array.from(files).forEach(file => {\n      if (file.size > maxSize) {\n        toast({\n          title: \"File too large\",\n          description: `File ${file.name} exceeds 10MB limit`,\n          variant: \"destructive\"\n        });\n        return;\n      }\n\n      const reader = new FileReader();\n      reader.onload = () => {\n        const newFile: AttachedFile = {\n          id: String(Date.now() + Math.random()),\n          name: file.name,\n          size: file.size,\n          type: file.type,\n          data: reader.result as string\n        };\n        setAttachedFiles(prev => [...prev, newFile]);\n      };\n      reader.readAsDataURL(file);\n    });\n\n    event.target.value = '';\n  };\n\n  const removeFile = (fileId: string) => {\n    setAttachedFiles(prev => prev.filter(f => f.id !== fileId));\n  };\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes < 1024) return bytes + ' B';\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\n    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\n  };\n\n  if (initialLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-blue-600\" />\n        <span className=\"ml-2 text-slate-500\">Loading quote...</span>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-5xl mx-auto py-6 animate-in fade-in duration-300\">\n      <div className=\"flex items-center gap-4 mb-6\">\n        <Button variant=\"ghost\" size=\"icon\" onClick={() => setLocation(isFromEstimates ? '/estimates' : '/quotes')} data-testid=\"button-back\">\n          <ArrowLeft className=\"h-4 w-4\" />\n        </Button>\n        <h1 className=\"text-2xl font-semibold text-slate-900 dark:text-white\">Edit Quote</h1>\n      </div>\n\n      <div className=\"space-y-6\">\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-red-600\">Customer Name*</Label>\n            <Select value={formData.customerId} onValueChange={handleCustomerChange}>\n              <SelectTrigger className=\"bg-blue-50 border-blue-200\" data-testid=\"select-customer\">\n                <SelectValue placeholder=\"Select or add a customer\" />\n              </SelectTrigger>\n              <SelectContent>\n                {customers.map(customer => (\n                  <SelectItem key={customer.id} value={customer.id}>\n                    {customer.name}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n          <div className=\"flex justify-end\">\n            <Button variant=\"outline\" size=\"icon\" className=\"h-10 w-10\">\n              <Search className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-red-600\">Quote#*</Label>\n            <div className=\"flex gap-2\">\n              <Input\n                value={formData.quoteNumber}\n                disabled\n                className=\"flex-1 bg-slate-100\"\n                data-testid=\"input-quote-number\"\n              />\n            </div>\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Reference#</Label>\n            <Input\n              value={formData.referenceNumber}\n              onChange={(e) => setFormData(prev => ({ ...prev, referenceNumber: e.target.value }))}\n              data-testid=\"input-reference\"\n            />\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-red-600\">Quote Date*</Label>\n            <Input\n              type=\"date\"\n              value={formData.quoteDate}\n              onChange={(e) => setFormData(prev => ({ ...prev, quoteDate: e.target.value }))}\n              data-testid=\"input-quote-date\"\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Expiry Date</Label>\n            <Input\n              type=\"date\"\n              value={formData.expiryDate}\n              onChange={(e) => setFormData(prev => ({ ...prev, expiryDate: e.target.value }))}\n              data-testid=\"input-expiry-date\"\n            />\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-2\">\n            <Label>Salesperson</Label>\n            <Select value={formData.salesperson} onValueChange={(v) => {\n              if (v === \"manage_salespersons\") {\n                setShowManageSalespersons(true);\n              } else {\n                setFormData(prev => ({ ...prev, salesperson: v }));\n              }\n            }}>\n              <SelectTrigger data-testid=\"select-salesperson\">\n                <SelectValue placeholder=\"Select or Add Salesperson\" />\n              </SelectTrigger>\n              <SelectContent>\n                <div className=\"p-2\">\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\n                    <Input placeholder=\"Search\" className=\"pl-8 h-9\" />\n                  </div>\n                </div>\n                {salespersons.map(sp => (\n                  <SelectItem key={sp.id} value={sp.name}>{sp.name}</SelectItem>\n                ))}\n                <div\n                  className=\"flex items-center gap-2 p-2 text-sm text-blue-600 cursor-pointer hover:bg-slate-100 border-t mt-1\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    setShowManageSalespersons(true);\n                  }}\n                >\n                  <Plus className=\"h-4 w-4\" />\n                  Manage Salespersons\n                </div>\n              </SelectContent>\n            </Select>\n          </div>\n          {/* Project Name field hidden as per requirements */}\n          {/* <div className=\"space-y-2\">\n            <Label>Project Name</Label>\n            <Select value={formData.projectName} onValueChange={(v) => setFormData(prev => ({ ...prev, projectName: v }))}>\n              <SelectTrigger data-testid=\"select-project\">\n                <SelectValue placeholder=\"Select a project\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"default\">Default Project</SelectItem>\n              </SelectContent>\n            </Select>\n          </div> */}\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label>Subject</Label>\n          <div className=\"flex gap-2\">\n            <Input\n              value={formData.subject}\n              onChange={(e) => setFormData(prev => ({ ...prev, subject: e.target.value }))}\n              placeholder=\"Let your customer know what this Quote is for\"\n              className=\"flex-1\"\n              data-testid=\"input-subject\"\n            />\n          </div>\n        </div>\n\n        <div className=\"border border-slate-200 rounded-lg overflow-hidden\">\n          <div className=\"bg-slate-50 px-4 py-2 font-medium text-sm text-slate-700\">\n            Item Table\n          </div>\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead className=\"bg-slate-50 border-b border-slate-200\">\n                <tr>\n                  <th className=\"px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase w-8\"></th>\n                  <th className=\"px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase\">Item Details</th>\n                  <th className=\"px-4 py-2 text-center text-xs font-medium text-slate-500 uppercase w-24\">Quantity</th>\n                  <th className=\"px-4 py-2 text-right text-xs font-medium text-slate-500 uppercase w-28\">Rate</th>\n                  <th className=\"px-4 py-2 text-center text-xs font-medium text-slate-500 uppercase w-28\">Discount</th>\n                  <th className=\"px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase w-32\">Tax</th>\n                  <th className=\"px-4 py-2 text-right text-xs font-medium text-slate-500 uppercase w-24\">Tax Amt</th>\n                  <th className=\"px-4 py-2 text-right text-xs font-medium text-slate-500 uppercase w-28\">Amount</th>\n                  <th className=\"px-4 py-2 w-10\"></th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-slate-100\">\n                {quoteItems.map((item, index) => (\n                  <tr key={item.id}>\n                    <td className=\"px-4 py-2 text-slate-400\">::</td>\n                    <td className=\"px-4 py-2\">\n                      <Select value={item.itemId} onValueChange={(v) => handleItemChange(index, v)}>\n                        <SelectTrigger className=\"border-dashed\" data-testid={`select-item-${index}`}>\n                          <SelectValue placeholder=\"Type or click to select an item.\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {items.map(i => (\n                            <SelectItem key={i.id} value={i.id}>{i.name}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <Input\n                        type=\"number\"\n                        min=\"1\"\n                        value={item.quantity}\n                        onChange={(e) => updateQuoteItem(index, 'quantity', parseFloat(e.target.value) || 1)}\n                        className=\"text-center\"\n                        data-testid={`input-quantity-${index}`}\n                      />\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <Input\n                        type=\"number\"\n                        min=\"0\"\n                        step=\"0.01\"\n                        value={item.rate}\n                        onChange={(e) => updateQuoteItem(index, 'rate', parseFloat(e.target.value) || 0)}\n                        className=\"text-right\"\n                        data-testid={`input-rate-${index}`}\n                      />\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <div className=\"flex items-center gap-1\">\n                        <Input\n                          type=\"number\"\n                          min=\"0\"\n                          value={item.discount}\n                          onChange={(e) => updateQuoteItem(index, 'discount', parseFloat(e.target.value) || 0)}\n                          className=\"w-16 text-center\"\n                          data-testid={`input-discount-${index}`}\n                        />\n                        <Select\n                          value={item.discountType}\n                          onValueChange={(v) => updateQuoteItem(index, 'discountType', v)}\n                        >\n                          <SelectTrigger className=\"w-14\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"percentage\">%</SelectItem>\n                            <SelectItem value=\"amount\">INR</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <Select value={item.tax} onValueChange={(v) => updateQuoteItem(index, 'tax', v)}>\n                        <SelectTrigger data-testid={`select-tax-${index}`}>\n                          <SelectValue placeholder=\"Select a Tax\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {taxOptions.map(tax => (\n                            <SelectItem key={tax.value} value={tax.value}>{tax.label}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </td>\n                    <td className=\"px-4 py-2 text-right text-xs text-slate-500\">\n                      {getTaxRate(item.tax) > 0 ? (\n                        <span>{formatCurrency(item.amount * getTaxRate(item.tax) / 100)} ({getTaxRate(item.tax)}%)</span>\n                      ) : '-'}\n                    </td>\n                    <td className=\"px-4 py-2 text-right font-medium\">\n                      {formatCurrency(item.amount + (item.amount * getTaxRate(item.tax) / 100))}\n                    </td>\n                    <td className=\"px-4 py-2\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"h-8 w-8 text-red-500 hover:text-red-700\"\n                        onClick={() => removeRow(index)}\n                        data-testid={`button-remove-item-${index}`}\n                      >\n                        <X className=\"h-4 w-4\" />\n                      </Button>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n          <div className=\"px-4 py-3 flex gap-4\">\n            <Button variant=\"link\" className=\"text-blue-600 p-0 h-auto\" onClick={addNewRow} data-testid=\"button-add-row\">\n              <Plus className=\"h-4 w-4 mr-1\" />\n              Add New Row\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-8\">\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label>Customer Notes</Label>\n              <Textarea\n                value={formData.customerNotes}\n                onChange={(e) => setFormData(prev => ({ ...prev, customerNotes: e.target.value }))}\n                placeholder=\"Looking forward for your business.\"\n                className=\"min-h-[80px]\"\n                data-testid=\"input-customer-notes\"\n              />\n            </div>\n          </div>\n\n          <div className=\"space-y-3\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-slate-600\">Sub Total</span>\n              <span className=\"font-medium\">{formatCurrency(calculateSubTotal())}</span>\n            </div>\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-slate-600\">Shipping Charges</span>\n              <Input\n                type=\"number\"\n                min=\"0\"\n                step=\"0.01\"\n                value={formData.shippingCharges}\n                onChange={(e) => setFormData(prev => ({ ...prev, shippingCharges: parseFloat(e.target.value) || 0 }))}\n                className=\"w-32 text-right\"\n                data-testid=\"input-shipping\"\n              />\n            </div>\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-slate-600\">Adjustment</span>\n              <Input\n                type=\"number\"\n                step=\"0.01\"\n                value={formData.adjustment}\n                onChange={(e) => setFormData(prev => ({ ...prev, adjustment: parseFloat(e.target.value) || 0 }))}\n                className=\"w-32 text-right\"\n                data-testid=\"input-adjustment\"\n              />\n            </div>\n            <div className=\"flex justify-between items-center pt-3 border-t border-slate-200\">\n              <span className=\"font-semibold\">Total ( INR )</span>\n              <span className=\"font-bold text-lg\" data-testid=\"text-total\">{formatCurrency(calculateTotal())}</span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"border-t border-slate-200 pt-6\">\n          <div className=\"grid grid-cols-2 gap-8\">\n            <div className=\"space-y-2\">\n              <Label>Terms & Conditions</Label>\n              <Textarea\n                value={formData.termsAndConditions}\n                onChange={(e) => setFormData(prev => ({ ...prev, termsAndConditions: e.target.value }))}\n                placeholder=\"Enter the terms and conditions of your business\"\n                className=\"min-h-[100px]\"\n                data-testid=\"input-terms\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Attach File(s) to Quote</Label>\n              <div className=\"border-2 border-dashed border-slate-200 rounded-lg p-4 text-center\">\n                <input\n                  type=\"file\"\n                  ref={fileInputRef}\n                  multiple\n                  className=\"hidden\"\n                  onChange={handleFileUpload}\n                  accept=\".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg\"\n                  data-testid=\"input-file-upload\"\n                />\n                <Button \n                  variant=\"outline\" \n                  className=\"gap-2\" \n                  type=\"button\"\n                  onClick={() => fileInputRef.current?.click()}\n                  data-testid=\"button-upload-file\"\n                >\n                  <Upload className=\"h-4 w-4\" />\n                  Upload File\n                </Button>\n                <p className=\"text-xs text-slate-500 mt-2\">You can upload a maximum of 5 files, 10MB each</p>\n              </div>\n              {attachedFiles.length > 0 && (\n                <div className=\"space-y-2 mt-3\">\n                  {attachedFiles.map(file => (\n                    <div key={file.id} className=\"flex items-center justify-between bg-slate-50 rounded-lg px-3 py-2\" data-testid={`file-item-${file.id}`}>\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"w-8 h-8 bg-blue-100 rounded flex items-center justify-center\">\n                          <FileText className=\"h-4 w-4 text-blue-600\" />\n                        </div>\n                        <div>\n                          <p className=\"text-sm font-medium text-slate-700\">{file.name}</p>\n                          <p className=\"text-xs text-slate-500\">{formatFileSize(file.size)}</p>\n                        </div>\n                      </div>\n                      <Button \n                        variant=\"ghost\" \n                        size=\"icon\" \n                        className=\"h-7 w-7 text-red-500 hover:text-red-700 hover:bg-red-50\" \n                        onClick={() => removeFile(file.id)} \n                        data-testid={`button-remove-file-${file.id}`}\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-3 pt-4 border-t border-slate-200\">\n          <Button\n            variant=\"outline\"\n            onClick={() => handleSubmit('DRAFT')}\n            disabled={loading}\n            data-testid=\"button-save-draft\"\n          >\n            {loading ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : null}\n            Save as Draft\n          </Button>\n          <Button\n            className=\"bg-blue-600 hover:bg-blue-700\"\n            onClick={() => handleSubmit(formData.status === 'DRAFT' ? 'SENT' : formData.status)}\n            disabled={loading}\n            data-testid=\"button-save\"\n          >\n            {loading ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : null}\n            Save\n          </Button>\n          <Button\n            variant=\"ghost\"\n            onClick={() => setLocation(isFromEstimates ? '/estimates' : '/quotes')}\n            data-testid=\"button-cancel\"\n          >\n            Cancel\n          </Button>\n        </div>\n      </div>\n\n      <ManageSalespersonsDialog\n        open={showManageSalespersons}\n        onOpenChange={setShowManageSalespersons}\n        onSalespersonChange={fetchSalespersons}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":32487,"size_tokens":null},"client/src/pages/credit-note-edit.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation, useParams } from \"wouter\";\nimport { ArrowLeft, Plus, Trash2, Search, X, HelpCircle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\ninterface Customer {\n  id: string;\n  name: string;\n  displayName?: string;\n  email?: string;\n  billingAddress?: any;\n  gstin?: string;\n  placeOfSupply?: string;\n}\n\ninterface Item {\n  id: string;\n  name: string;\n  type: string;\n  unit: string;\n  sellingPrice: number;\n  hsnSac?: string;\n  description?: string;\n}\n\ninterface Salesperson {\n  id: string;\n  name: string;\n  email?: string;\n}\n\ninterface LineItem {\n  id: string;\n  itemId: string;\n  name: string;\n  description: string;\n  account: string;\n  quantity: number;\n  rate: number;\n  discount: number;\n  discountType: string;\n  tax: number;\n  taxName: string;\n  amount: number;\n}\n\nconst INDIAN_STATES = [\n  \"Andhra Pradesh\", \"Arunachal Pradesh\", \"Assam\", \"Bihar\", \"Chhattisgarh\",\n  \"Goa\", \"Gujarat\", \"Haryana\", \"Himachal Pradesh\", \"Jharkhand\", \"Karnataka\",\n  \"Kerala\", \"Madhya Pradesh\", \"Maharashtra\", \"Manipur\", \"Meghalaya\", \"Mizoram\",\n  \"Nagaland\", \"Odisha\", \"Punjab\", \"Rajasthan\", \"Sikkim\", \"Tamil Nadu\",\n  \"Telangana\", \"Tripura\", \"Uttar Pradesh\", \"Uttarakhand\", \"West Bengal\",\n  \"Andaman and Nicobar Islands\", \"Chandigarh\", \"Dadra and Nagar Haveli\",\n  \"Daman and Diu\", \"Delhi\", \"Jammu and Kashmir\", \"Ladakh\", \"Lakshadweep\", \"Puducherry\"\n];\n\nconst TAX_OPTIONS = [\n  { value: \"none\", label: \"None\", rate: 0 },\n  { value: \"GST0\", label: \"GST 0%\", rate: 0 },\n  { value: \"GST5\", label: \"GST 5%\", rate: 5 },\n  { value: \"GST12\", label: \"GST 12%\", rate: 12 },\n  { value: \"GST18\", label: \"GST 18%\", rate: 18 },\n  { value: \"GST28\", label: \"GST 28%\", rate: 28 },\n  { value: \"IGST0\", label: \"IGST 0%\", rate: 0 },\n  { value: \"IGST5\", label: \"IGST 5%\", rate: 5 },\n  { value: \"IGST12\", label: \"IGST 12%\", rate: 12 },\n  { value: \"IGST18\", label: \"IGST 18%\", rate: 18 },\n  { value: \"IGST28\", label: \"IGST 28%\", rate: 28 },\n];\n\nexport default function CreditNoteEdit() {\n  const [, setLocation] = useLocation();\n  const params = useParams<{ id: string }>();\n  const { toast } = useToast();\n\n  const [customers, setCustomers] = useState<Customer[]>([]);\n  const [items, setItems] = useState<Item[]>([]);\n  const [salespersons, setSalespersons] = useState<Salesperson[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const [customerId, setCustomerId] = useState(\"\");\n  const [customerName, setCustomerName] = useState(\"\");\n  const [reason, setReason] = useState(\"\");\n  const [creditNoteNumber, setCreditNoteNumber] = useState(\"\");\n  const [referenceNumber, setReferenceNumber] = useState(\"\");\n  const [creditNoteDate, setCreditNoteDate] = useState(new Date().toISOString().split('T')[0]);\n  const [salesperson, setSalesperson] = useState(\"\");\n  const [subject, setSubject] = useState(\"\");\n  const [billingAddress, setBillingAddress] = useState({\n    street: \"\", city: \"\", state: \"\", country: \"India\", pincode: \"\"\n  });\n  const [gstin, setGstin] = useState(\"\");\n  const [placeOfSupply, setPlaceOfSupply] = useState(\"\");\n\n  const [lineItems, setLineItems] = useState<LineItem[]>([\n    { id: \"1\", itemId: \"\", name: \"\", description: \"\", account: \"\", quantity: 1, rate: 0, discount: 0, discountType: \"percentage\", tax: 0, taxName: \"none\", amount: 0 }\n  ]);\n\n  const [subTotal, setSubTotal] = useState(0);\n  const [shippingCharges, setShippingCharges] = useState(0);\n  const [tdsType, setTdsType] = useState(\"TDS\");\n  const [tdsTax, setTdsTax] = useState(\"\");\n  const [adjustment, setAdjustment] = useState(0);\n  const [total, setTotal] = useState(0);\n  const [customerNotes, setCustomerNotes] = useState(\"\");\n  const [termsAndConditions, setTermsAndConditions] = useState(\"\");\n\n  const [salespersonDialogOpen, setSalespersonDialogOpen] = useState(false);\n  const [newSalespersonName, setNewSalespersonName] = useState(\"\");\n  const [newSalespersonEmail, setNewSalespersonEmail] = useState(\"\");\n\n  useEffect(() => {\n    fetchData();\n  }, [params.id]);\n\n  useEffect(() => {\n    calculateTotals();\n  }, [lineItems, shippingCharges, adjustment]);\n\n  const fetchData = async () => {\n    setIsLoading(true);\n    try {\n      const [customersRes, itemsRes, salespersonsRes, creditNoteRes] = await Promise.all([\n        fetch('/api/customers'),\n        fetch('/api/items'),\n        fetch('/api/salespersons'),\n        fetch(`/api/credit-notes/${params.id}`)\n      ]);\n\n      const customersData = await customersRes.json();\n      const itemsData = await itemsRes.json();\n      const salespersonsData = await salespersonsRes.json();\n      const creditNoteData = await creditNoteRes.json();\n\n      if (customersData.success) setCustomers(customersData.data);\n      if (itemsData.success) setItems(itemsData.data);\n      if (salespersonsData.success) setSalespersons(salespersonsData.data);\n      \n      if (creditNoteData.success && creditNoteData.data) {\n        const cn = creditNoteData.data;\n        setCustomerId(cn.customerId || \"\");\n        setCustomerName(cn.customerName || \"\");\n        setReason(cn.reason || \"\");\n        setCreditNoteNumber(cn.creditNoteNumber || cn.number || \"\");\n        setReferenceNumber(cn.referenceNumber || \"\");\n        setCreditNoteDate(cn.date ? cn.date.split('T')[0] : new Date().toISOString().split('T')[0]);\n        setSalesperson(cn.salesperson || \"\");\n        setSubject(cn.subject || \"\");\n        if (cn.billingAddress) setBillingAddress(cn.billingAddress);\n        setGstin(cn.gstin || \"\");\n        setPlaceOfSupply(cn.placeOfSupply || \"\");\n        if (cn.items && cn.items.length > 0) {\n          setLineItems(cn.items.map((item: any, index: number) => ({\n            id: item.id || String(index + 1),\n            itemId: item.itemId || \"\",\n            name: item.name || \"\",\n            description: item.description || \"\",\n            account: item.account || \"\",\n            quantity: item.quantity || 1,\n            rate: item.rate || 0,\n            discount: item.discount || 0,\n            discountType: item.discountType || \"percentage\",\n            tax: item.tax || 0,\n            taxName: item.taxName || \"none\",\n            amount: item.amount || 0\n          })));\n        }\n        setShippingCharges(cn.shippingCharges || 0);\n        setTdsType(cn.tdsType || \"TDS\");\n        setTdsTax(cn.tdsTax || \"\");\n        setAdjustment(cn.adjustment || 0);\n        setCustomerNotes(cn.customerNotes || \"\");\n        setTermsAndConditions(cn.termsAndConditions || \"\");\n      } else {\n        toast({ title: \"Error\", description: \"Credit note not found\", variant: \"destructive\" });\n        setLocation('/credit-notes');\n      }\n    } catch (error) {\n      toast({ title: \"Error\", description: \"Failed to load data\", variant: \"destructive\" });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleCustomerChange = (customerId: string) => {\n    const customer = customers.find(c => c.id === customerId);\n    if (customer) {\n      setCustomerId(customer.id);\n      setCustomerName(customer.displayName || customer.name);\n      if (customer.billingAddress) {\n        setBillingAddress(customer.billingAddress);\n      }\n      if (customer.gstin) setGstin(customer.gstin);\n      if (customer.placeOfSupply) setPlaceOfSupply(customer.placeOfSupply);\n    }\n  };\n\n  const handleItemChange = (lineItemId: string, itemId: string) => {\n    const item = items.find(i => i.id === itemId);\n    if (item) {\n      updateLineItem(lineItemId, {\n        itemId: item.id,\n        name: item.name,\n        description: item.description || \"\",\n        rate: item.sellingPrice || 0,\n        amount: (item.sellingPrice || 0) * 1\n      });\n    }\n  };\n\n  const updateLineItem = (id: string, updates: Partial<LineItem>) => {\n    setLineItems(prev => prev.map(item => {\n      if (item.id === id) {\n        const updated = { ...item, ...updates };\n        const quantity = updated.quantity || 0;\n        const rate = updated.rate || 0;\n        const discount = updated.discount || 0;\n        const discountType = updated.discountType || 'percentage';\n        \n        let discountAmount = discountType === 'percentage' \n          ? (quantity * rate * discount / 100) \n          : discount;\n        \n        updated.amount = quantity * rate - discountAmount;\n        return updated;\n      }\n      return item;\n    }));\n  };\n\n  const addLineItem = () => {\n    const newId = String(Date.now());\n    setLineItems(prev => [...prev, {\n      id: newId, itemId: \"\", name: \"\", description: \"\", account: \"\", quantity: 1, rate: 0, discount: 0, discountType: \"percentage\", tax: 0, taxName: \"none\", amount: 0\n    }]);\n  };\n\n  const removeLineItem = (id: string) => {\n    if (lineItems.length > 1) {\n      setLineItems(prev => prev.filter(item => item.id !== id));\n    }\n  };\n\n  const calculateTotals = () => {\n    const subTotalAmount = lineItems.reduce((sum, item) => sum + item.amount, 0);\n    setSubTotal(subTotalAmount);\n    setTotal(subTotalAmount + shippingCharges + adjustment);\n  };\n\n  const handleAddSalesperson = async () => {\n    if (!newSalespersonName.trim()) return;\n    try {\n      const response = await fetch('/api/salespersons', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ name: newSalespersonName, email: newSalespersonEmail })\n      });\n      const data = await response.json();\n      if (data.success) {\n        setSalespersons(prev => [...prev, data.data]);\n        setSalesperson(data.data.name);\n        setSalespersonDialogOpen(false);\n        setNewSalespersonName(\"\");\n        setNewSalespersonEmail(\"\");\n        toast({ title: \"Success\", description: \"Salesperson added successfully\" });\n      }\n    } catch (error) {\n      toast({ title: \"Error\", description: \"Failed to add salesperson\", variant: \"destructive\" });\n    }\n  };\n\n  const handleSubmit = async (status: string) => {\n    if (!customerId) {\n      toast({ title: \"Error\", description: \"Please select a customer\", variant: \"destructive\" });\n      return;\n    }\n\n    setIsSubmitting(true);\n    try {\n      const response = await fetch(`/api/credit-notes/${params.id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          customerId,\n          customerName,\n          reason,\n          creditNoteNumber,\n          referenceNumber,\n          date: creditNoteDate,\n          salesperson,\n          subject,\n          billingAddress,\n          gstin,\n          placeOfSupply,\n          items: lineItems,\n          subTotal,\n          shippingCharges,\n          tdsType,\n          tdsAmount: 0,\n          cgst: 0,\n          sgst: 0,\n          igst: 0,\n          adjustment,\n          total,\n          customerNotes,\n          termsAndConditions,\n          status\n        })\n      });\n\n      const data = await response.json();\n      if (data.success) {\n        toast({ title: \"Success\", description: \"Credit note updated successfully\" });\n        setLocation('/credit-notes');\n      } else {\n        toast({ title: \"Error\", description: data.message || \"Failed to update credit note\", variant: \"destructive\" });\n      }\n    } catch (error) {\n      toast({ title: \"Error\", description: \"Failed to update credit note\", variant: \"destructive\" });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"max-w-5xl mx-auto p-4\">\n        <div className=\"flex items-center gap-4 mb-6\">\n          <Skeleton className=\"h-9 w-9\" />\n          <Skeleton className=\"h-8 w-48\" />\n        </div>\n        <div className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <Skeleton className=\"h-10 w-full\" />\n            <Skeleton className=\"h-10 w-full\" />\n          </div>\n          <Skeleton className=\"h-64 w-full\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-5xl mx-auto p-4 pb-24\">\n      <div className=\"flex items-center gap-4 mb-6\">\n        <Button variant=\"ghost\" size=\"icon\" onClick={() => setLocation('/credit-notes')} data-testid=\"button-back\">\n          <ArrowLeft className=\"h-4 w-4\" />\n        </Button>\n        <h1 className=\"text-2xl font-bold\" data-testid=\"text-page-title\">Edit Credit Note</h1>\n      </div>\n\n      <div className=\"space-y-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <div>\n            <Label className=\"text-red-500\">Customer Name*</Label>\n            <div className=\"flex gap-2\">\n              <Select value={customerId} onValueChange={handleCustomerChange}>\n                <SelectTrigger className=\"flex-1\" data-testid=\"select-customer\">\n                  <SelectValue placeholder=\"Select or add a customer\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {customers.map(customer => (\n                    <SelectItem key={customer.id} value={customer.id}>{customer.displayName || customer.name}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              <Button variant=\"default\" size=\"icon\" data-testid=\"button-search-customer\">\n                <Search className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n          <div>\n            <Label>Reason</Label>\n            <Select value={reason} onValueChange={setReason}>\n              <SelectTrigger data-testid=\"select-reason\">\n                <SelectValue placeholder=\"Select a reason\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"sales_return\">Sales Return</SelectItem>\n                <SelectItem value=\"post_sale_discount\">Post Sale Discount</SelectItem>\n                <SelectItem value=\"deficiency_in_services\">Deficiency in Services</SelectItem>\n                <SelectItem value=\"correction_in_invoice\">Correction in Invoice</SelectItem>\n                <SelectItem value=\"change_in_pos\">Change in POS</SelectItem>\n                <SelectItem value=\"finalization_of_amount\">Finalization of Provisional Assessment</SelectItem>\n                <SelectItem value=\"others\">Others</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <div>\n            <Label className=\"text-red-500\">Credit Note#*</Label>\n            <div className=\"flex items-center gap-2\">\n              <Input value={creditNoteNumber} onChange={(e) => setCreditNoteNumber(e.target.value)} data-testid=\"input-credit-note-number\" />\n              <Button variant=\"ghost\" size=\"icon\">\n                <HelpCircle className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n          <div>\n            <Label>Reference#</Label>\n            <Input value={referenceNumber} onChange={(e) => setReferenceNumber(e.target.value)} data-testid=\"input-reference-number\" />\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <div>\n            <Label className=\"text-red-500\">Credit Note Date*</Label>\n            <Input type=\"date\" value={creditNoteDate} onChange={(e) => setCreditNoteDate(e.target.value)} data-testid=\"input-credit-note-date\" />\n          </div>\n          <div>\n            <Label>Salesperson</Label>\n            <div className=\"flex gap-2\">\n              <Select value={salesperson} onValueChange={setSalesperson}>\n                <SelectTrigger className=\"flex-1\" data-testid=\"select-salesperson\">\n                  <SelectValue placeholder=\"Select or Add Salesperson\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {salespersons.map(sp => (\n                    <SelectItem key={sp.id} value={sp.name}>{sp.name}</SelectItem>\n                  ))}\n                  <div className=\"border-t my-1\" />\n                  <Button \n                    variant=\"ghost\" \n                    className=\"w-full justify-start text-blue-600\" \n                    onClick={() => setSalespersonDialogOpen(true)}\n                    data-testid=\"button-add-salesperson\"\n                  >\n                    <Plus className=\"h-4 w-4 mr-2\" /> Add Salesperson\n                  </Button>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </div>\n\n        <div>\n          <Label className=\"flex items-center gap-1\">Subject <HelpCircle className=\"h-3 w-3 text-slate-400\" /></Label>\n          <Textarea \n            value={subject} \n            onChange={(e) => setSubject(e.target.value)} \n            placeholder=\"Let your customer know what this Credit Note is for\"\n            className=\"resize-none\"\n            data-testid=\"input-subject\"\n          />\n        </div>\n\n        <div className=\"border border-slate-200 dark:border-slate-700 rounded-md\">\n          <div className=\"flex items-center justify-between px-4 py-3 bg-slate-50 dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700\">\n            <h3 className=\"font-medium\">Item Table</h3>\n            <Button variant=\"link\" size=\"sm\" className=\"text-blue-600\">Bulk Actions</Button>\n          </div>\n          \n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead>\n                <tr className=\"text-xs font-medium text-slate-500 uppercase border-b border-slate-200 dark:border-slate-700\">\n                  <th className=\"px-4 py-3 text-left w-8\"></th>\n                  <th className=\"px-4 py-3 text-left\">Item Details</th>\n                  <th className=\"px-4 py-3 text-left\">Account</th>\n                  <th className=\"px-4 py-3 text-right\">Quantity</th>\n                  <th className=\"px-4 py-3 text-right\">Rate</th>\n                  <th className=\"px-4 py-3 text-right\">Discount</th>\n                  <th className=\"px-4 py-3 text-left\">Tax(%)</th>\n                  <th className=\"px-4 py-3 text-right\">Amount</th>\n                  <th className=\"px-4 py-3 w-10\"></th>\n                </tr>\n              </thead>\n              <tbody>\n                {lineItems.map((item, index) => (\n                  <tr key={item.id} className=\"border-b border-slate-200 dark:border-slate-700\">\n                    <td className=\"px-4 py-3 text-slate-400\">{index + 1}</td>\n                    <td className=\"px-4 py-3\">\n                      <Select value={item.itemId} onValueChange={(val) => handleItemChange(item.id, val)}>\n                        <SelectTrigger className=\"w-48\" data-testid={`select-item-${index}`}>\n                          <SelectValue placeholder=\"Type or click to select an Item.\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {items.map(i => (\n                            <SelectItem key={i.id} value={i.id}>{i.name}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <Select value={item.account} onValueChange={(val) => updateLineItem(item.id, { account: val })}>\n                        <SelectTrigger className=\"w-32\" data-testid={`select-account-${index}`}>\n                          <SelectValue placeholder=\"Select an account\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"sales\">Sales</SelectItem>\n                          <SelectItem value=\"service\">Service Revenue</SelectItem>\n                          <SelectItem value=\"other\">Other Income</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <Input \n                        type=\"number\" \n                        value={item.quantity} \n                        onChange={(e) => updateLineItem(item.id, { quantity: parseFloat(e.target.value) || 0 })}\n                        className=\"w-20 text-right\"\n                        data-testid={`input-quantity-${index}`}\n                      />\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <Input \n                        type=\"number\" \n                        value={item.rate} \n                        onChange={(e) => updateLineItem(item.id, { rate: parseFloat(e.target.value) || 0 })}\n                        className=\"w-24 text-right\"\n                        data-testid={`input-rate-${index}`}\n                      />\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <div className=\"flex items-center gap-1\">\n                        <Input \n                          type=\"number\" \n                          value={item.discount} \n                          onChange={(e) => updateLineItem(item.id, { discount: parseFloat(e.target.value) || 0 })}\n                          className=\"w-16 text-right\"\n                          data-testid={`input-discount-${index}`}\n                        />\n                        <span className=\"text-slate-500\">%</span>\n                      </div>\n                    </td>\n                    <td className=\"px-4 py-3\">\n                      <Select \n                        value={item.taxName} \n                        onValueChange={(val) => {\n                          const taxOption = TAX_OPTIONS.find(t => t.value === val);\n                          updateLineItem(item.id, { taxName: val, tax: taxOption?.rate || 0 });\n                        }}\n                      >\n                        <SelectTrigger className=\"w-28\" data-testid={`select-tax-${index}`}>\n                          <SelectValue placeholder=\"Select a Tax\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {TAX_OPTIONS.map(tax => (\n                            <SelectItem key={tax.value} value={tax.value}>{tax.label}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </td>\n                    <td className=\"px-4 py-3 text-right font-medium\">{item.amount.toFixed(2)}</td>\n                    <td className=\"px-4 py-3\">\n                      <Button \n                        variant=\"ghost\" \n                        size=\"icon\" \n                        onClick={() => removeLineItem(item.id)}\n                        className=\"text-red-500\"\n                        disabled={lineItems.length === 1}\n                        data-testid={`button-remove-item-${index}`}\n                      >\n                        <X className=\"h-4 w-4\" />\n                      </Button>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n\n          <div className=\"px-4 py-3 border-t border-slate-200 dark:border-slate-700 flex gap-4\">\n            <Button variant=\"link\" className=\"text-blue-600 gap-1\" onClick={addLineItem} data-testid=\"button-add-row\">\n              <Plus className=\"h-4 w-4\" /> Add New Row\n            </Button>\n            <Button variant=\"link\" className=\"text-blue-600 gap-1\" data-testid=\"button-add-bulk\">\n              <Plus className=\"h-4 w-4\" /> Add Items in Bulk\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <div>\n            <Label>Customer Notes</Label>\n            <Textarea \n              value={customerNotes} \n              onChange={(e) => setCustomerNotes(e.target.value)} \n              placeholder=\"Will be displayed on the credit note\"\n              className=\"resize-none\"\n              data-testid=\"input-customer-notes\"\n            />\n          </div>\n          <div className=\"space-y-3\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-slate-600\">Sub Total</span>\n              <span className=\"font-medium\">{subTotal.toFixed(2)}</span>\n            </div>\n            <div className=\"flex justify-between items-center gap-2\">\n              <span className=\"text-slate-600\">Shipping Charges</span>\n              <div className=\"flex items-center gap-1\">\n                <Input \n                  type=\"number\" \n                  value={shippingCharges} \n                  onChange={(e) => setShippingCharges(parseFloat(e.target.value) || 0)}\n                  className=\"w-24 text-right\"\n                  data-testid=\"input-shipping-charges\"\n                />\n                <HelpCircle className=\"h-4 w-4 text-slate-400\" />\n              </div>\n            </div>\n            <div className=\"flex justify-between items-center gap-2\">\n              <RadioGroup value={tdsType} onValueChange={setTdsType} className=\"flex gap-4\">\n                <div className=\"flex items-center gap-2\">\n                  <RadioGroupItem value=\"TDS\" id=\"tds\" />\n                  <Label htmlFor=\"tds\">TDS</Label>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <RadioGroupItem value=\"TCS\" id=\"tcs\" />\n                  <Label htmlFor=\"tcs\">TCS</Label>\n                </div>\n              </RadioGroup>\n              <Select value={tdsTax} onValueChange={setTdsTax}>\n                <SelectTrigger className=\"w-32\" data-testid=\"select-tds-tax\">\n                  <SelectValue placeholder=\"Select a Tax\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"none\">None</SelectItem>\n                  <SelectItem value=\"tds1\">TDS 1%</SelectItem>\n                  <SelectItem value=\"tds2\">TDS 2%</SelectItem>\n                </SelectContent>\n              </Select>\n              <span className=\"w-20 text-right\">- 0.00</span>\n            </div>\n            <div className=\"flex justify-between items-center gap-2\">\n              <span className=\"text-slate-600\">Adjustment</span>\n              <div className=\"flex items-center gap-1\">\n                <Input \n                  type=\"number\" \n                  value={adjustment} \n                  onChange={(e) => setAdjustment(parseFloat(e.target.value) || 0)}\n                  className=\"w-24 text-right\"\n                  data-testid=\"input-adjustment\"\n                />\n                <HelpCircle className=\"h-4 w-4 text-slate-400\" />\n              </div>\n              <span className=\"w-20 text-right\">{adjustment.toFixed(2)}</span>\n            </div>\n            <div className=\"flex justify-between items-center pt-3 border-t border-slate-200 dark:border-slate-700\">\n              <span className=\"font-semibold\">Total (  )</span>\n              <span className=\"font-bold text-lg\">{total.toFixed(2)}</span>\n            </div>\n          </div>\n        </div>\n\n        <div>\n          <Label>Terms & Conditions</Label>\n          <Textarea \n            value={termsAndConditions} \n            onChange={(e) => setTermsAndConditions(e.target.value)} \n            placeholder=\"Enter the terms and conditions of your business to be displayed in your transaction\"\n            className=\"resize-none min-h-[100px]\"\n            data-testid=\"input-terms\"\n          />\n        </div>\n\n        <div className=\"text-sm text-slate-500\">\n          Additional Fields: Start adding custom fields for your credit notes by going to Settings &gt; Sales &gt; Credit Notes.\n        </div>\n      </div>\n\n      <div className=\"fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-700 px-4 py-3 flex items-center gap-3\">\n        <span className=\"text-slate-500 mr-auto\"></span>\n        <Button variant=\"outline\" onClick={() => handleSubmit('DRAFT')} disabled={isSubmitting} data-testid=\"button-save-draft\">\n          Save as Draft\n        </Button>\n        <Button onClick={() => handleSubmit('OPEN')} disabled={isSubmitting} data-testid=\"button-save-open\">\n          Save as Open\n        </Button>\n        <Button variant=\"ghost\" onClick={() => setLocation('/credit-notes')} data-testid=\"button-cancel\">\n          Cancel\n        </Button>\n      </div>\n\n      <Dialog open={salespersonDialogOpen} onOpenChange={setSalespersonDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Add Salesperson</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <Label>Name *</Label>\n              <Input \n                value={newSalespersonName} \n                onChange={(e) => setNewSalespersonName(e.target.value)} \n                placeholder=\"Enter salesperson name\"\n                data-testid=\"input-new-salesperson-name\"\n              />\n            </div>\n            <div>\n              <Label>Email</Label>\n              <Input \n                type=\"email\"\n                value={newSalespersonEmail} \n                onChange={(e) => setNewSalespersonEmail(e.target.value)} \n                placeholder=\"Enter email (optional)\"\n                data-testid=\"input-new-salesperson-email\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setSalespersonDialogOpen(false)}>Cancel</Button>\n            <Button onClick={handleAddSalesperson} data-testid=\"button-confirm-add-salesperson\">Add</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":30065,"size_tokens":null},"client/src/pages/e-way-bills.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { usePagination } from \"@/hooks/use-pagination\";\nimport { TablePagination } from \"@/components/table-pagination\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport {\n    Plus,\n    X,\n    Settings,\n    FileText,\n    Truck,\n    Train,\n    Plane,\n    Ship,\n    ExternalLink,\n    Pencil,\n    ChevronDown,\n    Trash2\n} from \"lucide-react\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\n\ninterface EWayBillListItem {\n    id: string;\n    ewayBillNumber: string;\n    documentType: string;\n    documentNumber: string;\n    customerName: string;\n    customerGstin: string;\n    customerId: string;\n    date: string;\n    expiryDate: string;\n    total: number;\n    status: string;\n    transactionType: string;\n}\n\ninterface EWayBillDetail {\n    id: string;\n    ewayBillNumber: string;\n    documentType: string;\n    transactionSubType: string;\n    customerName: string;\n    customerGstin: string;\n    customerId: string;\n    documentNumber: string;\n    date: string;\n    expiryDate: string;\n    transactionType: string;\n    dispatchFrom: {\n        street: string;\n        city: string;\n        state: string;\n        country: string;\n        pincode: string;\n    };\n    billFrom: {\n        street: string;\n        city: string;\n        state: string;\n        country: string;\n        pincode: string;\n    };\n    billTo: {\n        street: string;\n        city: string;\n        state: string;\n        country: string;\n        pincode: string;\n    };\n    shipTo: {\n        street: string;\n        city: string;\n        state: string;\n        country: string;\n        pincode: string;\n    };\n    placeOfDelivery: string;\n    transporter: string;\n    distance: number;\n    modeOfTransportation: string;\n    vehicleType: string;\n    vehicleNo: string;\n    transporterDocNo: string;\n    transporterDocDate: string;\n    items: any[];\n    total: number;\n    status: string;\n    createdAt: string;\n}\n\ninterface Customer {\n    id: string;\n    displayName: string;\n    companyName: string;\n    gstin?: string;\n    billingAddress?: any;\n    shippingAddress?: any;\n}\n\ninterface CreditNote {\n    id: string;\n    creditNoteNumber: string;\n    customerId: string;\n    customerName: string;\n    total: number;\n    date: string;\n}\n\nconst formatCurrency = (amount: number) => {\n    return `${amount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n};\n\nconst formatDate = (dateString: string) => {\n    if (!dateString) return '-';\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-IN', { day: '2-digit', month: '2-digit', year: 'numeric' });\n};\n\nconst formatAddress = (address: any): string[] => {\n    if (!address) return ['-'];\n    if (typeof address === 'string') return [address];\n    if (typeof address !== 'object') return ['-'];\n    const parts = [\n        address.street ? String(address.street) : '',\n        address.city ? String(address.city) : '',\n        address.state ? String(address.state) : '',\n        address.country ? String(address.country) : '',\n        address.pincode ? String(address.pincode) : ''\n    ].filter(Boolean);\n    return parts.length > 0 ? parts : ['-'];\n};\n\nconst getStatusColor = (status: string) => {\n    switch (status?.toUpperCase()) {\n        case 'GENERATED':\n            return 'bg-green-100 text-green-700 border-green-200 dark:bg-green-900/30 dark:text-green-400 dark:border-green-800';\n        case 'NOT_GENERATED':\n            return 'bg-amber-100 text-amber-700 border-amber-200 dark:bg-amber-900/30 dark:text-amber-400 dark:border-amber-800';\n        case 'CANCELLED':\n            return 'bg-red-100 text-red-700 border-red-200 dark:bg-red-900/30 dark:text-red-400 dark:border-red-800';\n        case 'EXPIRED':\n            return 'bg-slate-100 text-slate-600 border-slate-200 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-700';\n        default:\n            return 'bg-slate-100 text-slate-600 border-slate-200 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-700';\n    }\n};\n\nconst documentTypes = [\n    { value: 'credit_notes', label: 'Credit Notes' },\n    { value: 'invoices', label: 'Invoices' },\n    { value: 'delivery_challans', label: 'Delivery Challans' },\n    { value: 'sales_orders', label: 'Sales Orders' },\n];\n\nconst transactionSubTypes = [\n    { value: 'sales_return', label: 'Sales Return' },\n    { value: 'supply', label: 'Supply' },\n    { value: 'export', label: 'Export' },\n    { value: 'job_work', label: 'Job Work' },\n];\n\nconst transactionTypes = [\n    { value: 'regular', label: 'Regular' },\n    { value: 'bill_to_ship_to', label: 'Bill To - Ship To' },\n    { value: 'bill_from_dispatch_from', label: 'Bill From - Dispatch From' },\n    { value: 'combination', label: 'Combination of 2 and 3' },\n];\n\nconst ewayBillStatuses = [\n    { value: 'all', label: 'All' },\n    { value: 'NOT_GENERATED', label: 'Not Generated (0)' },\n    { value: 'GENERATED', label: 'Generated' },\n    { value: 'CANCELLED', label: 'Cancelled' },\n    { value: 'EXPIRED', label: 'Expired' },\n];\n\nconst transactionPeriods = [\n    { value: 'this_month', label: 'This Month' },\n    { value: 'last_month', label: 'Last Month' },\n    { value: 'this_year', label: 'This Year' },\n    { value: 'all', label: 'All Time' },\n];\n\nconst transactionTypeFilters = [\n    { value: 'invoices', label: 'Invoices' },\n    { value: 'credit_notes', label: 'Credit Notes' },\n    { value: 'delivery_challans', label: 'Delivery Challans' },\n    { value: 'all', label: 'All Types' },\n];\n\ninterface EWayBillDetailPanelProps {\n    bill: EWayBillDetail;\n    onClose: () => void;\n    onEdit: () => void;\n    onDelete: () => void;\n}\n\nfunction EWayBillDetailPanel({ bill, onClose, onEdit, onDelete }: EWayBillDetailPanelProps) {\n    return (\n        <div className=\"flex-1 flex flex-col bg-background\">\n            <div className=\"p-4 border-b flex items-center justify-between gap-4\">\n                <div className=\"flex items-center gap-2\">\n                    <FileText className=\"w-5 h-5\" />\n                    <h2 className=\"text-lg font-semibold\" data-testid=\"text-view-title\">\n                        {bill.ewayBillNumber}\n                    </h2>\n                    <Badge className={getStatusColor(bill.status)}>\n                        {bill.status}\n                    </Badge>\n                </div>\n                <Button variant=\"ghost\" size=\"icon\" onClick={onClose} data-testid=\"button-close-view\">\n                    <X className=\"w-4 h-4\" />\n                </Button>\n            </div>\n\n            <div className=\"flex items-center gap-2 px-4 py-2 border-b overflow-x-auto flex-wrap\">\n                <Button variant=\"ghost\" size=\"sm\" className=\"gap-1.5\" onClick={onEdit} data-testid=\"button-edit-eway-bill\">\n                    <Pencil className=\"h-3.5 w-3.5\" />\n                    Edit\n                </Button>\n                <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"gap-1.5 text-destructive\"\n                    onClick={onDelete}\n                    data-testid=\"button-delete-eway-bill\"\n                >\n                    <Trash2 className=\"h-3.5 w-3.5\" />\n                    Delete\n                </Button>\n            </div>\n\n            <ScrollArea className=\"flex-1 p-6\">\n                <div className=\"max-w-4xl space-y-6\">\n                    <div className=\"bg-white dark:bg-slate-800 rounded-lg border p-6 space-y-4\">\n                        <h3 className=\"font-semibold text-lg\">E-Way Bill Information</h3>\n\n                        <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                            <div>\n                                <span className=\"text-muted-foreground\">E-Way Bill Number:</span>\n                                <p className=\"font-medium\">{bill.ewayBillNumber}</p>\n                            </div>\n                            <div>\n                                <span className=\"text-muted-foreground\">Document Type:</span>\n                                <p className=\"font-medium capitalize\">{bill.documentType.replace('_', ' ')}</p>\n                            </div>\n                            <div>\n                                <span className=\"text-muted-foreground\">Transaction Sub Type:</span>\n                                <p className=\"font-medium capitalize\">{bill.transactionSubType.replace('_', ' ')}</p>\n                            </div>\n                            <div>\n                                <span className=\"text-muted-foreground\">Date:</span>\n                                <p className=\"font-medium\">{formatDate(bill.date)}</p>\n                            </div>\n                            <div>\n                                <span className=\"text-muted-foreground\">Expiry Date:</span>\n                                <p className=\"font-medium\">{formatDate(bill.expiryDate)}</p>\n                            </div>\n                            <div>\n                                <span className=\"text-muted-foreground\">Transaction Type:</span>\n                                <p className=\"font-medium capitalize\">{bill.transactionType.replace('_', ' ')}</p>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div className=\"bg-white dark:bg-slate-800 rounded-lg border p-6 space-y-4\">\n                        <h3 className=\"font-semibold text-lg\">Customer Information</h3>\n\n                        <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                            <div>\n                                <span className=\"text-muted-foreground\">Customer Name:</span>\n                                <p className=\"font-medium\">{bill.customerName}</p>\n                            </div>\n                            <div>\n                                <span className=\"text-muted-foreground\">Customer GSTIN:</span>\n                                <p className=\"font-medium\">{bill.customerGstin || '-'}</p>\n                            </div>\n                            <div>\n                                <span className=\"text-muted-foreground\">Document Number:</span>\n                                <p className=\"font-medium\">{bill.documentNumber || '-'}</p>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div className=\"bg-white dark:bg-slate-800 rounded-lg border p-6 space-y-4\">\n                        <h3 className=\"font-semibold text-lg\">Address Details</h3>\n\n                        <div className=\"grid grid-cols-2 gap-6\">\n                            <div>\n                                <h4 className=\"text-xs font-medium text-muted-foreground mb-2\">DISPATCH FROM</h4>\n                                <div className=\"text-sm space-y-0.5\">\n                                    {formatAddress(bill.dispatchFrom).map((line, i) => (\n                                        <p key={i}>{line}</p>\n                                    ))}\n                                </div>\n                            </div>\n                            <div>\n                                <h4 className=\"text-xs font-medium text-muted-foreground mb-2\">BILL FROM</h4>\n                                <div className=\"text-sm space-y-0.5\">\n                                    {formatAddress(bill.billFrom).map((line, i) => (\n                                        <p key={i}>{line}</p>\n                                    ))}\n                                </div>\n                            </div>\n                            <div>\n                                <h4 className=\"text-xs font-medium text-muted-foreground mb-2\">BILL TO</h4>\n                                <div className=\"text-sm space-y-0.5\">\n                                    {formatAddress(bill.billTo).map((line, i) => (\n                                        <p key={i}>{line}</p>\n                                    ))}\n                                </div>\n                            </div>\n                            <div>\n                                <h4 className=\"text-xs font-medium text-muted-foreground mb-2\">SHIP TO</h4>\n                                <div className=\"text-sm space-y-0.5\">\n                                    {formatAddress(bill.shipTo).map((line, i) => (\n                                        <p key={i}>{line}</p>\n                                    ))}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div className=\"bg-white dark:bg-slate-800 rounded-lg border p-6 space-y-4\">\n                        <h3 className=\"font-semibold text-lg\">Transportation Details</h3>\n\n                        <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                            <div>\n                                <span className=\"text-muted-foreground\">Place of Delivery:</span>\n                                <p className=\"font-medium\">{bill.placeOfDelivery || '-'}</p>\n                            </div>\n                            <div>\n                                <span className=\"text-muted-foreground\">Transporter:</span>\n                                <p className=\"font-medium capitalize\">{bill.transporter?.replace('_', ' ') || '-'}</p>\n                            </div>\n                            <div>\n                                <span className=\"text-muted-foreground\">Distance:</span>\n                                <p className=\"font-medium\">{bill.distance || 0} km</p>\n                            </div>\n                            <div>\n                                <span className=\"text-muted-foreground\">Mode of Transportation:</span>\n                                <p className=\"font-medium capitalize\">{bill.modeOfTransportation?.replace('_', ' ') || '-'}</p>\n                            </div>\n                            <div>\n                                <span className=\"text-muted-foreground\">Vehicle Type:</span>\n                                <p className=\"font-medium capitalize\">{bill.vehicleType?.replace('_', ' ') || '-'}</p>\n                            </div>\n                            <div>\n                                <span className=\"text-muted-foreground\">Vehicle Number:</span>\n                                <p className=\"font-medium\">{bill.vehicleNo || '-'}</p>\n                            </div>\n                            <div>\n                                <span className=\"text-muted-foreground\">Transporter Doc No:</span>\n                                <p className=\"font-medium\">{bill.transporterDocNo || '-'}</p>\n                            </div>\n                            <div>\n                                <span className=\"text-muted-foreground\">Transporter Doc Date:</span>\n                                <p className=\"font-medium\">{bill.transporterDocDate ? formatDate(bill.transporterDocDate) : '-'}</p>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div className=\"bg-white dark:bg-slate-800 rounded-lg border p-6 space-y-4\">\n                        <h3 className=\"font-semibold text-lg\">Total Amount</h3>\n                        <p className=\"text-2xl font-bold text-blue-600\">{formatCurrency(bill.total)}</p>\n                    </div>\n                </div>\n            </ScrollArea>\n        </div>\n    );\n}\n\nexport default function EWayBills() {\n    const { toast } = useToast();\n    const [ewayBills, setEwayBills] = useState<EWayBillListItem[]>([]);\n    const [selectedBill, setSelectedBill] = useState<EWayBillDetail | null>(null);\n    const [selectedBills, setSelectedBills] = useState<string[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n    const [billToDelete, setBillToDelete] = useState<string | null>(null);\n    const [showCreateForm, setShowCreateForm] = useState(false);\n    const [viewMode, setViewMode] = useState(false);\n\n    const [periodFilter, setPeriodFilter] = useState('this_month');\n    const [transactionTypeFilter, setTransactionTypeFilter] = useState('all');\n    const [statusFilter, setStatusFilter] = useState('all');\n\n    const [customers, setCustomers] = useState<Customer[]>([]);\n    const [creditNotes, setCreditNotes] = useState<CreditNote[]>([]);\n\n    const [formData, setFormData] = useState({\n        documentType: 'credit_notes',\n        transactionSubType: 'sales_return',\n        customerId: '',\n        customerName: '',\n        documentNumber: '',\n        documentId: '',\n        date: new Date().toISOString().split('T')[0],\n        transactionType: 'regular',\n        placeOfDelivery: '',\n        transporter: '',\n        distance: 0,\n        modeOfTransportation: 'road',\n        vehicleType: 'regular',\n        vehicleNo: '',\n        transporterDocNo: '',\n        transporterDocDate: '',\n    });\n\n    const [addressData, setAddressData] = useState({\n        dispatchFrom: {\n            street: 'Hinjewadi - Wakad road',\n            city: 'Hinjewadi',\n            state: 'Pune',\n            country: 'Maharashtra',\n            pincode: 'India - 411057',\n        },\n        billFrom: {\n            street: 'Hinjewadi - Wakad road',\n            city: 'Hinjewadi',\n            state: 'Pune',\n            country: 'Maharashtra',\n            pincode: 'India - 411057',\n        },\n        billTo: {\n            street: 'Plot No.G- 2 Katfal',\n            city: 'Baramati, Maharashtra',\n            state: 'Industrial Development',\n            country: 'Corporation Area, Baramati',\n            pincode: 'India - 413133',\n        },\n        shipTo: {\n            street: 'Plot No.G- 2 Katfal',\n            city: 'Baramati, Maharashtra',\n            state: 'Industrial Development',\n            country: 'Corporation Area, Baramati',\n            pincode: 'India - 413133',\n        },\n    });\n\n    const [fromInvoiceId, setFromInvoiceId] = useState<string | null>(null);\n    const [fromInvoiceNumber, setFromInvoiceNumber] = useState<string | null>(null);\n\n    useEffect(() => {\n        fetchEWayBills();\n        fetchCustomers();\n        fetchCreditNotes();\n        \n        // Check for fromInvoice parameter\n        const params = new URLSearchParams(window.location.search);\n        const invoiceId = params.get('fromInvoice');\n        if (invoiceId) {\n            setFromInvoiceId(invoiceId);\n            fetchInvoiceForEWayBill(invoiceId);\n        }\n    }, [periodFilter, transactionTypeFilter, statusFilter]);\n\n    const fetchInvoiceForEWayBill = async (invoiceId: string) => {\n        try {\n            const response = await fetch(`/api/invoices/${invoiceId}`);\n            if (response.ok) {\n                const data = await response.json();\n                const invoice = data.data;\n                \n                setFromInvoiceNumber(invoice.invoiceNumber);\n                setShowCreateForm(true);\n                \n                // Pre-populate form with invoice data\n                setFormData({\n                    ...formData,\n                    documentType: 'invoices',\n                    transactionSubType: 'supply',\n                    customerId: invoice.customerId || '',\n                    customerName: invoice.customerName || '',\n                    documentNumber: invoice.invoiceNumber || '',\n                    documentId: invoice.id || '',\n                    date: new Date().toISOString().split('T')[0],\n                    transactionType: 'regular',\n                });\n                \n                // Update address data from invoice\n                if (invoice.billingAddress) {\n                    setAddressData(prev => ({\n                        ...prev,\n                        billTo: {\n                            street: invoice.billingAddress.street || '',\n                            city: invoice.billingAddress.city || '',\n                            state: invoice.billingAddress.state || '',\n                            country: invoice.billingAddress.country || 'India',\n                            pincode: invoice.billingAddress.pincode || '',\n                        }\n                    }));\n                }\n                if (invoice.shippingAddress) {\n                    setAddressData(prev => ({\n                        ...prev,\n                        shipTo: {\n                            street: invoice.shippingAddress.street || '',\n                            city: invoice.shippingAddress.city || '',\n                            state: invoice.shippingAddress.state || '',\n                            country: invoice.shippingAddress.country || 'India',\n                            pincode: invoice.shippingAddress.pincode || '',\n                        }\n                    }));\n                }\n            }\n        } catch (error) {\n            console.error('Failed to fetch invoice for e-Way Bill:', error);\n        }\n    };\n\n    const fetchEWayBills = async () => {\n        try {\n            const params = new URLSearchParams();\n            if (periodFilter !== 'all') params.append('period', periodFilter);\n            if (transactionTypeFilter !== 'all') params.append('transactionType', transactionTypeFilter);\n            if (statusFilter !== 'all') params.append('status', statusFilter);\n\n            const response = await fetch(`/api/eway-bills?${params.toString()}`);\n            if (response.ok) {\n                const data = await response.json();\n                setEwayBills(data.data || []);\n            }\n        } catch (error) {\n            console.error('Failed to fetch e-way bills:', error);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const fetchCustomers = async () => {\n        try {\n            const response = await fetch('/api/customers');\n            if (response.ok) {\n                const data = await response.json();\n                setCustomers(data.data || []);\n            }\n        } catch (error) {\n            console.error('Failed to fetch customers:', error);\n        }\n    };\n\n    const fetchCreditNotes = async () => {\n        try {\n            const response = await fetch('/api/credit-notes');\n            if (response.ok) {\n                const data = await response.json();\n                setCreditNotes(data.data || []);\n            }\n        } catch (error) {\n            console.error('Failed to fetch credit notes:', error);\n        }\n    };\n\n    const fetchBillDetail = async (id: string) => {\n        try {\n            const response = await fetch(`/api/eway-bills/${id}`);\n            if (response.ok) {\n                const data = await response.json();\n                setSelectedBill(data.data);\n\n\n                if (data.data) {\n                    setFormData({\n                        documentType: data.data.documentType || 'credit_notes',\n                        transactionSubType: data.data.transactionSubType || 'sales_return',\n                        customerId: data.data.customerId || '',\n                        customerName: data.data.customerName || '',\n                        documentNumber: data.data.documentNumber || '',\n                        documentId: data.data.documentId || '',\n                        date: data.data.date || new Date().toISOString().split('T')[0],\n                        transactionType: data.data.transactionType || 'regular',\n                        placeOfDelivery: data.data.placeOfDelivery || '',\n                        transporter: data.data.transporter || '',\n                        distance: data.data.distance || 0,\n                        modeOfTransportation: data.data.modeOfTransportation || 'road',\n                        vehicleType: data.data.vehicleType || 'regular',\n                        vehicleNo: data.data.vehicleNo || '',\n                        transporterDocNo: data.data.transporterDocNo || '',\n                        transporterDocDate: data.data.transporterDocDate || '',\n                    });\n\n                    if (data.data.dispatchFrom || data.data.billFrom || data.data.billTo || data.data.shipTo) {\n                        setAddressData({\n                            dispatchFrom: data.data.dispatchFrom || addressData.dispatchFrom,\n                            billFrom: data.data.billFrom || addressData.billFrom,\n                            billTo: data.data.billTo || addressData.billTo,\n                            shipTo: data.data.shipTo || addressData.shipTo,\n                        });\n                    }\n                }\n            }\n        } catch (error) {\n            console.error('Failed to fetch bill detail:', error);\n        }\n    };\n\n    const handleSelectBill = (bill: EWayBillListItem) => {\n        fetchBillDetail(bill.id);\n        setViewMode(true);\n        setShowCreateForm(false);\n    };\n\n    const handleCloseDetail = () => {\n        setSelectedBill(null);\n        setShowCreateForm(false);\n        setViewMode(false);\n    };\n\n    const handleNewEWayBill = () => {\n        setSelectedBill(null);\n        setShowCreateForm(true);\n        setFormData({\n            documentType: 'credit_notes',\n            transactionSubType: 'sales_return',\n            customerId: '',\n            customerName: '',\n            documentNumber: '',\n            documentId: '',\n            date: new Date().toISOString().split('T')[0],\n            transactionType: 'regular',\n            placeOfDelivery: '',\n            transporter: '',\n            distance: 0,\n            modeOfTransportation: 'road',\n            vehicleType: 'regular',\n            vehicleNo: '',\n            transporterDocNo: '',\n            transporterDocDate: '',\n        });\n    };\n\n    const handleDeleteBill = async () => {\n        if (!billToDelete) return;\n\n        try {\n            const response = await fetch(`/api/eway-bills/${billToDelete}`, {\n                method: 'DELETE',\n            });\n\n            if (response.ok) {\n                toast({\n                    title: \"E-Way Bill Deleted\",\n                    description: \"The e-way bill has been deleted successfully.\",\n                });\n                fetchEWayBills();\n                if (selectedBill?.id === billToDelete) {\n                    setSelectedBill(null);\n                    setShowCreateForm(false);\n                }\n            }\n        } catch (error) {\n            toast({\n                title: \"Error\",\n                description: \"Failed to delete e-way bill. Please try again.\",\n                variant: \"destructive\"\n            });\n        } finally {\n            setDeleteDialogOpen(false);\n            setBillToDelete(null);\n        }\n    };\n\n    const handleSave = async () => {\n        try {\n            const payload = {\n                ...formData,\n                ...addressData,\n                status: 'NOT_GENERATED',\n            };\n\n            const url = selectedBill ? `/api/eway-bills/${selectedBill.id}` : '/api/eway-bills';\n            const method = selectedBill ? 'PUT' : 'POST';\n\n            const response = await fetch(url, {\n                method,\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify(payload),\n            });\n\n            if (response.ok) {\n                toast({\n                    title: \"E-Way Bill Saved\",\n                    description: \"The e-way bill has been saved as draft.\",\n                });\n                fetchEWayBills();\n                setShowCreateForm(false);\n                setSelectedBill(null);\n            }\n        } catch (error) {\n            toast({\n                title: \"Error\",\n                description: \"Failed to save e-way bill.\",\n                variant: \"destructive\"\n            });\n        }\n    };\n\n    const handleSaveAndGenerate = async () => {\n        try {\n            const payload = {\n                ...formData,\n                ...addressData,\n                status: 'NOT_GENERATED',\n            };\n\n            const url = selectedBill ? `/api/eway-bills/${selectedBill.id}` : '/api/eway-bills';\n            const method = selectedBill ? 'PUT' : 'POST';\n\n            const response = await fetch(url, {\n                method,\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify(payload),\n            });\n\n            if (response.ok) {\n                const data = await response.json();\n\n                const generateResponse = await fetch(`/api/eway-bills/${data.data.id}/generate`, {\n                    method: 'PATCH',\n                });\n\n                if (generateResponse.ok) {\n                    toast({\n                        title: \"E-Way Bill Generated\",\n                        description: \"The e-way bill has been generated successfully.\",\n                    });\n                }\n\n                fetchEWayBills();\n                setShowCreateForm(false);\n                setSelectedBill(null);\n            }\n        } catch (error) {\n            toast({\n                title: \"Error\",\n                description: \"Failed to generate e-way bill.\",\n                variant: \"destructive\"\n            });\n        }\n    };\n\n    const handleCancel = () => {\n        setShowCreateForm(false);\n        setSelectedBill(null);\n    };\n\n    const handleCustomerChange = (customerId: string) => {\n        const customer = customers.find(c => c.id === customerId);\n        if (customer) {\n            setFormData({\n                ...formData,\n                customerId: customer.id,\n                customerName: customer.displayName || customer.companyName,\n            });\n\n            if (customer.billingAddress || customer.shippingAddress) {\n                setAddressData({\n                    ...addressData,\n                    billTo: customer.billingAddress || addressData.billTo,\n                    shipTo: customer.shippingAddress || customer.billingAddress || addressData.shipTo,\n                });\n            }\n        }\n    };\n\n    const handleCreditNoteChange = (creditNoteId: string) => {\n        const creditNote = creditNotes.find(cn => cn.id === creditNoteId);\n        if (creditNote) {\n            setFormData({\n                ...formData,\n                documentNumber: creditNote.creditNoteNumber,\n                documentId: creditNote.id,\n                customerId: creditNote.customerId,\n                customerName: creditNote.customerName,\n            });\n        }\n    };\n\n    const handleSelectAll = (checked: boolean) => {\n        if (checked) {\n            setSelectedBills(ewayBills.map(b => b.id));\n        } else {\n            setSelectedBills([]);\n        }\n    };\n\n    const handleSelectOne = (id: string, checked: boolean) => {\n        if (checked) {\n            setSelectedBills([...selectedBills, id]);\n        } else {\n            setSelectedBills(selectedBills.filter(i => i !== id));\n        }\n    };\n\n    const { currentPage, totalPages, totalItems, itemsPerPage, paginatedItems, goToPage } = usePagination(ewayBills, 10);\n\n    return (\n        <div className=\"flex h-full\" data-testid=\"eway-bills-page\">\n            <div className={`${(viewMode || showCreateForm) ? 'hidden md:flex md:w-80 lg:w-96' : 'flex-1'} border-r flex flex-col bg-background transition-all duration-300`}>\n                <div className=\"p-4 border-b space-y-4\">\n                    <div className=\"flex items-center justify-between gap-2\">\n                        <h1 className=\"text-xl font-semibold\" data-testid=\"text-page-title\">e-Way Bills</h1>\n                        <div className=\"flex items-center gap-2\">\n                            <Button variant=\"outline\" size=\"sm\" className=\"text-blue-600\" data-testid=\"button-portal-settings\">\n                                <Settings className=\"w-4 h-4 mr-1\" />\n                                Change e-Way Bill Portal Settings\n                            </Button>\n                            <Button onClick={handleNewEWayBill} size=\"sm\" data-testid=\"button-new-eway-bill\">\n                                <Plus className=\"w-4 h-4 mr-1\" />\n                                New\n                            </Button>\n                        </div>\n                    </div>\n\n                    <div className=\"flex flex-wrap items-center gap-3\">\n                        <div className=\"flex items-center gap-2\">\n                            <span className=\"text-sm text-muted-foreground\">Transaction Period:</span>\n                            <Select value={periodFilter} onValueChange={setPeriodFilter} data-testid=\"select-period-filter\">\n                                <SelectTrigger className=\"w-[140px]\" data-testid=\"select-trigger-period\">\n                                    <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    {transactionPeriods.map((period) => (\n                                        <SelectItem key={period.value} value={period.value}>\n                                            {period.label}\n                                        </SelectItem>\n                                    ))}\n                                </SelectContent>\n                            </Select>\n                        </div>\n\n                        <div className=\"flex items-center gap-2\">\n                            <span className=\"text-sm text-muted-foreground\">Transaction Type:</span>\n                            <Select value={transactionTypeFilter} onValueChange={setTransactionTypeFilter} data-testid=\"select-type-filter\">\n                                <SelectTrigger className=\"w-[140px]\" data-testid=\"select-trigger-type\">\n                                    <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    {transactionTypeFilters.map((type) => (\n                                        <SelectItem key={type.value} value={type.value}>\n                                            {type.label}\n                                        </SelectItem>\n                                    ))}\n                                </SelectContent>\n                            </Select>\n                        </div>\n\n                        <div className=\"flex items-center gap-2\">\n                            <span className=\"text-sm text-muted-foreground\">e-Way Bill Status:</span>\n                            <Select value={statusFilter} onValueChange={setStatusFilter} data-testid=\"select-status-filter\">\n                                <SelectTrigger className=\"w-[160px]\" data-testid=\"select-trigger-status\">\n                                    <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    {ewayBillStatuses.map((status) => (\n                                        <SelectItem key={status.value} value={status.value}>\n                                            {status.label}\n                                        </SelectItem>\n                                    ))}\n                                </SelectContent>\n                            </Select>\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"flex-1 overflow-hidden\">\n                    <div className=\"overflow-x-auto\">\n                        <table className=\"w-full\" data-testid=\"table-eway-bills\">\n                            <thead className=\"bg-muted/50 sticky top-0\">\n                                <tr className=\"border-b\">\n                                    <th className=\"p-3 text-left w-10\">\n                                        <Checkbox\n                                            checked={selectedBills.length === ewayBills.length && ewayBills.length > 0}\n                                            onCheckedChange={handleSelectAll}\n                                            data-testid=\"checkbox-select-all\"\n                                        />\n                                    </th>\n                                    <th className=\"p-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider\">\n                                        Date\n                                        <ChevronDown className=\"w-3 h-3 inline ml-1\" />\n                                    </th>\n                                    <th className=\"p-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider\">Transaction#</th>\n                                    <th className=\"p-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider\">Customer Name</th>\n                                    <th className=\"p-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider\">Customer GSTIN</th>\n                                    <th className=\"p-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider\">Expiry Date</th>\n                                    <th className=\"p-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider\">Total</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                {loading ? (\n                                    <tr>\n                                        <td colSpan={7} className=\"p-8 text-center text-muted-foreground\" data-testid=\"text-loading\">\n                                            Loading e-way bills...\n                                        </td>\n                                    </tr>\n                                ) : ewayBills.length === 0 ? (\n                                    <tr>\n                                        <td colSpan={7} className=\"p-8 text-center text-muted-foreground\" data-testid=\"text-empty\">\n                                            Yay! You do not have any pending invoices for which e-way bills have to be generated.\n                                        </td>\n                                    </tr>\n                                ) : (\n                                    paginatedItems.map((bill) => (\n                                        <tr\n                                            key={bill.id}\n                                            className={`border-b cursor-pointer hover-elevate ${selectedBill?.id === bill.id ? 'bg-accent' : ''\n                                                }`}\n                                            onClick={() => handleSelectBill(bill)}\n                                            data-testid={`row-eway-bill-${bill.id}`}\n                                        >\n                                            <td className=\"p-3\">\n                                                <Checkbox\n                                                    checked={selectedBills.includes(bill.id)}\n                                                    onCheckedChange={(checked) => handleSelectOne(bill.id, checked as boolean)}\n                                                    onClick={(e) => e.stopPropagation()}\n                                                    data-testid={`checkbox-select-${bill.id}`}\n                                                />\n                                            </td>\n                                            <td className=\"p-3 text-sm\" data-testid={`text-date-${bill.id}`}>\n                                                {formatDate(bill.date)}\n                                            </td>\n                                            <td className=\"p-3 text-sm text-blue-600\" data-testid={`text-transaction-${bill.id}`}>\n                                                {bill.documentNumber || bill.ewayBillNumber}\n                                            </td>\n                                            <td className=\"p-3 text-sm\" data-testid={`text-customer-${bill.id}`}>\n                                                {bill.customerName}\n                                            </td>\n                                            <td className=\"p-3 text-sm\" data-testid={`text-gstin-${bill.id}`}>\n                                                {bill.customerGstin || '-'}\n                                            </td>\n                                            <td className=\"p-3 text-sm\" data-testid={`text-expiry-${bill.id}`}>\n                                                {formatDate(bill.expiryDate)}\n                                            </td>\n                                            <td className=\"p-3 text-sm text-right\" data-testid={`text-total-${bill.id}`}>\n                                                {formatCurrency(bill.total)}\n                                            </td>\n                                        </tr>\n                                    ))\n                                )}\n                            </tbody>\n                        </table>\n                        <TablePagination\n                            currentPage={currentPage}\n                            totalPages={totalPages}\n                            totalItems={totalItems}\n                            itemsPerPage={itemsPerPage}\n                            onPageChange={goToPage}\n                        />\n                    </div>\n                </div>\n            </div>\n\n            {viewMode && selectedBill && !showCreateForm && (\n                <EWayBillDetailPanel\n                    bill={selectedBill}\n                    onClose={handleCloseDetail}\n                    onEdit={() => {\n                        setViewMode(false);\n                        setShowCreateForm(true);\n                    }}\n                    onDelete={() => {\n                        setBillToDelete(selectedBill.id);\n                        setDeleteDialogOpen(true);\n                    }}\n                />\n            )}\n\n            {showCreateForm && (\n                <div className=\"flex-1 flex flex-col bg-background\">\n                    <div className=\"p-4 border-b flex items-center justify-between gap-4\">\n                        <div className=\"flex items-center gap-2\">\n                            <FileText className=\"w-5 h-5\" />\n                            <h2 className=\"text-lg font-semibold\" data-testid=\"text-form-title\">\n                                {selectedBill ? 'Edit E-Way Bill' : 'New e-Way Bill'}\n                            </h2>\n                            {fromInvoiceNumber && (\n                                <Badge className=\"bg-blue-100 text-blue-700 border-blue-200\">\n                                    From Invoice #{fromInvoiceNumber}\n                                </Badge>\n                            )}\n                        </div>\n                        <Button variant=\"ghost\" size=\"icon\" onClick={handleCloseDetail} data-testid=\"button-close-form\">\n                            <X className=\"w-4 h-4\" />\n                        </Button>\n                    </div>\n\n                    <ScrollArea className=\"flex-1 p-6\">\n                        <div className=\"max-w-4xl space-y-6\">\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <div className=\"space-y-2\">\n                                    <Label className=\"text-red-500\">Document Type*</Label>\n                                    <Select\n                                        value={formData.documentType}\n                                        onValueChange={(value) => setFormData({ ...formData, documentType: value })}\n                                        data-testid=\"select-document-type\"\n                                    >\n                                        <SelectTrigger data-testid=\"select-trigger-document-type\">\n                                            <SelectValue placeholder=\"Select document type\" />\n                                        </SelectTrigger>\n                                        <SelectContent>\n                                            {documentTypes.map((type) => (\n                                                <SelectItem key={type.value} value={type.value}>\n                                                    {type.label}\n                                                </SelectItem>\n                                            ))}\n                                        </SelectContent>\n                                    </Select>\n                                </div>\n\n                                <div className=\"space-y-2\">\n                                    <Label className=\"text-red-500\">Transaction Sub Type*</Label>\n                                    <Select\n                                        value={formData.transactionSubType}\n                                        onValueChange={(value) => setFormData({ ...formData, transactionSubType: value })}\n                                        data-testid=\"select-transaction-sub-type\"\n                                    >\n                                        <SelectTrigger data-testid=\"select-trigger-transaction-sub-type\">\n                                            <SelectValue placeholder=\"Select sub type\" />\n                                        </SelectTrigger>\n                                        <SelectContent>\n                                            {transactionSubTypes.map((type) => (\n                                                <SelectItem key={type.value} value={type.value}>\n                                                    {type.label}\n                                                </SelectItem>\n                                            ))}\n                                        </SelectContent>\n                                    </Select>\n                                </div>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label className=\"text-red-500\">Customer Name*</Label>\n                                <Select\n                                    value={formData.customerId}\n                                    onValueChange={handleCustomerChange}\n                                    data-testid=\"select-customer-name\"\n                                >\n                                    <SelectTrigger data-testid=\"select-trigger-customer-name\">\n                                        <SelectValue placeholder=\"Select customer\" />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                        {customers.map((customer) => (\n                                            <SelectItem key={customer.id} value={customer.id}>\n                                                {customer.displayName || customer.companyName}\n                                            </SelectItem>\n                                        ))}\n                                    </SelectContent>\n                                </Select>\n                            </div>\n\n                            {formData.documentType === 'credit_notes' && (\n                                <div className=\"grid grid-cols-3 gap-4\">\n                                    <div className=\"space-y-2\">\n                                        <Label className=\"text-red-500\">Credit Note#*</Label>\n                                        <Select\n                                            value={formData.documentId}\n                                            onValueChange={handleCreditNoteChange}\n                                            data-testid=\"select-credit-note\"\n                                        >\n                                            <SelectTrigger data-testid=\"select-trigger-credit-note\">\n                                                <SelectValue placeholder=\"Select credit note\" />\n                                            </SelectTrigger>\n                                            <SelectContent>\n                                                {creditNotes.map((cn) => (\n                                                    <SelectItem key={cn.id} value={cn.id}>\n                                                        {cn.creditNoteNumber}\n                                                    </SelectItem>\n                                                ))}\n                                            </SelectContent>\n                                        </Select>\n                                    </div>\n                                    <div className=\"space-y-2\">\n                                        <Label>Date</Label>\n                                        <Input\n                                            type=\"date\"\n                                            value={formData.date}\n                                            onChange={(e) => setFormData({ ...formData, date: e.target.value })}\n                                            data-testid=\"input-date\"\n                                        />\n                                    </div>\n                                    <div className=\"space-y-2\">\n                                        <Label className=\"text-red-500\">Transaction Type*</Label>\n                                        <Select\n                                            value={formData.transactionType}\n                                            onValueChange={(value) => setFormData({ ...formData, transactionType: value })}\n                                            data-testid=\"select-transaction-type\"\n                                        >\n                                            <SelectTrigger data-testid=\"select-trigger-transaction-type\">\n                                                <SelectValue placeholder=\"Select type\" />\n                                            </SelectTrigger>\n                                            <SelectContent>\n                                                {transactionTypes.map((type) => (\n                                                    <SelectItem key={type.value} value={type.value}>\n                                                        {type.label}\n                                                    </SelectItem>\n                                                ))}\n                                            </SelectContent>\n                                        </Select>\n                                    </div>\n                                </div>\n                            )}\n\n                            <div className=\"space-y-4\">\n                                <h3 className=\"font-medium text-sm text-muted-foreground\">Address Details</h3>\n                                <div className=\"grid grid-cols-4 gap-4\">\n                                    <div className=\"space-y-2\">\n                                        <Label className=\"text-xs font-medium text-muted-foreground flex items-center gap-1\">\n                                            DISPATCH FROM <Pencil className=\"w-3 h-3 cursor-pointer text-blue-500\" />\n                                        </Label>\n                                        <div className=\"text-sm space-y-0.5\">\n                                            {formatAddress(addressData.dispatchFrom).map((line, i) => (\n                                                <p key={i}>{line}</p>\n                                            ))}\n                                        </div>\n                                    </div>\n                                    <div className=\"space-y-2\">\n                                        <Label className=\"text-xs font-medium text-muted-foreground\">BILL FROM</Label>\n                                        <div className=\"text-sm space-y-0.5\">\n                                            {formatAddress(addressData.billFrom).map((line, i) => (\n                                                <p key={i}>{line}</p>\n                                            ))}\n                                        </div>\n                                    </div>\n                                    <div className=\"space-y-2\">\n                                        <Label className=\"text-xs font-medium text-muted-foreground\">BILL TO</Label>\n                                        <div className=\"text-sm space-y-0.5\">\n                                            {formatAddress(addressData.billTo).map((line, i) => (\n                                                <p key={i}>{line}</p>\n                                            ))}\n                                        </div>\n                                    </div>\n                                    <div className=\"space-y-2\">\n                                        <Label className=\"text-xs font-medium text-muted-foreground\">SHIP TO</Label>\n                                        <div className=\"text-sm space-y-0.5\">\n                                            {formatAddress(addressData.shipTo).map((line, i) => (\n                                                <p key={i}>{line}</p>\n                                            ))}\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label className=\"text-red-500\">Place of Delivery*</Label>\n                                <Select\n                                    value={formData.placeOfDelivery}\n                                    onValueChange={(value) => setFormData({ ...formData, placeOfDelivery: value })}\n                                    data-testid=\"select-place-of-delivery\"\n                                >\n                                    <SelectTrigger data-testid=\"select-trigger-place-of-delivery\">\n                                        <SelectValue placeholder=\"Select state\" />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                        <SelectItem value=\"[MH] - Maharashtra\">[MH] - Maharashtra</SelectItem>\n                                        <SelectItem value=\"[GJ] - Gujarat\">[GJ] - Gujarat</SelectItem>\n                                        <SelectItem value=\"[KA] - Karnataka\">[KA] - Karnataka</SelectItem>\n                                        <SelectItem value=\"[TN] - Tamil Nadu\">[TN] - Tamil Nadu</SelectItem>\n                                        <SelectItem value=\"[DL] - Delhi\">[DL] - Delhi</SelectItem>\n                                        <SelectItem value=\"[RJ] - Rajasthan\">[RJ] - Rajasthan</SelectItem>\n                                        <SelectItem value=\"[UP] - Uttar Pradesh\">[UP] - Uttar Pradesh</SelectItem>\n                                        <SelectItem value=\"[WB] - West Bengal\">[WB] - West Bengal</SelectItem>\n                                    </SelectContent>\n                                </Select>\n                            </div>\n\n                            <div className=\"flex items-center gap-2 text-blue-600 cursor-pointer hover:underline\">\n                                <FileText className=\"w-4 h-4\" />\n                                <span className=\"text-sm\" data-testid=\"link-item-details\">Item Details</span>\n                                <ExternalLink className=\"w-3 h-3\" />\n                            </div>\n\n                            <div className=\"space-y-4 pt-4 border-t\">\n                                <h3 className=\"font-semibold text-sm\">TRANSPORTATION DETAILS</h3>\n\n                                <div className=\"space-y-2\">\n                                    <Label>Transporter</Label>\n                                    <Select\n                                        value={formData.transporter}\n                                        onValueChange={(value) => setFormData({ ...formData, transporter: value })}\n                                        data-testid=\"select-transporter\"\n                                    >\n                                        <SelectTrigger data-testid=\"select-trigger-transporter\">\n                                            <SelectValue placeholder=\"Select the transporter's name\" />\n                                        </SelectTrigger>\n                                        <SelectContent>\n                                            <SelectItem value=\"transporter1\">Transporter 1</SelectItem>\n                                            <SelectItem value=\"transporter2\">Transporter 2</SelectItem>\n                                            <SelectItem value=\"transporter3\">Transporter 3</SelectItem>\n                                        </SelectContent>\n                                    </Select>\n                                </div>\n\n                                <div className=\"space-y-2\">\n                                    <Label className=\"text-red-500\">Distance (In Km)*</Label>\n                                    <div className=\"flex items-center gap-4\">\n                                        <Input\n                                            type=\"number\"\n                                            value={formData.distance}\n                                            onChange={(e) => setFormData({ ...formData, distance: parseInt(e.target.value) || 0 })}\n                                            placeholder=\"0\"\n                                            className=\"max-w-[200px]\"\n                                            data-testid=\"input-distance\"\n                                        />\n                                        <a href=\"#\" className=\"text-blue-600 text-sm hover:underline flex items-center gap-1\" data-testid=\"link-calculate-distance\">\n                                            Calculate Distance\n                                            <ExternalLink className=\"w-3 h-3\" />\n                                        </a>\n                                    </div>\n                                    <p className=\"text-xs text-muted-foreground\">\n                                        If you enter 0 as the distance, e-Way Bill system will automatically calculate it based on the dispatch and delivery locations.\n                                    </p>\n                                </div>\n\n                                <div className=\"space-y-4 pt-4\">\n                                    <h4 className=\"font-medium text-sm\">PART B</h4>\n\n                                    <div className=\"space-y-2\">\n                                        <Label>Mode of Transportation</Label>\n                                        <Tabs value={formData.modeOfTransportation} onValueChange={(value) => setFormData({ ...formData, modeOfTransportation: value })}>\n                                            <TabsList className=\"grid grid-cols-4 w-fit\" data-testid=\"tabs-transport-mode\">\n                                                <TabsTrigger value=\"road\" className=\"flex items-center gap-1\" data-testid=\"tab-road\">\n                                                    <Truck className=\"w-4 h-4\" /> Road\n                                                </TabsTrigger>\n                                                <TabsTrigger value=\"rail\" className=\"flex items-center gap-1\" data-testid=\"tab-rail\">\n                                                    <Train className=\"w-4 h-4\" /> Rail\n                                                </TabsTrigger>\n                                                <TabsTrigger value=\"air\" className=\"flex items-center gap-1\" data-testid=\"tab-air\">\n                                                    <Plane className=\"w-4 h-4\" /> Air\n                                                </TabsTrigger>\n                                                <TabsTrigger value=\"ship\" className=\"flex items-center gap-1\" data-testid=\"tab-ship\">\n                                                    <Ship className=\"w-4 h-4\" /> Ship\n                                                </TabsTrigger>\n                                            </TabsList>\n                                        </Tabs>\n                                    </div>\n\n                                    <div className=\"space-y-2\">\n                                        <Label>Vehicle Type</Label>\n                                        <RadioGroup\n                                            value={formData.vehicleType}\n                                            onValueChange={(value) => setFormData({ ...formData, vehicleType: value })}\n                                            className=\"flex items-center gap-6\"\n                                            data-testid=\"radio-vehicle-type\"\n                                        >\n                                            <div className=\"flex items-center space-x-2\">\n                                                <RadioGroupItem value=\"regular\" id=\"regular\" data-testid=\"radio-regular\" />\n                                                <Label htmlFor=\"regular\" className=\"font-normal\">Regular</Label>\n                                            </div>\n                                            <div className=\"flex items-center space-x-2\">\n                                                <RadioGroupItem value=\"over_dimensional\" id=\"over_dimensional\" data-testid=\"radio-over-dimensional\" />\n                                                <Label htmlFor=\"over_dimensional\" className=\"font-normal\">Over Dimensional Cargo</Label>\n                                            </div>\n                                        </RadioGroup>\n                                    </div>\n\n                                    <div className=\"space-y-2\">\n                                        <Label>Vehicle No</Label>\n                                        <Input\n                                            value={formData.vehicleNo}\n                                            onChange={(e) => setFormData({ ...formData, vehicleNo: e.target.value })}\n                                            placeholder=\"Enter vehicle number\"\n                                            data-testid=\"input-vehicle-no\"\n                                        />\n                                    </div>\n\n                                    <div className=\"space-y-2\">\n                                        <Label>Transporter's Doc No</Label>\n                                        <Input\n                                            value={formData.transporterDocNo}\n                                            onChange={(e) => setFormData({ ...formData, transporterDocNo: e.target.value })}\n                                            placeholder=\"Enter document number\"\n                                            data-testid=\"input-transporter-doc-no\"\n                                        />\n                                    </div>\n\n                                    <div className=\"space-y-2\">\n                                        <Label>Transporter's Doc Date</Label>\n                                        <Input\n                                            type=\"date\"\n                                            value={formData.transporterDocDate}\n                                            onChange={(e) => setFormData({ ...formData, transporterDocDate: e.target.value })}\n                                            placeholder=\"dd/MM/yyyy\"\n                                            data-testid=\"input-transporter-doc-date\"\n                                        />\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </ScrollArea>\n\n                    <div className=\"p-4 border-t flex items-center gap-2\">\n                        <Button onClick={handleSave} data-testid=\"button-save\">\n                            Save\n                        </Button>\n                        <Button variant=\"default\" className=\"bg-blue-600 hover:bg-blue-700\" onClick={handleSaveAndGenerate} data-testid=\"button-save-generate\">\n                            Save and Generate\n                        </Button>\n                        <Button variant=\"outline\" onClick={handleCancel} data-testid=\"button-cancel\">\n                            Cancel\n                        </Button>\n                    </div>\n                </div>\n            )}\n\n            <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>Delete E-Way Bill</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            Are you sure you want to delete this e-way bill? This action cannot be undone.\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel data-testid=\"button-cancel-delete\">Cancel</AlertDialogCancel>\n                        <AlertDialogAction onClick={handleDeleteBill} className=\"bg-red-600 hover:bg-red-700\" data-testid=\"button-confirm-delete\">\n                            Delete\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </div>\n    );\n}\n","path":null,"size_bytes":66204,"size_tokens":null},"client/src/pages/payments-received.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport {\n  Plus, Search, ChevronDown, MoreHorizontal, Pencil, Trash2,\n  X, Send, FileText, Printer, Download, RefreshCw, Eye,\n  Check, Filter\n} from \"lucide-react\";\nimport { usePagination } from \"@/hooks/use-pagination\";\nimport { TablePagination } from \"@/components/table-pagination\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\n\ninterface JournalEntry {\n  account: string;\n  debit: number;\n  credit: number;\n}\n\ninterface PaymentReceived {\n  id: string;\n  paymentNumber: string;\n  date: string;\n  referenceNumber: string;\n  customerId: string;\n  customerName: string;\n  customerEmail: string;\n  invoices: any[];\n  mode: string;\n  depositTo: string;\n  amount: number;\n  unusedAmount: number;\n  bankCharges: number;\n  tax: string;\n  taxAmount: number;\n  notes: string;\n  attachments: string[];\n  sendThankYou: boolean;\n  status: string;\n  paymentType: string;\n  placeOfSupply: string;\n  descriptionOfSupply: string;\n  amountInWords: string;\n  journalEntries: JournalEntry[];\n  createdAt: string;\n}\n\ninterface Customer {\n  id: string;\n  displayName: string;\n  companyName: string;\n  email: string;\n  pan?: string;\n  gstin?: string;\n  gstTreatment?: string;\n  placeOfSupply?: string;\n}\n\ninterface Invoice {\n  id: string;\n  invoiceNumber: string;\n  date: string;\n  amount: number;\n  balanceDue: number;\n  status: string;\n}\n\nfunction formatCurrency(amount: number): string {\n  return new Intl.NumberFormat('en-IN', {\n    style: 'currency',\n    currency: 'INR',\n    minimumFractionDigits: 2\n  }).format(amount);\n}\n\nfunction formatDate(dateString: string): string {\n  if (!dateString) return '-';\n  const date = new Date(dateString);\n  return date.toLocaleDateString('en-IN', { day: '2-digit', month: '2-digit', year: 'numeric' });\n}\n\nfunction PaymentReceiptView({ payment }: { payment: PaymentReceived }) {\n  const companyInfo = {\n    name: \"SkilltonIT\",\n    address: \"Hinjawadi - Wakad road\",\n    city: \"Hinjewadi\",\n    state: \"Pune Maharashtra 411057\",\n    country: \"India\",\n    gstin: \"27ITRZAP3A51K1Z01\",\n    email: \"Sales.SkilltonIT@skilltonit.com\",\n    website: \"www.skilltonit.com\"\n  };\n\n  return (\n    <div className=\"bg-white border border-slate-200 shadow-sm max-w-3xl mx-auto\">\n      <div className=\"relative\">\n        <div className=\"absolute top-4 left-4\">\n          <Badge className=\"bg-green-500 text-white border-0 px-3 py-1 text-xs font-semibold rotate-[-5deg]\">\n            Paid\n          </Badge>\n        </div>\n\n        <div className=\"p-8\">\n          <div className=\"flex justify-between items-start mb-8\">\n            <div>\n              <div className=\"flex items-center gap-2 mb-3\">\n                <div className=\"w-8 h-8 bg-green-600 rounded flex items-center justify-center\">\n                  <span className=\"text-white font-bold text-sm\">S</span>\n                </div>\n                <span className=\"text-lg font-bold text-green-600\">{companyInfo.name}</span>\n              </div>\n              <div className=\"text-sm text-slate-600 space-y-0.5\">\n                <p>{companyInfo.address}</p>\n                <p>{companyInfo.city}</p>\n                <p>{companyInfo.state}</p>\n                <p>{companyInfo.country}</p>\n                <p>GSTIN {companyInfo.gstin}</p>\n                <p className=\"text-blue-600\">{companyInfo.email}</p>\n                <p className=\"text-blue-600\">{companyInfo.website}</p>\n              </div>\n            </div>\n          </div>\n\n          <h2 className=\"text-2xl font-bold text-center mb-8 text-slate-700\">PAYMENT RECEIPT</h2>\n\n          <div className=\"space-y-3 mb-6\">\n            <div className=\"flex justify-between items-center border-b border-slate-100 py-2\">\n              <span className=\"text-slate-500 text-sm\">Payment Date</span>\n              <span className=\"font-medium\">{formatDate(payment.date)}</span>\n            </div>\n            <div className=\"flex justify-between items-center border-b border-slate-100 py-2\">\n              <span className=\"text-slate-500 text-sm\">Reference Number</span>\n              <span className=\"font-medium\">{payment.referenceNumber || '-'}</span>\n            </div>\n            <div className=\"flex justify-between items-center border-b border-slate-100 py-2\">\n              <span className=\"text-slate-500 text-sm\">Payment Mode</span>\n              <span className=\"font-medium\">{payment.mode}</span>\n            </div>\n          </div>\n\n          <div className=\"flex justify-between items-start mb-6\">\n            <div>\n              <span className=\"text-sm text-slate-500\">Amount Received In Words</span>\n              <p className=\"font-medium text-slate-800\">{payment.amountInWords}</p>\n            </div>\n            <div className=\"bg-green-600 text-white px-6 py-4 text-center rounded\">\n              <div className=\"text-sm\">Amount Received</div>\n              <div className=\"text-2xl font-bold\">{formatCurrency(payment.amount)}</div>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-8 mb-6\">\n            <div>\n              <h4 className=\"text-sm font-semibold text-slate-500 mb-2\">Received From</h4>\n              <p className=\"font-semibold text-blue-600\">{payment.customerName}</p>\n              <p className=\"text-sm text-slate-600\">{payment.placeOfSupply}</p>\n              <p className=\"text-sm text-slate-600\">India</p>\n            </div>\n            <div className=\"text-right\">\n              <p className=\"text-sm text-slate-500\">Authorised Signatory</p>\n            </div>\n          </div>\n\n          <div className=\"border-t border-slate-200 pt-4 mt-8\">\n            <div className=\"text-center text-sm\">\n              <p>Over payment</p>\n              <p className=\"text-xl font-bold\">{formatCurrency(payment.unusedAmount)}</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction PaymentDetailPanel({\n  payment,\n  onClose,\n  onEdit,\n  onDelete,\n  onRefund\n}: {\n  payment: PaymentReceived;\n  onClose: () => void;\n  onEdit: () => void;\n  onDelete: () => void;\n  onRefund: () => void;\n}) {\n  const [showPdfView, setShowPdfView] = useState(false);\n\n  return (\n    <div className=\"h-full flex flex-col bg-white border-l border-slate-200 overflow-hidden\">\n      <div className=\"flex items-center justify-between px-4 py-3 border-b border-slate-200 bg-slate-50\">\n        <h2 className=\"text-lg font-semibold text-slate-900\" data-testid=\"text-payment-number\">{payment.paymentNumber}</h2>\n        <div className=\"flex items-center gap-1\">\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n            <Download className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n            <Printer className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n            <Eye className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={onClose} data-testid=\"button-close-panel\">\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"flex items-center gap-2 px-4 py-2 border-b border-slate-200 overflow-x-auto bg-white\">\n        <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\" onClick={onEdit} data-testid=\"button-edit-payment\">\n          <Pencil className=\"h-3.5 w-3.5\" />\n          Edit\n        </Button>\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\">\n              <Send className=\"h-3.5 w-3.5\" />\n              Send\n              <ChevronDown className=\"h-3 w-3\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent>\n            <DropdownMenuItem>Send via Email</DropdownMenuItem>\n            <DropdownMenuItem>Send via SMS</DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\">\n              <FileText className=\"h-3.5 w-3.5\" />\n              PDF/Print\n              <ChevronDown className=\"h-3 w-3\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent>\n            <DropdownMenuItem>\n              <Download className=\"mr-2 h-4 w-4\" /> Download PDF\n            </DropdownMenuItem>\n            <DropdownMenuItem>\n              <Printer className=\"mr-2 h-4 w-4\" /> Print\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n        <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\" onClick={onRefund}>\n          <RefreshCw className=\"h-3.5 w-3.5\" />\n          Refund\n        </Button>\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 gap-1.5\" data-testid=\"button-more-actions\">\n              <MoreHorizontal className=\"h-3.5 w-3.5\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\">\n            <DropdownMenuSeparator />\n            <DropdownMenuItem className=\"text-red-600\" onClick={onDelete}>\n              <Trash2 className=\"mr-2 h-4 w-4\" />\n              Delete\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n      </div>\n\n      <div className=\"px-4 py-3 border-b border-slate-200 flex items-center justify-end\">\n        <div className=\"flex items-center gap-2\">\n          <Label htmlFor=\"pdf-view\" className=\"text-sm text-slate-500\">Show PDF View</Label>\n          <Switch id=\"pdf-view\" checked={showPdfView} onCheckedChange={setShowPdfView} />\n        </div>\n      </div>\n\n      <ScrollArea className=\"flex-1\">\n        <div className=\"p-4\">\n          {showPdfView ? (\n            <PaymentReceiptView payment={payment} />\n          ) : (\n            <div className=\"space-y-6\">\n              <div className=\"flex items-center justify-between p-4 bg-slate-50 rounded-lg\">\n                <div>\n                  <p className=\"text-sm text-slate-500\">Customer</p>\n                  <p className=\"font-semibold text-blue-600\">{payment.customerName}</p>\n                </div>\n                <div className=\"text-right\">\n                  <p className=\"text-sm text-slate-500\">Amount</p>\n                  <p className=\"text-2xl font-bold text-slate-900\">{formatCurrency(payment.amount)}</p>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <p className=\"text-sm text-slate-500\">Payment Date</p>\n                  <p className=\"font-medium\">{formatDate(payment.date)}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-slate-500\">Payment #</p>\n                  <p className=\"font-medium\">{payment.paymentNumber}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-slate-500\">Payment Mode</p>\n                  <p className=\"font-medium\">{payment.mode}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-slate-500\">Deposit To</p>\n                  <p className=\"font-medium\">{payment.depositTo}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-slate-500\">Reference Number</p>\n                  <p className=\"font-medium\">{payment.referenceNumber || '-'}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-slate-500\">Status</p>\n                  <Badge variant=\"outline\" className=\"text-green-600 border-green-200 bg-green-50\">\n                    {payment.status}\n                  </Badge>\n                </div>\n              </div>\n\n              <div className=\"border-t pt-4\">\n                <h4 className=\"font-semibold mb-3\">More Information</h4>\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-slate-500\">Deposit To</span>\n                    <span className=\"text-blue-600\">{payment.depositTo}</span>\n                  </div>\n                </div>\n              </div>\n\n              {payment.journalEntries && payment.journalEntries.length > 0 && (\n                <div className=\"border-t pt-4\">\n                  <div className=\"flex items-center justify-between mb-3\">\n                    <h4 className=\"font-semibold\">Journal</h4>\n                    <span className=\"text-xs text-slate-500 bg-slate-100 px-2 py-1 rounded\">INR</span>\n                  </div>\n                  <p className=\"text-sm text-slate-500 mb-2\">Amount is displayed in your base currency</p>\n                  <div className=\"flex items-center gap-2 mb-3\">\n                    <span className=\"text-sm font-medium\">Customer Payment - {payment.paymentNumber}</span>\n                    <Button variant=\"outline\" size=\"sm\" className=\"h-6 text-xs\">Accrual</Button>\n                    <Button variant=\"outline\" size=\"sm\" className=\"h-6 text-xs\">Cash</Button>\n                  </div>\n                  <Table>\n                    <TableHeader>\n                      <TableRow className=\"bg-slate-50\">\n                        <TableHead className=\"text-xs\">ACCOUNT</TableHead>\n                        <TableHead className=\"text-xs text-right\">DEBIT</TableHead>\n                        <TableHead className=\"text-xs text-right\">CREDIT</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {payment.journalEntries.map((entry, index) => (\n                        <TableRow key={index}>\n                          <TableCell className=\"text-sm\">{entry.account}</TableCell>\n                          <TableCell className=\"text-sm text-right\">{entry.debit > 0 ? formatCurrency(entry.debit).replace('', '') : '0.00'}</TableCell>\n                          <TableCell className=\"text-sm text-right\">{entry.credit > 0 ? formatCurrency(entry.credit).replace('', '') : '0.00'}</TableCell>\n                        </TableRow>\n                      ))}\n                      <TableRow className=\"border-t-2\">\n                        <TableCell className=\"font-semibold\">Total</TableCell>\n                        <TableCell className=\"font-semibold text-right\">\n                          {formatCurrency(payment.journalEntries.reduce((sum, e) => sum + e.debit, 0)).replace('', '')}\n                        </TableCell>\n                        <TableCell className=\"font-semibold text-right\">\n                          {formatCurrency(payment.journalEntries.reduce((sum, e) => sum + e.credit, 0)).replace('', '')}\n                        </TableCell>\n                      </TableRow>\n                    </TableBody>\n                  </Table>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n      </ScrollArea>\n\n      <div className=\"border-t border-slate-200 p-3 text-center text-xs text-slate-500\">\n        PDF Template: <span className=\"text-blue-600\">Elite Template</span>\n        <button className=\"text-blue-600 ml-2\">Change</button>\n      </div>\n    </div>\n  );\n}\n\nfunction PaymentCreateDialog({\n  open,\n  onOpenChange,\n  onSave,\n  customers,\n  editPayment\n}: {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSave: (payment: any) => void;\n  customers: Customer[];\n  editPayment?: PaymentReceived | null;\n}) {\n  const [paymentType, setPaymentType] = useState<'invoice_payment' | 'customer_advance'>('invoice_payment');\n  const [formData, setFormData] = useState({\n    customerId: '',\n    customerName: '',\n    customerEmail: '',\n    amount: '',\n    bankCharges: '',\n    tax: '',\n    date: new Date().toISOString().split('T')[0],\n    paymentNumber: '',\n    mode: 'Cash',\n    depositTo: 'Petty Cash',\n    referenceNumber: '',\n    taxDeducted: 'no',\n    notes: '',\n    sendThankYou: true,\n    placeOfSupply: '',\n    descriptionOfSupply: ''\n  });\n  const [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(null);\n  const [unpaidInvoices, setUnpaidInvoices] = useState<Invoice[]>([]);\n  const [selectedInvoices, setSelectedInvoices] = useState<Record<string, { payment: number; receivedDate: string }>>({});\n\n  // Auto-allocation function\n  const autoAllocatePayment = (totalAmount: number, invoices: Invoice[]) => {\n    if (invoices.length === 0) {\n      setSelectedInvoices({});\n      return;\n    }\n\n    if (totalAmount <= 0) {\n      setSelectedInvoices({});\n      return;\n    }\n\n    // Sort invoices by date (oldest first)\n    const sortedInvoices = [...invoices].sort((a, b) =>\n      new Date(a.date).getTime() - new Date(b.date).getTime()\n    );\n\n    let remainingAmount = totalAmount;\n    const newSelectedInvoices: Record<string, { payment: number; receivedDate: string }> = {};\n\n    for (const invoice of sortedInvoices) {\n      if (remainingAmount <= 0) break;\n\n      const invoiceBalance = invoice.balanceDue > 0 ? invoice.balanceDue : invoice.amount;\n      if (invoiceBalance > 0) {\n        const paymentAmount = Math.min(remainingAmount, invoiceBalance);\n        newSelectedInvoices[invoice.id] = {\n          payment: paymentAmount,\n          receivedDate: new Date().toISOString().split('T')[0]\n        };\n        remainingAmount -= paymentAmount;\n        console.log(`Allocated ${paymentAmount} to ${invoice.invoiceNumber}, remaining: ${remainingAmount}`);\n      }\n    }\n\n    setSelectedInvoices(newSelectedInvoices);\n  };\n\n  // Handle amount change with auto-allocation\n  const handleAmountChange = (amount: string) => {\n    setFormData(prev => ({ ...prev, amount }));\n    const numAmount = parseFloat(amount) || 0;\n    if (numAmount > 0 && paymentType === 'invoice_payment') {\n      autoAllocatePayment(numAmount, unpaidInvoices);\n    } else {\n      setSelectedInvoices({});\n    }\n  };\n\n  // Calculate totals\n  const totalPaymentAmount = Object.values(selectedInvoices).reduce((sum, inv) => sum + inv.payment, 0);\n  const amountReceived = parseFloat(formData.amount) || 0;\n  const amountInExcess = Math.max(0, amountReceived - totalPaymentAmount);\n\n  useEffect(() => {\n    if (editPayment) {\n      setPaymentType(editPayment.paymentType === 'customer_advance' ? 'customer_advance' : 'invoice_payment');\n      setFormData({\n        customerId: editPayment.customerId,\n        customerName: editPayment.customerName,\n        customerEmail: editPayment.customerEmail,\n        amount: String(editPayment.amount),\n        bankCharges: String(editPayment.bankCharges || ''),\n        tax: editPayment.tax,\n        date: editPayment.date,\n        paymentNumber: editPayment.paymentNumber,\n        mode: editPayment.mode,\n        depositTo: editPayment.depositTo,\n        referenceNumber: editPayment.referenceNumber,\n        taxDeducted: 'no',\n        notes: editPayment.notes,\n        sendThankYou: editPayment.sendThankYou,\n        placeOfSupply: editPayment.placeOfSupply,\n        descriptionOfSupply: editPayment.descriptionOfSupply\n      });\n    } else {\n      setFormData({\n        customerId: '',\n        customerName: '',\n        customerEmail: '',\n        amount: '',\n        bankCharges: '',\n        tax: '',\n        date: new Date().toISOString().split('T')[0],\n        paymentNumber: '',\n        mode: 'Cash',\n        depositTo: 'Petty Cash',\n        referenceNumber: '',\n        taxDeducted: 'no',\n        notes: '',\n        sendThankYou: true,\n        placeOfSupply: '',\n        descriptionOfSupply: ''\n      });\n      setSelectedCustomer(null);\n    }\n  }, [editPayment, open]);\n\n  const handleCustomerChange = async (customerId: string) => {\n    const customer = customers.find(c => c.id === customerId);\n    if (customer) {\n      setSelectedCustomer(customer);\n      setFormData(prev => ({\n        ...prev,\n        customerId: customer.id,\n        customerName: customer.displayName || customer.companyName,\n        customerEmail: customer.email || '',\n        placeOfSupply: customer.placeOfSupply || ''\n      }));\n\n      // Fetch unpaid invoices\n      try {\n        const response = await fetch(`/api/customers/${customerId}/unpaid-invoices`);\n        if (response.ok) {\n          const data = await response.json();\n          console.log('Fetched unpaid invoices:', data.data);\n          const invoices = (data.data || []).map((inv: any) => ({\n            ...inv,\n            // Ensure balanceDue is set properly\n            balanceDue: inv.balanceDue > 0 ? inv.balanceDue : inv.amount\n          }));\n          setUnpaidInvoices(invoices);\n\n          // Auto-allocate if amount already entered\n          const amount = parseFloat(formData.amount) || 0;\n          if (amount > 0) {\n            autoAllocatePayment(amount, invoices);\n          }\n        }\n      } catch (error) {\n        console.error('Failed to fetch unpaid invoices:', error);\n      }\n    }\n  };\n\n  const handleSubmit = () => {\n    // Build invoices array from selected invoices\n    const invoicePayments = Object.entries(selectedInvoices)\n      .filter(([_, inv]) => inv.payment > 0)\n      .map(([id, inv]) => {\n        const invoice = unpaidInvoices.find(i => i.id === id);\n        return {\n          invoiceId: id,\n          invoiceNumber: invoice?.invoiceNumber || '',\n          invoiceDate: invoice?.date || '',\n          invoiceAmount: invoice?.amount || 0,\n          balanceDue: invoice?.balanceDue || 0,\n          paymentAmount: inv.payment,\n          paymentReceivedDate: inv.receivedDate\n        };\n      });\n\n    const paymentData = {\n      ...formData,\n      amount: parseFloat(formData.amount) || 0,\n      bankCharges: parseFloat(formData.bankCharges) || 0,\n      paymentType,\n      status: 'PAID',\n      unusedAmount: amountInExcess,\n      invoices: invoicePayments,\n      attachments: [],\n      journalEntries: [\n        {\n          account: formData.depositTo,\n          debit: parseFloat(formData.amount) || 0,\n          credit: 0\n        },\n        {\n          account: 'Unearned Revenue',\n          debit: 0,\n          credit: parseFloat(formData.amount) || 0\n        }\n      ]\n    };\n\n    console.log('Saving payment with invoices:', paymentData);\n    onSave(paymentData);\n    onOpenChange(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>{editPayment ? 'Edit Payment' : 'Record Payment'}</DialogTitle>\n          <DialogDescription>Record a payment received from a customer</DialogDescription>\n        </DialogHeader>\n\n        <Tabs value={paymentType} onValueChange={(v) => setPaymentType(v as any)}>\n          <TabsList className=\"mb-4\">\n            <TabsTrigger value=\"invoice_payment\">Invoice Payment</TabsTrigger>\n            <TabsTrigger value=\"customer_advance\">Customer Advance</TabsTrigger>\n          </TabsList>\n\n          <div className=\"space-y-6\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"text-red-600\">Customer Name*</Label>\n                <Select value={formData.customerId} onValueChange={handleCustomerChange}>\n                  <SelectTrigger data-testid=\"select-customer\">\n                    <SelectValue placeholder=\"Select a customer\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {customers.map(customer => (\n                      <SelectItem key={customer.id} value={customer.id}>\n                        {customer.displayName || customer.companyName}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                {selectedCustomer?.pan && (\n                  <p className=\"text-sm text-blue-600\">PAN: {selectedCustomer.pan}</p>\n                )}\n                {selectedCustomer?.gstTreatment && (\n                  <p className=\"text-sm text-slate-600\">GST Treatment: {selectedCustomer.gstTreatment}</p>\n                )}\n                {selectedCustomer?.gstin && (\n                  <p className=\"text-sm text-slate-600\">GSTIN: {selectedCustomer.gstin}</p>\n                )}\n              </div>\n\n              {paymentType === 'customer_advance' && (\n                <div className=\"space-y-2\">\n                  <Label className=\"text-red-600\">Place of Supply*</Label>\n                  <Select value={formData.placeOfSupply} onValueChange={(v) => setFormData(prev => ({ ...prev, placeOfSupply: v }))}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select place of supply\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"[MH] - Maharashtra\">[MH] - Maharashtra</SelectItem>\n                      <SelectItem value=\"[DL] - Delhi\">[DL] - Delhi</SelectItem>\n                      <SelectItem value=\"[KA] - Karnataka\">[KA] - Karnataka</SelectItem>\n                      <SelectItem value=\"[TN] - Tamil Nadu\">[TN] - Tamil Nadu</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              )}\n            </div>\n\n            {paymentType === 'customer_advance' && (\n              <div className=\"space-y-2\">\n                <Label>Description of Supply</Label>\n                <Textarea\n                  placeholder=\"Will be displayed on the Payment Receipt\"\n                  value={formData.descriptionOfSupply}\n                  onChange={(e) => setFormData(prev => ({ ...prev, descriptionOfSupply: e.target.value }))}\n                />\n              </div>\n            )}\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"text-red-600\">Amount Received*</Label>\n                <div className=\"flex\">\n                  <span className=\"inline-flex items-center px-3 border border-r-0 border-slate-300 bg-slate-50 rounded-l-md text-sm\">\n                    INR\n                  </span>\n                  <Input\n                    type=\"number\"\n                    value={formData.amount}\n                    onChange={(e) => handleAmountChange(e.target.value)}\n                    placeholder=\"Enter amount to auto-allocate\"\n                    className=\"rounded-l-none\"\n                    data-testid=\"input-amount\"\n                  />\n                </div>\n                <p className=\"text-xs text-slate-500\">Amount will be auto-allocated to unpaid invoices (oldest first)</p>\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Bank Charges (if any)</Label>\n                <Input\n                  type=\"number\"\n                  value={formData.bankCharges}\n                  onChange={(e) => setFormData(prev => ({ ...prev, bankCharges: e.target.value }))}\n                  data-testid=\"input-bank-charges\"\n                />\n              </div>\n            </div>\n\n            {paymentType === 'customer_advance' && (\n              <div className=\"space-y-2\">\n                <Label>Tax</Label>\n                <Select value={formData.tax} onValueChange={(v) => setFormData(prev => ({ ...prev, tax: v }))}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select a Tax\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"none\">No Tax</SelectItem>\n                    <SelectItem value=\"gst18\">GST 18%</SelectItem>\n                    <SelectItem value=\"gst12\">GST 12%</SelectItem>\n                    <SelectItem value=\"gst5\">GST 5%</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"text-red-600\">Payment Date*</Label>\n                <Input\n                  type=\"date\"\n                  value={formData.date}\n                  onChange={(e) => setFormData(prev => ({ ...prev, date: e.target.value }))}\n                  data-testid=\"input-date\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label className=\"text-red-600\">Payment #*</Label>\n                <Input\n                  value={formData.paymentNumber}\n                  onChange={(e) => setFormData(prev => ({ ...prev, paymentNumber: e.target.value }))}\n                  placeholder=\"Auto-generated\"\n                  data-testid=\"input-payment-number\"\n                />\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label>Payment Mode</Label>\n                <Select value={formData.mode} onValueChange={(v) => setFormData(prev => ({ ...prev, mode: v }))}>\n                  <SelectTrigger data-testid=\"select-mode\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"Cash\">Cash</SelectItem>\n                    <SelectItem value=\"Bank Transfer\">Bank Transfer</SelectItem>\n                    <SelectItem value=\"Cheque\">Cheque</SelectItem>\n                    <SelectItem value=\"Credit Card\">Credit Card</SelectItem>\n                    <SelectItem value=\"UPI\">UPI</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"space-y-2\">\n                <Label className=\"text-red-600\">Deposit To*</Label>\n                <Select value={formData.depositTo} onValueChange={(v) => setFormData(prev => ({ ...prev, depositTo: v }))}>\n                  <SelectTrigger data-testid=\"select-deposit\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"Petty Cash\">Petty Cash</SelectItem>\n                    <SelectItem value=\"Bank Account\">Bank Account</SelectItem>\n                    <SelectItem value=\"Cash on Hand\">Cash on Hand</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Reference#</Label>\n              <Input\n                value={formData.referenceNumber}\n                onChange={(e) => setFormData(prev => ({ ...prev, referenceNumber: e.target.value }))}\n                data-testid=\"input-reference\"\n              />\n            </div>\n\n            {paymentType === 'invoice_payment' && (\n              <div className=\"space-y-2\">\n                <Label>Tax deducted?</Label>\n                <div className=\"flex gap-4\">\n                  <label className=\"flex items-center gap-2\">\n                    <input\n                      type=\"radio\"\n                      name=\"taxDeducted\"\n                      value=\"no\"\n                      checked={formData.taxDeducted === 'no'}\n                      onChange={() => setFormData(prev => ({ ...prev, taxDeducted: 'no' }))}\n                    />\n                    No Tax deducted\n                  </label>\n                  <label className=\"flex items-center gap-2\">\n                    <input\n                      type=\"radio\"\n                      name=\"taxDeducted\"\n                      value=\"yes\"\n                      checked={formData.taxDeducted === 'yes'}\n                      onChange={() => setFormData(prev => ({ ...prev, taxDeducted: 'yes' }))}\n                    />\n                    Yes, TDS (Income Tax)\n                  </label>\n                </div>\n              </div>\n            )}\n\n            {paymentType === 'invoice_payment' && formData.customerId && (\n              <div className=\"space-y-4 border-t pt-4\">\n                <div className=\"flex items-center justify-between\">\n                  <h4 className=\"font-semibold\">Unpaid Invoices</h4>\n                  <div className=\"flex items-center gap-2\">\n                    <Button variant=\"outline\" size=\"sm\" className=\"gap-1\">\n                      <Filter className=\"h-3 w-3\" />\n                      Filter by Date Range\n                    </Button>\n                    <Button\n                      variant=\"link\"\n                      size=\"sm\"\n                      className=\"text-blue-600\"\n                      onClick={() => setSelectedInvoices({})}\n                    >\n                      Clear Applied Amount\n                    </Button>\n                  </div>\n                </div>\n\n                <Table>\n                  <TableHeader>\n                    <TableRow className=\"bg-slate-50\">\n                      <TableHead className=\"text-xs\">DATE</TableHead>\n                      <TableHead className=\"text-xs\">INVOICE NUMBER</TableHead>\n                      <TableHead className=\"text-xs text-right\">INVOICE AMOUNT</TableHead>\n                      <TableHead className=\"text-xs text-right\">AMOUNT DUE</TableHead>\n                      <TableHead className=\"text-xs\">PAYMENT RECEIVED ON</TableHead>\n                      <TableHead className=\"text-xs text-right\">PAYMENT</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {unpaidInvoices.length === 0 ? (\n                      <TableRow>\n                        <TableCell colSpan={6} className=\"text-center text-slate-500 py-8\">\n                          There are no unpaid invoices associated with this customer.\n                        </TableCell>\n                      </TableRow>\n                    ) : (\n                      unpaidInvoices.map(invoice => (\n                        <TableRow key={invoice.id} className={selectedInvoices[invoice.id]?.payment > 0 ? \"bg-green-50\" : \"\"}>\n                          <TableCell>{formatDate(invoice.date)}</TableCell>\n                          <TableCell className=\"text-blue-600\">{invoice.invoiceNumber}</TableCell>\n                          <TableCell className=\"text-right\">{formatCurrency(invoice.amount || 0)}</TableCell>\n                          <TableCell className=\"text-right\">{formatCurrency(invoice.balanceDue || 0)}</TableCell>\n                          <TableCell>\n                            {selectedInvoices[invoice.id]?.payment > 0 ? (\n                              <Input\n                                type=\"date\"\n                                className=\"w-32\"\n                                value={selectedInvoices[invoice.id]?.receivedDate || ''}\n                                onChange={(e) => setSelectedInvoices(prev => ({\n                                  ...prev,\n                                  [invoice.id]: {\n                                    ...prev[invoice.id],\n                                    receivedDate: e.target.value\n                                  }\n                                }))}\n                              />\n                            ) : '-'}\n                          </TableCell>\n                          <TableCell className=\"text-right\">\n                            <Input\n                              type=\"number\"\n                              className=\"w-24 text-right\"\n                              value={selectedInvoices[invoice.id]?.payment || ''}\n                              onChange={(e) => {\n                                const value = parseFloat(e.target.value) || 0;\n                                const maxPayment = invoice.balanceDue || invoice.amount;\n                                const validPayment = Math.min(Math.max(0, value), maxPayment);\n                                setSelectedInvoices(prev => ({\n                                  ...prev,\n                                  [invoice.id]: {\n                                    payment: validPayment,\n                                    receivedDate: prev[invoice.id]?.receivedDate || new Date().toISOString().split('T')[0]\n                                  }\n                                }));\n                              }}\n                            />\n                          </TableCell>\n                        </TableRow>\n                      ))\n                    )}\n                  </TableBody>\n                </Table>\n                <p className=\"text-xs text-slate-500\">**List contains only SENT invoices</p>\n\n                <div className=\"flex justify-end\">\n                  <div className=\"w-64 space-y-2\">\n                    <div className=\"flex justify-between\">\n                      <span>Total</span>\n                      <span>{formatCurrency(unpaidInvoices.reduce((sum, inv) => sum + (inv.balanceDue || inv.amount || 0), 0))}</span>\n                    </div>\n                    <div className=\"flex justify-between border-t pt-2\">\n                      <span>Amount Received :</span>\n                      <span>{formatCurrency(amountReceived)}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span>Amount used for Payments :</span>\n                      <span>{formatCurrency(totalPaymentAmount)}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span>Amount Refunded :</span>\n                      <span>0.00</span>\n                    </div>\n                    <div className=\"flex justify-between text-orange-600\">\n                      <span>Amount in Excess:</span>\n                      <span>{formatCurrency(amountInExcess)}</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            <div className=\"space-y-2\">\n              <Label>Notes (Internal use. Not visible to customer)</Label>\n              <Textarea\n                value={formData.notes}\n                onChange={(e) => setFormData(prev => ({ ...prev, notes: e.target.value }))}\n                className=\"min-h-[80px]\"\n                data-testid=\"input-notes\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Attachments</Label>\n              <Button variant=\"outline\" size=\"sm\" className=\"gap-1\">\n                Upload File\n                <ChevronDown className=\"h-3 w-3\" />\n              </Button>\n              <p className=\"text-xs text-slate-500\">You can upload a maximum of 5 files, 5MB each</p>\n            </div>\n\n            <div className=\"flex items-center gap-2 border-t pt-4\">\n              <Checkbox\n                id=\"sendThankYou\"\n                checked={formData.sendThankYou}\n                onCheckedChange={(checked) => setFormData(prev => ({ ...prev, sendThankYou: checked as boolean }))}\n              />\n              <Label htmlFor=\"sendThankYou\">Send a \"Thank you\" note for this payment</Label>\n            </div>\n\n            {formData.sendThankYou && formData.customerEmail && (\n              <div className=\"ml-6 flex items-center gap-2\">\n                <Checkbox checked disabled />\n                <span className=\"text-sm\">&lt;{formData.customerEmail}&gt;</span>\n              </div>\n            )}\n\n            <p className=\"text-sm text-slate-500\">\n              Additional Fields: Start adding custom fields for your payments received by going to{' '}\n              <span className=\"text-blue-600\">Settings  Sales  Payments Received</span>.\n            </p>\n          </div>\n        </Tabs>\n\n        <DialogFooter className=\"gap-2\">\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)}>Cancel</Button>\n          <Button variant=\"outline\" onClick={handleSubmit} data-testid=\"button-save-draft\">Save as Draft</Button>\n          <Button onClick={handleSubmit} className=\"bg-blue-600 hover:bg-blue-700\" data-testid=\"button-save-paid\">Save as Paid</Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nexport default function PaymentsReceived() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [payments, setPayments] = useState<PaymentReceived[]>([]);\n  const [customers, setCustomers] = useState<Customer[]>([]);\n  const [selectedPayment, setSelectedPayment] = useState<PaymentReceived | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [paymentToDelete, setPaymentToDelete] = useState<string | null>(null);\n  const [createDialogOpen, setCreateDialogOpen] = useState(false);\n  const [editPayment, setEditPayment] = useState<PaymentReceived | null>(null);\n  const [selectedPayments, setSelectedPayments] = useState<string[]>([]);\n\n  useEffect(() => {\n    fetchPayments();\n    fetchCustomers();\n  }, []);\n\n  const fetchPayments = async () => {\n    try {\n      const response = await fetch('/api/payments-received');\n      if (response.ok) {\n        const data = await response.json();\n        setPayments(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch payments:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchCustomers = async () => {\n    try {\n      const response = await fetch('/api/customers');\n      if (response.ok) {\n        const data = await response.json();\n        setCustomers(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch customers:', error);\n    }\n  };\n\n  const fetchPaymentDetail = async (id: string) => {\n    try {\n      const response = await fetch(`/api/payments-received/${id}`);\n      if (response.ok) {\n        const data = await response.json();\n        setSelectedPayment(data.data);\n      }\n    } catch (error) {\n      console.error('Failed to fetch payment detail:', error);\n    }\n  };\n\n  const handlePaymentClick = (payment: PaymentReceived) => {\n    fetchPaymentDetail(payment.id);\n  };\n\n  const handleClosePanel = () => {\n    setSelectedPayment(null);\n  };\n\n  const handleEditPayment = () => {\n    if (selectedPayment) {\n      setEditPayment(selectedPayment);\n      setCreateDialogOpen(true);\n    }\n  };\n\n  const handleDelete = (id: string) => {\n    setPaymentToDelete(id);\n    setDeleteDialogOpen(true);\n  };\n\n  const confirmDelete = async () => {\n    if (!paymentToDelete) return;\n    try {\n      const response = await fetch(`/api/payments-received/${paymentToDelete}`, { method: 'DELETE' });\n      if (response.ok) {\n        toast({ title: \"Payment deleted successfully\" });\n        fetchPayments();\n        if (selectedPayment?.id === paymentToDelete) {\n          handleClosePanel();\n        }\n      }\n    } catch (error) {\n      toast({ title: \"Failed to delete payment\", variant: \"destructive\" });\n    } finally {\n      setDeleteDialogOpen(false);\n      setPaymentToDelete(null);\n    }\n  };\n\n  const handleRefund = async () => {\n    if (!selectedPayment) return;\n    try {\n      const response = await fetch(`/api/payments-received/${selectedPayment.id}/refund`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ refundAmount: selectedPayment.amount })\n      });\n      if (response.ok) {\n        toast({ title: \"Payment refunded\" });\n        fetchPayments();\n        fetchPaymentDetail(selectedPayment.id);\n      }\n    } catch (error) {\n      toast({ title: \"Failed to refund payment\", variant: \"destructive\" });\n    }\n  };\n\n  const handleSavePayment = async (paymentData: any) => {\n    try {\n      const url = editPayment\n        ? `/api/payments-received/${editPayment.id}`\n        : '/api/payments-received';\n      const method = editPayment ? 'PUT' : 'POST';\n\n      const response = await fetch(url, {\n        method,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(paymentData)\n      });\n\n      if (response.ok) {\n        toast({ title: editPayment ? \"Payment updated\" : \"Payment recorded successfully\" });\n        fetchPayments();\n        setEditPayment(null);\n      }\n    } catch (error) {\n      toast({ title: \"Failed to save payment\", variant: \"destructive\" });\n    }\n  };\n\n  const toggleSelectPayment = (id: string, e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (selectedPayments.includes(id)) {\n      setSelectedPayments(selectedPayments.filter(i => i !== id));\n    } else {\n      setSelectedPayments([...selectedPayments, id]);\n    }\n  };\n\n  const filteredPayments = payments.filter(payment =>\n    payment.paymentNumber?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    payment.customerName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    payment.referenceNumber?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const { currentPage, totalPages, totalItems, itemsPerPage, paginatedItems, goToPage } = usePagination(filteredPayments, 10);\n\n  const getStatusBadge = (status: string) => {\n    switch (status?.toUpperCase()) {\n      case 'PAID':\n        return <Badge variant=\"outline\" className=\"text-green-600 border-green-200 bg-green-50\">PAID</Badge>;\n      case 'REFUNDED':\n        return <Badge variant=\"outline\" className=\"text-red-600 border-red-200 bg-red-50\">REFUNDED</Badge>;\n      case 'DRAFT':\n        return <Badge variant=\"outline\" className=\"text-slate-600 border-slate-200\">DRAFT</Badge>;\n      default:\n        return <Badge variant=\"outline\">{status}</Badge>;\n    }\n  };\n\n  return (\n    <div className=\"flex h-[calc(100vh-80px)] animate-in fade-in duration-300\">\n      <div className={`flex flex-col overflow-hidden transition-all duration-300 ${selectedPayment ? 'flex-1 min-w-[400px]' : 'flex-1'}`}>\n        <div className=\"flex items-center justify-between p-4 border-b border-slate-200\">\n          <div className=\"flex items-center gap-2\">\n            <h1 className=\"text-xl font-semibold text-slate-900\">All Received Payments</h1>\n            <ChevronDown className=\"h-4 w-4 text-slate-500\" />\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              onClick={() => {\n                setEditPayment(null);\n                setCreateDialogOpen(true);\n              }}\n              className=\"bg-blue-600 hover:bg-blue-700 gap-1.5 h-9\"\n              data-testid=\"button-new-payment\"\n            >\n              <Plus className=\"h-4 w-4\" /> New\n            </Button>\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"outline\" size=\"icon\" className=\"h-9 w-9\" data-testid=\"button-more-options\">\n                  <MoreHorizontal className=\"h-4 w-4\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <DropdownMenuItem>\n                  <Download className=\"mr-2 h-4 w-4\" /> Export\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={fetchPayments}>\n                  Refresh List\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </div>\n\n        {!selectedPayment && (\n          <div className=\"px-4 py-3 flex items-center gap-2 border-b border-slate-200\">\n            <div className=\"relative flex-1 max-w-sm\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400\" />\n              <Input\n                placeholder=\"Search in Payments Received ( / )\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-9\"\n                data-testid=\"input-search\"\n              />\n            </div>\n          </div>\n        )}\n\n        <div className=\"flex-1 overflow-auto\">\n          {loading ? (\n            <div className=\"p-8 text-center text-slate-500\">Loading payments...</div>\n          ) : filteredPayments.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center h-full text-center p-8\">\n              <div className=\"h-16 w-16 rounded-full bg-slate-100 flex items-center justify-center mb-4\">\n                <FileText className=\"h-8 w-8 text-slate-400\" />\n              </div>\n              <h3 className=\"text-lg font-semibold mb-2\">No payments found</h3>\n              <p className=\"text-slate-500 mb-4\">\n                {searchTerm ? 'Try adjusting your search criteria' : 'Record your first payment to get started'}\n              </p>\n              {!searchTerm && (\n                <Button onClick={() => setCreateDialogOpen(true)} className=\"gap-2\" data-testid=\"button-create-first-payment\">\n                  <Plus className=\"h-4 w-4\" /> Record Payment\n                </Button>\n              )}\n            </div>\n          ) : (\n            <>\n              <Table>\n                <TableHeader>\n                  <TableRow className=\"bg-slate-50\">\n                    <TableHead className=\"w-10\"></TableHead>\n                    <TableHead className=\"text-xs\">DATE</TableHead>\n                    <TableHead className=\"text-xs\">PAYMENT #</TableHead>\n                    <TableHead className=\"text-xs\">REFERENCE NUMBER</TableHead>\n                    <TableHead className=\"text-xs\">CUSTOMER NAME</TableHead>\n                    <TableHead className=\"text-xs\">INVOICE#</TableHead>\n                    <TableHead className=\"text-xs\">MODE</TableHead>\n                    <TableHead className=\"text-xs text-right\">AMOUNT</TableHead>\n                    <TableHead className=\"text-xs text-right\">UNUSED AMOUNT</TableHead>\n                    <TableHead className=\"text-xs\">STATUS</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {paginatedItems.map((payment) => (\n                    <TableRow\n                      key={payment.id}\n                      onClick={() => handlePaymentClick(payment)}\n                      className={`cursor-pointer hover-elevate ${selectedPayment?.id === payment.id ? 'bg-blue-50' : ''}`}\n                      data-testid={`row-payment-${payment.id}`}\n                    >\n                      <TableCell onClick={(e) => e.stopPropagation()}>\n                        <Checkbox\n                          checked={selectedPayments.includes(payment.id)}\n                          onClick={(e) => toggleSelectPayment(payment.id, e)}\n                        />\n                      </TableCell>\n                      <TableCell className=\"text-sm\">{formatDate(payment.date)}</TableCell>\n                      <TableCell className=\"text-sm text-blue-600 font-medium\">{payment.paymentNumber}</TableCell>\n                      <TableCell className=\"text-sm\">{payment.referenceNumber || '-'}</TableCell>\n                      <TableCell className=\"text-sm\">{payment.customerName}</TableCell>\n                      <TableCell className=\"text-sm\">\n                        {payment.invoices?.length > 0\n                          ? payment.invoices.map((inv: any) => inv.invoiceNumber).join(', ')\n                          : '-'\n                        }\n                      </TableCell>\n                      <TableCell className=\"text-sm\">{payment.mode}</TableCell>\n                      <TableCell className=\"text-sm text-right\">{formatCurrency(payment.amount)}</TableCell>\n                      <TableCell className=\"text-sm text-right\">{formatCurrency(payment.unusedAmount)}</TableCell>\n                      <TableCell>{getStatusBadge(payment.status)}</TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n              <TablePagination\n                currentPage={currentPage}\n                totalPages={totalPages}\n                totalItems={totalItems}\n                itemsPerPage={itemsPerPage}\n                onPageChange={goToPage}\n              />\n            </>\n          )}\n        </div>\n      </div>\n\n      {selectedPayment && (\n        <div className=\"w-full max-w-[600px] lg:w-[600px] flex-shrink-0 border-l border-slate-200\">\n          <PaymentDetailPanel\n            payment={selectedPayment}\n            onClose={handleClosePanel}\n            onEdit={handleEditPayment}\n            onDelete={() => handleDelete(selectedPayment.id)}\n            onRefund={handleRefund}\n          />\n        </div>\n      )}\n\n      <PaymentCreateDialog\n        open={createDialogOpen}\n        onOpenChange={setCreateDialogOpen}\n        onSave={handleSavePayment}\n        customers={customers}\n        editPayment={editPayment}\n      />\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Payment</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete this payment? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={confirmDelete} className=\"bg-red-600 hover:bg-red-700\">\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":54326,"size_tokens":null},"client/src/hooks/use-pagination.ts":{"content":"import { useState, useMemo, useEffect } from \"react\";\n\nexport function usePagination<T>(items: T[], itemsPerPage: number = 10) {\n  const [currentPage, setCurrentPage] = useState(1);\n  \n  const totalItems = items.length;\n  const totalPages = Math.max(1, Math.ceil(totalItems / itemsPerPage));\n  \n  useEffect(() => {\n    if (currentPage > totalPages && totalPages > 0) {\n      setCurrentPage(totalPages);\n    }\n  }, [totalItems, totalPages, currentPage]);\n  \n  const paginatedItems = useMemo(() => {\n    const safeCurrentPage = Math.min(currentPage, totalPages);\n    return items.slice(\n      (safeCurrentPage - 1) * itemsPerPage,\n      safeCurrentPage * itemsPerPage\n    );\n  }, [items, currentPage, itemsPerPage, totalPages]);\n  \n  const goToPage = (page: number) => {\n    const newPage = Math.max(1, Math.min(page, totalPages));\n    setCurrentPage(newPage);\n  };\n  \n  const resetPage = () => {\n    setCurrentPage(1);\n  };\n  \n  return {\n    currentPage,\n    totalPages,\n    totalItems,\n    itemsPerPage,\n    paginatedItems,\n    goToPage,\n    resetPage,\n  };\n}\n","path":null,"size_bytes":1060,"size_tokens":null},"client/src/components/table-pagination.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { ChevronLeft, ChevronRight, ChevronsLeft, ChevronsRight } from \"lucide-react\";\n\ninterface TablePaginationProps {\n  currentPage: number;\n  totalPages: number;\n  totalItems: number;\n  itemsPerPage: number;\n  onPageChange: (page: number) => void;\n}\n\nexport function TablePagination({\n  currentPage,\n  totalPages,\n  totalItems,\n  itemsPerPage,\n  onPageChange,\n}: TablePaginationProps) {\n  const startItem = totalItems === 0 ? 0 : (currentPage - 1) * itemsPerPage + 1;\n  const endItem = Math.min(currentPage * itemsPerPage, totalItems);\n\n  if (totalItems === 0) return null;\n\n  const getPageNumbers = () => {\n    const pages: (number | string)[] = [];\n    const maxVisiblePages = 5;\n\n    if (totalPages <= maxVisiblePages) {\n      for (let i = 1; i <= totalPages; i++) {\n        pages.push(i);\n      }\n    } else {\n      if (currentPage <= 3) {\n        for (let i = 1; i <= 4; i++) {\n          pages.push(i);\n        }\n        pages.push(\"...\");\n        pages.push(totalPages);\n      } else if (currentPage >= totalPages - 2) {\n        pages.push(1);\n        pages.push(\"...\");\n        for (let i = totalPages - 3; i <= totalPages; i++) {\n          pages.push(i);\n        }\n      } else {\n        pages.push(1);\n        pages.push(\"...\");\n        pages.push(currentPage - 1);\n        pages.push(currentPage);\n        pages.push(currentPage + 1);\n        pages.push(\"...\");\n        pages.push(totalPages);\n      }\n    }\n\n    return pages;\n  };\n\n  return (\n    <div className=\"flex flex-col items-center gap-3 px-4 py-4 border-t border-border bg-gradient-to-r from-muted/30 via-muted/50 to-muted/30\" data-testid=\"pagination-container\">\n      <div className=\"flex items-center justify-center gap-2\">\n        <Button\n          variant=\"outline\"\n          size=\"icon\"\n          className=\"h-9 w-9 rounded-lg border-border/60 bg-white dark:bg-slate-800 hover:bg-primary/10 hover:border-primary/50 transition-all duration-200\"\n          onClick={() => onPageChange(1)}\n          disabled={currentPage === 1}\n          data-testid=\"pagination-first\"\n        >\n          <ChevronsLeft className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          variant=\"outline\"\n          size=\"icon\"\n          className=\"h-9 w-9 rounded-lg border-border/60 bg-white dark:bg-slate-800 hover:bg-primary/10 hover:border-primary/50 transition-all duration-200\"\n          onClick={() => onPageChange(currentPage - 1)}\n          disabled={currentPage === 1}\n          data-testid=\"pagination-prev\"\n        >\n          <ChevronLeft className=\"h-4 w-4\" />\n        </Button>\n        \n        <div className=\"flex items-center gap-1 px-2\">\n          {getPageNumbers().map((page, index) => (\n            typeof page === \"number\" ? (\n              <Button\n                key={index}\n                variant={currentPage === page ? \"default\" : \"outline\"}\n                size=\"sm\"\n                className={`h-9 w-9 rounded-lg font-medium transition-all duration-200 ${\n                  currentPage === page \n                    ? \"bg-primary text-primary-foreground shadow-md scale-105\" \n                    : \"border-border/60 bg-white dark:bg-slate-800 hover:bg-primary/10 hover:border-primary/50\"\n                }`}\n                onClick={() => onPageChange(page)}\n                data-testid={`pagination-page-${page}`}\n              >\n                {page}\n              </Button>\n            ) : (\n              <span key={index} className=\"px-1 text-muted-foreground select-none\">...</span>\n            )\n          ))}\n        </div>\n        \n        <Button\n          variant=\"outline\"\n          size=\"icon\"\n          className=\"h-9 w-9 rounded-lg border-border/60 bg-white dark:bg-slate-800 hover:bg-primary/10 hover:border-primary/50 transition-all duration-200\"\n          onClick={() => onPageChange(currentPage + 1)}\n          disabled={currentPage === totalPages}\n          data-testid=\"pagination-next\"\n        >\n          <ChevronRight className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          variant=\"outline\"\n          size=\"icon\"\n          className=\"h-9 w-9 rounded-lg border-border/60 bg-white dark:bg-slate-800 hover:bg-primary/10 hover:border-primary/50 transition-all duration-200\"\n          onClick={() => onPageChange(totalPages)}\n          disabled={currentPage === totalPages}\n          data-testid=\"pagination-last\"\n        >\n          <ChevronsRight className=\"h-4 w-4\" />\n        </Button>\n      </div>\n      <div className=\"text-sm text-muted-foreground\" data-testid=\"pagination-info\">\n        Showing <span className=\"font-medium text-foreground\">{startItem}</span> to <span className=\"font-medium text-foreground\">{endItem}</span> of <span className=\"font-medium text-foreground\">{totalItems}</span> entries\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":4812,"size_tokens":null},"client/src/pages/vendor-credit-create.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation, useSearch } from \"wouter\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { ArrowLeft, RefreshCw, Upload, Plus, Trash2, Search, FileText, Info } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { AccountSelectDropdown, normalizeAccountValue } from \"@/components/AccountSelectDropdown\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nconst TDS_TCS_OPTIONS = [\n  { value: \"commission_brokerage_2\", label: \"Commission or Brokerage [2%]\" },\n  { value: \"professional_fees_10\", label: \"Professional Fees [10%]\" },\n  { value: \"rent_10\", label: \"Rent [10%]\" },\n  { value: \"contractor_1\", label: \"Payment to Contractor [1%]\" },\n  { value: \"contractor_2\", label: \"Payment to Contractor [2%]\" },\n];\n\n// Account dropdown is now handled by AccountSelectDropdown component\n\nconst TAX_OPTIONS = [\n  { value: \"gst_5\", label: \"GST [5%]\" },\n  { value: \"gst_12\", label: \"GST [12%]\" },\n  { value: \"gst_18\", label: \"GST [18%]\" },\n  { value: \"gst_28\", label: \"GST [28%]\" },\n  { value: \"igst_5\", label: \"IGST [5%]\" },\n  { value: \"igst_12\", label: \"IGST [12%]\" },\n  { value: \"igst_18\", label: \"IGST [18%]\" },\n  { value: \"igst_28\", label: \"IGST [28%]\" },\n  { value: \"cgst_9\", label: \"CGST [9%]\" },\n  { value: \"cgst_14\", label: \"CGST [14%]\" },\n  { value: \"sgst_9\", label: \"SGST [9%]\" },\n  { value: \"sgst_14\", label: \"SGST [14%]\" },\n  { value: \"exempt\", label: \"Exempt\" },\n  { value: \"nil\", label: \"Nil Rated\" },\n];\n\n// normalizeAccountValue is imported from AccountSelectDropdown component\n\n// Helper function to normalize tax value from bill format (e.g., \"IGST18\", \"CGST9\") to select option format (e.g., \"igst_18\", \"cgst_9\")\nconst normalizeTaxValue = (tax: string): string => {\n  if (!tax) return \"\";\n  // Extract prefix and percentage: \"IGST18\" -> [\"IGST\", \"18\"], \"CGST9\" -> [\"CGST\", \"9\"]\n  const match = tax.match(/^([A-Za-z]+)(\\d+)$/);\n  if (match) {\n    const prefix = match[1].toLowerCase();\n    const percent = match[2];\n    return `${prefix}_${percent}`;\n  }\n  // Already in correct format or unknown\n  return tax.toLowerCase().replace(/\\s+/g, '_');\n};\n\ninterface Vendor {\n  id: string;\n  displayName: string;\n  companyName?: string;\n}\n\ninterface Item {\n  id: string;\n  name: string;\n  rate: number;\n  description?: string;\n  type?: string;\n}\n\ninterface LineItem {\n  id: string;\n  itemId: string;\n  itemName: string;\n  description: string;\n  account: string;\n  quantity: number;\n  rate: number;\n  tax: string;\n  taxAmount?: number;\n  amount: number;\n}\n\nexport default function VendorCreditCreate() {\n  const [, setLocation] = useLocation();\n  const searchString = useSearch();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [saving, setSaving] = useState(false);\n\n  // Get query params from URL using wouter's useSearch for proper reactivity\n  const urlParams = new URLSearchParams(searchString);\n  const billId = urlParams.get('billId');\n  const vendorIdFromUrl = urlParams.get('vendorId');\n\n  const [formData, setFormData] = useState({\n    vendorId: \"\",\n    vendorName: \"\",\n    creditNoteNumber: \"\",\n    orderNumber: \"\",\n    vendorCreditDate: new Date().toISOString().split('T')[0],\n    subject: \"\",\n    reverseCharge: false,\n    taxType: \"tds\" as \"tds\" | \"tcs\",\n    tdsTcs: \"\",\n    discountType: \"percentage\" as \"percentage\" | \"amount\",\n    discountValue: \"\",\n    adjustment: \"\",\n    notes: \"\",\n    attachments: [] as File[],\n    billId: billId || \"\",\n    billNumber: \"\",\n  });\n\n  const [items, setItems] = useState<LineItem[]>([]);\n  const [billDataLoaded, setBillDataLoaded] = useState(false);\n\n  const { data: vendorsData, isLoading: vendorsLoading } = useQuery<{ success: boolean; data: Vendor[] }>({\n    queryKey: ['/api/vendors'],\n  });\n\n  const { data: productsData, isLoading: productsLoading } = useQuery<{ success: boolean; data: Item[] }>({\n    queryKey: ['/api/items'],\n  });\n\n  const { data: nextNumberData } = useQuery<{ success: boolean; data: { nextNumber: string } }>({\n    queryKey: ['/api/vendor-credits/next-number'],\n  });\n\n  // Fetch bill data if billId is provided\n  const { data: billData, isLoading: billLoading } = useQuery<{ success: boolean; data: any }>({\n    queryKey: ['/api/bills', billId],\n    enabled: !!billId,\n  });\n\n  useEffect(() => {\n    if (nextNumberData?.data?.nextNumber) {\n      setFormData(prev => ({ ...prev, creditNoteNumber: nextNumberData.data.nextNumber }));\n    }\n  }, [nextNumberData]);\n\n  // Pre-populate form with bill data when it loads\n  useEffect(() => {\n    if (billData?.data && !billDataLoaded && productsData?.data) {\n      const bill = billData.data;\n      const productsList = productsData.data;\n\n      setFormData(prev => ({\n        ...prev,\n        vendorId: bill.vendorId || \"\",\n        vendorName: bill.vendorName || \"\",\n        subject: `Vendor Credit for Bill #${bill.billNumber}`,\n        reverseCharge: bill.reverseCharge || false,\n        notes: `Created from Bill #${bill.billNumber}`,\n        billId: bill.id,\n        billNumber: bill.billNumber,\n      }));\n\n      // Pre-populate items from bill\n      if (bill.items && bill.items.length > 0) {\n        const billItems: LineItem[] = bill.items.map((item: any, index: number) => {\n          const quantity = item.quantity || 1;\n          const rate = item.rate || 0;\n          const amount = quantity * rate;\n          const tax = normalizeTaxValue(item.tax || \"\");\n          let taxAmount = item.taxAmount || 0;\n\n          // Calculate tax amount if not provided\n          if (!taxAmount && tax) {\n            const taxMatch = tax.match(/(\\d+)/);\n            if (taxMatch) {\n              const taxPercent = parseFloat(taxMatch[1]);\n              taxAmount = (amount * taxPercent) / 100;\n            }\n          }\n\n          // Find matching product by name to get the correct itemId\n          const itemName = item.itemName || item.name || \"\";\n          const matchingProduct = productsList.find(\n            (p: any) => p.name.toLowerCase() === itemName.toLowerCase()\n          );\n\n          return {\n            id: `item-${Date.now()}-${index}`,\n            itemId: matchingProduct?.id || \"\",\n            itemName: itemName,\n            description: item.description || \"\",\n            account: normalizeAccountValue(item.account || \"\"),\n            quantity,\n            rate,\n            tax,\n            taxAmount,\n            amount,\n          };\n        });\n        setItems(billItems);\n      }\n\n      setBillDataLoaded(true);\n    }\n  }, [billData, billDataLoaded, productsData]);\n\n  // Also handle vendor from URL if provided without bill\n  useEffect(() => {\n    if (vendorIdFromUrl && !billId && vendorsData?.data) {\n      const vendor = vendorsData.data.find(v => v.id === vendorIdFromUrl);\n      if (vendor) {\n        setFormData(prev => ({\n          ...prev,\n          vendorId: vendor.id,\n          vendorName: vendor.displayName,\n        }));\n      }\n    }\n  }, [vendorIdFromUrl, billId, vendorsData]);\n\n  const vendors = vendorsData?.data || [];\n  const products = productsData?.data || [];\n\n  const handleVendorChange = (vendorId: string) => {\n    const vendor = vendors.find(v => v.id === vendorId);\n    if (vendor) {\n      setFormData(prev => ({\n        ...prev,\n        vendorId: vendor.id,\n        vendorName: vendor.displayName,\n      }));\n    }\n  };\n\n  const addItem = () => {\n    setItems(prev => [...prev, {\n      id: `item-${Date.now()}`,\n      itemId: \"\",\n      itemName: \"\",\n      description: \"\",\n      account: \"cost_of_goods_sold\",\n      quantity: 1,\n      rate: 0,\n      tax: \"\",\n      amount: 0,\n    }]);\n  };\n\n  const removeItem = (itemId: string) => {\n    setItems(prev => prev.filter(item => item.id !== itemId));\n  };\n\n  const updateItem = (itemId: string, field: string, value: any) => {\n    setItems(prev => prev.map(item => {\n      if (item.id === itemId) {\n        const updated = { ...item, [field]: value };\n        if (field === 'itemId') {\n          const product = products.find(p => p.id === value);\n          if (product) {\n            updated.itemName = product.name;\n            updated.description = product.description || '';\n            updated.rate = product.rate;\n            updated.amount = updated.quantity * product.rate;\n          }\n        }\n        if (field === 'quantity' || field === 'rate') {\n          updated.amount = updated.quantity * updated.rate;\n          // Recalculate tax amount when quantity or rate changes\n          if (updated.tax) {\n            const taxMatch = updated.tax.match(/(\\d+)/);\n            if (taxMatch) {\n              const taxPercent = parseFloat(taxMatch[1]);\n              updated.taxAmount = (updated.amount * taxPercent) / 100;\n            }\n          }\n        }\n        if (field === 'tax') {\n          const taxMatch = value.match(/(\\d+)/);\n          if (taxMatch) {\n            const taxPercent = parseFloat(taxMatch[1]);\n            updated.taxAmount = (updated.amount * taxPercent) / 100;\n          } else {\n            updated.taxAmount = 0;\n          }\n        }\n        return updated;\n      }\n      return item;\n    }));\n  };\n\n  const calculateItemTaxAmount = () => {\n    return items.reduce((sum, item) => {\n      // Use stored taxAmount if available\n      if (item.taxAmount !== undefined && item.taxAmount > 0) {\n        return sum + item.taxAmount;\n      }\n      // Otherwise calculate from tax code\n      if (item.tax) {\n        const taxMatch = item.tax.match(/(\\d+)/);\n        if (taxMatch) {\n          const taxPercent = parseFloat(taxMatch[1]);\n          return sum + (item.amount * taxPercent) / 100;\n        }\n      }\n      return sum;\n    }, 0);\n  };\n\n  const calculateSubTotal = () => {\n    return items.reduce((sum, item) => sum + item.amount, 0);\n  };\n\n  const calculateDiscount = () => {\n    const subTotal = calculateSubTotal();\n    if (formData.discountType === 'percentage') {\n      return subTotal * (parseFloat(formData.discountValue) || 0) / 100;\n    }\n    return parseFloat(formData.discountValue) || 0;\n  };\n\n  const calculateTdsTcs = () => {\n    if (!formData.tdsTcs) return 0;\n    const subTotal = calculateSubTotal() - calculateDiscount();\n    const percentMatch = formData.tdsTcs.match(/(\\d+)/);\n    if (percentMatch) {\n      const percent = parseFloat(percentMatch[1]);\n      return subTotal * percent / 100;\n    }\n    return 0;\n  };\n\n  const calculateTotal = () => {\n    const subTotal = calculateSubTotal();\n    const itemTaxAmount = calculateItemTaxAmount();\n    const discount = calculateDiscount();\n    const tdsTcs = calculateTdsTcs();\n    const adjustment = parseFloat(formData.adjustment) || 0;\n\n    if (formData.taxType === 'tds') {\n      return subTotal + itemTaxAmount - discount - tdsTcs + adjustment;\n    }\n    return subTotal + itemTaxAmount - discount + tdsTcs + adjustment;\n  };\n\n  const handleSubmit = async (status: 'DRAFT' | 'OPEN') => {\n    if (!formData.vendorId) {\n      toast({ title: \"Please select a vendor\", variant: \"destructive\" });\n      return;\n    }\n\n    setSaving(true);\n    try {\n      const payload = {\n        ...formData,\n        items,\n        subTotal: calculateSubTotal(),\n        taxAmount: calculateItemTaxAmount(),\n        discountAmount: calculateDiscount(),\n        tdsTcsAmount: calculateTdsTcs(),\n        adjustment: parseFloat(formData.adjustment) || 0,\n        total: calculateTotal(),\n        amount: calculateTotal(),\n        balance: calculateTotal(),\n        status,\n      };\n\n      const response = await fetch('/api/vendor-credits', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      });\n\n      if (response.ok) {\n        // Invalidate the vendor credits query to ensure fresh data on list page\n        queryClient.invalidateQueries({ queryKey: ['/api/vendor-credits'] });\n        toast({ title: `Vendor credit ${status === 'DRAFT' ? 'saved as draft' : 'created'} successfully` });\n        setLocation('/vendor-credits');\n      } else {\n        const error = await response.json();\n        toast({ title: error.message || \"Failed to save vendor credit\", variant: \"destructive\" });\n      }\n    } catch (error) {\n      toast({ title: \"Failed to save vendor credit\", variant: \"destructive\" });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-slate-50\">\n      <div className=\"border-b border-slate-200 bg-white px-6 py-4 sticky top-0 z-10\">\n        <div className=\"flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setLocation(\"/vendor-credits\")}\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"h-5 w-5\" />\n          </Button>\n          <h1 className=\"text-xl font-semibold\">New Vendor Credits</h1>\n        </div>\n      </div>\n\n      <div className=\"max-w-5xl mx-auto p-6 space-y-6\">\n        {/* Show bill reference banner when creating from bill */}\n        {billId && formData.billNumber && (\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-center gap-3\">\n            <Info className=\"h-5 w-5 text-blue-600 flex-shrink-0\" />\n            <div className=\"flex-1\">\n              <p className=\"text-sm text-blue-800\">\n                Creating vendor credit from <span className=\"font-semibold\">Bill #{formData.billNumber}</span>.\n                The vendor and items have been pre-populated from the bill.\n              </p>\n            </div>\n            <Badge variant=\"outline\" className=\"bg-blue-100 text-blue-800 border-blue-300\">\n              <FileText className=\"h-3 w-3 mr-1\" />\n              From Bill\n            </Badge>\n          </div>\n        )}\n\n        {/* Loading state when fetching bill data */}\n        {billLoading && (\n          <div className=\"bg-slate-50 border border-slate-200 rounded-lg p-4 flex items-center gap-3\">\n            <RefreshCw className=\"h-5 w-5 text-slate-500 animate-spin\" />\n            <p className=\"text-sm text-slate-600\">Loading bill data...</p>\n          </div>\n        )}\n\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 items-start\">\n          <div className=\"md:col-span-2\">\n            <Label className=\"text-red-500\">Vendor Name*</Label>\n            <div className=\"flex gap-2\">\n              <Select\n                value={formData.vendorId}\n                onValueChange={handleVendorChange}\n              >\n                <SelectTrigger className=\"flex-1\" data-testid=\"select-vendor\">\n                  <SelectValue placeholder=\"Select a Vendor\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {vendorsLoading ? (\n                    <SelectItem value=\"_loading\" disabled>Loading...</SelectItem>\n                  ) : vendors.length === 0 ? (\n                    <SelectItem value=\"_empty\" disabled>No vendors found</SelectItem>\n                  ) : (\n                    vendors.map((vendor) => (\n                      <SelectItem key={vendor.id} value={vendor.id}>\n                        {vendor.displayName}\n                      </SelectItem>\n                    ))\n                  )}\n                </SelectContent>\n              </Select>\n              <Button variant=\"outline\" size=\"icon\">\n                <Search className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <div>\n            <Label className=\"text-red-500\">Credit Note#*</Label>\n            <div className=\"relative\">\n              <Input\n                value={formData.creditNoteNumber}\n                onChange={(e) => setFormData(prev => ({ ...prev, creditNoteNumber: e.target.value }))}\n                data-testid=\"input-credit-note-number\"\n              />\n              <RefreshCw className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400 cursor-pointer\" />\n            </div>\n          </div>\n\n          <div>\n            <Label>Order Number</Label>\n            <Input\n              value={formData.orderNumber}\n              onChange={(e) => setFormData(prev => ({ ...prev, orderNumber: e.target.value }))}\n              data-testid=\"input-order-number\"\n            />\n          </div>\n\n          <div>\n            <Label>Vendor Credit Date</Label>\n            <Input\n              type=\"date\"\n              value={formData.vendorCreditDate}\n              onChange={(e) => setFormData(prev => ({ ...prev, vendorCreditDate: e.target.value }))}\n              data-testid=\"input-vendor-credit-date\"\n            />\n          </div>\n        </div>\n\n        <div>\n          <Label>Subject</Label>\n          <Input\n            placeholder=\"Enter a subject within 250 characters\"\n            maxLength={250}\n            value={formData.subject}\n            onChange={(e) => setFormData(prev => ({ ...prev, subject: e.target.value }))}\n            data-testid=\"input-subject\"\n          />\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <Checkbox\n            checked={formData.reverseCharge}\n            onCheckedChange={(checked) => setFormData(prev => ({ ...prev, reverseCharge: !!checked }))}\n            data-testid=\"checkbox-reverse-charge\"\n          />\n          <span className=\"text-sm text-slate-600\">This transaction is applicable for reverse charge</span>\n        </div>\n\n        <div className=\"border-t pt-4\">\n          <div className=\"flex items-center gap-2 mb-4\">\n            <RefreshCw className=\"h-4 w-4 text-slate-400\" />\n            <span className=\"text-sm text-slate-600\">At Transaction Level</span>\n          </div>\n\n          <div className=\"border rounded-lg overflow-hidden\">\n            <div className=\"flex items-center justify-between px-4 py-3 bg-slate-50 border-b\">\n              <h3 className=\"font-medium\">Item Table</h3>\n              <Button variant=\"link\" size=\"sm\" className=\"text-blue-600\">\n                <RefreshCw className=\"h-4 w-4 mr-1\" />\n                Bulk Actions\n              </Button>\n            </div>\n\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full text-sm\">\n                <thead className=\"bg-slate-50 border-b\">\n                  <tr>\n                    <th className=\"px-4 py-3 text-left font-medium text-slate-600 uppercase text-xs w-8\"></th>\n                    <th className=\"px-4 py-3 text-left font-medium text-slate-600 uppercase text-xs\">Item Details</th>\n                    <th className=\"px-4 py-3 text-left font-medium text-slate-600 uppercase text-xs\">Account</th>\n                    <th className=\"px-4 py-3 text-center font-medium text-slate-600 uppercase text-xs\">Quantity</th>\n                    <th className=\"px-4 py-3 text-right font-medium text-slate-600 uppercase text-xs\">Rate</th>\n                    <th className=\"px-4 py-3 text-left font-medium text-slate-600 uppercase text-xs\">Tax</th>\n                    <th className=\"px-4 py-3 text-right font-medium text-slate-600 uppercase text-xs\">Amount</th>\n                    <th className=\"px-4 py-3 w-10\"></th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {items.length === 0 ? (\n                    <tr>\n                      <td colSpan={8} className=\"px-4 py-8 text-center text-slate-500\">\n                        <p>No items added yet. Click \"Add New Row\" to add items.</p>\n                      </td>\n                    </tr>\n                  ) : (\n                    items.map((item, index) => (\n                      <tr key={item.id} className=\"border-b last:border-b-0\">\n                        <td className=\"px-4 py-3 text-center\">\n                          <span className=\"text-slate-400\"></span>\n                        </td>\n                        <td className=\"px-4 py-3\">\n                          <Select\n                            value={item.itemId}\n                            onValueChange={(v) => updateItem(item.id, 'itemId', v)}\n                          >\n                            <SelectTrigger data-testid={`select-item-${index}`}>\n                              <SelectValue placeholder=\"Type or click to select an item.\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {productsLoading ? (\n                                <SelectItem value=\"_loading\" disabled>Loading...</SelectItem>\n                              ) : products.length === 0 ? (\n                                <SelectItem value=\"_empty\" disabled>No items found</SelectItem>\n                              ) : (\n                                products.map((product) => (\n                                  <SelectItem key={product.id} value={product.id}>\n                                    {product.name}\n                                  </SelectItem>\n                                ))\n                              )}\n                            </SelectContent>\n                          </Select>\n                        </td>\n                        <td className=\"px-4 py-3\">\n                          <AccountSelectDropdown\n                            value={item.account}\n                            onValueChange={(v) => updateItem(item.id, 'account', v)}\n                            placeholder=\"Select an account\"\n                            testId={`select-account-${index}`}\n                          />\n                        </td>\n                        <td className=\"px-4 py-3\">\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            className=\"w-20 text-center\"\n                            value={item.quantity}\n                            onChange={(e) => updateItem(item.id, 'quantity', parseFloat(e.target.value) || 0)}\n                            data-testid={`input-quantity-${index}`}\n                          />\n                        </td>\n                        <td className=\"px-4 py-3\">\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            className=\"w-24 text-right\"\n                            value={item.rate}\n                            onChange={(e) => updateItem(item.id, 'rate', parseFloat(e.target.value) || 0)}\n                            data-testid={`input-rate-${index}`}\n                          />\n                        </td>\n                        <td className=\"px-4 py-3\">\n                          <Select\n                            value={item.tax}\n                            onValueChange={(v) => updateItem(item.id, 'tax', v)}\n                          >\n                            <SelectTrigger data-testid={`select-tax-${index}`}>\n                              <SelectValue placeholder=\"Select a Tax\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {TAX_OPTIONS.map((option) => (\n                                <SelectItem key={option.value} value={option.value}>\n                                  {option.label}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </td>\n                        <td className=\"px-4 py-3 text-right font-medium\">\n                          {item.amount.toFixed(2)}\n                        </td>\n                        <td className=\"px-4 py-3\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => removeItem(item.id)}\n                            className=\"text-red-500 h-8 w-8\"\n                            data-testid={`button-remove-item-${index}`}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </td>\n                      </tr>\n                    ))\n                  )}\n                </tbody>\n              </table>\n            </div>\n          </div>\n\n          <div className=\"flex gap-4 mt-4\">\n            <Button\n              variant=\"link\"\n              className=\"text-blue-600 gap-1\"\n              onClick={addItem}\n              data-testid=\"button-add-row\"\n            >\n              <Plus className=\"h-4 w-4\" />\n              Add New Row\n            </Button>\n            <Button variant=\"link\" className=\"text-blue-600 gap-1\">\n              <Plus className=\"h-4 w-4\" />\n              Add Items in Bulk\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"flex justify-end\">\n          <div className=\"w-80 space-y-3 bg-slate-50 p-4 rounded-lg\">\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"text-slate-600\">Sub Total</span>\n              <span className=\"font-medium\">{calculateSubTotal().toFixed(2)}</span>\n            </div>\n\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm text-slate-600 flex-shrink-0\">Discount</span>\n              <Input\n                type=\"number\"\n                step=\"0.01\"\n                className=\"w-20 h-8\"\n                value={formData.discountValue}\n                onChange={(e) => setFormData(prev => ({ ...prev, discountValue: e.target.value }))}\n                data-testid=\"input-discount\"\n              />\n              <Select\n                value={formData.discountType}\n                onValueChange={(v: \"percentage\" | \"amount\") => setFormData(prev => ({ ...prev, discountType: v }))}\n              >\n                <SelectTrigger className=\"w-16 h-8\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"percentage\">%</SelectItem>\n                  <SelectItem value=\"amount\"></SelectItem>\n                </SelectContent>\n              </Select>\n              <span className=\"ml-auto font-medium\">{calculateDiscount().toFixed(2)}</span>\n            </div>\n\n            <div className=\"flex items-center gap-2\">\n              <div className=\"flex gap-2\">\n                <label className=\"flex items-center gap-1 text-sm\">\n                  <input\n                    type=\"radio\"\n                    name=\"taxType\"\n                    checked={formData.taxType === 'tds'}\n                    onChange={() => setFormData(prev => ({ ...prev, taxType: 'tds' }))}\n                  />\n                  TDS\n                </label>\n                <label className=\"flex items-center gap-1 text-sm\">\n                  <input\n                    type=\"radio\"\n                    name=\"taxType\"\n                    checked={formData.taxType === 'tcs'}\n                    onChange={() => setFormData(prev => ({ ...prev, taxType: 'tcs' }))}\n                  />\n                  TCS\n                </label>\n              </div>\n              <Select\n                value={formData.tdsTcs}\n                onValueChange={(v) => setFormData(prev => ({ ...prev, tdsTcs: v }))}\n              >\n                <SelectTrigger className=\"flex-1 h-8\" data-testid=\"select-tds-tcs\">\n                  <SelectValue placeholder=\"Select\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {TDS_TCS_OPTIONS.map((option) => (\n                    <SelectItem key={option.value} value={option.value}>\n                      {option.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              <span className=\"font-medium text-sm\">- {calculateTdsTcs().toFixed(2)}</span>\n            </div>\n\n            <div className=\"flex items-center gap-2\">\n              <Button variant=\"outline\" size=\"sm\" className=\"text-xs h-8\">\n                Adjustment\n              </Button>\n              <Input\n                type=\"number\"\n                step=\"0.01\"\n                className=\"w-24 h-8\"\n                value={formData.adjustment}\n                onChange={(e) => setFormData(prev => ({ ...prev, adjustment: e.target.value }))}\n                data-testid=\"input-adjustment\"\n              />\n              <span className=\"ml-auto font-medium\">{(parseFloat(formData.adjustment) || 0).toFixed(2)}</span>\n            </div>\n\n            <div className=\"flex justify-between font-semibold text-lg border-t pt-3\">\n              <span>Total (  )</span>\n              <span>{calculateTotal().toFixed(2)}</span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6\">\n          <div>\n            <Label>Notes</Label>\n            <Textarea\n              rows={3}\n              value={formData.notes}\n              onChange={(e) => setFormData(prev => ({ ...prev, notes: e.target.value }))}\n              className=\"resize-none\"\n              data-testid=\"input-notes\"\n            />\n          </div>\n\n          <div>\n            <Label>Attach File(s) to Vendor Credits</Label>\n            <div className=\"flex items-center gap-2 mt-2\">\n              <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\n                <Upload className=\"h-4 w-4\" />\n                Upload File\n              </Button>\n            </div>\n            <p className=\"text-xs text-slate-500 mt-2\">You can upload a maximum of 5 files, 10MB each</p>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"border-t border-slate-200 bg-white px-6 py-4 sticky bottom-0\">\n        <div className=\"flex items-center gap-3\">\n          <Button\n            variant=\"outline\"\n            onClick={() => handleSubmit('DRAFT')}\n            disabled={saving}\n            data-testid=\"button-save-draft\"\n          >\n            {saving ? 'Saving...' : 'Save as Draft'}\n          </Button>\n          <Button\n            className=\"bg-blue-600 hover:bg-blue-700\"\n            onClick={() => handleSubmit('OPEN')}\n            disabled={saving}\n            data-testid=\"button-save-open\"\n          >\n            {saving ? 'Saving...' : 'Save as Open'}\n          </Button>\n          <Button\n            variant=\"ghost\"\n            onClick={() => setLocation('/vendor-credits')}\n            data-testid=\"button-cancel\"\n          >\n            Cancel\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":30745,"size_tokens":null},"client/src/pages/payments-made-create.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  ArrowLeft,\n  RefreshCw,\n  Upload,\n  X,\n  AlertTriangle,\n  Settings,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nconst INDIAN_STATES = [\n  { code: \"AN\", name: \"Andaman and Nicobar Islands\" },\n  { code: \"AP\", name: \"Andhra Pradesh\" },\n  { code: \"AR\", name: \"Arunachal Pradesh\" },\n  { code: \"AS\", name: \"Assam\" },\n  { code: \"BR\", name: \"Bihar\" },\n  { code: \"CH\", name: \"Chandigarh\" },\n  { code: \"CT\", name: \"Chhattisgarh\" },\n  { code: \"DN\", name: \"Dadra and Nagar Haveli and Daman and Diu\" },\n  { code: \"DL\", name: \"Delhi\" },\n  { code: \"GA\", name: \"Goa\" },\n  { code: \"GJ\", name: \"Gujarat\" },\n  { code: \"HR\", name: \"Haryana\" },\n  { code: \"HP\", name: \"Himachal Pradesh\" },\n  { code: \"JK\", name: \"Jammu and Kashmir\" },\n  { code: \"JH\", name: \"Jharkhand\" },\n  { code: \"KA\", name: \"Karnataka\" },\n  { code: \"KL\", name: \"Kerala\" },\n  { code: \"LA\", name: \"Ladakh\" },\n  { code: \"LD\", name: \"Lakshadweep\" },\n  { code: \"MP\", name: \"Madhya Pradesh\" },\n  { code: \"MH\", name: \"Maharashtra\" },\n  { code: \"MN\", name: \"Manipur\" },\n  { code: \"ML\", name: \"Meghalaya\" },\n  { code: \"MZ\", name: \"Mizoram\" },\n  { code: \"NL\", name: \"Nagaland\" },\n  { code: \"OR\", name: \"Odisha\" },\n  { code: \"PY\", name: \"Puducherry\" },\n  { code: \"PB\", name: \"Punjab\" },\n  { code: \"RJ\", name: \"Rajasthan\" },\n  { code: \"SK\", name: \"Sikkim\" },\n  { code: \"TN\", name: \"Tamil Nadu\" },\n  { code: \"TG\", name: \"Telangana\" },\n  { code: \"TR\", name: \"Tripura\" },\n  { code: \"UP\", name: \"Uttar Pradesh\" },\n  { code: \"UK\", name: \"Uttarakhand\" },\n  { code: \"WB\", name: \"West Bengal\" },\n];\n\nconst TDS_OPTIONS = [\n  { value: \"commission_brokerage_2\", label: \"Commission or Brokerage [2%]\" },\n  { value: \"professional_fees_10\", label: \"Professional Fees [10%]\" },\n  { value: \"rent_10\", label: \"Rent [10%]\" },\n  { value: \"contractor_1\", label: \"Payment to Contractor [1%]\" },\n  { value: \"contractor_2\", label: \"Payment to Contractor [2%]\" },\n  { value: \"interest_10\", label: \"Interest [10%]\" },\n];\n\nconst PAYMENT_MODES = [\n  { value: \"cash\", label: \"Cash\" },\n  { value: \"bank_transfer\", label: \"Bank Transfer\" },\n  { value: \"cheque\", label: \"Cheque\" },\n  { value: \"credit_card\", label: \"Credit Card\" },\n  { value: \"upi\", label: \"UPI\" },\n  { value: \"neft\", label: \"NEFT\" },\n  { value: \"rtgs\", label: \"RTGS\" },\n  { value: \"imps\", label: \"IMPS\" },\n];\n\nconst PAID_THROUGH_OPTIONS = [\n  { value: \"petty_cash\", label: \"Petty Cash\" },\n  { value: \"undeposited_funds\", label: \"Undeposited Funds\" },\n  { value: \"bank_account\", label: \"Bank Account\" },\n  { value: \"cash_on_hand\", label: \"Cash On Hand\" },\n];\n\nconst DEPOSIT_TO_OPTIONS = [\n  { value: \"prepaid_expenses\", label: \"Prepaid Expenses\" },\n  { value: \"advance_to_vendor\", label: \"Advance to Vendor\" },\n  { value: \"other\", label: \"Other Current Asset\" },\n];\n\ninterface Vendor {\n  id: string;\n  displayName: string;\n  companyName?: string;\n  gstTreatment?: string;\n  sourceOfSupply?: string;\n}\n\ninterface Bill {\n  id: string;\n  billNumber: string;\n  date: string;\n  purchaseOrderNumber?: string;\n  total: number;\n  amountDue: number;\n  status: string;\n}\n\nexport default function PaymentsMadeCreate() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState(\"bill_payment\");\n  const [saving, setSaving] = useState(false);\n\n  const [formData, setFormData] = useState({\n    vendorId: \"\",\n    vendorName: \"\",\n    gstTreatment: \"\",\n    sourceOfSupply: \"\",\n    destinationOfSupply: \"\",\n    paymentNumber: \"\",\n    descriptionOfSupply: \"\",\n    paymentAmount: \"\",\n    reverseCharge: false,\n    tds: \"\",\n    paymentDate: new Date().toISOString().split(\"T\")[0],\n    paymentMode: \"cash\",\n    paidThrough: \"petty_cash\",\n    depositTo: \"prepaid_expenses\",\n    reference: \"\",\n    notes: \"\",\n    attachments: [] as File[],\n  });\n\n  const [selectedBills, setSelectedBills] = useState<{\n    [key: string]: { payment: number; paymentMadeOn: string };\n  }>({});\n\n  const { data: vendorsData, isLoading: vendorsLoading } = useQuery<{\n    success: boolean;\n    data: Vendor[];\n  }>({\n    queryKey: [\"/api/vendors\"],\n  });\n\n  const { data: billsData, isLoading: billsLoading } = useQuery<{\n    success: boolean;\n    data: Bill[];\n  }>({\n    queryKey: [\"/api/bills\", formData.vendorId],\n    enabled: !!formData.vendorId && activeTab === \"bill_payment\",\n  });\n\n  const { data: nextNumberData } = useQuery<{\n    success: boolean;\n    data: { nextNumber: string };\n  }>({\n    queryKey: [\"/api/payments-made/next-number\"],\n  });\n\n  // Read vendorId from URL params (when navigating from vendor page)\n  const urlParams = new URLSearchParams(window.location.search);\n  const vendorIdFromUrl = urlParams.get('vendorId');\n\n  // Pre-fill vendor data when coming from vendor page\n  useEffect(() => {\n    if (vendorIdFromUrl && vendorsData?.data && vendorsData.data.length > 0 && !formData.vendorId) {\n      const vendor = vendorsData.data.find(v => v.id === vendorIdFromUrl);\n      if (vendor) {\n        setFormData(prev => ({\n          ...prev,\n          vendorId: vendor.id,\n          vendorName: vendor.displayName || vendor.companyName || '',\n          gstTreatment: vendor.gstTreatment || '',\n          sourceOfSupply: vendor.sourceOfSupply || ''\n        }));\n      }\n    }\n  }, [vendorIdFromUrl, vendorsData?.data]);\n\n  useEffect(() => {\n    if (nextNumberData?.data?.nextNumber) {\n      setFormData((prev) => ({\n        ...prev,\n        paymentNumber: nextNumberData.data.nextNumber,\n      }));\n    }\n  }, [nextNumberData]);\n\n  // Re-apply auto-allocation when bills are loaded\n  useEffect(() => {\n    const amount = parseFloat(formData.paymentAmount) || 0;\n    if (vendorBills.length > 0 && amount > 0 && activeTab === \"bill_payment\") {\n      autoAllocatePayment(amount);\n    }\n  }, [billsData]);\n\n  const vendors = vendorsData?.data || [];\n\n  // Filter bills by vendor and unpaid status - use amountDue if available, otherwise use total\n  const vendorBills = (billsData?.data || []).filter((b) => {\n    // First check if bill belongs to selected vendor\n    if (b.vendorId !== formData.vendorId) {\n      return false;\n    }\n    const balance = b.amountDue !== undefined && b.amountDue > 0 ? b.amountDue : b.total;\n    const isUnpaid = b.status !== \"PAID\" && balance > 0;\n    console.log(`Bill ${b.billNumber}: vendorId=${b.vendorId}, amountDue=${b.amountDue}, total=${b.total}, status=${b.status}, isUnpaid=${isUnpaid}`);\n    return isUnpaid;\n  }).map((b) => ({\n    ...b,\n    // Ensure amountDue is set properly\n    amountDue: b.amountDue !== undefined && b.amountDue > 0 ? b.amountDue : b.total\n  }));\n\n  // Auto-allocation function for payment amount\n  const autoAllocatePayment = (totalAmount: number) => {\n    if (vendorBills.length === 0) return;\n\n    if (totalAmount <= 0) {\n      setSelectedBills({});\n      return;\n    }\n\n    // Sort bills by date (oldest first)\n    const sortedBills = [...vendorBills].sort((a, b) =>\n      new Date(a.date).getTime() - new Date(b.date).getTime()\n    );\n\n    let remainingAmount = totalAmount;\n    const newSelectedBills: { [key: string]: { payment: number; paymentMadeOn: string } } = {};\n\n    for (const bill of sortedBills) {\n      if (remainingAmount <= 0) break;\n\n      const billBalance = bill.amountDue > 0 ? bill.amountDue : bill.total;\n      if (billBalance > 0) {\n        const paymentAmount = Math.min(remainingAmount, billBalance);\n        newSelectedBills[bill.id] = {\n          payment: paymentAmount,\n          paymentMadeOn: new Date().toISOString().split(\"T\")[0]\n        };\n        remainingAmount -= paymentAmount;\n        console.log(`Allocated ${paymentAmount} to bill ${bill.billNumber}, remaining: ${remainingAmount}`);\n      }\n    }\n\n    setSelectedBills(newSelectedBills);\n  };\n\n  // Handle payment amount change with auto-allocation\n  const handlePaymentAmountChange = (amount: string) => {\n    setFormData((prev) => ({ ...prev, paymentAmount: amount }));\n    const numAmount = parseFloat(amount) || 0;\n    if (numAmount > 0 && activeTab === \"bill_payment\") {\n      autoAllocatePayment(numAmount);\n    }\n  };\n\n  const handleVendorChange = (vendorId: string) => {\n    const vendor = vendors.find((v) => v.id === vendorId);\n    if (vendor) {\n      setFormData((prev) => ({\n        ...prev,\n        vendorId: vendor.id,\n        vendorName: vendor.displayName,\n        gstTreatment: vendor.gstTreatment || \"Unregistered Business\",\n        sourceOfSupply: vendor.sourceOfSupply || \"\",\n        destinationOfSupply: vendor.sourceOfSupply || \"\",\n      }));\n      setSelectedBills({});\n      // Re-apply auto-allocation if payment amount exists\n      const amount = parseFloat(formData.paymentAmount) || 0;\n      if (amount > 0) {\n        setTimeout(() => autoAllocatePayment(amount), 100);\n      }\n    }\n  };\n\n  const handleBillPaymentChange = (billId: string, payment: number) => {\n    setSelectedBills((prev) => ({\n      ...prev,\n      [billId]: {\n        payment,\n        paymentMadeOn: new Date().toISOString().split(\"T\")[0],\n      },\n    }));\n  };\n\n  const calculateTotals = () => {\n    const totalPaid = Object.values(selectedBills).reduce(\n      (sum, b) => sum + (b.payment || 0),\n      0,\n    );\n    const amountPaid = parseFloat(formData.paymentAmount) || 0;\n    const usedForPayments = totalPaid;\n    const amountRefunded = 0;\n    const amountInExcess = amountPaid - usedForPayments;\n\n    return { amountPaid, usedForPayments, amountRefunded, amountInExcess };\n  };\n\n  const totals = calculateTotals();\n\n  const handleSubmit = async (status: \"DRAFT\" | \"PAID\") => {\n    if (!formData.vendorId) {\n      toast({ title: \"Please select a vendor\", variant: \"destructive\" });\n      return;\n    }\n\n    if (!formData.paymentAmount || parseFloat(formData.paymentAmount) <= 0) {\n      toast({\n        title: \"Please enter a valid payment amount\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setSaving(true);\n    try {\n      const payload = {\n        ...formData,\n        paymentAmount: parseFloat(formData.paymentAmount),\n        billPayments: activeTab === \"bill_payment\" ? selectedBills : {},\n        paymentType: activeTab,\n        status,\n      };\n\n      const response = await fetch(\"/api/payments-made\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(payload),\n      });\n\n      if (response.ok) {\n        toast({\n          title: `Payment ${status === \"DRAFT\" ? \"saved as draft\" : \"recorded\"} successfully`,\n        });\n        setLocation(\"/payments-made\");\n      } else {\n        const error = await response.json();\n        toast({\n          title: error.message || \"Failed to save payment\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({ title: \"Failed to save payment\", variant: \"destructive\" });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const clearAppliedAmount = () => {\n    setSelectedBills({});\n  };\n\n  return (\n    <div className=\"min-h-screen bg-slate-50\">\n      <div className=\"border-b border-slate-200 bg-white px-6 py-4 sticky top-0 z-10\">\n        <div className=\"flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setLocation(\"/payments-made\")}\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"h-5 w-5\" />\n          </Button>\n          <h1 className=\"text-xl font-semibold\">New Payment Made</h1>\n        </div>\n      </div>\n\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n          <TabsList className=\"mb-6\">\n            <TabsTrigger value=\"bill_payment\" data-testid=\"tab-bill-payment\">\n              Bill Payment\n            </TabsTrigger>\n            <TabsTrigger\n              value=\"vendor_advance\"\n              data-testid=\"tab-vendor-advance\"\n            >\n              Vendor Advance\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"bill_payment\" className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n              <div className=\"md:col-span-2\">\n                <Label className=\"text-red-500\">Vendor Name*</Label>\n                <Select\n                  value={formData.vendorId}\n                  onValueChange={handleVendorChange}\n                >\n                  <SelectTrigger data-testid=\"select-vendor\">\n                    <SelectValue placeholder=\"Select a Vendor\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {vendorsLoading ? (\n                      <SelectItem value=\"_loading\" disabled>\n                        Loading...\n                      </SelectItem>\n                    ) : vendors.length === 0 ? (\n                      <SelectItem value=\"_empty\" disabled>\n                        No vendors found\n                      </SelectItem>\n                    ) : (\n                      vendors.map((vendor) => (\n                        <SelectItem key={vendor.id} value={vendor.id}>\n                          {vendor.displayName}\n                        </SelectItem>\n                      ))\n                    )}\n                  </SelectContent>\n                </Select>\n                {formData.gstTreatment && (\n                  <p className=\"text-sm text-slate-500 mt-1\">\n                    GST Treatment: {formData.gstTreatment}{\" \"}\n                    <Settings className=\"h-3 w-3 inline ml-1 cursor-pointer\" />\n                  </p>\n                )}\n              </div>\n\n              {formData.vendorId && (\n                <div className=\"text-right\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"bg-blue-600 text-white hover:bg-blue-700\"\n                    onClick={() =>\n                      setLocation(`/vendors/${formData.vendorId}/edit`)\n                    }\n                    data-testid=\"button-vendor-details\"\n                  >\n                    {formData.vendorName}'s Details &gt;\n                  </Button>\n                </div>\n              )}\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div>\n                <Label className=\"text-red-500\">Payment #*</Label>\n                <div className=\"relative\">\n                  <Input\n                    value={formData.paymentNumber}\n                    onChange={(e) =>\n                      setFormData((prev) => ({\n                        ...prev,\n                        paymentNumber: e.target.value,\n                      }))\n                    }\n                    data-testid=\"input-payment-number\"\n                  />\n                  <RefreshCw className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400 cursor-pointer\" />\n                </div>\n              </div>\n\n              <div>\n                <Label className=\"text-red-500\">Payment Made*</Label>\n                <div className=\"flex\">\n                  <span className=\"inline-flex items-center px-3 border border-r-0 rounded-l-md bg-slate-50 text-sm text-slate-500\">\n                    INR\n                  </span>\n                  <Input\n                    type=\"number\"\n                    step=\"0.01\"\n                    className=\"rounded-l-none\"\n                    value={formData.paymentAmount}\n                    onChange={(e) => handlePaymentAmountChange(e.target.value)}\n                    placeholder=\"Enter amount to auto-allocate to bills\"\n                    data-testid=\"input-payment-amount\"\n                  />\n                </div>\n                <p className=\"text-xs text-slate-500 mt-1\">\n                  Enter amount to automatically allocate across unpaid bills (oldest first)\n                </p>\n              </div>\n            </div>\n\n            {/* <Card className=\"bg-amber-50 border-amber-200\">\n              <CardContent className=\"flex items-center gap-3 py-3\">\n                <span className=\"text-amber-600 text-lg\"></span>\n                <p className=\"text-sm text-slate-700\">\n                  Initiate payments for your bills directly from Zoho Books by\n                  integrating with one of our partner banks.{\" \"}\n                  <span className=\"text-blue-600 cursor-pointer\">\n                    Set Up Now\n                  </span>\n                </p>\n                <X className=\"h-4 w-4 text-red-500 cursor-pointer ml-auto\" />\n              </CardContent>\n            </Card>\n */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div>\n                <Label className=\"text-red-500\">Payment Date*</Label>\n                <Input\n                  type=\"date\"\n                  value={formData.paymentDate}\n                  onChange={(e) =>\n                    setFormData((prev) => ({\n                      ...prev,\n                      paymentDate: e.target.value,\n                    }))\n                  }\n                  data-testid=\"input-payment-date\"\n                />\n              </div>\n\n              <div>\n                <Label>Payment Mode</Label>\n                <Select\n                  value={formData.paymentMode}\n                  onValueChange={(v) =>\n                    setFormData((prev) => ({ ...prev, paymentMode: v }))\n                  }\n                >\n                  <SelectTrigger data-testid=\"select-payment-mode\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {PAYMENT_MODES.map((mode) => (\n                      <SelectItem key={mode.value} value={mode.value}>\n                        {mode.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <Label className=\"text-red-500\">Paid Through*</Label>\n                <Select\n                  value={formData.paidThrough}\n                  onValueChange={(v) =>\n                    setFormData((prev) => ({ ...prev, paidThrough: v }))\n                  }\n                >\n                  <SelectTrigger data-testid=\"select-paid-through\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {PAID_THROUGH_OPTIONS.map((option) => (\n                      <SelectItem key={option.value} value={option.value}>\n                        {option.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <Label>Reference#</Label>\n                <Input\n                  value={formData.reference}\n                  onChange={(e) =>\n                    setFormData((prev) => ({\n                      ...prev,\n                      reference: e.target.value,\n                    }))\n                  }\n                  data-testid=\"input-reference\"\n                />\n              </div>\n            </div>\n\n            {formData.vendorId && (\n              <div className=\"mt-6\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h3 className=\"font-medium text-slate-700\">\n                    Bills for {formData.vendorName}\n                  </h3>\n                  <button\n                    className=\"text-sm text-blue-600 cursor-pointer\"\n                    onClick={clearAppliedAmount}\n                  >\n                    Clear Applied Amount\n                  </button>\n                </div>\n\n                <div className=\"border rounded-lg overflow-hidden\">\n                  <table className=\"w-full text-sm\">\n                    <thead className=\"bg-slate-50 border-b\">\n                      <tr>\n                        <th className=\"px-4 py-3 text-left font-medium text-slate-600\">\n                          Date\n                        </th>\n                        <th className=\"px-4 py-3 text-left font-medium text-slate-600\">\n                          Bill#\n                        </th>\n                        <th className=\"px-4 py-3 text-left font-medium text-slate-600\">\n                          PO#\n                        </th>\n                        <th className=\"px-4 py-3 text-right font-medium text-slate-600\">\n                          Bill Amount\n                        </th>\n                        <th className=\"px-4 py-3 text-right font-medium text-slate-600\">\n                          Amount Due\n                        </th>\n                        <th className=\"px-4 py-3 text-center font-medium text-slate-600\">\n                          Payment Made on\n                        </th>\n                        <th className=\"px-4 py-3 text-right font-medium text-slate-600\">\n                          Payment\n                        </th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {billsLoading ? (\n                        <tr>\n                          <td\n                            colSpan={7}\n                            className=\"px-4 py-8 text-center text-slate-500\"\n                          >\n                            Loading bills...\n                          </td>\n                        </tr>\n                      ) : vendorBills.length === 0 ? (\n                        <tr>\n                          <td\n                            colSpan={7}\n                            className=\"px-4 py-8 text-center text-slate-500\"\n                          >\n                            There are no unpaid bills for this vendor.\n                          </td>\n                        </tr>\n                      ) : (\n                        vendorBills.map((bill) => (\n                          <tr\n                            key={bill.id}\n                            className=\"border-b last:border-b-0\"\n                          >\n                            <td className=\"px-4 py-3\">{bill.date}</td>\n                            <td className=\"px-4 py-3 text-blue-600\">\n                              {bill.billNumber}\n                            </td>\n                            <td className=\"px-4 py-3\">\n                              {bill.purchaseOrderNumber || \"-\"}\n                            </td>\n                            <td className=\"px-4 py-3 text-right\">\n                              {bill.total.toFixed(2)}\n                            </td>\n                            <td className=\"px-4 py-3 text-right\">\n                              {bill.amountDue.toFixed(2)}\n                            </td>\n                            <td className=\"px-4 py-3 text-center\">\n                              <Input\n                                type=\"date\"\n                                className=\"h-8 w-32 mx-auto\"\n                                value={\n                                  selectedBills[bill.id]?.paymentMadeOn || \"\"\n                                }\n                                onChange={(e) =>\n                                  setSelectedBills((prev) => ({\n                                    ...prev,\n                                    [bill.id]: {\n                                      ...prev[bill.id],\n                                      paymentMadeOn: e.target.value,\n                                    },\n                                  }))\n                                }\n                              />\n                            </td>\n                            <td className=\"px-4 py-3 text-right\">\n                              <Input\n                                type=\"number\"\n                                step=\"0.01\"\n                                className=\"h-8 w-24 ml-auto text-right\"\n                                placeholder=\"0.00\"\n                                value={selectedBills[bill.id]?.payment || \"\"}\n                                onChange={(e) =>\n                                  handleBillPaymentChange(\n                                    bill.id,\n                                    parseFloat(e.target.value) || 0,\n                                  )\n                                }\n                              />\n                            </td>\n                          </tr>\n                        ))\n                      )}\n                    </tbody>\n                  </table>\n                </div>\n\n                <div className=\"flex justify-end mt-4\">\n                  <div className=\"text-right space-y-1\">\n                    <p className=\"text-sm\">\n                      <span className=\"text-slate-500\">Total:</span>{\" \"}\n                      <span className=\"font-medium\">\n                        {Object.values(selectedBills)\n                          .reduce((sum, b) => sum + (b.payment || 0), 0)\n                          .toFixed(2)}\n                      </span>\n                    </p>\n                  </div>\n                </div>\n\n                <Card className=\"bg-amber-50 border-amber-200 mt-4\">\n                  <CardContent className=\"py-4\">\n                    <div className=\"space-y-2 text-sm text-right\">\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-slate-600\">Amount Paid:</span>\n                        <span>{totals.amountPaid.toFixed(2)}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-slate-600\">\n                          Amount used for Payments:\n                        </span>\n                        <span>{totals.usedForPayments.toFixed(2)}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-slate-600\">Amount Refunded:</span>\n                        <span>{totals.amountRefunded.toFixed(2)}</span>\n                      </div>\n                      <div className=\"flex justify-between items-center\">\n                        <span className=\"text-amber-600 flex items-center gap-1\">\n                          <AlertTriangle className=\"h-4 w-4\" />\n                          Amount in Excess:\n                        </span>\n                        <span className=\"text-amber-600\">\n                           {totals.amountInExcess.toFixed(2)}\n                        </span>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n            )}\n\n            <div className=\"mt-6\">\n              <Label>Notes (Internal use. Not visible to vendor)</Label>\n              <Textarea\n                rows={3}\n                value={formData.notes}\n                onChange={(e) =>\n                  setFormData((prev) => ({ ...prev, notes: e.target.value }))\n                }\n                className=\"resize-none\"\n                data-testid=\"input-notes\"\n              />\n            </div>\n\n            <div className=\"mt-6\">\n              <Label>Attachments</Label>\n              <div className=\"flex items-center gap-2 mt-2\">\n                <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\n                  <Upload className=\"h-4 w-4\" />\n                  Upload File\n                </Button>\n              </div>\n              <p className=\"text-xs text-slate-500 mt-2\">\n                You can upload a maximum of 5 files, 10MB each\n              </p>\n            </div>\n\n            <div className=\"mt-4 text-sm text-slate-500\">\n              <strong>Additional Fields:</strong> Start adding custom fields for\n              your payments made by going to{\" \"}\n              <span className=\"text-blue-600\">Settings</span> {\" \"}\n              <span className=\"text-blue-600\">Purchases</span> {\" \"}\n              <span className=\"text-blue-600\">Payments Made</span>.\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"vendor_advance\" className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div>\n                <Label className=\"text-red-500\">Vendor Name*</Label>\n                <Select\n                  value={formData.vendorId}\n                  onValueChange={handleVendorChange}\n                >\n                  <SelectTrigger data-testid=\"select-vendor-advance\">\n                    <SelectValue placeholder=\"Select a Vendor\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {vendorsLoading ? (\n                      <SelectItem value=\"_loading\" disabled>\n                        Loading...\n                      </SelectItem>\n                    ) : vendors.length === 0 ? (\n                      <SelectItem value=\"_empty\" disabled>\n                        No vendors found\n                      </SelectItem>\n                    ) : (\n                      vendors.map((vendor) => (\n                        <SelectItem key={vendor.id} value={vendor.id}>\n                          {vendor.displayName}\n                        </SelectItem>\n                      ))\n                    )}\n                  </SelectContent>\n                </Select>\n                {formData.gstTreatment && (\n                  <p className=\"text-sm text-slate-500 mt-1\">\n                    GST Treatment: {formData.gstTreatment}{\" \"}\n                    <Settings className=\"h-3 w-3 inline ml-1 cursor-pointer\" />\n                  </p>\n                )}\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div>\n                <Label className=\"text-red-500\">Source of Supply*</Label>\n                <Select\n                  value={formData.sourceOfSupply}\n                  onValueChange={(v) =>\n                    setFormData((prev) => ({ ...prev, sourceOfSupply: v }))\n                  }\n                >\n                  <SelectTrigger data-testid=\"select-source-supply\">\n                    <SelectValue placeholder=\"Select State\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {INDIAN_STATES.map((state) => (\n                      <SelectItem\n                        key={state.code}\n                        value={`[${state.code}] - ${state.name}`}\n                      >\n                        [{state.code}] - {state.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <Label className=\"text-red-500\">Destination of Supply*</Label>\n                <Select\n                  value={formData.destinationOfSupply}\n                  onValueChange={(v) =>\n                    setFormData((prev) => ({ ...prev, destinationOfSupply: v }))\n                  }\n                >\n                  <SelectTrigger data-testid=\"select-destination-supply\">\n                    <SelectValue placeholder=\"Select State\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {INDIAN_STATES.map((state) => (\n                      <SelectItem\n                        key={state.code}\n                        value={`[${state.code}] - ${state.name}`}\n                      >\n                        [{state.code}] - {state.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div>\n                <Label className=\"text-red-500\">Payment #*</Label>\n                <div className=\"relative\">\n                  <Input\n                    value={formData.paymentNumber}\n                    onChange={(e) =>\n                      setFormData((prev) => ({\n                        ...prev,\n                        paymentNumber: e.target.value,\n                      }))\n                    }\n                    data-testid=\"input-payment-number-advance\"\n                  />\n                  <RefreshCw className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400 cursor-pointer\" />\n                </div>\n              </div>\n\n              <div>\n                <Label>Description of Supply</Label>\n                <Textarea\n                  rows={2}\n                  placeholder=\"Will be displayed on the Payment Voucher\"\n                  value={formData.descriptionOfSupply}\n                  onChange={(e) =>\n                    setFormData((prev) => ({\n                      ...prev,\n                      descriptionOfSupply: e.target.value,\n                    }))\n                  }\n                  className=\"resize-none\"\n                  data-testid=\"input-description-supply\"\n                />\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div>\n                <Label className=\"text-red-500\">Payment Made*</Label>\n                <div className=\"flex\">\n                  <span className=\"inline-flex items-center px-3 border border-r-0 rounded-l-md bg-slate-50 text-sm text-slate-500\">\n                    INR\n                  </span>\n                  <Input\n                    type=\"number\"\n                    step=\"0.01\"\n                    className=\"rounded-l-none\"\n                    value={formData.paymentAmount}\n                    onChange={(e) =>\n                      setFormData((prev) => ({\n                        ...prev,\n                        paymentAmount: e.target.value,\n                      }))\n                    }\n                    placeholder=\"Enter advance amount\"\n                    data-testid=\"input-payment-amount-advance\"\n                  />\n                </div>\n              </div>\n            </div>\n\n            <div className=\"flex items-center gap-2\">\n              <Label>Reverse Charge</Label>\n              <Checkbox\n                checked={formData.reverseCharge}\n                onCheckedChange={(checked) =>\n                  setFormData((prev) => ({ ...prev, reverseCharge: !!checked }))\n                }\n                data-testid=\"checkbox-reverse-charge\"\n              />\n              <span className=\"text-sm text-slate-600\">\n                This transaction is applicable for reverse charge\n              </span>\n            </div>\n\n            <div>\n              <Label>TDS</Label>\n              <Select\n                value={formData.tds}\n                onValueChange={(v) =>\n                  setFormData((prev) => ({ ...prev, tds: v }))\n                }\n              >\n                <SelectTrigger data-testid=\"select-tds\">\n                  <SelectValue placeholder=\"Select TDS\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {TDS_OPTIONS.map((option) => (\n                    <SelectItem key={option.value} value={option.value}>\n                      {option.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div>\n                <Label className=\"text-red-500\">Payment Date*</Label>\n                <Input\n                  type=\"date\"\n                  value={formData.paymentDate}\n                  onChange={(e) =>\n                    setFormData((prev) => ({\n                      ...prev,\n                      paymentDate: e.target.value,\n                    }))\n                  }\n                  data-testid=\"input-payment-date-advance\"\n                />\n              </div>\n\n              <div>\n                <Label>Payment Mode</Label>\n                <Select\n                  value={formData.paymentMode}\n                  onValueChange={(v) =>\n                    setFormData((prev) => ({ ...prev, paymentMode: v }))\n                  }\n                >\n                  <SelectTrigger data-testid=\"select-payment-mode-advance\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {PAYMENT_MODES.map((mode) => (\n                      <SelectItem key={mode.value} value={mode.value}>\n                        {mode.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <Label className=\"text-red-500\">Paid Through*</Label>\n                <Select\n                  value={formData.paidThrough}\n                  onValueChange={(v) =>\n                    setFormData((prev) => ({ ...prev, paidThrough: v }))\n                  }\n                >\n                  <SelectTrigger data-testid=\"select-paid-through-advance\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {PAID_THROUGH_OPTIONS.map((option) => (\n                      <SelectItem key={option.value} value={option.value}>\n                        {option.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <Label>Deposit To</Label>\n                <Select\n                  value={formData.depositTo}\n                  onValueChange={(v) =>\n                    setFormData((prev) => ({ ...prev, depositTo: v }))\n                  }\n                >\n                  <SelectTrigger data-testid=\"select-deposit-to\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {DEPOSIT_TO_OPTIONS.map((option) => (\n                      <SelectItem key={option.value} value={option.value}>\n                        {option.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <Label>Reference#</Label>\n                <Input\n                  value={formData.reference}\n                  onChange={(e) =>\n                    setFormData((prev) => ({\n                      ...prev,\n                      reference: e.target.value,\n                    }))\n                  }\n                  data-testid=\"input-reference-advance\"\n                />\n              </div>\n            </div>\n\n            <div className=\"mt-6\">\n              <Label>Notes (Internal use. Not visible to vendor)</Label>\n              <Textarea\n                rows={3}\n                value={formData.notes}\n                onChange={(e) =>\n                  setFormData((prev) => ({ ...prev, notes: e.target.value }))\n                }\n                className=\"resize-none\"\n                data-testid=\"input-notes-advance\"\n              />\n            </div>\n\n            <div className=\"mt-6\">\n              <Label>Attachments</Label>\n              <div className=\"flex items-center gap-2 mt-2\">\n                <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\n                  <Upload className=\"h-4 w-4\" />\n                  Upload File\n                </Button>\n              </div>\n              <p className=\"text-xs text-slate-500 mt-2\">\n                You can upload a maximum of 5 files, 10MB each\n              </p>\n            </div>\n\n            <div className=\"mt-4 text-sm text-slate-500\">\n              <strong>Additional Fields:</strong> Start adding custom fields for\n              your payments made by going to{\" \"}\n              <span className=\"text-blue-600\">Settings</span> {\" \"}\n              <span className=\"text-blue-600\">Purchases</span> {\" \"}\n              <span className=\"text-blue-600\">Payments Made</span>.\n            </div>\n          </TabsContent>\n        </Tabs>\n      </div>\n\n      <div className=\"border-t border-slate-200 bg-white px-6 py-4 sticky bottom-0\">\n        <div className=\"flex items-center gap-3\">\n          <Button\n            variant=\"outline\"\n            onClick={() => handleSubmit(\"DRAFT\")}\n            disabled={saving}\n            data-testid=\"button-save-draft\"\n          >\n            {saving ? \"Saving...\" : \"Save as Draft\"}\n          </Button>\n          <Button\n            className=\"bg-blue-600 hover:bg-blue-700\"\n            onClick={() => handleSubmit(\"PAID\")}\n            disabled={saving}\n            data-testid=\"button-save-paid\"\n          >\n            {saving ? \"Saving...\" : \"Save as Paid\"}\n          </Button>\n          <Button\n            variant=\"ghost\"\n            onClick={() => setLocation(\"/payments-made\")}\n            data-testid=\"button-cancel\"\n          >\n            Cancel\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":41470,"size_tokens":null},"client/src/hooks/use-transaction-bootstrap.ts":{"content":"import { useState, useEffect, useCallback, useMemo } from 'react';\nimport { useLocation } from 'wouter';\nimport { useCustomerSnapshot } from './use-customer-snapshot';\nimport { \n  CustomerSnapshot, \n  TaxRegime,\n  formatAddressDisplay,\n  calculateDueDateFromTerms \n} from '@/lib/customer-snapshot';\n\ninterface TransactionBootstrapOptions {\n  transactionType: 'invoice' | 'quote' | 'sales_order' | 'delivery_challan' | 'payment' | 'credit_note';\n}\n\ninterface TransactionBootstrapReturn {\n  // Customer data\n  customerId: string | null;\n  setCustomerId: (id: string | null) => void;\n  customerSnapshot: CustomerSnapshot | null;\n  taxRegime: TaxRegime;\n  isLoadingCustomer: boolean;\n  customerError: string | null;\n  \n  // Formatted data for form population\n  formData: {\n    customerName: string;\n    displayName: string;\n    billingAddressStr: string;\n    shippingAddressStr: string;\n    gstTreatment: string;\n    taxPreference: 'taxable' | 'tax_exempt';\n    gstin: string;\n    placeOfSupply: string;\n    pan: string;\n    currency: string;\n    paymentTerms: string;\n    isTaxExempt: boolean;\n    exemptionReason: string;\n  };\n  \n  // Actions\n  refreshCustomer: () => Promise<void>;\n  onCustomerChange: (newCustomerId: string) => void;\n}\n\nexport function useTransactionBootstrap(\n  options: TransactionBootstrapOptions\n): TransactionBootstrapReturn {\n  const [location] = useLocation();\n  const [customerId, setCustomerId] = useState<string | null>(null);\n  const [lastSearch, setLastSearch] = useState<string>('');\n  \n  // Use customer snapshot hook (must be defined before useEffect that uses clearSnapshot)\n  const {\n    snapshot: customerSnapshot,\n    taxRegime,\n    isLoading: isLoadingCustomer,\n    error: customerError,\n    fetchCustomer,\n    clearSnapshot\n  } = useCustomerSnapshot(customerId);\n  \n  // Extract customerId from URL whenever location or window.location.search changes\n  // Wouter's location doesn't include query params, so we use the native browser API\n  useEffect(() => {\n    const currentSearch = window.location.search;\n    \n    // Only re-process if the search string has changed\n    if (currentSearch !== lastSearch) {\n      setLastSearch(currentSearch);\n      const searchParams = new URLSearchParams(currentSearch);\n      const urlCustomerId = searchParams.get('customerId');\n      \n      // Set or clear customerId based on URL\n      if (urlCustomerId && urlCustomerId !== customerId) {\n        setCustomerId(urlCustomerId);\n      } else if (!urlCustomerId && customerId && lastSearch !== '') {\n        // Clear customerId when navigating to a page without customerId param\n        // Only clear if we had a previous search string (to avoid clearing on initial mount)\n        setCustomerId(null);\n        clearSnapshot();\n      }\n    }\n  }, [location, customerId, lastSearch, clearSnapshot]);\n  \n  // Handle customer change\n  const onCustomerChange = useCallback((newCustomerId: string) => {\n    if (newCustomerId === customerId) return;\n    \n    // Clear previous data\n    clearSnapshot();\n    \n    // Set new customer\n    setCustomerId(newCustomerId || null);\n  }, [customerId, clearSnapshot]);\n  \n  // Refresh customer data\n  const refreshCustomer = useCallback(async () => {\n    if (customerId) {\n      await fetchCustomer(customerId);\n    }\n  }, [customerId, fetchCustomer]);\n  \n  // Computed form data for easy consumption\n  const formData = {\n    customerName: customerSnapshot?.customerName || '',\n    displayName: customerSnapshot?.displayName || '',\n    billingAddressStr: customerSnapshot ? formatAddressDisplay(customerSnapshot.billingAddress) : '',\n    shippingAddressStr: customerSnapshot ? formatAddressDisplay(customerSnapshot.shippingAddress) : '',\n    gstTreatment: customerSnapshot?.gstTreatment || '',\n    taxPreference: customerSnapshot?.taxPreference || 'taxable',\n    gstin: customerSnapshot?.gstin || '',\n    placeOfSupply: customerSnapshot?.placeOfSupply || '',\n    pan: customerSnapshot?.pan || '',\n    currency: customerSnapshot?.currency || 'INR',\n    paymentTerms: customerSnapshot?.paymentTerms || 'Due on Receipt',\n    isTaxExempt: customerSnapshot?.taxPreference === 'tax_exempt',\n    exemptionReason: customerSnapshot?.exemptionReason || ''\n  };\n  \n  return {\n    customerId,\n    setCustomerId,\n    customerSnapshot,\n    taxRegime,\n    isLoadingCustomer,\n    customerError,\n    formData,\n    refreshCustomer,\n    onCustomerChange\n  };\n}\n","path":null,"size_bytes":4400,"size_tokens":null},"client/src/hooks/use-customer-snapshot.ts":{"content":"import { useState, useEffect, useCallback } from 'react';\nimport { useToast } from '@/hooks/use-toast';\nimport { \n  CustomerSnapshot, \n  createCustomerSnapshot, \n  determineTaxRegime,\n  TaxRegime \n} from '@/lib/customer-snapshot';\n\ninterface UseCustomerSnapshotOptions {\n  autoFetch?: boolean;\n}\n\ninterface UseCustomerSnapshotReturn {\n  snapshot: CustomerSnapshot | null;\n  taxRegime: TaxRegime;\n  isLoading: boolean;\n  error: string | null;\n  fetchCustomer: (customerId: string) => Promise<CustomerSnapshot | null>;\n  clearSnapshot: () => void;\n  setSnapshot: (snapshot: CustomerSnapshot | null) => void;\n}\n\nexport function useCustomerSnapshot(\n  customerId: string | null,\n  options: UseCustomerSnapshotOptions = {}\n): UseCustomerSnapshotReturn {\n  const { autoFetch = true } = options;\n  const { toast } = useToast();\n  \n  const [snapshot, setSnapshot] = useState<CustomerSnapshot | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  \n  const fetchCustomer = useCallback(async (id: string): Promise<CustomerSnapshot | null> => {\n    if (!id) return null;\n    \n    setIsLoading(true);\n    setError(null);\n    \n    try {\n      const response = await fetch(`/api/customers/${id}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch customer');\n      }\n      \n      const data = await response.json();\n      const customer = data.data || data;\n      \n      const customerSnapshot = createCustomerSnapshot(customer);\n      setSnapshot(customerSnapshot);\n      return customerSnapshot;\n    } catch (err) {\n      const errorMessage = 'Unable to load customer details. Please retry.';\n      setError(errorMessage);\n      toast({\n        title: 'Warning',\n        description: errorMessage,\n        variant: 'destructive'\n      });\n      return null;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [toast]);\n  \n  const clearSnapshot = useCallback(() => {\n    setSnapshot(null);\n    setError(null);\n  }, []);\n  \n  // Auto-fetch when customerId changes\n  useEffect(() => {\n    if (autoFetch && customerId) {\n      fetchCustomer(customerId);\n    } else if (!customerId) {\n      clearSnapshot();\n    }\n  }, [customerId, autoFetch, fetchCustomer, clearSnapshot]);\n  \n  // Calculate tax regime based on current snapshot\n  const taxRegime = determineTaxRegime(snapshot);\n  \n  return {\n    snapshot,\n    taxRegime,\n    isLoading,\n    error,\n    fetchCustomer,\n    clearSnapshot,\n    setSnapshot\n  };\n}\n","path":null,"size_bytes":2488,"size_tokens":null},"client/src/lib/customer-snapshot.ts":{"content":"// Customer Snapshot Types and Utilities\n// Used for storing immutable customer data in transactions\n\nexport interface Address {\n  street: string;\n  city: string;\n  state: string;\n  country: string;\n  pincode: string;\n}\n\nexport interface CustomerSnapshot {\n  customerId: string;\n  customerName: string;\n  displayName: string;\n  companyName: string;\n  email: string;\n  phone: string;\n  \n  // Addresses\n  billingAddress: Address;\n  shippingAddress: Address;\n  \n  // Tax & Compliance\n  gstTreatment: string;\n  taxPreference: 'taxable' | 'tax_exempt';\n  gstin: string;\n  placeOfSupply: string;\n  pan: string;\n  exemptionReason?: string;\n  \n  // Commercial\n  currency: string;\n  paymentTerms: string;\n  priceList?: string;\n  \n  // Snapshot metadata\n  snapshotDate: string;\n}\n\nexport interface TaxRegime {\n  regime: 'intra' | 'inter' | 'exempt';\n  cgstRate: number;\n  sgstRate: number;\n  igstRate: number;\n  reason?: string;\n}\n\n// Company's Place of Supply (from organization settings)\n// Default to Maharashtra (27) if not configured\nconst COMPANY_STATE_CODE = '27'; // Maharashtra\n\n// Extract state code from GSTIN (first 2 characters)\nexport function extractStateCodeFromGSTIN(gstin: string): string {\n  if (!gstin || gstin.length < 2) return '';\n  return gstin.substring(0, 2);\n}\n\n// Determine tax regime based on customer's place of supply vs company's place of supply\nexport function determineTaxRegime(\n  customerSnapshot: CustomerSnapshot | null,\n  companyPlaceOfSupply: string = COMPANY_STATE_CODE\n): TaxRegime {\n  // If no customer data, default to intra-state\n  if (!customerSnapshot) {\n    return {\n      regime: 'intra',\n      cgstRate: 9,\n      sgstRate: 9,\n      igstRate: 0,\n      reason: 'No customer selected'\n    };\n  }\n  \n  // If tax exempt\n  if (customerSnapshot.taxPreference === 'tax_exempt') {\n    return {\n      regime: 'exempt',\n      cgstRate: 0,\n      sgstRate: 0,\n      igstRate: 0,\n      reason: customerSnapshot.exemptionReason || 'Customer is tax exempt'\n    };\n  }\n  \n  // Extract state code from customer's place of supply or GSTIN\n  let customerStateCode = '';\n  \n  // Try to get from Place of Supply first (format: \"27 - Maharashtra\" or just \"27\")\n  if (customerSnapshot.placeOfSupply) {\n    const match = customerSnapshot.placeOfSupply.match(/^(\\d{2})/);\n    if (match) {\n      customerStateCode = match[1];\n    }\n  }\n  \n  // Fallback to GSTIN\n  if (!customerStateCode && customerSnapshot.gstin) {\n    customerStateCode = extractStateCodeFromGSTIN(customerSnapshot.gstin);\n  }\n  \n  // If still no state code, default to intra-state\n  if (!customerStateCode) {\n    return {\n      regime: 'intra',\n      cgstRate: 9,\n      sgstRate: 9,\n      igstRate: 0,\n      reason: 'Same state transaction (default)'\n    };\n  }\n  \n  // Compare state codes\n  if (customerStateCode === companyPlaceOfSupply) {\n    return {\n      regime: 'intra',\n      cgstRate: 9,\n      sgstRate: 9,\n      igstRate: 0,\n      reason: 'Same state transaction'\n    };\n  } else {\n    return {\n      regime: 'inter',\n      cgstRate: 0,\n      sgstRate: 0,\n      igstRate: 18,\n      reason: 'Inter-state transaction'\n    };\n  }\n}\n\n// Calculate tax amounts for a line item\nexport function calculateItemTax(\n  amount: number,\n  gstRate: number,\n  taxRegime: TaxRegime\n): { cgst: number; sgst: number; igst: number; total: number } {\n  if (taxRegime.regime === 'exempt' || gstRate <= 0) {\n    return { cgst: 0, sgst: 0, igst: 0, total: 0 };\n  }\n  \n  const totalTax = amount * (gstRate / 100);\n  \n  if (taxRegime.regime === 'inter') {\n    return {\n      cgst: 0,\n      sgst: 0,\n      igst: totalTax,\n      total: totalTax\n    };\n  } else {\n    // Intra-state: split equally between CGST and SGST\n    const halfTax = totalTax / 2;\n    return {\n      cgst: halfTax,\n      sgst: halfTax,\n      igst: 0,\n      total: totalTax\n    };\n  }\n}\n\n// Convert customer API response to CustomerSnapshot\nexport function createCustomerSnapshot(customer: any): CustomerSnapshot {\n  const defaultAddress: Address = {\n    street: '',\n    city: '',\n    state: '',\n    country: 'India',\n    pincode: ''\n  };\n  \n  const billingAddress: Address = customer.billingAddress \n    ? (typeof customer.billingAddress === 'string' \n        ? { ...defaultAddress, street: customer.billingAddress }\n        : { ...defaultAddress, ...customer.billingAddress })\n    : defaultAddress;\n    \n  // Use shipping address if available, otherwise fallback to billing address\n  const shippingAddress: Address = customer.shippingAddress \n    ? (typeof customer.shippingAddress === 'string'\n        ? { ...defaultAddress, street: customer.shippingAddress }\n        : { ...defaultAddress, ...customer.shippingAddress })\n    : billingAddress;\n  \n  return {\n    customerId: customer.id || '',\n    customerName: customer.name || '',\n    displayName: customer.displayName || customer.name || '',\n    companyName: customer.companyName || '',\n    email: customer.email || '',\n    phone: customer.phone || customer.workPhone || '',\n    \n    billingAddress,\n    shippingAddress,\n    \n    gstTreatment: customer.gstTreatment || '',\n    taxPreference: customer.taxPreference === 'tax_exempt' ? 'tax_exempt' : 'taxable',\n    gstin: customer.gstin || '',\n    placeOfSupply: customer.placeOfSupply || '',\n    pan: customer.pan || '',\n    exemptionReason: customer.exemptionReason || '',\n    \n    currency: customer.currency || 'INR',\n    paymentTerms: customer.paymentTerms || 'Due on Receipt',\n    priceList: customer.priceList || '',\n    \n    snapshotDate: new Date().toISOString()\n  };\n}\n\n// Format address for display\nexport function formatAddressDisplay(address: Address | null | undefined): string {\n  if (!address) return '';\n  const parts = [\n    address.street,\n    address.city,\n    address.state,\n    address.country,\n    address.pincode\n  ].filter(Boolean);\n  return parts.join('\\n');\n}\n\n// Calculate due date from payment terms\nexport function calculateDueDateFromTerms(invoiceDate: Date, paymentTerms: string): Date {\n  const termsMapping: Record<string, number> = {\n    'Due on Receipt': 0,\n    'Net 15': 15,\n    'Net 30': 30,\n    'Net 45': 45,\n    'Net 60': 60,\n    'due_on_receipt': 0,\n    'net15': 15,\n    'net30': 30,\n    'net45': 45,\n    'net60': 60\n  };\n  \n  const days = termsMapping[paymentTerms] ?? 30; // Default to Net 30\n  const dueDate = new Date(invoiceDate);\n  dueDate.setDate(dueDate.getDate() + days);\n  return dueDate;\n}\n","path":null,"size_bytes":6381,"size_tokens":null},"client/src/pages/payments-received-create.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport {\n  ChevronDown,\n  Plus,\n  Trash2,\n  Save,\n  X,\n  Search,\n  Calendar as CalendarIcon,\n  AlertCircle\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTransactionBootstrap } from \"@/hooks/use-transaction-bootstrap\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { format } from \"date-fns\";\nimport { cn } from \"@/lib/utils\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\n\ninterface Customer {\n  id: string;\n  name: string;\n  displayName: string;\n  companyName: string;\n  email: string;\n  placeOfSupply?: string;\n  currency?: string;\n}\n\ninterface Invoice {\n  id: string;\n  invoiceNumber: string;\n  date: string;\n  amount: number;\n  balanceDue: number;\n  status: string;\n}\n\ninterface PurchasedItem {\n  id: string;\n  itemId: string;\n  name: string;\n  description: string;\n  unit: string;\n  lastRate: number;\n  totalQuantity: number;\n  lastPurchaseDate: string;\n  totalAmount: number;\n  purchaseCount: number;\n  tax: number;\n  taxName: string;\n}\n\nconst PAYMENT_MODES = [\n  \"Cash\",\n  \"Bank Transfer\",\n  \"Cheque\",\n  \"Credit Card\",\n  \"Debit Card\",\n  \"UPI\",\n  \"Net Banking\",\n  \"Other\"\n];\n\nconst DEPOSIT_ACCOUNTS = [\n  \"Petty Cash\",\n  \"Undeposited Funds\",\n  \"Bank Account - SBI\",\n  \"Bank Account - HDFC\",\n  \"Bank Account - ICICI\"\n];\n\nfunction formatCurrency(amount: number): string {\n  return new Intl.NumberFormat('en-IN', {\n    style: 'currency',\n    currency: 'INR',\n    minimumFractionDigits: 2\n  }).format(amount);\n}\n\nfunction formatDate(dateString: string): string {\n  if (!dateString) return '-';\n  const date = new Date(dateString);\n  return date.toLocaleDateString('en-IN', { day: '2-digit', month: '2-digit', year: 'numeric' });\n}\n\nexport default function PaymentsReceivedCreate() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  // Use transaction bootstrap hook\n  const {\n    customerId,\n    setCustomerId,\n    customerSnapshot,\n    taxRegime,\n    isLoadingCustomer,\n    customerError,\n    formData,\n    onCustomerChange\n  } = useTransactionBootstrap({ transactionType: 'payment' });\n\n  // Form state\n  const [customers, setCustomers] = useState<Customer[]>([]);\n  const [customerInvoices, setCustomerInvoices] = useState<Invoice[]>([]);\n  const [customerPurchasedItems, setCustomerPurchasedItems] = useState<PurchasedItem[]>([]);\n  const [selectedCustomerId, setSelectedCustomerId] = useState<string>(\"\");\n  const [paymentDate, setPaymentDate] = useState<Date>(new Date());\n  const [paymentMode, setPaymentMode] = useState<string>(\"Bank Transfer\");\n  const [depositTo, setDepositTo] = useState<string>(\"Petty Cash\");\n  const [referenceNumber, setReferenceNumber] = useState<string>(\"\");\n  const [notes, setNotes] = useState<string>(\"\");\n  const [sendThankYou, setSendThankYou] = useState<boolean>(false);\n  const [selectedInvoices, setSelectedInvoices] = useState<Record<string, { selected: boolean; payment: number; receivedDate?: Date }>>({});\n  const [totalAmountReceived, setTotalAmountReceived] = useState<number>(0);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [customersLoading, setCustomersLoading] = useState(true);\n\n  // Sync with bootstrap\n  useEffect(() => {\n    if (customerId) {\n      setSelectedCustomerId(customerId);\n    }\n  }, [customerId]);\n\n  // Fetch customers\n  useEffect(() => {\n    fetchCustomers();\n  }, []);\n\n  // Fetch invoices and purchased items when customer changes\n  useEffect(() => {\n    if (selectedCustomerId) {\n      fetchCustomerInvoices(selectedCustomerId);\n      fetchCustomerPurchasedItems(selectedCustomerId);\n    } else {\n      setCustomerInvoices([]);\n      setCustomerPurchasedItems([]);\n      setSelectedInvoices({});\n    }\n  }, [selectedCustomerId]);\n\n  // Re-apply auto-allocation when customer invoices are loaded\n  useEffect(() => {\n    if (customerInvoices.length > 0 && totalAmountReceived > 0) {\n      autoAllocatePayment(totalAmountReceived);\n    }\n  }, [customerInvoices]);\n\n  const fetchCustomers = async () => {\n    try {\n      setCustomersLoading(true);\n      const response = await fetch('/api/customers');\n      if (response.ok) {\n        const data = await response.json();\n        setCustomers(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch customers:', error);\n    } finally {\n      setCustomersLoading(false);\n    }\n  };\n\n  const fetchCustomerInvoices = async (custId: string) => {\n    try {\n      const response = await fetch(`/api/invoices?customerId=${custId}`);\n      if (response.ok) {\n        const data = await response.json();\n        console.log('Raw invoices from API:', data.data);\n\n        // Filter for unpaid invoices (PENDING, OVERDUE, PARTIALLY_PAID, or SENT)\n        // Use balanceDue if available, otherwise use amount for new invoices\n        const unpaidInvoices = (data.data || []).filter((inv: any) => {\n          const balance = inv.balanceDue !== undefined ? inv.balanceDue : inv.amount;\n          const isUnpaid = balance > 0 && ['PENDING', 'OVERDUE', 'PARTIALLY_PAID', 'SENT'].includes(inv.status);\n          console.log(`Invoice ${inv.invoiceNumber}: balanceDue=${inv.balanceDue}, amount=${inv.amount}, status=${inv.status}, isUnpaid=${isUnpaid}`);\n          return isUnpaid;\n        }).map((inv: any) => ({\n          ...inv,\n          // Ensure balanceDue is set properly\n          balanceDue: inv.balanceDue !== undefined && inv.balanceDue > 0 ? inv.balanceDue : inv.amount\n        }));\n\n        console.log('Filtered unpaid invoices:', unpaidInvoices);\n        setCustomerInvoices(unpaidInvoices);\n\n        // Initialize selection state\n        const initialSelection: Record<string, { selected: boolean; payment: number; receivedDate?: Date }> = {};\n        unpaidInvoices.forEach((inv: Invoice) => {\n          initialSelection[inv.id] = { selected: false, payment: 0, receivedDate: undefined };\n        });\n        setSelectedInvoices(initialSelection);\n      }\n    } catch (error) {\n      console.error('Failed to fetch customer invoices:', error);\n    }\n  };\n\n  const fetchCustomerPurchasedItems = async (custId: string) => {\n    try {\n      const response = await fetch(`/api/customers/${custId}/purchased-items`);\n      if (response.ok) {\n        const data = await response.json();\n        setCustomerPurchasedItems(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch customer purchased items:', error);\n    }\n  };\n\n  const handleCustomerChange = (value: string) => {\n    if (value === \"add_new\") {\n      setLocation(\"/customers/new?returnTo=payments-received-create\");\n      return;\n    }\n    setSelectedCustomerId(value);\n    onCustomerChange(value);\n  };\n\n  const toggleInvoiceSelection = (invoiceId: string) => {\n    setSelectedInvoices(prev => {\n      const invoice = customerInvoices.find(inv => inv.id === invoiceId);\n      const newSelected = !prev[invoiceId]?.selected;\n      return {\n        ...prev,\n        [invoiceId]: {\n          selected: newSelected,\n          payment: newSelected ? (invoice?.balanceDue || 0) : 0,\n          receivedDate: newSelected ? new Date() : undefined\n        }\n      };\n    });\n  };\n\n  const updateInvoicePayment = (invoiceId: string, amount: number) => {\n    const invoice = customerInvoices.find(inv => inv.id === invoiceId);\n    if (invoice) {\n      const validAmount = Math.min(Math.max(0, amount), invoice.balanceDue);\n      setSelectedInvoices(prev => ({\n        ...prev,\n        [invoiceId]: {\n          ...prev[invoiceId],\n          payment: validAmount\n        }\n      }));\n    }\n  };\n\n  const updateInvoiceReceivedDate = (invoiceId: string, date: Date) => {\n    setSelectedInvoices(prev => ({\n      ...prev,\n      [invoiceId]: {\n        ...prev[invoiceId],\n        receivedDate: date\n      }\n    }));\n  };\n\n  // Auto-allocation function\n  const autoAllocatePayment = (totalAmount: number) => {\n    if (customerInvoices.length === 0) {\n      return; // No invoices to allocate to\n    }\n\n    if (totalAmount <= 0) {\n      // Clear all selections if amount is 0 or negative\n      const cleared: Record<string, { selected: boolean; payment: number; receivedDate?: Date }> = {};\n      customerInvoices.forEach(invoice => {\n        cleared[invoice.id] = {\n          selected: false,\n          payment: 0,\n          receivedDate: undefined\n        };\n      });\n      setSelectedInvoices(cleared);\n      return;\n    }\n\n    // Sort invoices by date (oldest first) for allocation priority\n    const sortedInvoices = [...customerInvoices].sort((a, b) =>\n      new Date(a.date).getTime() - new Date(b.date).getTime()\n    );\n\n    let remainingAmount = totalAmount;\n    const newSelectedInvoices: Record<string, { selected: boolean; payment: number; receivedDate?: Date }> = {};\n\n    // Initialize all invoices first\n    customerInvoices.forEach(invoice => {\n      newSelectedInvoices[invoice.id] = {\n        selected: false,\n        payment: 0,\n        receivedDate: undefined\n      };\n    });\n\n    // Allocate amount across invoices (oldest first)\n    for (const invoice of sortedInvoices) {\n      if (remainingAmount <= 0) break;\n\n      // Use balanceDue if available, otherwise use amount\n      const invoiceBalance = invoice.balanceDue > 0 ? invoice.balanceDue : invoice.amount;\n      console.log(`Allocating to invoice ${invoice.invoiceNumber}: balance=${invoiceBalance}, remaining=${remainingAmount}`);\n\n      if (invoiceBalance > 0) {\n        const paymentAmount = Math.min(remainingAmount, invoiceBalance);\n\n        newSelectedInvoices[invoice.id] = {\n          selected: true,\n          payment: paymentAmount,\n          receivedDate: new Date() // Default to today\n        };\n\n        remainingAmount -= paymentAmount;\n        console.log(`Allocated ${paymentAmount} to ${invoice.invoiceNumber}, remaining: ${remainingAmount}`);\n      }\n    }\n\n    setSelectedInvoices(newSelectedInvoices);\n  };\n\n  // Handle amount received change\n  const handleAmountReceivedChange = (amount: number) => {\n    setTotalAmountReceived(amount);\n    autoAllocatePayment(amount);\n  };\n\n  const totalPaymentAmount = Object.values(selectedInvoices).reduce(\n    (sum, inv) => sum + (inv.selected ? inv.payment : 0),\n    0\n  );\n\n  const selectedInvoiceCount = Object.values(selectedInvoices).filter(inv => inv.selected).length;\n\n  // Calculate payment summary\n  const totalInvoicesAmount = customerInvoices.reduce((sum, invoice) => sum + (invoice.balanceDue || 0), 0);\n  const amountReceived = totalAmountReceived;\n  const amountUsedForPayments = totalPaymentAmount;\n  const amountRefunded = 0; // This would be calculated from refunds\n  const amountInExcess = Math.max(0, amountReceived - amountUsedForPayments);\n\n  const selectedCustomer = customers.find(c => c.id === selectedCustomerId);\n\n  const handleSavePayment = async () => {\n    if (!selectedCustomerId) {\n      toast({ title: \"Please select a customer\", variant: \"destructive\" });\n      return;\n    }\n\n    if (totalAmountReceived <= 0) {\n      toast({ title: \"Please enter the amount received\", variant: \"destructive\" });\n      return;\n    }\n\n    setIsSubmitting(true);\n\n    // Build invoices array from selected invoices\n    const selectedInvoicesList = Object.entries(selectedInvoices)\n      .filter(([_, inv]) => inv.selected && inv.payment > 0)\n      .map(([id, inv]) => {\n        const invoice = customerInvoices.find(i => i.id === id);\n        return {\n          invoiceId: id,\n          invoiceNumber: invoice?.invoiceNumber || '',\n          invoiceDate: invoice?.date || '',\n          invoiceAmount: invoice?.amount || 0,\n          balanceDue: invoice?.balanceDue || 0,\n          paymentAmount: inv.payment,\n          paymentReceivedDate: inv.receivedDate ? format(inv.receivedDate, \"yyyy-MM-dd\") : format(paymentDate, \"yyyy-MM-dd\")\n        };\n      });\n\n    console.log('Selected Invoices State:', selectedInvoices);\n    console.log('Customer Invoices:', customerInvoices);\n    console.log('Invoices to save:', selectedInvoicesList);\n\n    const paymentData = {\n      date: format(paymentDate, \"yyyy-MM-dd\"),\n      customerId: selectedCustomerId,\n      customerName: selectedCustomer?.displayName || selectedCustomer?.name || '',\n      customerEmail: selectedCustomer?.email || '',\n      mode: paymentMode,\n      depositTo: depositTo,\n      referenceNumber: referenceNumber,\n      amount: totalAmountReceived,\n      unusedAmount: Math.max(0, totalAmountReceived - totalPaymentAmount),\n      notes: notes,\n      sendThankYou: sendThankYou,\n      status: \"PAID\",\n      placeOfSupply: customerSnapshot?.placeOfSupply || formData.placeOfSupply || '',\n      invoices: selectedInvoicesList,\n      // Store customer snapshot for immutability\n      customerSnapshot: customerSnapshot\n    };\n\n    try {\n      const response = await fetch('/api/payments-received', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(paymentData)\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Payment Recorded\",\n          description: `Payment of ${formatCurrency(totalAmountReceived)} has been recorded.`\n        });\n        setLocation(\"/payments-received\");\n      } else {\n        throw new Error('Failed to create payment');\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to record payment. Please try again.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"max-w-5xl mx-auto space-y-6 pb-24 px-4 sm:px-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-foreground\" data-testid=\"text-page-title\">Record Payment</h1>\n          <p className=\"text-muted-foreground mt-1\">Record a new payment from customer</p>\n        </div>\n        <Button variant=\"ghost\" size=\"icon\" onClick={() => setLocation(\"/payments-received\")} data-testid=\"button-close\">\n          <X className=\"h-5 w-5\" />\n        </Button>\n      </div>\n\n      {customerError && (\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <AlertDescription>\n            {customerError}. You can manually select a customer below.\n          </AlertDescription>\n        </Alert>\n      )}\n\n      <Card className=\"border-border/60 shadow-sm\">\n        <CardContent className=\"p-6 space-y-6\">\n          {/* Customer Selection */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">Customer *</Label>\n              <Select value={selectedCustomerId} onValueChange={handleCustomerChange}>\n                <SelectTrigger className=\"w-full\" data-testid=\"select-customer\">\n                  <SelectValue placeholder={customersLoading ? \"Loading...\" : \"Select customer\"} />\n                </SelectTrigger>\n                <SelectContent>\n                  {customers.map((customer) => (\n                    <SelectItem key={customer.id} value={customer.id} data-testid={`customer-option-${customer.id}`}>\n                      {customer.displayName || customer.name}\n                    </SelectItem>\n                  ))}\n                  <Separator className=\"my-1\" />\n                  <SelectItem value=\"add_new\" className=\"text-primary\">\n                    <div className=\"flex items-center gap-2\">\n                      <Plus className=\"h-4 w-4\" />\n                      New Customer\n                    </div>\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n              {isLoadingCustomer && (\n                <p className=\"text-xs text-muted-foreground\">Loading customer details...</p>\n              )}\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">Payment Date *</Label>\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    className={cn(\n                      \"w-full justify-start text-left font-normal\",\n                      !paymentDate && \"text-muted-foreground\"\n                    )}\n                    data-testid=\"button-payment-date\"\n                  >\n                    <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                    {paymentDate ? format(paymentDate, \"dd/MM/yyyy\") : \"Select date\"}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\">\n                  <Calendar\n                    mode=\"single\"\n                    selected={paymentDate}\n                    onSelect={(date) => date && setPaymentDate(date)}\n                    initialFocus\n                  />\n                </PopoverContent>\n              </Popover>\n            </div>\n          </div>\n\n          {/* Customer Info Display */}\n          {selectedCustomer && customerSnapshot && (\n            <div className=\"bg-secondary/30 rounded-lg p-4 space-y-2\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"font-medium\">{customerSnapshot.displayName || customerSnapshot.customerName}</span>\n                {customerSnapshot.taxPreference === 'tax_exempt' && (\n                  <Badge variant=\"outline\" className=\"text-amber-600 border-amber-300\">\n                    Tax Exempt\n                  </Badge>\n                )}\n              </div>\n              <div className=\"grid grid-cols-2 gap-4 text-sm text-muted-foreground\">\n                <div>\n                  <span className=\"text-xs text-slate-500\">Currency:</span>\n                  <span className=\"ml-2\">{customerSnapshot.currency || 'INR'}</span>\n                </div>\n                {customerSnapshot.placeOfSupply && (\n                  <div>\n                    <span className=\"text-xs text-slate-500\">Place of Supply:</span>\n                    <span className=\"ml-2\">{customerSnapshot.placeOfSupply}</span>\n                  </div>\n                )}\n                {customerSnapshot.gstin && (\n                  <div>\n                    <span className=\"text-xs text-slate-500\">GSTIN:</span>\n                    <span className=\"ml-2\">{customerSnapshot.gstin}</span>\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n\n          {/* Payment Details */}\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">Payment Mode</Label>\n              <Select value={paymentMode} onValueChange={setPaymentMode}>\n                <SelectTrigger data-testid=\"select-payment-mode\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {PAYMENT_MODES.map(mode => (\n                    <SelectItem key={mode} value={mode}>{mode}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">Deposit To</Label>\n              <Select value={depositTo} onValueChange={setDepositTo}>\n                <SelectTrigger data-testid=\"select-deposit-to\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {DEPOSIT_ACCOUNTS.map(account => (\n                    <SelectItem key={account} value={account}>{account}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">Reference Number</Label>\n              <Input\n                value={referenceNumber}\n                onChange={(e) => setReferenceNumber(e.target.value)}\n                placeholder=\"Enter reference number\"\n                data-testid=\"input-reference\"\n              />\n            </div>\n          </div>\n\n          {/* Amount Received Input */}\n          <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium text-blue-700 dark:text-blue-300\">\n                Amount Received *\n              </Label>\n              <Input\n                type=\"number\"\n                value={totalAmountReceived || ''}\n                onChange={(e) => handleAmountReceivedChange(parseFloat(e.target.value) || 0)}\n                placeholder=\"Enter total amount received\"\n                className=\"text-lg font-medium\"\n                data-testid=\"input-amount-received\"\n              />\n              <p className=\"text-xs text-blue-600 dark:text-blue-400\">\n                This amount will be automatically allocated to unpaid invoices starting with the oldest.\n              </p>\n            </div>\n          </div>\n\n          <Separator />\n\n          {/* Outstanding Invoices */}\n          <div className=\"space-y-4\">\n            <h3 className=\"font-medium\">Outstanding Invoices</h3>\n\n            {selectedCustomerId ? (\n              customerInvoices.length > 0 ? (\n                <div className=\"border rounded-lg overflow-hidden\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow className=\"bg-muted/50\">\n                        <TableHead className=\"w-12\"></TableHead>\n                        <TableHead>Invoice #</TableHead>\n                        <TableHead>Date</TableHead>\n                        <TableHead className=\"text-right\">Invoice Amount</TableHead>\n                        <TableHead className=\"text-right\">Balance Due</TableHead>\n                        <TableHead className=\"text-center\">Payment Received On</TableHead>\n                        <TableHead className=\"text-right\">Payment</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {customerInvoices.map((invoice) => (\n                        <TableRow key={invoice.id}>\n                          <TableCell>\n                            <Checkbox\n                              checked={selectedInvoices[invoice.id]?.selected || false}\n                              onCheckedChange={() => toggleInvoiceSelection(invoice.id)}\n                              data-testid={`checkbox-invoice-${invoice.id}`}\n                            />\n                          </TableCell>\n                          <TableCell className=\"font-medium\">{invoice.invoiceNumber}</TableCell>\n                          <TableCell>{formatDate(invoice.date)}</TableCell>\n                          <TableCell className=\"text-right\">{formatCurrency(invoice.amount || 0)}</TableCell>\n                          <TableCell className=\"text-right\">{formatCurrency(invoice.balanceDue || 0)}</TableCell>\n                          <TableCell className=\"text-center\">\n                            <Popover>\n                              <PopoverTrigger asChild>\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  disabled={!selectedInvoices[invoice.id]?.selected}\n                                  className={cn(\n                                    \"w-32 justify-start text-left font-normal\",\n                                    !selectedInvoices[invoice.id]?.selected && \"text-muted-foreground\"\n                                  )}\n                                >\n                                  <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                                  {selectedInvoices[invoice.id]?.selected\n                                    ? format(selectedInvoices[invoice.id]?.receivedDate || new Date(), \"dd/MM/yyyy\")\n                                    : \"-\"\n                                  }\n                                </Button>\n                              </PopoverTrigger>\n                              <PopoverContent className=\"w-auto p-0\">\n                                <Calendar\n                                  mode=\"single\"\n                                  selected={selectedInvoices[invoice.id]?.receivedDate || new Date()}\n                                  onSelect={(date) => date && updateInvoiceReceivedDate(invoice.id, date)}\n                                  initialFocus\n                                />\n                              </PopoverContent>\n                            </Popover>\n                          </TableCell>\n                          <TableCell className=\"text-right\">\n                            <Input\n                              type=\"number\"\n                              value={selectedInvoices[invoice.id]?.payment || 0}\n                              onChange={(e) => updateInvoicePayment(invoice.id, parseFloat(e.target.value) || 0)}\n                              disabled={!selectedInvoices[invoice.id]?.selected}\n                              className=\"w-28 text-right ml-auto\"\n                              data-testid={`input-payment-${invoice.id}`}\n                            />\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                </div>\n              ) : (\n                <div className=\"text-center py-8 text-muted-foreground border rounded-lg\">\n                  No outstanding invoices for this customer\n                </div>\n              )\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground border rounded-lg\">\n                Select a customer to view outstanding invoices\n              </div>\n            )}\n\n            {/* Total */}\n            {selectedInvoiceCount > 0 && (\n              <div className=\"flex justify-end\">\n                <div className=\"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg px-6 py-3\">\n                  <div className=\"flex items-center gap-4\">\n                    <span className=\"text-sm text-green-700 dark:text-green-300\">\n                      {selectedInvoiceCount} invoice(s) selected\n                    </span>\n                    <div className=\"text-right\">\n                      <p className=\"text-xs text-green-600 dark:text-green-400\">Total Payment</p>\n                      <p className=\"text-xl font-bold text-green-700 dark:text-green-300\">\n                        {formatCurrency(totalPaymentAmount)}\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n\n          <Separator />\n\n          {/* Customer Purchased Items */}\n          <div className=\"space-y-4\">\n            <h3 className=\"font-medium\">Items Purchased by Customer</h3>\n\n            {selectedCustomerId ? (\n              customerPurchasedItems.length > 0 ? (\n                <div className=\"border rounded-lg overflow-hidden\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow className=\"bg-muted/50\">\n                        <TableHead>Item Name</TableHead>\n                        <TableHead>Description</TableHead>\n                        <TableHead>Unit</TableHead>\n                        <TableHead className=\"text-right\">Last Rate</TableHead>\n                        <TableHead className=\"text-center\">Total Qty</TableHead>\n                        <TableHead className=\"text-center\">Purchase Count</TableHead>\n                        <TableHead>Last Purchase Date</TableHead>\n                        <TableHead className=\"text-right\">Total Amount</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {customerPurchasedItems.map((item) => (\n                        <TableRow key={item.id}>\n                          <TableCell className=\"font-medium\">{item.name}</TableCell>\n                          <TableCell className=\"text-muted-foreground max-w-[200px] truncate\" title={item.description}>\n                            {item.description || '-'}\n                          </TableCell>\n                          <TableCell>{item.unit}</TableCell>\n                          <TableCell className=\"text-right\">{formatCurrency(item.lastRate)}</TableCell>\n                          <TableCell className=\"text-center\">{item.totalQuantity}</TableCell>\n                          <TableCell className=\"text-center\">\n                            <Badge variant=\"secondary\">{item.purchaseCount}</Badge>\n                          </TableCell>\n                          <TableCell>{formatDate(item.lastPurchaseDate)}</TableCell>\n                          <TableCell className=\"text-right\">{formatCurrency(item.totalAmount)}</TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                </div>\n              ) : (\n                <div className=\"text-center py-8 text-muted-foreground border rounded-lg\">\n                  No items purchased by this customer yet\n                </div>\n              )\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground border rounded-lg\">\n                Select a customer to view purchased items\n              </div>\n            )}\n          </div>\n\n          <Separator />\n\n          {/* Payment Summary */}\n          {selectedCustomerId && (\n            <div className=\"space-y-4\">\n              <h3 className=\"font-medium\">Payment Summary</h3>\n              <div className=\"bg-slate-50 dark:bg-slate-900/50 rounded-lg p-4 space-y-3\">\n                <div className=\"grid grid-cols-1 gap-2 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Total Outstanding:</span>\n                    <span className=\"font-medium\">{formatCurrency(totalInvoicesAmount)}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Amount Received:</span>\n                    <span className=\"font-medium text-green-600\">{formatCurrency(amountReceived)}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Amount used for Payments:</span>\n                    <span className=\"font-medium\">{formatCurrency(amountUsedForPayments)}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Amount Refunded:</span>\n                    <span className=\"font-medium\">{formatCurrency(amountRefunded)}</span>\n                  </div>\n                  <div className=\"flex justify-between pt-2 border-t\">\n                    <span className=\"text-muted-foreground\">Amount in Excess:</span>\n                    <span className=\"font-bold text-orange-600\">{formatCurrency(amountInExcess)}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <Separator />\n\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium\">Notes</Label>\n            <Textarea\n              value={notes}\n              onChange={(e) => setNotes(e.target.value)}\n              placeholder=\"Add any notes for this payment...\"\n              className=\"min-h-[80px]\"\n              data-testid=\"textarea-notes\"\n            />\n          </div>\n\n\n          <div className=\"flex items-center gap-3\">\n            <Switch\n              id=\"send-thank-you\"\n              checked={sendThankYou}\n              onCheckedChange={setSendThankYou}\n              data-testid=\"switch-thank-you\"\n            />\n            <Label htmlFor=\"send-thank-you\" className=\"text-sm\">\n              Send thank you email to customer\n            </Label>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Footer Actions */}\n      <div className=\"fixed bottom-0 left-0 right-0 bg-background border-t px-6 py-4\">\n        <div className=\"max-w-5xl mx-auto flex items-center justify-between\">\n          <Button variant=\"outline\" onClick={() => setLocation(\"/payments-received\")} data-testid=\"button-cancel\">\n            Cancel\n          </Button>\n          <div className=\"flex items-center gap-3\">\n            <Button\n              onClick={handleSavePayment}\n              disabled={isSubmitting || !selectedCustomerId || totalAmountReceived <= 0}\n              data-testid=\"button-save\"\n            >\n              <Save className=\"h-4 w-4 mr-2\" />\n              {isSubmitting ? \"Saving...\" : \"Record Payment\"}\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":33692,"size_tokens":null},"client/src/pages/vendor-credit-edit.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation, useParams } from \"wouter\";\nimport { ArrowLeft, RefreshCw, Upload, Plus, Trash2, Search, FileText, Info, Save } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { AccountSelectDropdown } from \"@/components/AccountSelectDropdown\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nconst TDS_TCS_OPTIONS = [\n  { value: \"commission_brokerage_2\", label: \"Commission or Brokerage [2%]\" },\n  { value: \"professional_fees_10\", label: \"Professional Fees [10%]\" },\n  { value: \"rent_10\", label: \"Rent [10%]\" },\n  { value: \"contractor_1\", label: \"Payment to Contractor [1%]\" },\n  { value: \"contractor_2\", label: \"Payment to Contractor [2%]\" },\n];\n\n// Account dropdown is now handled by AccountSelectDropdown component\n\nconst TAX_OPTIONS = [\n  { value: \"gst_5\", label: \"GST [5%]\" },\n  { value: \"gst_12\", label: \"GST [12%]\" },\n  { value: \"gst_18\", label: \"GST [18%]\" },\n  { value: \"gst_28\", label: \"GST [28%]\" },\n  { value: \"igst_5\", label: \"IGST [5%]\" },\n  { value: \"igst_12\", label: \"IGST [12%]\" },\n  { value: \"igst_18\", label: \"IGST [18%]\" },\n  { value: \"igst_28\", label: \"IGST [28%]\" },\n  { value: \"exempt\", label: \"Exempt\" },\n  { value: \"nil\", label: \"Nil Rated\" },\n];\n\ninterface Vendor {\n  id: string;\n  displayName: string;\n  companyName?: string;\n}\n\ninterface Product {\n  id: string;\n  name: string;\n  rate?: number;\n  costPrice?: number;\n  sellingPrice?: number;\n  description?: string;\n  type?: string;\n}\n\ninterface LineItem {\n  id: string;\n  itemId: string;\n  itemName: string;\n  description: string;\n  account: string;\n  quantity: number;\n  rate: number;\n  tax: string;\n  taxAmount?: number;\n  amount: number;\n  hsnSac?: string;\n}\n\nexport default function VendorCreditEdit() {\n  const [, setLocation] = useLocation();\n  const params = useParams();\n  const creditId = params.id;\n  const { toast } = useToast();\n  const [saving, setSaving] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [vendors, setVendors] = useState<Vendor[]>([]);\n  const [products, setProducts] = useState<Product[]>([]);\n  const [vendorsLoading, setVendorsLoading] = useState(true);\n  const [productsLoading, setProductsLoading] = useState(true);\n\n  const [formData, setFormData] = useState({\n    vendorId: \"\",\n    vendorName: \"\",\n    creditNoteNumber: \"\",\n    referenceNumber: \"\",\n    orderNumber: \"\",\n    vendorCreditDate: new Date().toISOString().split('T')[0],\n    subject: \"\",\n    reverseCharge: false,\n    taxType: \"tds\" as \"tds\" | \"tcs\",\n    tdsTcs: \"\",\n    discountType: \"percentage\" as \"percentage\" | \"amount\",\n    discountValue: \"\",\n    adjustment: \"\",\n    notes: \"\",\n  });\n\n  const [items, setItems] = useState<LineItem[]>([]);\n\n  useEffect(() => {\n    fetchVendors();\n    fetchProducts();\n    if (creditId) {\n      fetchVendorCredit();\n    }\n  }, [creditId]);\n\n  const fetchVendors = async () => {\n    try {\n      setVendorsLoading(true);\n      const response = await fetch('/api/vendors');\n      if (response.ok) {\n        const data = await response.json();\n        setVendors(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch vendors:', error);\n    } finally {\n      setVendorsLoading(false);\n    }\n  };\n\n  const fetchProducts = async () => {\n    try {\n      setProductsLoading(true);\n      const response = await fetch('/api/items');\n      if (response.ok) {\n        const data = await response.json();\n        setProducts(data.data || []);\n      }\n    } catch (error) {\n      console.error('Failed to fetch products:', error);\n    } finally {\n      setProductsLoading(false);\n    }\n  };\n\n  const fetchVendorCredit = async () => {\n    try {\n      setLoading(true);\n      const response = await fetch(`/api/vendor-credits/${creditId}`);\n      if (response.ok) {\n        const data = await response.json();\n        const credit = data.data;\n        if (credit) {\n          setFormData({\n            vendorId: credit.vendorId || \"\",\n            vendorName: credit.vendorName || \"\",\n            creditNoteNumber: credit.creditNumber || \"\",\n            referenceNumber: credit.referenceNumber || \"\",\n            orderNumber: credit.orderNumber || \"\",\n            vendorCreditDate: credit.date || new Date().toISOString().split('T')[0],\n            subject: credit.subject || \"\",\n            reverseCharge: credit.reverseCharge || false,\n            taxType: credit.taxType || \"tds\",\n            tdsTcs: credit.tdsTcs || \"\",\n            discountType: credit.discountType || \"percentage\",\n            discountValue: credit.discountValue?.toString() || \"\",\n            adjustment: credit.adjustment?.toString() || \"\",\n            notes: credit.notes || \"\",\n          });\n\n          if (credit.items && credit.items.length > 0) {\n            setItems(credit.items.map((item: any) => ({\n              id: item.id || `item-${Date.now()}-${Math.random()}`,\n              itemId: item.itemId || \"\",\n              itemName: item.itemName || \"\",\n              description: item.description || \"\",\n              account: item.account || \"cost_of_goods_sold\",\n              quantity: item.quantity || 1,\n              rate: parseFloat(item.rate) || 0,\n              tax: item.tax || \"\",\n              taxAmount: item.taxAmount || 0,\n              amount: item.amount || 0,\n              hsnSac: item.hsnSac || \"\",\n            })));\n          }\n        }\n      } else {\n        toast({ title: \"Failed to load vendor credit\", variant: \"destructive\" });\n        setLocation('/vendor-credits');\n      }\n    } catch (error) {\n      console.error('Failed to fetch vendor credit:', error);\n      toast({ title: \"Failed to load vendor credit\", variant: \"destructive\" });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleVendorChange = (vendorId: string) => {\n    const vendor = vendors.find(v => v.id === vendorId);\n    if (vendor) {\n      setFormData(prev => ({\n        ...prev,\n        vendorId: vendor.id,\n        vendorName: vendor.displayName,\n      }));\n    }\n  };\n\n  const addItem = () => {\n    setItems(prev => [...prev, {\n      id: `item-${Date.now()}`,\n      itemId: \"\",\n      itemName: \"\",\n      description: \"\",\n      account: \"cost_of_goods_sold\",\n      quantity: 1,\n      rate: 0,\n      tax: \"\",\n      taxAmount: 0,\n      amount: 0,\n      hsnSac: \"\",\n    }]);\n  };\n\n  const removeItem = (itemId: string) => {\n    setItems(prev => prev.filter(item => item.id !== itemId));\n  };\n\n  const updateItem = (itemId: string, field: string, value: any) => {\n    setItems(prev => prev.map(item => {\n      if (item.id === itemId) {\n        const updated = { ...item, [field]: value };\n        if (field === 'itemId') {\n          const product = products.find(p => p.id === value);\n          if (product) {\n            updated.itemName = product.name;\n            updated.description = product.description || '';\n            updated.rate = product.costPrice || product.sellingPrice || product.rate || 0;\n            updated.amount = updated.quantity * updated.rate;\n          }\n        }\n        if (field === 'quantity' || field === 'rate') {\n          updated.amount = updated.quantity * updated.rate;\n          // Recalculate tax amount when quantity or rate changes\n          if (updated.tax) {\n            const taxMatch = updated.tax.match(/(\\d+)/);\n            if (taxMatch) {\n              const taxPercent = parseFloat(taxMatch[1]);\n              updated.taxAmount = (updated.amount * taxPercent) / 100;\n            }\n          }\n        }\n        if (field === 'tax') {\n          const taxMatch = value.match(/(\\d+)/);\n          if (taxMatch) {\n            const taxPercent = parseFloat(taxMatch[1]);\n            updated.taxAmount = (updated.amount * taxPercent) / 100;\n          } else {\n            updated.taxAmount = 0;\n          }\n        }\n        return updated;\n      }\n      return item;\n    }));\n  };\n\n  const calculateSubTotal = () => {\n    return items.reduce((sum, item) => sum + item.amount, 0);\n  };\n\n  const calculateTaxAmount = () => {\n    return items.reduce((sum, item) => sum + (item.taxAmount || 0), 0);\n  };\n\n  const calculateDiscount = () => {\n    const subTotal = calculateSubTotal();\n    if (formData.discountType === 'percentage') {\n      return subTotal * (parseFloat(formData.discountValue) || 0) / 100;\n    }\n    return parseFloat(formData.discountValue) || 0;\n  };\n\n  const calculateTdsTcs = () => {\n    if (!formData.tdsTcs) return 0;\n    const subTotal = calculateSubTotal() - calculateDiscount();\n    const percentMatch = formData.tdsTcs.match(/(\\d+)/);\n    if (percentMatch) {\n      const percent = parseFloat(percentMatch[1]);\n      return subTotal * percent / 100;\n    }\n    return 0;\n  };\n\n  const calculateTotal = () => {\n    const subTotal = calculateSubTotal();\n    const taxAmount = calculateTaxAmount();\n    const discount = calculateDiscount();\n    const tdsTcs = calculateTdsTcs();\n    const adjustment = parseFloat(formData.adjustment) || 0;\n\n    if (formData.taxType === 'tds') {\n      return subTotal + taxAmount - discount - tdsTcs + adjustment;\n    }\n    return subTotal + taxAmount - discount + tdsTcs + adjustment;\n  };\n\n  const handleSubmit = async () => {\n    if (!formData.vendorId) {\n      toast({ title: \"Please select a vendor\", variant: \"destructive\" });\n      return;\n    }\n\n    setSaving(true);\n    try {\n      const payload = {\n        ...formData,\n        creditNumber: formData.creditNoteNumber,\n        date: formData.vendorCreditDate,\n        items,\n        subTotal: calculateSubTotal(),\n        taxAmount: calculateTaxAmount(),\n        discountAmount: calculateDiscount(),\n        tdsTcsAmount: calculateTdsTcs(),\n        adjustment: parseFloat(formData.adjustment) || 0,\n        total: calculateTotal(),\n        amount: calculateTotal(),\n        balance: calculateTotal(),\n      };\n\n      const response = await fetch(`/api/vendor-credits/${creditId}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      });\n\n      if (response.ok) {\n        toast({ title: \"Vendor credit updated successfully\" });\n        setLocation('/vendor-credits');\n      } else {\n        const error = await response.json();\n        toast({ title: error.message || \"Failed to update vendor credit\", variant: \"destructive\" });\n      }\n    } catch (error) {\n      toast({ title: \"Failed to update vendor credit\", variant: \"destructive\" });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-slate-50 flex items-center justify-center\">\n        <div className=\"flex items-center gap-3\">\n          <RefreshCw className=\"h-5 w-5 animate-spin text-blue-600\" />\n          <span className=\"text-slate-600\">Loading vendor credit...</span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-slate-50\">\n      <div className=\"border-b border-slate-200 bg-white px-6 py-4 sticky top-0 z-10\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setLocation(\"/vendor-credits\")}\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <h1 className=\"text-xl font-semibold\">Edit Vendor Credit</h1>\n            <Badge variant=\"outline\">{formData.creditNoteNumber}</Badge>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"outline\" onClick={() => setLocation(\"/vendor-credits\")}>\n              Cancel\n            </Button>\n            <Button\n              onClick={handleSubmit}\n              disabled={saving}\n              className=\"bg-blue-600 hover:bg-blue-700\"\n              data-testid=\"button-save\"\n            >\n              {saving ? (\n                <>\n                  <RefreshCw className=\"h-4 w-4 mr-2 animate-spin\" />\n                  Saving...\n                </>\n              ) : (\n                <>\n                  <Save className=\"h-4 w-4 mr-2\" />\n                  Save Changes\n                </>\n              )}\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"max-w-5xl mx-auto p-6 space-y-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 items-start\">\n          <div className=\"md:col-span-2\">\n            <Label className=\"text-red-500\">Vendor Name*</Label>\n            <div className=\"flex gap-2\">\n              <Select\n                value={formData.vendorId}\n                onValueChange={handleVendorChange}\n              >\n                <SelectTrigger className=\"flex-1\" data-testid=\"select-vendor\">\n                  <SelectValue placeholder=\"Select a Vendor\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {vendorsLoading ? (\n                    <SelectItem value=\"_loading\" disabled>Loading...</SelectItem>\n                  ) : vendors.length === 0 ? (\n                    <SelectItem value=\"_empty\" disabled>No vendors found</SelectItem>\n                  ) : (\n                    vendors.map((vendor) => (\n                      <SelectItem key={vendor.id} value={vendor.id}>\n                        {vendor.displayName}\n                      </SelectItem>\n                    ))\n                  )}\n                </SelectContent>\n              </Select>\n              <Button variant=\"outline\" size=\"icon\">\n                <Search className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          <div>\n            <Label className=\"text-red-500\">Credit Note#*</Label>\n            <Input\n              value={formData.creditNoteNumber}\n              onChange={(e) => setFormData(prev => ({ ...prev, creditNoteNumber: e.target.value }))}\n              data-testid=\"input-credit-note-number\"\n            />\n          </div>\n\n          <div>\n            <Label>Reference Number</Label>\n            <Input\n              value={formData.referenceNumber}\n              onChange={(e) => setFormData(prev => ({ ...prev, referenceNumber: e.target.value }))}\n              data-testid=\"input-reference-number\"\n            />\n          </div>\n\n          <div>\n            <Label>Order Number</Label>\n            <Input\n              value={formData.orderNumber}\n              onChange={(e) => setFormData(prev => ({ ...prev, orderNumber: e.target.value }))}\n              data-testid=\"input-order-number\"\n            />\n          </div>\n\n          <div>\n            <Label>Vendor Credit Date</Label>\n            <Input\n              type=\"date\"\n              value={formData.vendorCreditDate}\n              onChange={(e) => setFormData(prev => ({ ...prev, vendorCreditDate: e.target.value }))}\n              data-testid=\"input-vendor-credit-date\"\n            />\n          </div>\n        </div>\n\n        <div>\n          <Label>Subject</Label>\n          <Input\n            placeholder=\"Enter a subject within 250 characters\"\n            maxLength={250}\n            value={formData.subject}\n            onChange={(e) => setFormData(prev => ({ ...prev, subject: e.target.value }))}\n            data-testid=\"input-subject\"\n          />\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <Checkbox\n            checked={formData.reverseCharge}\n            onCheckedChange={(checked) => setFormData(prev => ({ ...prev, reverseCharge: !!checked }))}\n            data-testid=\"checkbox-reverse-charge\"\n          />\n          <span className=\"text-sm text-slate-600\">This transaction is applicable for reverse charge</span>\n        </div>\n\n        <div className=\"border-t pt-4\">\n          <div className=\"flex items-center gap-2 mb-4\">\n            <RefreshCw className=\"h-4 w-4 text-slate-400\" />\n            <span className=\"text-sm text-slate-600\">At Transaction Level</span>\n          </div>\n\n          <div className=\"border rounded-lg overflow-hidden\">\n            <div className=\"flex items-center justify-between px-4 py-3 bg-slate-50 border-b\">\n              <h3 className=\"font-medium\">Item Table</h3>\n              <Button variant=\"link\" size=\"sm\" className=\"text-blue-600\">\n                Bulk Actions\n              </Button>\n            </div>\n\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full text-sm\">\n                <thead className=\"bg-slate-50 border-b\">\n                  <tr>\n                    <th className=\"px-4 py-3 text-left font-medium text-slate-600 uppercase text-xs w-8\"></th>\n                    <th className=\"px-4 py-3 text-left font-medium text-slate-600 uppercase text-xs\">Item Details</th>\n                    <th className=\"px-4 py-3 text-left font-medium text-slate-600 uppercase text-xs\">Account</th>\n                    <th className=\"px-4 py-3 text-center font-medium text-slate-600 uppercase text-xs\">Quantity</th>\n                    <th className=\"px-4 py-3 text-right font-medium text-slate-600 uppercase text-xs\">Rate</th>\n                    <th className=\"px-4 py-3 text-left font-medium text-slate-600 uppercase text-xs\">Tax</th>\n                    <th className=\"px-4 py-3 text-right font-medium text-slate-600 uppercase text-xs\">Amount</th>\n                    <th className=\"px-4 py-3 w-10\"></th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {items.length === 0 ? (\n                    <tr>\n                      <td colSpan={8} className=\"px-4 py-8 text-center text-slate-500\">\n                        <p>No items added yet. Click \"Add New Row\" to add items.</p>\n                      </td>\n                    </tr>\n                  ) : (\n                    items.map((item, index) => (\n                      <tr key={item.id} className=\"border-b last:border-b-0\">\n                        <td className=\"px-4 py-3 text-center\">\n                          <span className=\"text-slate-400\">:</span>\n                        </td>\n                        <td className=\"px-4 py-3\">\n                          <Select\n                            value={item.itemId}\n                            onValueChange={(v) => updateItem(item.id, 'itemId', v)}\n                          >\n                            <SelectTrigger data-testid={`select-item-${index}`}>\n                              <SelectValue placeholder=\"Select an item\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {productsLoading ? (\n                                <SelectItem value=\"_loading\" disabled>Loading...</SelectItem>\n                              ) : products.length === 0 ? (\n                                <SelectItem value=\"_empty\" disabled>No items found</SelectItem>\n                              ) : (\n                                products.map((product) => (\n                                  <SelectItem key={product.id} value={product.id}>\n                                    {product.name}\n                                  </SelectItem>\n                                ))\n                              )}\n                            </SelectContent>\n                          </Select>\n                        </td>\n                        <td className=\"px-4 py-3\">\n                          <AccountSelectDropdown\n                            value={item.account}\n                            onValueChange={(v) => updateItem(item.id, 'account', v)}\n                            placeholder=\"Select an account\"\n                            testId={`select-account-${index}`}\n                          />\n                        </td>\n                        <td className=\"px-4 py-3\">\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            className=\"w-20 text-center\"\n                            value={item.quantity}\n                            onChange={(e) => updateItem(item.id, 'quantity', parseFloat(e.target.value) || 0)}\n                            data-testid={`input-quantity-${index}`}\n                          />\n                        </td>\n                        <td className=\"px-4 py-3\">\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            className=\"w-24 text-right\"\n                            value={item.rate}\n                            onChange={(e) => updateItem(item.id, 'rate', parseFloat(e.target.value) || 0)}\n                            data-testid={`input-rate-${index}`}\n                          />\n                        </td>\n                        <td className=\"px-4 py-3\">\n                          <Select\n                            value={item.tax}\n                            onValueChange={(v) => updateItem(item.id, 'tax', v)}\n                          >\n                            <SelectTrigger data-testid={`select-tax-${index}`}>\n                              <SelectValue placeholder=\"Select tax\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"none\">No Tax</SelectItem>\n                              {TAX_OPTIONS.map((option) => (\n                                <SelectItem key={option.value} value={option.value}>\n                                  {option.label}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </td>\n                        <td className=\"px-4 py-3 text-right font-medium\">\n                          {item.amount.toLocaleString('en-IN', { minimumFractionDigits: 2 })}\n                        </td>\n                        <td className=\"px-4 py-3\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => removeItem(item.id)}\n                            data-testid={`button-remove-item-${index}`}\n                          >\n                            <Trash2 className=\"h-4 w-4 text-red-500\" />\n                          </Button>\n                        </td>\n                      </tr>\n                    ))\n                  )}\n                </tbody>\n              </table>\n            </div>\n\n            <div className=\"px-4 py-3 border-t\">\n              <Button\n                variant=\"link\"\n                className=\"text-blue-600 p-0\"\n                onClick={addItem}\n                data-testid=\"button-add-item\"\n              >\n                <Plus className=\"h-4 w-4 mr-1\" />\n                Add New Row\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div>\n            <Label>Notes</Label>\n            <Textarea\n              placeholder=\"Notes for internal use\"\n              value={formData.notes}\n              onChange={(e) => setFormData(prev => ({ ...prev, notes: e.target.value }))}\n              className=\"min-h-[100px]\"\n              data-testid=\"input-notes\"\n            />\n          </div>\n\n          <div className=\"space-y-3 bg-slate-50 p-4 rounded-lg\">\n            <div className=\"flex justify-between text-sm\">\n              <span>Sub Total</span>\n              <span className=\"font-medium\">{calculateSubTotal().toLocaleString('en-IN', { minimumFractionDigits: 2 })}</span>\n            </div>\n\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm\">Discount</span>\n              <Select\n                value={formData.discountType}\n                onValueChange={(v) => setFormData(prev => ({ ...prev, discountType: v as \"percentage\" | \"amount\" }))}\n              >\n                <SelectTrigger className=\"w-24\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"percentage\">%</SelectItem>\n                  <SelectItem value=\"amount\">Amount</SelectItem>\n                </SelectContent>\n              </Select>\n              <Input\n                type=\"number\"\n                className=\"w-20 text-right\"\n                value={formData.discountValue}\n                onChange={(e) => setFormData(prev => ({ ...prev, discountValue: e.target.value }))}\n                data-testid=\"input-discount\"\n              />\n              <span className=\"text-sm font-medium\">-{calculateDiscount().toLocaleString('en-IN', { minimumFractionDigits: 2 })}</span>\n            </div>\n\n            {calculateTaxAmount() > 0 && (\n              <div className=\"flex justify-between text-sm\">\n                <span>Tax</span>\n                <span className=\"font-medium\">{calculateTaxAmount().toLocaleString('en-IN', { minimumFractionDigits: 2 })}</span>\n              </div>\n            )}\n\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm\">TDS/TCS</span>\n              <Select\n                value={formData.taxType}\n                onValueChange={(v) => setFormData(prev => ({ ...prev, taxType: v as \"tds\" | \"tcs\" }))}\n              >\n                <SelectTrigger className=\"w-20\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"tds\">TDS</SelectItem>\n                  <SelectItem value=\"tcs\">TCS</SelectItem>\n                </SelectContent>\n              </Select>\n              <Select\n                value={formData.tdsTcs}\n                onValueChange={(v) => setFormData(prev => ({ ...prev, tdsTcs: v }))}\n              >\n                <SelectTrigger className=\"flex-1\">\n                  <SelectValue placeholder=\"Select TDS/TCS\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"none\">None</SelectItem>\n                  {TDS_TCS_OPTIONS.map((option) => (\n                    <SelectItem key={option.value} value={option.value}>\n                      {option.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm\">Adjustment</span>\n              <Input\n                type=\"number\"\n                className=\"w-24 text-right\"\n                value={formData.adjustment}\n                onChange={(e) => setFormData(prev => ({ ...prev, adjustment: e.target.value }))}\n                data-testid=\"input-adjustment\"\n              />\n            </div>\n\n            <div className=\"flex justify-between pt-3 border-t font-semibold\">\n              <span>Total (INR)</span>\n              <span className=\"text-lg\">{calculateTotal().toLocaleString('en-IN', { minimumFractionDigits: 2 })}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":27441,"size_tokens":null},"client/src/components/AccountSelectDropdown.tsx":{"content":"import { useState } from \"react\";\r\nimport { Check, ChevronDown, Search } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n    Popover,\r\n    PopoverContent,\r\n    PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport {\r\n    Command,\r\n    CommandEmpty,\r\n    CommandGroup,\r\n    CommandInput,\r\n    CommandItem,\r\n    CommandList,\r\n} from \"@/components/ui/command\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\n// Hierarchical account structure\r\nexport const ACCOUNT_HIERARCHY = [\r\n    {\r\n        category: \"Other Current Asset\",\r\n        accounts: [\r\n            { label: \"Advance Tax\", value: \"advance_tax\" },\r\n            { label: \"Employee Advance\", value: \"employee_advance\" },\r\n            {\r\n                label: \"Input Tax Credits\", value: \"input_tax_credits\", children: [\r\n                    { label: \"Input CGST\", value: \"input_cgst\" },\r\n                    { label: \"Input IGST\", value: \"input_igst\" },\r\n                    { label: \"Input SGST\", value: \"input_sgst\" },\r\n                ]\r\n            },\r\n            { label: \"Prepaid Expenses\", value: \"prepaid_expenses\" },\r\n            { label: \"Reverse Charge Tax Input but not due\", value: \"reverse_charge_input\" },\r\n            { label: \"TDS Receivable\", value: \"tds_receivable\" },\r\n        ]\r\n    },\r\n    {\r\n        category: \"Fixed Asset\",\r\n        accounts: [\r\n            { label: \"Furniture and Equipment\", value: \"furniture_equipment\" },\r\n        ]\r\n    },\r\n    {\r\n        category: \"Other Current Liability\",\r\n        accounts: [\r\n            { label: \"Employee Reimbursements\", value: \"employee_reimbursements\" },\r\n            {\r\n                label: \"GST Payable\", value: \"gst_payable\", children: [\r\n                    { label: \"Output CGST\", value: \"output_cgst\" },\r\n                    { label: \"Output IGST\", value: \"output_igst\" },\r\n                    { label: \"Output SGST\", value: \"output_sgst\" },\r\n                ]\r\n            },\r\n            { label: \"Opening Balance Adjustments\", value: \"opening_balance_adjustments\" },\r\n            { label: \"Tax Payable\", value: \"tax_payable\" },\r\n            { label: \"TDS Payable\", value: \"tds_payable\" },\r\n            { label: \"Unearned Revenue\", value: \"unearned_revenue\" },\r\n        ]\r\n    },\r\n    {\r\n        category: \"Income\",\r\n        accounts: [\r\n            { label: \"Discount\", value: \"discount\" },\r\n            { label: \"General Income\", value: \"general_income\" },\r\n            { label: \"Interest Income\", value: \"interest_income\" },\r\n            { label: \"Late Fee Income\", value: \"late_fee_income\" },\r\n            { label: \"Other Charges\", value: \"other_charges\" },\r\n            { label: \"Sales\", value: \"sales\" },\r\n            { label: \"Shipping Charge\", value: \"shipping_charge\" },\r\n        ]\r\n    },\r\n    {\r\n        category: \"Cost of Goods Sold\",\r\n        accounts: [\r\n            { label: \"Cost of Goods Sold\", value: \"cost_of_goods\" },\r\n            { label: \"Job Costing\", value: \"job_costing\" },\r\n            { label: \"Materials\", value: \"materials\" },\r\n            { label: \"Subcontractor\", value: \"subcontractor\" },\r\n        ]\r\n    },\r\n    {\r\n        category: \"Expense\",\r\n        accounts: [\r\n            { label: \"Advertising And Marketing\", value: \"advertising_marketing\" },\r\n            { label: \"Automobile Expense\", value: \"automobile_expense\" },\r\n            { label: \"Bank Fees and Charges\", value: \"bank_fees\" },\r\n            { label: \"Consultant Expense\", value: \"consultant_expense\" },\r\n            { label: \"Office Supplies\", value: \"office_supplies\" },\r\n            { label: \"Rent Expense\", value: \"rent_expense\" },\r\n            { label: \"Travel Expense\", value: \"travel_expense\" },\r\n        ]\r\n    }\r\n];\r\n\r\n// Flatten accounts for search\r\ninterface FlatAccount {\r\n    label: string;\r\n    value: string;\r\n    category: string;\r\n    indent: number;\r\n}\r\n\r\nconst flattenAccounts = (): FlatAccount[] => {\r\n    const flat: FlatAccount[] = [];\r\n    ACCOUNT_HIERARCHY.forEach(cat => {\r\n        cat.accounts.forEach(acc => {\r\n            flat.push({ label: acc.label, value: acc.value, category: cat.category, indent: 0 });\r\n            if ('children' in acc && acc.children) {\r\n                acc.children.forEach((child: any) => {\r\n                    flat.push({ label: child.label, value: child.value, category: cat.category, indent: 1 });\r\n                });\r\n            }\r\n        });\r\n    });\r\n    return flat;\r\n};\r\n\r\nexport const ALL_ACCOUNTS = flattenAccounts();\r\n\r\n// Helper function to get account label from value\r\nexport const getAccountLabel = (value: string): string => {\r\n    const acc = ALL_ACCOUNTS.find(a => a.value === value);\r\n    return acc?.label || value;\r\n};\r\n\r\n// Helper function to normalize account value from various formats\r\nexport const normalizeAccountValue = (account: string): string => {\r\n    if (!account) return \"\";\r\n\r\n    // First check if it's already a valid value\r\n    const directMatch = ALL_ACCOUNTS.find(a => a.value === account);\r\n    if (directMatch) return account;\r\n\r\n    // Try to match by label (case-insensitive)\r\n    const labelMatch = ALL_ACCOUNTS.find(\r\n        a => a.label.toLowerCase() === account.toLowerCase()\r\n    );\r\n    if (labelMatch) return labelMatch.value;\r\n\r\n    // Try normalized string matching\r\n    const normalized = account.toLowerCase().replace(/\\s+/g, '_');\r\n    const normalizedMatch = ALL_ACCOUNTS.find(a => a.value === normalized);\r\n    if (normalizedMatch) return normalizedMatch.value;\r\n\r\n    // Default mappings for legacy data\r\n    const legacyMap: Record<string, string> = {\r\n        'cost_of_goods_sold': 'cost_of_goods',\r\n        'cost of goods sold': 'cost_of_goods',\r\n        'inventory': 'materials',\r\n        'purchase_returns': 'cost_of_goods',\r\n        'other_expense': 'office_supplies',\r\n    };\r\n\r\n    return legacyMap[normalized] || legacyMap[account.toLowerCase()] || \"\";\r\n};\r\n\r\ninterface AccountSelectDropdownProps {\r\n    value: string;\r\n    onValueChange: (value: string) => void;\r\n    placeholder?: string;\r\n    className?: string;\r\n    triggerClassName?: string;\r\n    disabled?: boolean;\r\n    testId?: string;\r\n}\r\n\r\nexport function AccountSelectDropdown({\r\n    value,\r\n    onValueChange,\r\n    placeholder = \"Select an account\",\r\n    className,\r\n    triggerClassName,\r\n    disabled = false,\r\n    testId,\r\n}: AccountSelectDropdownProps) {\r\n    const [open, setOpen] = useState(false);\r\n\r\n    const selectedLabel = value ? getAccountLabel(value) : \"\";\r\n\r\n    return (\r\n        <Popover open={open} onOpenChange={setOpen}>\r\n            <PopoverTrigger asChild>\r\n                <Button\r\n                    variant=\"outline\"\r\n                    role=\"combobox\"\r\n                    aria-expanded={open}\r\n                    disabled={disabled}\r\n                    className={cn(\r\n                        \"w-full justify-between font-normal\",\r\n                        !value && \"text-muted-foreground\",\r\n                        triggerClassName\r\n                    )}\r\n                    data-testid={testId}\r\n                >\r\n                    <span className=\"truncate\">{selectedLabel || placeholder}</span>\r\n                    <ChevronDown className={cn(\"ml-2 h-4 w-4 shrink-0 opacity-50 transition-transform\", open && \"rotate-180\")} />\r\n                </Button>\r\n            </PopoverTrigger>\r\n            <PopoverContent className={cn(\"w-[350px] p-0\", className)} align=\"start\">\r\n                <Command>\r\n                    <div className=\"flex items-center border-b px-3 py-2 bg-slate-50\">\r\n                        <Search className=\"mr-2 h-4 w-4 shrink-0 text-slate-400\" />\r\n                        <CommandInput placeholder=\"Search accounts...\" className=\"h-9 border-0 focus:ring-0 bg-transparent\" />\r\n                    </div>\r\n                    <CommandList className=\"max-h-[300px] overflow-y-auto\">\r\n                        <CommandEmpty>No account found.</CommandEmpty>\r\n                        {ACCOUNT_HIERARCHY.map((category) => (\r\n                            <CommandGroup key={category.category} heading={category.category}>\r\n                                {category.accounts.map((acc) => (\r\n                                    <div key={acc.value}>\r\n                                        <CommandItem\r\n                                            value={`${acc.label} ${category.category}`}\r\n                                            onSelect={() => {\r\n                                                onValueChange(acc.value);\r\n                                                setOpen(false);\r\n                                            }}\r\n                                            className=\"cursor-pointer\"\r\n                                        >\r\n                                            <Check\r\n                                                className={cn(\r\n                                                    \"mr-2 h-4 w-4\",\r\n                                                    acc.value === value ? \"opacity-100\" : \"opacity-0\"\r\n                                                )}\r\n                                            />\r\n                                            {acc.label}\r\n                                        </CommandItem>\r\n                                        {'children' in acc && acc.children && acc.children.map((child: any) => (\r\n                                            <CommandItem\r\n                                                key={child.value}\r\n                                                value={`${child.label} ${category.category}`}\r\n                                                onSelect={() => {\r\n                                                    onValueChange(child.value);\r\n                                                    setOpen(false);\r\n                                                }}\r\n                                                className=\"cursor-pointer pl-8\"\r\n                                            >\r\n                                                <Check\r\n                                                    className={cn(\r\n                                                        \"mr-2 h-4 w-4\",\r\n                                                        child.value === value ? \"opacity-100\" : \"opacity-0\"\r\n                                                    )}\r\n                                                />\r\n                                                <span className=\"text-slate-400 mr-1\"></span>\r\n                                                {child.label}\r\n                                            </CommandItem>\r\n                                        ))}\r\n                                    </div>\r\n                                ))}\r\n                            </CommandGroup>\r\n                        ))}\r\n                    </CommandList>\r\n                </Command>\r\n            </PopoverContent>\r\n        </Popover>\r\n    );\r\n}\r\n\r\nexport default AccountSelectDropdown;\r\n","path":null,"size_bytes":10906,"size_tokens":null}},"version":2}